<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">322</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/07/go-de-http/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/07/go-de-http/" class="post-title-link" itemprop="url">go的http</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-06 16:21:41 / 修改时间：03:36:02" itemprop="dateCreated datePublished" datetime="2021-07-06T16:21:41Z">2021-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/07/go-de-type/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/07/go-de-type/" class="post-title-link" itemprop="url">go的type</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-06 16:21:41 / 修改时间：08:08:39" itemprop="dateCreated datePublished" datetime="2021-07-06T16:21:41Z">2021-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li>给一个类型定义别名, 实际上为什么会有byte， 就是我为了强调我们现在处理的对象是字节类型</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//这种别名实际上还是为了代码的可读性， 这个实际上本质上仍然是uint8 无非就是在代码编码阶段可读性强而已</span></span><br><span class="line">    <span class="keyword">type</span> myByte = <span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">var</span> a myByte</span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, a) <span class="comment">// uint8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b <span class="keyword">uint8</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, b) <span class="comment">// uint8</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>第二种 就是基于一个已有的类型定义一个新的类型</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> i myInt</span><br><span class="line">fmt.Printf(<span class="string">"%T\n"</span>, i) <span class="comment">// main.myInt</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>定义结构体</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Course <span class="keyword">struct</span> {</span><br><span class="line">    name  <span class="keyword">string</span></span><br><span class="line">    price <span class="keyword">int</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol start="4">
<li>定义接口</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Callable <span class="keyword">interface</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol start="5">
<li>定义函数别名</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> handle <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span></span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/06/go-de-defer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/06/go-de-defer/" class="post-title-link" itemprop="url">go的defer</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-05 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-05T16:21:41Z">2021-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-06 01:07:23" itemprop="dateModified" datetime="2021-07-06T01:07:23Z">2021-07-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>defer本质上是注册了一个延迟函数，defer函数的执行顺序已经确定<br>defer 没有嵌套 defer的机制是要取代try except finally</p>
<ol>
<li>大量的嵌套try finally</li>
<li>打开和关系逻辑离的太远</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhangboyu/p/7911190.html">https://www.cnblogs.com/zhangboyu/p/7911190.html</a><br><a target="_blank" rel="noopener" href="https://studygolang.com/articles/24044?fr=sidebar">https://studygolang.com/articles/24044?fr=sidebar</a></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   fmt.Println(<span class="string">"test1"</span>)</span><br><span class="line">   <span class="comment">//defer之后只能是函数调用 不能是表达式 比如 a++</span></span><br><span class="line">   <span class="comment">//     //1. 如果有多个defer会出现什么情况 多个defer是按照类似栈结构先入后出的顺序执行</span></span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"defer test1"</span>)</span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"defer test2"</span>)</span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"defer test3"</span>)</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">       defer 语句是go体用的一种用于注册延迟调用的机制， 它可以让当前函数执行完毕之后执行</span></span><br><span class="line"><span class="comment">       对于python的with语句来说，</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="comment">//此处有大量的逻辑需要读取文件</span></span><br><span class="line">}</span><br><span class="line">   fmt.Println(<span class="string">"test2"</span>)</span><br><span class="line">   <span class="comment">//test1</span></span><br><span class="line">   <span class="comment">//test2</span></span><br><span class="line">   <span class="comment">//defer test3</span></span><br><span class="line">   <span class="comment">//defer test2</span></span><br><span class="line">   <span class="comment">//defer test1</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">//defer语句执行时的拷贝机制</span></span><br><span class="line">   test := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       fmt.Println(<span class="string">"test1"</span>)</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">defer</span> test()</span><br><span class="line">   test = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       fmt.Println(<span class="string">"test2"</span>)</span><br><span class="line">   }</span><br><span class="line">   fmt.Println(<span class="string">"test3"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">//test3</span></span><br><span class="line"><span class="comment">//test1 因为test1的值已经入栈不能再修改了，所以不再是test2</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">// defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span></span> {</span><br><span class="line">       fmt.Println(a)</span><br><span class="line">   }(x) <span class="comment">// 后面的括号表示调用匿名函数</span></span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 10</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">// defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(a *<span class="keyword">int</span>)</span></span> { <span class="comment">// 指针</span></span><br><span class="line">       fmt.Println(*a) <span class="comment">// 指向内存的值</span></span><br><span class="line">   }(&amp;x) <span class="comment">// 后面的括号表示调用匿名函数</span></span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">//11</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">//defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       <span class="comment">//此处的defer函数并没有参数，函数内部使用的值是全局的值，闭包</span></span><br><span class="line">       fmt.Println(x)</span><br><span class="line">   }()</span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">//11</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">//defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="comment">//此处的defer函数有参数，函数内部使用的值是全局的值</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span></span> {</span><br><span class="line">       fmt.Println(x)</span><br><span class="line">   }(x)</span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 11</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span> <span class="title">int</span></span> {</span><br><span class="line">    x := <span class="number">10</span></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        x++</span><br><span class="line">    }()</span><br><span class="line">    tmp := x <span class="comment">// x是int类型 值传递</span></span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">()</span> *<span class="title">int</span></span> { <span class="comment">// 指针</span></span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    b := &amp;a</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        *b++</span><br><span class="line">    }()</span><br><span class="line">    temp_data := b <span class="comment">// b是指针类型，修改指针指向的内存对应的变量的值</span></span><br><span class="line">    <span class="keyword">return</span> temp_data</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(f1()) <span class="comment">// 10 说明defer中的x++并没有影响return的值</span></span><br><span class="line">    fmt.Println(*f2()) <span class="comment">// 11</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/06/go-cuo-wu-he-yi-chang-panic-he-recove/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/06/go-cuo-wu-he-yi-chang-panic-he-recove/" class="post-title-link" itemprop="url">go错误和异常panic和recove</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-05 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-05T16:21:41Z">2021-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-06 07:37:38" itemprop="dateModified" datetime="2021-07-06T07:37:38Z">2021-07-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>错误和异常是两个不同的概念，非常容易混淆。很多程序员习惯将一切非正常情况都看做错误，而不区分错误和异常，即使程序中可能有异常抛出，也将异常及时捕获并转换成错误。从表面上看，一切皆错误的思路更简单，而异常的引入仅仅增加了额外的复杂度。<br>但事实并非如此。众所周知，Golang遵循“少即是多”的设计哲学，追求简洁优雅，就是说如果异常价值不大，就不会将异常加入到语言特性中。</p>
<p>错误和异常处理是程序的重要组成部分，我们先看看下面几个问题：<br>错误和异常如何区分？<br>错误处理的方式有哪几种？<br>什么时候需要使用异常终止程序？<br>什么时候需要捕获异常？</p>
<p>Golang中引入error接口类型作为错误处理的标准模式，如果函数要返回错误，则返回值类型列表中肯定包含error。<br>error处理过程类似于C语言中的错误码，可逐层返回，直到被处理。</p>
<p>Golang中引入两个内置函数panic和recover来触发**和终止异常处理流程，同时引入关键字defer来延迟执行defer后面的函数。<br>一直等到包含defer语句的函数执行完毕时，延迟函数（defer后的函数）才会被执行，而不管包含defer语句的函数是通过return的正常结束，还是由于panic导致的异常结束。</p>
<p>你可以在一个函数中执行多条defer语句，它们的执行顺序与声明顺序相反。</p>
<p>当程序运行时，如果遇到引用空指针、下标越界或显式调用panic函数等情况，则先触发panic函数的执行，然后调用延迟函数。调用者继续传递panic，因此该过程一直在调用栈中重复发生：函数停止执行，调用延迟执行函数等。如果一路在延迟函数中没有recover函数的调用，则会到达该携程的起点，该携程结束，然后终止其他所有携程，包括主携程（类似于C语言中的主线程，该携程ID为1）。<br>错误和异常从Golang机制上讲，就是error和panic的区别。很多其他语言也一样，比如C++/Java，没有error但有errno，没有panic但有throw。</p>
<p>Golang错误和异常是可以互相转换的：</p>
<ol>
<li>错误转异常，比如程序逻辑上尝试请求某个URL，最多尝试三次，尝试三次的过程中请求失败是错误，尝试完第三次还不成功的话，失败就被提升为异常了。</li>
<li>异常转错误，比如panic触发的异常被recover恢复后，将返回值中error类型的变量进行赋值，以便上层函数继续走错误处理流程。</li>
</ol>
<p>什么情况下用错误表达，什么情况下用异常表达，就得有一套规则，否则很容易出现一切皆错误或一切皆异常的情况。</p>
<p>在这个启示下，我们给出异常处理的作用域（场景）：</p>
<ul>
<li>空指针引用</li>
<li>下标越界</li>
<li>除数为0</li>
<li>不应该出现的分支，比如default</li>
<li>输入不应该引起函数错误</li>
</ul>
<p>其他场景我们使用错误处理，这使得我们的函数接口很精炼。</p>
<p>对于异常，我们可以选择在一个合适的上游去recover，并打印堆栈信息，使得部署后的程序不会终止。</p>
<p>说明： Golang错误处理方式一直是很多人诟病的地方，有些人吐槽说一半的代码都是<code>"if err != nil { / 打印 &amp;&amp; 错误处理 / }"</code>，严重影响正常的处理逻辑。当我们区分错误和异常，根据规则设计函数，就会大大提高可读性和可维护性。</p>
<h2 id="对待异常的态度"><a href="#对待异常的态度" class="headerlink" title="对待异常的态度"></a>对待异常的态度</h2><h2 id="1-在程序开发阶段，坚持速错"><a href="#1-在程序开发阶段，坚持速错" class="headerlink" title="1. 在程序开发阶段，坚持速错"></a>1. 在程序开发阶段，坚持速错</h2><p>去年学习Erlang的时候，建立了速错的理念，简单来讲就是“让它挂”，只有挂了你才会第一时间知道错误。在早期开发以及任何发布阶段之前，最简单的同时也可能是最好的方法是调用panic函数来中断程序的执行以强制发生错误，使得该错误不会被忽略，因而能够被尽快修复。</p>
<h3 id="2-在程序部署后，应恢复异常避免程序终止"><a href="#2-在程序部署后，应恢复异常避免程序终止" class="headerlink" title="2. 在程序部署后，应恢复异常避免程序终止"></a>2. 在程序部署后，应恢复异常避免程序终止</h3><p>我们在调用recover的延迟函数中以最合理的方式响应该异常：</p>
<ol>
<li>打印堆栈的异常调用信息和关键的业务信息，以便这些问题保留可见；</li>
<li>将异常转换为错误，以便调用者让程序恢复到健康状态并继续安全运行。</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcA</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Printf(<span class="string">"panic recover! p: %v"</span>, p)</span><br><span class="line">            debug.PrintStack()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    <span class="keyword">return</span> funcB()</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcB</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="comment">// simulation</span></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"foo"</span>)</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"success"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> {</span><br><span class="line">    err := funcA()</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> {</span><br><span class="line">        fmt.Printf(<span class="string">"err is nil\\n"</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Printf(<span class="string">"err is %v\\n"</span>, err)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>我们期望test函数的输出是：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err is foo</span><br></pre></td></tr></tbody></table></figure>

<p>实际上test函数的输出是：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err is nil</span><br></pre></td></tr></tbody></table></figure>

<p>原因是panic异常处理机制不会自动将错误信息传递给error，所以要在funcA函数中进行显式的传递，代码如下所示：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcA</span><span class="params">()</span> <span class="params">(err error)</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"panic recover! p:"</span>, p)</span><br><span class="line">            str, ok := p.(<span class="keyword">string</span>)</span><br><span class="line">            <span class="keyword">if</span> ok {</span><br><span class="line">                err = errors.New(str)</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                err = errors.New(<span class="string">"panic"</span>)</span><br><span class="line">            }</span><br><span class="line">            debug.PrintStack()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    <span class="keyword">return</span> funcB()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="3-对于不应该出现的分支，使用异常处理"><a href="#3-对于不应该出现的分支，使用异常处理" class="headerlink" title="3. 对于不应该出现的分支，使用异常处理"></a>3. 对于不应该出现的分支，使用异常处理</h3><p>当某些不应该发生的场景发生时，我们就应该调用panic函数来触发异常。比如，当程序到达了某条逻辑上不可能到达的路径：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> s := suit(drawCard()); s {</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Spades"</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Hearts"</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Diamonds"</span>:</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Clubs"</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"invalid suit %v"</span>, s))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="4-针对入参不应该有问题的函数，使用panic设计"><a href="#4-针对入参不应该有问题的函数，使用panic设计" class="headerlink" title="4. 针对入参不应该有问题的函数，使用panic设计"></a>4. 针对入参不应该有问题的函数，使用panic设计</h3><p>入参不应该有问题一般指的是硬编码，我们先看“一个启示”一节中提到的两个函数（Compile和MustCompile），其中MustCompile函数是对Compile函数的包装：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MustCompile</span><span class="params">(str <span class="keyword">string</span>)</span> *<span class="title">Regexp</span></span> {</span><br><span class="line">    regexp, error := Compile(str)</span><br><span class="line">    <span class="keyword">if</span> error != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">`regexp: Compile(`</span> + quote(str) + <span class="string">`): `</span> + error.Error())</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> regexp</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>所以，对于同时支持用户输入场景和硬编码场景的情况，一般支持硬编码场景的函数是对支持用户输入场景函数的包装。<br>对于只支持硬编码单一场景的情况，函数设计时直接使用panic，即返回值类型列表中不会有error，这使得函数的调用处理非常方便（没有了乏味的”if err != nil {/ 打印 &amp;&amp; 错误处理 /}”代码块）。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//错误就是能遇到可能出现的情况，这些情况会导致你的代码出问题， 参数检查， 数据库访问不了</span></span><br><span class="line">    a := <span class="number">12</span></span><br><span class="line">    b := <span class="number">0</span></span><br><span class="line">    fmt.Println(div(a, b)) <span class="comment">// panic: runtime error: integer divide by zero</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div1</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//错误就是能遇到可能出现的情况，这些情况会导致你的代码出问题， 参数检查， 数据库访问不了</span></span><br><span class="line">    a := <span class="number">12</span></span><br><span class="line">    b := <span class="number">0</span></span><br><span class="line">    fmt.Println(div1(a, b)) <span class="comment">// panic: 被除数不能为0</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div1</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//错误就是能遇到可能出现的情况，这些情况会导致你的代码出问题， 参数检查， 数据库访问不了</span></span><br><span class="line">    a := <span class="number">12</span></span><br><span class="line">    b := <span class="number">0</span></span><br><span class="line">    <span class="comment">// 出现错误函数不会终止，捕获异常</span></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       err := <span class="built_in">recover</span>()</span><br><span class="line">       <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">           fmt.Println(<span class="string">"异常被捕获到"</span>)</span><br><span class="line">       }</span><br><span class="line">       fmt.Println(<span class="string">"bobby"</span>)</span><br><span class="line">    }()</span><br><span class="line">    fmt.Println(div1(a, b)) </span><br><span class="line">    <span class="comment">// 异常被捕获到</span></span><br><span class="line">    <span class="comment">// bobby</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">panic的坑</span></span><br><span class="line"><span class="string">异常 go语言中如何抛出异常和如何捕捉异常</span></span><br><span class="line"><span class="string">go语言认为错误就要自己处理， 就个人而言，go语言的这种想法是正确的。但是实际的使用中确实人有点烦人</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br><span class="line">    strconv.Itoa(data)             <span class="comment">//go 认为这个Itoa的函数不可能出错， 没有必要返回error 内部代码出错这个时候应该抛出异常 panic</span></span><br><span class="line">    _, err := strconv.Atoi(<span class="string">"abcd"</span>) <span class="comment">//Atoi这个函数认为我的函数内部会出现一些预知错误情况</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="comment">//错误</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="./go%E7%9A%84http/1.png" alt="description"></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        a := <span class="number">12</span></span><br><span class="line">        b := <span class="number">0</span></span><br><span class="line">        fmt.Println(div(a, b)) <span class="comment">// 浏览器刷新 http: panic serving 127.0.0.1:53676: runtime error: integer divide by zero</span></span><br><span class="line">        <span class="comment">// 出现异常这个程序没有挂掉，一个协程挂掉不会影响整体服务的运行</span></span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"error"</span>)</span><br><span class="line">        <span class="comment">// http: panic serving 127.0.0.1:59184: error</span></span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>panic会引起主线程的挂掉， 同时会导致其他的协程都挂掉<br>在父协程中无法捕获子协程中出现的异常</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">// 开启一个协程</span></span><br><span class="line">           <span class="built_in">panic</span>(<span class="string">"error"</span>) <span class="comment">// panic: error</span></span><br><span class="line">        }()</span><br><span class="line">        <span class="comment">//操作redis的，有人觉得这段代码可以放到协程中去运行。有一个非常大的隐患了</span></span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        err := <span class="built_in">recover</span>()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"捕获到了"</span>)</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"出错了"</span>) <span class="comment">// 主协程</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    f1() <span class="comment">// 捕获到了</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        err := <span class="built_in">recover</span>()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"捕获到了"</span>)</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">// 开启一个协程</span></span><br><span class="line">        <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">            err := <span class="built_in">recover</span>() <span class="comment">// 处理异常，否则会导致其他的整个服务挂掉</span></span><br><span class="line">            <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">                fmt.Println(<span class="string">"捕获到了2"</span>)</span><br><span class="line">            }</span><br><span class="line">        }()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"出错了"</span>)</span><br><span class="line">    }()</span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second) <span class="comment">// 主协程执行完不释放清除，防止主协程退出</span></span><br><span class="line">    <span class="comment">//panic("出错了")</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    f1() <span class="comment">// 捕获到了2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>






<h2 id="错误处理的正确姿势"><a href="#错误处理的正确姿势" class="headerlink" title="错误处理的正确姿势"></a>错误处理的正确姿势</h2><h3 id="1-失败的原因只有一个时，不使用error"><a href="#1-失败的原因只有一个时，不使用error" class="headerlink" title="1. 失败的原因只有一个时，不使用error"></a>1. 失败的原因只有一个时，不使用error</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(self *AgentContext)</span> <span class="title">CheckHostType</span><span class="params">(host_type <span class="keyword">string</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">switch</span> host_type {</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"virtual_machine"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"bare_metal"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"CheckHostType ERROR:"</span> + host_type)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以看出，该函数失败的原因只有一个，所以返回值的类型应该为bool，而不是error，重构一下代码：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(self *AgentContext)</span> <span class="title">IsValidHostType</span><span class="params">(hostType <span class="keyword">string</span>)</span> <span class="title">bool</span></span> {</span><br><span class="line">    <span class="keyword">return</span> hostType == <span class="string">"virtual_machine"</span> || hostType == <span class="string">"bare_metal"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>说明：大多数情况，导致失败的原因不止一种，尤其是对I/O操作而言，用户需要了解更多的错误信息，这时的返回值类型不再是简单的bool，而是error。</p>
<h3 id="2-没有失败时，不使用error"><a href="#2-没有失败时，不使用error" class="headerlink" title="2. 没有失败时，不使用error"></a>2. 没有失败时，不使用error</h3><h3 id="3-error应放在返回值类型列表的最后"><a href="#3-error应放在返回值类型列表的最后" class="headerlink" title="3. error应放在返回值类型列表的最后"></a>3. error应放在返回值类型列表的最后</h3><h3 id="4-错误值统一定义，而不是跟着感觉走"><a href="#4-错误值统一定义，而不是跟着感觉走" class="headerlink" title="4. 错误值统一定义，而不是跟着感觉走"></a>4. 错误值统一定义，而不是跟着感觉走</h3><p>很多人写代码时，到处<code>return errors.New(value)</code>，而错误value在表达同一个含义时也可能形式不同，比如“记录不存在”的错误value可能为：</p>
<ol>
<li><code>"record is not existed."</code></li>
<li><code>"record is not exist!"</code></li>
<li><code>"###record is not existed！！！"</code></li>
<li>…<br>这使得相同的错误value撒在一大片代码里，当上层函数要对特定错误value进行统一处理时，需要漫游所有下层代码，以保证错误value统一，不幸的是有时会有漏网之鱼，而且这种方式严重阻碍了错误value的重构。<br>于是，我们可以参考C/C++的错误码定义文件，在Golang的每个包中增加一个错误对象定义文件，如下所示</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ERR_EOF = errors.New(<span class="string">"EOF"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_CLOSED_PIPE = errors.New(<span class="string">"io: read/write on closed pipe"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_NO_PROGRESS = errors.New(<span class="string">"multiple Read calls return no data or error"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_SHORT_BUFFER = errors.New(<span class="string">"short buffer"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_SHORT_WRITE = errors.New(<span class="string">"short write"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_UNEXPECTED_EOF = errors.New(<span class="string">"unexpected EOF"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="5-错误逐层传递时，层层都加日志"><a href="#5-错误逐层传递时，层层都加日志" class="headerlink" title="5. 错误逐层传递时，层层都加日志"></a>5. 错误逐层传递时，层层都加日志</h3><p>根据笔者经验，层层都加日志非常方便故障定位。<br>说明：至于通过测试来发现故障，而不是日志，目前很多团队还很难做到。如果你或你的团队能做到，那么请忽略这个姿势:)</p>
<h3 id="6-错误处理使用defer"><a href="#6-错误处理使用defer" class="headerlink" title="6. 错误处理使用defer"></a>6. 错误处理使用defer</h3><p>我们一般通过判断error的值来处理错误，如果当前操作失败，需要将本函数中已经create的资源destroy掉，示例代码如下：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferDemo</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    err := createResource1()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE1_FAILED</span><br><span class="line">    }</span><br><span class="line">    err = createResource2()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        destroyResource1()</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE2_FAILED</span><br><span class="line">    }</span><br><span class="line">    err = createResource3()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        destroyResource1()</span><br><span class="line">        destroyResource2()</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE3_FAILED</span><br><span class="line">    }</span><br><span class="line">    err = createResource4()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        destroyResource1()</span><br><span class="line">        destroyResource2()</span><br><span class="line">        destroyResource3()</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE4_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>当Golang的代码执行时，如果遇到defer的闭包调用，则压入堆栈。当函数返回时，会按照后进先出的顺序调用闭包。<br>对于闭包的参数是值传递，而对于外部变量却是引用传递，所以闭包中的外部变量err的值就变成外部函数返回时最新的err值。<br>根据这个结论，我们重构上面的示例代码：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferDemo</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    err := createResource1()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE1_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            destroyResource1()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    err = createResource2()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE2_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            destroyResource2()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    err = createResource3()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE3_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            destroyResource3()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    err = createResource4()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE4_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="7-当发生错误时，不忽略有用的返回值"><a href="#7-当发生错误时，不忽略有用的返回值" class="headerlink" title="7. 当发生错误时，不忽略有用的返回值"></a>7. 当发生错误时，不忽略有用的返回值</h3><p>通常，当函数返回non-nil的error时，其他的返回值是未定义的(undefined)，这些未定义的返回值应该被忽略。然而，有少部分函数在发生错误时，仍然会返回一些有用的返回值。比如，当读取文件发生错误时，Read函数会返回可以读取的字节数以及错误信息。对于这种情况，应该将读取到的字符串和错误信息一起打印出来。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/05/go-han-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/05/go-han-shu/" class="post-title-link" itemprop="url">go函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-04 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-04T16:21:41Z">2021-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-05 04:31:23" itemprop="dateModified" datetime="2021-07-05T04:31:23Z">2021-07-05</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"errors"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//相比较其他静态语言，go语言的函数有很多两点</span></span><br><span class="line"><span class="comment">//函数的几个要素： 1. 函数名 2. 参数 3. 返回值</span></span><br><span class="line"><span class="comment">//函数第一种定义方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">var</span> sum <span class="keyword">int</span></span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的第二种定义方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add2</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的第三种定义方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add3</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的第4种定义方法</span></span><br><span class="line"><span class="comment">// 被除数等于0 ，要返回多个值 -一个非常有用的特性</span></span><br><span class="line"><span class="comment">//go语言的返回设置花样很多</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line">    <span class="keyword">var</span> result <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        err = errors.New(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        result = a / b</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result, err</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div2</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(result <span class="keyword">int</span>, err error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        err = errors.New(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        result = a / b</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    result, err := div(<span class="number">12</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result) <span class="comment">// 4</span></span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line">    result1, err := div(<span class="number">12</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err) <span class="comment">// 被除数不能为0</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result1)</span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    result2, err := div2(<span class="number">12</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result2) <span class="comment">// 4</span></span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line">    result3, err := div2(<span class="number">12</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err) <span class="comment">// 被除数不能为0</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result3)</span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(params ...<span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="comment">// 通过省略号去动态设置多个参数值 解决可能有不定个int值传递进来</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> params {</span><br><span class="line">        sum += v</span><br><span class="line">    }</span><br><span class="line">    params[<span class="number">0</span>] = <span class="number">9</span> <span class="comment">// 值传递不影响</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add1</span><span class="params">(params []<span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="comment">// 切片 解决可能有不定个int值传递进来</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> params {</span><br><span class="line">        sum += v</span><br><span class="line">    }</span><br><span class="line">    params[<span class="number">0</span>] = <span class="number">9</span> <span class="comment">// 引用传递影响</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> sub <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span> // <span class="title">sub</span>就等同于<span class="title">int</span> <span class="title">map</span>是一种类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subImpl</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(score []<span class="keyword">int</span>, f <span class="keyword">func</span>(<span class="keyword">int</span>)</span> <span class="title">bool</span>) []<span class="title">int</span></span> {</span><br><span class="line">    returnSlice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> score {</span><br><span class="line">        <span class="keyword">if</span> f(v) {</span><br><span class="line">            returnSlice = <span class="built_in">append</span>(returnSlice, v)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> returnSlice</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 通过省略号去动态设置多个参数值</span></span><br><span class="line">    fmt.Println(add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)) <span class="comment">// 15</span></span><br><span class="line"></span><br><span class="line">    slice := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">    fmt.Println(add(slice...)) <span class="comment">// 15</span></span><br><span class="line">    fmt.Println(slice)         <span class="comment">// [9 2 3 4 5]</span></span><br><span class="line"></span><br><span class="line">    slice1 := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">    fmt.Println(add1(slice1)) <span class="comment">// 15</span></span><br><span class="line">    fmt.Println(slice1)       <span class="comment">// [9 2 3 4 5]</span></span><br><span class="line">    <span class="comment">//这种效果slice</span></span><br><span class="line">    <span class="comment">//区别，slice是一种类型， 还是引用传递， 我们要慎重</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//省略号的用途 1. 函数参数不定长 2. 将slice打散 3.</span></span><br><span class="line">    arr := [...]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, arr) <span class="comment">// [3]int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 函数 一些trick 一些语法糖 函数的一等公民特性 - 可以作为参数 返回值 复制给另一个变量</span></span><br><span class="line">    <span class="comment">//匿名函数</span></span><br><span class="line">    myFunc := <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    }</span><br><span class="line">    myFunc(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"%T"</span>, myFunc) <span class="comment">// func(int, int) int</span></span><br><span class="line"></span><br><span class="line">    result := <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    }(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(result)      <span class="comment">// 3</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T"</span>, myFunc) <span class="comment">// func(int, int) int</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    }(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//myFunc := add</span></span><br><span class="line">    <span class="comment">//fmt.Printf("%T", myFunc) // func(...int) int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//函数也可以当做参数传递给一个函数</span></span><br><span class="line">    <span class="keyword">var</span> mySub sub = <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a - b</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(mySub(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将函数作为另一个函数的参数</span></span><br><span class="line">    <span class="comment">//写一个函数用于过滤一部分数据</span></span><br><span class="line">    score := []<span class="keyword">int</span>{<span class="number">10</span>, <span class="number">50</span>, <span class="number">80</span>, <span class="number">90</span>, <span class="number">85</span>}</span><br><span class="line">    <span class="comment">//写一个函数过滤掉不合格的成绩</span></span><br><span class="line">    fmt.Println(filter(score, <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span> <span class="title">bool</span></span> {</span><br><span class="line">        <span class="keyword">if</span> a &gt;= <span class="number">90</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        }</span><br><span class="line">    })) <span class="comment">// [90]</span></span><br><span class="line">    <span class="comment">//gin, python的装饰器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//go语言并没有提供try except finally</span></span><br><span class="line">    <span class="comment">//1. 大量的嵌套try finally 2. 打开和关系逻辑离的太远</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/05/python-han-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/05/python-han-shu/" class="post-title-link" itemprop="url">python函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-04 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-04T16:21:41Z">2021-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-05 08:51:03" itemprop="dateModified" datetime="2021-07-05T08:51:03Z">2021-07-05</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一个简单的计算器</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">a = int(input(<span class="string">"请输入第一个数："</span>))</span><br><span class="line">op = input(<span class="string">"操作符："</span>)</span><br><span class="line">b = int(input(<span class="string">"请输入第二个数："</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "+":</span></span><br><span class="line"><span class="comment">#     print(a+b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "-":</span></span><br><span class="line"><span class="comment">#     print(a-b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "z*":</span></span><br><span class="line"><span class="comment">#     print(a*b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "/":</span></span><br><span class="line"><span class="comment">#     print(a/b)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典映射代替简单的if语句</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> add()</span><br><span class="line">    <span class="comment"># return add(a, b)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">div</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">op_dict = {</span><br><span class="line">    <span class="string">"+"</span>: add,</span><br><span class="line">    <span class="string">"++"</span>: add1,</span><br><span class="line">    <span class="string">"-"</span>: sub,</span><br><span class="line">    <span class="string">"/"</span>: div,</span><br><span class="line">    <span class="string">"*"</span>: mul,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">func = op_dict[op]</span><br><span class="line"><span class="comment"># print(func(a, b)(a, b))</span></span><br><span class="line">print(func(a, b))</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把函数当做普通的变量使用， 还可以当做一个返回值 这个特性就是一等公民的特性</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    first = kwargs[<span class="string">"first"</span>]</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> args:</span><br><span class="line">        sum += int(v)</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printInfo</span>(<span class="params">name=<span class="string">""</span>, age=<span class="number">18</span></span>):</span></span><br><span class="line">    print(<span class="string">"姓名:{}, 年龄:{}"</span>.format(name, age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">datas = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="string">"6"</span>]</span><br><span class="line">print(add(first=<span class="number">12</span>, last=<span class="number">9</span>))  <span class="comment"># 0</span></span><br><span class="line">printInfo(age=<span class="number">18</span>, name=<span class="string">"bobby"</span>)  <span class="comment"># 姓名:bobby, 年龄:18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有一些情况是需要两种操作都出现 1. 文件 （打开，close） 2. 数据库的连接 （开启连接， 关闭连接） 3. 锁(获取、释放)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">file_name</span>):</span></span><br><span class="line">    f = open(file_name)</span><br><span class="line">    <span class="keyword">with</span> open(file_name) <span class="keyword">as</span> f:</span><br><span class="line">        sum = <span class="number">0</span></span><br><span class="line">        data = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            sum += int(line)  <span class="comment">#这一行代码可能有异常  很多容易出现异常</span></span><br><span class="line">        <span class="comment"># f.close()</span></span><br><span class="line">        print(<span class="string">"before return"</span>)</span><br><span class="line">        re_data = data  <span class="comment"># data是list类型 引用传递  re_data中有一个拷贝=3</span></span><br><span class="line">        lock = threading.Lock()</span><br><span class="line">        lock.acquire()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 此处是多行处理逻辑 这些就可能抛出异常</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            lock.release()  <span class="comment"># 此处可能抛出异常</span></span><br><span class="line">        <span class="comment"># 此处跳往finally执行</span></span><br><span class="line">        <span class="keyword">return</span> re_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 代码出现异常导致f.close执行不到</span></span><br><span class="line"><span class="comment"># 2. 我们忘记close了吧</span></span><br><span class="line"><span class="comment"># 无论是否正常运行到吗都能够执行到指定的逻辑</span></span><br><span class="line"><span class="comment"># print(read_file("xxx.txt"))</span></span><br><span class="line"><span class="comment"># 代码很丑陋，一旦逻辑复制 这种代码大量的充斥了我们的代码中， java</span></span><br><span class="line"><span class="comment"># finally有一些细节我们需要知道 就有了第一个印象：finally会在return之后运行</span></span><br><span class="line"><span class="comment"># 事实上真的是这样吗？</span></span><br><span class="line"><span class="comment"># 原因： 实际上finally是在return之前调用的</span></span><br><span class="line"><span class="comment"># finally中是可以return的 而且这个地方一旦有了return就会覆盖原本的return</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/04/go-zhi-zhen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/04/go-zhi-zhen/" class="post-title-link" itemprop="url">go指针</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-03 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-03T16:21:41Z">2021-07-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-06 13:22:29" itemprop="dateModified" datetime="2021-07-06T13:22:29Z">2021-07-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>像python和java这种语言都是极力的屏蔽指针， c/c++ 都提供了指针 指针本身是很强大<br>c和c++中指针的功能很强大 指针的转换 指针的偏移 指针的运算<br>go语言没有屏蔽指针，但是go语言在指针上做了大量的限制，安全性高很多，相比较 c和c++灵活性就降低了<br>指针变量中涉及到两个符号：取地址 &amp; 和 取地址所指向值 *</p>
<p>很多时候都是函数参数的时候指明的类型<br>指针的只申明不赋值默认值是nil</p>
<p>go中数组是值传递 数组中有100万个值， 对于这种一般我们都采用切片来传递<br>在python中list和dict这种传递都是引用传递</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(a *<span class="keyword">int</span>, b *<span class="keyword">int</span>)</span></span> { <span class="comment">// 参数是指向int的指针</span></span><br><span class="line">    <span class="comment">// 用于交换a和b</span></span><br><span class="line">    c := *a</span><br><span class="line">    *a = *b</span><br><span class="line">    *b = c</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap1</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="comment">// 用于交换a和b</span></span><br><span class="line">    c := a</span><br><span class="line">    a = b</span><br><span class="line">    b = c</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 什么指针，我们提一个问题</span></span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    b := <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//a, b = b, a</span></span><br><span class="line">    <span class="comment">//fmt.Println(a, b) // 20 10</span></span><br><span class="line"></span><br><span class="line">    swap1(a, b)</span><br><span class="line">    fmt.Println(a, b) <span class="comment">// 10 20</span></span><br><span class="line">    <span class="comment">//为什么交换不成功， 这个函数运行完成以后 我想要把a和b的值变掉，int基本类型是值传递</span></span><br><span class="line">    <span class="comment">//指针 - 对于内存来说，每一个字节其实都是有地址-通过16进制打印出来</span></span><br><span class="line">    fmt.Printf(<span class="string">"%p\n"</span>, &amp;a) <span class="comment">// 0xc00000a0a8 变量有地址</span></span><br><span class="line">    <span class="comment">//现在有一种特殊的变量类型，这个变量只能保存地址值</span></span><br><span class="line">    <span class="keyword">var</span> ip *<span class="keyword">int</span> <span class="comment">//这个变量里面就只能保存地址类型这种值</span></span><br><span class="line">    ip = &amp;a</span><br><span class="line">    <span class="comment">// 如果要修改指针指向的内存对应的变量的值，用法也比较特殊</span></span><br><span class="line">    *ip = <span class="number">30</span></span><br><span class="line">    fmt.Println(a) <span class="comment">// 30</span></span><br><span class="line">    <span class="comment">//如何定义指针变量 如果修改指针变量指向的内存中的值。 通过指针去取值的时候不知道应该取多大的连续内存空间</span></span><br><span class="line">    fmt.Printf(<span class="string">"ip所指向的内存空间地址是：%p, 内存中的值是: %d\n"</span>, ip, *ip)</span><br><span class="line">    <span class="comment">//ip所指向的内存空间地址是：0xc00000a0a8, 内存中的值是: 30</span></span><br><span class="line"></span><br><span class="line">    swap(&amp;a, &amp;b)</span><br><span class="line">    fmt.Println(a, b) <span class="comment">// 20 30</span></span><br><span class="line">    <span class="comment">//if a != nil { // Cannot convert 'nil' to type 'int'</span></span><br><span class="line">    <span class="comment">//}</span></span><br></pre></td></tr></tbody></table></figure>

<p>指针还可以指向数组 指向数组的指针 数组是值类型</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arr := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"><span class="keyword">var</span> ip *[<span class="number">3</span>]<span class="keyword">int</span> = &amp;arr</span><br><span class="line"><span class="comment">//指针数组</span></span><br><span class="line"><span class="keyword">var</span> ptrs [<span class="number">3</span>]*<span class="keyword">int</span> <span class="comment">//创建能够存放三个指针变量的数组，注意*的位置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ip != <span class="literal">nil</span> {</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="comment">//if ptrs != nil { // Cannot convert 'nil' to type '[3]*int'</span></span><br><span class="line"><span class="comment">//}</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/04/go-de-nil/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/04/go-de-nil/" class="post-title-link" itemprop="url">go的nil</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-03 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-03T16:21:41Z">2021-07-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-04 13:58:51" itemprop="dateModified" datetime="2021-07-04T13:58:51Z">2021-07-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"unsafe"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//make和new函数</span></span><br><span class="line">    <span class="comment">//new函数用法</span></span><br><span class="line">    <span class="keyword">var</span> p *<span class="keyword">int</span> <span class="comment">//申明了一个只能放地址的变量p 但是变量没有初始值 没有占用内存分配，保留了占位符，占空间（是nil），不指向内存</span></span><br><span class="line">    *p = <span class="number">10</span>    <span class="comment">// panic: runtime error: invalid memory address or nil pointer dereference</span></span><br><span class="line">    <span class="comment">//[signal 0xc0000005 code=0x1 addr=0x0 pc=0xee2722]</span></span><br><span class="line">    <span class="comment">// nil的地址设为10，但是nil的空间地址都没有</span></span><br></pre></td></tr></tbody></table></figure>

<p>使用指针会增加额外空间<br>默认值 int byte rune float bool string 这些类型都有默认值，占用内存分配<br>指针， 切片 map， 接口这些默认值是nil 理解为none，不能直接赋值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span></span><br><span class="line">a = <span class="number">10</span></span><br><span class="line">fmt.Println(a) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对于指针来说或者说其他的默认值是0的情况来说 如何一开始申明的时候就分配内存</span></span><br><span class="line"><span class="comment">//go的编译器就知道先申请调用操作系统的分配内存空间接口，操作系统预留一个可用的空间把地址给go，go会把操作系统给的地址设置到p变量</span></span><br><span class="line"><span class="keyword">var</span> p *<span class="keyword">int</span> = <span class="built_in">new</span>(<span class="keyword">int</span>) <span class="comment">// 这里的内存中的值全部设置为0</span></span><br><span class="line">*p = <span class="number">10</span></span><br><span class="line">fmt.Println(p) <span class="comment">// 0xc00000a0d0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//int使用make就不行</span></span><br><span class="line"><span class="comment">//除了new函数可以申请内存以外 还有一个函数就是make,更加常用的是make函数， make函数一般用于切片 map</span></span><br><span class="line"><span class="comment">//var info map[string]string</span></span><br><span class="line"><span class="comment">//info["c"] = "bobby" // panic: assignment to entry in nil map</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> info1 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">info1[<span class="string">"c"</span>] = <span class="string">"bobby"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//new函数返回的是这个值的地址 指针 make函数返回的是指定类型的实例</span></span><br><span class="line"><span class="comment">//nil的一些细节</span></span><br><span class="line"><span class="keyword">var</span> info2 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"><span class="keyword">if</span> info2 == <span class="literal">nil</span> {</span><br><span class="line">    fmt.Println(<span class="string">"map的默认值是 nil"</span>) <span class="comment">// map的默认值是 nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//var x int = nil // Cannot use 'nil' as the type int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> slice []<span class="keyword">string</span></span><br><span class="line"><span class="keyword">if</span> slice == <span class="literal">nil</span> {</span><br><span class="line">    fmt.Println(<span class="string">"slice的默认值是 nil"</span>) <span class="comment">// slice的默认值是 nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> {</span><br><span class="line">    fmt.Println(<span class="string">"error的默认值是 nil"</span>) <span class="comment">// error的默认值是 nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>python中的None和go语言中的nil类型不一样，None是全局唯一的<br>go语言中 nil是唯一可以用来表示部分类型的零值的标识符，不是实际的对象，它可以代表许多不同内存布局的值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    fmt.Println(unsafe.Sizeof(slice), unsafe.Sizeof(info2)) <span class="comment">// 24 8</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/04/go-de-map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/04/go-de-map/" class="post-title-link" itemprop="url">go的map</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-03 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-03T16:21:41Z">2021-07-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-06 13:34:58" itemprop="dateModified" datetime="2021-07-06T13:34:58Z">2021-07-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="map创建"><a href="#map创建" class="headerlink" title="map创建"></a>map创建</h3><p>go中的map -&gt;python中的dict</p>
<p>要求所有的key的数据类型相同，所有value数据类型相同(注：key与value可以有不同的数据类型)<br>map的key和value类型申明的就要指明</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 字面值</span></span><br><span class="line">m1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{ <span class="comment">// 定义map类型变量m1，key的类型为string支持 == 比较操作，value的类型string</span></span><br><span class="line">    <span class="string">"m1"</span>: <span class="string">"v1"</span>, <span class="comment">// 定义时指定的初始key/value, 后面可以继续添加</span></span><br><span class="line">}</span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m1) <span class="comment">// map[m1:v1]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m3 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{} <span class="comment">//创建定义一个空的map</span></span><br><span class="line">fmt.Println(m3)           <span class="comment">// map[]</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m3)    <span class="comment">// map[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2. make函数可以创建slice 可以创建map</span></span><br><span class="line">m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>) <span class="comment">// 创建空的map，里面不含元素，元素都需要后续添加</span></span><br><span class="line">fmt.Println(m2)               <span class="comment">// map[]</span></span><br><span class="line">m2[<span class="string">"m2"</span>] = <span class="string">"v2"</span>               <span class="comment">// 添加元素</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m2)        <span class="comment">// map[m2:v2]</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="map中key的类型"><a href="#map中key的类型" class="headerlink" title="map中key的类型"></a>map中key的类型</h3><p>map中的每个key在keys的集合中是唯一的，而且需要支持 == or != 操作<br>key的常用类型：int, rune, string, 结构体(每个元素需要支持 == or != 操作), 指针, 基于这些类型自定义的类型，map中的key 不是所有的类型都支持</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// m0 可以, key类型为string, 支持 == 比较操作</span></span><br><span class="line"><span class="keyword">var</span> m0 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> <span class="comment">// 定义map类型变量m0，key的类型为string，value的类型string</span></span><br><span class="line">fmt.Println(m0)</span><br><span class="line"></span><br><span class="line">a := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">b := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment">// m1 不可以，[]byte是slice，不支持 == != 操作，不可以作为map key的数据类型</span></span><br><span class="line"><span class="keyword">var</span> m1 <span class="keyword">map</span>[[]<span class="keyword">int</span>]<span class="keyword">string</span> <span class="comment">// Invalid map key type []byte: comparison operators == and != must be fully defined for the key type</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//两个切片不能比较</span></span><br><span class="line"><span class="keyword">if</span> a == b { <span class="comment">// Invalid operation: a == b (the operator == is not defined on []int)</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个切片slice类型只能与nil比较，其他的都不可以</span></span><br><span class="line"><span class="keyword">if</span> a == <span class="literal">nil</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// m2 可以, interface{}类型可以作为key，但是需要加入的key的类型是可以比较的</span></span><br><span class="line"><span class="keyword">var</span> m2 <span class="keyword">map</span>[<span class="keyword">interface</span>{}]<span class="keyword">string</span></span><br><span class="line">m2 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>{}]<span class="keyword">string</span>)</span><br><span class="line"><span class="comment">//m2[[]byte("k2")]="v2" // panic: runtime error: hash of unhashable type []uint8</span></span><br><span class="line">m2[<span class="number">123</span>] = <span class="string">"123"</span></span><br><span class="line">m2[<span class="number">12.3</span>] = <span class="string">"123"</span></span><br><span class="line">fmt.Println(m2)</span><br><span class="line"></span><br><span class="line">c := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">d := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment">//两个数组可以比较</span></span><br><span class="line"><span class="keyword">if</span> c == d {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">a3 := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"><span class="keyword">var</span> m3 <span class="keyword">map</span>[[<span class="number">3</span>]<span class="keyword">int</span>]<span class="keyword">string</span></span><br><span class="line">m3 = <span class="built_in">make</span>(<span class="keyword">map</span>[[<span class="number">3</span>]<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line">m3[a3] = <span class="string">"m3"</span></span><br><span class="line">fmt.Println(m3)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// m4 可以，book1里面的元素都是支持== !=</span></span><br><span class="line"><span class="keyword">type</span> book1 <span class="keyword">struct</span> {</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> m4 <span class="keyword">map</span>[book1]<span class="keyword">string</span></span><br><span class="line">fmt.Println(m4)</span><br><span class="line"></span><br><span class="line"><span class="comment">// m5 不可以, text元素类型为[]byte, 不满足key的要求</span></span><br><span class="line"><span class="comment">// type book2 struct {</span></span><br><span class="line"><span class="comment">//  name string</span></span><br><span class="line"><span class="comment">//  text []byte //没有这个就可以</span></span><br><span class="line"><span class="comment">// }</span></span><br><span class="line"><span class="comment">//var m5 map[book2]string //invalid map key type book2</span></span><br><span class="line"><span class="comment">//fmt.Println(m5)</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="map的增删改"><a href="#map的增删改" class="headerlink" title="map的增删改"></a>map的增删改</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{</span><br><span class="line">    <span class="string">"a"</span>: <span class="string">"va"</span>,</span><br><span class="line">    <span class="string">"b"</span>: <span class="string">"vb"</span>,</span><br><span class="line">    <span class="string">"d"</span>: <span class="string">""</span>,</span><br><span class="line">}</span><br><span class="line">fmt.Println(<span class="built_in">len</span>(m)) <span class="comment">// len(m) 获得m中key/value对的个数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1. k不存在为增加，k存在为修改</span></span><br><span class="line">m[<span class="string">"c"</span>] = <span class="string">""</span></span><br><span class="line">m[<span class="string">"c"</span>] = <span class="string">"vc"</span> <span class="comment">// 重复增加(key相同)，使用新的值覆盖</span></span><br><span class="line">m[<span class="string">"b"</span>] = <span class="string">"vb1"</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m)              <span class="comment">// map[a:va b:vb1 c:vc d:]</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v\n"</span>, m, <span class="built_in">len</span>(m)) <span class="comment">// map[string]string{"a":"va", "b":"vb1", "c":"vc", "d":""} 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询，你返回空的字符串到底是没有获取到还是值本身就是这样空字符串呢</span></span><br><span class="line"><span class="comment">// 从m中取键k对应的值给v，如果k在m中不存在，则将value类型的零值赋值给v</span></span><br><span class="line"><span class="comment">// 从m中取键k对应的值给v，如果k存在，ok=true,如果k不存在，将value类型的零值赋值给v同时ok=false</span></span><br><span class="line"><span class="comment">// 查1 - 元素存在</span></span><br><span class="line">v := m[<span class="string">"d"</span>]</span><br><span class="line">v1, ok := m[<span class="string">"d"</span>]</span><br><span class="line"><span class="keyword">if</span> ok {</span><br><span class="line">    fmt.Println(<span class="string">"找到了"</span>, v1)</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    fmt.Println(<span class="string">"没找到"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 找到了</span></span><br><span class="line">fmt.Println(v, ok)                     <span class="comment">//  true</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v %#v\n"</span>, v, v1, ok) <span class="comment">// "" "" true 空字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查2 - 元素不存在</span></span><br><span class="line">u1 := m[<span class="string">"e"</span>]</span><br><span class="line">u2, ok2 := m[<span class="string">"e"</span>]</span><br><span class="line"><span class="keyword">if</span> ok2 {</span><br><span class="line">    fmt.Println(<span class="string">"找到了"</span>, u2)</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    fmt.Println(<span class="string">"没找到"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 没找到</span></span><br><span class="line">fmt.Println(u2, ok2)                     <span class="comment">//  false</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v %#v\n"</span>, u1, u2, ok2) <span class="comment">// "" "" false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除，使用内置函数删除k/v对</span></span><br><span class="line"><span class="comment">// delete(m, k) 将k以及k对应的v从m中删掉；如果k不在m中，不执行任何操作</span></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"a"</span>)        <span class="comment">// 删除存在的key</span></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"e"</span>)        <span class="comment">// 删除不存在的key，原m不影响，不会抛出异常</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m) <span class="comment">// map[b:vb1 c:vc d:]</span></span><br><span class="line"><span class="comment">//map[b:vb1 c:vc d:]</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v\n"</span>, m, <span class="built_in">len</span>(m)) <span class="comment">//map[string]string{"b":"vb1", "c":"vc", "d":""} 3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"a"</span>)                     <span class="comment">// 重复删除已经删除后不存在的不会抛出异常,m无影响</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m)              <span class="comment">// map[b:vb1 c:vc d:]</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v\n"</span>, m, <span class="built_in">len</span>(m)) <span class="comment">//map[string]string{"b":"vb1", "c":"vc", "d":""} 3</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="map的遍历"><a href="#map的遍历" class="headerlink" title="map的遍历"></a>map的遍历</h3><ul>
<li>遍历的顺序是随机的</li>
<li>使用for range遍历的时候，k,v使用的同一块内存，这也是容易出现错误的地方</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m {</span><br><span class="line">    fmt.Println(k, v)</span><br><span class="line">}</span><br><span class="line"><span class="comment">//b vb1</span></span><br><span class="line"><span class="comment">//d</span></span><br><span class="line"><span class="comment">//c vc</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m {</span><br><span class="line">    fmt.Printf(<span class="string">"k:[%v].v:[%v]\n"</span>, k, v) <span class="comment">// 输出k,v值</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="map遍历易错点举例"><a href="#map遍历易错点举例" class="headerlink" title="map遍历易错点举例"></a>map遍历易错点举例</h3><p>由于遍历的时候，遍历v使用的同一块地址，同时这块地址是临时分配的。虽然v的地址没有变化，但v的内容在一直变化，当遍历完成后，v的内容是map遍历时最后遍历的元素的值(map遍历无序，每次不确定哪个元素是最后一个元素)。当程序将v的地址放入到slice中的时候，slice在不断地v的地址插入，由于v一直是那块地址，因此slice中的每个元素记录的都是v的地址。因此当打印slice中的内容的时候，都是同一个值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>{</span><br><span class="line">    <span class="string">"a"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"b"</span>: <span class="number">2</span>,</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> bs []*<span class="keyword">int</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m {</span><br><span class="line">    fmt.Printf(<span class="string">"k:[%p].v:[%p]\n"</span>, &amp;k, &amp;v) <span class="comment">// 这里的输出可以看到，k一直使用同一块内存，v也是这个状况</span></span><br><span class="line">    bs = <span class="built_in">append</span>(bs, &amp;v) <span class="comment">// 对v取了地址</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="keyword">for</span> _, b := <span class="keyword">range</span> bs {</span><br><span class="line">    fmt.Println(*b) <span class="comment">// 输出都是1或者都是2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>go语言中也有一个list 就是数据结构中提到的链表，不需要连续的内存<br>指针 //为什么指针在java python等很多语言中不存在</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/03/go-qie-pian-yuan-li/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/03/go-qie-pian-yuan-li/" class="post-title-link" itemprop="url">go切片原理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-02 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-02T16:21:41Z">2021-07-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-03 05:09:23" itemprop="dateModified" datetime="2021-07-03T05:09:23Z">2021-07-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>切片底层是使用数组实现的，既要使用数组 又要满足动态的功能 怎么实现？<br>假设有一个值 实际上申请数组的时候可能是两个，如果后续要增加数据那么就直接添加到数据的结尾，这个时候我不要额外重新申请<br>切片有不同的初始化方式</p>
<ol>
<li>使用make方法初始化 len和cap是多少. 不会有多余的预留空间</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">d := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">fmt.Printf(<span class="string">"len=%d, cap=%d\n"</span>, <span class="built_in">len</span>(d), <span class="built_in">cap</span>(d)) <span class="comment">// len=0, cap=0</span></span><br><span class="line"></span><br><span class="line">a := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</span><br><span class="line">fmt.Printf(<span class="string">"len=%d, cap=%d\n"</span>, <span class="built_in">len</span>(a), <span class="built_in">cap</span>(a)) <span class="comment">// len=5, cap=5</span></span><br><span class="line"></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>, <span class="number">3</span>) <span class="comment">// len larger than cap in make([]int)</span></span><br><span class="line"></span><br><span class="line">c := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">fmt.Printf(<span class="string">"len=%d, cap=%d\n"</span>, <span class="built_in">len</span>(c), <span class="built_in">cap</span>(c)) <span class="comment">// len=5, cap=6</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>通过数组取切片</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">data := [<span class="number">10</span>]<span class="keyword">int</span>{<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>}</span><br><span class="line">slice := data[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">newSlice := data[<span class="number">3</span>:<span class="number">6</span>]</span><br><span class="line"><span class="keyword">for</span> index, value := <span class="keyword">range</span> slice {</span><br><span class="line">    fmt.Println(index, value)</span><br><span class="line">}</span><br><span class="line"><span class="comment">//0 2</span></span><br><span class="line"><span class="comment">//1 3</span></span><br><span class="line">fmt.Printf(<span class="string">"len=%d, cap=%d\n"</span>, <span class="built_in">len</span>(slice), <span class="built_in">cap</span>(slice))       <span class="comment">// len=2, cap=8=10-2</span></span><br><span class="line">fmt.Printf(<span class="string">"len=%d, cap=%d\n"</span>, <span class="built_in">len</span>(newSlice), <span class="built_in">cap</span>(newSlice)) <span class="comment">// len=3, cap=7=10-3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.</span></span><br><span class="line">slice2 := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">fmt.Printf(<span class="string">"len=%d, cap=%d\n"</span>, <span class="built_in">len</span>(slice2), <span class="built_in">cap</span>(slice2)) <span class="comment">// len=3, cap=3</span></span><br></pre></td></tr></tbody></table></figure>

<p>底层存储<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/kikajack/article/details/79833674">https://blog.csdn.net/kikajack/article/details/79833674</a><br>go和python的切片区别<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_15437667/article/details/70191873">https://blog.csdn.net/qq_15437667/article/details/70191873</a></p>
<p>Go 中切片 slice扩容机制</p>
<p>首先判断，如果新申请容量（cap）大于2倍的旧容量（old.cap），最终容量（newcap）就是新申请的容量（cap）<br>否则判断，如果旧切片的长度小于1024，则最终容量(newcap)就是旧容量(old.cap)的两倍，即（newcap=doublecap）<br>否则判断，如果旧切片长度大于等于1024，则最终容量（newcap）从旧容量（old.cap）开始循环增加原来的 1/4，<br>即（newcap=old.cap,for {newcap += newcap/4}）<br>直到最终容量（newcap）大于等于新申请的容量(cap)，即（newcap &gt;= cap）<br>如果最终容量（cap）计算值溢出，则最终容量（cap）就是新申请容量（cap）</p>
<p>append 函数的参数长度可变，因此可以追加多个值到 slice 中，还可以用 … 传入 slice，直接追加一个切片。<br>append函数返回值是一个新的slice，Go编译器不允许调用了 append 函数后不使用返回值。<br>使用 append 可以向 slice 追加元素，实际上是往底层数组添加元素。但是底层数组的长度是固定的，如果索引 len-1 所指向的元素已经是底层数组的最后一个元素，就没法再添加了。<br>这时，slice 会迁移到新的内存位置，新底层数组的长度也会增加，这样就可以放置新增的元素。同时，为了应对未来可能再次发生的 append 操作，新的底层数组的长度，也就是新 slice 的容量是留了一定的 buffer 的。否则，每次添加元素的时候，都会发生迁移，成本太高。<br>当原 slice 容量小于 1024 的时候，新 slice 容量变成原来的 2 倍 原 slice 容量超过 1024，新 slice 容量大家可以通过源码了解， 文章推荐：<a target="_blank" rel="noopener" href="https://juejin.im/post/5ca2b75f51882543ea4b81c8#heading-7">https://juejin.im/post/5ca2b75f51882543ea4b81c8#heading-7</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
