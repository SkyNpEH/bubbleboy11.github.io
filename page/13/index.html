<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;bubbleboy11.github.io&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/13/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/13/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<script data-pjax src="/js/load-config.js"></script>
  <title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">241</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/wei-yun-suan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/wei-yun-suan/" class="post-title-link" itemprop="url">位运算</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 03:01:02" itemprop="dateModified" datetime="2021-05-01T03:01:02Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>位运算符是把数字看作二进制来进行计算的</p>
<figure class="highlight plain"><figcaption><span>按位与运算符：参与运算的两个值，如果两个相应位都为1，则该位的结果为1，否则为0</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">print(0b110 &amp; 0b011)   # 2，即0b010</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight plain"><figcaption><span>按位或运算符：只要对应的二个二进位有一个为1时，结果位就为1。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">print(0b110 | 0b101)  # 7,即0b111</span><br><span class="line">print(-0b001 | 0b101)  # -1</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>按位取反运算符：对数据的每个二进制位取反，即把1变为0，把0变为1，包括符号位</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- 正数各位取反变为负数，显示时转化为其补码</span><br><span class="line">- 负数本身需要先转换为补码（符号位不变，各位取反再加 1），再对其补码进行各位取反</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">print(~0b101)  # 2，即0b010</span><br><span class="line">print(~5)  # -6</span><br></pre></td></tr></tbody></table></figure>

<p>5 的二进制为 0101，<br>~5 正数取反</p>
<ul>
<li>（1）各位取反，1010，最高位为1是负数</li>
<li>（2）负数转化为其补码<br>符号位保持不变，各位取反 1101，再加1，1110，也即 -6</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">print(~<span class="number">-3</span>)  <span class="comment"># 2</span></span><br><span class="line">print(~(<span class="number">-3</span>))  <span class="comment"># 2</span></span><br><span class="line">print(~(<span class="number">-5</span>))  <span class="comment"># 4</span></span><br><span class="line">``` </span><br><span class="line"><span class="number">-3</span> <span class="number">10.</span>.<span class="number">.011</span>，负数存储的是其补码：</span><br><span class="line">- <span class="number">-3</span> 的补码是：<span class="number">11.</span>.<span class="number">.101</span></span><br><span class="line">- ~(<span class="number">-5</span>)将其各位取反（包括符号位），也即 <span class="number">00.</span>.<span class="number">.010</span>（<span class="number">2</span>）</span><br><span class="line"><span class="number">-5</span>的原码是    <span class="number">10.</span>.<span class="number">.011</span></span><br><span class="line"><span class="number">-5</span>的反码是    <span class="number">11.</span>.<span class="number">.100</span></span><br><span class="line">           + <span class="number">00.</span>.<span class="number">.001</span> </span><br><span class="line"><span class="number">-5</span>的补码    = <span class="number">11.</span>.<span class="number">.101</span></span><br><span class="line">对其补码取反 = <span class="number">00.</span>.<span class="number">.010</span>（<span class="number">2</span>）</span><br><span class="line"></span><br><span class="line"><span class="number">-5</span> <span class="number">10.</span>.<span class="number">.101</span>，负数存储的是其补码：</span><br><span class="line">- <span class="number">-5</span> 的补码是：<span class="number">1011</span></span><br><span class="line">- ~(<span class="number">-5</span>)将其各位取反（包括符号位），也即 <span class="number">00.</span>.<span class="number">.100</span>（<span class="number">4</span>）</span><br><span class="line"><span class="number">-5</span>的原码是    <span class="number">10.</span>.<span class="number">.101</span></span><br><span class="line"><span class="number">-5</span>的反码是    <span class="number">11.</span>.<span class="number">.010</span></span><br><span class="line">           + <span class="number">00.</span>.<span class="number">.001</span> </span><br><span class="line"><span class="number">-5</span>的补码    = <span class="number">11.</span>.<span class="number">.011</span></span><br><span class="line">对其补码取反 = <span class="number">00.</span>.<span class="number">.100</span>（<span class="number">4</span>）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```^``` 按位异或运算符：当两对应的二进位相异时，结果为<span class="number">1</span></span><br><span class="line">```py</span><br><span class="line">print(<span class="number">0b111</span> ^ <span class="number">0b111</span>)  <span class="comment"># 0</span></span><br><span class="line">print(<span class="number">0b100</span> ^ <span class="number">0b111</span>)  <span class="comment"># 3</span></span><br><span class="line">print(<span class="number">0b1010</span> ^ <span class="number">0b1111</span>)  <span class="comment"># 5，即0b0101</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>左移运算符：运算数的各二进位全部左移若干位，</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    由"&lt;&lt;"右边的数指定移动的位数，高位丢弃，低位补0。</span><br><span class="line"></span><br><span class="line">左移操作相当于乘以2**n</span><br><span class="line">负数的左移 </span><br><span class="line">```py</span><br><span class="line">print(0b11 &lt;&lt; 2)  # 12, 即0b1100</span><br><span class="line">print(-2 &lt;&lt; 2)  # -8</span><br></pre></td></tr></tbody></table></figure>
<p>-2的原码是  10000000000000000000000000000010（32位系统），<br>-2的反码是  11111111111111111111111111111101，<br>其补码为    11111111111111111111111111111110，<br>左移2位变为 11111111111111111111111111111000，<br>再转化为原码 10000000000000000000000000001000，<br>也就是-8，也就是-2*(2**2)=-8</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">5</span> &lt;&lt; <span class="number">3</span>)  <span class="comment"># 40</span></span><br></pre></td></tr></tbody></table></figure>
<p>相当于5(2*3)=40。</p>
<figure class="highlight plain"><figcaption><span>右移运算符：把"&gt;&gt;"左边的运算数的各二进位全部右移若干位，</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   "&gt;&gt;"右边的数指定移动的位数</span><br><span class="line">相当于除以2**n，</span><br><span class="line">如果符号位为0，则右移后高位补0，如果符号位为1，则高位补1；</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">print(0b11 &gt;&gt; 1)  # 1, 即0b1</span><br><span class="line">print(5 &gt;&gt; 1)  # 2，即0b10</span><br><span class="line">print(-8 &gt;&gt; 3)  # -1 </span><br></pre></td></tr></tbody></table></figure>
<p>先转化为补码再进行计算，<br>以-8 &gt;&gt; 3为例，<br>-8的原码为10…01000,<br>-8的反码为11…10111,<br>-8的补码为11…11000,<br>右移3位变为11…11111,<br>相应的原码为10…01，即-1。<br>8/(2**3)=1</p>
<p>-1的源码10…01<br>-1的反码11…10<br>-1的补码11…11</p>
<p>假如n=10转换二进制为0000 1010，<br>1的二进制为0000 0001<br>把n转换成二进制，然后看n二进制的最后一位，<br>如果最后一位为1的话，结果就是1，如果最后一位是0的话，那就是0。<br>&amp; 相当于AND<br>因为2的倍数的二进制最后一位都是0，</p>
<blockquote>
<p>所以n &amp; 0x1表达式跟n%2都能判断n是为奇数还是偶数</p>
</blockquote>
<p>变换符号位 ~n + 1</p>
<pre class=" language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">60</span>  <span class="token comment" spellcheck="true"># 60 = 0011 1100</span>
b <span class="token operator">=</span> <span class="token number">13</span>  <span class="token comment" spellcheck="true"># 13 = 0000 1101</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 12 = 0000 1100</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 61 = 0011 1101</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 49 = 0011 0001</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># -61 = 1100 0011</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 240 = 1111 0000  向左移动两位</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 15 = 0000 1111</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 52 = 0011 0100  向左移动两位</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 3 = 0000 0011</span>
```




</code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/yuan-lei-he-shi-yong-chang-jing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/yuan-lei-he-shi-yong-chang-jing/" class="post-title-link" itemprop="url">元类和使用场景</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-03 15:28:54" itemprop="dateModified" datetime="2021-05-03T15:28:54Z">2021-05-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="元类-Meta-Class-是创建类的类。元类创建类，然后类再去创建实例。"><a href="#元类-Meta-Class-是创建类的类。元类创建类，然后类再去创建实例。" class="headerlink" title="元类 (Meta Class)是创建类的类。元类创建类，然后类再去创建实例。"></a>元类 (Meta Class)是创建类的类。元类创建类，然后类再去创建实例。</h3><ul>
<li>元类允许我们控制类的生成，比如修改类的属性等</li>
<li>使用 type 来定义一个元类</li>
<li>元类最常见的一个使用场景就是 ORM 框架。</li>
</ul>
<ol>
<li>type的等价使用</li>
</ol>
<p>（1）没有方法时type等价使用</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">x</span>:</span></span><br><span class="line">    a = <span class="number">1</span>    </span><br></pre></td></tr></tbody></table></figure>
<p>等价于<br>类的名字x, 类的基类object，类的属性dict</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = type(<span class="string">'x'</span>, (object,), dict(a=<span class="number">1</span>))  <span class="comment"># 类的属性保存在字典里面因此这里用dict</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span>(<span class="params">Base</span>):</span>  <span class="comment"># 继承Base</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 等价定义，注意Base后加上逗号，否则就不是tuple了</span></span><br><span class="line">SameChild == type(<span class="string">'Child'</span>, (Base,), {})</span><br></pre></td></tr></tbody></table></figure>

<p>（2）有方法的type等价使用</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 加上方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildWithMethod</span>(<span class="params">Base</span>):</span></span><br><span class="line">    bar = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span> </span><br><span class="line">    print(<span class="string">'hello'</span>)</span><br><span class="line">``` </span><br><span class="line">```python </span><br><span class="line"><span class="comment"># 等价定义，方法用的类外面hello方法</span></span><br><span class="line">ChildWithMethod = type(      </span><br><span class="line">    <span class="string">'ChildWithMethod'</span>, (Base,), {<span class="string">'bar'</span>:<span class="literal">True</span>, <span class="string">'hello'</span>:hello}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>元类 作用 控制类生成实例之前就把里面的属性变成小写,<br>   Python中 <strong>new</strong> 生成实例，<strong>init</strong> 初始化实例<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 元类继承自 type</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LowercaseMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="string">''' 修改类的属性名称为小写的元类 '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">mcs, name, bases, attrs</span>):</span>    <span class="comment"># 生成实例</span></span><br><span class="line">        lower_attrs = {}    <span class="comment"># 定义字典</span></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():   <span class="comment"># 遍历类所有属性，把非内置方法(魔术方法)都改成小写</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> k.startswith(<span class="string">'__'</span>):   <span class="comment"># 排除magic method魔术方法</span></span><br><span class="line">                lower_attrs[k.lower()] = v  <span class="comment"># 方法名变成小写</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lower_attrs[k] = v</span><br><span class="line">            <span class="comment"># 当前类mcs,名称name,基类bases,当前属性lower_attrs</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(mcs, name, bases, lower_attrs)</span><br><span class="line">            </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LowercaseClass</span>(<span class="params">metaclass=LowercaseMeta</span>):</span> <span class="comment"># py3</span></span><br><span class="line">    BAR = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">HELLO</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">    </span><br><span class="line">print(dir(LowercaseClass))  <span class="comment"># 你会发现“BAR”和“HELLO”都变小了</span></span><br><span class="line"><span class="comment"># 用一个类的实例调用hello方法，修改了类定义时候的属性名称！！！</span></span><br><span class="line">LowercaseClass().hello()</span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>输出结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__',</span></span><br><span class="line"><span class="comment"># '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__',</span></span><br><span class="line"><span class="comment"># '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__',</span></span><br><span class="line"><span class="comment"># '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__',</span></span><br><span class="line"><span class="comment"># 'bar', 'hello']</span></span><br><span class="line"><span class="comment"># hello</span></span><br></pre></td></tr></tbody></table></figure>
<p>metaclass一般翻译成“元类”，但也有人认为应该更关注元类“超越变形”的能力，应该翻译成超越类之类的。但是个人觉得“元类”比较顺口，其“本元”的含义也是实打实存在的，故本文用元类作为metaclass的中文翻译。</p>
<p>metaclass(元类)可以理解成是类的抽象、本元。类元编程即使用自定义metaclass获取极强灵活性的一种编程方式。</p>
<p>不过，在多处都有提到的需要注意的是：如果不是开发框架，不要使用元类，除非只是为了寻找乐趣：）。</p>
<p>什么是本元？<br>首先还是要搞清楚什么是本元？这个概念很抽象，必须弄清楚。</p>
<p>本元可以理解成一种更高程度的抽象。首先，类（class）是对象（object）的抽象，对象是类的实例。因此可以说类是对象的本元。而在python中，所有类都是type类的实例，也就是说type是所有类的抽象，所以你可以理解type就是那个元类。</p>
<p>type<br>一般我们会常用type(obj)来获取obj对象的类型。但type也可以用来创建新类型。这时需要传入三个参数：类名、父类tuple、属性字典。</p>
<p>class MyClass: … 等价于MyClass = type(classname, superclasses, attributedict)</p>
<p>class SuperCls:<br>    def <strong>init</strong>(self):<br>        print(“<strong>init</strong> in super class.”)</p>
<p>class A(SuperCls):<br>    pass</p>
<p>B = type(“B”, (SuperCls, ), {})</p>
<p>a = A()</p>
<h1 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>init</strong> in super class.<br>“””</p>
<p>b = B()</p>
<h1 id="输出-1"><a href="#输出-1" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>init</strong> in super class.<br>“””</p>
<p>print(A.mro())</p>
<h1 id="输出-2"><a href="#输出-2" class="headerlink" title="输出"></a>输出</h1><p>“””<br>[&lt;class ‘__main__.A’&gt;, &lt;class ‘__main__.SuperCls’&gt;, &lt;class ‘object’&gt;]<br>“””</p>
<p>print(B.mro())</p>
<h1 id="输出-3"><a href="#输出-3" class="headerlink" title="输出"></a>输出</h1><p>“””<br>[&lt;class ‘__main__.B’&gt;, &lt;class ‘__main__.SuperCls’&gt;, &lt;class ‘object’&gt;]<br>“””<br>上面类对象的mro()方法代表Method Resolution Order，即方法解析顺序，可以看到这个类的继承顺序。</p>
<p>通过上面的代码可以看出，使用type来动态创建类和你自己写代码创建一个类是完全一样的。</p>
<p>还有个问题，当我们使用type的时候，它自己是个type类还是type对象？如果你直接在解释器中输入print(type)会得到返回&lt;class ‘type’&gt;，因此可以认为你使用的就是type类。</p>
<p>MetaClass<br>OK，搞清楚了什么是“本元”和type，我们再来看metaclass。</p>
<h1 id="自定义metaclass"><a href="#自定义metaclass" class="headerlink" title="自定义metaclass"></a>自定义metaclass</h1><p>class MyMeta(type):<br>    def <strong>call</strong>(self, <em>args, **kwargs):<br>        print(“<strong>call</strong> in MyMeta”)<br>        return super().<strong>call</strong>(*args, *</em>kwargs)</p>
<pre><code>def __init__(cls, what, bases=None, dict=None):
    print("__init__ in MyMeta")
    super().__init__(what, bases, dict)

def __new__(*args, **kwargs):
    print("__new__ in MyMeta")
    return type.__new__(*args, **kwargs)
</code></pre>
<p>class SuperCls:<br>    pass</p>
<h1 id="使用metaclass方法1：类定义代码中指定"><a href="#使用metaclass方法1：类定义代码中指定" class="headerlink" title="使用metaclass方法1：类定义代码中指定"></a>使用metaclass方法1：类定义代码中指定</h1><p>class MyClass(SuperCls, metaclass=MyMeta):<br>    pass</p>
<h1 id="输出-4"><a href="#输出-4" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>new</strong> in MyMeta<br><strong>init</strong> in MyMeta<br>“””</p>
<h1 id="使用metaclass方法2：直接像调用type那样调用MyMeta"><a href="#使用metaclass方法2：直接像调用type那样调用MyMeta" class="headerlink" title="使用metaclass方法2：直接像调用type那样调用MyMeta"></a>使用metaclass方法2：直接像调用type那样调用MyMeta</h1><p>MyClass = MyMeta(“MyClass”, (SuperCls, ), {})</p>
<h1 id="输出-5"><a href="#输出-5" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>new</strong> in MyMeta<br><strong>init</strong> in MyMeta<br>“””</p>
<h1 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h1><p>my_obj = MyClass()</p>
<h1 id="输出-6"><a href="#输出-6" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>call</strong> in MyMeta<br>“””<br>看，我们的元类继承自type类。你在使用这个元类去定义一个新的类时，会调用元类的__new__和__init__；当你用这个新类去实例化一个新对象时又会调用元类的__new__。</p>
<p>因此，你可以可以重载type的这三个方法来修改type的行为，但要理清这几个方法被调用的时机：</p>
<p><strong>init</strong>(cls, what, bases=None, dict=None)<br><strong>new</strong>(<em>args, **kwargs)<br><strong>call</strong>(self, *args, *</em>kwargs)<br>典型案例<br>来看几个类元编程的典型案例。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Singleton单例模式</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls.instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls.instance = super(SingletonMeta, cls).__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CurrentUser</span>(<span class="params">object, metaclass=SingletonMeta</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name=None</span>):</span></span><br><span class="line">        super(CurrentUser, self).__init__()</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> repr(self) + <span class="string">":"</span> + repr(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    u = CurrentUser(<span class="string">"liu"</span>)</span><br><span class="line">    print(u)</span><br><span class="line">    u2 = CurrentUser()</span><br><span class="line">    u2.name = <span class="string">"xin"</span></span><br><span class="line">    print(u2)</span><br><span class="line">    print(u)</span><br><span class="line">    <span class="keyword">assert</span> u <span class="keyword">is</span> u2</span><br></pre></td></tr></tbody></table></figure>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://github.com/Meteorix/python-design-patterns">https://github.com/Meteorix/python-design-patterns</a> 。</p>
<p>这里重载的是type的__call__方法。改变了用户类实例化的行为，使其只能得到唯一的实例。</p>
<p>简易ORM框架</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Field</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, column_type</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.column_type = column_type</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;%s:%s&gt;'</span> % (self.__class__.__name__, self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        super().__init__(name, <span class="string">'varchar(100)'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntegerField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        super().__init__(name, <span class="string">'bigint'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelMetaclass</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, name, bases, attrs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'Model'</span>:</span><br><span class="line">            <span class="keyword">return</span> type.__new__(cls, name, bases, attrs)</span><br><span class="line">        print(<span class="string">'Found model: %s'</span> % name)</span><br><span class="line">        mappings = dict()</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():</span><br><span class="line">            <span class="keyword">if</span> isinstance(v, Field):</span><br><span class="line">                print(<span class="string">'Found mapping: %s ==&gt; %s'</span> % (k, v))</span><br><span class="line">                mappings[k] = v</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> mappings.keys():</span><br><span class="line">            attrs.pop(k)</span><br><span class="line">        attrs[<span class="string">'__mappings__'</span>] = mappings  <span class="comment"># 保存属性和列的映射关系</span></span><br><span class="line">        attrs[<span class="string">'__table__'</span>] = name  <span class="comment"># 假设表名和类名一致</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(cls, name, bases, attrs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>(<span class="params">dict, metaclass=ModelMetaclass</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, **kw</span>):</span></span><br><span class="line">        super(Model, self).__init__(**kw)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">r"'Model' object has no attribute '%s'"</span> % key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span>(<span class="params">self, key, value</span>):</span></span><br><span class="line">        self[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">self</span>):</span></span><br><span class="line">        fields = []</span><br><span class="line">        params = []</span><br><span class="line">        args = []</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.__mappings__.items():</span><br><span class="line">            fields.append(v.name)</span><br><span class="line">            params.append(<span class="string">'?'</span>)</span><br><span class="line">            args.append(getattr(self, k, <span class="literal">None</span>))</span><br><span class="line">        sql = <span class="string">'insert into %s (%s) values (%s)'</span> % (self.__table__, <span class="string">','</span>.join(fields), <span class="string">','</span>.join(params))</span><br><span class="line">        print(<span class="string">'SQL: %s'</span> % sql)</span><br><span class="line">        print(<span class="string">'ARGS: %s'</span> % str(args))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">Model</span>):</span></span><br><span class="line">    <span class="comment"># 定义类的属性到列的映射：</span></span><br><span class="line">    id = IntegerField(<span class="string">'id'</span>)</span><br><span class="line">    name = StringField(<span class="string">'username'</span>)</span><br><span class="line">    email = StringField(<span class="string">'email'</span>)</span><br><span class="line">    password = StringField(<span class="string">'password'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个实例：</span></span><br><span class="line">u = User(id=<span class="number">12345</span>, name=<span class="string">'Michael'</span>, email=<span class="string">'test@orm.org'</span>, password=<span class="string">'my-pwd'</span>)</span><br><span class="line"><span class="comment"># 保存到数据库：</span></span><br><span class="line">u.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Found model: User</span></span><br><span class="line"><span class="string">Found mapping: id ==&gt; &lt;IntegerField:id&gt;</span></span><br><span class="line"><span class="string">Found mapping: name ==&gt; &lt;StringField:username&gt;</span></span><br><span class="line"><span class="string">Found mapping: email ==&gt; &lt;StringField:email&gt;</span></span><br><span class="line"><span class="string">Found mapping: password ==&gt; &lt;StringField:password&gt;</span></span><br><span class="line"><span class="string">SQL: insert into User (id,username,email,password) values (?,?,?,?)</span></span><br><span class="line"><span class="string">ARGS: [12345, 'Michael', 'test@orm.org', 'my-pwd']</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></tbody></table></figure>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072">https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072</a></p>
<p>这里重载的是type的__new__方法，因此改变的是用户类在定义时的行为。这里用户类是一个数据模型，元类编程做的是在用户定义一个数据模型类的时候，把所有是Field类型的属性收集起来，统一放到mapping属性中。这样基类的方法save可以直接通过mapping属性来保存需要保存的Field属性们。</p>
<p>YAMLObject</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YAMLObjectMetaclass</span>(<span class="params">type</span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">cls, name, bases, kwds</span>):</span></span><br><span class="line">    super(YAMLObjectMetaclass, cls).__init__(name, bases, kwds)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'yaml_tag'</span> <span class="keyword">in</span> kwds <span class="keyword">and</span> kwds[<span class="string">'yaml_tag'</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">      cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)</span><br><span class="line">  <span class="comment"># 省略其余定义</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YAMLObject</span>(<span class="params">metaclass=YAMLObjectMetaclass</span>):</span></span><br><span class="line">    yaml_loader = Loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span>(<span class="params">yaml.YAMLObject</span>):</span></span><br><span class="line">  yaml_tag = <span class="string">u'!Monster'</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, hp, ac, attacks</span>):</span></span><br><span class="line">    self.name = name</span><br><span class="line">    self.hp = hp</span><br><span class="line">    self.ac = ac</span><br><span class="line">    self.attacks = attacks</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"%s(name=%r, hp=%r, ac=%r, attacks=%r)"</span> % (</span><br><span class="line">       self.__class__.__name__, self.name, self.hp, self.ac,      </span><br><span class="line">       self.attacks)</span><br><span class="line"></span><br><span class="line">yaml.load(<span class="string">"""</span></span><br><span class="line"><span class="string">--- !Monster</span></span><br><span class="line"><span class="string">name: Cave spider</span></span><br><span class="line"><span class="string">hp: [2,6]    # 2d6</span></span><br><span class="line"><span class="string">ac: 16</span></span><br><span class="line"><span class="string">attacks: [BITE, HURT]</span></span><br><span class="line"><span class="string">"""</span>)</span><br><span class="line"></span><br><span class="line">Monster(name=<span class="string">'Cave spider'</span>, hp=[<span class="number">2</span>, <span class="number">6</span>], ac=<span class="number">16</span>, attacks=[<span class="string">'BITE'</span>, <span class="string">'HURT'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> yaml.dump(Monster(</span><br><span class="line">    name=<span class="string">'Cave lizard'</span>, hp=[<span class="number">3</span>,<span class="number">6</span>], ac=<span class="number">16</span>, attacks=[<span class="string">'BITE'</span>,<span class="string">'HURT'</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">!Monster</span></span><br><span class="line"><span class="string">ac: 16</span></span><br><span class="line"><span class="string">attacks: [BITE, HURT]</span></span><br><span class="line"><span class="string">hp: [3, 6]</span></span><br><span class="line"><span class="string">name: Cave lizard</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></tbody></table></figure>
<p>这里重载的是type的__init__方法，因此改变的是用户类在定义时的行为。在定义了用户类Monster时，便通过cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)将Monster类注册到系统。</p>
<p>PyText</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComponentMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">metacls, typename, bases, namespace</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Config"</span> <span class="keyword">not</span> <span class="keyword">in</span> namespace:</span><br><span class="line">            <span class="comment"># We need to dynamically create a new Config class per</span></span><br><span class="line">            <span class="comment"># instance rather than inheriting a single empty config class</span></span><br><span class="line">            <span class="comment"># because components are registered uniquely by config class.</span></span><br><span class="line">            <span class="comment"># If a parent class specifies a config class, inherit from it.</span></span><br><span class="line">            parent_config = next(</span><br><span class="line">                (base.Config <span class="keyword">for</span> base <span class="keyword">in</span> bases <span class="keyword">if</span> hasattr(base, <span class="string">"Config"</span>)), <span class="literal">None</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> parent_config <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line"></span><br><span class="line">                <span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params">parent_config</span>):</span></span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">                <span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params">ConfigBase</span>):</span></span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">            namespace[<span class="string">"Config"</span>] = Config</span><br><span class="line"></span><br><span class="line">        component_type = next(</span><br><span class="line">            (</span><br><span class="line">                base.__COMPONENT_TYPE__</span><br><span class="line">                <span class="keyword">for</span> base <span class="keyword">in</span> bases</span><br><span class="line">                <span class="keyword">if</span> hasattr(base, <span class="string">"__COMPONENT_TYPE__"</span>)</span><br><span class="line">            ),</span><br><span class="line">            namespace.get(<span class="string">"__COMPONENT_TYPE__"</span>),</span><br><span class="line">        )</span><br><span class="line">        new_cls = super().__new__(metacls, typename, bases, namespace)</span><br><span class="line"></span><br><span class="line">        new_cls.Config.__COMPONENT_TYPE__ = component_type</span><br><span class="line">        new_cls.Config.__name__ = <span class="string">f"<span class="subst">{typename}</span>.Config"</span></span><br><span class="line">        new_cls.Config.__COMPONENT__ = new_cls</span><br><span class="line">        new_cls.Config.__EXPANSIBLE__ = namespace.get(<span class="string">"__EXPANSIBLE__"</span>)</span><br><span class="line">        <span class="keyword">if</span> component_type:</span><br><span class="line">            Registry.add(component_type, new_cls, new_cls.Config)</span><br><span class="line">        <span class="keyword">return</span> new_cls</span><br></pre></td></tr></tbody></table></figure>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://github.com/facebookresearch/pytext/blob/351a060b479cbfe1db46b74f1fc975a5b6523122/pytext/config/component.py#L87">https://github.com/facebookresearch/pytext/blob/351a060b479cbfe1db46b74f1fc975a5b6523122/pytext/config/component.py#L87</a></p>
<p>这里重载的是type的__new__方法，因此改变的是用户类在定义时的行为。在定义了用户组件类时，便通过Registry.add(component_type, new_cls, new_cls.Config)将该组件类注册到系统。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span>(<span class="params">yaml.YAMLObject</span>):</span></span><br><span class="line">    yaml_tag = <span class="string">"Monster"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, hp, ac, attacks</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.hp = hp</span><br><span class="line">        self.ac = ac</span><br><span class="line">        self.attacks = attacks</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"{}(name = {}, hp = {}, ac = {}, attacks = {}"</span>.format(self.__class__.__name__, self.name, self.hp, self.ac, self.attacks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    Monster(name = <span class="string">"zym"</span>, hp = [<span class="number">2</span>, <span class="number">6</span>], ac = <span class="number">16</span>, attacks = [<span class="string">"BITE"</span>, <span class="string">"HURT"</span>])</span><br><span class="line">    print(yaml.dump(Monster(name = <span class="string">"zym2"</span>, hp = [<span class="number">3</span>, <span class="number">6</span>], ac = <span class="number">18</span>, attacks = [<span class="string">"BITE"</span>, <span class="string">"HURT"</span>])))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 所有用户自定义类，是type的实例</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    instance = MyClass()</span><br><span class="line">    print(type(instance))</span><br><span class="line">    print(type(MyClass))</span><br><span class="line">    <span class="comment"># 用户自定义类，是type类的__call__运算符重载</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass2</span>:</span></span><br><span class="line">        data = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    instance = MyClass2()</span><br><span class="line">    print(MyClass2, instance, instance.data)</span><br><span class="line"></span><br><span class="line">    MyClass = type(<span class="string">"MyClass"</span>, (), {<span class="string">"data"</span>:<span class="number">1</span>})</span><br><span class="line">    instance = MyClass()</span><br><span class="line">    print(MyClass, instance, instance.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 网友的例子</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, bases, dic</span>):</span></span><br><span class="line">            super().__init__(name, bases, dic)</span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__init__"</span>)</span><br><span class="line">            print(self.__name__)</span><br><span class="line">            print(dic)</span><br><span class="line">            print(self.yaml_tag)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__new__"</span>)</span><br><span class="line">            print(cls.__name__)</span><br><span class="line">            <span class="keyword">return</span> type.__new__(cls, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__call__"</span>)</span><br><span class="line">            obj = cls.__new__(cls)</span><br><span class="line">            cls.__init__(cls, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Foo</span>(<span class="params">metaclass=MyMeta</span>):</span></span><br><span class="line">        yaml_tag = <span class="string">"!Foo"</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">            print(<span class="string">"Foo.__init__"</span>)</span><br><span class="line">            self.name = name</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"Foo.__new__"</span>)</span><br><span class="line">            <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line"></span><br><span class="line">    foo = Foo(<span class="string">"foo"</span>)</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/han-shu-shi-bian-cheng-filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/han-shu-shi-bian-cheng-filter/" class="post-title-link" itemprop="url">函数式编程 filter</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-14 07:32:18" itemprop="dateModified" datetime="2021-04-14T07:32:18Z">2021-04-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="filter-函数应用"><a href="#filter-函数应用" class="headerlink" title="filter()函数应用"></a>filter()函数应用</h3><p>filter(function or None, iterable) –&gt; filter object</p>
<p>function or None：函数或者为None。<br>iterable：可迭代对象。</p>
<p>filter就是把每个function应用到可迭代对象上，如果为True就返回。<br>功能：过滤序列<br>注意：参数函数返回值必须为真值或假值<br>返回值：迭代器对象</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f = filter(<span class="keyword">lambda</span> x: <span class="literal">True</span> <span class="keyword">if</span> x!=<span class="number">0</span> <span class="keyword">else</span> <span class="literal">False</span> , [<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">print(list(f))  <span class="comment"># [1, 2, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回所有的偶数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(filter(<span class="keyword">lambda</span> x: x%<span class="number">2</span>==<span class="number">0</span>, range(<span class="number">10</span>)))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用列表推导式实现</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i % <span class="number">2</span>==<span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  计算200内所有奇数的平分根是整数，需要使用filter函数</span></span><br><span class="line"><span class="comment"># filter 函数传入两个参数，第一个参入的是lambda函数，第二个参数是一到两百的列表</span></span><br><span class="line">f2 = filter(<span class="keyword">lambda</span> x: <span class="keyword">not</span> x &amp; <span class="number">1</span> <span class="keyword">and</span> pow(int(x**<span class="number">0.5</span>), <span class="number">2</span>) == x, range(<span class="number">1</span>, <span class="number">201</span>))</span><br><span class="line"><span class="comment"># not x&amp;1 计算出一到两百所有奇数</span></span><br><span class="line"><span class="comment"># x**0.5计算平分根</span></span><br><span class="line"><span class="comment"># print(pow(3, 2) == 3**2 == 9)  # True</span></span><br><span class="line"><span class="comment"># pow(int(x**0.5), 2) 计算平分根的正整数的平方</span></span><br><span class="line"><span class="comment"># pow(int(x**0.5), 2) == x  平分根的正整数的平方是否等于自己x,x&gt;0,平方根不是整数平方后都变小</span></span><br><span class="line">x = <span class="number">2</span></span><br><span class="line">print(pow(int(x**<span class="number">0.5</span>), <span class="number">2</span>) == x)  <span class="comment"># False 平分根的正整数的平方是否等于自己x</span></span><br><span class="line">print(f2)  <span class="comment"># &lt;filter object at 0x000001C27B350B80&gt;</span></span><br><span class="line">print(list(f2))  <span class="comment"># [4, 16, 36, 64, 100, 144, 196]</span></span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/han-shu-shi-bian-cheng-map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/han-shu-shi-bian-cheng-map/" class="post-title-link" itemprop="url">函数式编程 map</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-09 12:27:01" itemprop="dateModified" datetime="2021-05-09T12:27:01Z">2021-05-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Python支持部分函数式编程特性"><a href="#Python支持部分函数式编程特性" class="headerlink" title="Python支持部分函数式编程特性"></a>Python支持部分函数式编程特性</h3><ul>
<li>把电脑的运算视作数学上的函数计算（lambda 演算）</li>
<li>高阶函数：map / reduce / filter</li>
<li>无副作用，相同的参数调用始终产生同样的结果，可以减少代码出错的几率</li>
<li>推荐尽量使用列表推导式代替函数式编程</li>
</ul>
<h3 id="map-函数应用"><a href="#map-函数应用" class="headerlink" title="map()函数应用"></a>map()函数应用</h3><p>map(function, iterable, …) –&gt; map object<br>func：表示函数。以参数序列中的每一个元素调用 function 函数，<br>*iterables：可以多个可迭代对象。</p>
<p>让每一个可迭代对象都去应用一下func函数<br>根据提供的函数对指定序列做映射。<br>python2.x版本返回的是列表，而python3.x返回的是迭代器。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>map(<span class="keyword">lambda</span> x:x*<span class="number">2</span>, range(<span class="number">10</span>))</span><br><span class="line">&lt;map object at <span class="number">0x0000029809EAB400</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(<span class="keyword">lambda</span> x:x*<span class="number">2</span>, range(<span class="number">10</span>)))   <span class="comment"># 每个元素乘以2</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>]</span><br><span class="line"><span class="comment"># 推荐列表推导代理 map</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[i*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> num * num</span><br><span class="line"></span><br><span class="line">res = map(test, [<span class="number">1</span>, <span class="number">23</span>])</span><br><span class="line">print(list(res))  <span class="comment"># [1, 529]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># map最终得到结果的元素个数，取决于此三者最短长度</span></span><br><span class="line">list_x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">list_y = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">list_z = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x, y, z</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x * x + y + z</span><br><span class="line"></span><br><span class="line"><span class="comment"># map函数</span></span><br><span class="line">m1 = map(square, list_x, list_y, list_z)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数</span></span><br><span class="line">m2 = map(<span class="keyword">lambda</span> x, y, z: x * x + y + z, list_x, list_y, list_z)</span><br><span class="line"></span><br><span class="line">print(list(m1))  <span class="comment"># [5, 12, 21, 32]</span></span><br><span class="line">print(list(m2))  <span class="comment"># [5, 12, 21, 32]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用map函数将[1，2，3，4]处理成[1,0,1,0]</span></span><br><span class="line">a1 = list(map(<span class="keyword">lambda</span> x: x % <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))  <span class="comment"># 取余数</span></span><br><span class="line">print(a1)  <span class="comment"># [1, 0, 1, 0]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请将列表[1,2,3,4,5]转变成[1,4,9,16,25]。然后提取大于10的数，最终输出[16,25]</span></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">'-------'</span>)</span><br><span class="line"><span class="comment"># 方法一</span></span><br><span class="line">b = list()</span><br><span class="line">c = list()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    b.append(i * i)</span><br><span class="line">print(b)  <span class="comment"># [1, 4, 9, 16, 25]  # 第一步</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">10</span>:</span><br><span class="line">        c.append(i)</span><br><span class="line">print(c)  <span class="comment"># [16, 25]  # 第二步</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二</span></span><br><span class="line">x = list(map(<span class="keyword">lambda</span> x: x * x, a))  <span class="comment"># 第一步 [1, 4, 9, 16, 25]</span></span><br><span class="line">print(x)</span><br><span class="line"></span><br><span class="line">y = [i <span class="keyword">for</span> i <span class="keyword">in</span> map(<span class="keyword">lambda</span> x: x * x, a) <span class="keyword">if</span> i &gt; <span class="number">10</span>]</span><br><span class="line">print(y)  <span class="comment"># [6]: [16, 25]  # 第二步</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法三 列表推导式</span></span><br><span class="line">print(<span class="string">'---方法三----'</span>)</span><br><span class="line">print([x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] <span class="keyword">if</span> x**<span class="number">2</span> &gt; <span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法四</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fn</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x**<span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'==方法四==='</span>)</span><br><span class="line">res = map(fn, a)</span><br><span class="line"><span class="comment"># for x in res:</span></span><br><span class="line"><span class="comment">#     print(x)</span></span><br><span class="line">res = [i <span class="keyword">for</span> i <span class="keyword">in</span> res <span class="keyword">if</span> i &gt; <span class="number">10</span>]</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法五</span></span><br><span class="line">print(<span class="string">'----'</span>)</span><br><span class="line">a = list(map(<span class="keyword">lambda</span> x: pow(x, <span class="number">2</span>), a))  <span class="comment"># 第一步</span></span><br><span class="line">print(a)  <span class="comment"># [1, 4, 9, 16, 25]</span></span><br><span class="line"></span><br><span class="line">b = [i <span class="keyword">for</span> i <span class="keyword">in</span> map(<span class="keyword">lambda</span> x: pow(x, <span class="number">2</span>), a) <span class="keyword">if</span> i &gt; <span class="number">10</span>]</span><br><span class="line">print(b)  <span class="comment"># [16, 25]  # 第二步</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/han-shu-shi-bian-cheng-reduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/han-shu-shi-bian-cheng-reduce/" class="post-title-link" itemprop="url">函数式编程 reduce</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-14 07:32:41" itemprop="dateModified" datetime="2021-04-14T07:32:41Z">2021-04-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="reduce-函数应用"><a href="#reduce-函数应用" class="headerlink" title="reduce()函数应用"></a>reduce()函数应用</h3><figure class="highlight plain"><figcaption><span>sequence[, initial])``` -&gt; value 归约，前面的结果每次都应用到后面去。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">function：函数。sequence：序列。initial：初始值。</span><br><span class="line"></span><br><span class="line">py2中是自带函数，py3转移到functools里面</span><br><span class="line"></span><br><span class="line">功能：对参数序列中元素进行累积</span><br><span class="line">注意：参数函数应至少有两个参数</span><br><span class="line">reduce把一个函数作用在一个序列[x1, x2, x3, ...]上，</span><br><span class="line">reduce把结果继续和序列的下一个元素做累积计算</span><br><span class="line">给mul传入参数的过程是这样的。</span><br><span class="line">先从有序列表中取前两个，传入函数进行计算，会得到一个结果，</span><br><span class="line">这时再从列表中取出一个还未计算过的值与这个函数的计算结果，</span><br><span class="line">再次传入函数计算。重复此过程，直到所有的列表元素都参与计算，</span><br><span class="line">以此来完成类似累加累乘这样的操作,函数可以大大减少代码量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from functools import reduce </span><br><span class="line"></span><br><span class="line">DIGITS = {</span><br><span class="line">    '0': 0,</span><br><span class="line">    '1': 1,</span><br><span class="line">    '2': 2,</span><br><span class="line">    '3': 3,</span><br><span class="line">    '4': 4,</span><br><span class="line">    '5': 5,</span><br><span class="line">    '6': 6,</span><br><span class="line">    '7': 7,</span><br><span class="line">    '8': 8,</span><br><span class="line">    '9': 9</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def char2num(s):</span><br><span class="line">    return DIGITS[s]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def str2int(s):</span><br><span class="line">    return reduce(lambda x, y: x * 10 + y, map(char2num, s))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = '67373'</span><br><span class="line">print(type(map(char2num, s)))  # &lt;class 'map'&gt;</span><br><span class="line">print(list(map(char2num, s)))  # [6, 7, 3, 7, 3]</span><br><span class="line"></span><br><span class="line">print(str2int(s))  # 67373</span><br><span class="line">print(type(str2int(s)))  # &lt;class 'int'&gt;</span><br><span class="line"></span><br><span class="line">list_x = ['1', '2', '3', '4', '5']</span><br><span class="line">print(reduce(lambda x, y: x + y, list_x))  # 12345 字符串相加，不是数字相加</span><br><span class="line"># x = '1' </span><br><span class="line"># y = '2'</span><br><span class="line"># return '12'</span><br><span class="line"># x = 'hello1' </span><br><span class="line"># y = '2'</span><br><span class="line"># return 'hello11'</span><br><span class="line">print(type(reduce(lambda x, y: x + y, list_x)))  # &lt;class 'str'&gt;</span><br><span class="line">print(reduce(lambda x, y: x + y, list_x, 'hello'))  # hello12345</span><br><span class="line"># x = 'hello' </span><br><span class="line"># y = '1'</span><br><span class="line"># return 'hello1'</span><br><span class="line"># x = 'hello1' </span><br><span class="line"># y = '2'</span><br><span class="line"># return 'hello11'</span><br><span class="line"></span><br><span class="line">print(type(reduce(lambda x, y: x + y, list_x, 'hello')))  # &lt;class 'str'&gt;</span><br><span class="line"></span><br><span class="line">list_y = [1, 2, 3, 4, 5]</span><br><span class="line">print(reduce(lambda x, y: x + y, list_y))  </span><br><span class="line"># 15 数字相加 ((((1+2)+3)+4)+5)，最后把和返回</span><br><span class="line">print(type(reduce(lambda x, y: x + y, list_y)))  </span><br><span class="line"># &lt;class 'int'&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>模拟计算器，整数计算的整数，小数计算得小数</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> eval(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">exp</span>):</span></span><br><span class="line">    ss = exp.split(<span class="string">'+'</span>)</span><br><span class="line">    ns = map(str2num, ss)</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> acc, x: acc + x, ns)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = calc(<span class="string">'100 + 200 + 345'</span>)</span><br><span class="line">print(<span class="string">'100 + 200 + 345 ='</span>, r)</span><br><span class="line"><span class="comment"># 100 + 200 + 345 = 645</span></span><br><span class="line">r = calc(<span class="string">'99 + 88 + 7.6'</span>)</span><br><span class="line">print(<span class="string">'99 + 88 + 7.6 ='</span>, r)</span><br><span class="line"><span class="comment"># 99 + 88 + 7.6 = 194.6</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> int(s)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> float(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">exp</span>):</span></span><br><span class="line">    ss = exp.split(<span class="string">'+'</span>)</span><br><span class="line">    ns = map(str2num, ss)</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> acc, x: acc + x, ns)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    r = calc(<span class="string">'100 + 200 + 345'</span>)</span><br><span class="line">    print(<span class="string">'100 + 200 + 345 ='</span>, r)</span><br><span class="line">    r = calc(<span class="string">'99 + 88 + 7.6'</span>)</span><br><span class="line">    print(<span class="string">'99 + 88 + 7.6 ='</span>, r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/qie-pian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/qie-pian/" class="post-title-link" itemprop="url">python 切片</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-23 09:11:29" itemprop="dateModified" datetime="2021-04-23T09:11:29Z">2021-04-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>切片 冒号适用于列表、字符串<br>切片[][1:3]还是list<br>[起始位置，长度]；<br>截取从起始位置，长度个字符；<br>长度负数表示删除从字符串末尾往前数的字符个数；<br>长度省略表示到末尾； 长度要是超过可截取的位数，以可截取的位数为标准；<br>单一的字符串索引操作得到的是字符串，<br>但是一个列表的切片操作得到的是一个列表</p>
<p>a=range（100）<br>range(start, end, step)，start：起始值；end：终值；step：步长，默认为1。<br>a：0、1、2、3、4、5、……99。<br>所以，<br>正索引范围为：a[0] -a[end-1]，<br>即 a[0] = 0，a[1] = 1，……，依次类推；<br>负索引范围为：a[-1] -a[-end]，<br>即 a[-1] = 99，a[-2] = 98，……，依次类推。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">a = range(<span class="number">100</span>)</span><br><span class="line">print(a[<span class="number">-3</span>])  <span class="comment"># 97 a[-3]倒数第三个数</span></span><br><span class="line">print(a[<span class="number">2</span> - <span class="number">3</span>])  <span class="comment"># 倒数第一个数 99</span></span><br><span class="line">print(a[<span class="number">-1</span>])  <span class="comment"># 倒数第一个数 99</span></span><br><span class="line">print(a[::<span class="number">3</span>])  <span class="comment"># range(0, 100, 3) start0 end99 step3 依次是0 3 6 9一直到99 步长为3</span></span><br><span class="line">print(a[<span class="number">2</span>:<span class="number">13</span>])  <span class="comment"># range(2, 13) 从a[2]到a[12] 不包括13，前闭后开</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment"># 有1位</span></span><br><span class="line">print(a[<span class="number">-1</span>])  <span class="comment"># 5 读取倒数第一个元素</span></span><br><span class="line"><span class="comment"># 有2位</span></span><br><span class="line">print(a[:<span class="number">1</span>])  <span class="comment"># [0] </span></span><br><span class="line">print(a[<span class="number">-1</span>:])  <span class="comment"># [5]</span></span><br><span class="line">print(a[<span class="number">-3</span>:])  <span class="comment"># [3, 4, 5]</span></span><br><span class="line">print(a[<span class="number">-3</span>:<span class="number">-1</span>])  <span class="comment"># [3, 4]</span></span><br><span class="line">print(a[:<span class="number">-1</span>])  <span class="comment"># [0, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment"># 有第三位，正号从左到右，符号从右到左，绝对值是跳的间隔</span></span><br><span class="line">print(a[::<span class="number">2</span>])  <span class="comment"># [0, 2, 4]</span></span><br><span class="line">print(a[::<span class="number">-1</span>])  <span class="comment"># [5, 4, 3, 2, 1, 0]</span></span><br><span class="line">print(a[:<span class="number">3</span>:<span class="number">-1</span>])  <span class="comment"># [5, 4]</span></span><br><span class="line">print(a[<span class="number">3</span>::<span class="number">-1</span>])  <span class="comment"># [3, 2, 1, 0] 从下标为3（从0开始）的元素开始翻转读取</span></span><br><span class="line">print(a[<span class="number">3</span>:<span class="number">1</span>:<span class="number">-1</span>])  <span class="comment"># [3, 2]</span></span><br><span class="line">print(a[<span class="number">3</span>:<span class="number">1</span>:<span class="number">-2</span>])  <span class="comment"># [3]</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">'123.456'</span></span><br><span class="line"><span class="comment"># print(s[4:0:-1])</span></span><br><span class="line"><span class="comment"># print(s[5:0:-1])</span></span><br><span class="line"><span class="comment"># print(s[:1:-1])</span></span><br><span class="line">print(s[:<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">print(s[:<span class="number">3</span>:<span class="number">-1</span>])</span><br><span class="line">print(s[:<span class="number">4</span>:<span class="number">-1</span>])</span><br><span class="line">print(s[:<span class="number">5</span>:<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output = [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">          [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],</span><br><span class="line">          [<span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>]]</span><br><span class="line">print(output[<span class="number">-1</span>])  * [<span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">s=<span class="string">'123.456'</span></span><br><span class="line">print(s[:<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line"><span class="number">654.</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lie-biao-tui-dao-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lie-biao-tui-dao-shi/" class="post-title-link" itemprop="url">列表推导式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-09 17:13:41" itemprop="dateModified" datetime="2021-05-09T17:13:41Z">2021-05-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="列表-元组-字典-推导式-Comprehension"><a href="#列表-元组-字典-推导式-Comprehension" class="headerlink" title="列表/元组/字典 推导式 Comprehension"></a>列表/元组/字典 推导式 Comprehension</h3><ul>
<li>一种快速生成list/dict/set的方式。 用来替代<code>map</code>/<code>filter</code><br>提供了从序列创建列表的简单途径。<br>通常应用程序将一些操作应用于某个序列的每个元素，<br>用其获得的结果作为生成新列表的元素，<br>或者根据确定的判定条件创建子序列。</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[操作 <span class="keyword">for</span> 语句 <span class="keyword">if</span> 语句]</span><br><span class="line">{操作 <span class="keyword">for</span> 语句 <span class="keyword">if</span> 语句}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将两个列表合为字典</span></span><br><span class="line">a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一：普通方法</span></span><br><span class="line">d = {}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">    d[a[i]] = b[i]</span><br><span class="line">print(d)  <span class="comment"># {'a': 4, 'b': 5, 'c': 6}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二：普通方法</span></span><br><span class="line">d1 = {}</span><br><span class="line"><span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(a):</span><br><span class="line">    d1[x] = b[i]</span><br><span class="line">print(d1)  <span class="comment"># {'a': 4, 'b': 5, 'c': 6}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法三：使用字典推导</span></span><br><span class="line"><span class="comment"># 使用zip函数成对迭代a和b</span></span><br><span class="line">d = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> zip(a, b)}</span><br><span class="line">print(d)  <span class="comment"># {'a': 4, 'b': 5, 'c': 6}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="集合的推导式"><a href="#集合的推导式" class="headerlink" title="集合的推导式"></a>集合的推导式</h3><p>打印结果无序,因为集合是无序的</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">list1 = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>}</span><br><span class="line">list4 = {i * i <span class="keyword">for</span> i <span class="keyword">in</span> list1}</span><br><span class="line">print(list4)  <span class="comment"># {16, 1, 4, 9}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="元组生成器推导式"><a href="#元组生成器推导式" class="headerlink" title="元组生成器推导式"></a>元组生成器推导式</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">t1 = (i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>))</span><br><span class="line">print(t1, type(t1))</span><br><span class="line"><span class="comment"># &lt;generator object &lt;genexpr&gt; at 0x00000258601963C0&gt; &lt;class 'generator'&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t1:</span><br><span class="line">    print(i)</span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">dp = [<span class="number">0</span> <span class="keyword">for</span> item <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">print(dp)  <span class="comment"># [0, 0, 0]</span></span><br><span class="line"></span><br><span class="line">dp = [<span class="number">1</span> <span class="keyword">for</span> item <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">print(dp)  <span class="comment"># [1, 1, 1]</span></span><br><span class="line"></span><br><span class="line">dp = [<span class="number">2</span> <span class="keyword">for</span> item <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">print(dp)  <span class="comment"># [2, 2, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历list/tuple/set</span></span><br><span class="line">s = [x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">5</span>)]  <span class="comment"># list</span></span><br><span class="line">print(s)  <span class="comment"># [0, 1, 2, 3, 4] 存储在列表</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">    print(x)</span><br><span class="line"><span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表中每个数值乘三，获得一个新的列表：</span></span><br><span class="line">print([<span class="number">3</span> * x <span class="keyword">for</span> x <span class="keyword">in</span> s])  <span class="comment"># [0, 3, 6, 9, 12]</span></span><br><span class="line">print([[x, x ** <span class="number">2</span>] <span class="keyword">for</span> x <span class="keyword">in</span> s])</span><br><span class="line"><span class="comment"># [[0, 0], [1, 1], [2, 4], [3, 9], [4, 16]]</span></span><br><span class="line"></span><br><span class="line">print([<span class="number">3</span> * x <span class="keyword">for</span> x <span class="keyword">in</span> s <span class="keyword">if</span> x &gt; <span class="number">3</span>])</span><br><span class="line"><span class="comment"># [12]</span></span><br><span class="line">print([<span class="number">3</span> * x <span class="keyword">for</span> x <span class="keyword">in</span> s <span class="keyword">if</span> x &lt; <span class="number">2</span>])</span><br><span class="line"><span class="comment"># [0, 3]</span></span><br><span class="line"></span><br><span class="line">vec1 = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line">vec2 = [<span class="number">4</span>, <span class="number">3</span>, <span class="number">-9</span>]</span><br><span class="line">print([x * y <span class="keyword">for</span> x <span class="keyword">in</span> vec1 <span class="keyword">for</span> y <span class="keyword">in</span> vec2])</span><br><span class="line"><span class="comment"># [8, 6, -18, 16, 12, -36, 24, 18, -54]</span></span><br><span class="line">print([x + y <span class="keyword">for</span> x <span class="keyword">in</span> vec1 <span class="keyword">for</span> y <span class="keyword">in</span> vec2])</span><br><span class="line"><span class="comment"># [6, 5, -7, 8, 7, -5, 10, 9, -3]</span></span><br><span class="line">print([vec1[i] * vec2[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(vec1))])</span><br><span class="line"><span class="comment"># [8, 12, -54]</span></span><br></pre></td></tr></tbody></table></figure>

<p>把要生成的元素放到前面，<br>然后有零到多个 for 或 if 子句，<br>在一个列表生成式中，<br>for前面的if … else是表达式，<br>而for后面的if是过滤筛选条件，不能在最后的if加上else：<br>返回结果是一个根据表达从其后的 for 和 if 上下文环境中生成出来的列表。<br>如果希望表达式推导出一个元组，就必须使用括号。</p>
<p>if写在for前面必须加else，否则报错：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    [x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">                       ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></tbody></table></figure>


<p>因为for前面的部分是一个表达式，它必须根据x计算出一个结果。<br>因此，考察表达式：x if x % 2 == 0，<br>它无法根据x计算出结果，因为缺少else，必须加上else：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> -x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">[<span class="number">-1</span>, <span class="number">2</span>, <span class="number">-3</span>, <span class="number">4</span>, <span class="number">-5</span>, <span class="number">6</span>, <span class="number">-7</span>, <span class="number">8</span>, <span class="number">-9</span>, <span class="number">10</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>for前面的表达式<code>x if x % 2 == 0 else -x</code> 才能根据x计算出确定的结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">print(list(range(<span class="number">5</span>)))</span><br><span class="line">print(list(range(<span class="number">0</span>, <span class="number">5</span>)))</span><br><span class="line">print(list(range(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>)))</span><br><span class="line">print(list(range(<span class="number">10</span>, <span class="number">0</span>, <span class="number">-2</span>)))</span><br><span class="line"></span><br><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">    L.append(x * x)</span><br><span class="line">print(L)</span><br><span class="line"></span><br><span class="line">print([x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)])</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">print([x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>])  <span class="comment"># 筛选出仅偶数的平方</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两层循环，可以生成全排列</span></span><br><span class="line">print([m + n <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">'ABC'</span> <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">'XYZ'</span>])  </span><br><span class="line"><span class="comment"># AX', 'AY', 'AZ', 'BX', 'BY', 'BZ', 'CX', 'CY', 'CZ']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后把一个list中所有的字符串变成小写：</span></span><br><span class="line">L = [<span class="string">'Hello'</span>, <span class="string">'World'</span>, <span class="number">18</span>, <span class="string">'Apple'</span>, <span class="literal">None</span>]</span><br><span class="line">L2=[s.lower() <span class="keyword">for</span> s <span class="keyword">in</span> L <span class="keyword">if</span> isinstance(s,str)]</span><br><span class="line">print(L2)</span><br><span class="line"><span class="comment"># ['hello', 'world', 'apple']:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对序列里每一个元素逐个调用某方法：</span></span><br><span class="line"></span><br><span class="line">freshfruit = [<span class="string">'  banana'</span>, <span class="string">'  loganberry '</span>, <span class="string">'passion fruit  '</span>]</span><br><span class="line">print([weapon.strip() <span class="keyword">for</span> weapon <span class="keyword">in</span> freshfruit])</span><br><span class="line"><span class="comment"># ['banana', 'loganberry', 'passion fruit']</span></span><br><span class="line"></span><br><span class="line">print([str(round(<span class="number">355</span> / <span class="number">113</span>, i)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>)])</span><br><span class="line"><span class="comment"># ['3.1', '3.14', '3.142', '3.1416', '3.14159']</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表生成式也可以使用两个变量来生成list：</span></span><br><span class="line">d = {<span class="string">'x'</span>: <span class="string">'A'</span>, <span class="string">'y'</span>: <span class="string">'B'</span>, <span class="string">'z'</span>: <span class="string">'C'</span> }</span><br><span class="line">print([k + <span class="string">'='</span> + v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items()])</span><br><span class="line"><span class="comment"># ['y=B', 'x=A', 'z=C']</span></span><br></pre></td></tr></tbody></table></figure>


<h3 id="字典的推导式"><a href="#字典的推导式" class="headerlink" title="字典的推导式"></a>字典的推导式</h3><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dict1 = {<span class="string">"key1"</span>: <span class="string">"value1"</span>, <span class="string">"key2"</span>: <span class="string">"value2"</span>}</span><br><span class="line"></span><br><span class="line">keys = [key <span class="keyword">for</span> key, value <span class="keyword">in</span> dict1.items()]</span><br><span class="line">print(keys)  <span class="comment"># ['key1', 'key2']</span></span><br><span class="line"></span><br><span class="line">key_value = {key: value <span class="keyword">for</span> key, value <span class="keyword">in</span> dict1.items()}</span><br><span class="line">print(key_value)  <span class="comment"># {'key1': 'value1', 'key2': 'value2'}</span></span><br><span class="line"></span><br><span class="line">value_key = {value: key <span class="keyword">for</span> key, value <span class="keyword">in</span> dict1.items()}</span><br><span class="line">print(value_key)  <span class="comment"># {'value1': 'key1', 'value2': 'key2'}</span></span><br><span class="line"></span><br><span class="line">key_value_if = {key: value <span class="keyword">for</span> key, value <span class="keyword">in</span> dict1.items() <span class="keyword">if</span> key == <span class="string">"key1"</span>}</span><br><span class="line">print(key_value_if)  <span class="comment"># {'key1': 'value1'}</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/chuang-jian-xing-mo-shi-zhi-dan-li-mo-shi-yu-yuan-xing-mo-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/chuang-jian-xing-mo-shi-zhi-dan-li-mo-shi-yu-yuan-xing-mo-shi/" class="post-title-link" itemprop="url">创建型模式之单例模式与原型模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-10 16:12:36" itemprop="dateModified" datetime="2021-05-10T16:12:36Z">2021-05-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><p>单例模式的实现有多种方式</p>
<ul>
<li>一个类创建出来的对象都是同一个</li>
<li>Python的模块其实就是单例的，只会导入一次，如：在模块里定义的全局变量其实就是单例的</li>
<li>使用共享同一个实例的方式来创建单例模式</li>
</ul>
<ol>
<li>使用__new__方法实现<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用__new__方法，通过共享实例方式创建单例模式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>:</span>  <span class="comment"># 单例的类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span>    <span class="comment"># __new__方法是用来创建实例</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">'_instance'</span>):  <span class="comment"># '_instance'表示所有的共享实例，如果没有该属性就创建一个</span></span><br><span class="line">            _instance = super().__new__(cls, *args, **kwargs)</span><br><span class="line">            cls._instance = _instance  <span class="comment"># 赋值给当前的类</span></span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params">Singleton</span>):</span>   <span class="comment"># 继承单例类</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 创建两个实例，通过比较ID是否一样来判断是不是同一个实例</span></span><br><span class="line">c1 = MyClass()</span><br><span class="line">c2 = MyClass()</span><br><span class="line">print(c1 <span class="keyword">is</span> c2)   <span class="comment"># 输出为True，单例的，c1 c2同一个实例</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>这样每次去创建一个新的实例的时候，就会使用 _instance 来共享实例。
</code></pre>
</li>
</ol>
<p>（1） <strong>new</strong> 和 <strong>init</strong> 的区别</p>
<p>① <strong>new</strong> 是一个静态方法，而 <strong>init</strong> 是实例方法 。</p>
<p>② <strong>new</strong> 方法会返回一个创建的实例，而<strong>init</strong> 什么都不返回 。</p>
<p>③ 只有在<strong>new</strong> 返回一个cls的实例时，才会调用 __init__进行初始化实例 。</p>
<p>④ 当创建一个新实例时调用 <strong>new__，初始化一个实例时用 __init</strong> 。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">cls, name, bases, dict</span>):</span></span><br><span class="line">        super(Singleton, cls).__init__(name, bases, dict)</span><br><span class="line">        cls._instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kw</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls.instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls.instance = super(Singleton, cls).__call__(*args, **kw)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MyClass</span>(<span class="params">object</span>):</span></span><br><span class="line">    __metaclass__ ＝ Singleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    s1 = MyClass()</span><br><span class="line">    s2 = MyClass()</span><br><span class="line">    print(s1)</span><br><span class="line">    print(s2)</span><br></pre></td></tr></tbody></table></figure>



<ol start="2">
<li>使用装饰器实现<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, func</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            res = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_instance'</span>):</span><br><span class="line">            self._instance = super().__new__(self, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> self._instance</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Singleton()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MyClass</span>():</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    s1 = MyClass()</span><br><span class="line">    s2 = MyClass()</span><br><span class="line">    print(id(s1), id(s2))</span><br><span class="line">    print(s1 <span class="keyword">is</span> s2)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Singleton</span>(<span class="params">cls</span>):</span></span><br><span class="line">    _instance={}</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_singleton</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> _instance:</span><br><span class="line">            _instance[cls]= cls(*args,**kwargs)</span><br><span class="line">        <span class="keyword">return</span> _instance[cls]</span><br><span class="line">    <span class="keyword">return</span> _singleton</span><br></pre></td></tr></tbody></table></figure>



<p>使用Python实现单例模式</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params">object</span>):</span></span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">            cls._instance = super(Singleton, cls).__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br></pre></td></tr></tbody></table></figure>



<h3 id="原型模式-Prototype"><a href="#原型模式-Prototype" class="headerlink" title="原型模式(Prototype)"></a>原型模式(Prototype)</h3><ul>
<li><p>通过克隆原型来创建新的实例</p>
</li>
<li><p>可以使用相同的原型，通过修改部分属性来创建新的实例</p>
</li>
<li><p>用途：对于一些创建实例开销比较高的地方可以用原型模式</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, func</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            res = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, func</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            res = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_instance'</span>):</span><br><span class="line">            self._instance = super().__new__(self, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> self._instance</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Singleton()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MyClass</span>():</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    s1 = MyClass()</span><br><span class="line">    s2 = MyClass()</span><br><span class="line">    print(id(s1), id(s2))</span><br><span class="line">    print(s1 <span class="keyword">is</span> s2)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/jia-mi-fang-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/jia-mi-fang-shi/" class="post-title-link" itemprop="url">加密方式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-09 12:14:59" itemprop="dateModified" datetime="2021-04-09T12:14:59Z">2021-04-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>加解密算法，是对源数据 进行运算产生加密数据，以及反向过程，对加密数据反算出 源数据。</p>
<p>加解密算法 和 hash算法 不同点有：</p>
<ul>
<li>加解密算法 是可逆的，hash算法是不可逆的。</li>
<li>hash算法可以对很大的数据产生比较小的哈希值，而加密算法源数据很大，加密后的数据也会很大</li>
</ul>
<p>加密方式</p>
<ul>
<li>对称加密：加密和解密的密钥是相同的，速度快，一般对文件，AES, RC4, DES, 3DES, IDEA </li>
<li>非对称加密：公钥加密——私钥解密，私钥加密——公钥解密，强度高速度慢，互联网 RSA (Rivest–Shamir–Adleman)  DSA ECC<br>证书密钥加密</li>
</ul>
<p><code>pip install cryptography</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生密钥， 密钥是加密解密必须的</span></span><br><span class="line">key = Fernet.generate_key()</span><br><span class="line">f = Fernet(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">src = <span class="string">"白月黑羽网站学习Python真好啊"</span></span><br><span class="line"><span class="comment"># 源信息，必须是字节串对象</span></span><br><span class="line"><span class="comment"># 字符串对象需要encode一下</span></span><br><span class="line">srcBytes = src.encode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成加密字节串</span></span><br><span class="line">token = f.encrypt(srcBytes)</span><br><span class="line">print(token)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密，返回值是字节串对象</span></span><br><span class="line">sb = f.decrypt(token)</span><br><span class="line">print(sb.decode())</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/zhan-wei-ge-shi-hua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/zhan-wei-ge-shi-hua/" class="post-title-link" itemprop="url">占位格式化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-13 09:44:53" itemprop="dateModified" datetime="2021-05-13T09:44:53Z">2021-05-13</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>format(value[, format_spec])</code><br>将 value 转换为 format_spec 控制的“格式化”表示。<br>format_spec 的解释取决于 value 实参的类型，但是大多数内置类型使用标准格式化语法：格式规格迷你语言。</p>
<p>默认的 format_spec 是一个空字符串，它通常和调用 str(value) 的结果相同。</p>
<p>调用 format(value, format_spec) 会转换成 type(value).<strong>format</strong>(value, format_spec) ，所以实例字典中的 <strong>format</strong>() 方法将不会调用。如果搜索到 object 有这个方法但 format_spec 不为空，format_spec 或返回值不是字符串，会触发 TypeError 异常。</p>
<p>在 3.4 版更改: 当 format_spec 不是空字符串时， object().<strong>format</strong>(format_spec) 会触发 TypeError。</p>
<p><code>%</code>符号，格式化的输出，当变量是哪种类型，那么%后面接的类型也是哪一种。</p>
<p>占位符，表示这个位置先占着，待会儿要有数据填入到这里。</p>
<h3 id="s和-是一种格式化符号、占位符"><a href="#s和-是一种格式化符号、占位符" class="headerlink" title="%s和 {} 是一种格式化符号、占位符"></a><code>%s</code>和 <code>{}</code> 是一种格式化符号、占位符</h3><p>Python 解释器 看到 <code>%s</code> ，就会调用内置函数 <code>str()</code>，<br>并将对应的 格式化对象 作为 参数传入，返回的结果字符串填入对应占位符。<br>%s 位置填入的结果，就是调用str函数的返回值。<br>对应的格式化对象，不仅仅是字符串，还可以是整数、浮点数、列表、元组 等</p>
<p><code>str()</code>将指定的对象转换成字符串形式，<br>参数 可以是任何类型的对象，字符串、整数、浮点数、列表、元组等。<br>可以指定编码。<br><code>str(123)='123'</code> 表示格化式一个对象为字符</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">'我会唱跳rap'</span></span><br><span class="line">str2 = <span class="string">'打篮球'</span></span><br><span class="line"><span class="comment"># 拼接成一个字符串</span></span><br><span class="line">print(str1 + str2)</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br><span class="line">print(<span class="string">'%s%s'</span> % (str1, str2))</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br><span class="line">print(<span class="string">'{}{}'</span>.format(str1, str2))</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{str1}</span><span class="subst">{str2}</span>'</span>)</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br></pre></td></tr></tbody></table></figure>

<p>格式化字符串里面占位符的个数 必须 和 后面对应的格式化对象个数相同</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">id = <span class="number">123</span></span><br><span class="line">name = <span class="string">'Xiaoming'</span></span><br><span class="line">hegiht = <span class="number">1.7</span></span><br><span class="line">print(<span class="string">'User[%s]: %s %sm '</span> % (id, name, hegiht))</span><br><span class="line"><span class="comment"># User[123]: Xiaoming 1.7m</span></span><br><span class="line">print(<span class="string">'User[%(id)s]: %(name)s %(height)sm'</span> % {</span><br><span class="line">    <span class="string">'id'</span>: <span class="number">123</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Xiaoming'</span>,</span><br><span class="line">    <span class="string">'height'</span>: <span class="number">1.7</span></span><br><span class="line">})</span><br><span class="line"><span class="comment"># User[123]: Xiaoming 1.7m</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">"hello"</span></span><br><span class="line">print(<span class="string">"string=%s!"</span> % (string, ))  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有一个格式化对象的情况下，可以直接就用格式化对象，不需要放到元组里面</span></span><br><span class="line">print(<span class="string">"string=%s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#%2s意思是字符串长度为2，当原字符串的长度超过2时，按原长度打印</span></span><br><span class="line">print(<span class="string">"string=%2s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %7s意思是字符串长度为7，当原字符串的长度小于7时，在原字符串左侧补空格，右边对齐</span></span><br><span class="line">print(<span class="string">"string=%7s!"</span> % string)  <span class="comment"># string=  hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %-7s意思是字符串长度为7，当原字符串的长度小于7时，在原字符串右侧补空格，左边对齐</span></span><br><span class="line">print(<span class="string">"string=%-7s!"</span> % string)  <span class="comment"># string=hello  !</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.2s意思是截取字符串的前2个字符</span></span><br><span class="line">print(<span class="string">"string=%.2s!"</span> % string)  <span class="comment"># string=he!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.7s意思是截取字符串的前7个字符，当原字符串长度小于7时，即是字符串本身</span></span><br><span class="line"><span class="comment"># 所以%.7s的打印结果是hello</span></span><br><span class="line">print(<span class="string">"string=%.7s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %a.bs这种格式是上面两种格式的综合，首先根据小数点后面的数b截取字符串，</span></span><br><span class="line"><span class="comment"># 当截取的字符串长度小于a时，还需要在其左侧补空格</span></span><br><span class="line">print(<span class="string">"string=%7.2s!"</span> % string)  <span class="comment"># string=     he!</span></span><br><span class="line">print(<span class="string">"string=%2.7s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line">print(<span class="string">"string=%10.7s!"</span> % string)  <span class="comment"># string=     hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用%*.*s来表示精度，两个*的值分别在后面小括号的前两位数值指定</span></span><br><span class="line">print(<span class="string">"string=%*.*s!"</span> % (<span class="number">7</span>, <span class="number">2</span>, string))  <span class="comment"># string=     he!</span></span><br></pre></td></tr></tbody></table></figure>


<p><code>%d</code> dec 十进制 用在 格式化对象 是 整数的情况<br><code>%o</code> —— oct 八进制<br><code>%x</code> —— hex 十六进制</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"num=%om"</span> % num)  <span class="comment"># num=16m</span></span><br><span class="line">print(<span class="string">"num=%xm"</span> % num)  <span class="comment"># num=em</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"num=%dm"</span> % num)  <span class="comment"># num=14m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %1d意思是打印结果为1位整数，当整数的位数超过1位时，按整数原值打印</span></span><br><span class="line">print(<span class="string">"num=%1dm"</span> % num)  <span class="comment"># num=14m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %3d意思是打印结果为3位整数，当整数的位数不够3位时，在整数左侧补空格</span></span><br><span class="line">print(<span class="string">"num=%3dm"</span> % num)  <span class="comment"># num= 14m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %-3d意思是打印结果为3位整数，当整数的位数不够3位时，在整数右侧补空格</span></span><br><span class="line">print(<span class="string">"num=%-3dm"</span> % num)  <span class="comment"># num=14 m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %03d意思是打印结果为3位整数，当整数的位数不够3位时，在整数左侧补0</span></span><br><span class="line">print(<span class="string">"num=%03dm"</span> % num)  <span class="comment"># num=014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.3d小数点后面的3意思是打印结果为3位整数，</span></span><br><span class="line"><span class="comment"># 当整数的位数不够3位时，在整数左侧补0</span></span><br><span class="line">print(<span class="string">"num=%.3dm"</span> % num)  <span class="comment"># num=014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.0003d小数点后面的0003和3一样，都表示3，意思是打印结果为3位整数，</span></span><br><span class="line"><span class="comment"># 当整数的位数不够3位时，在整数左侧补0</span></span><br><span class="line">print(<span class="string">"num=%.0003dm"</span> % num)  <span class="comment"># num=014m</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'---'</span>)</span><br><span class="line"><span class="comment"># %5.3d是两种补齐方式的综合，当整数的位数不够3时，先在左侧补0，</span></span><br><span class="line"><span class="comment"># 还是不够5位时，再在左侧补空格，</span></span><br><span class="line"><span class="comment"># 规则就是补0优先，最终的长度选数值较大的那个，所以%5.3d的打印结果还是  014</span></span><br><span class="line">print(<span class="string">"num=%5.3dm"</span> % num)  <span class="comment"># num=  014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %05.3d是两种补齐方式的综合，当整数的位数不够3时，先在左侧补0，还是不够5位时，</span></span><br><span class="line"><span class="comment"># 由于是05，再在左侧补0，最终的长度选数值较大的那个</span></span><br><span class="line">print(<span class="string">"num=%05.3dm"</span> % num)  <span class="comment"># num=00014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %*.*d来表示精度，两个*的值分别在后面小括号的前两位数值指定</span></span><br><span class="line"><span class="comment"># 不过这种方式5就失去补0的功能，只能补空格，只有小数点后面的3才能补0</span></span><br><span class="line">print(<span class="string">"num=%*.*dm"</span> % (<span class="number">5</span>, <span class="number">3</span>, num))  <span class="comment"># num=  014m</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>%f</code> 用在 格式化对象 是 浮点数的情况，保留小数点后6位数有效数字<br>指定宽度，而且希望不足宽度补零或者补空格</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># %f时表示原值，保留小数点后6位数有效数字</span></span><br><span class="line">print(<span class="string">"PI=%f"</span> % <span class="number">3.14</span>)  <span class="comment"># PI=3.140000</span></span><br><span class="line">print(<span class="string">"PI=%010f"</span> % <span class="number">3.14</span>)  <span class="comment"># PI=003.140000</span></span><br><span class="line">print(<span class="string">"PI=%f"</span> % math.pi)  <span class="comment"># PI=3.141593</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %a.bf，a表示浮点数的打印长度，b表示浮点数小数点后面的精度</span></span><br><span class="line"><span class="comment"># %9f时，表示打印长度9位数，小数点也占一位，不够左侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%9f"</span> % math.pi)  <span class="comment"># PI= 3.141593</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"PI=%09f"</span> % math.pi)  <span class="comment"># PI=03.141593</span></span><br><span class="line">print(<span class="string">"PI=%010f"</span> % math.pi)  <span class="comment"># PI=003.141593</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"PI=%03f"</span> % math.pi)  <span class="comment"># PI=3.141593</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有.没有后面的数字时，表示去掉小数输出整数，03表示不够3位数左侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%3.f"</span> % math.pi)  <span class="comment"># PI=  3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有.没有后面的数字时，表示去掉小数输出整数，03表示不够3位数左侧补0</span></span><br><span class="line">print(<span class="string">"PI=%03.f"</span> % math.pi)  <span class="comment"># PI=003</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.1f表示一个浮点数，小数点后保留1位有效数字</span></span><br><span class="line">print(<span class="string">"PI=%.1f"</span> % math.pi)  <span class="comment"># PI=3.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.3f表示一个浮点数，小数点后保留3位有效数字</span></span><br><span class="line">print(<span class="string">"PI=%.3f"</span> % math.pi)  <span class="comment"># PI=3.142</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"%.3f"</span> % <span class="number">123.45678</span>)  <span class="comment"># 123.457</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:.3f}'</span>.format(<span class="number">123.45678</span>))  <span class="comment"># 123.457 最后一个数字之所以是7，是因为format会对数据进行四舍五入</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %6.3f表示小数点后面精确到3位，总长度6位数，包括小数点，不够左侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%6.3f"</span> % math.pi)  <span class="comment"># PI= 3.142</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %-6.3f表示小数点后面精确到3位，总长度6位数，包括小数点，不够右侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%-6.3f"</span> % math.pi)  <span class="comment"># PI=3.142</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %*.*f来表示精度，两个*的值分别在后面小括号的前两位数值指定</span></span><br><span class="line"><span class="comment"># 如下，不过这种方式6就失去补0的功能，只能补空格</span></span><br><span class="line">print(<span class="string">"PI=%*.*f"</span> % (<span class="number">6</span>, <span class="number">3</span>, math.pi))  <span class="comment"># PI= 3.142</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="字符串内容里有花括号"><a href="#字符串内容里有花括号" class="headerlink" title="字符串内容里有花括号"></a>字符串内容里有花括号</h2><p>花括号{}内，限定的顺序不能搞错，<br>第一是元素序号，冒号之前的数字实际上是参数的序号，当format内只有一位元素需要输出时，这个序号可以省略<br>第二是冒号，<br>第三是特定填充符号 当输出的内容不足以占满宽度，没有的话默认填充空格<br>第四对齐方式，<br>第五宽度，<br>第六千分位分隔符号，<br>第七精度。</p>
<p>指定填入的字符串的宽度：在<code>{}</code>里面的变量后面加上 <code>:宽度值</code><br>对齐符号<code>&lt;</code>、<code>^</code>、<code>&gt;</code>来表示左对齐、居中对齐、右对齐。<br><code>=</code> （只用于数字）在小数点后进行补齐</p>
<h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><p>将根据*<em>顺序</em>对前面的花括号进行匹配输出。<br>花括号内也可以写上<strong>序号</strong>，对format中的内容进行匹配</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自然连接</span></span><br><span class="line">print(<span class="string">'We are the {} who say "{}!"'</span>.format(<span class="string">'knights'</span>, <span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定顺序连接</span></span><br><span class="line">print(<span class="string">'We are the {0} who say "{1}~{0}!"'</span>.format(<span class="string">'knights'</span>, <span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni~knights!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过类似字典的方式指定参数映射</span></span><br><span class="line">print(<span class="string">'We are the {people} who say "{hi}!"'</span>.format(people=<span class="string">'knights'</span>, hi=<span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni!"</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'We are the {0} who say "{hi}!"'</span>.format(<span class="string">'knights'</span>, hi=<span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni!"</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{2}, {1}, {0}'</span>.format(*<span class="string">'abc'</span>))</span><br><span class="line"><span class="comment"># c, b, a</span></span><br><span class="line"></span><br><span class="line">octets = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line">print(<span class="string">'{:02X}{:02X}{:02X}{:02X}'</span>.format(*octets))  <span class="comment"># 位置参数*args?</span></span><br><span class="line"><span class="comment"># 0A0B0C0D</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过下标匹配参数</span></span><br><span class="line">coord = [<span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord))</span><br><span class="line"><span class="comment"># X: 3;  Y: 5</span></span><br><span class="line"></span><br><span class="line">coord = (<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord))</span><br><span class="line"><span class="comment"># X: 3;  Y: 5</span></span><br><span class="line"></span><br><span class="line">coord = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord))</span><br><span class="line"><span class="comment"># X: [1, 2];  Y: [3, 4]</span></span><br><span class="line"></span><br><span class="line">coord1 = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">coord2 = [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord1, coord2))</span><br><span class="line"><span class="comment"># X: 1;  Y: 2</span></span><br><span class="line">print(<span class="string">'X: {1[0]};  Y: {1[1]}'</span>.format(coord1, coord2))</span><br><span class="line"><span class="comment"># X: 3;  Y: 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过key匹配参数</span></span><br><span class="line">person = {<span class="string">'name'</span>: <span class="string">'ashe'</span>, <span class="string">'age'</span>: <span class="number">25</span>}</span><br><span class="line"><span class="comment"># 中括号内的key是不用引号引起来的。如果改成{0[“name”]}就会报错。</span></span><br><span class="line">print(<span class="string">'name：{0[name]}, age：{0[age]}'</span>.format(person))</span><br><span class="line"><span class="comment"># name：ashe, age：25</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'name：{name}, age：{age}'</span>.format(**person))</span><br><span class="line"><span class="comment"># name：ashe, age：25</span></span><br><span class="line"></span><br><span class="line">person1 = {<span class="string">'name'</span>: <span class="string">'ashe'</span>}</span><br><span class="line">person2 = {<span class="string">'age'</span>: <span class="number">25</span>}</span><br><span class="line">print(<span class="string">'name：{0[name]}, age：{1[age]}'</span>.format(person1, person2))</span><br><span class="line"><span class="comment"># name：ashe, age：25</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'name：{:0^8}, age：{:*&gt;4}'</span>.format(<span class="string">'ashe'</span>, <span class="number">25</span>))</span><br><span class="line"><span class="comment"># name：000ashe000, age：**25</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 千位分隔符</span></span><br><span class="line">print(<span class="string">'{:,}'</span>.format(<span class="number">1234567890</span>))  <span class="comment"># 1,234,567,890</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{0:*^20,.3f}  {1:*&gt;20,.3f}   {1:-^15}'</span>.format(<span class="number">12345.6789</span>, <span class="number">5647854.12452</span>,</span><br><span class="line">                                                     <span class="string">'hello'</span>))</span><br><span class="line"><span class="comment"># *****12,345.679*****  *******5,647,854.125   -5647854.12452-</span></span><br></pre></td></tr></tbody></table></figure>

<p>字符串默认左对齐</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var = <span class="string">'34324'</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">'对**字符串**不足指定宽度的时候补空格'</span>)</span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324    # 字符串默认左对齐</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment">#    34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>, <span class="string">"len ="</span>, len(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>))</span><br><span class="line"><span class="comment">#       34324 len = 11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print('对**数字**不足指定宽度的时候补数字0')</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># ValueError: '=' alignment not allowed in string format specifier</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324000</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 00034324</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(f'{var:.1f}')</span></span><br><span class="line"><span class="comment"># ValueError: Unknown format code 'f' for object of type 'str'</span></span><br></pre></td></tr></tbody></table></figure>

<p>数字默认右对齐</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">var = <span class="number">34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">'对**数字**不足指定宽度的时候补空格'</span>)</span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment">#    34324 数字默认右对齐</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment">#    34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>, <span class="string">"len ="</span>, len(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>))</span><br><span class="line"><span class="comment">#       34324 len = 11</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'对**数字**不足指定宽度的时候补数字0'</span>)</span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 00034324 数字指定长度能08</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324000</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 00034324</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">.1</span>f}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324.0</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">8.1</span>f}</span>'</span>)</span><br><span class="line"><span class="comment">#  34324.0</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{} is {:.2f}'</span>.format(<span class="number">1.123</span>, <span class="number">1.123</span>))  <span class="comment"># 取2位小数</span></span><br><span class="line"><span class="comment"># 1.123 is 1.12</span></span><br><span class="line">print(<span class="string">'{0} is {0:&gt;10.2f}'</span>.format(<span class="number">1.123</span>))  <span class="comment"># 取2位小数，右对齐，取10位</span></span><br><span class="line"><span class="comment"># 1.123 is       1.12</span></span><br><span class="line">print(<span class="string">'{} is {:&gt;10.2f}'</span>.format(<span class="number">1.123</span>))  <span class="comment"># IndexError: Replacement index 1 out of range for positional args tuple</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:0=30}'</span>.format(<span class="number">11</span>))  <span class="comment"># 还有“=”只能应用于数字，这种方法可用“&gt;”代替</span></span><br><span class="line"><span class="comment"># '000000000000000000000000000011'</span></span><br></pre></td></tr></tbody></table></figure>

<p>进制数输出<br><code>b</code>、<code>d</code>、<code>o</code>、<code>x</code>分别是二进制、十进制、八进制、十六进制</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'{:b}'</span>.format(<span class="number">10</span>))  <span class="comment"># 1010</span></span><br><span class="line">print(<span class="string">'{0:b}'</span>.format(<span class="number">10</span>))  <span class="comment"># 1010</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:d}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 X 表示格式化为16进制，并采用小写格式</span></span><br><span class="line">print(<span class="string">f'数字12的16进制表示为：<span class="subst">{<span class="number">12</span>:x}</span>'</span>)</span><br><span class="line"><span class="comment"># 数字12的16进制表示为：c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 X 表示格式化为16进制，并采用大写格式</span></span><br><span class="line">print(<span class="string">f'数字12的16进制表示为：<span class="subst">{<span class="number">12</span>:X}</span>'</span>)</span><br><span class="line"><span class="comment"># 数字12的16进制表示为：C</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"bin: {0:b}; int: {0:d}; oct: {0:o}; hex: {0:x}; "</span>.format(<span class="number">12</span>))</span><br><span class="line"><span class="comment"># bin: 1100; int: 12;  oct: 14; hex: c;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># with 0x, 0o, or 0b as prefix:</span></span><br><span class="line">print(<span class="string">"bin: {0:#b}; int: {0:d};  oct: {0:#o};  hex: {0:#x}"</span>.format(</span><br><span class="line">    <span class="number">12</span>))  <span class="comment"># 在前面加“#”，则带进制前缀</span></span><br><span class="line"><span class="comment"># bin: 0b1100; int: 12;  oct: 0o14;  hex: 0xc</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="f-quot-string-quot-格式化"><a href="#f-quot-string-quot-格式化" class="headerlink" title="f&quot;string&quot; 格式化"></a><code>f"string"</code> 格式化</h3><p>在字符串模板前面加上f，然后占位符使用{}，里面直接放入对应的数据对象。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">salary = input(<span class="string">'请输入薪资：'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算出缴税额，存入变量tax</span></span><br><span class="line">tax = int(salary) * <span class="number">25</span> / <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算出税后工资，存入变量aftertax</span></span><br><span class="line">aftertax = int(salary) * <span class="number">75</span> / <span class="number">100</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'税前薪资是：<span class="subst">{salary}</span>元， 缴税：<span class="subst">{tax}</span>元， 税后薪资是：<span class="subst">{aftertax}</span>元'</span>)</span><br><span class="line"><span class="comment"># 请输入薪资：10000</span></span><br><span class="line"><span class="comment"># 税前薪资是：10000元， 缴税：2500.0元， </span></span><br><span class="line"><span class="comment"># 税后薪资是：7500.0元</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">salary = <span class="number">10000</span></span><br><span class="line">tax = int(salary) * <span class="number">25</span> / <span class="number">100</span></span><br><span class="line">aftertax = int(salary) * <span class="number">75</span> / <span class="number">100</span></span><br><span class="line">print(<span class="string">f'税前薪资是：<span class="subst">{salary:<span class="number">8</span>}</span>元， 缴税：<span class="subst">{tax:<span class="number">8</span>}</span>元， 税后薪资是：<span class="subst">{aftertax:<span class="number">8</span>}</span>元'</span>)</span><br><span class="line"><span class="comment"># 税前薪资是：   10000元， 缴税：  2500.0元， 税后薪资是：  7500.0元</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcTax</span>(<span class="params">salary</span>):</span></span><br><span class="line">    tax = int(salary) * <span class="number">25</span> / <span class="number">100</span></span><br><span class="line">    aftertax = int(salary) * <span class="number">75</span> / <span class="number">100</span></span><br><span class="line">    print(<span class="string">f'税前薪资是：<span class="subst">{salary:&lt;<span class="number">8</span>}</span>元， 缴税：<span class="subst">{tax:&lt;<span class="number">8</span>}</span>元， 税后薪资是：<span class="subst">{aftertax:&lt;<span class="number">8</span>}</span>元'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">calcTax(<span class="number">10000</span>)</span><br><span class="line"><span class="comment"># 税前薪资是：10000   元， 缴税：2500.0  元， 税后薪资是 ：7500.0  元</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># .3f就表示小数点后面保留1位</span></span><br><span class="line">print(<span class="string">"%.3f"</span> % <span class="number">123.45678</span>)  <span class="comment"># 123.457</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:.3f}'</span>.format(<span class="number">123.45678</span>))  <span class="comment"># 123.457</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'The value of pi is approximately <span class="subst">{math.pi:<span class="number">.3</span>f}</span>.'</span>)</span><br><span class="line"><span class="comment"># The value of pi is approximately 3.142.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'The value of pi is approximately <span class="subst">{math.pi:<span class="number">2.3</span>f}</span>.'</span>)</span><br><span class="line"><span class="comment"># The value of pi is approximately 3.142.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'The value of pi is approximately <span class="subst">{math.pi:<span class="number">6.3</span>f}</span>.'</span>)</span><br><span class="line"><span class="comment"># The value of pi is approximately  3.142.</span></span><br></pre></td></tr></tbody></table></figure>


<p>采用 f-string 方式格式化的 字符串内容本身就有 <code>{</code> 或者 <code>}</code> 符号，<br>一定要 双写 进行转义，否则会被当成是 格式化占位符。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">times1 = <span class="number">1000</span></span><br><span class="line">times2 = <span class="number">2000</span></span><br><span class="line">print(<span class="string">f'文章中 {{ 符号 出现了 <span class="subst">{times1}</span> 次'</span>)</span><br><span class="line"><span class="comment"># 文章中 { 符号 出现了 1000 次</span></span><br><span class="line">print(<span class="string">f'文章中 }} 符号 出现了 <span class="subst">{times2}</span> 次'</span>)</span><br><span class="line"><span class="comment"># 文章中 } 符号 出现了 2000 次</span></span><br></pre></td></tr></tbody></table></figure>

<p>replacement_field ::= “{“ [field_name] [“!” conversion] [“:” format_spec] “}”<br>conversion ::= “r” | “s” | “a”<br>这里只有三个转换符号，用”!”开头。<br><code>!r</code>对应 <code>repr()</code>；<code>!s</code>对应 <code>str()</code>; <code>!a</code>对应<code>ascii()</code>。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">animals = <span class="string">'eels'</span></span><br><span class="line">print(<span class="string">f'My hovercraft is full of <span class="subst">{animals}</span>.'</span>)</span><br><span class="line"><span class="comment"># My hovercraft is full of eels.</span></span><br><span class="line">print(<span class="string">f'My hovercraft is full of <span class="subst">{animals!r}</span>.'</span>)</span><br><span class="line"><span class="comment"># My hovercraft is full of 'eels'.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"repr() shows quotes: {!r}; str() doesn't: {!s}"</span>.format(<span class="string">'test1'</span>, <span class="string">'test2'</span>))</span><br><span class="line"><span class="comment"># "repr() shows quotes: 'test1'; str() doesn't: test2"  # 输出结果是一个带引号，一个不带</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">salary = <span class="number">10000</span></span><br><span class="line"><span class="comment"># 指定了 宽度为10 个字符， 如果填入的字符串不足10个字符，就在前面加上空格，右边对齐</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{salary:<span class="number">10</span>}</span>'</span>)  <span class="comment">#      10000 </span></span><br><span class="line"></span><br><span class="line">table = {<span class="string">'Sjoerd'</span>: <span class="number">4127</span>, <span class="string">'Jack'</span>: <span class="number">4098</span>, <span class="string">'Dcab'</span>: <span class="number">7678</span>}</span><br><span class="line"><span class="keyword">for</span> name, phone <span class="keyword">in</span> table.items():</span><br><span class="line">    print(<span class="string">f'<span class="subst">{name:<span class="number">10</span>}</span> ==&gt; <span class="subst">{phone:<span class="number">10</span>d}</span>'</span>)</span><br><span class="line"><span class="comment"># Sjoerd     ==&gt;       4127</span></span><br><span class="line"><span class="comment"># Jack       ==&gt;       4098</span></span><br><span class="line"><span class="comment"># Dcab       ==&gt;       7678</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'Jack: {0[Jack]:d}; Sjoerd: {0[Sjoerd]:d}; '</span></span><br><span class="line">      <span class="string">''</span></span><br><span class="line">      <span class="string">'Dcab: {0[Dcab]:d}'</span>.format(table))</span><br><span class="line"><span class="comment"># Jack: 4098; Sjoerd: 4127; Dcab: 8637678</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">info = [[<span class="string">'user1'</span>, <span class="number">345.6</span>, <span class="number">12</span>, <span class="string">'黄金'</span>], [<span class="string">'user2'</span>, <span class="number">2345.6</span>, <span class="number">8</span>, <span class="string">'白银'</span>],</span><br><span class="line">        [<span class="string">'user3555'</span>, <span class="number">55345.6</span>, <span class="number">22</span>, <span class="string">'钻石'</span>]]</span><br><span class="line"></span><br><span class="line">print(</span><br><span class="line">    <span class="string">f'用户：<span class="subst">{info[<span class="number">0</span>][<span class="number">0</span>]:&gt;<span class="number">10</span>}</span>， 积分：<span class="subst">{info[<span class="number">0</span>][<span class="number">1</span>]:<span class="number">7</span>}</span>， 等级：<span class="subst">{info[<span class="number">0</span>][<span class="number">2</span>]:<span class="number">2</span>}</span>， 头衔：<span class="subst">{info[<span class="number">0</span>][<span class="number">3</span>]}</span>'</span></span><br><span class="line">)</span><br><span class="line">print(</span><br><span class="line">    <span class="string">f'用户：<span class="subst">{info[<span class="number">1</span>][<span class="number">0</span>]:&gt;<span class="number">10</span>}</span>， 积分：<span class="subst">{info[<span class="number">1</span>][<span class="number">1</span>]:<span class="number">7</span>}</span>， 等级：<span class="subst">{info[<span class="number">1</span>][<span class="number">2</span>]:<span class="number">2</span>}</span>， 头衔：<span class="subst">{info[<span class="number">1</span>][<span class="number">3</span>]}</span>'</span></span><br><span class="line">)</span><br><span class="line">print(</span><br><span class="line">    <span class="string">f'用户：<span class="subst">{info[<span class="number">2</span>][<span class="number">0</span>]:&gt;<span class="number">10</span>}</span>， 积分：<span class="subst">{info[<span class="number">2</span>][<span class="number">1</span>]:<span class="number">7</span>}</span>， 等级：<span class="subst">{info[<span class="number">2</span>][<span class="number">2</span>]:<span class="number">2</span>}</span>， 头衔：<span class="subst">{info[<span class="number">2</span>][<span class="number">3</span>]}</span>'</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 用户：     user1， 积分：  345.6， 等级：12， 头衔：黄金</span></span><br><span class="line"><span class="comment"># 用户：     user2， 积分： 2345.6， 等级： 8， 头衔：白银</span></span><br><span class="line"><span class="comment"># 用户：  user3555， 积分：55345.6， 等级：22， 头衔：钻石</span></span><br></pre></td></tr></tbody></table></figure>

<p>%e ——保留小数点后面六位有效数字，指数形式输出<br>　　%.3e，保留3位小数位，使用科学计数法<br>%g ——在保证六位有效数字的前提下，使用小数方式，否则使用科学计数法<br>　　%.3g，保留3位有效数字，使用小数或科学计数法</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">print(<span class="string">'%e'</span> % <span class="number">1.11</span>)  <span class="comment"># 默认6位小数，用科学计数法</span></span><br><span class="line"><span class="comment"># 1.110000e+00</span></span><br><span class="line">print(<span class="string">'%.3e'</span> % <span class="number">1.11</span>)  <span class="comment"># 取3位小数，用科学计数法</span></span><br><span class="line"><span class="comment"># 1.110e+00</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'%g'</span> % <span class="number">1111.1111</span>)  <span class="comment"># 默认6位有效数字</span></span><br><span class="line"><span class="comment"># 1111.11</span></span><br><span class="line">print(<span class="string">'%.7g'</span> % <span class="number">1111.1111</span>)  <span class="comment"># 取7位有效数字</span></span><br><span class="line"><span class="comment"># 1111.111</span></span><br><span class="line">print(<span class="string">'%.2g'</span> % <span class="number">1111.1111</span>)  <span class="comment"># 取2位有效数字，自动转换为科学计数法</span></span><br><span class="line"><span class="comment"># 1.1e+03</span></span><br></pre></td></tr></tbody></table></figure>

<p>‘e’ - 幂符号。用科学计数法打印数字。用’e’表示幂。<br>‘g’ - 一般格式。将数值以fixed-point格式输出。当数值特别大的时候，用幂形式打印。<br>‘n’ - 数字。当值为整数时和’d’相同，值为浮点数时和’g’相同。不同的是它会根据区域设置插入数字分隔符。<br>‘%’ - 百分数。将数值乘以100然后以fixed-point(‘f’)格式打印，值后面会有一个百分号。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'{:e}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 2.000000e+01</span></span><br><span class="line">print(<span class="string">'{:g}'</span>.format(<span class="number">20.1</span>))</span><br><span class="line"><span class="comment"># 20.1</span></span><br><span class="line">print(<span class="string">'{:f}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 20.000000</span></span><br><span class="line">print(<span class="string">'{:n}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:%}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 2000.000000%</span></span><br><span class="line">points = <span class="number">3</span></span><br><span class="line">total = <span class="number">5</span></span><br><span class="line">print(<span class="string">'Correct answers: {:.2%}'</span>.format(points/total))</span><br><span class="line"><span class="comment"># Correct answers: 60.00%</span></span><br></pre></td></tr></tbody></table></figure>

<p>正负符号显示 %+f, %-f, 和 % f的用法</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'{:+f}; {:+f}'</span>.format(<span class="number">3.14</span>, <span class="number">-3.14</span>))  <span class="comment"># 总是显示符号</span></span><br><span class="line"><span class="comment"># +3.140000; -3.140000</span></span><br><span class="line">print(<span class="string">'{: f}; {: f}'</span>.format(<span class="number">3.14</span>, <span class="number">-3.14</span>))  <span class="comment"># 若是+数，则在前面留空格</span></span><br><span class="line"><span class="comment">#  3.140000; -3.140000</span></span><br><span class="line">print(<span class="string">'{:-f}; {:-f}'</span>.format(<span class="number">3.14</span>, <span class="number">-3.14</span>))  <span class="comment"># -数时显示-，与'{:f}; {:f}'一致</span></span><br><span class="line"><span class="comment"># 3.140000; -3.140000</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">width = <span class="number">5</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">5</span>, <span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> base <span class="keyword">in</span> <span class="string">'dXob'</span>:</span><br><span class="line">        print(<span class="string">'{0:{width}{base}}'</span>.format(num, base=base, width=width), end=<span class="string">' '</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"><span class="comment">#     5     5     5   101</span></span><br><span class="line"><span class="comment">#     6     6     6   110</span></span><br><span class="line"><span class="comment">#     7     7     7   111</span></span><br><span class="line"><span class="comment">#     8     8    10  1000</span></span><br><span class="line"><span class="comment">#     9     9    11  1001</span></span><br><span class="line"><span class="comment">#    10     A    12  1010</span></span><br><span class="line"><span class="comment">#    11     B    13  1011</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
