<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;bubbleboy11.github.io&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/17/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/17/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<script data-pjax src="/js/load-config.js"></script>
  <title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">179</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/python-chang-yong-nei-zhi-suan-fa-he-shu-ju-jie-gou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/python-chang-yong-nei-zhi-suan-fa-he-shu-ju-jie-gou/" class="post-title-link" itemprop="url">Python常用内置算法和数据结构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Python常用内置算法和数据结构"><a href="#Python常用内置算法和数据结构" class="headerlink" title="Python常用内置算法和数据结构"></a>Python常用内置算法和数据结构</h1><table>
<thead>
<tr>
<th>数据结构/算法</th>
<th>语言内置</th>
<th>内置库</th>
</tr>
</thead>
<tbody><tr>
<td>线性结构</td>
<td>list(列表)/tuple(元祖)</td>
<td>array(数组，不常用)/collections.namedtuple</td>
</tr>
<tr>
<td>链式结构</td>
<td></td>
<td>collections.deque(双端队列)</td>
</tr>
<tr>
<td>字典结构</td>
<td>dict(字典)</td>
<td>collections.Counter(计数器)/OrderedDict(有序字典)/defaultdict</td>
</tr>
<tr>
<td>集合结构</td>
<td>set(集合)/frozenset(不可变集合)</td>
<td></td>
</tr>
<tr>
<td>排序算法</td>
<td>sorted</td>
<td></td>
</tr>
<tr>
<td>二分算法</td>
<td></td>
<td>bisect模块</td>
</tr>
<tr>
<td>堆算法</td>
<td></td>
<td>heapq模块</td>
</tr>
<tr>
<td>缓存算法</td>
<td></td>
<td>functools.lru_cache(Least Recent Used, python3)</td>
</tr>
</tbody></table>
<h3 id="frozenset固定集合"><a href="#frozenset固定集合" class="headerlink" title="frozenset固定集合"></a>frozenset固定集合</h3><p>是不可变、无序的，含有唯一元素的不可迭代的集合，<br>作用：固定集合可以作为字典的键，还可以作为字典的值</p>
<figure class="highlight plain"><figcaption><span>frozenset([iterable])``` 固定集合的构造函数</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">iterable -- 可迭代的对象，比如列表、字典、元组等等。</span><br><span class="line">用可迭代对象创建一个固定的、不能再添加或删除任何元素的集合，返回新的 frozenset 对象，</span><br><span class="line">如果不提供任何参数，默认会生成空的固定集合</span><br><span class="line"></span><br><span class="line">为什么需要冻结的集合（即不可变的集合）呢？因为在集合的关系中，有集合的中的元素是另一个集合的情况，但是普通集合（set）本身是可变的，那么它的实例就不能放在另一个集合中（set中的元素必须是不可变类型）。</span><br><span class="line"></span><br><span class="line">所以，frozenset提供了不可变的集合的功能，当集合不可变时，它就满足了作为集合中的元素的要求，就可以放在另一个集合中了。</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">&gt;&gt;&gt;a = frozenset(range(10))     # 生成一个新的不可变集合</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">frozenset([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br><span class="line">&gt;&gt;&gt; b = frozenset('runoob') </span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">frozenset(['b', 'r', 'u', 'o', 'n'])   # 创建不可变集合</span><br></pre></td></tr></tbody></table></figure>

<h3 id="collections是Python内建的一个集合模块，提供的一些内置数据结构拓展，"><a href="#collections是Python内建的一个集合模块，提供的一些内置数据结构拓展，" class="headerlink" title="collections是Python内建的一个集合模块，提供的一些内置数据结构拓展，"></a><code>collections</code>是Python内建的一个集合模块，提供的一些内置数据结构拓展，</h3><p>力扣提交时环境中已经有<code>import collections</code></p>
<h3 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple()"></a>namedtuple()</h3><p>factory function for creating tuple subclasses with named fields<br>创建命名元组子类的工厂函数  具名元组<br>接受类型的名称和属性列表创建一个自定义的 tuple 对象，并且规定了tuple元素的个数，<br>并可以用属性而不是索引来引用tuple的某个元素。<br>作用场景：通过下标不太可读通过属性名称变得比较可读。<br>它具备tuple的不变性</p>
<p>tuple可以表示一个元组，是不可变的集合,例如一个点的二维坐标就可以这样表示成p=(1,2)<br>但是，(1,2)很难看出这个tuple是用来表示一个坐标的</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line">Point = collections.namedtuple(<span class="string">'Point'</span>, <span class="string">'x,y'</span>)  <span class="comment"># 定义一个tuple对象</span></span><br><span class="line">p = Point(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># 给x赋值1，y赋值2</span></span><br><span class="line">print(p.x)  <span class="comment"># 1</span></span><br><span class="line">print(p.y)  <span class="comment"># 2</span></span><br><span class="line">print(p[<span class="number">0</span>])  <span class="comment"># 1</span></span><br><span class="line">print(p[<span class="number">1</span>])  <span class="comment"># 2</span></span><br><span class="line">print(p.x == p[<span class="number">0</span>])  <span class="comment"># True</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>deque /dek/<br>list-like container with fast appends and pops on either end<br>类似列表(list)的容器，实现了在两端快速添加(append)和弹出(pop)<br>是为了高效实现插入和删除操作的双向列表，<br>deque可以方便实现 queue (队列 ) / stack (栈)。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line">de = collections.deque()  <span class="comment"># 定义deque对象</span></span><br><span class="line">print(de)  <span class="comment"># deque([])</span></span><br><span class="line">de.append(<span class="number">1</span>)  <span class="comment"># 右边添加1元素</span></span><br><span class="line">de.appendleft(<span class="number">0</span>)  <span class="comment"># 左边添加0元素</span></span><br><span class="line">print(de)  <span class="comment"># deque([0, 1])</span></span><br><span class="line">de.pop()  <span class="comment"># 1 输出右边元素</span></span><br><span class="line">de.popleft()  <span class="comment"># 0 输出左边元素</span></span><br><span class="line">print(de)  <span class="comment"># deque([])</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>Counter<br>dict subclass for counting hashable objects<br>字典的子类，提供了可哈希对象的计数功能，值是一个字典</p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> collections</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = collections.Counter()   <span class="comment"># 定义Counter对象</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = collections.Counter(<span class="string">'abcab'</span>) <span class="comment"># 统计字符数目</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter({<span class="string">'a'</span>: <span class="number">2</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">1</span>})   <span class="comment"># 值是一个字典，a是有2个，b是有2个，c是有1个</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c[<span class="string">'a'</span>]  <span class="comment"># 统计字符串每个字符个数</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.most_common() <span class="comment"># 获取从大到小每个字符数量</span></span><br><span class="line">[(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'c'</span>, <span class="number">1</span>)]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> ch <span class="keyword">in</span> <span class="string">'programming'</span>:</span><br><span class="line">      c[ch]=c[ch]+<span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line">Counter({<span class="string">'g'</span>:<span class="number">2</span>,<span class="string">'m'</span><span class="number">2</span>,<span class="string">'r'</span>:<span class="number">2</span>,<span class="string">'a'</span>:<span class="number">1</span>,<span class="string">'i'</span>:<span class="number">1</span>,<span class="string">'o'</span>:<span class="number">1</span>,<span class="string">'n'</span>:<span class="number">1</span>,<span class="string">'p'</span>:<span class="number">1</span>})</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>OrderedDict<br>dict subclass that remembers the order entries were added<br>字典的子类，保存了他们被添加的顺序，key 顺序是第一次插入的顺序。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> collections</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od = collections.OrderedDict()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'c'</span>] = <span class="string">'c'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'a'</span>] = <span class="string">'a'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>od[<span class="string">'b'</span>] = <span class="string">'b'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(od.keys())</span><br><span class="line">[<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>]   <span class="comment"># key的顺序是第一次插入的顺序。</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>defaultdict<br>dict subclass that calls a factory function to supply missing values<br>defaultdict字典的子类，提供了一个工厂函数，为字典查询提供一个默认值</p>
</li>
</ul>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> collections</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd = collections.defaultdict(int) <span class="comment"># 第一个参数必须是可调用的，否则为None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'a'</span>]  <span class="comment"># 不存在的key默认为0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'b'</span>] += <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd</span><br><span class="line">defaultdict(&lt;class 'int'&gt;, {'a': 0, 'b': 1})</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Python-dict-set-底层都是哈希表"><a href="#Python-dict-set-底层都是哈希表" class="headerlink" title="Python dict/set 底层都是哈希表"></a>Python dict/set 底层都是哈希表</h3><ul>
<li>哈希表的实现原理, 底层其实就是一个数组, 通过哈希函数把相应的元素映射到一个数组槽里面。</li>
<li>根据哈希函数快速定位一个元素，平均查找时间复杂度O(1)，查找和插入的速度极快，不会随着key的增加而变慢；二分查找</li>
<li>不断加入元素会引起哈希表重新开辟空间，拷贝之前元素到新数组，需要占用大量的内存，内存浪费多。</li>
<li>dict是用来存储键值对（key-value）结构的数据的，</li>
<li>set没有存储对应的value，其实也是存储的键值对，只是默认键和值是相同的,</li>
</ul>
<p>dict是python中的一个可变的数据类型，用{}表示，dict curly bracket 花括号<br>dict的key必须是不可变的数据类型对象，同一个字典中的键必须唯一，如果出现多个相同的键，则最新的键会被记住<br>而value的数据类型可以任意</p>
<p>新版哈希表结构：</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Indices</span><br><span class="line">----------------------------------------------------</span><br><span class="line">None | index | None | None | index | None | index ...</span><br><span class="line">----------------------------------------------------</span><br><span class="line"></span><br><span class="line">Entries</span><br><span class="line">--------------------</span><br><span class="line">hash0   key0  value0</span><br><span class="line">---------------------</span><br><span class="line">hash1   key1  value1</span><br><span class="line">---------------------</span><br><span class="line">hash2   key2  value2</span><br><span class="line">---------------------</span><br><span class="line"><span class="code">        ...</span></span><br><span class="line">---------------------</span><br></pre></td></tr></tbody></table></figure>

<p>集合并不支持索引操作，因为集合本质上是一个哈希表，和列表不一样。所以，同样不可以放入可变对象，<br>因为无法判断两个可变对象是否相等，<br>也就无法保证set内部“不会有重复元素”。</p>
<p>dict根据key来计算value的存储位置，<br>如果每次计算相同的key得出的结果不同，那dict内部就完全混乱了。<br>这个通过key计算位置的算法称为哈希算法（Hash）</p>
<p>{0, 1, 2} set 无序，不能通过索引访问，不重复，用来去重<br>set() 创建一个空集合，<br>{}新建一个空字典<br>{} - {}求两个集合的差集，去掉相同的元素，以前面集合为标准，从一个集合里面去掉后面集合特有的元素<br>{} &amp; {}求两个集合的交集，找两个集合的公有元素<br>{} | {}求两个集合的并集，把两个集合合并在一起，按照从前往后的顺序，去掉相同的元素</p>
<ul>
<li>CPython解释器使用二次探查解决哈希冲突问题</li>
</ul>
<p>哈希冲突<br>当插入一个Entry&lt;k,v&gt;时，将key经过hash计算出的下标中已经存在另一个Entry&lt;k,v&gt;，这时就会产生哈希冲突。哈希冲突主要是是由于哈希函数产生的哈希值是有限的</p>
<p>解决哈希冲突的常用方法有</p>
<ul>
<li>链接法：元素key冲突之后使用一个链表填充相同key 的元素</li>
<li>开放寻址法(探查法) 又分为线性探查和二次探查等，冲突之后根据一种方式(二次探查)寻找下一个可用的槽。( 探查是一次还是二次看使用函数是一次还是二次的)，</li>
</ul>
<p>哈希扩容：HashMap的初始值是16（1,&lt;&lt;4）,负载因子0.75（听说这个值是经过大量实践算出来的，这个值设定最合理），初始值16指的是数组的长度（1&lt;&lt;4是2的4次方，这样写计算机执行更快），当数组的容量达到12（16*0.75）时，这时开始扩容，扩容为32（1&lt;&lt;5即2的5次方），每次扩容按照2的倍数递增，扩容是为了减少hash碰撞，让链表的数据更少（最好链表上就一个数据，即为数组的下标数据）</p>
<p>当前数据存储的数量（即size()）大小必须大于等于阈值；<br>当前加入的数据是否发生了hash冲突，满足这两个条件就会哈希扩容。</p>
<p>dict则为了快速查找使用了一种特别的方法，哈希表，<br>采用哈希函数从key计算得到一个数字<br>（哈希函数有个特点：对于不同的key，有很大的概率得到的哈希值也不同），<br>然后直接把value存储到这个数字所对应的地址上，<br>比如key=’ABC’，value=10，经过哈希函数得到key对应的哈希值为123，<br>那么就申请一个有1000个地址（从0到999）的内存，<br>然后把10存放在地址为123的地方。<br>对于key=’BCD’，value=20，得到key的哈希值为234，<br>那么就把20存放在地址为234的地方。<br>对于这样的表查找起来是非常方便的。只要给出key，计算得到哈希值，<br>然后直接到对应的地址去找value就可以了。<br>无论有几个元素，都可以直接找到value，无需遍历整个表。<br>不过虽然dict查找速度快，但内存浪费严重，你看我们只存储了两个元素，都要申请一个长度为1000的内存。<br>3.现在你知道为啥key要用不可变对象了吧？因为不可变对象是常量，每次的哈希值算出来都是固定的，这样就不会出错。比如key=’ABC’，value=10，存储地址为123，假设我突发奇想，把key改成’BCD’，那么当查找’BCD’的value的时候就会去234的地址找，但那里啥也没有，这就乱套了。</p>
<blockquote>
<p>Dictionary key 必须是不可变的</p>
</blockquote>
<h3 id="Python中list-tuple区别"><a href="#Python中list-tuple区别" class="headerlink" title="Python中list/tuple区别"></a>Python中list/tuple区别</h3><ul>
<li><p>都是线性结构、支持下标访问</p>
</li>
<li><p>list是可变对象，查找和删除的时间复杂度是O(n)，添加的时间复杂度是O(1)<br>没有办法作为字典的key，因为list有可能因为添加新的元素而导致内存地址的更换<br>list既可以当栈、也可以当队列，通过数组实现，而不是链表；<br>因此，每当执行 insert(0, val) 操作时，<br>需要将元素都向后移动一位才可插入，复杂度 O(N) ；<br>这和insert方法不同，是根据索引值来判断插入到链表的哪个位置。</p>
</li>
<li><p>tuple是保存的引用不可变，你没法替换这个对象，但是如果它本身就是一个可变对象，是可以修改这个引用指向的可变对象，比如tuple中包容可变对象，如果tuple里面保存一个list，list本身还是可变的。 parenthese 圆括号，有序的 不变的顺序表<br>可以作为字典的key，可以用在字符串格式化中。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print((), type(()))</span><br><span class="line"><span class="comment"># () &lt;class 'tuple'&gt; 空元组</span></span><br><span class="line">print((<span class="number">3</span>), type((<span class="number">3</span>)))</span><br><span class="line"><span class="comment"># 3 &lt;class 'int'&gt;</span></span><br><span class="line">print((<span class="number">3</span>, ), type((<span class="number">3</span>,)))</span><br><span class="line"><span class="comment"># (3,) &lt;class 'tuple'&gt; 只有一个元组元素后面要加逗号</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>1.list和tuple其实是用链表顺序存储的，也就是前一个元素中存储了下一个元素的位置，这样只要找到第一个元素的位置就可以顺藤摸瓜找到所有元素的位置，所以list的名字其实就是个指针，指向list的第一个元素的位置。list的插入和删除等可以直接用链表的方式进行，比如我要在第1个元素和第2个元素中间插入一个元素，那么直接在链表的最后面（我们假设这个list只有两个元素，那么也就是在第3个元素的位置上）插入这个元素，然后把第一个元素指针指向这个元素（第3个位置），然后再把新插入的元素的指针指向原来的第2个元素，这样插入操作就完成了。读取这个list的时候，先用list的名字（就是个指针，指向第1个元素的位置）找到第一个元素，然后用第1一个元素的指针找到第2个元素（位置3），然后用第2个元素的指针找到第3个元素（位置2），以此类推。所以list的顺序和内存中的实际顺序其实不一定完全对应。这种存储方式占用空间小，浪费内存很少。<br>因为要按照链表一个一个找下去，查找和插入的时间随着元素的增加而增加；</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s = set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print(s)  <span class="comment"># {1, 2, 3}   </span></span><br><span class="line">s.add(<span class="number">4</span>)</span><br><span class="line">print(s)  <span class="comment"># {1, 2, 3, 4}</span></span><br><span class="line">s.remove(<span class="number">4</span>)</span><br><span class="line">print(s)  <span class="comment"># {1, 2, 3}   </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = ([<span class="number">1</span>], <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">print(t[<span class="number">0</span>])  <span class="comment"># [1]</span></span><br><span class="line">t[<span class="number">0</span>].append(<span class="number">1</span>)</span><br><span class="line">print(t)</span><br><span class="line"><span class="comment"># ([1, 1], 2, 3)  # 第一个列表对象元素虽然改变，但它依然是这个列表对象</span></span><br><span class="line"></span><br><span class="line">print(t[<span class="number">2</span>])  <span class="comment"># 3，不可变对象</span></span><br><span class="line">t[<span class="number">2</span>] = <span class="number">3</span>  <span class="comment"># TypeError: 'tuple' object does not support item assignment</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">t = (<span class="number">1</span>, <span class="string">'23'</span>, [<span class="number">123</span>, <span class="string">'abc'</span>], (<span class="string">'python'</span>, <span class="string">'learn'</span>))</span><br><span class="line">tls = list(t)  <span class="comment">#tuple--&gt;list</span></span><br><span class="line">print(tls)</span><br><span class="line"><span class="comment"># [1, '23', [123, 'abc'], ('python', 'learn')]</span></span><br><span class="line"></span><br><span class="line">t_tuple = tuple(tls)  <span class="comment">#list--&gt;tuple</span></span><br><span class="line">print(t_tuple)</span><br><span class="line"><span class="comment"># (1, '23', [123, 'abc'], ('python', 'learn'))</span></span><br></pre></td></tr></tbody></table></figure>

<p>常用函数<br>list<br><code>min(list_name)</code> <code>max(list_name)</code> <code>sum(list_name)</code><br><code>len(list_name)</code></p>
<p><code>list.index(x[, start[, end]])</code><br>从列表中找出某个值第一个匹配项的索引位置。<br>x– 查找的对象。<br>start– 可选，查找的起始位置。<br>end– 可选，查找的结束位置。<br>返回：查找对象的索引位置，如果没有找到对象则抛出异常。</p>
<figure class="highlight plain"><figcaption><span>start, end)```返回开始的索引值，没找到则抛出异常。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```py</span><br><span class="line">list1 = ['Google', 'Runoob', 'Taobao']</span><br><span class="line">print('Google 索引值为', list1.index('Google'))</span><br><span class="line"># Google 索引值为 0</span><br><span class="line">print('Runoob 索引值为', list1.index('Runoob'))</span><br><span class="line"># Runoob 索引值为 1</span><br><span class="line"></span><br><span class="line">print('Taobao 索引值为', list1.index('Taobao'))</span><br><span class="line"># Taobao 索引值为 2</span><br><span class="line"></span><br><span class="line"># 从指定位置开始搜索</span><br><span class="line">print('Runoob 索引值为', list1.index('Runoob', 1))</span><br><span class="line"># Runoob 索引值为 1</span><br><span class="line"># print('Runoob 索引值为', list1.index('Runoob', 2))</span><br><span class="line"># ValueError: 'Runoob' is not in list</span><br><span class="line"></span><br><span class="line">list1 = ['Google', 'Runoob', 'Taobao']</span><br><span class="line">list2 = ['Runoob', 'Taobao', 'Google']</span><br><span class="line">dic = {}</span><br><span class="line">for i in range(len(list2)):</span><br><span class="line">    dic[list2[i]] = i</span><br><span class="line">    print(dic)</span><br><span class="line"># {'Runoob': 0}</span><br><span class="line"># {'Runoob': 0, 'Taobao': 1}</span><br><span class="line"># {'Runoob': 0, 'Taobao': 1, 'Google': 2}</span><br><span class="line"># {'Runoob': 0, 'Taobao': 1, 'Google': 2}</span><br><span class="line"></span><br><span class="line">print(list1[0])  # Google</span><br><span class="line">i = dic[list1[0]]</span><br><span class="line">print(i)  # 2</span><br><span class="line"></span><br><span class="line">x = dict()</span><br><span class="line">print(x)  # {}</span><br><span class="line"></span><br><span class="line">dict2 = {val: idx for idx, val in enumerate(list2)}</span><br><span class="line">print(dict2)</span><br><span class="line"># {'Runoob': 0, 'Taobao': 1, 'Google': 2}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>根据值移除元素</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">```del a[索引号]```</span><br><span class="line">```list.pop([index=-1])```移除列表中指定索引号一个元素（默认最后一个元素），并且返回该元素的值。</span><br><span class="line">```python</span><br><span class="line">list1 = ['Google', 'Runoob', 'Taobao', "Yahoo"]</span><br><span class="line">list1.pop()  # 括号里没有参数，表示删除list数组中最后一个元素</span><br><span class="line">print("列表现在为 : ", list1)</span><br><span class="line"># 列表现在为 :  ['Google', 'Runoob', 'Taobao']</span><br><span class="line">list_pop = list1.pop(1)</span><br><span class="line">print("删除的项为 :", list_pop)</span><br><span class="line"># 删除的项为 : Runoob</span><br><span class="line">print("列表现在为 : ", list1)</span><br><span class="line"># 列表现在为 :  ['Google', 'Taobao']</span><br><span class="line">print("删除的项为 :", list1.pop(0), "，列表现在为 : ", list1)</span><br><span class="line"># 删除的项为 : Google ，列表现在为 :  ['Taobao']</span><br></pre></td></tr></tbody></table></figure>

<p><code> .sort(key=lambda x: x[0], reverse=True)</code><br><code> .sort(key=lambda x:(-x[1],x[0],x[2]))</code><br><code> .sort(key=lambda x:(-x[1],x[0],x[2]))</code><br>默认是升序，加个符号变降序，可做多级排序。</p>
<figure class="highlight plain"><figcaption><span>不在本地做排序</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```.reverse()```函数用于反向列表中元素。不能将字符串反转。</span><br><span class="line">```.reversed()```函数是返回序列seq的反向访问的迭代子。参数可以是列表，元组，字符串</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line"># 组织列表 sort() 永久性排序 abcde正向或逆向顺序排序</span><br><span class="line">che = ["motuo", "qiche", "zixingche", 'huoche']</span><br><span class="line"></span><br><span class="line"># 倒着打印列表  永久性的修改顺序 也可以随时改回来</span><br><span class="line">che = ["motuo", "qiche", "zixingche", 'huoche']</span><br><span class="line"># 倒着打印</span><br><span class="line">che.reverse()</span><br><span class="line">print(che)</span><br><span class="line"># ['huoche', 'zixingche', 'qiche', 'motuo']</span><br><span class="line"># 再次倒着改回</span><br><span class="line">che.reverse()</span><br><span class="line">print(che)</span><br><span class="line"># ['motuo', 'qiche', 'zixingche', 'huoche']</span><br><span class="line"></span><br><span class="line"># "iloveChina".reverse()  # 直接将字符串用reverse异常，reverse适用于list(列表)</span><br><span class="line">a= "ilovechina"[::-1] </span><br><span class="line">print(a)</span><br><span class="line">b = ''.join(reversed('ilovechina'))</span><br><span class="line">print(b)</span><br></pre></td></tr></tbody></table></figure>

<p>元素 in list_name<br><code>.append</code><br><code>.insert(序号，内容)</code><br>函数参数是可以是任意一个元素，<br>作用是在列表的最后添加上这个新元素。</p>
<p>变量<br><code>float(‘inf’)</code></p>
<p>字典</p>
<figure class="highlight plain"><figcaption><span>查询字典的键</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">```.values()``` 查询字典的值</span><br><span class="line">```.items()``` 返回的是元组</span><br><span class="line"></span><br><span class="line">```dict.get(key, default=None)``` 查询某个键是否存在，</span><br><span class="line">key -- 字典中要查找的键。</span><br><span class="line">default -- 如果指定键的值不存在时，返回该默认值。</span><br><span class="line">返回指定键的值，如果值不在字典中或不存在此键，返回默认值None。</span><br><span class="line">可以在get()方法中添加信息避免出现None</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line"># 字典的查询</span><br><span class="line">dict1 = {'name': 'Ashe', 'age': 18, 'male': '男'}</span><br><span class="line">print(dict1.keys())  # dict_keys(['name', 'age', 'male'])</span><br><span class="line">print(dict1.values())  # dict_values(['Ashe', 18, '男'])</span><br><span class="line">print(dict1.items())  </span><br><span class="line"># dict_items([('name', 'Ashe'), ('age', 18), ('male', '男')])</span><br><span class="line"></span><br><span class="line"># 判断key是否在字典里</span><br><span class="line">print('name' in dict1)  # True，效率高</span><br><span class="line">print('name' in dict1.keys())  # True 效率低，要先生成遍历字典的所有内容一个列表，这样字典的优势就没有了</span><br><span class="line"></span><br><span class="line"># 打印dict1的键</span><br><span class="line">for i in dict1.keys():</span><br><span class="line">    print(i)</span><br><span class="line">    # name</span><br><span class="line">    # age</span><br><span class="line">    # male</span><br><span class="line"></span><br><span class="line"># 打印dict的值</span><br><span class="line">for v in dict1.values():</span><br><span class="line">    print(v)  #Ashe 18 男</span><br><span class="line">    # Ashe</span><br><span class="line">    # 18</span><br><span class="line">    # 男</span><br></pre></td></tr></tbody></table></figure>

<p>打印字典的键值：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dict1 = {<span class="string">'name'</span>: <span class="string">'Ashe'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'male'</span>: <span class="string">'男'</span>}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dict1.items():</span><br><span class="line">    print(i)</span><br><span class="line">    <span class="comment"># ('name', 'Ashe')</span></span><br><span class="line">    <span class="comment"># ('age', 18)</span></span><br><span class="line">    <span class="comment"># 'male', '男')</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> dict1.items():</span><br><span class="line">    print(k, v)</span><br><span class="line">    <span class="comment"># name Ashe</span></span><br><span class="line">    <span class="comment"># age 18</span></span><br><span class="line">    <span class="comment"># male 男</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dict1 = {<span class="string">'name'</span>: <span class="string">'Ashe'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'male'</span>: <span class="string">'男'</span>}</span><br><span class="line">print(dict1.get(<span class="string">'name'</span>))  <span class="comment"># Ashe</span></span><br><span class="line">print(dict1.get(<span class="string">'address'</span>))  <span class="comment"># None</span></span><br><span class="line">print(dict1.get(<span class="string">'address'</span>, <span class="string">'没有此键'</span>))  <span class="comment"># 没有此键</span></span><br><span class="line">print(dict1.get(<span class="string">'name'</span>, <span class="string">'age'</span>))  <span class="comment"># Ashe</span></span><br><span class="line">print(dict1.get(<span class="string">'age'</span>, <span class="string">'name'</span>))  <span class="comment"># 18</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">a = {<span class="string">'x'</span>: <span class="number">1</span>}</span><br><span class="line">print(a[<span class="string">'x'</span>])  <span class="comment"># 1</span></span><br><span class="line"><span class="comment"># print(a[1]) # KeyError:1</span></span><br><span class="line">b = {(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>): <span class="string">'test'</span>}</span><br><span class="line">print(b[(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)])  <span class="comment"># test</span></span><br><span class="line"><span class="comment"># c = {[1, 2, 3]: 'test'}</span></span><br><span class="line"><span class="comment"># print(c[[1, 2, 3]])  # TypeError: unhashable type: 'list'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(a.keys())  <span class="comment"># dict_keys(['x'])</span></span><br><span class="line">print(a.values())  <span class="comment"># dict_values([1])</span></span><br><span class="line">print(b.keys())  <span class="comment"># dict_keys([(1, 2, 3)])</span></span><br><span class="line">print(b.values())  <span class="comment"># dict_values(['test'])</span></span><br><span class="line"></span><br><span class="line">print(a.get(<span class="string">'x'</span>))  <span class="comment"># 1</span></span><br><span class="line">print(a.get(<span class="string">'x'</span>, <span class="number">4</span>))  <span class="comment"># 1 指定的键的值不存在，返回默认值</span></span><br><span class="line">print(a.get(<span class="number">4</span>))  <span class="comment"># None 指定的键的值不存在，返回默认值None</span></span><br><span class="line"></span><br><span class="line">print(b.get((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)))  <span class="comment"># test</span></span><br><span class="line">print(b.get(<span class="string">'y'</span>))  <span class="comment"># None，指定键的值不存在时，返回该默认值None。</span></span><br><span class="line">print(b.get(<span class="string">'y'</span>, <span class="number">2</span>))  <span class="comment"># 2，如果指定键的值不存在时，返回该默认值2。</span></span><br></pre></td></tr></tbody></table></figure>

<p>dict有两种增加的方法<br>如果没有的键值对，则进行添加，如果有，则将值进行覆盖</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dict1={<span class="string">'name'</span>:<span class="string">'Ashe'</span>,<span class="string">'age'</span>:<span class="number">18</span>,<span class="string">'male'</span>:<span class="string">'男'</span>}</span><br><span class="line">print(dict1)</span><br><span class="line">dict1[<span class="string">'high'</span>]=<span class="number">185</span></span><br><span class="line">print(dict1)  <span class="comment"># {'name': 'Ashe', 'age': 18, 'male': '男', 'high': 185}</span></span><br><span class="line">dict1[<span class="string">'age'</span>]=<span class="number">16</span></span><br><span class="line">print(dict1) <span class="comment">#  {'name': 'Ashe', 'age': 16, 'male': '男', 'high': 185}</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果有键值对，不做任何改变，没有键值对，才进行添加</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dict1 = {<span class="string">'name'</span>: <span class="string">'Ashe'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'male'</span>: <span class="string">'男'</span>}</span><br><span class="line">dict1.setdefault(<span class="string">"weight"</span>)</span><br><span class="line">print(dict1)</span><br><span class="line"><span class="comment"># {'name': 'Ashe', 'age': 16, 'male': '男', 'high': 185, 'weight': None}</span></span><br><span class="line">dict1.setdefault(<span class="string">'weight'</span>, <span class="string">'65kg'</span>)</span><br><span class="line">print(dict1)</span><br><span class="line"><span class="comment"># {'name': 'Ashe', 'age': 16, 'male': '男', 'high': 185, 'weight': None}</span></span><br><span class="line">dict1.setdefault(<span class="string">'address'</span>, <span class="string">'北京'</span>)</span><br><span class="line">print(dict1)</span><br><span class="line"><span class="comment"># {'name': 'Ashe', 'age': 16, 'male': '男', 'high': 185, 'weight': None, 'address': '北京'}</span></span><br><span class="line">dict1.setdefault(<span class="string">'address'</span>, <span class="string">'桂林'</span>)</span><br><span class="line">print(dict1)</span><br><span class="line"><span class="comment"># {'name': 'Ashe', 'age': 16, 'male': '男', 'high': 185, 'weight': None, 'address': '北京'}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">delDict={'name': 'Ashe', 'age': 16, 'male': '男', 'high': 185, 'weight': None, 'address': '北京'}</span><br><span class="line">print(delDict.pop('age'))  # 16</span><br><span class="line">print(delDict)  #{'name': 'Ashe', 'male': '男', 'high': 185, 'weight': None, 'address': '北京'}</span><br><span class="line">print(delDict.pop('职业','没有此键'))  #没有此键</span><br><span class="line"></span><br><span class="line">del a['x']  # 删除key</span><br><span class="line">print(a['y'])  # 2</span><br></pre></td></tr></tbody></table></figure>

<p><code>pop(key[,default])</code><br>删除字典给定键 key 所对应的值，返回值为被删除的值。<br>key: 要删除的键值<br>default: 如果没有 key，返回 default 值</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">site = {<span class="string">'name'</span>: <span class="string">'菜鸟教程'</span>, <span class="string">'alexa'</span>: <span class="number">10000</span>, <span class="string">'url'</span>: <span class="string">'www.runoob.com'</span>}</span><br><span class="line">pop_obj = site.pop(<span class="string">'name'</span>)</span><br><span class="line">print(pop_obj)  <span class="comment"># 菜鸟教程</span></span><br><span class="line"></span><br><span class="line">dict1 = {<span class="number">1</span>: <span class="string">"a"</span>, <span class="number">2</span>: [<span class="number">1</span>, <span class="number">2</span>]}</span><br><span class="line">print(dict1.pop(<span class="number">1</span>), dict1)</span><br><span class="line"><span class="comment"># a {2: [1, 2]}</span></span><br><span class="line">print(dict1.pop(<span class="number">3</span>, <span class="string">"nokey"</span>), dict1)  <span class="comment"># 设置默认值，必须添加，否则报错</span></span><br><span class="line"><span class="comment"># nokey {2: [1, 2]}</span></span><br><span class="line">print(dict1.pop(<span class="number">3</span>), dict1)  <span class="comment"># 没用设置默认值，报错</span></span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment">#   print(dict1.pop(3), dict1)</span></span><br><span class="line"><span class="comment"># KeyError: 3</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">delDict = {</span><br><span class="line">    'name': 'Ashe',</span><br><span class="line">    'age': 16,</span><br><span class="line">    'male': '男',</span><br><span class="line">    'high': 185,</span><br><span class="line">    'weight': None,</span><br><span class="line">    'address': '北京'</span><br><span class="line">}</span><br><span class="line">print(delDict.pop('age'))  # 16</span><br><span class="line">print(delDict)</span><br><span class="line"># {'name': 'Ashe', 'male': '男', 'high': 185, 'weight': None, 'address': '北京'}</span><br><span class="line">print(delDict.pop('职业', '没有此键'))  # 没有此键</span><br><span class="line"></span><br><span class="line">print(delDict.popitem())  </span><br><span class="line"># ('address', '北京') 随机删除，返回值是删除的键值对</span><br><span class="line">print(delDict)  </span><br><span class="line"># {'name': 'Ashe', 'male': '男', 'high': 185, 'weight': None}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">delDict = {'name': 'Ashe', 'male': '男', 'high': 185, 'weight': None}</span><br><span class="line">del delDict['name']</span><br><span class="line">print(delDict)  # {'male': '男', 'high': 185, 'weight': None}</span><br><span class="line"></span><br><span class="line"># 使用del清空列表</span><br><span class="line">del delDict</span><br><span class="line">print(delDict)  # NameError: name 'delDict' is not defined</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">delDict = {'name': 'Ashe', 'male': '男', 'high': 185, 'weight': None}</span><br><span class="line">print(delDict.clear())  # None</span><br><span class="line">print(delDict)  # {}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改字典</span></span><br><span class="line">x = {<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>}</span><br><span class="line">y = {<span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">4</span>}</span><br><span class="line">x.update(y)  <span class="comment"># 这里注意我是直接改变的x变量，具体根据程序逻辑来定，可以用其它变量接受。</span></span><br><span class="line">print(x)  <span class="comment"># {'a': 1, 'b': 2, 'c': 3, 'd': 4}</span></span><br><span class="line"></span><br><span class="line">x = {<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>}</span><br><span class="line">y = {<span class="string">'a'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">4</span>}</span><br><span class="line">x.update(y)  <span class="comment"># 这里注意我是直接改变的x变量，具体根据程序逻辑来定，可以用其它变量接受。</span></span><br><span class="line">print(x)  <span class="comment"># {'a': 3, 'b': 2, 'd': 4}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典合并的方法</span></span><br><span class="line">print(<span class="string">'===='</span>)</span><br><span class="line">x = {<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>}</span><br><span class="line">y = {<span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">4</span>}</span><br><span class="line"><span class="comment"># 法一</span></span><br><span class="line">z = {}</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> x.items():</span><br><span class="line">    z[k] = v</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> y.items():</span><br><span class="line">    z[k] = v</span><br><span class="line">print(z)</span><br><span class="line"><span class="comment"># {'a': 1, 'b': 2, 'c': 3, 'd': 4}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line">q = {**x, **y}</span><br><span class="line">print(q)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'^^^^^^^'</span>)</span><br><span class="line">a = {<span class="string">"A"</span>: <span class="number">1</span>, <span class="string">"B"</span>: <span class="number">2</span>}</span><br><span class="line">b = {<span class="string">"A"</span>: <span class="number">3</span>, <span class="string">"D"</span>: <span class="number">4</span>}</span><br><span class="line"></span><br><span class="line">print({**a, **b})</span><br><span class="line"><span class="comment"># {'A': 3, 'B': 2, 'D': 4}  # 这里取的是b中的A，即b覆盖了a</span></span><br><span class="line">print(<span class="string">'-----'</span>)</span><br><span class="line">print(dict(a, **b))</span><br><span class="line"><span class="comment"># {'A': 3, 'B': 2, 'D': 4}</span></span><br></pre></td></tr></tbody></table></figure>


<p>字符串</p>
<figure class="highlight plain"><figcaption><span>beg</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">str = "this is string example....wow!!!"</span><br><span class="line">print(str.startswith('this'))  </span><br><span class="line"># True 字符串是否以 this 开头</span><br><span class="line">print(str.startswith('string', 8))  </span><br><span class="line"># True 从第九个字符开始的字符串是否以 string 开头</span><br><span class="line">print(str.startswith('this', 2, 4))  </span><br><span class="line"># False 从第2个字符开始到第四个字符结束的字符串是否以 this 开头</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>beg</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">beg -- 开始索引，默认为0。</span><br><span class="line">```py</span><br><span class="line">info = 'abca'</span><br><span class="line">print(info.find('a'))  # 0 从下标0开始，查找在字符串里第一个出现的子串</span><br><span class="line">print(info.find('a', 1))  # 3 从下标1开始，查找在字符串里第一个出现的子串</span><br><span class="line">print(info.find('3'))  # -1 查找不到</span><br><span class="line"></span><br><span class="line">str1 = "Runoob example....wow!!!"</span><br><span class="line">str2 = "exam"</span><br><span class="line"></span><br><span class="line">print(str1.find(str2))  # 7</span><br><span class="line">print(str1.find(str2, 5))  # 7  第2个参数5，表示从素引5的位置开始往后查找</span><br><span class="line">print(str1.find(str2, 10))  # -1</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>方法用于截掉字符串左边的空格或指定字符。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">```str.rstrip([chars])``` 方法用于截掉字符串右边的空格或指定字符。</span><br><span class="line"></span><br><span class="line">从左到右移除字符串的指定字符，</span><br><span class="line">```.strip()```无字符集参数或为 None 时 去除首位空格</span><br><span class="line">匹配时不是按照整个字符串匹配的，而是一个个匹配的。</span><br><span class="line">移除所有属于字符集子串的字符一旦不属于则停止移除并返回字符串副本。</span><br><span class="line"></span><br><span class="line">chars --指定截取的字符。</span><br><span class="line">返回截掉字符串左边的空格或指定字符后生成的新字符串。</span><br><span class="line"></span><br><span class="line">```.strip().strip(‘-a’)```去除首位空格和字符</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">str = "     this is string example....wow!!!     "</span><br><span class="line">print(str.lstrip())</span><br><span class="line"># this is string example....wow!!!</span><br><span class="line"></span><br><span class="line">str = "88888888this is string example....wow!!!8888888"</span><br><span class="line">print(str.lstrip('8'))</span><br><span class="line"># this is string example....wow!!!8888888</span><br><span class="line"></span><br><span class="line">print('www.example.com'.lstrip('we.'))</span><br><span class="line"># xample.com</span><br><span class="line">print('www.example.com'.lstrip('we'))</span><br><span class="line"># '.example.com'</span><br><span class="line"></span><br><span class="line">print('www.example.com'.lstrip('e'))</span><br><span class="line"># 'www.example.com'</span><br><span class="line"></span><br><span class="line">print('www.example.com'.lstrip('cmowz.'))</span><br><span class="line"># 'example.com'</span><br><span class="line"></span><br><span class="line">print('www.example.com'.lstrip('cmoz.'))</span><br><span class="line"># 'www.example.com'</span><br><span class="line"></span><br><span class="line">message = "\tpython xue xi\t"</span><br><span class="line"># 每个单词的首字母大写的写法</span><br><span class="line">print(message.title())</span><br><span class="line"># 单词全部大写的写法</span><br><span class="line">print(message.upper())  </span><br><span class="line"># 单词全部小写的写法</span><br><span class="line">print(message.lower())  </span><br><span class="line"># 去除字符串前面的空白</span><br><span class="line">print(message.lstrip())</span><br><span class="line"># 去除字符串后面的空白</span><br><span class="line">print(message.rstrip())</span><br><span class="line"># 去除字符串两边的空白</span><br><span class="line">print(message.strip())</span><br><span class="line">#         Python Xue Xi</span><br><span class="line">#         PYTHON XUE XI</span><br><span class="line">#         python xue xi</span><br><span class="line"># python xue xi        </span><br><span class="line">#         python xue xi</span><br><span class="line"># python xue xi    </span><br></pre></td></tr></tbody></table></figure>

<p>S[:3]+S[5:] 拼接字符串，去除某个字符</p>
<figure class="highlight plain"><figcaption><span>替换字符</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```re.sub(‘a’,’b’,s)``` 替换字符</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```ord(a)```它以一个字符（长度为1）作为参数，返回对应的 ASCII 数值(返回值是对应的十进制整数)，或者 Unicode 数值，</span><br><span class="line">如果所给的 Unicode 字符超出了你的 Python 定义范围，则会引发一个 TypeError 的异常。</span><br><span class="line">因为python里不像C++那样两个字符相减可以求出ASCII数值差</span><br><span class="line"></span><br><span class="line">```chr(a)``` 函数（对于8位的ASCII字符串）或 unichr() 函数（对于Unicode对象）的配对函数 是ord的逆过程，将ASCII值转化成该编码对应的字符</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">print(ord(' '), type(ord(' ')))  # 32 &lt;class 'int'&gt; 空格的ascii码</span><br><span class="line">print(ord('0'))  # 48</span><br><span class="line">print(ord('1'))  # 49</span><br><span class="line">print(ord('2'))  # 50</span><br><span class="line">print(ord('2'), type(ord('2')))  # 50  &lt;class 'int'&gt;</span><br><span class="line">print(ord('3'))  # 51</span><br><span class="line"># print(ord('10')) TypeError: ord() expected a character, but string of length 2 found</span><br><span class="line">print(ord('A'))  # 65</span><br><span class="line">print(ord('B'))  # 66</span><br><span class="line">print(ord('C'))  # 67</span><br><span class="line">print(ord('a'))  # 97</span><br><span class="line">print(ord('b'))  # 98</span><br><span class="line">print(ord('c'))  # 99</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(chr(<span class="number">32</span>))  <span class="comment"># 空格</span></span><br><span class="line">print(chr(<span class="number">50</span>), type(chr(<span class="number">50</span>)))  <span class="comment"># 2  &lt;class 'str'&gt;</span></span><br><span class="line">print(chr(<span class="number">65</span>))  <span class="comment"># A</span></span><br><span class="line">print(chr(<span class="number">97</span>))  <span class="comment"># a</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>方法返回"标题化"的字符串，就是说所有单词的首个字母转化为大写，其余字母均为小写</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">返回"标题化"的字符串,就是说所有单词的首字母都转化为大写。</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">str = "this is string example from runoob....wow!!!"</span><br><span class="line">print(str.title())</span><br><span class="line"># This Is String Example From Runoob....Wow!!! </span><br></pre></td></tr></tbody></table></figure>

<p>非字母后的第一个字母将转换为大写字母：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">txt = <span class="string">"hello b2b2b2 and 3g3g3g"</span></span><br><span class="line">print(txt.title())  <span class="comment"># Hello B2B2B2 And 3G3G3G</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>str.split(str="", num=string.count(str))</code><br>通过指定分隔符对字符串进行切片，不是对列表对象切片<br>返回分割后的字符串列表。<br>如果第二个参数 num 有指定值，则分割为 num+1 个子字符串。<br>str – 分隔符，默认为所有的空字符，包括空格、换行(\n)、制表符(\t)等。<br>num – 分割次数。默认为 -1, 即分隔所有。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">"http://www.baidu.com/python/image/123456.jpg"</span></span><br><span class="line">print(url.split())  <span class="comment"># 以空格为分隔符</span></span><br><span class="line"><span class="comment"># ['http://www.baidu.com/python/image/123456.jpg']</span></span><br><span class="line">print(url.split(<span class="string">"/"</span>))  <span class="comment"># 以“/” 进行分隔</span></span><br><span class="line"><span class="comment"># ['http:', '', 'www.baidu.com', 'python', 'image', '123456.jpg']</span></span><br><span class="line">print(url.split(<span class="string">'/'</span>, <span class="number">1</span>))  <span class="comment"># 以 / 为分隔符，分割为2个字符串列表</span></span><br><span class="line"><span class="comment"># ['http:', '/www.baidu.com/python/image/123456.jpg']</span></span><br><span class="line">print(url.split(<span class="string">"/"</span>)[<span class="number">-1</span>])  <span class="comment"># 分隔符分割后列表最后一个元素(字符串类型），图片名称的获取</span></span><br><span class="line"><span class="comment"># 123456.jpg</span></span><br><span class="line">print(url.split(<span class="string">"/"</span>)[<span class="number">0</span>])  <span class="comment"># 分隔符分割后列表第一个元素(字符串类型）</span></span><br><span class="line"><span class="comment"># http:</span></span><br><span class="line">print(url[<span class="number">1</span>:<span class="number">-1</span>], type(url[<span class="number">1</span>:<span class="number">-1</span>]))  <span class="comment"># 切片，去除第一个和最后一个元素</span></span><br><span class="line"><span class="comment"># ttp://www.baidu.com/python/image/123456.jp &lt;class 'str'&gt;</span></span><br><span class="line">print(url[<span class="number">1</span>:<span class="number">-1</span>].split(<span class="string">"/"</span>)[<span class="number">0</span>])  <span class="comment"># 列表第一个元素(字符串类型）</span></span><br><span class="line"><span class="comment"># ttp:</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">"[http://www.baidu.com/python/image/123456.jpg]"</span></span><br><span class="line">print(url[:], type(url[:]))</span><br><span class="line"><span class="comment"># [http://www.baidu.com/python/image/123456.jpg] &lt;class 'str'&gt;</span></span><br><span class="line">print(url[:].split(<span class="string">"/"</span>)[<span class="number">0</span>])  <span class="comment"># 列表第一个元素(字符串类型）</span></span><br><span class="line"><span class="comment"># [http:</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">'[1, 2, 3, null, 4, 5, null]'</span></span><br><span class="line">print(data[<span class="number">1</span>:<span class="number">-1</span>], type(data[<span class="number">1</span>:<span class="number">-1</span>]))</span><br><span class="line"><span class="comment"># 1, 2, 3, null, 4, 5, null &lt;class 'str'&gt;</span></span><br><span class="line">print(data[<span class="number">1</span>:<span class="number">-1</span>].split(<span class="string">','</span>), type(data[<span class="number">1</span>:<span class="number">-1</span>].split(<span class="string">','</span>)))</span><br><span class="line"><span class="comment"># ['1', ' 2', ' 3', ' null', ' 4', ' 5', ' null'] &lt;class 'list'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>str.splitlines([keepends])</code><br>按照行(‘\r’, ‘\r\n’, \n’)分隔，返回一个包含各行作为元素的列表，<br>keepends – 在输出结果里是否去掉换行符(‘\r’, ‘\r\n’, \n’)，<br>默认为 <code>False</code>，不包含换行符，<br>如果为 <code>True</code>，则保留换行符。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'ab c\n\nde fg\rkl\r\n'</span>.splitlines())</span><br><span class="line"><span class="comment"># ['ab c', '', 'de fg', 'kl']</span></span><br><span class="line">print(<span class="string">'ab c\n\nde fg\rkl\r\n'</span>.splitlines(<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># ['ab c\n', '\n', 'de fg\r', 'kl\r\n']</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="39-sep-39-join-seq"><a href="#39-sep-39-join-seq" class="headerlink" title="'sep'.join(seq)"></a><code>'sep'.join(seq)</code></h3><p>以sep作为分隔符，将seq所有的元素合并成一个新的字符串<br>将字符串、元组、列表中的元素以指定的字符(分隔符)连接生成一个新的字符串</p>
<p>参数说明<br>sep：分隔符。string（字符串），可以为空<br>seq：要连接的元素列表、字符串、元组、字典<br>返回值：返回一个以分隔符sep连接各个元素后生成的字符串</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对字符串进行操作</span></span><br><span class="line">print(<span class="string">':'</span>.join(<span class="string">"hello good boy "</span>))</span><br><span class="line"><span class="comment"># h:e:l:l:o: :g:o:o:d: :b:o:y:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用字符串把字符串列表里的字符串连接起来</span></span><br><span class="line"><span class="comment"># 用空字符串''隔开</span></span><br><span class="line">print(<span class="string">''</span>.join([<span class="string">"hello"</span>, <span class="string">"world"</span>, <span class="string">"!"</span>]))  <span class="comment"># helloworld!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用' '隔开，用空格</span></span><br><span class="line">print(<span class="string">' '</span>.join([<span class="string">"hello"</span>, <span class="string">"world"</span>, <span class="string">"!"</span>]))  <span class="comment"># hello world !</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用'-'隔开</span></span><br><span class="line">print(<span class="string">'-'</span>.join([<span class="string">"hello"</span>, <span class="string">"world"</span>, <span class="string">"!"</span>]))  <span class="comment"># hello-world-!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对元组进行操作</span></span><br><span class="line">seq3 = (<span class="string">'hello'</span>, <span class="string">'good'</span>, <span class="string">'boy'</span>)</span><br><span class="line">print(<span class="string">':'</span>.join(seq3))</span><br><span class="line"><span class="comment"># hello:good:boy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对字典进行操作</span></span><br><span class="line">seq4 = {<span class="string">'hello'</span>: <span class="number">1</span>, <span class="string">'good'</span>: <span class="number">2</span>, <span class="string">'boy'</span>: <span class="number">3</span>}</span><br><span class="line">print(<span class="string">':'</span>.join(seq4))</span><br><span class="line"><span class="comment"># hello:good:boy</span></span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/vue-shi-zhan-xiang-mu-da-jian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/vue-shi-zhan-xiang-mu-da-jian/" class="post-title-link" itemprop="url">Vue实战项目搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-04 15:09:22" itemprop="dateModified" datetime="2021-04-04T15:09:22Z">2021-04-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="项目的搭建"><a href="#项目的搭建" class="headerlink" title="项目的搭建"></a>项目的搭建</h3><ul>
<li>项目公共的配置（ajax配置、项目结构、目录等）</li>
<li>前后端通信方式（接口规范、错误码等）</li>
</ul>
<h3 id="开发的流程"><a href="#开发的流程" class="headerlink" title="开发的流程"></a>开发的流程</h3><ul>
<li>【前端】实现页面（组件）</li>
<li>【前端】使用假数据，或者是mock数据</li>
<li>【后端】模型分析，建模</li>
<li>【后端】实现接口</li>
<li>【前/后端】接口文档编写</li>
<li>【前/后端】接口联调(对接)</li>
</ul>
<h3 id="实战项目搭建"><a href="#实战项目搭建" class="headerlink" title="实战项目搭建"></a>实战项目搭建</h3><p>操作步骤</p>
<ul>
<li>第一步，使用Vue CLI 搭建项目</li>
<li>第二步，准备好静态资源（图片资源）</li>
<li>第三步，调整生产项目结构</li>
</ul>
<p>项目结构</p>
<ul>
<li>公共的样式<br><code>src/assets/common.less</code></li>
<li>公共js（工具函数、接口地址、配置文件），方便管理api请求的各种逻辑<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口地址配置 对后端进行请求</span></span><br><span class="line"><span class="selector-tag">src</span>/<span class="selector-tag">utils</span>/<span class="selector-tag">apis</span><span class="selector-class">.js</span></span><br><span class="line"><span class="comment">// 常量配置</span></span><br><span class="line"><span class="selector-tag">src</span>/<span class="selector-tag">utils</span>/<span class="selector-tag">constants</span><span class="selector-class">.js</span></span><br><span class="line"><span class="comment">// 工具函数</span></span><br><span class="line"><span class="selector-tag">src</span>/<span class="selector-tag">utils</span>/<span class="selector-tag">filters</span><span class="selector-class">.js</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>首页拆解<br>操作步骤</p>
<ul>
<li>第一步，分析首页的结构</li>
<li>第二步，新建页面</li>
<li>第三步，新建对应组件</li>
</ul>
<p>首页组件拆分</p>
<ul>
<li>标题</li>
<li>轮播图（Banner图）</li>
<li>本周推荐</li>
<li>精选景点</li>
<li>底部导航<br>如果组件很多地方都用到过，应该放在<code>/src/component/common</code><br>如果只有某一个页面用到，应该放在<code>/src/component/home</code></li>
</ul>
<h3 id="为何不能在Vue-js中使用AJAX"><a href="#为何不能在Vue-js中使用AJAX" class="headerlink" title="为何不能在Vue.js中使用AJAX"></a>为何不能在Vue.js中使用AJAX</h3><ul>
<li>Ajax是通过浏览器后台与服务器通信的技术</li>
<li>jQuery 中的AJAX只是基于jQuery的实现</li>
<li>在Vue.js中使用jQuery不能充分利用Vue.js的特性</li>
</ul>
<h3 id="axios异步请求库"><a href="#axios异步请求库" class="headerlink" title="axios异步请求库"></a>axios异步请求库</h3><ul>
<li>基于Promise的HTTP库</li>
<li>支持Node.js和浏览器</li>
<li>浏览器：XMLHttpRequest</li>
<li>Node.js：http</li>
</ul>
<p>对axios进行全局配置可提升代码的可维护性</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul>
<li>一种异步编程解决方案</li>
<li>Promise其实一直都在，只是在ES6时，才被并入标准库</li>
</ul>
<h3 id="处理回调"><a href="#处理回调" class="headerlink" title="处理回调"></a>处理回调</h3><ul>
<li><code>then</code>函数的使用<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line"><span class="comment">// 业务逻辑</span></span><br><span class="line">resolve(<span class="number">1</span>);</span><br><span class="line">}).then(<span class="function"><span class="params">res</span> =&gt;</span> {</span><br><span class="line"><span class="comment">// 你的代码1</span></span><br><span class="line">}) .then(<span class="function"><span class="params">res</span> =&gt;</span> {</span><br><span class="line"><span class="comment">// 你的代码2</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="处理异常"><a href="#处理异常" class="headerlink" title="处理异常"></a>处理异常</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">```js</span><br><span class="line">new Promise((resolve, reject) =&gt; {</span><br><span class="line">    // 业务逻辑</span><br><span class="line">    reject(throw new Error('It is my fault'))</span><br><span class="line">    }) .then(res =&gt; {</span><br><span class="line">        // 正常的逻辑代码</span><br><span class="line">    }).catch(err =&gt; {</span><br><span class="line">        // 产生异常后执行的代码</span><br><span class="line">    })</span><br></pre></td></tr></tbody></table></figure>

<p>如何安装</p>
<ul>
<li>方式一：引用JS<br><code>&lt;script src="./axios.min.js"&gt;&lt;/script&gt;</code></li>
<li>方式二：使用npm/cnpm/yarn安装<br><code>npm install axios -S</code></li>
</ul>
<h3 id="使用npm-cnpm安装"><a href="#使用npm-cnpm安装" class="headerlink" title="使用npm/cnpm安装"></a>使用npm/cnpm安装</h3><ul>
<li><p>安装到dependencies（生产环境依赖）<br><code>npm install axios --save</code><br>或者<code>npm install axios -S</code></p>
</li>
<li><p>安装到devDependencies（开发环境依赖）<br><code>npm install axios --save-dev</code><br>或者<code>npm install axios -D</code></p>
</li>
</ul>
<h3 id="如何使用axios"><a href="#如何使用axios" class="headerlink" title="如何使用axios"></a>如何使用axios</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios.get(url[, config])</span><br><span class="line">axios.delete(url[, config])</span><br><span class="line">axios.head(url[, config])</span><br><span class="line">axios.options(url[, config])</span><br><span class="line">axios.post(url[, data[, config]])</span><br><span class="line">axios.put(url[, data[, config]])</span><br><span class="line">axios.patch(url[, data[, config]])</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>GET请求</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">'/user'</span>, {</span><br><span class="line">    params: {</span><br><span class="line">        ID: <span class="number">12345</span></span><br><span class="line">    }</span><br><span class="line">})</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">})</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>POST请求</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.post(<span class="string">'/user'</span>, {</span><br><span class="line">    firstName: <span class="string">'Fred'</span>,</span><br><span class="line">    lastName: <span class="string">'Flintstone'</span></span><br><span class="line">})</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">})</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="请求响应拦截"><a href="#请求响应拦截" class="headerlink" title="请求响应拦截"></a>请求响应拦截</h3><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>设置自定义请求头</li>
<li>默认携带上次的cookie</li>
<li>添加loading动画（请求发起前显示、完成后隐藏）</li>
<li>统一的错误处理</li>
</ul>
<h4 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h4><ul>
<li>创建axios的实例<br><code>const ajax = axios.create(options)</code></li>
<li>常用参数<ul>
<li><code>headers</code>: 设置请求头</li>
<li><code>timeout</code>: 超时的毫秒数</li>
<li><code>data</code>: POST/PUT/PATCH请求的数据</li>
<li><code>params</code>: URL中的参数</li>
<li><code>responseType</code>: 默认为json</li>
</ul>
</li>
</ul>
<h4 id="设置自定义请求头"><a href="#设置自定义请求头" class="headerlink" title="设置自定义请求头"></a>设置自定义请求头</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajax = axios.create({</span><br><span class="line">headers: {</span><br><span class="line">source: <span class="string">'h5'</span>,</span><br><span class="line"><span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span></span><br><span class="line">}</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<h4 id="默认携带上次的cookie"><a href="#默认携带上次的cookie" class="headerlink" title="默认携带上次的cookie"></a>默认携带上次的cookie</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajax = axios.create({</span><br><span class="line">    withCredentials: <span class="literal">true</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<h4 id="添加loading动画"><a href="#添加loading动画" class="headerlink" title="添加loading动画"></a>添加loading动画</h4><ul>
<li><p> 请求拦截</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>{</span><br><span class="line"><span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line"><span class="keyword">return</span> config</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line"><span class="comment">// 对请求错误做些什么</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p> 响应拦截</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line"><span class="comment">// 对响应数据做点什么</span></span><br><span class="line"><span class="keyword">return</span> response</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line"><span class="comment">// 对响应错误做点什么</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h4 id="统一的错误处理"><a href="#统一的错误处理" class="headerlink" title="统一的错误处理"></a>统一的错误处理</h4><ul>
<li>400<br>参数错误提示</li>
<li>401<br>未登录，跳转到登录页面</li>
<li>500/504<br>服务器正忙，网络异常/请求超时</li>
</ul>
<h3 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h3><p>前后端联调，涉及最多的就是跨域的问题，<br>出于安全考虑，浏览器要求你的网站不能执行/访问其它网站的资源</p>
<ul>
<li>如何认定为“其它的网站”：<br>通常需要遵循同源策略，即“协议、域名/主机、端口”三者都相同</li>
</ul>
<ul>
<li><p>跨域的影响</p>
<ul>
<li>浏览器本地存储无法使用<br>（Cookie、LocalStorage 和 IndexDB）</li>
<li>DOM对象 、JS 对象无法获取</li>
<li>AJAX无法使用</li>
</ul>
</li>
<li><p>跨域问题解决</p>
<ul>
<li>利用HTML标签的特性<br>script、a、iframe、img、link等</li>
<li>在前端使用代理解决</li>
<li>在服务器端解决<br>CORS(Cross-Origin Resource Sharing)——跨域资源共享，通过添加响应头信息来解决</li>
</ul>
</li>
</ul>
<h4 id="在Vue-js中解决跨域问题"><a href="#在Vue-js中解决跨域问题" class="headerlink" title="在Vue.js中解决跨域问题"></a>在Vue.js中解决跨域问题</h4><ul>
<li>添加配置文件<code>vue.config.js</code><br>添加配置项<br>参数解释</li>
<li> <code>target</code>目标地址</li>
<li> <code>changeOrigin</code>变更请求头中设置的host</li>
<li> <code>pathRewrite</code>URL重写规则<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="comment">// Node.js里面的模块</span></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  <span class="comment">// http://localhost:8080/api/test</span></span><br><span class="line">  <span class="comment">// =&gt;</span></span><br><span class="line">  <span class="comment">// http://localhost:8000/test</span></span><br><span class="line">  <span class="comment">// 在Vue.js中解决跨域问题</span></span><br><span class="line">  devServer: {</span><br><span class="line">    proxy: {</span><br><span class="line">      <span class="string">'/api'</span>: {</span><br><span class="line">        target: <span class="string">'http://django.t.mukewang.com'</span>,    <span class="comment">// 这个地址的服务器要启动才能访问 </span></span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        pathRewrite: {</span><br><span class="line">          <span class="string">'^/api'</span>: <span class="string">''</span>   <span class="comment">// 重写的URL，空字符表示把/api字符串去掉</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>使用axios获取数据</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Home.vue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  name: <span class="string">'Home'</span>,</span><br><span class="line">  components: {</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    <span class="comment">// ajax.get('http://django.t.mukewang.com/api/system/slider/list/?types=11').then(resp =&gt; {</span></span><br><span class="line">    <span class="comment">// 未登录访问用户信息</span></span><br><span class="line">    <span class="comment">// ajax.get('http://django.t.mukewang.com/api/accounts/user/detail/').then(resp =&gt; {</span></span><br><span class="line">    <span class="comment">// ajax.get('http://localhost:8080/api/system/slider/list/?types=11').then(resp =&gt; {</span></span><br><span class="line">    <span class="comment">// ajax.get('http://localhost:9527/hello/world/').then(resp =&gt; {</span></span><br><span class="line">    ajax.get(<span class="string">'http://localhost:8080/test/hello/world/'</span>).then(<span class="function"><span class="params">resp</span> =&gt;</span> {</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'返回的结果：'</span>, resp)</span><br><span class="line">    }).catch(<span class="function"><span class="params">err</span> =&gt;</span> {</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'请求出错：'</span>, err)</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="在Django中解决跨域问题"><a href="#在Django中解决跨域问题" class="headerlink" title="在Django中解决跨域问题"></a>在Django中解决跨域问题</h4><ul>
<li><p> 第一步：安装第三方模块 <code>django-cors-headers</code>来解决</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; pip install django-cors-headers</span><br></pre></td></tr></tbody></table></figure></li>
<li><p> 第二步：配置django的<code>setting.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [<span class="string">'corsheaders'</span>,]</span><br><span class="line"></span><br><span class="line">MIDDLEWARE_CLASSES = [</span><br><span class="line"><span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line"><span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line"><span class="string">'corsheaders.middleware.CorsMiddleware'</span>,</span><br><span class="line"><span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第三步：添加白名单</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setting.py</span></span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line"><span class="string">'http://127.0.0.1:8080'</span>,</span><br><span class="line"><span class="string">'http://localhost:8080'</span>,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>第五步：可选配置</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setting.py</span></span><br><span class="line"><span class="comment"># 允许哪些请求头</span></span><br><span class="line">CORS_ALLOW_HEADERS = (<span class="string">'source'</span>, <span class="string">'icode'</span>)</span><br><span class="line"><span class="comment"># 允许携带cookie</span></span><br><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 支持跨域配置开始</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="VantUI"><a href="#VantUI" class="headerlink" title="VantUI"></a>VantUI</h3><ul>
<li>开源免费</li>
<li>轻量、可靠的移动端 Vue 组件库</li>
</ul>
<h4 id="Vant组件库"><a href="#Vant组件库" class="headerlink" title="Vant组件库"></a>Vant组件库</h4><ul>
<li>基础组件<br>按钮、图标、布局、提示信息等</li>
<li>表单组件<br>日历、复选框、时间选择、输入框、评分等</li>
<li>反馈组件<br>弹出框、加载、下拉菜单、消息提示、下拉刷新、滚动加载等</li>
<li>展示组件<br>进度条、倒计时、分割线、懒加载、列表等</li>
<li>导航组件<br>宫格、索引、导航栏、分页、多标签页等</li>
<li>业务组件<br>地址编辑、联系人、优惠券、提交订单、SKU选择框等</li>
</ul>
<h3 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h3><ul>
<li><p>第一步：安装<br><code>&gt;&gt; cnpm install vant -S</code></p>
</li>
<li><p>第二步：手动按需导入组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'vant/lib/button'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'vant/lib/button/style'</span>;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  name: <span class="string">'Home'</span>,</span><br><span class="line">  components: {</span><br><span class="line">    <span class="string">'v-button'</span>: Button</span><br><span class="line">    <span class="comment">// Button: Button</span></span><br><span class="line">  }</span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第二步：导入全部组件，全局引用<br><code>main.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> Vant <span class="keyword">from</span> <span class="string">'vant'</span>;  <span class="comment">// VantUI组件库</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'vant/lib/index.css'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vant);  <span class="comment">// 把VantUI当做一个插件，在Vue中使用</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="轮播图组件开发"><a href="#轮播图组件开发" class="headerlink" title="轮播图组件开发"></a>轮播图组件开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，查找Vant中可以使用的组件</li>
<li>第二步，实现组件模板部分<br><code>\src\components\common\Banner.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!-- 首页的轮播图 --&gt;</span><br><span class="line">  &lt;div class="home-banner-box"&gt;</span><br><span class="line">    &lt;van-swipe class="my-swipe" :autoplay="3000" indicator-color="white"&gt;</span><br><span class="line">      &lt;van-swipe-item v-for="item in bannerList"</span><br><span class="line">        :key="item.id"&gt;</span><br><span class="line">        &lt;img :src="item.img_url" alt=""&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line">    &lt;/van-swipe&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<code>Home.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="page-home"&gt;</span><br><span class="line">    &lt;!-- banner图 --&gt;</span><br><span class="line">    &lt;Banner/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 引入组件</span><br><span class="line">import Banner from '@/components/home/Banner'</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: 'Home',</span><br><span class="line">  components: {</span><br><span class="line">    // banner图</span><br><span class="line">    Banner,</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li>第三步，模型层准备数据，通过接口的方式从django服务器获取<br><code>\src\components\common\Banner.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SystemApis } from '@/utils/apis'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      bannerList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 获取轮播图的数据</span><br><span class="line">     */</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SystemApis.sliderListUrl).then(res =&gt; {</span><br><span class="line">        console.log('res:', res)</span><br><span class="line">        this.bannerList = res.data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    // 从接口获取数据</span><br><span class="line">    this.getDataList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li>第四步，模拟数据，实现轮播效果</li>
</ul>
<h3 id="热门推荐组件开发"><a href="#热门推荐组件开发" class="headerlink" title="热门推荐组件开发"></a>热门推荐组件开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li><p>第一步，查找Vant中可以使用的组件</p>
</li>
<li><p>第二步，完成布局，实现组件模板部分<br><code>\src\components\common\Hot.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 热门景点 --&gt;</span><br><span class="line">  &lt;div class="home-hot-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      title="热门推荐"</span><br><span class="line">      icon="/static/home/hot/fire.png"</span><br><span class="line">      is-link</span><br><span class="line">      title-style="text-align:left"</span><br><span class="line">      value="全部榜单" /&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">    &lt;!-- 景点列表 --&gt;</span><br><span class="line">    &lt;div class="box-main"&gt;</span><br><span class="line">      &lt;a href="#" class="hot-item"</span><br><span class="line">        v-for="item in dataList"</span><br><span class="line">        :key="item.id"&gt;</span><br><span class="line">        &lt;div class="img"&gt;</span><br><span class="line">          &lt;span&gt;&lt;/span&gt;</span><br><span class="line">          &lt;img :src="item.main_img" alt=""&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- ellipsis 省略号 意思是超过一定长度变成省略号 --&gt;</span><br><span class="line">        &lt;h5 class="van-ellipsis"&gt;{{ item.name }}&lt;/h5&gt;</span><br><span class="line">        &lt;div class="line-price"&gt;</span><br><span class="line">          &lt;span class="price"&gt;￥{{ item.min_price }}&lt;/span&gt;起</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //景点列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><code>Home.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="page-home"&gt;</span><br><span class="line">    &lt;!-- 热门推荐景点 --&gt;</span><br><span class="line">    &lt;Hot/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 引入组件</span><br><span class="line">import Hot from '@/components/home/Hot'</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: 'Home',</span><br><span class="line">  components: {</span><br><span class="line">    // 热门推荐景点</span><br><span class="line">    Hot,</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第三步，模型层准备数据<br><code>\src\components\common\Hot.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      dataList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 查热门景点</span><br><span class="line">     */</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          is_hot: 1</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        this.dataList = data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    // 查询获取接口数据</span><br><span class="line">    this.getDataList()</span><br><span class="line">    // this.dataList = [</span><br><span class="line">    //   {id: 1, img: '/static/home/hot/h1.jpg', name: '景点名称', price: 65},</span><br><span class="line">    //   {id: 2, img: '/static/home/hot/h2.jpg', name: '景点名称景点名称', price: 65},</span><br><span class="line">    //   {id: 3, img: '/static/home/hot/h3.jpg', name: '景点名称', price: 65},</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第四步，添加假数据，实现效果</p>
</li>
</ul>
<h3 id="景点列表组件开发"><a href="#景点列表组件开发" class="headerlink" title="景点列表组件开发"></a>景点列表组件开发</h3><h4 id="开发步骤-2"><a href="#开发步骤-2" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，分析组件的复用情况</li>
<li>第二步，新建组件文件，实现组件内容<br><code>\src\components\common\ListSight.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 精选景点 --&gt;</span><br><span class="line">  &lt;div class="home-fine-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      title="精选景点"</span><br><span class="line">      icon="location-o"</span><br><span class="line">      is-link</span><br><span class="line">      title-style="text-align:left"</span><br><span class="line">      value="更多" /&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">    &lt;!-- 景点的列表 --&gt;</span><br><span class="line">    &lt;div class="box-main"&gt;</span><br><span class="line">      &lt;!-- ```src\components\common\ListSight.vue```子组件的 --&gt;</span><br><span class="line">      &lt;sight-item v-for="item in dataList"</span><br><span class="line">        :key="item.id"</span><br><span class="line">        :item="item"/&gt;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //景点的列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li>第三步，设置props,从父组件传递数据<br><code>\src\components\common\ListSight.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  props: ['item']</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="精选景点组件开发"><a href="#精选景点组件开发" class="headerlink" title="精选景点组件开发"></a>精选景点组件开发</h3><h4 id="开发步骤-3"><a href="#开发步骤-3" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，查找Vant中可以使用的组件</li>
<li>第二步，完成布局，实现组件模板部分</li>
</ul>
<p><code>\src\components\common\Fine.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 精选景点 --&gt;</span><br><span class="line">  &lt;div class="home-fine-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      title="精选景点"</span><br><span class="line">      icon="location-o"</span><br><span class="line">      is-link</span><br><span class="line">      title-style="text-align:left"</span><br><span class="line">      value="更多" /&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">    &lt;!-- 景点的列表 --&gt;</span><br><span class="line">    &lt;div class="box-main"&gt;</span><br><span class="line">      &lt;!-- ```src\components\common\ListSight.vue```子组件的 --&gt;</span><br><span class="line">      &lt;sight-item v-for="item in dataList"</span><br><span class="line">        :key="item.id"</span><br><span class="line">        :item="item"/&gt;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //景点的列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><code>Home.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="page-home"&gt;</span><br><span class="line">    &lt;!-- 精选景点 --&gt;</span><br><span class="line">    &lt;Fine/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 引入组件</span><br><span class="line">import Fine from '@/components/home/Fine'</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: 'Home',</span><br><span class="line">  components: {</span><br><span class="line">    // 精选景点</span><br><span class="line">    Fine,</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>第三步，模型层准备数据,从父组件传递数据<br><code>\src\components\common\Fine.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">import SightItem from '@/components/common/ListSight'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    SightItem</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      dataList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 查精选景点</span><br><span class="line">     */</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          is_top: 1</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        this.dataList = data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.getDataList()</span><br><span class="line">    // this.dataList = [</span><br><span class="line">    //   {id: 1, name: '景点名称', score: 5, price: 98},</span><br><span class="line">    //   {id: 2, name: '景点名称', score: 4.5, price: 98},</span><br><span class="line">    //   {id: 3, name: '景点名称', score: 4, price: 98},</span><br><span class="line">    // ]</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第四步，添加假数据，实现效果</p>
</li>
</ul>
<h3 id="页面底部组件开发"><a href="#页面底部组件开发" class="headerlink" title="页面底部组件开发"></a>页面底部组件开发</h3><h4 id="开发步骤-4"><a href="#开发步骤-4" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，查找Vant中可以使用的组件</li>
<li>第二步，完成布局，实现组件模板部分<br><code>\src\components\common\Footer.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 底部导航（公共组件） --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;van-tabbar v-model="active"&gt;</span><br><span class="line">      &lt;van-tabbar-item name="home" icon="wap-home-o"&gt;首页&lt;/van-tabbar-item&gt;</span><br><span class="line">      &lt;van-tabbar-item name="search" icon="search"&gt;搜索&lt;/van-tabbar-item&gt;</span><br><span class="line">      &lt;van-tabbar-item name="mine" icon="user-o"&gt;我的&lt;/van-tabbar-item&gt;</span><br><span class="line">    &lt;/van-tabbar&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<code>Home.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class="page-home"&gt;</span><br><span class="line">    &lt;!-- 热门推荐景点 --&gt;</span><br><span class="line">    &lt;Hot/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 引入组件</span><br><span class="line">import TripFooter from '@/components/common/Footer'</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: 'Home',</span><br><span class="line">  components: {</span><br><span class="line">    // 底部导航</span><br><span class="line">    TripFooter</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li>第三步，模型层准备数据<br><code>\src\components\common\Footer.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      active: 'home'</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li>第四步，模拟从不同的菜单进入效果</li>
</ul>
<h3 id="模型设计"><a href="#模型设计" class="headerlink" title="模型设计"></a>模型设计</h3><ul>
<li>系统模块（公共的、可服用）：轮播图、用户反馈</li>
<li>景点模块：景点、景点详情、景点评论</li>
<li>用户模块：用户、用户详细信息、登录历史</li>
<li>订单模块：订单、订单明细、支付相关</li>
</ul>
<h3 id="设计轮播图ORM模型"><a href="#设计轮播图ORM模型" class="headerlink" title="设计轮播图ORM模型"></a>设计轮播图ORM模型</h3><h4 id="开发步骤-5"><a href="#开发步骤-5" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li><p>第一步，分析并设计数据库模型<br>创建app</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp system</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第二步，完成ORM模型编码<br><code>system/model.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Slider</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    types = models.SmallIntegerField(<span class="string">'展现的位置'</span>, default=<span class="number">10</span>)</span><br><span class="line">    img = models.ImageField(<span class="string">'图片地址'</span>, max_length=<span class="number">255</span>, upload_to=<span class="string">'%Y%m/slider'</span>)</span><br><span class="line">    reorder = models.SmallIntegerField(<span class="string">'排序字段'</span>, default=<span class="number">0</span>, help_text=<span class="string">'数字越大越靠前'</span>)</span><br><span class="line">    start_time = models.DateTimeField(<span class="string">'生效开始时间'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    end_time = models.CharField(<span class="string">'生效结束时间'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    target_url = models.CharField(<span class="string">'跳转的地址'</span>, max_length=<span class="number">255</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_valid = models.BooleanField(<span class="string">'是否有效'</span>, default=<span class="literal">True</span>)</span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated_at = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'system_slider'</span></span><br><span class="line">        ordering = [<span class="string">'-reorder'</span>]</span><br></pre></td></tr></tbody></table></figure>
<p><code>system/setting.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [<span class="string">'system.apps.SystemConfig'</span>,]</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>第三步，检测ORM模型</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">python manage.py check</span><br><span class="line">``` </span><br><span class="line">- 第四步，模型同步</span><br><span class="line">```bash</span><br><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 设计轮播图查询接口</span></span><br><span class="line"><span class="comment">#### 开发步骤</span></span><br><span class="line">- 第一步，设计接口返回标准</span><br><span class="line">   - 定义接口的返回结构</span><br><span class="line">   - 接口的错误信息约定</span><br><span class="line">- 第二步，编写接口代码</span><br><span class="line">```system/views.py```</span><br><span class="line">```python</span><br><span class="line">from django import http</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line">from system.models import Slider</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def slider_list(request):</span><br><span class="line">    <span class="string">""</span><span class="string">" 轮播图接口</span></span><br><span class="line"><span class="string">    {</span></span><br><span class="line"><span class="string">        "</span>meta<span class="string">": {},</span></span><br><span class="line"><span class="string">        "</span>objects<span class="string">": []</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    data = {</span><br><span class="line">        <span class="string">'meta'</span>: {</span><br><span class="line"></span><br><span class="line">        },</span><br><span class="line">        <span class="string">'objects'</span>: []</span><br><span class="line">    }</span><br><span class="line">    queryset = Slider.objects.filter(is_valid=True)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> queryset:</span><br><span class="line">        data[<span class="string">'objects'</span>].append({</span><br><span class="line">            <span class="string">'id'</span>: item.id,</span><br><span class="line">            <span class="string">'img_url'</span>: item.img.url,</span><br><span class="line">            <span class="string">'target_url'</span>: item.target_url,</span><br><span class="line">            <span class="string">'name'</span>: item.name</span><br><span class="line">        })</span><br><span class="line">    <span class="comment"># return HttpResponse(data)</span></span><br><span class="line">    <span class="built_in">return</span> http.JsonResponse(data)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>system/url.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> system <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'slider/list/'</span>, views.slider_list, name=<span class="string">"slider_list"</span>),</span><br><span class="line">]</span><br><span class="line">```  </span><br><span class="line">```trip/url.py```</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 系统模块</span></span><br><span class="line">    path(<span class="string">'system/'</span>, include(<span class="string">'system.urls'</span>)),</span><br><span class="line">]</span><br><span class="line">``` </span><br><span class="line">- 第三步，模拟HTTP请求，测试验证接口</span><br><span class="line"></span><br><span class="line"><span class="comment">### 设计景点ORM模型</span></span><br><span class="line"><span class="comment">#### 开发步骤</span></span><br><span class="line">- 第一步，分析并设计模型</span><br><span class="line">景点简单信息、景点详细信息</span><br><span class="line">```py</span><br><span class="line">python manage.py startapp sight</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>第二步，完成ORM模型编码<br><code>sight/model.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sight</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 景点基础信息 """</span></span><br><span class="line"></span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    main_img = models.ImageField(<span class="string">'主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    banner_img = models.ImageField(<span class="string">'详情主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    content = models.TextField(<span class="string">'详细'</span>)</span><br><span class="line">    score = models.FloatField(<span class="string">'评分'</span>, default=<span class="number">5</span>)</span><br><span class="line">    min_price = models.FloatField(<span class="string">'最低价格'</span>, default=<span class="number">0</span>)</span><br><span class="line">    province = models.CharField(<span class="string">'省份'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    city = models.CharField(<span class="string">'市区'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    area = models.CharField(<span class="string">'区/县'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line">    town = models.CharField(<span class="string">'乡镇'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    is_top = models.BooleanField(<span class="string">'是否为精选景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    is_hot = models.BooleanField(<span class="string">'是否为热门景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    is_valid = models.BooleanField(<span class="string">'是否有效'</span>, default=<span class="literal">True</span>)</span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated_at = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table =<span class="string">'sight'</span></span><br><span class="line">        ordering = [<span class="string">'-updated_at'</span>]</span><br></pre></td></tr></tbody></table></figure>
<p><code>sight/setting.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [<span class="string">'sight.apps.SightConfig'</span>,]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第三步，检测ORM模型</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python manage.py check</span><br><span class="line">```  </span><br><span class="line">- 第四步，模型同步</span><br><span class="line">```bash</span><br><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="设计景点列表API接口"><a href="#设计景点列表API接口" class="headerlink" title="设计景点列表API接口"></a>设计景点列表API接口</h3><h4 id="开发步骤-6"><a href="#开发步骤-6" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码（查数据、分页）<br><code>sight/views.py</code><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Sight</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line">    <span class="comment"># 每页放5条数据</span></span><br><span class="line">    paginate_by = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 重写查询方法 """</span></span><br><span class="line">        query = Q(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 1. 热门景点</span></span><br><span class="line">        is_hot = self.request.GET.get(<span class="string">'is_hot'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> is_hot:</span><br><span class="line">            query = query &amp; Q(is_hot=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 2. 精选景点</span></span><br><span class="line">        is_top = self.request.GET.get(<span class="string">'is_top'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> is_top:</span><br><span class="line">            query = query &amp; Q(is_top=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># TODO 3. 景点名称搜索</span></span><br><span class="line">        queryset = Sight.objects.filter(query)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]</span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">'meta'</span>: {</span><br><span class="line">                <span class="string">'total_count'</span>: page_obj.paginator.count,</span><br><span class="line">                <span class="string">'page_count'</span>: page_obj.paginator.num_pages,</span><br><span class="line">                <span class="string">'current_page'</span>: page_obj.number,</span><br><span class="line">            },</span><br><span class="line">            <span class="string">'objects'</span>: []</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> page_obj.object_list:</span><br><span class="line">            data[<span class="string">'objects'</span>].append({</span><br><span class="line">                <span class="string">'id'</span>: item.id,</span><br><span class="line">                <span class="string">'name'</span>: item.name,</span><br><span class="line">                <span class="string">'main_img'</span>: item.main_img.url,</span><br><span class="line">                <span class="string">'score'</span>: item.score,</span><br><span class="line">                <span class="string">'province'</span>: item.province,</span><br><span class="line">                <span class="string">'min_price'</span>: item.min_price,</span><br><span class="line">                <span class="string">'city'</span>: item.city,</span><br><span class="line">                <span class="comment"># TODO 评论数量暂时无法获取</span></span><br><span class="line">                <span class="string">'comment_count'</span>: <span class="number">0</span></span><br><span class="line">            })</span><br><span class="line">        <span class="keyword">return</span> http.JsonResponse(data)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>sight/url.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> system <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 景点列表接口</span></span><br><span class="line">    path(<span class="string">'sight/list/'</span>, views.SightListView.as_view(), name=<span class="string">"sight_list"</span>),</span><br><span class="line">]</span><br><span class="line">```  </span><br><span class="line">```trip/url.py```</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 景点相关的URL</span></span><br><span class="line">    path(<span class="string">'sight/'</span>, include(<span class="string">'sight.urls'</span>))</span><br><span class="line">]</span><br><span class="line">``` </span><br><span class="line">- 第三步，模拟HTTP请求，测试验证接口</span><br><span class="line">```bash</span><br><span class="line">python manage.py runserver</span><br></pre></td></tr></tbody></table></figure>

<h3 id="接口文档编写"><a href="#接口文档编写" class="headerlink" title="接口文档编写"></a>接口文档编写</h3><ul>
<li>第一步，学习Markdown语法，可以生成html结构的文档</li>
<li>第二步，编写文档公共部分</li>
<li>第三步，编写接口文档</li>
</ul>
<h3 id="轮播图接口数据获取-接口联调"><a href="#轮播图接口数据获取-接口联调" class="headerlink" title="轮播图接口数据获取(接口联调)"></a>轮播图接口数据获取(接口联调)</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li><p>第一步，阅读接口文档</p>
</li>
<li><p>第二步，配置接口地址<br><code>src\utils\apis.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存放项目中所有的接口地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> apiHost = <span class="string">'http://localhost:8080/api'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户账户相关的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> AccountsApis = {</span><br><span class="line">  loginUrl: <span class="string">'/'</span>,</span><br><span class="line">  logoutUrl: <span class="string">''</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统模块的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> SystemApis = {</span><br><span class="line">  <span class="comment">// 轮播图列表</span></span><br><span class="line">  sliderListUrl: apiHost + <span class="string">'/system/slider/list/'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> {</span><br><span class="line">  AccountsApis,</span><br><span class="line">  SystemApis</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><code>vue.config.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js里面的模块</span></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  <span class="comment">// http://localhost:8080/api/system/slider/list/</span></span><br><span class="line">  <span class="comment">// =&gt;</span></span><br><span class="line">  <span class="comment">// http://127.0.0.1:8080/system/slider/list/</span></span><br><span class="line">  <span class="comment">// 在Vue.js中解决跨域问题</span></span><br><span class="line">  devServer: {</span><br><span class="line">    proxy: {</span><br><span class="line">      <span class="string">'/api'</span>: {  <span class="comment">// 从/api开头 代理到目标地址</span></span><br><span class="line">        target: <span class="string">'http://127.0.0.1:8000/'</span>,  <span class="comment">// 这个地址的服务器要启动才能访问 </span></span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        pathRewrite: {</span><br><span class="line">          <span class="string">'^/api'</span>: <span class="string">''</span>   <span class="comment">//  重写URL，空字符表示把/api字符串去掉</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第三步，在组件中使用axios获取数据<br><code>src/components/home/Bannaer</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { ajax } <span class="keyword">from</span> <span class="string">'@/utils/ajax'</span></span><br><span class="line"><span class="keyword">import</span> { SystemApis } <span class="keyword">from</span> <span class="string">'@/utils/apis'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  data () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      bannerList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取轮播图的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SystemApis.sliderListUrl).then(<span class="function"><span class="params">res</span> =&gt;</span> {</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'res:'</span>, res)</span><br><span class="line">        <span class="built_in">this</span>.bannerList = res.data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    <span class="comment">// 从接口获取数据</span></span><br><span class="line">    <span class="built_in">this</span>.getDataList()</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


</li>
</ul>
<p>django项目的<code>trip/setting.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">'/static/'</span>  <span class="comment"># 静态文件的搜索地址</span></span><br><span class="line">MEDIA_URL = <span class="string">'http://localhost:8080/'</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第四步，将数据设置到模型层<br>Vue组件<code>Banner.vue</code>的模板里的数据<code>img_id</code>和<code>img_url</code>是调用django的视图<code>system/view.py</code>里面的<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!-- 首页的轮播图 --&gt;</span><br><span class="line">  &lt;div class="home-banner-box"&gt;</span><br><span class="line">    &lt;van-swipe class="my-swipe" :autoplay="3000" indicator-color="white"&gt;</span><br><span class="line">      &lt;van-swipe-item v-for="item in bannerList"</span><br><span class="line">        :key="item.id"&gt;</span><br><span class="line">        &lt;img :src="item.img_url" alt=""&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line">    &lt;/van-swipe&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="景点列表接口数据获取"><a href="#景点列表接口数据获取" class="headerlink" title="景点列表接口数据获取"></a>景点列表接口数据获取</h3><h4 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，阅读接口文档</li>
<li>第二步，配置接口地址<br><code>src\utils\apis.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 景点模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> SightApis = {</span><br><span class="line">  <span class="comment">// 景点列表</span></span><br><span class="line">  sightListUrl: apiHost + <span class="string">'/sight/sight/list/'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> {</span><br><span class="line">  SightApis</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<code>vue.config.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string">- 第三步，使用axios获取数据</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line">methods: {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查热门景点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          is_hot: <span class="number">1</span></span><br><span class="line">        }</span><br><span class="line">      }).then(<span class="function">(<span class="params">{ data }</span>) =&gt;</span> {</span><br><span class="line">        <span class="built_in">this</span>.dataList = data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure></li>
<li>第四步，将数据设置到模型层，<br>Vue组件<code>Hot.vue</code>的模板里的数据<code>main_img</code>和<code>name</code>和<code>min_price</code>是调用django的视图<code>sight/view.py</code>里面的<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 热门景点 --&gt;</span><br><span class="line">  &lt;div class="home-hot-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      title="热门推荐"</span><br><span class="line">      icon="/static/home/hot/fire.png"</span><br><span class="line">      is-link</span><br><span class="line">      title-style="text-align:left"</span><br><span class="line">      value="全部榜单" /&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">    &lt;!-- 景点列表 --&gt;</span><br><span class="line">    &lt;div class="box-main"&gt;</span><br><span class="line">      &lt;a href="#" class="hot-item"</span><br><span class="line">        v-for="item in dataList"</span><br><span class="line">        :key="item.id"&gt;</span><br><span class="line">        &lt;div class="img"&gt;</span><br><span class="line">          &lt;span&gt;&lt;/span&gt;</span><br><span class="line">          &lt;img :src="item.main_img" alt=""&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- ellipsis 省略号 意思是超过一定长度变成省略号 --&gt;</span><br><span class="line">        &lt;h5 class="van-ellipsis"&gt;{{ item.name }}&lt;/h5&gt;</span><br><span class="line">        &lt;div class="line-price"&gt;</span><br><span class="line">          &lt;span class="price"&gt;￥{{ item.min_price }}&lt;/span&gt;起</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //景点列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>Vue组件<code>Fine.vue</code>的模板里的数据<code>is_top</code>和<code>name</code>和<code>min_price</code>是调用django的视图<code>sight/view.py</code>里面的</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import SightItem from '@/components/common/ListSight'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    SightItem</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      dataList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 查精选景点</span><br><span class="line">     */</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          is_top: 1</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        this.dataList = data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.getDataList()</span><br><span class="line">    // this.dataList = [</span><br><span class="line">    //   {id: 1, name: '景点名称', score: 5, price: 98},</span><br><span class="line">    //   {id: 2, name: '景点名称', score: 4.5, price: 98},</span><br><span class="line">    //   {id: 3, name: '景点名称', score: 4, price: 98},</span><br><span class="line">    // ]</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\components\common\ListSight.vue</code>的<code>name</code>和<code>score</code>是调用<code>sight/view.py</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a href="#" class="sight-item"&gt;</span><br><span class="line">    &lt;img :src="item.main_img" :alt="item.name"&gt;</span><br><span class="line">    &lt;div class="right"&gt;</span><br><span class="line">      &lt;h5&gt;{{ item.name }}&lt;/h5&gt;</span><br><span class="line">      &lt;van-rate v-model="item.score" readonly/&gt;</span><br><span class="line">      &lt;div class="tips"&gt;{{ item.comment_count }}人点评 | 100%满意&lt;/div&gt;</span><br><span class="line">      &lt;div class="tips light"&gt;{{ item.province }} - {{ item.city }}&lt;/div&gt;</span><br><span class="line">      &lt;div class="line-price"&gt;￥ {{ item.min_price }} 起&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/a&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/java-shu-ju-lei-xing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/java-shu-ju-lei-xing/" class="post-title-link" itemprop="url">java数据类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>内置数据类型<br>Java语言提供了八种基本类型。六种数字类型（四个整数型，两个浮点型），一种字符类型，还有一种布尔型。</p>
<p>byte 字节型，在内存中占1个字节 8位、有符号的，以二进制补码表示的整数；<br>最小值是 -128（-2^7）；<br>最大值是 127（2^7-1）；<br>默认值是 0；<br>byte 类型用在大型数组中节约空间，主要代替整数，因为 byte 变量占用的空间只有 int 类型的四分之一；<br>例子：byte a = 100，byte b = -50。</p>
<p>short 短整型，2个字节 16个二进制位、有符号的以二进制补码表示的整数<br>7483647，默认值0<br>最小值是 -32768（-2^15）；<br>最大值是 32767（2^15 - 1）；<br>默认值是 0；<br>Short 数据类型也可以像 byte 那样节省空间。一个short变量是int型变量所占空间的二分之一；<br>例子：short s = 1000，short r = -20000。</p>
<p>int：整型，4个字节 32个二进制位、有符号的以二进制补码表示的整数；<br>整型变量默认为 int 类型；整型字面值默认情况下是int类型<br>最小值是 -2,147,483,648（-2^31）；<br>最大值是 2,147,483,647（2^31 - 1）；<br>默认值是 0 ；<br>例子：<code>int a = 100000</code><br>定义变量的同时对变量进行初始化<br>变量a和它的值在内存当中如何存储的？在内存的栈中开辟int类型大小的空间，把100这个整型字面值存储到开辟的空间中，变量名a看作是100所在的内存空间的别名，a就代表100</p>
<p>long：长整型，在内存中占8个字节，64个二进制位、有符号的以二进制补码表示的整数；<br>最小值是 -9,223,372,036,854,775,808（-2^63）；<br>最大值是 9,223,372,036,854,775,807（2^63 -1）；<br>默认值是 0L；<br>这种类型主要使用在需要比较大整数的系统上；</p>
<p>例子： long a = 100000L，Long b = -200000L，Long c = 0x1abcL。<br>长整型则在末尾加l或L，”L”理论上不分大小写，但是若写成”l”容易与数字”1”混淆，不容易分辩。所以最好大写。</p>
<p>数据表示范围依次增大。选择数据类型的时候可以参考表示范围来选取，但实际应用中，int和long是常用的数据类型，而byte和short使用较少，即使数值比较小一般也会使用int类型。<br>byte类型主要对二进制数据进行存储，在文件输入输出流部分将会使用，用于二进制数据的传输。<br>short类型在有的需求中会用到，比如：对于登录账号的状态表示，一般用0表示正常，1表示冻结，2表示已删除。这里的数值比较固定，值也比较小，可以使用short类型表示。</p>
<p>浮点数就是小数点在逻辑上是不固定的</p>
<p>float：数据类型是单精度浮点型，在内存中占4个字节，32位，精度是 7<del>8 位，符合IEEE 754标准的浮点数；用于存储带小数点的数字（与double的区别在于float类型有效小数点只有6</del>7位而且在内存中的占的位数也不同），<br>则需要在字面值后加f或F<br>默认值是 0.0f；<br>在储存大型浮点数组的时候可节省内存空间；<br>浮点数不能用来表示精确的值，如货币；<br>例子：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> f1 = <span class="number">234.5f</span></span><br><span class="line"><span class="keyword">float</span> f1 = <span class="number">234.5F</span></span><br><span class="line"><span class="comment">// 后面不加d或者f表示double，double比float数据表示范围大</span></span><br><span class="line"><span class="keyword">float</span> f1 = <span class="number">234.5</span> <span class="comment">// java: 不兼容的类型: 从double转换到float可能会有损失</span></span><br></pre></td></tr></tbody></table></figure>

<p>double 双精度浮点型，在内存中占8个字节 64 位，精度是 16~17 位，符合IEEE 754标准的浮点数；<br>用于存储带有小数点的数字，<br>浮点数（浮点型字面值）的默认类型为double类型；<br>后面不加d或者f表示double，也可以在值后加d或D<br>double类型同样不能表示精确的值，如货币；<br>默认值是 0.0d；<br>例子：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> d1 = <span class="number">123.4</span></span><br><span class="line"><span class="keyword">double</span> d2 = <span class="number">123.4d</span></span><br><span class="line"><span class="keyword">double</span> d3 = <span class="number">123.4D</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="科学计数法表示浮点数"><a href="#科学计数法表示浮点数" class="headerlink" title="科学计数法表示浮点数"></a>科学计数法表示浮点数</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> x = <span class="number">1.23E5</span>;</span><br><span class="line">System.out.println(<span class="string">"x="</span> + x);  <span class="comment">// x=123000.0</span></span><br><span class="line"><span class="keyword">float</span> y = <span class="number">1.23e5f</span>;</span><br><span class="line">System.out.println(<span class="string">"y="</span> + y);  <span class="comment">// y=123000.0</span></span><br><span class="line"><span class="keyword">double</span> z = .<span class="number">2</span>;</span><br><span class="line">System.out.println(<span class="string">"z="</span> + z);  <span class="comment">// z=0.2</span></span><br></pre></td></tr></tbody></table></figure>

<p>boolean数据类型表示1个字节8位的信息；<br>只有两个取值：true 和 false；<br>这种类型只作为一种标志来记录 true/false 情况；<br>默认值是 false；<br>例子：<code>boolean one = true</code>。</p>
<p>二、浮点型的应用场景<br>浮点类型表示小数，包括float和double两种类型，具体使用哪种数据类型，也是可以按照表示范围进行选择。但double类型<br>使用相对较多。<br>应用场景主要是要求数据精度高、并且数据量大的情况，如：医学、化学、军事、天文等领域。<br>这里需要注意，浮点型因为其表示方式的原因，会产生精度丢失的问题，</p>
<p>精确计算<br>通过 BigDecimal 类，先将浮点型数据转换为 String 类型的数据，然后再进行相应的计算。<br>以下为利用 BigDecimal 类进行加法和减法运算的测试代码</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">double</span> a = <span class="number">1.9</span>;</span><br><span class="line">        <span class="keyword">double</span> b = <span class="number">1.7</span>;</span><br><span class="line">        System.out.println(<span class="string">"直接进行减法运算，运算结果:\n"</span> + (a - b));</span><br><span class="line">        System.out.println(<span class="string">"利用 BigDecimal类的进行减法运算结果:\n"</span> + sub(a, b));</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"直接进行加法运算，运算结果:\n"</span> + (a + b));</span><br><span class="line">        System.out.println(<span class="string">"利用 BigDecimal类的进行加法运算结果:\n"</span> + add(a, b));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//利用 BigDecimal类的进行减法运算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">sub</span><span class="params">(<span class="keyword">double</span> v1, <span class="keyword">double</span> v2)</span> </span>{</span><br><span class="line">        <span class="comment">//将浮点数转为 String类型</span></span><br><span class="line">        BigDecimal b1 = <span class="keyword">new</span> BigDecimal(Double.toString(v1));</span><br><span class="line">        BigDecimal b2 = <span class="keyword">new</span> BigDecimal(Double.toString(v2));</span><br><span class="line">        <span class="comment">//通过 BigDecimal类中 subtract方法完成减法运算,</span></span><br><span class="line">        <span class="comment">// 其中b1是被减数,b2是减数</span></span><br><span class="line">        <span class="keyword">double</span> b = b1.subtract(b2).doubleValue();</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//利用 BigDecimal类的进行加法运算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> v1, <span class="keyword">double</span> v2)</span> </span>{</span><br><span class="line">        BigDecimal b1 = <span class="keyword">new</span> BigDecimal(Double.toString(v1));</span><br><span class="line">        BigDecimal b2 = <span class="keyword">new</span> BigDecimal(Double.toString(v2));</span><br><span class="line">        <span class="keyword">return</span> b1.add(b2).doubleValue();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>char类型是一个单一的占2个字节，16个二进制位 无符号Unicode 字符；<br>最小值是 \u0000（即为 0）；<br>最大值是 \uffff（即为65,535）；<br>char 数据类型可以储存任何字符；字符就是整数类型<br>例子：<code>char letter = 'A';</code>。</p>
<p>abstract 修饰抽象类。</p>
<p>break 一般用于循环里面作用是结束当前循环。 </p>
<p>case 用于swith里面。<br> continue 结束当天循环进入下次循环。 default 用于 swith case与<br>接口里。 do 用于循环，一般用于 do{循环内容}(判断条件)；<br>else 用于判断 if(条件){ } else if(条件){} else{}. extends 子类继承父<br>类。false 可以用于判断条件 也可以给boolean赋值。final 修饰的类不可被继承<br>方法不能被重新 变量不可变。 finally 用于try catch 的结尾 表示最终一定会执<br>行 也会不会的执行的情况例如在try catch 里面有return语句，死循环等 Syste<br>m.exit() 中止 守护线程等。</p>
<p>for 循环。<br>if 判断。 </p>
<p>implements 实现接口，一个类型可以实现多个接口。 import 导入。 native 修饰方<br>法为本地方法。 </p>
<p>interface 定义接口。<br>instan</p>
<p>常见的常量类型有<br>整型常量（int），浮点数常量（float）,布尔型常量（boolean），字符常量（char），<br>字符串常量（string），引用类型常量。<br>String&nbsp;是一种常见的引用数据类型，用来表示字符串，即多个字符。<br>例如系统中的用户名、密码、电子邮箱等。</p>
<p>格式化字符串字面值&nbsp;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">'python'</span></span><br><span class="line">b=len(a)</span><br><span class="line">print('hah'+str(b))#hah6</span><br><span class="line">print(f<span class="string">'hah{b}'</span>)</span><br><span class="line">print(<span class="string">'hah{}'</span>.format(b))</span><br></pre></td></tr></tbody></table></figure>
<p>{&nbsp;&nbsp;}&nbsp;来标记变量将被替换的位置</p>
<h3 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h3><p>格式：<code>数据类型 变量名；</code></p>
<figure class="highlight plain"><figcaption><span>n;``` 声明整型变量n</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">```long count;``` 声明长整型变量count</span><br><span class="line"></span><br><span class="line">- 相同类型的数据变量可以一次定义多个，变量名之间用逗号隔开</span><br><span class="line">```float a,b1=1.23f;```a是float类型，但是没初始化，bfloat类型且初始化</span><br><span class="line"></span><br><span class="line">- 同方法内不可以重复定义相同的变量名</span><br><span class="line"></span><br><span class="line">### 使用“＝”运算符进行赋值</span><br><span class="line">“＝”叫作赋值运算符，将运算符右边的值赋给左边的变量。</span><br><span class="line">例：```int n;``` 定义int型变量n  </span><br><span class="line">```n=3;``` 将3赋值给n</span><br><span class="line">- 可以在定义变量的同时给变量赋值，即变量的初始化。</span><br><span class="line">例：```int n=3;```</span><br><span class="line">- 数据类型 变量名＝变量值</span><br><span class="line"></span><br><span class="line">变量定义</span><br><span class="line">```java</span><br><span class="line">int octal=037; //定义int类型变量存放八进制数据</span><br><span class="line">long longNumber=0xa2cdf3ffL; //定义变量存放十六进制长整型数据</span><br><span class="line">short shortNumber=123;  //定义变量存放短整型数据</span><br><span class="line">byte b=10; //定义变量存放byte类型数据</span><br></pre></td></tr></tbody></table></figure>

<h3 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h3><ul>
<li>以分号结束</li>
<li>不能换到一行写</li>
<li>单行注释，注释一行</li>
</ul>
<h3 id="数据类型分类"><a href="#数据类型分类" class="headerlink" title="数据类型分类"></a>数据类型分类</h3><ul>
<li><p>基本数据类型 </p>
</li>
<li><p>引用数据类型<br>存的是保存数据的空间地址，这个抽屉的钥匙，钥匙和抽屉一一对应</p>
<ul>
<li>类 class</li>
<li>接口 interface</li>
<li>数组</li>
</ul>
</li>
</ul>
<p>类定义的变量又叫对象</p>
<h3 id="按照作用范围分为"><a href="#按照作用范围分为" class="headerlink" title="按照作用范围分为:"></a>按照作用范围分为:</h3><ul>
<li>类级</li>
<li>对象实例级</li>
<li>方法级（局部变量，定义在主方法中）</li>
<li>块级</li>
</ul>
<h3 id="字面值是常量和变量实际表示的数值，都是有数据类型的"><a href="#字面值是常量和变量实际表示的数值，都是有数据类型的" class="headerlink" title="字面值是常量和变量实际表示的数值，都是有数据类型的"></a>字面值是常量和变量实际表示的数值，都是有数据类型的</h3><p>字面值是常量的一种</p>
<h3 id="字符型字面值"><a href="#字符型字面值" class="headerlink" title="字符型字面值"></a>字符型字面值</h3><p>用单引号内的只有一个单个字符表示，不能双引号<br>字符：单个字母，键盘上的，空格也是字符，算长度空格也算<br>如：<code>char ‘a’</code>，<code>char ‘b’</code>，<code>char ‘$’</code>，<br>不能写<code>char "a"</code></p>
<ul>
<li>如何定义字符型变量？<h4 id="类型转换分为"><a href="#类型转换分为" class="headerlink" title="类型转换分为"></a>类型转换分为</h4></li>
</ul>
<ol>
<li><p>自动类型转换（隐式）<br>数据所表示的数据范围小的转换位所表示的数据范围大的</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">       <span class="comment">// 定义一个变量存放字符'a'，字符a的值赋值字符变量a</span></span><br><span class="line">       <span class="keyword">char</span> a = <span class="string">'a'</span>;</span><br><span class="line">       System.out.println(<span class="string">"a="</span> + a);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 整型赋值给char类型，如果字面值没有超出char类型所表示的数据范围，转换成它的ASCII值所对应的字符数据</span></span><br><span class="line"><span class="keyword">char</span> ascii_97 = <span class="number">97</span>;  <span class="comment">// a=a</span></span><br><span class="line">System.out.println(<span class="string">"ascii_97="</span> + ascii_97);  <span class="comment">// ascii_97=a</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>强制类型转换<br>如果A类型的数据表示范围比B类型大，则将A类型的值赋值给B类型，需要强制类型转换<br>格式<code>（数据类型） 数值</code><br><code>double d＝123.4;</code><br><code>float f=(float)d;</code></p>
</li>
</ol>
<p>如果字面值超出char类型所表示的数据范围，需要进行强制类型转换。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> <span class="keyword">var</span> = (<span class="keyword">long</span>) <span class="number">1.9e8</span>;</span><br><span class="line">System.out.println(<span class="string">"var="</span> + <span class="keyword">var</span>);  <span class="comment">// var=190000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> z = <span class="keyword">var</span>;</span><br><span class="line">System.out.println(<span class="string">"z="</span> + z);  <span class="comment">// z=1.9E8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> ch = <span class="number">65535</span>;</span><br><span class="line"><span class="keyword">char</span> ch1 = (<span class="keyword">char</span>) <span class="number">65536</span>;</span><br><span class="line">System.out.println(<span class="string">"ch="</span> + ch);  <span class="comment">// ch=￿</span></span><br><span class="line">System.out.println(<span class="string">"ch1="</span> + ch1);  <span class="comment">// ch1=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//char类型和int类型之间的转换</span></span><br><span class="line"><span class="keyword">char</span> c = (<span class="keyword">char</span>) <span class="number">65536</span>;</span><br><span class="line">System.out.println(<span class="string">"c="</span> + c);  <span class="comment">// c=</span></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">n = c;<span class="comment">//隐式类型转换</span></span><br><span class="line">System.out.println(<span class="string">"n="</span> + n);  <span class="comment">// n=0</span></span><br><span class="line">c = (<span class="keyword">char</span>) n;</span><br><span class="line">System.out.println(<span class="string">"c="</span> + c);  <span class="comment">// c=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//整型和整型的类型转换问题</span></span><br><span class="line"><span class="keyword">long</span> l = <span class="number">987654321</span>;</span><br><span class="line"><span class="keyword">int</span> i = (<span class="keyword">int</span>) l;</span><br><span class="line">System.out.println(<span class="string">"i="</span> + i);</span><br><span class="line"></span><br><span class="line"><span class="comment">//整型和浮点型的类型转换问题</span></span><br><span class="line"><span class="keyword">int</span> x = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">long</span> y = x;</span><br><span class="line">x = (<span class="keyword">int</span>) y;</span><br><span class="line"><span class="keyword">float</span> f = <span class="number">100000000000000L</span>;</span><br><span class="line">System.out.println(<span class="string">"f="</span> + f);  <span class="comment">// f=1.0E14</span></span><br><span class="line"><span class="keyword">float</span> f1 = <span class="number">103948583923948L</span>;</span><br><span class="line">System.out.println(<span class="string">"f1="</span> + f1);  <span class="comment">// f1=1.03948585E14 数据丢失</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="字符串字面值"><a href="#字符串字面值" class="headerlink" title="字符串字面值"></a>字符串字面值</h3><ul>
<li>双引号引起来的0个或多个字符<br>字符串不属于基本数据类型，它是类，双引号的<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个空字符串</span></span><br><span class="line">String s1 = <span class="string">""</span>;</span><br><span class="line">System.out.println(<span class="string">"s1="</span> + s1);  <span class="comment">// s1=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个包含空格的字符串</span></span><br><span class="line">String s5 = <span class="string">"Hello   imooc!"</span>;</span><br><span class="line">System.out.println(<span class="string">"s5="</span> + s5);  <span class="comment">// s4=Hello   imooc!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个字符串，内容是Hello</span></span><br><span class="line">String s2 = <span class="string">"Hello"</span>;</span><br><span class="line">System.out.println(<span class="string">"s2="</span> + s2);  <span class="comment">// s2=Hello</span></span><br><span class="line"><span class="comment">//定义一个unicode字符的字符串</span></span><br><span class="line">String s3 = <span class="string">"\u005d\u005f"</span>;</span><br><span class="line">System.out.println(<span class="string">"s3="</span> + s3);  <span class="comment">// s3=]_</span></span><br><span class="line"><span class="comment">//定义一个包含unicode字符和其他字符写在一起的字符串</span></span><br><span class="line">String s4 = <span class="string">"A\u005d\u005fB"</span>;</span><br><span class="line">System.out.println(<span class="string">"s4="</span> + s4);  <span class="comment">// s4=A]_B</span></span><br></pre></td></tr></tbody></table></figure>


</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="number">3</span> + <span class="string">"\t"</span> + <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 3    5 双引号只有一个字符的字符串</span></span><br><span class="line">System.out.println(<span class="number">3</span> + <span class="string">'\t'</span> + <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 17 双引号只有一个字符的字符串</span></span><br><span class="line">System.out.println(<span class="number">3</span> + <span class="string">"\t"</span> + <span class="number">5</span> + <span class="string">'\n'</span>);</span><br><span class="line"><span class="comment">// 3    5 双引号只有一个字符的字符串，字符串连接</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">System.out.println(<span class="number">3</span> + <span class="string">'\t'</span> + <span class="number">5</span> + <span class="string">'\n'</span>);  </span><br><span class="line"><span class="comment">// 27 字符就是整型，把字符都转换成整数，进行加法运算</span></span><br><span class="line">System.out.println(<span class="string">""</span> + <span class="number">3</span> + <span class="string">'\t'</span> + <span class="number">5</span> + <span class="string">'\n'</span>);  </span><br><span class="line"><span class="comment">// 3    5 最前面加一个空串，一开始就是做字符串连接</span></span><br><span class="line">System.out.println(<span class="string">'\n'</span> + <span class="number">3</span> + <span class="string">"\t"</span> + <span class="number">5</span>);  </span><br><span class="line"><span class="comment">// 13</span></span><br><span class="line">System.out.println(<span class="string">"\n"</span> + <span class="number">3</span> + <span class="string">"\t"</span> + <span class="number">5</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 3    5</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="布尔类型字面值"><a href="#布尔类型字面值" class="headerlink" title="布尔类型字面值"></a>布尔类型字面值</h3><p>布尔值只能定义为true和false<br>例：<code>boolean b=true;</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FloatDemo.java</span></span><br><span class="line"><span class="keyword">package</span> com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatDemo</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//定义一个单精度浮点型变量，存放1234.328</span></span><br><span class="line">        <span class="keyword">float</span> f = <span class="number">1234.328f</span>;</span><br><span class="line">        System.out.println(<span class="string">"f="</span> + f);</span><br><span class="line">        <span class="comment">//f=1234.328</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个双精度浮点型变量，存放5623.465</span></span><br><span class="line">        <span class="keyword">double</span> d = <span class="number">5623.464</span>;</span><br><span class="line">        System.out.println(<span class="string">"d="</span> + d);</span><br><span class="line">        <span class="comment">//d=5623.464</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//将整型赋值给浮点型</span></span><br><span class="line">        <span class="keyword">double</span> d1 = <span class="number">123</span>;</span><br><span class="line">        System.out.println(<span class="string">"d1="</span> + d1);</span><br><span class="line">        <span class="comment">//d1=123.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//变量间的赋值</span></span><br><span class="line">        <span class="keyword">double</span> d2 = d;</span><br><span class="line">        System.out.println(<span class="string">"d2="</span> + d2);</span><br><span class="line">        <span class="comment">//d2=5623.464</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//将单精度浮点型赋值给双精度</span></span><br><span class="line">        <span class="keyword">double</span> d3 = <span class="number">1.23f</span>;</span><br><span class="line">        System.out.println(<span class="string">"d3="</span> + d3);</span><br><span class="line">        <span class="comment">//d3=1.2300000190734863</span></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>整数型的阈值 </p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrimitiveTypeTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// byte</span></span><br><span class="line">        System.out.println(<span class="string">"基本类型：byte 二进制位数："</span> + Byte.SIZE);</span><br><span class="line">        System.out.println(<span class="string">"包装类：java.lang.Byte"</span>);</span><br><span class="line">        System.out.println(<span class="string">"最小值：Byte.MIN_VALUE="</span> + Byte.MIN_VALUE);</span><br><span class="line">        System.out.println(<span class="string">"最大值：Byte.MAX_VALUE="</span> + Byte.MAX_VALUE);</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// short</span></span><br><span class="line">        System.out.println(<span class="string">"基本类型：short 二进制位数："</span> + Short.SIZE);</span><br><span class="line">        System.out.println(<span class="string">"包装类：java.lang.Short"</span>);</span><br><span class="line">        System.out.println(<span class="string">"最小值：Short.MIN_VALUE="</span> + Short.MIN_VALUE);</span><br><span class="line">        System.out.println(<span class="string">"最大值：Short.MAX_VALUE="</span> + Short.MAX_VALUE);</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// int</span></span><br><span class="line">        System.out.println(<span class="string">"基本类型：int 二进制位数："</span> + Integer.SIZE);</span><br><span class="line">        System.out.println(<span class="string">"包装类：java.lang.Integer"</span>);</span><br><span class="line">        System.out.println(<span class="string">"最小值：Integer.MIN_VALUE="</span> + Integer.MIN_VALUE);</span><br><span class="line">        System.out.println(<span class="string">"最大值：Integer.MAX_VALUE="</span> + Integer.MAX_VALUE);</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// long</span></span><br><span class="line">        System.out.println(<span class="string">"基本类型：long 二进制位数："</span> + Long.SIZE);</span><br><span class="line">        System.out.println(<span class="string">"包装类：java.lang.Long"</span>);</span><br><span class="line">        System.out.println(<span class="string">"最小值：Long.MIN_VALUE="</span> + Long.MIN_VALUE);</span><br><span class="line">        System.out.println(<span class="string">"最大值：Long.MAX_VALUE="</span> + Long.MAX_VALUE);</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// float</span></span><br><span class="line">        System.out.println(<span class="string">"基本类型：float 二进制位数："</span> + Float.SIZE);</span><br><span class="line">        System.out.println(<span class="string">"包装类：java.lang.Float"</span>);</span><br><span class="line">        System.out.println(<span class="string">"最小值：Float.MIN_VALUE="</span> + Float.MIN_VALUE);</span><br><span class="line">        System.out.println(<span class="string">"最大值：Float.MAX_VALUE="</span> + Float.MAX_VALUE);</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// double</span></span><br><span class="line">        System.out.println(<span class="string">"基本类型：double 二进制位数："</span> + Double.SIZE);</span><br><span class="line">        System.out.println(<span class="string">"包装类：java.lang.Double"</span>);</span><br><span class="line">        System.out.println(<span class="string">"最小值：Double.MIN_VALUE="</span> + Double.MIN_VALUE);</span><br><span class="line">        System.out.println(<span class="string">"最大值：Double.MAX_VALUE="</span> + Double.MAX_VALUE);</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// char</span></span><br><span class="line">        System.out.println(<span class="string">"基本类型：char 二进制位数："</span> + Character.SIZE);</span><br><span class="line">        System.out.println(<span class="string">"包装类：java.lang.Character"</span>);</span><br><span class="line">        <span class="comment">// 以数值形式而不是字符形式将Character.MIN_VALUE输出到控制台</span></span><br><span class="line">        System.out.println(<span class="string">"最小值：Character.MIN_VALUE="</span></span><br><span class="line">                + (<span class="keyword">int</span>) Character.MIN_VALUE);</span><br><span class="line">        <span class="comment">// 以数值形式而不是字符形式将Character.MAX_VALUE输出到控制台</span></span><br><span class="line">        System.out.println(<span class="string">"最大值：Character.MAX_VALUE="</span></span><br><span class="line">                + (<span class="keyword">int</span>) Character.MAX_VALUE);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">基本类型：byte 二进制位数：8</span><br><span class="line">包装类：java.lang.Byte</span><br><span class="line">最小值：Byte.<span class="attribute">MIN_VALUE</span>=-128</span><br><span class="line">最大值：Byte.<span class="attribute">MAX_VALUE</span>=127</span><br><span class="line"></span><br><span class="line">基本类型：short 二进制位数：16</span><br><span class="line">包装类：java.lang.Short</span><br><span class="line">最小值：Short.<span class="attribute">MIN_VALUE</span>=-32768</span><br><span class="line">最大值：Short.<span class="attribute">MAX_VALUE</span>=32767</span><br><span class="line"></span><br><span class="line">基本类型：int 二进制位数：32</span><br><span class="line">包装类：java.lang.Integer</span><br><span class="line">最小值：Integer.<span class="attribute">MIN_VALUE</span>=-2147483648</span><br><span class="line">最大值：Integer.<span class="attribute">MAX_VALUE</span>=2147483647</span><br><span class="line"></span><br><span class="line">基本类型：long 二进制位数：64</span><br><span class="line">包装类：java.lang.Long</span><br><span class="line">最小值：Long.<span class="attribute">MIN_VALUE</span>=-9223372036854775808</span><br><span class="line">最大值：Long.<span class="attribute">MAX_VALUE</span>=9223372036854775807</span><br><span class="line"></span><br><span class="line">基本类型：float 二进制位数：32</span><br><span class="line">包装类：java.lang.Float</span><br><span class="line">最小值：Float.<span class="attribute">MIN_VALUE</span>=1.4E-45</span><br><span class="line">最大值：Float.<span class="attribute">MAX_VALUE</span>=3.4028235E38</span><br><span class="line"></span><br><span class="line">基本类型：double 二进制位数：64</span><br><span class="line">包装类：java.lang.Double</span><br><span class="line">最小值：Double.<span class="attribute">MIN_VALUE</span>=4.9E-324</span><br><span class="line">最大值：Double.<span class="attribute">MAX_VALUE</span>=1.7976931348623157E308</span><br><span class="line"></span><br><span class="line">基本类型：char 二进制位数：16</span><br><span class="line">包装类：java.lang.Character</span><br><span class="line">最小值：Character.<span class="attribute">MIN_VALUE</span>=0</span><br><span class="line">最大值：Character.<span class="attribute">MAX_VALUE</span>=65535</span><br></pre></td></tr></tbody></table></figure>

<p>基本类型的创建：先去常量池中找是否存在该值，如果存在直接调取引用，如果不存在则先在常量池中创建该值，在调引用</p>
<p>所以，不可以创建一个空值给基本数据类型。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/linux/" class="post-title-link" itemprop="url">linux</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-11 09:34:41" itemprop="dateModified" datetime="2021-04-11T09:34:41Z">2021-04-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>操作系统是你的电脑和应用程序之间的连接工具</p>
<p>操作系统的核心称为“内核″，但内核并不就等于操作系统<br>内核提供系统服务，比如文件管理、虚拟內存、设备I/O等<br>它管理着整台计算机的硬件，负责应用程序和硬件之间的交互工作。<br>除内核以外，在应用软件与内核之间通常还有些作为中间件的API<br>还包含一些基本的程序，例如文本编辑器，编译器，外壳程序 Shell<br>单独的 Linux内核没办法工作,须要有GNU项目的众多应用程序<br>Linux的官方称谓应该是“GNU/ Linux”,一般简称 Linux</p>
<p>自由的软件意味着源代码必须公开<br>自由的软件大部分时候是免费的,但也可以复制,修改和出售<br>自由运动的口号是:“团结就是力量”</p>
<p>Centos是 Community Enterprise Operating System “社区企业操作系统”<br>Centos兼具 Community(社区)和 Enterprise(企业)的特性</p>
<p>macoS和 Windows的源代码是闭源的(看不到), Linux则开源<br>有很多不同的 Linux变体,术语称为“ Linux发行版”</p>
<p>主板 Motherboard 或 Mainboard<br>◆ 构成复杂电子系统例如电子计算机的中心或者主电路板</p>
<h3 id="电脑启动时-按先后顺序发生的"><a href="#电脑启动时-按先后顺序发生的" class="headerlink" title="电脑启动时,按先后顺序发生的"></a>电脑启动时,按先后顺序发生的</h3><ol>
<li>启动界面（主板）</li>
<li>bootloader</li>
<li>操作系统（例如Windows）的启动</li>
<li>其他程序</li>
</ol>
<p>Windows启动的必要性</p>
<ul>
<li>Windows启动后,才可以使用各种应用程序</li>
<li>你的电脑需要一个类似“大管家”的软件</li>
<li>“大管家”软件起到连接电脑硬件和软件的“桥梁”的作用</li>
</ul>
<h3 id="bootloader"><a href="#bootloader" class="headerlink" title="bootloader"></a>bootloader</h3><p>boot(“启动”的意思) loader(“加载器”的意思)<br>通过这段小程序，初始化硬件设备、建立內存空间的映射图<br>为最终调用操作系统内核准备好正确的环境</p>
<p>一台电脑可以拥有两个(甚至更多)的操作系统<br>当启动界面结束后，会有一个被称为bootloader的程序显示出来<br>bootloader让你做出选择，到底选择哪个操作系统来启动<br>然后是操作系统的内核运行</p>
<p>通常, bootloader严重依赖于硬件而实现的,特别是在嵌入式领域<br>一般在 Linux和 Windows之间做出选择的 bootloader叫GRUB<br>如果没有做岀选择，GRUB在几秒之后就会启动默认的操作系统</p>
<p>图形化界面(Graphical User Interface GUI)这种方式简单直观,使用者易于接受,容易上手操作。</p>
<p>命令行界面(Command Line Interface CLI)需要有个控制台,是在图形用户界面得到普及之前使用最为广泛的用户界面，它通常不支持鼠标，用户通过键盘输入指令，计算机接收到指令后，予以执行完成些操作。<br>Command Line CMD</p>
<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><p>「壳」，即人与电脑的接口，实际上是个命令解释程序，从标准输入读取你的命令，把命令结果输出到标准输出和标准错误等设备。Shell 通常指的是命令行界面的解析器，一个为操作系统提供访问内核的程序<br>Windows 下的 cmd、PowerShell，这些都是 shell，这个应该很容易理解。<br>win终端 虚拟终端<br>cmd是DOS窗口，而powershell才是真正的Windows Terminal窗口</p>
<p>Linux 下的 Bash、Zsh，<br>bash，全名叫做 Bourne-Again SHell，绝大多数 Linux 发行版的默认 shell。<br>zsh，全名叫做 Z shell，新版 MacOS 的默认 shell。对 Bourne shell 做出了大量改进，同时加入了 Bash、ksh 及 tcsh 的某些功能<br>Shell 干的活儿是从终端那里拿到用户输入的命令，解析后交给操作系统内核去执行，然后把执行结果返回给终端。<br>终端干的活儿是从用户（通过键盘和鼠标）这里接收输入，然后扔给 Shell，然后把 Shell 返回的结果展示给用户（通过显示器）。</p>
<h3 id="Console-控制台"><a href="#Console-控制台" class="headerlink" title="Console(控制台)"></a>Console(控制台)</h3><p>真正的终端<br>没有图形界面,只有黑底白字的全屏幕的终端<br>即在 Linux 下按 Ctrl-Alt-F? 看到的那个命令界面。<br>事实上，在远古的 Unix 大型机时代，console 应该是指物理连接在主机上的输入输出设备，<br>而 terminal 是指与 console 进行远程通信的串行设备。<br>而如今的 Linux 控制台实际上是内核模拟的 /dev/ttyn 终端，/dev/console 一般就是 /dev/tty0，<br>只有 root 用户才能写入。</p>
<p>TTY是 TeleTYpe 或者 teletypewriters,原来指的是电传打字机<br>远程连接到控制台的串行设备，现在来说通常也就是 /dev/ttyn 这些设备啦</p>
<p>进入登录tty1~tty5这五个真正的全屏幕的tty终端的快捷键</p>
<figure class="highlight plain"><figcaption><span>terminal 1(:0大致等于tty1)</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">```Ctrl +Alt +F3```: terminal 2(tty2)</span><br><span class="line">```Ctrl+ Alt+ F4```: terminal 3(tty3)</span><br><span class="line">```Ctrl+ Alt+F5```: terminal 4(tty4)</span><br><span class="line">```Ctrl + Alt + F6```: terminal5(tty5)</span><br><span class="line"></span><br><span class="line">退出tty终端</span><br><span class="line">```ctrl+Alt+F1```:回到图形界面(感谢上帝</span><br><span class="line"></span><br><span class="line">图形模式的终端:</span><br><span class="line">一般在 Centos等 Linux发行版下日常使用</span><br><span class="line">可以配置终端的外观,用鼠标操作,可以同时运行其他应用程序</span><br><span class="line"></span><br><span class="line">打开图形模式终端的方式</span><br><span class="line">- 调出系统搜索框，在搜索框中输入"terminal"</span><br><span class="line">- 用快捷键来调出终端，比如可以自己设置快捷键:Ctr|+At+T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### Linux 的目录组织</span><br><span class="line">普通的文件</span><br><span class="line">文本类型的文件（.txt，.doc，.odt，等等</span><br><span class="line">声音文件（.wav，.mp3，.ogg），还有程序，等</span><br><span class="line">这样的文件在 Windows 中也有</span><br><span class="line"></span><br><span class="line">特殊的文件</span><br><span class="line">你的光盘驱动器就是这类特殊的文件</span><br><span class="line"></span><br><span class="line">Linux 中一切都是文件</span><br><span class="line">### 根目录指逻辑驱动器的最上一级目录，它是相对子目录来说的。</span><br><span class="line">点开手机内部储存看到的就是手机的根目录</span><br><span class="line"></span><br><span class="line">Linux 根目录```/```是Linux 最顶层的目录，没有比根目录再高一阶的目录了，没有目录包含根目录</span><br><span class="line">用斜杠 ```/``` 来标明目录的层级与包含关系</span><br><span class="line">目录形式是这样的 /usr/bin</span><br><span class="line">bin 是 usr 目录的子目录，usr 是 / 这个根目录的子目录</span><br><span class="line">Linux 的文件和目录都是由根目录 / 开始自顶向下呈乔木状分散的</span><br><span class="line"></span><br><span class="line">Windows 中用反斜杠 \ 来标明目录的层级与包含关系</span><br><span class="line">C 盘（C:\）是硬盘的根目录（假如没有把 C 盘磁盘分区的话）</span><br><span class="line">可以有好几个根目录，双击C盘就进入C盘的根目录，双击D盘就进入D盘的根目录，</span><br><span class="line">H 盘可能是光盘驱动器的根目录</span><br><span class="line">点开游戏文件夹看到的就是游戏的根目录。</span><br><span class="line">一个目录的形式是这样的 C:\Program Files\Baidu</span><br><span class="line">Baidu 这个目录是 Program Files 这个目录的一个子目录</span><br><span class="line">Program Files 这个目录是 C 盘这个根目录的一个子目录</span><br><span class="line">目录名称可以包含空格等符号</span><br><span class="line">在 Linux 下命名目录时尽量不使用空格或者其他特殊的符号</span><br><span class="line">尽量用小写英文字母</span><br><span class="line"></span><br><span class="line">### Linux 的根目录的直属子目录</span><br><span class="line">目录的列表形式，在类 Unix 的操作系统里是类似的</span><br><span class="line">苹果的桌面操作系统 macOS 的目录结构也是从根目录 / 开始的</span><br><span class="line"></span><br><span class="line">- bin：是 binary “二进制文件” ，可执行文件是二进制的</span><br><span class="line">bin 目录包含了会被所有用户使用的可执行程序</span><br><span class="line"></span><br><span class="line">- boot 目录包含与 Linux 启动密切相关的文件</span><br><span class="line"></span><br><span class="line">- dev： device “设备”</span><br><span class="line">包含外设。它里面的子目录，每一个对应一个外设</span><br><span class="line">比如光盘驱动器的文件就会出现在这个目录下</span><br><span class="line"></span><br><span class="line">- etc：是法语 et cetera ，包含系统的配置文件</span><br><span class="line"></span><br><span class="line">- home： home 表示“家”。用户的私人目录，我们放置私人的文件</span><br><span class="line">类似 Windows 中的 Documents 文件夹，也叫“我的文档</span><br><span class="line">除了root外每个用户都在 home 目录下有一个私人目录存放自己私人文件</span><br><span class="line">假如我的用户名是 oscar，那么我的私人目录就是 /home/oscar</span><br><span class="line"></span><br><span class="line">- lib：library“库”，目录包含被程序所调用的库文件，例如 .so 结尾的文件，</span><br><span class="line">Windows 下这样的库文件则是以 .dll 结尾</span><br><span class="line">- media 可移动的外设（USB 盘，SD卡，DVD，光盘，等等）插入电脑时，访问这些外设中的内容</span><br><span class="line">- mnt： mount “挂载”，mnt： mount “挂载”</span><br><span class="line">- opt： optional application software package ，“可选的应用软件包”， 安装多数第三方软件和插件</span><br><span class="line">- root 超级用户 root 的家目录</span><br><span class="line">一般的用户的家目录位于 /home 下，root 用户是个例外</span><br><span class="line"></span><br><span class="line">- sbin： system binary “系统二进制文件“，比 bin 目录多了一个前缀 system（“系统”），包含系统级的重要可执行程序</span><br><span class="line">- srv： service “服务”，包含一些网络服务启动之后所需要取用的数据</span><br><span class="line">- tmp： temporary “临时的”，普通用户和程序存放临时文件的地方，</span><br><span class="line">- usr：是 Unix Software Resource “Unix操作系统软件资源”，类似 Windows 中的 C:\Windows，和 C:\Program Files 这两个文件夹的集合，usr 目录里安装了大部分用户要调用的程序</span><br><span class="line">- var：variable “动态的，可变的”，包含程序的数据，比如 log（日志）文件， log 文件记录电脑中发生了什么事</span><br><span class="line"></span><br><span class="line">```pwd```  print working directory打印当前工作目录的路径</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>adduser test 创建用户```<br>passwd test<br>输入密码 </p>
<figure class="highlight autohotkey"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```code &lt;文件路径/文件名&gt;```vscode中打开项目</span><br><span class="line"></span><br><span class="line">终端在每一行的开头处会有一个被称为“命令行提示符”的字符串，提示在其后面输入命令，这个提示符的格式可以自行设置，我们在命令提示符后面输入命令，告诉电脑我们想要它完成的任务</span><br><span class="line">```[]```：提示符的分隔符号，没有特殊含义。</span><br><span class="line">```root```：当前的登录用户。Linux 是多用户的操作系统</span><br><span class="line">```@```：分隔符号，没有特殊含义。前面是用户名，后面是所在的域</span><br><span class="line">```localhost```：当前系统的简写电脑/主机的名字（hostname127.<span class="number">0.0</span>.<span class="number">1</span></span><br><span class="line">（完整主机名是localhost.localdomain）。</span><br><span class="line">```~```：代表用户当前所在的目录名字，刚打开一个终端（Terminal），当前所在的目录是你的用户家目录（home directory。会随着用户进入不同目录而改变</span><br><span class="line">```#```：root超级用户的提示符，Linux用这个符号标识登录的用户权限等级。</span><br><span class="line">```$``` 普通用户的权限的提示符</span><br><span class="line"></span><br><span class="line">reboot、shutdown -h now、init、halt、user管理，</span><br><span class="line">在普通用户身份上都是操作不了，</span><br><span class="line">但是有些特殊的情况下又需要有执行权限。</span><br><span class="line">又不可能让root用户把自己的密码告诉普通用户，这个问题该怎么解决？</span><br><span class="line"></span><br><span class="line">该问题是可以被解决的，可以使用sudo（switch user do）命令来进行权限设置。</span><br><span class="line">Sudo可以让管理员（root）事先定义某些特殊命令谁可以执行。</span><br><span class="line"> </span><br><span class="line">默认sudo中是没有除root之外用户的规则，要想使用则先配置sudo。</span><br><span class="line"> </span><br><span class="line">Sudo配置文件：/etc/sudoers</span><br><span class="line">配置sudo文件请使用“#visudo”，打开之后其使用方法和vim一致</span><br><span class="line"> 配置普通用户的权限</span><br></pre></td></tr></tbody></table></figure>
<p>allow root to run any commands anywhere<br>root   ALL=(ALL)   ALL</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Root表示用户名，如果是用户组，则可以写成“%组名”</span><br><span class="line">ALL：表示允许登录的主机（地址白名单）</span><br><span class="line">(ALL)：表示以谁的身份执行，ALL表示root身份</span><br><span class="line">ALL：表示当前用户可以执行的命令，多个命令可以使用“,”分割</span><br><span class="line"> </span><br><span class="line">案例：本身test用户不能添加用户，要求使用sudo配置，</span><br><span class="line">将其设置为可以添加用户，并且可以修改密码（但是不能修改root用户密码）。</span><br><span class="line">注意：在写sudo规则的时候不建议写直接形式的命令，而是写命令的完整路径。</span><br><span class="line">路径可以使用which命令来查看</span><br><span class="line">语法：#which 指令名称</span><br><span class="line">在输入sudo指令之后需要输入当前的用户密码进行确认的操作（不是root用户密码），输入之后在接下来<span class="number">5</span>分钟内再次执行sudo指令不需要密码。</span><br><span class="line"> 此处按照案例要求，不能让test用户修改root密码，因此规则还需要调整，不然其可以修改root密码的：</span><br><span class="line">禁止修改root密码的配置（先允许全部，再拒绝root密码设置）： /usr/bin/passwd [A-Za-z]*, !/usr/bin/passwd root</span><br><span class="line">sudo  -l 在普通用户下查看自己具有哪些特殊权限</span><br><span class="line">sudo不是任何Linux分支都有的命令，常见centos与ubuntu都存在sudo命令。</span><br><span class="line"></span><br><span class="line">```sudo su```用户切换为root</span><br><span class="line">退出 root 身份，可以用 ```Ctrl + D``` 的组合键，或者用 ```exit``` 命令</span><br><span class="line"></span><br><span class="line">```whoami``` 我是谁，显示当前登录的用户名</span><br><span class="line"></span><br><span class="line">```adduser test 创建用户```</span><br><span class="line">passwd test</span><br><span class="line">输入密码</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">[<span class="symbol">root@</span>VM<span class="number">-0</span><span class="number">-9</span>-centos ~]# date</span><br><span class="line">Mon Mar  <span class="number">1</span> <span class="number">16</span>:<span class="number">46</span>:<span class="number">16</span> CST <span class="number">2021</span></span><br><span class="line"># CST  Central Standard Time “中央标准时间”</span><br><span class="line">[<span class="symbol">root@</span>VM<span class="number">-0</span><span class="number">-9</span>-centos ~]# date +%F</span><br><span class="line"><span class="number">2021</span><span class="number">-03</span><span class="number">-01</span></span><br><span class="line">[<span class="symbol">root@</span>VM<span class="number">-0</span><span class="number">-9</span>-centos ~]# date <span class="string">"+%Y-%m-%d"</span></span><br><span class="line"><span class="number">2021</span><span class="number">-03</span><span class="number">-01</span></span><br><span class="line">[<span class="symbol">root@</span>VM<span class="number">-0</span><span class="number">-9</span>-centos ~]# date <span class="string">"+%Y %T"</span></span><br><span class="line"><span class="number">2021</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">47</span></span><br><span class="line">[<span class="symbol">root@</span>VM<span class="number">-0</span><span class="number">-9</span>-centos ~]# date <span class="string">"+%Y-%m-%d %H:%M:%S"</span></span><br><span class="line"><span class="number">2021</span><span class="number">-03</span><span class="number">-01</span> <span class="number">16</span>:<span class="number">54</span>:<span class="number">21</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>VM<span class="number">-0</span><span class="number">-9</span>-centos ~]# cal</span><br><span class="line">     March <span class="number">2021</span>     </span><br><span class="line">Su Mo Tu We Th Fr Sa</span><br><span class="line">    <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span></span><br><span class="line"><span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span></span><br><span class="line"><span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">24</span> <span class="number">25</span> <span class="number">26</span> <span class="number">27</span></span><br><span class="line"><span class="number">28</span> <span class="number">29</span> <span class="number">30</span> <span class="number">31</span></span><br></pre></td></tr></tbody></table></figure>
<p>引号表示让“年月日与时分秒”成为一个不可分割的整体</p>
<p>Windows 可执行程序以 .exe 结尾<br>Linux 每一条命令其实对应了一个可执行程序，一般是没有后缀名的</p>
<ul>
<li>在终端中输入命令，按回车的时候，就是执行了对应的那个程序，</li>
<li>一个命令，其实只不过是一个我们随时可以调用的程序罢了</li>
</ul>
<h3 id="which-命令：显示一个命令的对应的可执行文件程序的位置"><a href="#which-命令：显示一个命令的对应的可执行文件程序的位置" class="headerlink" title="which 命令：显示一个命令的对应的可执行文件程序的位置"></a>which 命令：显示一个命令的对应的可执行文件程序的位置</h3><p>which命令接受一个参数，是你想知道其可执行程序位于哪里的那个命令</p>
<ul>
<li>pwd 命令对应的 pwd 这个可执行程序位于 Linux 中的 /usr/bin 目录中<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]# which pwd</span><br><span class="line"><span class="meta">#</span><span class="bash"> /usr/bin/<span class="built_in">pwd</span></span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>selinux 安全模块</p>
<p>bin binary 二进制，可执行文件<br>dev device 硬件<br>etc 系统配置文件，root才能登<br>home 家目录  类似window user<br>prov 进程</p>
<p>usr 对应 win program files</p>
<figure class="highlight plain"><figcaption><span>命令``` manual 命令使用手册</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">```q``` 退出 quit</span><br><span class="line">```help``` 命令查看保留关键字</span><br><span class="line"></span><br><span class="line">folder 文件夹</span><br><span class="line">file 文件</span><br><span class="line">```command parameters```命令和参数之间有空格隔开</span><br><span class="line">参数好比选项，改变命令的行为，同一个命令不同功能 </span><br><span class="line">区分大小写</span><br><span class="line"></span><br><span class="line">### 短参数（一个横杠、一个字母 缩写名称）</span><br><span class="line">最常用的参数形式就是一个短横线后接一个字母 command -p</span><br><span class="line">一次加好几个短参数，可以用空格隔开：command -p -a -T -</span><br><span class="line">多个短参数也可以合并在一起，效果是叠加：command -paT</span><br><span class="line"></span><br><span class="line">### 长参数（两个横杠、多个字母 全称）</span><br><span class="line">长参数没有短参数那么常用，但也是很有用的</span><br><span class="line">短参数是以一个短横线开始，而长参数是以两个短横线开始的</span><br><span class="line">格式：```command --parameter```</span><br><span class="line">多个长参数，是不能像多个短参数那样合并写的</span><br><span class="line">而是只能以空格隔开：```command --parameter1 --parameter2```</span><br><span class="line">可以组合使用短参数和长参数</span><br><span class="line">例如 ```command -paTc --parameter1 --parameter2```</span><br><span class="line">有时候，同一个意义的参数有短参数和长参数两种形式</span><br><span class="line">效果是一样的：例如 ```ls -a``` 和 ```ls --all```</span><br><span class="line"></span><br><span class="line">### 参数的值</span><br><span class="line">有一些参数需要赋值。短参数和长参数的赋值方式不一样</span><br><span class="line">短参数赋值，通常是这样的：command -p </span><br><span class="line">长参数赋值，通常是这样的：command --parameter=10</span><br><span class="line"></span><br><span class="line">```tab``` 在输入了一个命令的首字母或前几个字母后，自动补全命令或文件名、路径名，按两下有提示 可以增加效率，防止手动输入路径时将名字写错，同时想不起来一个命令到底是如何拼写 </span><br><span class="line"></span><br><span class="line">```#```开头 注释</span><br><span class="line">向上键：按时间顺序向前查找用过的命令，每按一次就前进一个命令</span><br><span class="line">向下键：按时间顺序向后查找用过的命令，每按一次就前进一个命令</span><br><span class="line"></span><br><span class="line">```Ctrl + R``` 用于查找使用过的命令</span><br><span class="line">```history``` 列出之前使用过的所有命令</span><br><span class="line">```!编号```这样的格式来重新运行 history输出中对应编号的命令</span><br><span class="line"></span><br><span class="line">空格下一页</span><br><span class="line">回车：运行，下一行</span><br><span class="line"></span><br><span class="line">### CentOS 的终端默认是有颜色标注的。</span><br><span class="line">- 蓝色 --&gt; 目录</span><br><span class="line">- 绿色 --&gt; 可执行文件</span><br><span class="line">- 红色 --&gt; 压缩文件</span><br><span class="line">- 浅蓝色 --&gt; 链接文件</span><br><span class="line">- 灰色 --&gt; 其他文件</span><br><span class="line"></span><br><span class="line">```ls```列出文件和目录</span><br><span class="line">```ls -l 路径``` ：缩写```ll```，以详细信息列表的形式列出当前目录下的文件和目录，查看权限 每一个文件或目录都有对应的一行信息，列出的文件详细信息中，文件大小是以字节为单位的</span><br><span class="line"></span><br><span class="line">```ls -a``` ：显示所有文件和目录，包括隐藏的（以.开头）</span><br><span class="line"></span><br><span class="line">不包括开头的两个 . 和 .. </span><br><span class="line">```.``` （一个点）表示当前目录； ```..``` （两个点）表示上一级目录</span><br><span class="line">```ls -A``` ：作用和小写的 -a 几乎一样，唯一不同就是 -A 不列出 . 和 .. 这两个文件</span><br><span class="line"></span><br><span class="line">```ls -la 路径``` ：所以文件（夹） ，并显示隐藏文件，以.开头，</span><br><span class="line"></span><br><span class="line">```ls --color=auto``` 来开启颜色标注</span><br><span class="line">```ls --color=none```关闭颜色标注</span><br><span class="line">```bash</span><br><span class="line">[root@VM-0-9-centos ~]# ls -l /root</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root    0 Feb 28 23:13 authorized_keys</span><br><span class="line">drwxr-xr-x 2 root root 4096 Mar  1 00:37 dev</span><br></pre></td></tr></tbody></table></figure>
<p>上述列表中的第一列字符表示文档的类型,其中“-”表示改行对应的文档类型为文件,“d”表示文档类型为文件夹。|<br>a. 其是文件夹类型<br>b. 文件的所有者：拥有全部权限（读写执行）<br>c. 文件所在的群组同组用户：可读、可执行<br>d. 其他用户：可读、可执行<br>e.文件链接数量3个<br>文件大小：单位是 octet， byte“字节”<br>最近一次修改的时间<br>最后一列 文件或目录的名</p>
<figure class="highlight ls"><figcaption><span>-h```human readable，“适合人类阅读的” 以 Ko，Mo，Go 的形式显示文件大小</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">``<span class="javascript"><span class="string">`ls -lh 路径</span></span>``` 列出指定路径下的所有文件/文件夹的名称，以列表的形式并且在显示文档大小的 时候以可读性较高的形式显示</span><br><span class="line"></span><br><span class="line">``<span class="javascript"><span class="string">`ls -t</span></span>```按照文件或目录最近一次修改时间的降序排列</span><br><span class="line"></span><br><span class="line">``<span class="javascript"><span class="string">`ls -l |grep jpg | wc -l</span></span>```一个目录里,有各种文件类型:文本文件,图片,音频,视频。如果你想知道这里面有多少个JPEG类型的图片。</span><br><span class="line">``<span class="javascript"><span class="string">`ls -l |grep jpg | wc -l &gt; jpeg_num.txt</span></span>```把统计的数目存储到一个文本文件(jpeg_nb.txt)里</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">``<span class="javascript"><span class="string">`ls -l |grep jpg | wc -l &gt; jpeg_num.txt | mail -s "jpeg number" ashe@gmail.com</span></span>```先统计这个数目,保存到 jpeg nb. txt文件里,再把这个文件用emai传给一个朋友</span><br><span class="line"></span><br><span class="line">``<span class="javascript"><span class="string">`ctrl+L</span></span>```用于清理终端的内容,清屏。同 ``<span class="javascript"><span class="string">`</span>clear</span>```命令,  并不是真的清除了之前的信息,而是把之前的信息的隐藏到了最上面,通过滚动条继续查看以前的信息。  </span><br><span class="line">``<span class="javascript"><span class="string">`Ctrl+D</span></span>```给终端传递EOF( End <span class="keyword">of</span> file,文件结束符)  </span><br><span class="line">``<span class="javascript"><span class="string">`Shift+PgUp</span></span>```用于向上滚屏,与鼠标的滚轮向上滚屏是一个效果  </span><br><span class="line">``<span class="javascript"><span class="string">`Shift + PgDn</span></span>``` 用于向下滚屏，与鼠标的滚轮向下滚屏是一个效果  </span><br><span class="line">``<span class="javascript"><span class="string">`ctrl+a</span></span>``` 光标移动到行首 Home 键有相同的效果  </span><br><span class="line">``<span class="javascript"><span class="string">`ctrl+e</span></span>``` 光标移动到行末 End 键有相同的效果  </span><br><span class="line">``<span class="javascript"><span class="string">`ctrl+u</span></span>``` 剪切/删除 光标到行首、除所有在光标左侧的命令字符  </span><br><span class="line">``<span class="javascript"><span class="string">`crtl+k</span></span>```剪切/删除光标后的内容 光标右侧的命令字符  </span><br><span class="line">``<span class="javascript"><span class="string">`ctrl+w</span></span>``` 剪切/删除光标左侧的一个“单词”word,用空格隔开的一个字符串。例如 -a 就是一个“单词  </span><br><span class="line">``<span class="javascript"><span class="string">`ctrl+y</span></span>``` 粘贴用 Ctrl + U， Ctrl + K 或 Ctrl + W“删除”的字符串，有点像“剪切-粘贴”  </span><br><span class="line"></span><br><span class="line">``<span class="javascript"><span class="string">`cd</span></span>```等同于``<span class="javascript"><span class="string">`</span>cd ~</span>``` 等同于``<span class="javascript"><span class="string">`cd /home/username</span></span>``` change directory 直接切换到家目录  </span><br><span class="line">``<span class="javascript"><span class="string">`cd 路径</span></span>```要去的那个目录的路径  </span><br><span class="line">``<span class="javascript"><span class="string">`cd ..</span></span>``` 要回到上一级目录（父目录）  </span><br><span class="line">``<span class="javascript"><span class="string">`cd ../..</span></span>``` 要回到上一级目录的上一级目录（爷目录）</span><br><span class="line"></span><br><span class="line">``<span class="javascript"><span class="string">`du</span></span>``` disk usage “磁盘使用/占用”，文件和目录所占的空间大小，深入遍历每个目录的子目录，统计所有文件的大 默认情况下只显示目录的大小</span><br><span class="line">``<span class="javascript"><span class="string">`du -h</span></span>``` 目录路径  以较高可读性的形式显示 以 Ko，Mo，Go 的形式显示文件大小</span><br><span class="line">``<span class="javascript"><span class="string">`du -a</span></span>``` 目录路径  显示文件和目录的大小 汇总</span><br><span class="line">``<span class="javascript"><span class="string">`du -s</span></span>``` 目录路径 summary 只显示汇总大小，当前目录的总大小</span><br><span class="line">``<span class="javascript"><span class="string">`du -sh</span></span>``` 目录路径 查看目录的真实大小</span><br><span class="line"></span><br><span class="line"><span class="comment">### </span></span><br><span class="line">xargs（eXtended ARGuments）是给命令传递参数的一个过滤器，也是组合多个命令的一个工具。</span><br><span class="line">xargs 可以将管道或标准输入（stdin）数据转换成命令行参数，也能够从文件的输出中读取数据。</span><br><span class="line">xargs 也可以将单行或多行文本输入转换为其他格式，例如多行变单行，单行变多行。</span><br><span class="line">xargs 默认的命令是 echo，这意味着通过管道传递给 xargs 的输入将会包含换行和空白，不过通过 xargs 的处理，换行和空白将被空格取代。</span><br><span class="line">xargs 是一个强有力的命令，它能够捕获一个命令的输出，然后传递给另外一个命令。</span><br><span class="line"></span><br><span class="line">之所以能用到这个命令，关键是由于很多命令不支持|管道来传递参数，而日常工作中有有这个必要，所以就有了 xargs 命令，例如：</span><br></pre></td></tr></tbody></table></figure>
<p>find /sbin -perm +700 |ls -l       #这个命令是错误的<br>find /sbin -perm +700 |xargs ls -l   #这样才是正确的</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xargs 一般是和管道一起使用。</span><br><span class="line">命令格式：```somecommand |xargs -item  command```</span><br><span class="line"></span><br><span class="line">交互式 Bash Shell 只输出进程pid的ID号，进程名字为adb。</span><br><span class="line">```bash</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# ps -ef|grep mysql</span><br><span class="line">mysql     <span class="number">3361</span>     <span class="number">1</span>  <span class="number">1</span> <span class="number">21</span>:<span class="number">06</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> /usr/sbin/mysqld</span><br><span class="line">root      <span class="number">3460</span>  <span class="number">3435</span>  <span class="number">0</span> <span class="number">21</span>:<span class="number">08</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep --color=<span class="built_in">auto</span> mysql</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# ps -ef|grep python</span><br></pre></td></tr></tbody></table></figure>
<h1 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># pgrep -f mysql    # 仅输出进程ID号</span></span><br><span class="line">3361</span><br></pre></td></tr></tbody></table></figure>
<h1 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ps -ef|grep mysql|awk '{print $2}'</span></span><br><span class="line">3361</span><br><span class="line">3486</span><br></pre></td></tr></tbody></table></figure>
<p>获取到pid后，可以进行后续处理。比如执行删除等操作。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | awk <span class="string">'{print $2}'</span> | xargs <span class="built_in">kill</span> -9</span><br></pre></td></tr></tbody></table></figure>
<p>如果需要查找到 pid 之后 kill 掉该进程，还可以使用 pkill：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkill -f name</span><br></pre></td></tr></tbody></table></figure>

<p>找出占用端口的进程</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># netstat -anp|grep ":80 " |grep LISTEN</span></span><br><span class="line">tcp     0      0 0.0.0.0:80        0.0.0.0:*      LISTEN      17785/nginx: worker</span><br></pre></td></tr></tbody></table></figure>

<h3 id="替换指定的目录及其子目录下所有文件中的adc为bcd。"><a href="#替换指定的目录及其子目录下所有文件中的adc为bcd。" class="headerlink" title="替换指定的目录及其子目录下所有文件中的adc为bcd。"></a>替换指定的目录及其子目录下所有文件中的adc为bcd。</h3><p>sed [-hnV][-e<script>][-f<script文件>][文本文件]<br>（ stream editor 简写sed ）</p>
<p>sed 可以直接修改文件的内容，不必使用管道命令或数据流重导向！<br>-i 选项可以直接修改文件内容，举例来说，如果你有一个 100 万行的文件，你要在第 100 行加某些文字，此时使用 vim 可能会疯掉！因为文件太大了！那怎办？就利用 sed 啊！透过 sed 直接修改/取代的功能，你甚至不需要使用 vim 去修订！<br>s ：取代，可以直接进行取代的工作，通常这个 s 的动作可以搭配正规表示法！<br>例如 1,20s/old/new/g 就是啦！<br>c ：取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！<br>如果是要改变两行以上，每一行之间都必须要以反斜杠『 \ 』来进行新行的添加喔！所以，上面的例子中，我们可以发现在第一行的最后面就有 \ 存在。</p>
<p>方法一</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find -type f | xargs cat</span></span><br><span class="line">adc</span><br><span class="line">adc</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find -type f | xargs sed -i &#x27;s/adc/bcd/g&#x27; </span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find -type f | xargs cat</span></span><br><span class="line">bcd</span><br><span class="line">bcd</span><br></pre></td></tr></table></figure>
<p>方法二</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># sed -i &#x27;s/adc/bcd/g&#x27; `grep &quot;adc&quot; -rl ./`</span></span><br><span class="line"><span class="comment"># 注意：grep内容是用的反引号</span></span><br></pre></td></tr></table></figure>

<p>替换某个文件中的内容adb为bcd（替换指定文件的字符串）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cat hello.txt </span></span><br><span class="line">i love you</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># sed -i &quot;s/i/I/g&quot; hello.txt </span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cat hello.txt </span></span><br><span class="line">I love you</span><br></pre></td></tr></table></figure>

<p>软链接有点类似于Windows中的快捷方式，里面保存的是指向源文件的绝对路径，当访问它的时候就会替换成指向文件的路径。对于操作系统是通过 inode值访问硬盘的区块，对于软链接来说inode值和源文件的inode值是不一样的，但是硬链接是一样的inode值。只要有文件inode值指向这个区块，这个文件就始终不会消失。软链接文件只是维持了从软链接到源文件的指向关系，不是源文件的内容。</p>
<p>硬链接相当于创建了一个普通文件，但硬链接的inode值和源文件的inode值相同都指向同一个区块。硬链接文件的内容和源文件的内容一模一样，相当于copy了一份源文件。</p>
<p>inode介绍：文件或目录的inode编号是一个用于标识的唯一数字，这个数字由内核分配给文件系统中的每一个对象。inode就像人的身份证。</p>
<p>crontad:定时任务<br>例如：下单操作，需要在单个小时内付完款，通过定时任务每半个小时进行一下数据释放。</p>
<ol>
<li>编辑当前用户的计数器设置，与vim操作是一样的<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[xiaokang@localhost ~]$ crontab -e      <span class="comment"># 编辑crontab</span></span><br><span class="line">crontab: no changes made to crontab</span><br></pre></td></tr></table></figure></li>
<li>列出该用户的计数器设置<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[xiaokang@localhost www]$ crontab -l</span><br><span class="line">*/1 * * * * php /data/www/cron.php  &gt;&gt; /tmp/cron.log   <span class="comment"># */1表示每隔1分钟执行一次</span></span><br><span class="line"><span class="comment"># * * * * * 分别代表分 时 日 月 周</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<p><code>nslookup domain[dns-server]</code> 查看域名解析是否正常，在网络故障的时候用来诊断网络问题。<br>可以指定查询的类型，可以查到DNS记录的生存时间还可以指定使用那个DNS服务器进行解释。</p>
<p>如何用本地计算机查询DNS记录?</p>
<p>打开命令提示符窗口(开始–运行—输入CMD–回车)</p>
<p><code>nslookup –qt=类型 目标域名</code>(注意qt必须小写)</p>
<p>类型主要有:</p>
<p>A 地址记录(Ipv4)</p>
<p>AAAA 地址记录（Ipv6）</p>
<p>CNAME 别名记录</p>
<p>HINFO 硬件配置记录，包括CPU、操作系统信息</p>
<p>ISDN 域名对应的ISDN号码</p>
<p>MB 存放指定邮箱的服务器</p>
<p>MG 邮件组记录</p>
<p>MINFO 邮件组和邮箱的信息记录</p>
<p>MR 改名的邮箱记录</p>
<p>MX 邮件服务器记录</p>
<p>NS 名字服务器记录</p>
<p>PTR 反向记录</p>
<p>RP 负责人记录</p>
<p>SRV TCP服务器信息记录</p>
<p>TXT 域名对应的文本信息</p>
<p>比如你要查询tool.chinaz.com的A记录,那在命令符提示窗口输入：</p>
<pre class=" language-shell"><code class="language-shell">nslookup -qt=a tool.chinaz.com
</code></pre>
<p>则可以查到相应的记录</p>
<h2 id="如何使用指定DNS服务器查询"><a href="#如何使用指定DNS服务器查询" class="headerlink" title="如何使用指定DNS服务器查询?"></a>如何使用指定DNS服务器查询?</h2><p>语法为<br><code>nslookup -qt=类型 目标域名 指定的DNS服务器IP或域名</code></p>
<p>例子：<br><code>nslookup -qt=A tool.chinaz.com 8.8.8.8</code></p>
<p>返回信息说明<br>服务器：本机DNS服务器信息</p>
<p>非权威应答：Non-authoritative answer，除非实际存储DNS Server中获得域名解析回答的，都称为非权威应答。也就是从缓存中获取域名解析结果。</p>
<p>address：目标域名对应物理IP可有多个</p>
<p>aliase：目标域名<br>nslookup google.com 和 nslookup google.com 8.8.8.8</p>
<p>1 查看内存总数</p>
<p>cat /proc/meminfo | grep MemTotal</p>
<p>2.查看当前系统用户数</p>
<p>who</p>
<p>统计显示 7个用户</p>
<p>3.查看当前系统版本及系统位数</p>
<p>uname -a</p>
<p>4.查看当前系统引用的JDK 是否是自己安装的配置的jdk</p>
<p>which java</p>
<p>5.查看系统端口是否被占用</p>
<p>netstat -pan|grep 8017</p>
<p>使用 netstat + grep 来查看某个端口是否在使用</p>
<p>6.查看系统进程 （查看项目or应用程序的进程）</p>
<p>ps -ef|grep tomcat-probe</p>
<p>7.查看防火墙状态及启动防火墙</p>
<p>service iptables status</p>
<p>启动的话： service iptables start</p>
<p>8.查看文件在哪个目录路径</p>
<p>命令：locate</p>
<p>如：locate stats.properties</p>
<p>9查看系统内存</p>
<p>命令：free -m</p>
<p>参数 m 是兆</p>
<p>10.网络配置（相关命令）</p>
<p>命令：ifconfig</p>
<p>11.系统资源查看</p>
<p>命令： vmstat</p>
<p>命令 ：top</p>
<p>命令： uptime</p>
<p>12:目录命令操作</p>
<p>mkdir -p a/b/c —- 批量新增目录</p>
<p>mv 命令可以重命名</p>
<p>cp 命令 复制文件或者文件夹 （可用于项目包的备份处理）</p>
<p>如： cp -rf 123.tar …/backup/123.tar.20181122</p>
<p>13:文件操作</p>
<p>文件的操作，个人觉得有些命令很常用， cat ,tail (监控查看日志文件)、vi</p>
<p>vi 命令涉及到很多实用快捷操作 ，</p>
<p>三中模式：</p>
<p>（命令模式 、编辑模式 、末行模式）</p>
<p>N 向上查找</p>
<p>n 向下查找</p>
<p>—- 删除命令</p>
<p>ndw或ndW：删除光标处开始及其后的n-1个字</p>
<p>do：删至行首</p>
<p>d$：删至行尾</p>
<p>—- 搜索及替换命令</p>
<p>/pattern：从光标开始处向文件尾搜索pattern</p>
<p>?pattern：从光标开始处向文件首搜索pattern</p>
<p>n：在同一方向重复上一次搜索命令</p>
<p>N：在反方向上重复上一次搜索命令</p>
<p>：1，$ s/p1/p2/g：将当前行中所有p1均用p2替代</p>
<p>：n1,n2s/p1/p2/g：将第n1至n2行中所有p1均用p2替代</p>
<p>13:修改文件或者目录权限</p>
<p>chmod chown chgrp 命令的使用</p>
<p>14：查看文件大小</p>
<p>命令：du</p>
<p>15：查看环境变量</p>
<p>命令： env</p>
<p>还有 set 命令也可以</p>
<p>补充：</p>
<p>2.1 在/etc/profile文件中添加变量【对所有用户生效(永久的)】</p>
<p>用VI在文件/etc/profile文件中增加变量，该变量将会对Linux下所有用户有效，并且是“永久的”。</p>
<p>例如：编辑/etc/profile文件，添加CLASSPATH变量</p>
<h1 id="vi-etc-profile"><a href="#vi-etc-profile" class="headerlink" title="vi /etc/profile"></a>vi /etc/profile</h1><p>export CLASSPATH=./JAVA_HOME/lib;$JAVA_HOME/jre/lib</p>
<p>注：修改文件后要想马上生效还要运行# source /etc/profile不然只能在下次重进此用户时生效。</p>
<p>2.2 在用户目录下的.bash_profile文件中增加变量【对单一用户生效(永久的)】</p>
<p>用VI在用户目录下的.bash_profile文件中增加变量，改变量仅会对当前用户有效，并且是“永久的”。</p>
<p>例如：编辑guok用户目录(/home/guok)下的.bash_profile</p>
<p>$ vi /home/guok/.bash.profile</p>
<p>添加如下内容：</p>
<p>export CLASSPATH=./JAVA_HOME/lib;$JAVA_HOME/jre/lib</p>
<p>注：修改文件后要想马上生效还要运行$ source /home/guok/.bash_profile不然只能在下次重进此用户时生效</p>
<p>16：抓包</p>
<p>命令 tcpdump</p>
<p>tcpdump -s 0 -w /tmp/20150203.cap host 211.137.182.167</p>
<p>17:查找文件并询问是否删除</p>
<p>find ./ -name ‘IceGpsAndGprsAnalyze*’ -exec rm -i {} ;</p>
<p>18：修改系统时间</p>
<p>date -s “20120827 15:04:00”</p>
<p>或者</p>
<p>date -s “2012-08-27 15:04:00”</p>
<p>或者</p>
<p>date -s “15:04:00 2012-08-27”</p>
<p>或者</p>
<p>date -s “15:04:00 20120827”</p>
<p>记得 双引号</p>
<p>19 通过关键字 来查找包含关键字的文件</p>
<p>命令 find</p>
<p>find ./ -type f|xargs grep “T2001774”</p>
<p>find . -name * -type f -print |xargs grep ‘关键字’</p>
<p>命令： grep</p>
<p>grep ‘T2001774’ ./*</p>
<p>20：文件压缩和解压</p>
<p>压缩</p>
<p>tar -cvf jpg.tar *.jpg //将目录里所有jpg文件打包成tar.jpg</p>
<p>tar -czf jpg.tar.gz *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用gzip压缩，生成一个gzip压缩过的包，命名为jpg.tar.gz</p>
<p>tar -cjf jpg.tar.bz2 *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用bzip2压缩，生成一个bzip2压缩过的包，命名为jpg.tar.bz2</p>
<p>tar -cZf jpg.tar.Z *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用compress压缩，生成一个umcompress压缩过的包，命名为jpg.tar.Z</p>
<p>rar a jpg.rar *.jpg //rar格式的压缩，需要先下载rar for linux</p>
<p>zip jpg.zip *.jpg //zip格式的压缩，需要先下载zip for linux</p>
<p>解压</p>
<p>tar -xvf file.tar //解压 tar包</p>
<p>tar -xzvf file.tar.gz //解压tar.gz</p>
<p>tar -xjvf file.tar.bz2 //解压 tar.bz2</p>
<p>tar -xZvf file.tar.Z //解压tar.Z</p>
<p>unrar e file.rar //解压rar</p>
<p>unzip file.zip //解压zip</p>
<p>总结</p>
<p>1、*.tar 用 tar -xvf 解压</p>
<p>2、*.gz 用 gzip -d或者gunzip 解压</p>
<p>3、.tar.gz和.tgz 用 tar -xzf 解压</p>
<p>4、*.bz2 用 bzip2 -d或者用bunzip2 解压</p>
<p>5、*.tar.bz2用tar -xjf 解压</p>
<p>6、*.Z 用 uncompress 解压</p>
<p>7、*.tar.Z 用tar -xZf 解压</p>
<p>8、*.rar 用 unrar e解压</p>
<p>9、*.zip 用 unzip 解压</p>
</script></p><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/mock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/mock/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>mock用来替代你测试应用的某一部分<br>好处<br>1：加快测试速度，如果你的应用是依赖于资源的，mock可以有效减少资源的占用<br>2：避免不必要的副作用</p>
<p>在单元测试进行的同时，就离不开mock模块的存在，初次接触这个概念的时候会有这样的疑问：把要测的东西都模拟掉了还测试什么呢？<br>　　但在，实际生产中的项目是非常复杂的，对其进行单元测试的时候，会遇到以下问题：<br>•接口的依赖<br>•外部接口调用<br>•测试环境非常复杂<br>单元测试应该只针对当前单元进行测试, 所有的内部或外部的依赖应该是稳定的, 已经在别处进行测试过的.使用mock 就可以对外部依赖组件实现进行模拟并且替换掉, 从而使得单元测试将焦点只放在当前的单元功能。<br>在这里插入图片描述<br>因为在为代码进行单元测试的同时，会发现该模块依赖于其他的模块，例如数据库，网络，或者第三方模块的存在，而我们对一个模块进行单元测试的目的，是测试当前模块正常工作，这样就要避开对其他模块的依赖，而mock主要作用便在于，专注于待测试的代码。而在但与测试中，如何灵活的使用mock模块是核心所在。下面便以mock为核心，结合最近所写的代码，阐述mock模块的使用。</p>
<p>这个例子，本来被调用的sum函数要执行很长时间为了加快测试进度，我们使用patch装饰器来直接mock sum函数</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> patch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    time.sleep(<span class="number">100</span>)  <span class="comment"># long running process</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCalculator</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 用patch装饰器来mock对象</span></span><br><span class="line"><span class="meta">    @patch('__main__.sum', return_value=5)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sum</span>(<span class="params">self, sum</span>):</span></span><br><span class="line">        self.assertEqual(sum(<span class="number">2</span>, <span class="number">3</span>), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Ran 1 test in 0.001s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OK</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="7">
<li>mock模块的使用<br>在mock模块中，两个常用的类型为Mock，MagicMock，两个类的关系是MagicMock继承自Mock，最重要的两个属性是return_value, side_effect。<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> mock <span class="keyword">import</span> Mock</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fake_obj = Mock()</span><br><span class="line">&gt;&gt;&gt;fake_obj.return_value = <span class="string">'This is a mock object'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fake_obj()</span><br><span class="line"><span class="string">'This is a mock object'</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>我们通过Mock()可以创建一个mock对象，通过renturn_value 指定它的返回值。即当下文出现fake_obj()会返回其return_value所指定的值。<br>也可以通过side_effect指定它的副作用，这个副作用就是当你调用这个mock对象是会调用的函数,也可以选择抛出一个异常，来对程序的错误状态进行测试。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="function"><span class="keyword">def</span> <span class="title">b</span>():</span></span><br><span class="line"><span class="meta">... </span>   <span class="keyword">print</span> <span class="string">'This is b'</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;fake_obj.side_effect = b</span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line">This <span class="keyword">is</span> b</span><br><span class="line">&gt;&gt;&gt;fake_obj.side_effect = KeyError(<span class="string">'This is b'</span>)</span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line">...</span><br><span class="line">KeyError: <span class="string">'This is b'</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果要模拟一个对象而不是函数，你可以直接在mock对象上添加属性和方法，并且每一个添加的属性都是一个mock对象【注意，这种方式很有用】，也就是说可以对这些属性进行配置,并且可以一直递归的定义下去。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;fake_obj.fake_a.return_value = <span class="string">'This is fake_obj.fake_a'</span></span><br><span class="line">&gt;&gt;&gt;fake_obj.fake_a()</span><br><span class="line"><span class="string">'This is fake_obj.fake_a'</span></span><br></pre></td></tr></tbody></table></figure>
<p>上述代码片段中fake_obj是一个mock对象，而fake_obj.fake_a的这种形式使得fake_a变成了fake_obj的一个属性，作用是在fake_obj.fake_a()调用时会返回其return_value。<br>另外也可以通过为side_effect指定一个列表，这样在每次调用时会依次返回，如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fake_obj = Mock(side_effect = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line"><span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>
<p>7.1 函数的如何mock<br>在rbd_api.py文件中如下内容：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DAO_PoolMgr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkpoolstat</span>(<span class="params">pool_name</span>)</span></span><br><span class="line">  ret， poolstat = DAO_PoolMgr.DAO_query_ispoolok(pool_name)</span><br><span class="line"><span class="keyword">if</span> ret != MGR_COMMON.MONGO_SUCCESS:</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"><span class="keyword">if</span> poolstat <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">    <span class="keyword">return</span> MGR_COMMON.POOL_STAT_ERROR</span><br><span class="line"><span class="keyword">return</span> MGR_COMMON.SUCCESS</span><br></pre></td></tr></tbody></table></figure>

<p>要为这个函数撰写单元测试，因为其有数据库的操作，因而就需要mock 出DAO_query_ispoolok操作。<br>因此，我们在test_rbd_api.py文件中可以这么写：因为DAO_query_ispoolok是类DAO_PoolMgr的操作，因此可以这么写</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> DAO_PoolMgr</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> rbd_api <span class="keyword">as</span> rbdAPI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAuxiliaryFunction</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.pool_name = <span class="string">"aaa"</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.pool_name = <span class="literal">None</span></span><br><span class="line"><span class="meta">    @mock.patch.object(DAO_PoolMgr, "DAO_query_ispoolok")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_checkpoolstat</span>(<span class="params">self, mock_DAO_query_ispoolok</span>):</span></span><br><span class="line">        mock_DAO_query_ispoolok.return_value = (MGR_COMMON.POOL_STAT_ERROR, <span class="literal">None</span>)</span><br><span class="line">        self.<span class="keyword">assert</span>(rbdAPI.checkpoolstat(self.pool_name), MGR_COMMON.POOL_STAT_ERROR)</span><br><span class="line"></span><br><span class="line">        mock_DAO_query_ispoolok.return_value = (MGR_COMMON.SUCCESS, <span class="literal">False</span>)</span><br><span class="line">        self.<span class="keyword">assert</span>(rbdAPI.checkpoolstat(self.pool_name), MGR_COMMON.POOL_STAT_ERROR)</span><br><span class="line">        </span><br><span class="line">        mock_DAO_query_ispoolok.return_value = (MGR_COMMON.SUCCESS, <span class="literal">True</span>)</span><br><span class="line">        self.<span class="keyword">assert</span>(rbdAPI.checkpoolstat(self.pool_name), MGR_COMMON.SUCCESS)</span><br></pre></td></tr></tbody></table></figure>
<p>测试用例上的装饰器含义如下：<br>@mock.pathc.object(类名，“类中函数名”)，而如果想要忽略某个测试用例，则可以通过装饰器@unittest.skip(“原因”)<br>而对于另外一种情形则是在另外一个函数中调用了checkpoolstat函数。<br>如下rbd_api.py：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkpoolstat</span>():</span></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Disk</span>(<span class="params">Resource</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ……</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        ret = rbd_api.checkpoolstat()</span><br><span class="line">        ……</span><br></pre></td></tr></tbody></table></figure>
<p>这样，我们在为delete函数撰写单元测试时，也可以在test_rbd_api.py中使用如下的方式：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rbd_api</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDisk</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>():</span></span><br><span class="line">        …</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">teardown</span>():</span></span><br><span class="line">              …</span><br><span class="line"><span class="meta">      @mock.patch(“rbd_api.checkpoolstat”, Mock(return_value = True))</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">test_delete</span>():</span></span><br><span class="line">         <span class="comment"># rbd_api.checkpoolstat 已经成为一个mock对象了，调用时返回True</span></span><br><span class="line">            …</span><br></pre></td></tr></tbody></table></figure>
<p>此时的装饰器应该为</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@mock.patch(“模块名.函数名”)</span></span><br></pre></td></tr></tbody></table></figure>

<p>7.2 链式函数抛出异常<br>在rbd_api.py文件中，有一行代码如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = OpRBD(pool).flatten(img)</span><br></pre></td></tr></tbody></table></figure>
<p>类似这种链式调用的，在前一个函数中抛出异常，要怎么写？如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rbdServ.OpRBD = MagicMock()</span><br><span class="line">rbdServ.OpRBD(pool).side_effect = rados.Error(“Error: error connecting to the cluster: error code <span class="number">24</span>”)</span><br></pre></td></tr></tbody></table></figure>
<p>7.3 全局函数如何mock<br>例如在文件rbd_api.py中有全局函数checkpoolstat(pool)，它是一个全局函数，这样在进行单元测试的过程中，我们可能需要mock该函数。该函数的具体代码如下：</p>
<p>因此，我们在test_rbd_api.py文件中为该函数撰写单元测试，可以这么做。<br>在文件开始处导入该rbd_api模块。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rbd_api <span class="keyword">as</span> rbdAPI</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_patchInvalid_Parameter</span>(<span class="params">self</span>):</span></span><br><span class="line">    ……</span><br><span class="line">    rbdAPI.checkpoolstat.return_value = MGR_COMMON.POOL_STAT_ERROR</span><br><span class="line">    即可。</span><br></pre></td></tr></tbody></table></figure>
<p>7.4 链式调用正常<br>在rbd_api文件中有如下代码行：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = OpRBD(pool).flatten(img)</span><br></pre></td></tr></tbody></table></figure>
<p>在第一个函数未出现异常，在flatten函数中返回值可以在test_rbd_api.py文件中如下写代码：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rbdServ.OpRBD(pool).snap_rollback = MagicMock(return_value = RBD_COMMON.CODE_EXEC_SUCCESS_MODIFY)</span><br></pre></td></tr></tbody></table></figure>
<p>7.5 with子句mock</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpRBD</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">resize</span>(<span class="params">self, img, size</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> rbd.Image(self.ioctx, img) <span class="keyword">as</span> image:</span><br><span class="line">                <span class="keyword">if</span> image.size() &lt; size:</span><br><span class="line">                    image.resize(size)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> RBD_COMMON.CODE_ARGUMENT_LESS_THAN_ORIGINAL</span><br><span class="line">        <span class="keyword">except</span> rbd.ImageNotFound <span class="keyword">as</span> exce1</span><br><span class="line">          print(exce1)</span><br><span class="line">          <span class="keyword">return</span> RBD_COMMON.CODE_IMAGE_NOT_FOUND</span><br></pre></td></tr></tbody></table></figure>
<p>由于是在with子句中要进行mock，在此简单的对with的知识点进行说明：<br>要使用 with 语句，首先要明白上下文管理器这一概念。有了上下文管理器，with 语句才能工作。<br>下面是一组与上下文管理器和with 语句有关的概念。</p>
<p>上下文管理协议（Context Management Protocol）：包含方法 enter() 和 exit()，支持<br>该协议的对象要实现这两个方法。<br>上下文管理器（Context Manager）：支持上下文管理协议的对象，这种对象实现了 enter() 和 exit() 方法。上下文管理器定义执行 with 语句时要建立的运行时上下文，<br>负责执行 with 语句块上下文中的进入与退出操作。通常使用 with 语句调用上下文管理器，也可以通过直接调用其方法来使用。<br>运行时上下文（runtime context）：由上下文管理器创建，通过上下文管理器的 enter() 和<strong>exit</strong>() 方法实现，enter() 方法在语句体执行之前进入运行时上下文，exit() 在语句体执行完后从运行时上下文退出。with 语句支持运行时上下文这一概念。<br>上下文表达式（Context Expression）：with 语句中跟在关键字 with 之后的表达式，该表达式要返回一个上下文管理器对象。<br>语句体（with-body）：with 语句包裹起来的代码块，在执行语句体之前会调用上下文管理器的 enter() 方法，执行完语句体之后会执行 exit() 方法。<br>出现异常时，如果 exit(type, value, traceback) 返回 False，则会重新抛出异常，让with 之外的语句逻辑来处理异常，这也是通用做法；如果返回 True，则忽略异常，不再对异常进行处理。因此，在对with子句进行mock时，要具有两个函数，exit, enter，并且如果在with语句体重抛出异常并被with之外的代码进行捕获异常，要使得__exit__返回False，因此可以撰写测试代码如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpRBD</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">resize</span>(<span class="params">self, img, size</span>):</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> rbd.Image(self.ioctx, img) <span class="keyword">as</span> image:</span><br><span class="line">                    <span class="keyword">if</span> image.size() &lt; size:</span><br><span class="line">                        image.resize(size)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">return</span> RBD_COMMON.CODE_ARGUMENT_LESS_THAN_ORIGINAL</span><br><span class="line">            <span class="keyword">except</span> rbd.ImageNotFound <span class="keyword">as</span> exce1</span><br><span class="line">                print(exce1)</span><br><span class="line">                <span class="keyword">return</span> RBD_COMMON.CODE_IMAGE_NOT_FOUND</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestOpRBD</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">test_resize</span>(<span class="params">self</span>):</span></span><br><span class="line">            fake_image = Mock()</span><br><span class="line">            fake_image.__enter__ = Mock(return_value = fake_image)</span><br><span class="line">            fake_image.__exit__ = Mock(return_value = <span class="literal">True</span>)</span><br><span class="line">            rbd.Image = Mock(return_value = fake_image)</span><br><span class="line">            size = <span class="number">1073741824L</span> / <span class="number">2</span></span><br><span class="line">            fake_image.size = Mock(return_value = <span class="number">1073741824L</span>)</span><br><span class="line">            fake_image.resize = Mock(return_value = <span class="literal">None</span>)</span><br><span class="line">            self.assertEqual(self.opRBD.resize(self.img, size), RBD_COMMON.CODE_ARGUMENT_LESS_THAN_ORIGINAL)</span><br><span class="line">            </span><br><span class="line">            size = <span class="number">2</span> * <span class="number">1073741824L</span></span><br><span class="line">            self.assertEqual(self.opRBD.resize(self.img, size), RBD_COMMON.CODE_EXEC_SUCCESS_MODIFY)</span><br><span class="line">            rbd.Image = Mock(side_effect = rbd.ImageNotFound(<span class="string">"%s image not found!"</span> %self.img))</span><br><span class="line">            self.assertEqual(self.resize(self.img, size), RBD_COMMON.CODE_IMAGE_NOT_FOUND)</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line"><span class="number">7.6</span> 连续mock</span><br><span class="line">在rbd_api文件中有一个OpRados类的内容如下：</span><br><span class="line">```py</span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpRados</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">          self.cluster = rados.Rados(conffile=rconf[<span class="string">'conffile'</span>])</span><br><span class="line">          self.cluster.connect()</span><br><span class="line">     </span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">          self.cluster.shutdown()</span><br><span class="line">     </span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">lists</span>(<span class="params">self</span>):</span></span><br><span class="line">          <span class="keyword">return</span> util.return_format(RBD_COMMON.CODE_EXEC_SUCCESS_GET, <span class="string">""</span>, self.cluster.list_pools())</span><br><span class="line"></span><br><span class="line">为该类写单元测试，具体代码如下：</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> Mock</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestOpRados</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>)：</span></span><br><span class="line">        fake_Rados = Mock()</span><br><span class="line">        fake_Rados.connect = Mock(return_value = <span class="literal">None</span>)</span><br><span class="line">        fake_Rados.shutdown = Mock(return_value = <span class="literal">None</span>)</span><br><span class="line">        fake_Rados.list_pools = Mock(return_value = [<span class="string">"sqh"</span>, <span class="string">"sqh1"</span>])</span><br><span class="line">        <span class="comment"># 注意：此处要使得rados.Rados()调用返回fake_Rados.</span></span><br><span class="line">        <span class="comment"># 如果写成rados.Rados = fake_Rados,只能使得self.cluster重新生成一个Mock对象</span></span><br><span class="line">        <span class="comment"># 无法有效的控制为fake_Rados所添加的属性。</span></span><br><span class="line">        rados.Rados = Mock(return_value = fake_Rados)</span><br><span class="line">        self.opRados = OpRados()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        fake_Rados = <span class="literal">None</span></span><br><span class="line">        self.opRados = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_list</span>(<span class="params">self</span>):</span></span><br><span class="line">        return_list = [<span class="string">"sqh"</span>, <span class="string">"sqh1"</span>]</span><br><span class="line">        self.assertEqual(self.opRados.lists(), util.return_format(RBD_COMMON.CODE_EXEC_SUCCESS_GET,  <span class="string">""</span>, return_list))</span><br></pre></td></tr></tbody></table></figure>
<p>7.7 Flask API 接口的模拟调用<br>有三个文件：rbd_app.py文件内容如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> flask imort Flask</span><br><span class="line"><span class="keyword">from</span> flask.ext <span class="keyword">import</span> restful</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = restful.Api(app)</span><br><span class="line"></span><br><span class="line">api_version = <span class="string">"/v1.0"</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## Actually setup the Api resource ruting here</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">api.add_resource(rbd_api.Disk, api_version+<span class="string">"pools/&lt;pool&gt;/disks/&lt;img&gt;"</span>)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == __main__:</span><br><span class="line">    <span class="keyword">from</span> gevent.wsgi <span class="keyword">import</span> WSGIServer</span><br><span class="line">    http_server = WSGIServer((<span class="string">'0.0.0.0'</span>, <span class="number">4806</span>), app)</span><br><span class="line">    http_server.serve_forever()</span><br></pre></td></tr></tbody></table></figure>

<p>rbd_api.py文件中Disk类内容如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> reqparse, Resource</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Disk</span>(<span class="params">Resource</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        ret, rbd_info = DAO_query_rbd_info(pool, img)</span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        parser = reqparser.RequestParser()</span><br><span class="line">        <span class="comment"># action: create\copy\clone</span></span><br><span class="line">        parser.add_argument(<span class="string">'action'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'src_pool'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'src_rbd'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'src_snap'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'size'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'unit'</span>, type=str)</span><br><span class="line">        </span><br><span class="line">        action = args.get(<span class="string">'action'</span>)</span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"create"</span>:</span><br><span class="line">            size = args.get(<span class="string">'size'</span>)</span><br><span class="line">            unit = args.get(<span class="string">'unit'</span>)</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">'copy'</span>:</span><br><span class="line">            src_pool = args.get(<span class="string">'src_pool'</span>)</span><br><span class="line">            src_rbd = args.get(<span class="string">'src_rbd'</span>)</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        parser = reqparser.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">'rb_snap'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'action'</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"flatten"</span>:</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">"rollback"</span>:</span><br><span class="line">            snap = args.get(<span class="string">"rb_snap"</span>)</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        parser = reqparse.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">"action"</span>, type=srt)</span><br><span class="line">        parser.add_argument(<span class="string">"name"</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">"size"</span>, type=float)</span><br><span class="line">        parser.add_argument(<span class="string">"unit"</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        action = args.get(<span class="string">'action'</span>)</span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"resize"</span>:</span><br><span class="line">            size = args.get(<span class="string">'size'</span>)</span><br><span class="line">            unit = args.get(<span class="string">'unit'</span>)</span><br><span class="line">            ....</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> ...</span><br></pre></td></tr></tbody></table></figure>
<p>在test_rbd_api.py中卫Disk类撰写单元测试</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rbd_app <span class="keyword">import</span> app</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDisk</span>(<span class="params">uniitest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.disk = Disk()</span><br><span class="line">        self.content_type = <span class="string">"application/json"</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.disk = <span class="literal">None</span></span><br><span class="line">        self.content_type = <span class="literal">None</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @mock.path.object(DAO_RBDMgr, "DAO_query_rbd_info")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_get</span>(<span class="params">self, mock_DAO_query_rbd_info</span>):</span></span><br><span class="line">        rbd_info = {<span class="string">"pool_name"</span>:<span class="string">"sqh"</span>, <span class="string">"parent"</span>:{}, <span class="string">"image_size"</span>:<span class="number">1073741824L</span>,...}</span><br><span class="line">        mock_DAO_query_rbd_info.return_value = (RBD_COMMON.MONGO_SUCCESS, rbd_info)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(<span class="string">"/?pool_name=sqh&amp;image_name=sqh001"</span>):</span><br><span class="line">            pool = request.args.get(<span class="string">'pool_name'</span>)</span><br><span class="line">            img=request.args.get(<span class="string">'image_name'</span>)</span><br><span class="line">            self.assertEqual(selff.disk.get(pool, img), RBD_COMMON.http_return(RBD_COMMON.MONGO_SUCCESS))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_post</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"create"</span>, <span class="string">"size"</span>:<span class="number">2</span>, <span class="string">"unit"</span>:<span class="string">"GB"</span>}</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.post(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_GET))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_delete</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url):</span><br><span class="line">            self.assertEqual(self.disk.delete(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_DELETE))</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_put</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"rollback"</span>, <span class="string">"rb_snap"</span>:<span class="string">"sqh_snap"</span>}</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.put(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_FLATTENING))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_patch</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">'v1.0/pools/%s/disks/%s'</span> %　(pool, img)</span><br><span class="line">        size = <span class="number">1073741824L</span></span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"resize"</span>, <span class="string">"size"</span>:size, <span class="string">"unit"</span>:<span class="string">"GB"</span>}</span><br><span class="line">        <span class="comment"># the action resize</span></span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.patch(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_MODIFY))</span><br></pre></td></tr></tbody></table></figure>
<p>7.7.1 Get请求</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@mock.path.object(DAO_RBDMgr, "DAO_query_rbd_info")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_get</span>(<span class="params">self, mock_DAO_query_rbd_info</span>):</span></span><br><span class="line">        rbd_info = {<span class="string">"pool_name"</span>:<span class="string">"sqh"</span>, <span class="string">"parent"</span>:{}, <span class="string">"image_size"</span>:<span class="number">1073741824L</span>,...}</span><br><span class="line">        mock_DAO_query_rbd_info.return_value = (RBD_COMMON.MONGO_SUCCESS, rbd_info)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(<span class="string">"/?pool_name=sqh&amp;image_name=sqh001"</span>):</span><br><span class="line">            pool = request.args.get(<span class="string">'pool_name'</span>)</span><br><span class="line">            img=request.args.get(<span class="string">'image_name'</span>)</span><br><span class="line">            self.assertEqual(selff.disk.get(pool, img), RBD_COMMON.http_return(RBD_COMMON.MONGO_SUCCESS))</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">在为flask接口撰写单元测试时，最关键的是如何传递数据，</span><br><span class="line">我们在setUp函数中初始化Disk类的实例,即self.disk。在传递参数的时候通过调用app.test_request_context(“url”)。因为是restful的get请求，因而我们可以使用？param1=val1&amp;param2=val2的形式。</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.2</span> Post请求</span><br><span class="line">在Post请求，我们需要传递动作的类型，即其他参数，在app.test_request_context函数中，传递了字符串url， data字典，HTTP请求头信息。</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_post</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"create"</span>, <span class="string">"size"</span>:<span class="number">2</span>, <span class="string">"unit"</span>:<span class="string">"GB"</span>}</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.post(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_GET))</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.3</span> Delete请求</span><br><span class="line">如post</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.4</span> Put请求</span><br><span class="line">如post</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.5</span> Patch请求</span><br><span class="line">如post</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> Python 单元测试环境安装</span><br><span class="line">因为在python2.*中，mock是单独的模块，因而我们需要单独安装mock模块才能够正常的使用。</span><br><span class="line">因此，我们首先要在rpm find 网站下载好pip，然后通过pip安装mock。</span><br><span class="line"></span><br><span class="line">http://rpmfind.net/linux/RPM/epel/<span class="number">7</span>/x86_64/Packages/p/python2-pip<span class="number">-8.1</span><span class="number">.2</span><span class="number">-5.</span>el7.noarch.html</span><br><span class="line">依赖于python-setuptools</span><br><span class="line"></span><br><span class="line">http://rpmfind.net/linux/RPM/centos/<span class="number">7.4</span><span class="number">.1708</span>/x86_64/Packages/python-setuptools<span class="number">-0.9</span><span class="number">.8</span><span class="number">-7.</span>el7.noarch.html</span><br><span class="line"></span><br><span class="line">mock的下载网址：</span><br><span class="line"></span><br><span class="line">https://pypi.python.org/pypi/mock/<span class="number">2.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">下一章节要用的coverage，测试代码覆盖率，网址在：</span><br><span class="line"></span><br><span class="line">https://pypi.python.org/pypi/coverage/<span class="number">4.5</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="number">9.</span> 使用coverage测试覆盖率</span><br><span class="line">在单元测试的过程中，应尽量使得单元都被覆盖过，因而需要使用专门的工具来进行测试代码覆盖率。以test_rbd_api.py为准</span><br><span class="line">测试的步骤如下：</span><br><span class="line">```py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coverage run test_rbd_api.py</span><br><span class="line">&gt;&gt;&gt;coverage report -m path/to/rbd_api.py</span><br></pre></td></tr></tbody></table></figure>
<p>即可查看代码覆盖程度。</p>
<p>很多时候开发人员和其他系统联调时，如果关联系统还没有开发完成，这时只能使用mock来模拟关联系统的返回<br>自动化测试也常常遇到同样的问题，为了验证关联系统不同的返回对被测对象的影响，需要mock关联系统的返回<br>一个例子</p>
<ul>
<li>被测对象从关联接口获得用户信息</li>
<li>在关联接口开发完成之前，只能使用mock来模拟关联接口的返回，完成对被测对象的测试</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> patch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_user_info</span>(<span class="params">uid</span>):</span></span><br><span class="line">        resp = requests.get(<span class="string">"http://api.server.com/user/{0}"</span>.format(uid))</span><br><span class="line">        <span class="keyword">return</span> resp.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestUserInfo</span>(<span class="params">TestCase</span>):</span></span><br><span class="line"><span class="meta">    @patch('__main__.User')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_user_name</span>(<span class="params">self, MockUser</span>):</span></span><br><span class="line">        user = MockUser()</span><br><span class="line">        user.get_user_info.return_value = {</span><br><span class="line">            <span class="string">"user_id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"python"</span>,</span><br><span class="line">            <span class="string">"age"</span>: <span class="number">20</span></span><br><span class="line">        }</span><br><span class="line">        resp = user.get_user_info(<span class="number">1</span>)</span><br><span class="line">        self.assertEqual(resp.get(<span class="string">"name"</span>), <span class="string">"python"</span>)</span><br><span class="line">        self.assertEqual(resp.get(<span class="string">"age"</span>), <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Ran 1 test in 0.001s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OK</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> MagicMock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将要测试的排序函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    l = len(arr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, l):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, l):</span><br><span class="line">            <span class="keyword">if</span> arr[i] &gt;= arr[j]:</span><br><span class="line">                tmp = arr[i]</span><br><span class="line">                arr[i] = arr[j]</span><br><span class="line">                arr[j] = tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单元测试</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSort</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 以test开头的函数会被测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sort</span>(<span class="params">self</span>):</span></span><br><span class="line">        arr = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">        sort(arr)</span><br><span class="line">        self.assertEqual(arr, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mock</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">m1</span>(<span class="params">self</span>):</span></span><br><span class="line">        val = self.m2()</span><br><span class="line">        self.m3(val)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">m2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">m3</span>(<span class="params">self, val</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_m1</span>(<span class="params">self</span>):</span></span><br><span class="line">        a = A()</span><br><span class="line">        a.m2 = MagicMock(return_value=<span class="string">"custom_val"</span>)</span><br><span class="line">        a.m3 = MagicMock()</span><br><span class="line">        a.m1()</span><br><span class="line">        self.assertTrue(a.m2.called)</span><br><span class="line">        a.m3.assert_called_with(<span class="string">"custom_val"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">side_effect</span>(<span class="params">arg</span>):</span></span><br><span class="line">    <span class="keyword">if</span> arg &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line">    mock = MagicMock()</span><br><span class="line">    mock.side_effect = side_effect</span><br><span class="line">    print(mock(<span class="number">1</span>))</span><br><span class="line">    print(mock(<span class="number">-2</span>))</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/sql/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-11 03:45:32" itemprop="dateModified" datetime="2021-04-11T03:45:32Z">2021-04-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>mysql命令行中执行多行命令时，<br>如果前边输入的命令发生错误，<br>通过<code>\c</code>来取消当前的命令，重新进入“mysql-&gt;”提示符</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">```\q```退出mysql</span><br><span class="line">```\h```帮助信息</span><br><span class="line">```\d```改变执行符号</span><br><span class="line">```\s```显示服务器状态</span><br><span class="line"></span><br><span class="line">### 整数类型范围</span><br><span class="line">1，tinyint类型占用的字节最小，表示1字节整数。取值范围也是最小的。</span><br><span class="line">2，smalllint类，表示2个字节整数。</span><br><span class="line">3，mediumint类型占用的字节最大，表示3字节整数。</span><br><span class="line">4，int类型，表示4字节整数，和integer类型的字节数和取值范围是一样的，</span><br><span class="line">5，bigint类型占用的字节最大，表示8字节整数。气质范围是最大的。</span><br><span class="line"></span><br><span class="line">属性 字段约束</span><br><span class="line">任何整数类型后面都可以加一个```unsigned```属性，表示数据是无符号的，即非负整数。</span><br><span class="line">用此类型可以增加数据长度。</span><br><span class="line">例如如果tinyint最大是127，那tinyint unsigned最大就可以到127 * 2。</span><br><span class="line">例如：int类型的整数，有符号值：-128到127，无符号值：0到255。</span><br><span class="line">不同类型的整数类型的字节数不同，根据类型所占的字节数可以算出该类型的取值范围。</span><br><span class="line">比如intyint的空间是一个字节，一个字节是8位。那么</span><br><span class="line">tinyint无符号数的最大值就是2的8次-1，也就是255。</span><br><span class="line">tinyint有符号数的最大值就是2的7次-1，也就是127。</span><br><span class="line"></span><br><span class="line">default</span><br><span class="line"></span><br><span class="line">zerofill。该属性参数表示数字不足的显示空间由0来填补。</span><br><span class="line">使用zerofill参数时，MySQL会自动加上unsinged属性。</span><br><span class="line">那么该整数类型只能表示无符号数，其显示宽度比默认宽度小1。</span><br><span class="line">默认没有零填充</span><br><span class="line"></span><br><span class="line">整数类型还有一个auto_increment属性，该属性可是使字段成为自增字段，具有该属性的字段，在插入新的记录时，该字段的值都会在前一条记录的基础上1。所以这个时候就不用人为的设值了呢，一般用来主键的设置上该属性。</span><br><span class="line">主键约束PRIMARY KEY(字段名)，自带索引，不能为null，不能重复</span><br><span class="line">为表加上一个列用来存储唯一标志即主键列建议用数字类型，</span><br><span class="line">检索速度快，加上auoto_increment自增长</span><br><span class="line">非空约束 not null</span><br><span class="line">唯一约束 unique 可以为NULL，如果不为NULL，必须唯一</span><br><span class="line">外键约束 foreign key （子表字段名）reference 父表名(字段名) 保持关联数据的逻辑性</span><br><span class="line">MySQL中显示的字段名是：外键属性名_id。</span><br><span class="line"></span><br><span class="line">数据类型参数是整数数据类型的名称</span><br><span class="line"></span><br><span class="line">定义后面Length字段，并不是指的数值范围，而是指数据库里面可见的最大数据的长度。</span><br><span class="line">int(5)就是指定int类型的显示字符的长度是5，始终是4个字节，可以存1234</span><br><span class="line">INT(11)表示长度为11的INT类型，对大多数应用是没有意义的,它不会限制值的合法范围,只会影响显示字符的个数，只是当定义了UNSIGNED ZEROFILL属性配合使用才有意义。</span><br><span class="line"></span><br><span class="line">```int(3) zerofill```自动填充0，可以存1234，012</span><br><span class="line">```int(5) zerofill```自动填充0，可以存01234，00012</span><br><span class="line">假定类型设定为INT(5)，属性为UNSIGNED ZEROFILL，如果用户插入的数据为12的话，那么数据库实际存储数据为00012。</span><br><span class="line"></span><br><span class="line">### 实数类型</span><br><span class="line">DECIMAL可存储比 BIGINT还大的整数，存储精确的小数</span><br><span class="line">FLOAT和 DOUBLE 是有取值范围的，支持使用标准的浮点进行近似计算</span><br><span class="line">FLOAT类型数据可以存储至多8位十进制数，并在内存中占4字节。</span><br><span class="line">DOUBLE类型数据可以存储至多18位十进制数，并在内存中占8字节。</span><br><span class="line"></span><br><span class="line">### 字符串类型</span><br><span class="line">VARCHAR、CHAR、TEXT、BLOB</span><br><span class="line">VARCHAR类型用于存储可变长字符串,它比定长类型更节省空间</span><br><span class="line">VARCHAR使用1或2个额外字节记录字符串的长度,</span><br><span class="line">列长度小于255字节,使用1个字节表示,否则用2个</span><br><span class="line">内部存储varchar是存入的实际字符数+1个字节（n&lt;=255）或2个字节(n&gt;255)，</span><br><span class="line">VARCHAR长度，如果存储内容超出指定长度，会被截断</span><br><span class="line">VARCHAR值保存时不进行填充。当值保存和检索时尾部的空格仍保留</span><br><span class="line"></span><br><span class="line">CHAR是定长的，根据定义的字符串长度分配足够的空间</span><br><span class="line">CHAR会根据需要采用空格进行填充以方便比较</span><br><span class="line">CHAR适合存储很短的字符串,或者所有值都接近同一个长度</span><br><span class="line">CHAR存储的内容超出设置的长度时，内容同样会被截断。</span><br><span class="line"></span><br><span class="line">当保存CHAR值时，在它们的右边填充空格以达到指定的长度。当检索到CHAR值时，尾部的空格被删除掉。</span><br><span class="line">在存储或检索过程中不进行大小写转换。</span><br><span class="line">CHAR存储定长数据很方便，</span><br><span class="line">CHAR字段上的索引效率级高，</span><br><span class="line">对于经常变更的数据,CHAR比 VARCHAR更好,CHAR不容易产生碎片</span><br><span class="line">对于非常短的列,CHAR比 VARCHAR在存储空间上更有效率</span><br><span class="line">只分配真正需要的空间,更长的列会消耗更多的内存</span><br><span class="line"></span><br><span class="line">定义一个CHAR[10]和VARCHAR[10],如果存进去的是‘ABCD’, char(10)不论你存储的数据是否达到了10个字节，都要占去10个字节的空间,不足的自动用空格填充，除了字符‘ABCD’外，后面跟六个空格，而varchar(50)中50的含义是最多存放50个字符，VARCHAR的长度变为4了，</span><br><span class="line">取数据的时候，CHAR类型的要用trim()去掉多余的空格，而VARCHAR类型是不需要的。</span><br><span class="line">char(16)表示固定长度字符串，长度为16、</span><br><span class="line">varchar(16)表示可变长度字符串，长度为16、</span><br><span class="line"></span><br><span class="line">text表示字符串类型，内部存储text是实际字符数+2个字节。能存储大字符串，最多存储65535字节数据</span><br><span class="line">尽量避免使用BLOB/TEXT类型，查询会使用临时表,导致严重的性能开销。</span><br><span class="line"></span><br><span class="line">请说明varchar和text的区别</span><br><span class="line">varchar可指定字符数，text不能指定，</span><br><span class="line">text类型不能有默认值。</span><br><span class="line">varchar可直接创建索引，text创建索引要指定前多少个字符。</span><br><span class="line">varchar查询速度快于text，在都创建索引的情况下，text的索引几乎不起作用。</span><br><span class="line"></span><br><span class="line">### 枚举类型（ENUM），</span><br><span class="line">把不重复的数据存储为一个预定义的集合。</span><br><span class="line">有时可以使用ENUM代替常用的字符串类型。</span><br><span class="line">ENUM存储非常紧凑，会把列表值压缩到一个或两个字节。</span><br><span class="line">ENUM在内部存储时，其实存的是整数。</span><br><span class="line">尽量避免使用数字作为ENUM枚举的常量，因为容易混乱。</span><br><span class="line">排序是按照内部存储的整数</span><br><span class="line">枚举表会使表大小大大减小</span><br><span class="line"></span><br><span class="line">### 日期和时间类型</span><br><span class="line">尽量使用timestamp，空间效率高于datetime，</span><br><span class="line">用整数保存时间戳通常不方便处理。</span><br><span class="line">如果需要存储微妙，可以使用bigint存储。</span><br><span class="line"></span><br><span class="line">```SELECT CURRENT_DATE();```获取当前日期</span><br><span class="line"></span><br><span class="line">InnoDB表引擎，默认事务型引擎</span><br><span class="line">数据存储在共享表空间,可以通过配置分开，也就是多个表和索引都存储在一个表空间中，可以通过配置文件改变此配置。</span><br><span class="line">对主键查询的性能高于其他类型的存储引擎</span><br><span class="line">内部做了很多优化,从磁盘读取数据时自动在内存构建hash索引，插入数据时自动构建插入缓冲区</span><br><span class="line">通过一些机制和工具支持真正的热备份</span><br><span class="line">支持崩溃后的安全恢复</span><br><span class="line">支持事务 提供了对数据库ACID事务的支持；</span><br><span class="line">支持行级锁和表锁</span><br><span class="line">支持外键</span><br><span class="line">不支持全文索引</span><br><span class="line">插入缓冲（insert buffer)</span><br><span class="line">二次写(double write)</span><br><span class="line">自适应哈希索引(ahi)</span><br><span class="line">预读(read ahead)</span><br><span class="line">没有保存表的行数</span><br><span class="line"></span><br><span class="line">MyISAM表引擎</span><br><span class="line">表存储在两个文件,MYD和MYI</span><br><span class="line">拥有全文索引、压缩、空间函数</span><br><span class="line">不支持事务和行级锁和外键,</span><br><span class="line">不支持崩溃后的安全恢复</span><br><span class="line">存储了表的行数</span><br><span class="line">只支持表锁</span><br><span class="line">设计简单,某些场景下性能很好，例如获取整个表有多少条数据，性能很高。</span><br><span class="line">全文索引不是很常用，不如使用外部的ElasticSearch或Lucene。</span><br><span class="line"></span><br><span class="line">其他表引擎</span><br><span class="line">Archive、 Blackhole、CSV、Memory</span><br><span class="line"></span><br><span class="line">### 锁机制</span><br><span class="line">表锁是日常开发当中常见的问题,因此也是面试当中最常见的考察点,</span><br><span class="line">当多个查询同一时刻进行数据修改时,就会产生并发控制的问题</span><br><span class="line"></span><br><span class="line">#### 共享锁和排他锁,其实就是读锁和写锁</span><br><span class="line">读锁：共享的，不堵塞，多个用户可以同时读一个资源，互不干扰。</span><br><span class="line">写锁：排他的，一个写锁会阻塞其他的读锁和写锁，这样可以只允许一个用户进行写入，防止其他用户读取正在写入的资源。</span><br><span class="line"></span><br><span class="line">#### 锁粒度</span><br><span class="line">行锁，最大程度的支持并发处理，但是也带来了最大的锁开销</span><br><span class="line">表锁，系统性能开销最小，会锁定整张表，MyIsam使用表锁。</span><br><span class="line"></span><br><span class="line">### 存储过程</span><br><span class="line">为以后的使用而保存的一条或多条 MySQL语句的集合</span><br><span class="line">存储过程就是有业务逻辑和流程的集合</span><br><span class="line">可以在存储过程中创建表，更新数据，删除等等</span><br><span class="line"></span><br><span class="line">使用场景：</span><br><span class="line">通过把处理封装在容易使用的单元中，简化复杂的操作</span><br><span class="line">保证数据的一致性</span><br><span class="line">简化对变动的管理</span><br><span class="line"></span><br><span class="line">### 触发器</span><br><span class="line">是指一段代码，当触发某个事件时，自动执行这些代码。</span><br><span class="line">提供给程序员和数据分析员来保证数据完整性的一种方法，</span><br><span class="line">它是与表事件相关的特殊的存储过程</span><br><span class="line">使用场景</span><br><span class="line">可通过数据库中的相关表实现级联更改</span><br><span class="line">实时监控某张表中的某个字段的更改而需要做出相应的处理</span><br><span class="line">某些业务编号的生成等</span><br><span class="line">滥用会造成数据库及应用程序的维护困难</span><br><span class="line"></span><br><span class="line">在MySQL数据库中有如下六种</span><br><span class="line">1、Before Insert</span><br><span class="line">2、After Insert</span><br><span class="line">3、Before Update</span><br><span class="line">4、After Update</span><br><span class="line">5、Before Delete</span><br><span class="line">6、After Delete</span><br><span class="line"></span><br><span class="line">十进制的浮点数转换从二进制的浮点数会丢失数据</span><br><span class="line"></span><br><span class="line">IP 该如何保存?</span><br><span class="line">最简单的办法是使用字符串（varchar）来保存，如果从效率考虑的话，</span><br><span class="line">可以将ip 保存为整型（unsigned int），</span><br><span class="line">使用 mysql 提供的函数将 ip 转换为整型，然后存储即可。</span><br><span class="line">MySQL 函数：inet_aton()和 inet_ntoa</span><br><span class="line"></span><br><span class="line">解题方法</span><br><span class="line">对于此类考题，先说明如何定位低效SQL语句，然后根据SQL语句可能低效的原因做排查，先从索引着手，如果索引没有问题，考虑以上几个方面，数据访问的问题，长难查询句的问题还是一些特定类型优化的问题，逐一回答。</span><br><span class="line"></span><br><span class="line">请简述项目中优化SQL语句执行效率的方法，从哪些方面，SQL语句性能如何分析？</span><br><span class="line">考点分析：SQL语句查询速度慢的方法</span><br><span class="line">延伸考点：</span><br><span class="line">优化查询过程中的数据访问</span><br><span class="line">优化长难的查询语句</span><br><span class="line">优化特定类型的查询语句</span><br><span class="line"></span><br><span class="line">排查查询速度慢的原因</span><br><span class="line">1. 开启并且查询慢查询日志，慢查询通常是缺少索引，索引不合理或者业务代码实现导致</span><br><span class="line">开启慢查询功能</span><br><span class="line">slow_query_log_file 慢查询日志文件路径</span><br><span class="line">slow_query_log 用于指定是否打开慢查询日志</span><br><span class="line">long_query_time 超过多少秒的查询就写入日志</span><br><span class="line">2. 调整数据修改索引；业务代码层限制不合理访问，如：因为数据类型不匹配导致全表扫描；一次获取太多数据等</span><br><span class="line"></span><br><span class="line">查找分析查询速度慢的原因</span><br><span class="line">1. 记录慢查询日志。分析查询日志，不要直接打开慢查询日志进行分析，这样比较浪费时间和精力，可以使用pt-query-digest工具进行分析</span><br><span class="line">如何排查慢查询？ </span><br><span class="line">2. 使用show profile，通过临时表的主键ID去查一条sql语句是在什么地方发生慢的操作。</span><br><span class="line">```sql</span><br><span class="line">set profiling=1; # 开启，服务器上所有执行语句会记录执行时间，存到临时表中</span><br><span class="line">mysql&gt; show profiles; # 查看临时表</span><br><span class="line">+----------+------------+-------------------+</span><br><span class="line">| Query_ID | Duration   | Query             |</span><br><span class="line">+----------+------------+-------------------+</span><br><span class="line">|        1 | 0.00315025 | SELECT DATABASE() |</span><br><span class="line">|        2 | 0.04271325 | select * from a   |</span><br><span class="line">+----------+------------+-------------------+</span><br><span class="line">2 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></tbody></table></figure>

<p>show profile for query 临时表ID，通过临时表的主键ID去查一条sql语句是在什么地方发生慢的操作。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile for query 2;</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line">| Status               | Duration |</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line">| starting             | 0.001101 |</span><br><span class="line">| checking permissions | 0.000016 |</span><br><span class="line">| Opening tables       | 0.037732 |</span><br><span class="line">| init                 | 0.000040 |</span><br><span class="line">| System <span class="keyword">lock</span>          | <span class="number">0.000021</span> |</span><br><span class="line">| optimizing           | <span class="number">0.000006</span> |</span><br><span class="line">| <span class="keyword">statistics</span>           | <span class="number">0.002043</span> |</span><br><span class="line">| preparing            | <span class="number">0.000025</span> |</span><br><span class="line">| executing            | <span class="number">0.000003</span> |</span><br><span class="line">| Sending <span class="keyword">data</span>         | <span class="number">0.001608</span> |</span><br><span class="line">| <span class="keyword">end</span>                  | <span class="number">0.000006</span> |</span><br><span class="line">| <span class="keyword">query</span> <span class="keyword">end</span>            | <span class="number">0.000007</span> |</span><br><span class="line">| closing <span class="keyword">tables</span>       | <span class="number">0.000013</span> |</span><br><span class="line">| freeing items        | <span class="number">0.000071</span> |</span><br><span class="line">| cleaning up          | <span class="number">0.000022</span> |</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="number">15</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li><p>使用show status<br>show status会返回一些计数器，<br>show global status会查看所有服务器级别的所有计数<br>有时根据这些计数，可以推测出哪些操作代价较高或者消耗时间多</p>
</li>
<li><p>show processlist</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+<span class="comment">----+------+-----------------+------+---------+------+----------+------------------+</span></span><br><span class="line">| Id | User | Host            | db   | Command | Time | State    | Info             |</span><br><span class="line">+<span class="comment">----+------+-----------------+------+---------+------+----------+------------------+</span></span><br><span class="line">|  3 | root | localhost:14778 | test | Query   |    0 | starting | <span class="keyword">show</span> <span class="keyword">processlist</span> |</span><br><span class="line">+<span class="comment">----+------+-----------------+------+---------+------+----------+------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></tbody></table></figure>
<p>观察是否有大量线程处于不正常的状态或特征</p>
</li>
<li><p>使用explain 分析单条SQL语句、排查索引问题，注意格式化 \G 输出后不需要加分号。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from a;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+</span></span><br><span class="line">|  1 | SIMPLE      | a     | NULL       | ALL  | NULL          | NULL | NULL    |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from a\G  -- 注意:格式化输出内容，\G相当于;</span><br><span class="line">*************************** 1. row **********</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: a</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 2</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>


<p>优化查询过程中的数据访问<br>访问数据太多导致查询性能下降<br>确定应用程序是否在检索大量超过需要的数据，可能是太多行或列<br>确认MySQL服务器是否在分析大量不必要的数据行<br>避免犯如下SQL语句错误<br>查询不需要的数据。解决办法：使用limit解决<br>多表关联返回全部列。解决办法：指定列名<br>总是返回全部列。解决办法：避免使用 SELECT *<br>重复查询相同的数据。解决办法：可以缓存数据，下次直接读取缓存<br>是否在扫描额外的记录。解决办法：<br>使用explain进行分析，如果发现查询需要扫描大量的数据，但只返回少数的行，可以通过如下技巧去优化：<br>使用索引覆盖扫描，把所有的列都放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果。<br>改变数据库和表的结构，修改数据表范式<br>重写SQL语句，让优化器可以以更优的方式执行查询。</p>
<p>优化长难的查询语句<br>一个复杂查询还是多个简单查询<br>MySQL内部每秒能扫描内存中上百万行数据，相比之下，响应数据给客户端就要慢得多<br>使用尽可能小的查询是好的，但是有时将一个大的查询分解为多个小的查询是很有必要的。<br>切分查询<br>将一个大的查询分为多个小的相同的查询<br>一次性删除1000万的数据要比一次删除1万，暂停一会的方案更加损耗服务器开销。</p>
<p>分解关联查询，<br>将一条关联语句分解成多条SQL来执行<br>让缓存的效率更高。<br>执行单个查询可以减少锁的竞争。<br>在应用层做关联更容易对数据库进行拆分。<br>查询效率会有大幅提升。<br>较少冗余记录的查询。</p>
<p>优化特定类型的查询语句<br>count(列名) 返回指定列的值的数目，包含非空值的记录数<br>会忽略列值为空（这里的空不是只空字符串或者0，而是表示null）的计数，<br>&nbsp;即某个字段值为NULL时，不统计。<br>count(字段) 会统计该字段在表中出现的次数，忽略字段为null 的情况。即&nbsp;不统计字段为null 的记录。&nbsp;&nbsp;<br>count(*)会忽略所有的列，直接统计所有列数，相当于行数，不会忽略列值为NULL&nbsp;&nbsp;比count(列名)效率高</p>
<p>返回表中包含空值的记录数<br>count(1) 会统计表中的所有的记录数，包含字段为null 的记录<br>包括了忽略所有列，用1代表代码行，<br>COUNT(DISTINCT column_name) 函数返回指定列的不同值的数目、<br>不重复的记录条数</p>
<p>GROUP BY product_type<br>HAVING count(*) &gt; 1 #分组内的化为一行的数量</p>
<p>MyISAM中，没有任何where条件的count(<em>)非常快。<br>当有where条件时，MyISAM的count统计不一定比其它引擎快。<br>可以使用explain查询近似值，用近似值替代count(</em>)<br>增加汇总表<br>使用缓存</p>
<p>优化GROUP BY和DISTINCT<br>这两种查询据可以使用索引来优化，是最有效的优化方法<br>关联查询中，使用标识列分组的效率更高<br>如果不需要ORDER BY，进行GROUP BY时加ORDER BY NULL，MySQL不会再进行文件排序。<br>WITH ROLLUP超级聚合，可以挪到应用程序处理</p>
<p>优化LIMIT分页<br>LIMIT偏移量大的时候，查询效率较低<br>可以记录上次查询的最大ID，下次查询时直接根据该ID来查询</p>
<p>常规sql优化思路（众多解决方案之一）<br>1、查看slow-log，分析slow-log，分析出查询慢的语句。<br>2、按照一定优先级，进行一个一个的排查所有慢语句。<br>3、分析top sql，进行explain调试，查看语句执行时间。<br>4、调整索引或语句本身。</p>
<p>SQL语句优化的一些方法？<br>1.对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。<br>2.应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">is</span> <span class="literal">null</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=</span><br></pre></td></tr></tbody></table></figure>
<p>3.应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则引擎将放弃使用索引而进行全表扫描。<br>4.应尽量避免在 where 子句中使用or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">10</span> <span class="keyword">or</span> <span class="keyword">num</span>=<span class="number">20</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以这样查询：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> </span><br><span class="line"><span class="keyword">from</span> t </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">10</span> </span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">20</span></span><br></pre></td></tr></tbody></table></figure>

<p>5.in 和 not in 也要慎用，否则会导致全表扫描，如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) </span><br></pre></td></tr></tbody></table></figure>
<p>对于连续的数值，能用 between 就不要用 in 了：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>

<p>6.下面的查询也将导致全表扫描：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'%李%'</span></span><br></pre></td></tr></tbody></table></figure>
<p>若要提高效率，可以考虑全文检索。</p>
<ol start="7">
<li>如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=@<span class="keyword">num</span></span><br></pre></td></tr></tbody></table></figure>
可以改为强制查询使用索引：<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">with</span>(<span class="keyword">index</span>(索引名)) <span class="keyword">where</span> <span class="keyword">num</span>=@<span class="keyword">num</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>8.应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>/<span class="number">2</span>=<span class="number">100</span></span><br></pre></td></tr></tbody></table></figure>
<p>应改为:</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">100</span>*<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>

<p>9.应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">substring</span>(<span class="keyword">name</span>,<span class="number">1</span>,<span class="number">3</span>)=<span class="string">'abc'</span></span><br></pre></td></tr></tbody></table></figure>
<p>name以abc开头的id应改为:</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'abc%'</span></span><br></pre></td></tr></tbody></table></figure>

<p>10.不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p>
<p>分区表的工作原理<br>对用户而言，分区表是一个独立的逻辑表，但是底层MySQL将其分成了多个物理子表，这对用户来说是透明的，每一个分区表都会使用一个独立的表文件。</p>
<p>如图所示：MySQL将表分成多个物理字表，但PHP客户端并无感知，仍然认为操作的是一个表。</p>
<p>创建表时使用partition by子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有需要的数据的分区，这样只需要查询数据所在分区即可。</p>
<p>这样子表相对于未分区的表来说占用空间小，数据量更小，因此操作速度更快。</p>
<p>分区的主要目的是将数据按照一个较粗的粒度分在不同的表中，这样可以将相关的数据存放在一起，而且如果想一次性的删除整个分区的数据也和方便。</p>
<p>适用场景<br>1、表非常大，无法全部存在内存，或者只在表的最后有热点数据，其他都是历史数据。<br>2、分区表的数据更易维护，可以对独立的分区进行独立的操作。<br>3、分区表的数据可以分布在不同的机器上，从而高效适用资源。<br>4、可以使用分区表来避免某些特殊的瓶颈<br>5、可以备份和恢复独立的分区<br>限制<br>1、一个表最多只能有1024个分区<br>2、5.1版本中，分区表表达式必须是整数，5.5可以使用列分区<br>3、分区表字段如果有主键和唯一索引列，那么主键列和唯一索引列都必须包含进来<br>4、分区表中无法使用外键约束<br>5、需要对现有表的结构进行修改<br>6、所有分区都必须使用相同的存储引擎<br>7、分区函数中可以使用的函数和表达式会有一些限制<br>8、某些存储引擎不支持分区<br>9、对于MyISAM的分区表，不能使用load index into cache<br>10、对于MyISAM表，使用分区表时需要打开更多的文件描述符</p>
<p>分库分表的工作原理<br>通过一些HASH算法或者工具实现将一张数据表垂直或者水平进行物理切分<br>适用场景<br>1、单表记录条数达到百万或千万级别时<br>2、解决表锁的问题<br>分表方式<br>水平分割：表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询次数</p>
<p>适用场景<br>1、表中的数据本身就有独立性，例如表中分表记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用。<br>2、需要把数据存放在多个介质上。</p>
<p>水平切分的缺点<br>1、给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需UNION操作<br>2、在许多数据库应用中，这种复杂度会超过它带来的优点，查询时会增加读一个索引层的磁盘次数</p>
<p>垂直分表<br>把主键和一些列放在一个表，然后把主键和另外的列放在另一个表中<br>适用场景<br>1、如果一个表中某些列常用，另外一些列不常用<br>2、可以使数据行变小，一个数据页能存储更多数据，查询时减少I/O次数<br>垂直分表缺点<br>管理冗余列，查询所有数据需要join操作</p>
<p>分表缺点<br>有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差<br>对于应用层来说，逻辑算法增加开发成本</p>
<p>MySQL的复制原理及负载均衡<br>MySQL主从复制工作原理<br>在主库上把数据更高记录到二进制日志<br>从库将主库的日志复制到自己的中继日志<br>从库读取中继日志的事件，将其重放到从库数据中</p>
<p>MySQL主从复制解决的问题<br>数据分布：随意开始或停止复制，并在不同地理位置分布数据备份<br>负载均衡：降低单个服务器的压力<br>高可用和故障切换：帮助应用程序避免单点失败<br>升级测试：可以用更高版本的MySQL作为从库</p>
<p>解题方法<br>充分掌握分区分表的工作原理和适用场景，在面试中，此类题通常比较灵活，会给一些现有公司遇到问题的场景，大家可以根据分区分表，MySQL复制、负载均衡的适用场景来根据情况进行回答</p>
<p>问:28：设定网站用户数量在千万级，但是活跃用户数量只有1%，如何通过优化数据库提高活跃用户访问速度？<br>可以使用MySQL的分区，把活跃用户分在一个区，不活跃用户分在另外一个区，本身活跃用户区数据量比较少，因此可以提高活跃用户访问速度。<br>还可以水平分表，把活跃用户分在一张表，不活跃用户分在另一张表，可以提高活跃用户访问速度。</p>
<p>常见的web安全问题,原理和防范措施。安全意识<br>◆SQL注入<br>◆XSS(跨站脚本攻击, Cross-Site Scripting)<br>◆CSRF(跨站请求伪造, Cross- site request forgery)</p>
<p>web 安全一大原则：永远不要相信用户的任何输入<br>对输入参数做好检查(类型和范围)；过滤和转义特殊字符<br>不要直接拼接sql，使用ORM 有安全性考虑，通过传参的形式不会有 sql 注入问题，<br>查询错误信息不要返回给用户，将错误记录到日志，<br>不要明文存储敏感信息。<br>1、定期做数据备份<br>2、不给查询用户root权限，合理分配权限<br>3、关闭远程访问数据库权限<br>4、修改root口令，不用默认口令，使用较复杂的口令<br>5、删除多余的用户<br>6、改变root用户的名称<br>7、限制一般用户浏览其它库<br>8、限制用户对数据文件的访问权限 后端<br>前端的参数检查，权限控制仅仅是为了防止用户错误的输入或访问，稍微会使用浏览器的开发者工具的，都可以绕过，更别说爬虫，</p>
<p>问题29：SQL语句应该考虑哪些安全性？SQL查询的安全方案、MySQL的其它安全设置<br>解题方法<br>SQL安全的优先考虑SQL注入的防护手段。</p>
<p>sql语句是解释性语言，<br>SQL注入的关键是单引号的闭合，</p>
<ul>
<li>通过构造特殊的输入参数传入Web应用，</li>
<li>通常由于程序员未对输入过滤，直接动态拼接 SQL 产生</li>
<li>可以使用开源工具 sqlmap，SQLninja 检测</li>
</ul>
<p>SQL注入（SQLi）是一种注入攻击，可以执行恶意SQL语句。<br>它通过将任意SQL代码插入数据库查询，使攻击者能够完全控制Web应用程序后面的数据库服务器。<br>攻击者可以使用SQL注入漏洞绕过应用程序安全措施；<br>可以绕过网页或Web应用程序的身份验证和授权，并检索整个SQL数据库的内容；<br>还可以使用SQL注入来添加，修改和删除数据库中的记录。</p>
<p>1、使用预处理语句防止SQL注入，</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> = ?</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SQL注入代码演示示例</span></span><br><span class="line"><span class="string">    1）创建users表和插入相应信息</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">sql</span></span><br><span class="line"> <span class="comment">--  创建users数据表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span>(</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">45</span>) <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`email`</span> <span class="built_in">VARCHAR</span>(<span class="number">45</span>) <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`password`</span> <span class="built_in">VARCHAR</span>(<span class="number">45</span>) <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">-- 插入users表三条数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">name</span>,email,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'zhangsan'</span>,<span class="string">'zhangsan@qq.com'</span>,<span class="keyword">md5</span>(<span class="string">'zhangsan123'</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">name</span>,email,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'lisi'</span>,<span class="string">'lisi@qq.com'</span>,<span class="keyword">md5</span>(<span class="string">'lisi123'</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">name</span>,email,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'wangwu'</span>,<span class="string">'wangwu@qq.com'</span>,<span class="keyword">md5</span>(<span class="string">'wangwu123'</span>));</span><br></pre></td></tr></tbody></table></figure>

<p> 2） 存在SQL漏洞代码示例：在终端下输入名称和密码然后查询用户信息</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 注入演示代码 sql_inject_demo.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> MySQLdb   <span class="comment"># pip install mysqlclient</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 新建数据库链接</span></span><br><span class="line">db = MySQLdb.connect(</span><br><span class="line">    host=<span class="string">'localhost'</span>,</span><br><span class="line">    user=<span class="string">'root'</span>,</span><br><span class="line">    passwd=<span class="string">'123456'</span>,</span><br><span class="line">    db=<span class="string">'test'</span></span><br><span class="line">)</span><br><span class="line">cur = db.cursor()</span><br><span class="line"> </span><br><span class="line">name = input(<span class="string">'Enter name: '</span>)</span><br><span class="line">print(<span class="string">'您输入的用户name是: {}'</span>.format(name))</span><br><span class="line">password = input(<span class="string">'Enter password：'</span>)</span><br><span class="line">print(<span class="string">'您输入的密码是: {}'</span>.format(password))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接拼接 sql 参数,使用md5的 password</span></span><br><span class="line">sql = <span class="string">"SELECT * FROM users WHERE name='"</span> + name + <span class="string">"'"</span>+<span class="string">"AND password=md5('"</span> + password + <span class="string">"')"</span></span><br><span class="line">print(sql)</span><br><span class="line">cur.execute(sql)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur.fetchall():</span><br><span class="line">    print(<span class="string">'查询结果：'</span>, row)</span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></tbody></table></figure>

<p> 3）SQL注入演示结果<br>运行后再终端输入</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 输入正确的用户名和密码</span></span><br><span class="line">Enter name: lisi</span><br><span class="line">您输入的用户name是: lisi</span><br><span class="line">Enter password：lisi123</span><br><span class="line">您输入的密码是: lisi123</span><br><span class="line">SELECT * FROM users WHERE name='lisi'AND password=md5('lisi123')</span><br><span class="line">查询结果：(2, 'lisi', 'lisi@qq.com', 'c3cb6d12c40908943b64bc0681af47db')</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 输出错误密码</span></span><br><span class="line">Enter name: lisi</span><br><span class="line">您输入的用户name是: lisi</span><br><span class="line">Enter password：1234</span><br><span class="line">您输入的密码是: 1234</span><br><span class="line">SELECT * FROM users WHERE name='lisi'AND password=md5('1234')</span><br><span class="line"><span class="meta">#</span><span class="bash"> 没有返回查询结果用户信息的一行，说明密码不正确</span></span><br><span class="line">```~</span><br><span class="line"></span><br><span class="line">```~shell</span><br><span class="line"><span class="meta">#</span><span class="bash"> 因为代码有sql注入漏洞，在用户名后面加入中线，这里还输错误密码，</span></span><br><span class="line">Enter name: lisi' -- '   # -- 中线前后都有空格，中线在sql语句中表示注释意思</span><br><span class="line">您输入的用户name是: lisi' -- '</span><br><span class="line">Enter password：123456 </span><br><span class="line">您输入的密码是: 123456</span><br><span class="line">SELECT * FROM users WHERE name='lisi' -- ''AND password=md5('123456')</span><br><span class="line">查询结果：(2, 'lisi', 'lisi@qq.com', 'c3cb6d12c40908943b64bc0681af47db')</span><br><span class="line"><span class="meta">#</span><span class="bash"> 还是返回查询结果，这里就是通过SQL注入方式绕过网站的安全验证</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --后面的部分当作注释，不起作用</span></span><br></pre></td></tr></tbody></table></figure>

<p>4）怎么修复sql注入问题，其实只要把使用拼接的地方直接换成占位符就可以</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只需要修改成以下方式</span></span><br><span class="line">sql = <span class="string">"SELECT * from users WHERE name=%s and password=md5(%s)"</span></span><br><span class="line">print(sql)</span><br><span class="line">cur.execute(sql, (name, password)) <span class="comment"># execute它会自动执行转义操作</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Enter name: lisi' -- '</span><br><span class="line">您输入的用户name是: lisi' -- '</span><br><span class="line">Enter password：123456</span><br><span class="line">您输入的密码是: 123456</span><br><span class="line">SELECT * from users WHERE name=%s and password=md5(%s)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 没有返回查询结果用户信息的一行，说明密码不正确，并没有像上面的一样绕过安全验证</span></span><br></pre></td></tr></tbody></table></figure>

<p>数据库的三大范式：<br>第一范式:  每一列都不可以再拆分；<br>第二范式：在第一范式的基础上，非主键列完全依赖于主键，而不是主键的一部分。<br>第三范式：在第二范式的基础上，非主键完全依赖于主键，而不是其他的非主键。关联性，每列都与主键有直接关系,不存在传递依赖</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shi-xian-tong-bu-deng-lu-ji-tui-chu-shi-xian-bu-zou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shi-xian-tong-bu-deng-lu-ji-tui-chu-shi-xian-bu-zou/" class="post-title-link" itemprop="url">实现同步登录及退出实现步骤</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="实现同步登录及退出"><a href="#实现同步登录及退出" class="headerlink" title="实现同步登录及退出"></a>实现同步登录及退出</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，准备登录的Django模板、表单<br>新建<code>accounts\templates</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset="UTF-8"&gt;</span><br><span class="line">  &lt;title&gt;用户的基本信息&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    当前登录的用户是：{{ user.username }}-{{ user.email }}</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">  {% if user.is_authenticated %}</span><br><span class="line">  &lt;a href="/accounts/user/logout/"&gt;退出登录&lt;/a&gt;</span><br><span class="line">  {% endif %}</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset="UTF-8"&gt;</span><br><span class="line">  &lt;title&gt;用户登录&lt;/title&gt;</span><br><span class="line">  &lt;style type="text/css"&gt;</span><br><span class="line">    .errorlist {</span><br><span class="line">      color: #f00;</span><br><span class="line">    }</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h3&gt;用户登录&lt;/h3&gt;</span><br><span class="line">  &lt;form action="." method="post"&gt;</span><br><span class="line">    {% csrf_token %}</span><br><span class="line">{#    {{ form.as_p }}#}</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 用户名 --&gt;</span><br><span class="line">      {{ form.username.label }}</span><br><span class="line">      {{ form.username }}</span><br><span class="line">      {{ form.username.errors.as_text }}</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 密码 --&gt;</span><br><span class="line">      {{ form.password.label }}</span><br><span class="line">      {{ form.password }}</span><br><span class="line">      {{ form.password.errors.as_text }}</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      {{ form.non_field_errors.as_text }}</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input type="submit" value="登录"&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\forms.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>, max_length=<span class="number">200</span>, min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username, ))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data[<span class="string">'username'</span>]</span><br><span class="line">        password = data[<span class="string">'password'</span>]</span><br><span class="line">        <span class="comment"># username = data.get('username', None)</span></span><br><span class="line">        <span class="comment"># password = data.get('password', None)</span></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">and</span> password:</span><br><span class="line">            <span class="comment"># 查询用户名和密码匹配的用户</span></span><br><span class="line">            user_list = User.objects.filter(username=username)</span><br><span class="line">            err_list = []</span><br><span class="line">            <span class="keyword">if</span> user_list.count() == <span class="number">0</span>:</span><br><span class="line">                err_list.append(forms.ValidationError(<span class="string">'用户名不存在'</span>))</span><br><span class="line">                <span class="comment"># raise forms.ValidationError('用户名不存在')</span></span><br><span class="line">            <span class="comment"># 验证密码是否正确</span></span><br><span class="line">            <span class="comment"># TODO 使用加密算法进行验证</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user_list.filter(password=password).exists():</span><br><span class="line">                <span class="comment"># raise forms.ValidationError('密码不正确')</span></span><br><span class="line">                err_list.append(forms.ValidationError(<span class="string">'密码不正确'</span>))</span><br><span class="line">            <span class="keyword">if</span> err_list:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(err_list)</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\views.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\urls.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户登录表单</span></span><br><span class="line">    path(<span class="string">'user/login/'</span>, views.user_login, name=<span class="string">'user_login'</span>),</span><br><span class="line">    path(<span class="string">'user/info/'</span>, views.user_info, name=<span class="string">'user_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip\urls.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 用户账户模块</span></span><br><span class="line">    path(<span class="string">'accounts/'</span>, include(<span class="string">'accounts.urls'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>第二步，设计用户模型<br><code>accounts\models.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细信息 """</span></span><br><span class="line">    <span class="comment"># 性别</span></span><br><span class="line">    <span class="comment"># 手机号码</span></span><br><span class="line">    <span class="comment"># 年龄</span></span><br><span class="line">    <span class="comment"># 生日</span></span><br><span class="line">    <span class="comment"># 真实姓名</span></span><br><span class="line">    SEX_CHOICES = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'男'</span>),</span><br><span class="line">        (<span class="number">0</span>, <span class="string">'女'</span>),</span><br><span class="line">    )</span><br><span class="line">    username = models.CharField(<span class="string">'用户名'</span>, max_length=<span class="number">64</span>, unique=<span class="literal">True</span>, editable=<span class="literal">False</span>)</span><br><span class="line">    user = models.OneToOneField(User, related_name=<span class="string">'profile'</span>, on_delete=models.CASCADE)</span><br><span class="line">    real_name = models.CharField(<span class="string">'真实姓名'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    email = models.CharField(<span class="string">'电子邮箱'</span>, max_length=<span class="number">128</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_email_valid = models.BooleanField(<span class="string">'邮箱是否已经验证'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    phone_no = models.CharField(<span class="string">'手机号码'</span>, max_length=<span class="number">20</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_phone_valid = models.BooleanField(<span class="string">'是否已经验证'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    sex = models.SmallIntegerField(<span class="string">'性别'</span>, default=<span class="number">1</span>, choices=SEX_CHOICES)</span><br><span class="line">    age = models.SmallIntegerField(<span class="string">'年龄'</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    source = models.CharField(<span class="string">'登录的来源'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    version = models.CharField(<span class="string">'登录的版本'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated_at = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'accounts_user_profile'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginRecord</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录日志 """</span></span><br><span class="line">    <span class="comment"># 关联用户</span></span><br><span class="line">    <span class="comment"># 登录账号</span></span><br><span class="line">    <span class="comment"># 登录的时间</span></span><br><span class="line">    <span class="comment"># ip</span></span><br><span class="line">    <span class="comment"># 登录的来源</span></span><br><span class="line">    <span class="comment"># 登录的客户端版本号</span></span><br><span class="line">    user = models.ForeignKey(User, related_name=<span class="string">'login_records'</span>, on_delete=models.CASCADE)</span><br><span class="line">    username = models.CharField(<span class="string">'登录的账号'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    ip = models.CharField(<span class="string">'IP'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    address = models.CharField(<span class="string">'地址'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    source = models.CharField(<span class="string">'登录的来源'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    version = models.CharField(<span class="string">'登录的版本'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'登录时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'accounts_login_record'</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;python manage.py check</span><br><span class="line">&gt;python manage.py makemigrations</span><br><span class="line">&gt;python manage.py migrate  </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第三步，实现用户的同步登录</p>
</li>
<li><p>第四步，添加登录拦截，用户登录了可以看用户信息，没登陆看用户信息先登录</p>
</li>
<li><p>第五步，实现退出登录的功能用户登录</p>
</li>
<li><p>步骤一：认证用户<br><code>user = authenticate(username='john', password='secret')</code><br><code>accounts\forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>,</span><br><span class="line">                               max_length=<span class="number">200</span>,</span><br><span class="line">                               min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        password = data.get(<span class="string">'password'</span>, <span class="literal">None</span>)</span><br><span class="line">        user = authenticate(username=username, password=password)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'用户名或者是密码不正确'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(<span class="string">'该用户已经被禁用'</span>)</span><br><span class="line">        self.user = user</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>步骤二：判断认证后的用户是否为None<br>用户不为None则表示用户认证通过</p>
</li>
<li><p>步骤三：调用<code>login(request, user, backend=None)</code>函数登录用户<br><code>accounts\forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行用户登录 """</span></span><br><span class="line">        user = self.user</span><br><span class="line">        <span class="comment"># 调用登录</span></span><br><span class="line">        login(request, user)</span><br><span class="line">        <span class="comment"># 修改最后登录的时间</span></span><br><span class="line">        user.last_login = now()</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># TODO 保存登录历史</span></span><br><span class="line">        <span class="keyword">return</span> user</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要登录以后才能访问user_info，</span></span><br><span class="line"><span class="comment"># 否则跳转到登录地址http://127.0.0.1:8000/accounts/user/login/?next=/accounts/user/info/</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="comment"># 方式二  trip/settings.py加上LOGIN_URL = '/accounts/user/login/'</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip/settings.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOGIN_URL = <span class="string">'/accounts/user/login/'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户登录表单</span></span><br><span class="line">    path(<span class="string">'user/login/'</span>, views.user_login, name=<span class="string">'user_login'</span>),</span><br><span class="line">    path(<span class="string">'user/info/'</span>, views.user_info, name=<span class="string">'user_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户退出"><a href="#用户退出" class="headerlink" title="用户退出"></a>用户退出</h3><ul>
<li>使用<code>logout</code>函数退出当前登录的用户<br><code>accounts/views.py</code><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出登录 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户退出登录</span></span><br><span class="line">    path(<span class="string">'user/logout/'</span>, views.user_logout, name=<span class="string">'user_logout'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户登录、退出接口开发"><a href="#用户登录、退出接口开发" class="headerlink" title="用户登录、退出接口开发"></a>用户登录、退出接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 登录和退出的接口</span></span><br><span class="line">    path(<span class="string">'user/api/login/'</span>, views.user_api_login, name=<span class="string">'user_api_login'</span>),</span><br><span class="line">    path(<span class="string">'user/api/logout/'</span>, views.user_api_logout, name=<span class="string">'user_api_logout'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadRequestJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 表单请求验证没有通过，错误显示 """</span></span><br><span class="line">    status_code = <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, err_list=[], *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"400000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"参数格式不正确"</span>,</span><br><span class="line">            <span class="string">"error_list"</span>: err_list</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodNotAllowedJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 请求方式不被允许 """</span></span><br><span class="line">    status_code = <span class="number">405</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"405000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"请求方式不被允许"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 用户的基础信息 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'username'</span>: user.username,</span><br><span class="line">            <span class="string">'nickname'</span>: user.nickname,</span><br><span class="line">            <span class="string">'avatar'</span>: user.avatar.url</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfileSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 用户的详细信息 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        profile = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'real_name'</span>: profile.real_name,</span><br><span class="line">            <span class="string">'sex'</span>: profile.sex,</span><br><span class="line">            <span class="string">'sex_display'</span>: profile.get_sex_display(),</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> UnauthorizedJsonResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录接口-POST """</span></span><br><span class="line">    <span class="comment"># 获取输入的内容</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># 表单验证</span></span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="comment"># 如果通过了验证，执行登录</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            user = form.do_login(request)</span><br><span class="line">            <span class="comment"># 返回内容：用户的信息（用户的基本信息、详细详细）</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果没有通过表单验证，返回表单的错误信息</span></span><br><span class="line">            err = json.loads(form.errors.as_json())</span><br><span class="line">            <span class="keyword">return</span> BadRequestJsonResponse(err)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># GET请求不被允许</span></span><br><span class="line">        <span class="keyword">return</span> MethodNotAllowedJsonResponse()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出接口 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> http.HttpResponse(status=<span class="number">201</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户详情接口开发"><a href="#用户详情接口开发" class="headerlink" title="用户详情接口开发"></a>用户详情接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
<li>第三步，模拟HTTP请求，测试验证接口<br><code>accounts/urls.py</code><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户详细信息接口</span></span><br><span class="line">    path(<span class="string">'user/api/info/'</span>, views.UserDetailView.as_view(), name=<span class="string">'user_api_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnauthorizedJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    status_code = <span class="number">401</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"401000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"请登录"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, MethodNotAllowedJsonResponse, UnauthorizedJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetailView</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细接口 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户信息</span></span><br><span class="line">        user = request.user</span><br><span class="line">        <span class="comment"># 用户：是游客吗？数据库中是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated:</span><br><span class="line">            <span class="comment"># 返回401状态码</span></span><br><span class="line">            <span class="keyword">return</span> UnauthorizedJsonResponse()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 返回详细信息</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br></pre></td></tr></tbody></table></figure>





<p>Parser功能是配置文件进行预处理，因此，每一次更新都会执行一次Parser，因此自定义规则会永远存在，只要你不删除Parser。<br>修改<code>parsers</code></p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">parsers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/profile.yaml
    <span class="token key atrule">yaml</span><span class="token punctuation">:</span>
      <span class="token key atrule">prepend-rules</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> DOMAIN<span class="token punctuation">,</span>test.com<span class="token punctuation">,</span>DIRECT <span class="token comment" spellcheck="true"># rules最前面增加一个规则</span>
      <span class="token key atrule">append-proxies</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test <span class="token comment" spellcheck="true"># proxies最后面增加一个服务</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> http
          <span class="token key atrule">server</span><span class="token punctuation">:</span> 123.123.123.123
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">456</span>
</code></pre>
<p>url：改成本人的订阅地址，如果不知道，可以直接在Profiles下点击当前订阅的Change imformation，复制其中的URL即可。<br>prepen-rules 数组合并至原配置rules数组前 此处添加你的自定义规则，每一条占一行，按照规则类型，值，代理策略排列，使用逗号分隔。注意的是，每一行都需要以一个短横线 - 加一个空格 开头，同时注意对齐。具体的自定义规则如何书写在本文的后半部分有说明。<br>点击右下角保存，<br>在Profiles里更新订阅，这样就可以将新的规则添加上了。可以点击Edit rules查看规则进行验证。之后打开相应网页看是否生效。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/wen-jian-cao-zuo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/wen-jian-cao-zuo/" class="post-title-link" itemprop="url">文件操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="文件读写模式"><a href="#文件读写模式" class="headerlink" title="文件读写模式"></a>文件读写模式</h2><p><code>open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)</code><br>打开一个文件，生成并且返回文件对象，在对文件进行处理过程（创建、读写操作）都需要使用到这个函数，如果该文件无法被打开，会抛出 OSError。<br>默认的创建的目录在当前程序所在的目录，文件不存在，则在当前目录创建该文件<br>file：一个包含了你要访问的文件路径的字符串值。</p>
<p>buffering: 设置缓冲<br>buffering:如果buffering的值被设为0，就不会有寄存。<br>如果buffering的值取1，访问文件时会寄存行。<br>如果将buffering的值设为大于1的整数，表明了这就是的寄存区的缓冲大小。<br>如果取负值，寄存区的缓冲大小则为系统默认。</p>
<p>encoding: Windows系统在写入中文时需要设置编码格式，一般使用utf8<br>errors: 报错级别<br>newline: 区分换行符<br>closefd: 传入的file参数类型<br>opener: 设置自定义开启器，开启器的返回值必须是一个打开的文件描述符。</p>
<p>mode 模式是一个可选非强制字符串，指定打开文件的模式。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">```'w'```写入模式，打开一个文件只用于写入。打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被覆盖删除。如果该文件不存在，创建新文件。</span><br><span class="line">指针在开始</span><br><span class="line"></span><br><span class="line">```'a'```追加(Attach)模式，如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</span><br><span class="line">打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。</span><br><span class="line"></span><br><span class="line">```'b'```二进制模式（与其他模式结合使用）binary mode doesn't take an encoding argument，b模式不能再加上encoding</span><br><span class="line"></span><br><span class="line">```'ab'``` 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</span><br><span class="line"></span><br><span class="line">```'rb'```    以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。</span><br><span class="line"></span><br><span class="line">```+```读写模式（与其他模式结合使用），打开一个文件进行更新(可读可写)。</span><br><span class="line"></span><br><span class="line">```'r+```打开一个文件用于读写。文件指针将会放在文件的开头。</span><br><span class="line">```'W+'```以读写的方式打开文件。打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被覆盖删除。如果该文件不存在，创建新文件。</span><br><span class="line"></span><br><span class="line">```'a+'```如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是读写追加模式。如果该文件不存在，创建新文件用于读写</span><br><span class="line"></span><br><span class="line">```'ab+```以二进制格式打开一个文件用于追加。</span><br><span class="line">如果该文件已存在，文件指针将会放在文件的结尾。</span><br><span class="line">如果该文件不存在，创建新文件用于写入。</span><br><span class="line"></span><br><span class="line">```'rb+'```    以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。</span><br><span class="line"></span><br><span class="line">```'wb'```以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，以二进制格式创建新文件。一般用于非文本文件如图片等。比特类型bytes，字符前缀```b```</span><br><span class="line"></span><br><span class="line">```'wb+'```    以二进制格式打开一个文件用于读写。如果该文件已存在则将其覆盖。如果该文件不存在，创建新文件。</span><br><span class="line"></span><br><span class="line">不使用with语句写法</span><br><span class="line">```py</span><br><span class="line">file=open('文件路径'，访问模式) </span><br><span class="line">data = file.read()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="使用with语法，到达该语句未尾时，将自动close-关闭文件释放资源，即便出现异常亦如此"><a href="#使用with语法，到达该语句未尾时，将自动close-关闭文件释放资源，即便出现异常亦如此" class="headerlink" title="使用with语法，到达该语句未尾时，将自动close()关闭文件释放资源，即便出现异常亦如此"></a>使用with语法，到达该语句未尾时，将自动close()关闭文件释放资源，即便出现异常亦如此</h3><p>中文字体写入默认是GB2312编码。</p>
<ul>
<li><p>不指定编码格式</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open（<span class="string">"file_path"</span>) <span class="keyword">as</span> file：</span><br><span class="line">    do_something(file)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>指定编码格式：<br>指定编码写入，需要打开文件的时候按指定的编码写入，open写encoding编码方式。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 打开</span></span><br><span class="line">file = open(<span class="string">"readme.txt"</span>, <span class="string">"a"</span>, encoding=<span class="string">'utf-8'</span>)  <span class="comment"># a 以追加的方式打开</span></span><br><span class="line"><span class="comment"># 2. 写入文件</span></span><br><span class="line">file.write(<span class="string">"123 hello"</span>)</span><br><span class="line"><span class="comment"># 3. 关闭</span></span><br><span class="line">file.close()</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">当一个文件对象的引用被重新指定给另一个文件时，Python 会关闭之前的文件。</span><br><span class="line">用来关闭文件并立即释放它使用的所有系统资源。如果你没有显式地关闭文件，Python的垃圾回收器最终将销毁该对象并为你关闭打开的文件，但这个文件可能会保持打开状态一段时间。</span><br><span class="line"></span><br><span class="line">一是可能忘记关闭文件句柄；</span><br><span class="line">二是文件读取数据发生异常，没有做异常处理</span><br><span class="line"></span><br><span class="line">一个文件被打开后，你有一个file对象，你可以得到有关该文件对象相关的所有属性的</span><br><span class="line">属性    描述</span><br><span class="line">```file.closed```    返回true如果文件已被关闭，否则返回false。</span><br><span class="line">```file.mode```    返回被打开文件的访问模式。</span><br><span class="line">```file.name```    返回文件的路径。</span><br><span class="line">```py</span><br><span class="line">fo = open("代码\pi_digits.txt", "w")</span><br><span class="line">print("文件路径: ", fo.name)  # 文件路径:  代码\pi_digits.txt</span><br><span class="line">print("是否已关闭 : ", fo.closed)  # 是否已关闭 :  False</span><br><span class="line">print("访问模式 : ", fo.mode)  # 访问模式 :  w</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">如果使用read读了多次，那么后面继续使用read读取的数据是从上次读完后的位置开始的</span><br><span class="line"></span><br><span class="line">```readline([count])```：对文件的数据按行读取，（行的划分是\n）.每次只读取一行。如果有多次读取的话，下面一次读取的偏移量是上面读取后的偏移量。</span><br><span class="line"></span><br><span class="line">```readlines()```：按照行的方式把整个文件中的内容进行一次性读取，读取所有行(直到结束符 EOF)并返回一个列表，其中每一行（按着换行符进行判断一行）的数据为一个元素。</span><br><span class="line"></span><br><span class="line">```write(“string”)```函数向打开的文件对象写入指定字符串，如果文件不存在那么创建，如果存在那么就先清空文件(覆盖)，然后写入数据到文件里。Python字符串可以是二进制数据，而不是仅仅是文字。不会在字符串的结尾添加换行符('\n')</span><br><span class="line"></span><br><span class="line">```writelines(string_list)```函数向打开的文件对象写入多行内容</span><br><span class="line">以往后遇加的模式与入文件</span><br><span class="line"></span><br><span class="line">在默认模式下读取文本文件时（二进制文件不可以），文件中的换行符会转换为'\n'形式。</span><br><span class="line"></span><br><span class="line">在默认模式下写入文件时，文本中的'\n'会转换为换行符。</span><br><span class="line"></span><br><span class="line">```tell()```方法告诉你文件内的当前位置, 换句话说，下一次的读写会发生在文件开头这么多字节之后。</span><br><span class="line"></span><br><span class="line">```seek(offset [,from])```方法改变当前文件的位置。Offset变量表示要移动的字节数。From变量指定开始移动字节的参考位置。</span><br><span class="line"></span><br><span class="line">如果from被设为0，这意味着将文件的开头作为移动字节的参考位置。如果设为1，则使用当前的位置作为参考位置。如果它被设为2，那么该文件的末尾将作为参考位置。</span><br><span class="line"></span><br><span class="line">```seek(3)```从文件起始位置偏移3个字符从第4个字符位置开始读取</span><br><span class="line">```seek(0，0)```重新从文件启始位置读取</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">with open(current_path + '/' + 'test1.txt', 'w+',</span><br><span class="line">          encoding='utf-8') as file_object:</span><br><span class="line">    file_object.write('Ashe正在学习Python')</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    #  &lt;class 'str'&gt; 注意前面有一个空格表示content是空字符串</span><br><span class="line">    # 因为此时读取的是最后一个字符，写完内容之后就是空字符串</span><br><span class="line">    file_object.seek(0)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    # Ashe正在学习Python &lt;class 'str'&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line"><span class="keyword">with</span> open(current_path + <span class="string">'/'</span> + <span class="string">'test1.txt'</span>, <span class="string">'ab+'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    string = <span class="string">b'Ashe Python'</span></span><br><span class="line">    file_object.write(string)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    <span class="comment"># b'' &lt;class 'bytes'&gt; 注意前面有一个空格表示content是空字符串</span></span><br><span class="line">    <span class="comment"># 因为此时读取的是最后一个字符，写完内容之后就是空字符串</span></span><br><span class="line">    file_object.seek(<span class="number">0</span>)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    <span class="comment"># b'Ashe Python' &lt;class 'bytes'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'代码\generate_text.txt'</span></span><br><span class="line"><span class="comment"># 使用‘w’来提醒python用写入的方式打开 指定编码为</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'I love your name!'</span></span><br><span class="line">                     <span class="string">'\nI love your cloth!'</span></span><br><span class="line">                     <span class="string">'\nI love your shoes!'</span></span><br><span class="line">                     <span class="string">'\nI love your hair!'</span>)</span><br><span class="line"><span class="comment"># 使用‘a’来提醒python用附加模式的方式打开指定编码为'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'\nI an superman.我是超人'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用‘a’来提醒python用附加模式的方式打开不指定编码为'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'a'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'\nI an superman.我是超人'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.readline()</span><br><span class="line">    print(<span class="string">"第一次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第一次读取:I love your name!</span></span><br><span class="line">    print(<span class="string">"第一次读取:"</span>, content)</span><br><span class="line">    <span class="comment"># 第一次读取:I love your name!</span></span><br><span class="line"></span><br><span class="line">    content = f.readline()</span><br><span class="line">    print(<span class="string">"第二次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第二次读取:I love your cloth!</span></span><br><span class="line"></span><br><span class="line">    content = f.read(<span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"第三次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第三次读取:I love</span></span><br><span class="line"></span><br><span class="line">    position = f.tell()</span><br><span class="line">    print(<span class="string">"当前文件位置 : "</span>, position)</span><br><span class="line">    <span class="comment"># 当前文件位置 :  45</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把指针再次重新定位到文件开头</span></span><br><span class="line">    position = f.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    str = f.read(<span class="number">16</span>)</span><br><span class="line">    print(<span class="string">"读取的字符串是 : "</span>, str)</span><br><span class="line">    <span class="comment"># 读取的字符串是 :  I love your name</span></span><br><span class="line">    position = f.tell()</span><br><span class="line">    print(<span class="string">"当前文件位置 : "</span>, position)</span><br><span class="line">    <span class="comment"># 当前文件位置 :  16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    print(<span class="string">"读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 读取:I love your name!</span></span><br><span class="line">    <span class="comment"># I love your cloth!</span></span><br><span class="line">    <span class="comment"># I love your shoes!</span></span><br><span class="line">    <span class="comment"># I love your hair!</span></span><br><span class="line">    <span class="comment"># I an superman.鎴戞槸瓒呬汉</span></span><br><span class="line">    <span class="comment"># I an superman.我是超人</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意如果用read（），读取全部，后面再加read(num),就没有内容可读了。返回空字符串</span></span><br><span class="line">    content = f.read(<span class="number">6</span>)</span><br><span class="line">    print(<span class="string">":%s"</span> % content)</span><br><span class="line">    <span class="comment"># :</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.readlines()</span><br><span class="line">    print(<span class="string">"读取:%s"</span> % content)</span><br><span class="line"><span class="comment">#     读取:['I love your name!\n', 'I love your cloth!\n', 'I love your </span></span><br><span class="line"><span class="comment"># shoes!\n', 'I love your hair!\n', 'I an superman.鎴戞槸瓒呬汉\n', </span></span><br><span class="line"><span class="comment"># 'I an superman.我是超人']</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 相对文件路径 （优先使用）</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    contents = file_object.read()</span><br><span class="line">    <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">    print(contents.rstrip())</span><br><span class="line">    <span class="comment"># 3.1415926535  </span></span><br><span class="line">    <span class="comment">#   8979323846  </span></span><br><span class="line">    <span class="comment">#   2643383279  </span></span><br><span class="line">    <span class="comment"># 'abc  '     </span></span><br><span class="line">    <span class="comment"># '  abc'     </span></span><br><span class="line">    <span class="comment"># abc</span></span><br><span class="line">    <span class="comment">#   abc  </span></span><br><span class="line">    print(<span class="string">'******'</span>)</span><br><span class="line">    print(contents.lstrip())</span><br><span class="line">    <span class="comment"># 3.1415926535  </span></span><br><span class="line">    <span class="comment">#   8979323846  </span></span><br><span class="line">    <span class="comment">#   2643383279  </span></span><br><span class="line">    <span class="comment"># 'abc  '     </span></span><br><span class="line">    <span class="comment"># '  abc'     </span></span><br><span class="line">    <span class="comment"># abc</span></span><br><span class="line">    <span class="comment">#   abc </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绝对文件路径</span></span><br><span class="line">file_path = <span class="string">'C:\python代码\牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'----'</span>)</span><br><span class="line">    print(file_object.read())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'======'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file_object:</span><br><span class="line">        <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">        print(line.rstrip())  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'^^^^^^^'</span>)</span><br><span class="line">    lines = file_object.readlines()</span><br><span class="line">    print(lines)</span><br><span class="line">    <span class="comment"># ['3.1415926535\n', '  8979323846\n', '  2643383279\n', "'abc  '\n", "'  abc'\n", 'abc\n', '  abc']</span></span><br><span class="line">    <span class="comment"># 遍历列表，将读取的内容显示出来，按照原来文件的行划分。</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">        print(line.rstrip())串后面的空白</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用文件的内容 读取/拼接</span></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()  <span class="comment"># 读取文件中每行的信息</span></span><br><span class="line">pi_string = <span class="string">''</span>  <span class="comment"># 创建一个字符串</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:  <span class="comment"># 遍历读取到的文件的每行信息 存储到line中</span></span><br><span class="line">    pi_string += line.strip()  <span class="comment"># 读取到的每行信息+创建的字符串  并用strip()去除两端的空格</span></span><br><span class="line">print(pi_string)  <span class="comment"># 输出拼接之后的信息</span></span><br><span class="line"><span class="comment"># 3.141592653589793238462643383279'abc  ''  abc'abcabc</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取一个百万位的大型文件</span></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()  <span class="comment"># 读取文件中每行的信息</span></span><br><span class="line">pi_string = <span class="string">''</span>  <span class="comment"># 创建一个字符串</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:  <span class="comment"># 遍历读取到的文件的每行信息 存储到line中</span></span><br><span class="line">    <span class="comment"># 读取到的每行信息+创建的字符串  并用strip()去除两端的空格</span></span><br><span class="line">    pi_string += line.strip()</span><br><span class="line"><span class="comment"># 输出拼接之后的信息 只输出列表中的前9位 如果输出百万位 把9改为1000000</span></span><br><span class="line">print(pi_string[:<span class="number">9</span>] + <span class="string">'...'</span>)</span><br><span class="line"><span class="comment"># 输出拼接之后的信息的字符串长度</span></span><br><span class="line">print(len(pi_string))</span><br><span class="line"><span class="comment"># 3.1415926...</span></span><br><span class="line"><span class="comment"># 52</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入文件 执行完之后 文件目录中 会生成一个generate_text.txt的文件 </span></span><br><span class="line"><span class="comment"># 内容就是‘正在学习Python’ 在读取写入的文件内容和文件长度</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\generate_doc.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python'</span> + <span class="string">'\n'</span>)</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python1'</span> + <span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'a'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python'</span> + <span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'r'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        print(line.strip())</span><br><span class="line">        print(len(line))</span><br><span class="line">        <span class="comment"># Ashe正在学习Python</span></span><br><span class="line">        <span class="comment"># 15</span></span><br><span class="line">        <span class="comment"># Ashe正在学习Python1</span></span><br><span class="line">        <span class="comment"># 16</span></span><br><span class="line">        <span class="comment"># Ashe正在学习Python</span></span><br><span class="line">        <span class="comment"># 15</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提示用户输入自己的姓名 再将用户输入的姓名写入到文件中输出</span></span><br><span class="line"></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\generate_input.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:  <span class="comment"># w:表示写入(Write)到这个文件中</span></span><br><span class="line">    message = input(<span class="string">'input your name：'</span>)</span><br><span class="line">    file_object.write(message)</span><br><span class="line">    <span class="comment"># input: Ashe</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表数据number存储在number.json 文件中</span></span><br><span class="line">number = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>]</span><br><span class="line">filename = <span class="string">'number.json'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> f_obj:</span><br><span class="line">    <span class="comment"># f_obj:存入到的文件的位置</span></span><br><span class="line">    <span class="comment"># json.dump用来存储。</span></span><br><span class="line">    json.dump(number, f_obj)</span><br><span class="line">    print(<span class="string">'数据存储到'</span> + filename + <span class="string">'完成！'</span>)</span><br><span class="line">    <span class="comment"># 数据存储到number.json完成！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取前面写入到number.json文件的数据内容</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> f_obj:</span><br><span class="line">    <span class="comment"># json.load用来读取。</span></span><br><span class="line">    <span class="comment"># f_obj:读取的数据源的位置</span></span><br><span class="line">    numbers = json.load(f_obj)</span><br><span class="line">    print(numbers)</span><br><span class="line">    <span class="comment"># [2, 3, 4, 5, 7, 11, 13]</span></span><br><span class="line"><span class="comment"># for循环遍历输出读取到的文件中的每条列表中的数据 并 打印输出</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers:</span><br><span class="line">    print(number)</span><br><span class="line">    <span class="comment"># 2</span></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="comment"># 4</span></span><br><span class="line">    <span class="comment"># 5</span></span><br><span class="line">    <span class="comment"># 7</span></span><br><span class="line">    <span class="comment"># 11</span></span><br><span class="line">    <span class="comment"># 13</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data_list = [{</span><br><span class="line">    <span class="string">'href'</span>: <span class="string">'https://bubbleboy11.github.io/'</span>,</span><br><span class="line">    <span class="string">'text'</span>: <span class="string">' 首页'</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'href'</span>: <span class="string">'https://bubbleboy11.github.io/'</span>,</span><br><span class="line">    <span class="string">'text'</span>: <span class="string">' python'</span></span><br><span class="line">}]</span><br><span class="line"><span class="comment"># python按行写入文件</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data_list:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'代码\generate_data.json'</span>, <span class="string">'a+'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        line = json.dumps(item, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">        f.write(line + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按行读取文件的操作方法</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_data.json'</span>, <span class="string">'r'</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 读取所有行 每行会是一个字符串</span></span><br><span class="line">    <span class="keyword">for</span> jsonstr <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="comment"># 将josn字符串转化为dict字典</span></span><br><span class="line">        jsonstr = json.loads(jsonstr)</span><br><span class="line">        print(jsonstr)</span><br><span class="line">        <span class="comment"># {"href": "https://bubbleboy11.github.io/", "text": " 首页"}</span></span><br><span class="line">        <span class="comment"># {"href": "https://bubbleboy11.github.io/", "text": " python"}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">seconds = time.time()</span><br><span class="line">print(seconds)</span><br><span class="line">localtime = time.localtime(seconds)</span><br><span class="line">print(localtime)</span><br><span class="line">print(localtime.tm_year)</span><br><span class="line">print(localtime.tm_mon)</span><br><span class="line">print(localtime.tm_mday)</span><br><span class="line">asctime = time.asctime(localtime)</span><br><span class="line">print(asctime)</span><br><span class="line">strtime = time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>, localtime)</span><br><span class="line">print(strtime)</span><br><span class="line">mydate = time.strptime(<span class="string">'2018-1-1'</span>, <span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">print(mydate)</span><br><span class="line"></span><br><span class="line">shutil.copy(<span class="string">'/Users/Hao/hello.py'</span>, <span class="string">'/Users/Hao/Desktop/first.py'</span>)</span><br><span class="line">os.system(<span class="string">'ls -l'</span>)</span><br><span class="line">os.chdir(<span class="string">'/Users/Hao'</span>)</span><br><span class="line">os.system(<span class="string">'ls -l'</span>)</span><br><span class="line">os.mkdir(<span class="string">'test'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>在项目中需要进行很多重复的操作，如要给代码的源文件添加相同的代码，这个时候一个文件一个文件的操作就很浪费时间了，<br>通过python批处理一秒不到全部添加完成，本代码只是一个抛砖引玉的效果，只要是有特征的文本修改均可由代码完成，解放双手！</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_edit_vhd</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filepath, <span class="string">'r+'</span>) <span class="keyword">as</span> file_head:</span><br><span class="line">        content = file_head.read()</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        file_head.write(<span class="string">"`protect begin \n"</span> + content)</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        file_head.write(<span class="string">"\n`protect end "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_edit_v</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filepath, <span class="string">'r+'</span>) <span class="keyword">as</span> file_head:</span><br><span class="line">        content = file_head.read()</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        file_head.write(<span class="string">"`protect \n"</span> + content)</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        file_head.write(<span class="string">" \n`endprotect "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_text</span>(<span class="params">srcpath</span>):</span>  <span class="comment"># 寻找本文件夹及子文件夹下所以符合要求的文本进行处理</span></span><br><span class="line">    srcdirs = os.listdir(srcpath)</span><br><span class="line">    <span class="keyword">for</span> dir <span class="keyword">in</span> srcdirs:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(os.path.join(srcpath, dir)):  <span class="comment"># 判断dir属性，为文件或者文件夹</span></span><br><span class="line">            add_text(os.path.join(srcpath, dir))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'.vhd'</span> == dir[<span class="number">-4</span>:]:</span><br><span class="line">                print(<span class="string">"正在处理文件中，文件路径为："</span> + os.path.join(srcpath, dir))</span><br><span class="line">                text_edit_vhd(os.path.join(srcpath, dir))</span><br><span class="line">                print(<span class="string">"文件处理完成！"</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">'.v'</span> == dir[<span class="number">-2</span>:]:</span><br><span class="line">                print(<span class="string">"正在处理文件中，文件路径为："</span> + os.path.join(srcpath, dir))</span><br><span class="line">                text_edit_v(os.path.join(srcpath, dir))</span><br><span class="line">                print(<span class="string">"文件处理完成！"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">print(<span class="string">'当前文件路径为：'</span> + current_path)</span><br><span class="line">os.chdir(<span class="string">'..'</span>)</span><br><span class="line">root_path = os.getcwd()</span><br><span class="line">handle_path = root_path + <span class="string">'\handle'</span></span><br><span class="line">print(<span class="string">'当前文件路径为：'</span> + handle_path)</span><br><span class="line">shutil.copytree(path, handle_path)  <span class="comment"># 备份后进行数据处理</span></span><br><span class="line">add_text(handle_path)</span><br><span class="line">print(<span class="string">"run done\n"</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description   : Checks to see if a directory exists in the users home directory, if not then create it</span></span><br><span class="line"><span class="comment"># 检查主目录中是否存在某文件夹，若不存在则创建</span></span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># Import the OS module</span></span><br><span class="line"></span><br><span class="line">MESSAGE = <span class="string">'The directory already exists.'</span></span><br><span class="line">TESTDIR = <span class="string">'testdir'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># Set the variable home by expanding the user's set home directory</span></span><br><span class="line">    home = os.path.expanduser(<span class="string">"~"</span>)</span><br><span class="line">    print(home)  <span class="comment"># Print the location</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># os.path.join() for making a full path safely</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.join(home, TESTDIR)):</span><br><span class="line">        <span class="comment"># If not create the directory, inside their home directory</span></span><br><span class="line">        os.makedirs(os.path.join(home, TESTDIR))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(MESSAGE)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_package</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'%s 已经存在不可创建'</span> % path)</span><br><span class="line">    os.makedirs(path)</span><br><span class="line">    init_path = os.path.join(path, <span class="string">'__init__.py'</span>)</span><br><span class="line">    f = open(init_path, <span class="string">'w'</span>)</span><br><span class="line">    f.write(<span class="string">'# coding:utf-8\n'</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, path, mode=<span class="string">'w'</span>, is_return=True</span>):</span></span><br><span class="line">        self.path = path</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.is_return = is_return</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, message</span>):</span></span><br><span class="line">        f = open(self.path, mode=self.mode)</span><br><span class="line">        <span class="keyword">if</span> self.is_return:</span><br><span class="line">            message = <span class="string">'%s\n'</span> % message</span><br><span class="line">        f.write(message)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self, is_strip=True</span>):</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">with</span> open(self.path, mode=self.mode) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">if</span> is_strip == <span class="literal">True</span>:</span><br><span class="line">                temp = line.strip()</span><br><span class="line">                <span class="keyword">if</span> temp != <span class="string">""</span>:</span><br><span class="line">                    result.append(temp)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> line != <span class="string">''</span>:</span><br><span class="line">                    result.append(line)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    current_path = os.getcwd()</span><br><span class="line">    <span class="comment"># path = os.path.join(current_path, 'test1')</span></span><br><span class="line">    <span class="comment"># create_package(path)</span></span><br><span class="line">    <span class="comment"># open_path = os.path.join(current_path, 'b.txt')</span></span><br><span class="line">    o = Open(<span class="string">'package_datetime.py'</span>, mode=<span class="string">'r'</span>)</span><br><span class="line">    <span class="comment"># o.write('你好 小慕')</span></span><br><span class="line">    data = o.read(is_strip=<span class="literal">False</span>)</span><br><span class="line">    print(data)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-yan-zheng-ma-huo-qu-jie-kou-lian-diao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-yan-zheng-ma-huo-qu-jie-kou-lian-diao/" class="post-title-link" itemprop="url">验证码获取接口联调</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-03 11:41:23" itemprop="dateModified" datetime="2021-04-03T11:41:23Z">2021-04-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="短信验证码接口开发"><a href="#短信验证码接口开发" class="headerlink" title="短信验证码接口开发"></a>短信验证码接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
</ul>
<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerErrorJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    status_code = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"500000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"服务器正忙，请稍后重试"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>


<p>验证码只存取5分钟，之后自动删除，用redis实现验证码存储<br><code>system/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendSmsCodeForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 发送验证码的表单 """</span></span><br><span class="line">    phone_num = forms.CharField(label=<span class="string">'手机号码'</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_phone_num</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证是否为手机号 """</span></span><br><span class="line">        phone_num = self.cleaned_data[<span class="string">'phone_num'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, phone_num):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(phone_num,))</span><br><span class="line">        <span class="keyword">return</span> phone_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_sms_code</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 生成验证码并发送短信 """</span></span><br><span class="line">        sms_code = random.randint(<span class="number">100000</span>, <span class="number">999999</span>)</span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'phone_num'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># TODO 调用发送验证码的短信接口</span></span><br><span class="line">            <span class="comment"># redis中的key</span></span><br><span class="line">            key = <span class="string">'sms_code_{}'</span>.format(phone_num)</span><br><span class="line">            <span class="comment"># 将验证码存入redis</span></span><br><span class="line">            timeout = <span class="number">5</span> * <span class="number">60</span></span><br><span class="line">            cache.set(key, sms_code, timeout=timeout)</span><br><span class="line">            <span class="keyword">return</span> {</span><br><span class="line">                <span class="string">'phone_num'</span>: phone_num,</span><br><span class="line">                <span class="string">'sms_code'</span>: sms_code,</span><br><span class="line">                <span class="string">'timeout'</span>: timeout</span><br><span class="line">            }</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>system/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> FormView</span><br><span class="line"><span class="keyword">from</span> system.forms <span class="keyword">import</span> SendSmsCodeForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, ServerErrorJsonResponse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_sms</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 1. 拿到手机号，判断是否为真实的手机号码</span></span><br><span class="line">    <span class="comment"># 2. 生成验证码，并存储</span></span><br><span class="line">    <span class="comment"># TODO 3. 调用短信的发送接口</span></span><br><span class="line">    <span class="comment"># 4. 告诉用户验证码发送是否成功（会把验证码直接告诉用户）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmsCodeView</span>(<span class="params">FormView</span>):</span></span><br><span class="line">    form_class = SendSmsCodeForm</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_valid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单已经通过验证 """</span></span><br><span class="line">        data = form.send_sms_code()</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> ServerErrorJsonResponse()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_invalid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单没有通过验证 """</span></span><br><span class="line">        err_list = json.loads(form.errors.as_json())</span><br><span class="line">        <span class="keyword">return</span> BadRequestJsonResponse(err_list)</span><br></pre></td></tr></tbody></table></figure>

<p><code>system/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 发送验证码</span></span><br><span class="line">    path(<span class="string">'send/sms/'</span>, views.SmsCodeView.as_view(), name=<span class="string">"send_sms"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="用户注册接口开发"><a href="#用户注册接口开发" class="headerlink" title="用户注册接口开发"></a>用户注册接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
</ul>
<p><code>utils/constants.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户注册时，发送验证码的redis key</span></span><br><span class="line">REGISTER_MSM_CODE_KEY = <span class="string">'reg_sms_'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>system/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendSmsCodeForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 发送验证码的表单 """</span></span><br><span class="line">    phone_num = forms.CharField(label=<span class="string">'手机号码'</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_phone_num</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证是否为手机号 """</span></span><br><span class="line">        phone_num = self.cleaned_data[<span class="string">'phone_num'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, phone_num):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(phone_num,))</span><br><span class="line">        <span class="keyword">return</span> phone_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_sms_code</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 生成验证码并发送短信 """</span></span><br><span class="line">        sms_code = random.randint(<span class="number">100000</span>, <span class="number">999999</span>)</span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'phone_num'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># TODO 调用发送验证码的短信接口</span></span><br><span class="line">            <span class="comment"># redis中的key</span></span><br><span class="line">            key = <span class="string">'{}{}'</span>.format(constants.REGISTER_MSM_CODE_KEY, phone_num)</span><br><span class="line">            <span class="comment"># 将验证码存入redis</span></span><br><span class="line">            timeout = <span class="number">5</span> * <span class="number">60</span></span><br><span class="line">            cache.set(key, sms_code, timeout=timeout)</span><br><span class="line">            <span class="keyword">return</span> {</span><br><span class="line">                <span class="string">'phone_num'</span>: phone_num,</span><br><span class="line">                <span class="string">'sms_code'</span>: sms_code,</span><br><span class="line">                <span class="string">'timeout'</span>: timeout</span><br><span class="line">            }</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User, Profile</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>,</span><br><span class="line">                               max_length=<span class="number">200</span>,</span><br><span class="line">                               min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        password = data.get(<span class="string">'password'</span>, <span class="literal">None</span>)</span><br><span class="line">        user = authenticate(username=username, password=password)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'用户名或者是密码不正确'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(<span class="string">'该用户已经被禁用'</span>)</span><br><span class="line">        self.user = user</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行用户登录 """</span></span><br><span class="line">        user = self.user</span><br><span class="line">        <span class="comment"># 调用登录</span></span><br><span class="line">        login(request, user)</span><br><span class="line">        <span class="comment"># 修改最后登录的时间</span></span><br><span class="line">        user.last_login = now()</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># TODO 保存登录历史</span></span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'手机号码'</span>, max_length=<span class="number">16</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>, max_length=<span class="number">128</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入密码'</span></span><br><span class="line">    })</span><br><span class="line">    nickname = forms.CharField(label=<span class="string">'昵称'</span>, max_length=<span class="number">16</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入昵称'</span></span><br><span class="line">    })</span><br><span class="line">    sms_code = forms.CharField(label=<span class="string">'验证码'</span>, max_length=<span class="number">6</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入验证码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">if</span> User.objects.filter(username=username).exists():</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号已经被使用'</span>)</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_nickname</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 昵称验证 """</span></span><br><span class="line">        nickname = self.cleaned_data[<span class="string">'nickname'</span>]</span><br><span class="line">        <span class="keyword">if</span> User.objects.filter(nickname=nickname).exists():</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'昵称已经被使用'</span>)</span><br><span class="line">        <span class="keyword">return</span> nickname</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        sms_code = self.cleaned_data.get(<span class="string">'sms_code'</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># redis 中的验证码key</span></span><br><span class="line">        key = <span class="string">'{}{}'</span>.format(constants.REGISTER_MSM_CODE_KEY, phone_num)</span><br><span class="line">        code = cache.get(key)</span><br><span class="line">        <span class="comment"># code 已失效</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> code:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'验证码已经失效'</span>)</span><br><span class="line">        <span class="keyword">if</span> str(code) != sms_code:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'验证码输入不正确'</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">    @transaction.atomic</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_register</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行注册 """</span></span><br><span class="line">        data = self.cleaned_data</span><br><span class="line">        version = request.headers.get(<span class="string">'version'</span>, <span class="string">''</span>)</span><br><span class="line">        source = request.headers.get(<span class="string">'source'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 1. 创建基础信息表</span></span><br><span class="line">            user = User.objects.create_user(</span><br><span class="line">                username=data.get(<span class="string">'username'</span>, <span class="literal">None</span>),</span><br><span class="line">                password=data.get(<span class="string">'password'</span>, <span class="literal">None</span>),</span><br><span class="line">                nickname=data.get(<span class="string">'nickname'</span>, <span class="literal">None</span>)</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># 2. 创建详细表</span></span><br><span class="line">            profile = Profile.objects.create(</span><br><span class="line">                user=user,</span><br><span class="line">                username=user.username,</span><br><span class="line">                version=version,</span><br><span class="line">                source=source</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># 3. 执行登录</span></span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="comment"># 4. 记录登录日志</span></span><br><span class="line">            user.last_login = now()</span><br><span class="line">            user.save()</span><br><span class="line">            ip = request.META.get(<span class="string">'REMOTE_ADDR'</span>, <span class="string">''</span>)</span><br><span class="line">            user.add_login_record(username=user.username, ip=ip, source=source, version=version)</span><br><span class="line">            <span class="keyword">return</span> user, profile</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> FormView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm, RegisterForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, MethodNotAllowedJsonResponse, UnauthorizedJsonResponse, \</span><br><span class="line">    ServerErrorJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要登录以后才能访问user_info，</span></span><br><span class="line"><span class="comment"># 否则跳转到登录地址http://127.0.0.1:8000/accounts/user/login/?next=/accounts/user/info/</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出登录 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录接口-POST """</span></span><br><span class="line">    <span class="comment"># 获取输入的内容</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># 表单验证</span></span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="comment"># 如果通过了验证，执行登录</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            user = form.do_login(request)</span><br><span class="line">            <span class="comment"># 返回内容：用户的信息（用户的基本信息、详细详细）</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果没有通过表单验证，返回表单的错误信息</span></span><br><span class="line">            err = json.loads(form.errors.as_json())</span><br><span class="line">            <span class="keyword">return</span> BadRequestJsonResponse(err)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># GET请求不被允许</span></span><br><span class="line">        <span class="keyword">return</span> MethodNotAllowedJsonResponse()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出接口 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> http.HttpResponse(status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetailView</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细接口 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户信息</span></span><br><span class="line">        user = request.user</span><br><span class="line">        <span class="comment"># 用户：是游客吗？数据库中是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated:</span><br><span class="line">            <span class="comment"># 返回401状态码</span></span><br><span class="line">            <span class="keyword">return</span> UnauthorizedJsonResponse()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 返回详细信息</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_register</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册 """</span></span><br><span class="line">    <span class="comment"># 1. 表单，验证用户输入的信息（用户名、昵称、验证码）</span></span><br><span class="line">    <span class="comment"># 2. 创建用户基础信息表、用户详细信息表</span></span><br><span class="line">    <span class="comment"># 3. 执行登录</span></span><br><span class="line">    <span class="comment"># 4. 保存登录日志</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRegisterView</span>(<span class="params">FormView</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册接口 """</span></span><br><span class="line">    form_class = RegisterForm</span><br><span class="line">    http_method_names = [<span class="string">'post'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_valid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单已经通过验证 """</span></span><br><span class="line">        result = form.do_register(request=self.request)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            user, profile = result</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> ServerErrorJsonResponse()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_invalid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单没有通过验证 """</span></span><br><span class="line">        err_list = json.loads(form.errors.as_json())</span><br><span class="line">        <span class="keyword">return</span> BadRequestJsonResponse(err_list)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">   <span class="comment"># 用户注册</span></span><br><span class="line">    path(<span class="string">'user/api/register/'</span>, views.UserRegisterView.as_view(), name=<span class="string">'user_api_register'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="验证码获取接口联调"><a href="#验证码获取接口联调" class="headerlink" title="验证码获取接口联调"></a>验证码获取接口联调</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，阅读接口文档</li>
<li>第二步，配置接口地址<br><code>src\utils\apis.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统模块的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> SystemApis = {</span><br><span class="line">  <span class="comment">// 发送短信验证码</span></span><br><span class="line">  sendSmsCodeUrl: apiHost + <span class="string">'/system/send/sms/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>src\components\common\SendSmsCode.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 短信验证码发送相关的逻辑 --&gt;</span><br><span class="line">  &lt;van-button</span><br><span class="line">    size="small"</span><br><span class="line">    type="primary"</span><br><span class="line">    @click.prevent="sendSmsCode()"</span><br><span class="line">    :disabled="isSmsSend"</span><br><span class="line">    &gt;{{ sendBtnText }}&lt;/van-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SystemApis } from '@/utils/apis'</span><br><span class="line">export default {</span><br><span class="line">  props: ['phoneNum'],</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 是否已经发送了验证码，不能再点击发送验证码</span><br><span class="line">      isSmsSend: false,</span><br><span class="line">      sendBtnText: '点击发送验证码',</span><br><span class="line">      timer: null,</span><br><span class="line">      counter: 60</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    reset () {</span><br><span class="line">      this.isSmsSend = false</span><br><span class="line">      this.sendBtnText = '点击发送验证码'</span><br><span class="line">      if (this.timer) {</span><br><span class="line">        clearInterval(this.timer)</span><br><span class="line">        this.counter = 60</span><br><span class="line">        this.timer = null</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 倒计时</span><br><span class="line">     */</span><br><span class="line">    countDown () {</span><br><span class="line">      this.timer = setInterval(() =&gt; {</span><br><span class="line">        this.sendBtnText = `(${this.counter}秒)后重新发送`</span><br><span class="line">        this.counter--</span><br><span class="line">        if (this.counter &lt; 0) {</span><br><span class="line">          this.reset()</span><br><span class="line">        }</span><br><span class="line">      }, 1000)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 发送验证码</span><br><span class="line">     */</span><br><span class="line">    sendSmsCode () {</span><br><span class="line">      // 判断手机号是否已经输入</span><br><span class="line">      if (!this.phoneNum) {</span><br><span class="line">        this.$notify('请输入手机号')</span><br><span class="line">        return false // 不在执行后面的逻辑</span><br><span class="line">      }</span><br><span class="line">      // TODO 调用接口，发送短信验证码</span><br><span class="line">      ajax.post(SystemApis.sendSmsCodeUrl, {</span><br><span class="line">        phone_num: this.phoneNum</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        // 提示用户验证码已经发送</span><br><span class="line">        this.$notify({</span><br><span class="line">          message: `验证码为：${data.sms_code}，${data.timeout / 60}分钟内有效`,</span><br><span class="line">          duration: 1000 * 10, // 提示持续时间 </span><br><span class="line">          type: 'success'</span><br><span class="line">        })</span><br><span class="line">        this.isSmsSend = true</span><br><span class="line">        // 开启倒计时, 60s之后才能再次点击</span><br><span class="line">        this.countDown()</span><br><span class="line">      }).catch(err =&gt; {</span><br><span class="line">        // 如果产生了异常，提示用户重新操作</span><br><span class="line">        this.isSmsSend = false</span><br><span class="line">        this.sendBtnText = '点击发送验证码'</span><br><span class="line">        console.log(err)</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>第三步，使用axios获取数据</li>
<li>第四步，将数据设置到模型层</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lian-biao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lian-biao/" class="post-title-link" itemprop="url">链表</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>python用类来实现链表的数据结构</p>
<p>数组 就是连续的 同一个类型的 元素，而且必须是固定的长度。<br>把数组看做一个内存空间，数组下标就是这个空间的地址，支持根据下标快速访问。<br>但连续存储的缺点也很明显，增加容量，增删元素的成本很高，时间复杂度均为 O(n)。<br>增加数组容量需要先申请一块新的内存，然后复制原有的元素。<br>如果需要的话，可能还要删除原先的内存。</p>
<p>线性表的实际存储方式，分为两种实现模型：<br>1顺序表的构建需要预先知道数据大小来申请连续的存储空间，<br>将元素顺序地存放在一块连续的存储区里<br>而在进行扩充时又需要进行数据的搬迁，<br>元素间的顺序关系由它们的存储顺序自然表示。<br>访问指定元素时无需从头遍历，通过计算便可获得对应地址，其时间复杂度为O(1)。<br>一个顺序表的完整信息包括两部分，<br>一部分是表中的元素集合，<br>另一部分是为实现正确操作而需记录的信息，即有关表的整体情况的信息，<br>这部分信息主要包括元素存储区的容量和当前表中已有的元素个数两项。</p>
<p>2.链表Linked list：知道了它的头就知道了它的全部，所以最后直接返回头节<br>算法题的自变量head都是链表头节点，不是链表<br>将元素存放在通过链接构造起来的一系列存储块中。<br>如果我们想要非固定的长度来存储数据。这个时候就出现了表链。<br>链表是一种物理存储单元上非连续、非顺序的存储结构，<br>链表失去了顺序表随机读取的优点，同时链表由于增加了结点的指针域，<br>空间开销比较大，但对存储空间的使用要相对灵活。<br>充分利用计算机内存空间，实现灵活的内存动态管理。<br>数据元素的逻辑顺序是通过链表中的指针链接次序实现的。</p>
<p>单向链表链表由一系列结点（链表中每一个元素称为结点）组成，<br>结点可以在运行时动态生成。</p>
<p>顺序表查找很快，主要耗时的操作是拷贝覆盖。<br>因为除了目标元素在尾部的特殊情况，<br>顺序表进行插入和删除时需要对操作点之后的所有元素进行前后移位操作，<br>只能通过拷贝和覆盖的方法进行。</p>
<p>相比于线性表顺序结构，操作复杂。由于不必须按顺序存储，<br>链表在插入的时候可以达到O(1)的复杂度，<br>但是查找一个节点或者访问特定编号的节点，不能像数组一样随机根据下标访问，<br>你想查找一个元素只能老老实实从头遍历，则需要O(n)的时间，</p>
<p>无法高效获取长度，无法根据偏移快速访问元素，是链表的两个劣势。<br>然而面试的时候经常碰见诸如获取倒数第k个元素，获取中间位置的元素，<br>判断链表是否存在环，判断环的长度等和长度与位置有关的问题。<br>这些问题都可以通过灵活运用双指针来解决。</p>
<p>Tips：双指针并不是固定的公式，而是一种思维方式</p>
<p>链表中的基本要素：<br>1.节点类（Node）或元素)，单链表每个结点有两个域，<br>左边部份叫值域（数据域），value 属性保存值 存储数据元素的域)。<br>头结点的内存地址没有存储在其他结点的指针域<br>右边叫指针域(next)，有一个指针保存指向下一个节点地址位置信，next存储直接后继存储位置的域称为。<br>用 node.next 访问下一个节点。最后一个结点的next指向为None(空值)</p>
<p>对于单链表结构可以使用 calss 的两个属性表示 val , next。</p>
<p>实现一个Node类：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.val = x  <span class="comment"># val: 节点保存的数据元素</span></span><br><span class="line">        self.next = <span class="literal">None</span>  <span class="comment"># next: 保存下一个节点对象的地址</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>此节点类只有一个构建函数，接收一个数据参数，<br>其中next表示指针域的指针，</p>
<p>实例化后得到一个节点对象</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node = Node(<span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>此节点对象数据为4，指针指向None。<br>[]C:\python代码\牛客网剑指offer66题思路分析\图解说明\节点.jpg</p>
<p>2.head结点，head结点永远指向第一个结点<br>3.tail结点，tail结点永远指向最后一个节点<br>4.None，链表中最后一个结点tail指针域的指针next指向None值，</p>
<p><img src="/2020/08/21/lian-biao/%E5%9B%BE%E8%A7%A3%E8%AF%B4%E6%98%8E%5C%E9%93%BE%E8%A1%A8.png" alt="linked_list">  </p>
<p><img src="/2020/08/21/lian-biao/python代码\牛客网剑指offer66题思路分析\图解说明\append1.jpg" alt="avatar"><br><img src="/2020/08/21/lian-biao/python代码\牛客网剑指offer66题思路分析\图解说明\链表.png" alt="avatar"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span>  <span class="comment"># 传入一个参数</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Node(<span class="number">1</span>)</span><br><span class="line">b = Node(<span class="number">2</span>)</span><br><span class="line">c = Node(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">a.next = b</span><br><span class="line">b.next = c</span><br><span class="line"></span><br><span class="line">head = a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(a.next.val)  <span class="comment"># 2</span></span><br><span class="line">print(a.next.next.val)  <span class="comment"># 3</span></span><br><span class="line">print(a.next.next.next.val)</span><br><span class="line"><span class="comment"># AttributeError: 'NoneType' object has no attribute 'val'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 链表的创建</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_linklist_head</span>(<span class="params">li</span>):</span></span><br><span class="line">    <span class="comment"># 头插</span></span><br><span class="line">    head = Node(li[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> li[<span class="number">1</span>:]:</span><br><span class="line">        node = Node(item)  <span class="comment"># 生成节点</span></span><br><span class="line">        node.next = head  <span class="comment"># next指向原来的头部</span></span><br><span class="line">        head = node  <span class="comment"># head 指向在头部插入的节点</span></span><br><span class="line">    <span class="keyword">return</span> head  <span class="comment"># 返回头部</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_linklist_tail</span>(<span class="params">li</span>):</span></span><br><span class="line">    <span class="comment"># 尾插</span></span><br><span class="line">    head = Node(li[<span class="number">0</span>])</span><br><span class="line">    tail = head</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> li[<span class="number">1</span>:]:</span><br><span class="line">        node = Node(item)  <span class="comment"># Node类实例化得到一个node对象。</span></span><br><span class="line">        tail.next = node  <span class="comment"># 把原来尾巴的下一个指针指向当前node</span></span><br><span class="line">        tail = node  <span class="comment"># 尾巴 指向新部插入的节点</span></span><br><span class="line">    <span class="keyword">return</span> head  <span class="comment"># 返回头部</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_linklist</span>(<span class="params">linklist</span>):</span></span><br><span class="line">    <span class="keyword">while</span> linklist:</span><br><span class="line">        print(linklist.val, end=<span class="string">', '</span>)</span><br><span class="line">        linklist = linklist.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lk = create_linklist_head([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print_linklist(lk)  <span class="comment"># 3, 2, 1,</span></span><br><span class="line">print(<span class="string">'---'</span>)</span><br><span class="line">lk_tail = create_linklist_tail([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print_linklist(lk_tail)  <span class="comment"># 1, 2, 3,</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedListNode</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, next=None, value=None</span>):</span></span><br><span class="line">        self.next = next</span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个链表</span></span><br><span class="line">lk_head = LinkedListNode()</span><br><span class="line">myList = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(myList)):</span><br><span class="line">    lk_head = LinkedListNode(lk_head, myList[i])</span><br><span class="line">print(lk_head)  <span class="comment"># &lt;__main__.LinkedListNode object at 0x00000271CCFBFDF0&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_linklist</span>(<span class="params">lk</span>):</span>  <span class="comment"># lk任意命名</span></span><br><span class="line">    <span class="keyword">while</span> lk:</span><br><span class="line">        print(lk.value, end=<span class="string">', '</span>)</span><br><span class="line">        lk = lk.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 头插：链表新插入的节点在表头，</span></span><br><span class="line"><span class="comment"># 因此，实际上链表中的顺序，与插入列表的顺序是反过来 逆序</span></span><br><span class="line">print_linklist(lk_head)  <span class="comment"># 5, 4, 3, 2, 1, None,</span></span><br></pre></td></tr></tbody></table></figure>

<p>链表的常用方法：<br>LinkedList() 创建空链表，不需要参数，返回值是空链表</p>
<p>is_empty() 测试链表是否为空，不需要参数，只需要检查head节点是否指向None</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self.head <span class="keyword">is</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>
<p>返回值是布尔值，如果是空列表返回True，否则返回False</p>
<p>append(data) 尾插：在尾部增加一个元素作为链表最后一个<br>参数是要追加的元素，无返回值</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        node = Node(data)</span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># head指向None，链表是一个空链表</span></span><br><span class="line">            self.head = node  <span class="comment"># 把链表的head和tail都指向了node，</span></span><br><span class="line">            self.tail = node</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 当链表不是空链表时</span></span><br><span class="line">            self.tail.next = node  <span class="comment"># 将尾节点的next指向新节点</span></span><br><span class="line">            self.tail = node  <span class="comment"># 将尾节点指向新节点</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link_list(append(<span class="number">4</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>增加第二个节点的操作需要分两步完成，<br>第一步：self.tail.next = node，即把上一个节点的next指针指向当前node；<br>第二步：self.tail = node，把tail移动到node，</p>
<p>当if self.head is None:为False时,<br>说明链表已经增加了一个节点了，<br>再增加一个节点时head已经指向了第一个节点，<br>所以不为None，<br>比如增加的第二个节点为：</p>
<p>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append1.jpg<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append2.jpg<br>当增加第三个、第四个等节点时，按照上边的操作依次类推。</p>
<p>iter() 遍历链表，无参数，无返回值，此方法一般是一个生成器<br>在遍历链表时也要首先考虑空链表的情况。<br>遍历链表时从head开始，直到一个节点的next指向None结束</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.head:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        <span class="keyword">yield</span> cur.data</span><br><span class="line">        <span class="keyword">while</span> cur.next:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">yield</span> cur.data</span><br></pre></td></tr></tbody></table></figure>
<p>当是遍历一个空链表时，if not self.head:为True，直接返回None；<br>如果不是空链表就让一个局部变量cur指向head,<br>并把head的data属性yield出来，<br>再对cur的next指针指向的对象做while循环，<br>直到next指向None，这样就遍历了链表。</p>
<p>insert(idx,value) 插入一个元素，参数为插入元素的索引和值<br>假如采取append方法又增加了两个节点，增加完成后如下图：<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append3.jpg</p>
<p>如果想在数据域为6的那节点处插入一个节点，需要做的操作有两步：<br>1.把新节点的next指针指向数据域为6的这个节点，即为数据域为5节点的next指向指向的对象<br>2.把数据域为5节点的next指针指向新加的节点<br>注： 这两个步骤不能颠倒，如果颠倒，数据域为6的节点会被丢失，数据域为7的节点不再是链表的节点。<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\insert.jpg</p>
<p>还要额外考虑两种情况：<br>1.空链表时<br>2.插入位置超出链表节点的长度时<br>3.插入位置是链表的最后一个节点时，需要移动tail<br>当是在链表最后一个节点插入时，示意图如下：<br>[]C:\python代码\牛客网剑指offer66题思路分析\图解说明\insert2.jpg<br>要在指定的索引位置插入一个节点，前提是需要找到这个位置，<br>在链表中只有采用遍历的方式，具有O(n)的速度，<br>最糟糕时会遍历链表的所有节点，<br>而当找到插入点时，我们并不需要当前节点的信息，<br>而是需要前一个节点的信息，<br>所以代码中巧妙的使用了while cur_idx &lt; idx-1:的方式，<br>这样能使用cur这个变量能指向插入点上一个节点对象。<br>实现insert方法的代码如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, idx, value</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="comment"># 在某元素后插入</span></span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx<span class="number">-1</span>:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        node = Node(value)</span><br><span class="line">        node.next = cur.next  <span class="comment"># 新插入的节点指向第一个的原来next的指向</span></span><br><span class="line">        cur.next = node</span><br><span class="line">        <span class="keyword">if</span> node.next <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.tail = node</span><br></pre></td></tr></tbody></table></figure>

<p>remove(idx)移除1个元素，参数为要移除的元素或索引，并修改链表<br>接收一个idx参数，表示要删除节点的索引，此方法要考虑以下几种情况：<br>1.空链表，直接抛出异常<br>2.删除第一个节点时，移动head到删除节点的next指针指向的对象<br>3.链表只有一个节点时，把head与tail都指向None即可<br>4.删除最后一个节点时，需要移动tail到上一个节点<br>5.遍历链表时要判断给定的索引是否大于链表的长度，如果大于则抛出异常信息<br>O(n)</p>
<p>请看下边图例：<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\remove1.jpg<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\remove2.jpg<br>以下为remove函数的代码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">       cur = self.head</span><br><span class="line">       cur_idx = <span class="number">0</span></span><br><span class="line">       <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 空链表时</span></span><br><span class="line">           <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">       <span class="keyword">while</span> cur_idx &lt; idx<span class="number">-1</span>:</span><br><span class="line">           cur = cur.next</span><br><span class="line">           <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">               <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">           cur_idx += <span class="number">1</span></span><br><span class="line">       <span class="keyword">if</span> idx == <span class="number">0</span>:   <span class="comment"># 当删除第一个节点时</span></span><br><span class="line">           self.head = cur.next</span><br><span class="line">           cur = cur.next</span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       <span class="keyword">if</span> self.head <span class="keyword">is</span> self.tail:   <span class="comment"># 当只有一个节点的链表时</span></span><br><span class="line">           self.head = <span class="literal">None</span></span><br><span class="line">           self.tail = <span class="literal">None</span></span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       cur.next = cur.next.next</span><br><span class="line">       <span class="keyword">if</span> cur.next <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 当删除的节点是链表最后一个节点时</span></span><br><span class="line">           self.tail = cur</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 在某元素后删除节点node = cur.next </span></span><br><span class="line">       <span class="comment"># cur.next = cur.next.next  # 被删的节点指向第一个的原来next的指向</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>size() 返回链表的元素数，不接收参数，返回值是链表中节点的个数，<br>要获得链表的节点个数，必定会遍历链表，<br>直到最后一个节点的next指针指向None时链表遍历完成，<br>遍历时可以用一个累加器来计算节点的个数，如下代码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">size</span>(<span class="params">self</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> current <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'The list is an empty list'</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            current = current.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br></pre></td></tr></tbody></table></figure>

<p>search(item) 查找链表某元素，<br>search函数接收一个item参数，表示查找节点中数据域的值,要查找的元素或索引。<br>search函数遍历链表，每到一个节点把当前节点的data值与item作比较，<br>最糟糕的情况下会全遍历链表。O(n)<br>如果查找到有些数据则返回True，否则返回False，代码如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.data == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current = current.next</span><br><span class="line">        <span class="keyword">return</span> found</span><br></pre></td></tr></tbody></table></figure>

<p>Node类与LinkedList类完整代码整理如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.head = <span class="literal">None</span></span><br><span class="line">        self.tail = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.head <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        node = Node(data)  <span class="comment"># 实列化节点</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.head = node</span><br><span class="line">            self.tail = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.tail.next = node</span><br><span class="line">            self.tail = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">iter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.head:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        <span class="keyword">yield</span> cur.data</span><br><span class="line">        <span class="keyword">while</span> cur.next:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">yield</span> cur.data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, idx, value</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 判断是否是空链表</span></span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx - <span class="number">1</span>:  <span class="comment"># 遍历链表</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 判断是不是最后一个元素</span></span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        node = Node(value)</span><br><span class="line">        node.next = cur.next</span><br><span class="line">        cur.next = node</span><br><span class="line">        <span class="keyword">if</span> node.next <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.tail = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 空链表时</span></span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx - <span class="number">1</span>:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> idx == <span class="number">0</span>:  <span class="comment"># 当删除第一个节点时</span></span><br><span class="line">            self.head = cur.next</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> self.tail:  <span class="comment"># 当只有一个节点的链表时</span></span><br><span class="line">            self.head = <span class="literal">None</span></span><br><span class="line">            self.tail = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur.next = cur.next.next</span><br><span class="line">        <span class="keyword">if</span> cur.next <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 当删除的节点是链表最后一个节点时</span></span><br><span class="line">            self.tail = cur</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span>(<span class="params">self</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> current <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'The list is an empty list'</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            current = current.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.data == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current = current.next</span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    link_list = LinkedList()  <span class="comment"># 实列化链表</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        link_list.append(i)</span><br><span class="line">    print(link_list)</span><br><span class="line">    <span class="comment">#    print(link_list.is_empty())</span></span><br><span class="line">    <span class="comment">#    link_list.insert(10, 30)</span></span><br><span class="line">    <span class="comment">#    link_list.remove(0)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> link_list.iter():</span><br><span class="line">        print(<span class="string">'node is {0}'</span>.format(node))</span><br><span class="line">    print(link_list.size())</span><br><span class="line"><span class="comment">#    print(link_list.search(20))</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>单向循环链表<br>单链表的一个变形是单向循环链表，链表中最后一个节点的next域不再为None，而是指向链表的头节点。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""节点"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        self.item = item</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SinCycLinkedlist</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""单向循环链表"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""判断链表是否为空"""</span></span><br><span class="line">        <span class="keyword">return</span> self._head == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">length</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""返回链表的长度"""</span></span><br><span class="line">        <span class="comment"># 如果链表为空，返回长度0</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">travel</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""遍历链表"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        print(cur.item)</span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            print(cur.item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""头部添加节点"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            self._head = node</span><br><span class="line">            node.next = self._head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#添加的节点指向_head</span></span><br><span class="line">            node.next = self._head</span><br><span class="line">            <span class="comment"># 移到链表尾部，将尾部节点的next指向node</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment">#_head指向添加node的</span></span><br><span class="line">            self._head = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""尾部添加节点"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            self._head = node</span><br><span class="line">            node.next = self._head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 移到链表尾部</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将尾节点指向node</span></span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment"># 将node指向头节点_head</span></span><br><span class="line">            node.next = self._head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, pos, item</span>):</span></span><br><span class="line">        <span class="string">"""在指定位置添加节点"""</span></span><br><span class="line">        <span class="keyword">if</span> pos &lt;= <span class="number">0</span>:</span><br><span class="line">            self.add(item)</span><br><span class="line">        <span class="keyword">elif</span> pos &gt; (self.length()<span class="number">-1</span>):</span><br><span class="line">            self.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = Node(item)</span><br><span class="line">            cur = self._head</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 移动到指定位置的前一个位置</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; (pos<span class="number">-1</span>):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                cur = cur.next</span><br><span class="line">            node.next = cur.next</span><br><span class="line">            cur.next = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""删除一个节点"""</span></span><br><span class="line">        <span class="comment"># 若链表为空，则直接返回</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># 将cur指向头节点</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        pre = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 若头节点的元素就是要查找的元素item</span></span><br><span class="line">        <span class="keyword">if</span> cur.item == item:</span><br><span class="line">            <span class="comment"># 如果链表不止一个节点</span></span><br><span class="line">            <span class="keyword">if</span> cur.next != self._head:</span><br><span class="line">                <span class="comment"># 先找到尾节点，将尾节点的next指向第二个节点</span></span><br><span class="line">                <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                    cur = cur.next</span><br><span class="line">                <span class="comment"># cur指向了尾节点</span></span><br><span class="line">                cur.next = self._head.next</span><br><span class="line">                self._head = self._head.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 链表只有一个节点</span></span><br><span class="line">                self._head = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pre = self._head</span><br><span class="line">            <span class="comment"># 第一个节点不是要删除的</span></span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                <span class="comment"># 找到了要删除的元素</span></span><br><span class="line">                <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                    <span class="comment"># 删除</span></span><br><span class="line">                    pre.next = cur.next</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pre = cur</span><br><span class="line">                    cur = cur.next</span><br><span class="line">            <span class="comment"># cur 指向尾节点</span></span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="comment"># 尾部删除</span></span><br><span class="line">                pre.next = cur.next</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""查找节点是否存在"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">if</span> cur.item == item:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    ll = SinCycLinkedlist()</span><br><span class="line">    ll.add(<span class="number">1</span>)</span><br><span class="line">    ll.add(<span class="number">2</span>)</span><br><span class="line">    ll.append(<span class="number">3</span>)</span><br><span class="line">    ll.insert(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">    ll.insert(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    ll.insert(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br><span class="line">    print(ll.search(<span class="number">3</span>))</span><br><span class="line">    print(ll.search(<span class="number">7</span>))</span><br><span class="line">    ll.remove(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br></pre></td></tr></tbody></table></figure>

<p>双链表<br>相比单链表来说，每个节点既保存了指向下一个节点的指针，最后一个结点next指向为None(空)。<br>同时还保存了上一个节点的指针，双链表第一个结点pre指向为None(空)</p>
<p>双链表每个结点包括三个域，<br>pre指针指向上一个结点，val存储数据值，next指针指向下一个结点。</p>
<p>对于双链表可以使用class 的三个属性pre, val, next。</p>
<p>对， 就多了 prev，有啥优势嘛？</p>
<ul>
<li><p>直接删除节点，当然如果给的是一个值，我们还是需要查找这个值在哪个节点？ - 但是如果给了一个节点，我们把它拿掉，直接让它的前后节点互相指过去不就行了？哇欧，删除就是 O(1) 了，两步操作就行啦</p>
</li>
<li><p>看似我们反过来遍历双链表了。反过来从哪里开始呢？我们只要让 root 的 prev 指向 tail 节点，不就串起来了吗？<br>循环双端列表就是在双列表基础上把最后一个结点next指向第一个结点，第一个结点pre指向最后一个结点，这样就形成循环双端链表。</p>
</li>
</ul>
<p>最 </p>
<table>
<thead>
<tr>
<th>循环双端链表操作 CircularDoubleLinkedList 大写字母缩写 cdll</th>
<th>平均时间复杂度</th>
</tr>
</thead>
<tbody><tr>
<td>cdll.append(value)</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.appendleft(value)</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.remove(node)，注意这里参数是 node</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.headnode()</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.tailnode()</td>
<td>O(1)</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="comment"># 如果节点很多，我们可以用 __slots__ 来节省内存，把属性保存在一个 tuple 而不是 dict 里</span></span><br><span class="line">    <span class="comment"># 感兴趣可以自行搜索  python  __slots__</span></span><br><span class="line">    __slots__ = (<span class="string">'value'</span>, <span class="string">'prev'</span>, <span class="string">'next'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value=None, prev=None, next=None</span>):</span></span><br><span class="line">        self.value, self.prev, self.next = value, prev, next</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""双向链表节点"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        self.item = item</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line">        self.prev = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DLinkList</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""双向链表"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""判断链表是否为空"""</span></span><br><span class="line">        <span class="keyword">return</span> self._head == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">length</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""返回链表的长度"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">travel</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""遍历链表"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            print(cur.item,</span><br><span class="line">            cur = cur.next</span><br><span class="line">        print(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""头部插入元素"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将_head指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 将node的next指向_head的头节点</span></span><br><span class="line">            node.next = self._head</span><br><span class="line">            <span class="comment"># 将_head的头节点的prev指向node</span></span><br><span class="line">            self._head.prev = node</span><br><span class="line">            <span class="comment"># 将_head 指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""尾部插入元素"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将_head指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 移动到链表尾部</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != <span class="literal">None</span>:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将尾节点cur的next指向node</span></span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment"># 将node的prev指向cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""查找元素是否存在"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure>


<p>双链表节点的插入<br>中间值插入的情况<br>p.next = cur.next<br>cur.next.prev = p<br>p.prev = cur<br>cur.next = p</p>
<p>指定位置插入节点</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, pos, item</span>):</span></span><br><span class="line">        <span class="string">"""在指定位置添加节点"""</span></span><br><span class="line">        <span class="keyword">if</span> pos &lt;= <span class="number">0</span>:</span><br><span class="line">            self.add(item)</span><br><span class="line">        <span class="keyword">elif</span> pos &gt; (self.length()<span class="number">-1</span>):</span><br><span class="line">            self.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = Node(item)</span><br><span class="line">            cur = self._head</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 移动到指定位置的前一个位置</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; (pos<span class="number">-1</span>):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将node的prev指向cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line">            <span class="comment"># 将node的next指向cur的下一个节点</span></span><br><span class="line">            node.next = cur.next</span><br><span class="line">            <span class="comment"># 将cur的下一个节点的prev指向node</span></span><br><span class="line">            cur.next.prev = node</span><br><span class="line">            <span class="comment"># 将cur的next指向node</span></span><br><span class="line">            cur.next = node</span><br></pre></td></tr></tbody></table></figure>

<p>双链表节点的删除，<br>当然如果给的是一个值，我们还是需要查找这个值在哪个节点？ </p>
<ul>
<li>但是如果给了一个节点，我们把它拿掉，直接让它的前后节点互相指过去不就行了？<br>删除就是 O(1) 了，两步操作就行啦</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""删除元素"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="comment"># 如果首节点的元素即是要删除的元素</span></span><br><span class="line">                <span class="keyword">if</span> cur.next == <span class="literal">None</span>:</span><br><span class="line">                    <span class="comment"># 如果链表只有这一个节点</span></span><br><span class="line">                    self._head = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 将第二个节点的prev设置为None</span></span><br><span class="line">                    cur.next.prev = <span class="literal">None</span></span><br><span class="line">                    <span class="comment"># 将_head指向第二个节点</span></span><br><span class="line">                    self._head = cur.next</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                    <span class="comment"># 将cur的前一个节点的next指向cur的后一个节点</span></span><br><span class="line">                    cur.prev.next = cur.next</span><br><span class="line">                    <span class="comment"># 将cur的后一个节点的prev指向cur的前一个节点</span></span><br><span class="line">                    cur.next.prev = cur.prev</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                cur = cur.next</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    ll = DLinkList()</span><br><span class="line">    ll.add(<span class="number">1</span>)</span><br><span class="line">    ll.add(<span class="number">2</span>)</span><br><span class="line">    ll.append(<span class="number">3</span>)</span><br><span class="line">    ll.insert(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">    ll.insert(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    ll.insert(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br><span class="line">    print(ll.search(<span class="number">3</span>))</span><br><span class="line">    print(ll.search(<span class="number">4</span>))</span><br><span class="line">    ll.remove(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br></pre></td></tr></tbody></table></figure>


<p>中间值p = cur.next删除的情况<br>cur.next = p.next<br>p.next.prev = cur<br>cur.next = p<br>del p</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
