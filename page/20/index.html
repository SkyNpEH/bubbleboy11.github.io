<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/20/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/20/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/20/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">357</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/app-zi-dong-hua-appium/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/app-zi-dong-hua-appium/" class="post-title-link" itemprop="url">app自动化 Appium</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-03 15:24:55" itemprop="dateModified" datetime="2021-05-03T15:24:55Z">2021-05-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>为什么要做APP自动化</p>
<ul>
<li>用户对App产品的质量和用户体验要求越来越高</li>
<li>互联网公司对移动端产品投入的重视越来越高</li>
<li>互联网产品迭代快</li>
<li>繁琐的回归测试</li>
</ul>
<p>APP自动化与WEB自动化<br>WEB APP<br>启动方式 浏览器启动，可以多线程 呼出APP启动，只能单线程<br>客户端信息 通过启动webdriver不同的浏览器类  需要制定desired_caps内容，包含设备信息<br>元素定位 name，id，class_name，css，xpath等 不支持css_selector和linktext<br>元素操作 可以支持通过js实现 不支持js，支持滑动</p>
<p>Appium<br>是一个开源、跨平台的测试框架，可以用来测试原生及混合的移动端应用。Appium支持IOS、Android及FirefoxOS平台。支持多种语言。</p>
<ul>
<li><p>核心是一个web服务器，它提供了一套REST的接口。它接收到客户端的连接，监听到命令，接着在移动设备上执行这个命令，然后将执行结果放到HTTP响应中返还给客户端。</p>
</li>
<li><p>对于Android系统，Appium使用的是UiAutomator2 Driver来驱动客户端设备，对于IOS系统，目前使用的是XCUITest。<br>Appium同时还包含了Windows Driver和Mac Driver支持windows和Mac桌面应用的测试。</p>
</li>
</ul>
<p>appium定位手机元素</p>
<ul>
<li>常用元素定位方法(ID、 ClassName、 Xpath)</li>
<li>层级定位</li>
<li>内嵌H5定位</li>
<li>滑动定位</li>
<li>uiautomator text定位</li>
</ul>
<p>Advanced Setting-json representation</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"platformName"</span>: <span class="string">"Android"</span>,</span><br><span class="line">  <span class="attr">"platformVersion"</span>: <span class="string">"7.1.2"</span>,</span><br><span class="line">  <span class="attr">"deviceName"</span>: <span class="string">"emulator"</span>,</span><br><span class="line">  <span class="attr">"appPackage"</span>: <span class="string">"mark.via"</span>,</span><br><span class="line">  <span class="attr">"appActivity"</span>: <span class="string">"mark.via.Shell"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"platformName"</span>: <span class="string">"Android"</span>,</span><br><span class="line">  <span class="attr">"platformVersion"</span>: <span class="string">"7.1.2"</span>,</span><br><span class="line">  <span class="attr">"deviceName"</span>: <span class="string">"emulator"</span>,</span><br><span class="line">  <span class="attr">"appPackage"</span>: <span class="string">"com.baidu.searchbox"</span>,</span><br><span class="line">  <span class="attr">"appActivity"</span>: <span class="string">"com.baidu.searchbox.SplashActivity"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


<p>先启动appium，在执行python</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Appium-Python-Client</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># app启动参数 Capability</span></span><br><span class="line">desired_caps = {</span><br><span class="line">    <span class="string">'platformName'</span>: <span class="string">'Android'</span>,  <span class="comment"># 设置平台</span></span><br><span class="line">    <span class="string">'platformVersion'</span>: <span class="string">'7.1.2'</span>,  <span class="comment"># 系统版本</span></span><br><span class="line">    <span class="string">'deviceName'</span>: <span class="string">'127.0.0.1:5555'</span>,  <span class="comment"># 安卓的话这个参数没有用，随便填都可以</span></span><br><span class="line">    <span class="string">'appPackage'</span>: <span class="string">'mark.via'</span>,  <span class="comment"># 包名</span></span><br><span class="line">    <span class="string">'appActivity'</span>: <span class="string">'mark.via.Shell'</span>  <span class="comment"># 启动的activity</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># appium服务监听地址</span></span><br><span class="line">server = <span class="string">'http://localhost:4723/wd/hub'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明手机驱动</span></span><br><span class="line">driver = webdriver.Remote(server, desired_caps)</span><br><span class="line"><span class="comment"># 定位到要操作的联系人</span></span><br><span class="line"><span class="comment"># driver.find_element_by_id('com.android.contacts:id/cliv_name_textview').click()</span></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动参数</span></span><br><span class="line">desired_caps = {}</span><br><span class="line">desired_caps[<span class="string">'platformName'</span>] = <span class="string">'Android'</span></span><br><span class="line">desired_caps[<span class="string">'platformVersion'</span>] = <span class="string">'7.1.2'</span></span><br><span class="line">desired_caps[<span class="string">'deviceName'</span>] = <span class="string">'127.0.0.1:62001'</span></span><br><span class="line">desired_caps[<span class="string">'appPackage'</span>] = <span class="string">'com.baidu.searchbox'</span></span><br><span class="line">desired_caps[<span class="string">'appActivity'</span>] = <span class="string">'com.baidu.searchbox.SplashActivity'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明手机驱动</span></span><br><span class="line">driver = webdriver.Remote(<span class="string">'http://localhost:4723/wd/hub'</span>, desired_caps)</span><br><span class="line"><span class="comment"># 定位元素 (同意激活)</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'com.baidu.searchbox:id/positive_button'</span>).click()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 关闭广告</span></span><br><span class="line"><span class="comment"># driver.find_element_by_id(</span></span><br><span class="line"><span class="comment">#     'com.baidu.searchbox:id/introduction_login_close_button').click()</span></span><br><span class="line"><span class="comment"># 点击搜索框</span></span><br><span class="line">driver.find_element_by_class_name(<span class="string">'android.widget.TextSwitcher'</span>).click()</span><br><span class="line"><span class="comment"># 输入搜索内容</span></span><br><span class="line">driver.find_element_by_id(</span><br><span class="line">    <span class="string">'com.baidu.searchbox:id/input_root'</span>).find_element_by_id(</span><br><span class="line">        <span class="string">'com.baidu.searchbox:id/SearchTextInput'</span>).send_keys(<span class="string">'Appium'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击搜索</span></span><br><span class="line"><span class="comment"># driver.find_element_by_id('com.baidu.searchbox:id/float_search_or_cancel').click()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># id定位</span></span><br><span class="line">driver.find_element_by_android_uiautomator(</span><br><span class="line">    <span class="string">'new UiSelector().resourceId("com.baidu.searchbox:id/float_search_or_cancel")'</span></span><br><span class="line">).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># driver.find_element_by_android_uiautomator(</span></span><br><span class="line"><span class="comment">#     'new UiSelector().text("百度一下")'</span></span><br><span class="line"><span class="comment"># ).click()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># driver.find_element_by_android_uiautomator(</span></span><br><span class="line"><span class="comment">#     'new UiSelector().textContains("度一下")'</span></span><br><span class="line"><span class="comment"># ).click()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则</span></span><br><span class="line"><span class="comment"># driver.find_element_by_android_uiautomator(</span></span><br><span class="line"><span class="comment">#     'new UiSelector().textMatches("^百度一下.*")'</span></span><br><span class="line"><span class="comment"># ).click()</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<hr>
<p>集成到unittest和服用PageObject模式</p>
<p>web自动化\traveltest（实战项目第七节后）\pages\base_app_page.py</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseAppPage</span>():</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    第一层 basepage层 定义一个所有页面都继承的page层</span></span><br><span class="line"><span class="string">    对se我们要使用的底层方法进行一次封装</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, driver, path=None</span>):</span></span><br><span class="line">        <span class="comment"># 为了方便编写，把driver初始化，后续改回来</span></span><br><span class="line">        <span class="comment"># self.driver = webdriver.Chrome()</span></span><br><span class="line">        self.driver = driver</span><br><span class="line">        self.driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">by_xpath</span>(<span class="params">self, xpath</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.driver.find_element_by_xpath(xpath)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">by_id</span>(<span class="params">self, id</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.driver.find_element_by_id(id)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">by_classname</span>(<span class="params">self, classname</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.driver.find_element_by_class_name(classname)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">by_uiautomator</span>(<span class="params">self, uiautomator</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.driver.find_element_by_android_uiautomator(uiautomator)</span><br></pre></td></tr></tbody></table></figure>

<p><code>pages\first_baidu_page.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> pages.base_app_page <span class="keyword">import</span> BaseAppPage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstBaiduPage</span>(<span class="params">BaseAppPage</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    第二层</span></span><br><span class="line"><span class="string">    各个页面单独封装成层，页面的元素、操作、流程</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">confirm_continue</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.by_id(<span class="string">"com.baidu.searchbox:id/positive_button"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_ad</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.by_id(</span><br><span class="line">            <span class="string">"com.baidu.searchbox:id/introduction_login_close_button"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">click_search</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.by_classname(<span class="string">"android.widget.TextSwitcher"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法流程</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">go_to_search</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.confirm_continue().click()</span><br><span class="line">        self.close_ad().click()</span><br><span class="line">        self.click_search().click()</span><br></pre></td></tr></tbody></table></figure>


<p><code>pages\baidu_search_page.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> pages.base_app_page <span class="keyword">import</span> BaseAppPage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaiduSearchPage</span>(<span class="params">BaseAppPage</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    第二层</span></span><br><span class="line"><span class="string">    各个页面单独封装成层，页面的元素、操作、流程</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search_input</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.by_id(<span class="string">"com.baidu.searchbox:id/SearchTextInput"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search_button</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.by_uiautomator(</span><br><span class="line">            <span class="string">'new UiSelector().resourceId("com.baidu.searchbox:id/float_search_or_cancel")'</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法流程</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">content_search</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        self.search_input().send_keys(content)</span><br><span class="line">        self.search_button().click()</span><br></pre></td></tr></tbody></table></figure>

<p><code>test_baidu_po.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pages.baidu_search_page <span class="keyword">import</span> BaiduSearchPage</span><br><span class="line"><span class="keyword">from</span> pages.first_baidu_page <span class="keyword">import</span> FirstBaiduPage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestLogin</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 初始化操作 进行app caps配置</span></span><br><span class="line">    <span class="comment"># 最终结束操作 关闭app</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        desired_caps = {}</span><br><span class="line">        desired_caps[<span class="string">'platformName'</span>] = <span class="string">'Android'</span></span><br><span class="line">        desired_caps[<span class="string">'platformVersion'</span>] = <span class="string">'7.1.2'</span></span><br><span class="line">        desired_caps[<span class="string">'deviceName'</span>] = <span class="string">'127.0.0.1:62001'</span></span><br><span class="line">        desired_caps[<span class="string">'appPackage'</span>] = <span class="string">'com.baidu.searchbox'</span></span><br><span class="line">        desired_caps[<span class="string">'appActivity'</span>] = <span class="string">'com.baidu.searchbox.SplashActivity'</span></span><br><span class="line">        self.dr = webdriver.Remote(<span class="string">'http://localhost:4723/wd/hub'</span>,</span><br><span class="line">                                   desired_caps)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_baidu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 初始化界面</span></span><br><span class="line">        first_page = FirstBaiduPage(driver=self.dr)</span><br><span class="line">        search_page = BaiduSearchPage(driver=self.dr)</span><br><span class="line">        <span class="comment"># 跳转</span></span><br><span class="line">        first_page.go_to_search()</span><br><span class="line">        <span class="comment"># 搜索</span></span><br><span class="line">        search_page.content_search(<span class="string">"Appium"</span>)</span><br><span class="line">        sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.dr.quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>

<hr>
<p><code>swipeTest.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动参数</span></span><br><span class="line">desired_caps = {}</span><br><span class="line">desired_caps[<span class="string">'platformName'</span>] = <span class="string">'Android'</span></span><br><span class="line">desired_caps[<span class="string">'platformVersion'</span>] = <span class="string">'7.1.2'</span></span><br><span class="line">desired_caps[<span class="string">'deviceName'</span>] = <span class="string">'127.0.0.1:62001'</span></span><br><span class="line">desired_caps[<span class="string">'appPackage'</span>] = <span class="string">'com.baidu.searchbox'</span></span><br><span class="line">desired_caps[<span class="string">'appActivity'</span>] = <span class="string">'com.baidu.searchbox.SplashActivity'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明手机驱动</span></span><br><span class="line">driver = webdriver.Remote(<span class="string">'http://localhost:4723/wd/hub'</span>, desired_caps)</span><br><span class="line"><span class="comment"># 定位元素 (同意激活)</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'com.baidu.searchbox:id/positive_button'</span>).click()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 关闭广告</span></span><br><span class="line">driver.find_element_by_id(</span><br><span class="line">    <span class="string">'com.baidu.searchbox:id/introduction_login_close_button'</span>).click()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.swipe(<span class="number">100</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">500</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.swipe(<span class="number">100</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">500</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.swipe(<span class="number">100</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">500</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.swipe(<span class="number">100</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">500</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<p><code>swipeFullTest.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取页面大小</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSize</span>(<span class="params">driver</span>):</span></span><br><span class="line">    x = driver.get_window_size()[<span class="string">'width'</span>]</span><br><span class="line">    y = driver.get_window_size()[<span class="string">'height'</span>]</span><br><span class="line">    <span class="keyword">return</span> (x, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向左滑动</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeLeft</span>(<span class="params">driver</span>):</span></span><br><span class="line">    l = getSize(driver)</span><br><span class="line">    x1 = int(l[<span class="number">0</span>] * <span class="number">0.9</span>)</span><br><span class="line">    x2 = int(l[<span class="number">0</span>] * <span class="number">0.1</span>)</span><br><span class="line">    y = int(l[<span class="number">1</span>] * <span class="number">0.5</span>)</span><br><span class="line">    driver.swipe(x1, y, x2, y, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向右滑动</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeRight</span>(<span class="params">driver</span>):</span></span><br><span class="line">    l = getSize(driver)</span><br><span class="line">    x1 = int(l[<span class="number">0</span>] * <span class="number">0.9</span>)</span><br><span class="line">    x2 = int(l[<span class="number">0</span>] * <span class="number">0.1</span>)</span><br><span class="line">    y = int(l[<span class="number">1</span>] * <span class="number">0.5</span>)</span><br><span class="line">    driver.swipe(x2, y, x1, y, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向上滑动</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeUp</span>(<span class="params">driver</span>):</span></span><br><span class="line">    l = getSize(driver)</span><br><span class="line">    y1 = int(l[<span class="number">1</span>] * <span class="number">0.9</span>)</span><br><span class="line">    y2 = int(l[<span class="number">1</span>] * <span class="number">0.1</span>)</span><br><span class="line">    x = int(l[<span class="number">0</span>] * <span class="number">0.5</span>)</span><br><span class="line">    driver.swipe(x, y1, x, y2, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向下滑动</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeDown</span>(<span class="params">driver</span>):</span></span><br><span class="line">    l = getSize(driver)</span><br><span class="line">    y1 = int(l[<span class="number">1</span>] * <span class="number">0.9</span>)</span><br><span class="line">    y2 = int(l[<span class="number">1</span>] * <span class="number">0.1</span>)</span><br><span class="line">    x = int(l[<span class="number">0</span>] * <span class="number">0.5</span>)</span><br><span class="line">    driver.swipe(x, y2, x, y1, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeDemo</span>():</span></span><br><span class="line">    <span class="comment"># 启动参数</span></span><br><span class="line">    desired_caps = {}</span><br><span class="line">    desired_caps[<span class="string">'platformName'</span>] = <span class="string">'Android'</span></span><br><span class="line">    desired_caps[<span class="string">'platformVersion'</span>] = <span class="string">'7.1.2'</span></span><br><span class="line">    desired_caps[<span class="string">'deviceName'</span>] = <span class="string">'127.0.0.1:62001'</span></span><br><span class="line">    desired_caps[<span class="string">'appPackage'</span>] = <span class="string">'com.baidu.searchbox'</span></span><br><span class="line">    desired_caps[<span class="string">'appActivity'</span>] = <span class="string">'com.baidu.searchbox.SplashActivity'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 声明手机驱动</span></span><br><span class="line">    driver = webdriver.Remote(<span class="string">'http://localhost:4723/wd/hub'</span>, desired_caps)</span><br><span class="line">    <span class="comment"># 定位元素 (同意激活)</span></span><br><span class="line">    print(driver.get_window_size())</span><br><span class="line">    driver.find_element_by_id(<span class="string">'com.baidu.searchbox:id/positive_button'</span>).click()</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 关闭广告</span></span><br><span class="line">    driver.find_element_by_id(</span><br><span class="line">        <span class="string">'com.baidu.searchbox:id/introduction_login_close_button'</span>).click()</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    swipeUp(driver)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    swipeUp(driver)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    swipeUp(driver)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    swipeUp(driver)</span><br><span class="line">    sleep(<span class="number">2</span>)</span><br><span class="line">    driver.quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    swipeDemo()</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/assert/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/assert/" class="post-title-link" itemprop="url">python assert</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>assert condition, message</code><br>condition为True时，程序继续运行，下一个语句会被执行<br>condition为False时将会抛出AssertionError异常，该异常的信息为message</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divide</span>(<span class="params">num1, num2</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> num2 != <span class="number">0</span>, <span class="string">"Divisor cannot be zero"</span></span><br><span class="line">    <span class="keyword">return</span> num1 / num2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        a2 = divide(<span class="number">12</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">except</span> AssertionError <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line">    <span class="comment"># Divisor cannot be zero</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/b-tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/b-tree/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>查找结构进化史<br>线性查找：一个一个去找，实际上是全表扫描，优点实现简单；缺点查找太慢。<br>二分查找：需要有序结构；优点实现简单；缺点要求是有序的，插入特别慢。<br>哈希(Hash):优点查询快；缺点占用空间，不太适合存储大规模的数据<br>二叉查找树(Binary Search Tree)：优点插入和查询很快(log(n))；缺点无法存储大规模数据，复杂度退化(二叉查找树只往一边增长，退化成线性结构)，<br>树型查找结构，如二叉搜索树、平衡树、多路平衡查找树。）<br>平衡树:解决bst退化的问题,树是平衡的;节点非常多的时候,依然树高很高<br>多路查找树：一个父亲多个孩子节点(度)；节点过多树高不会特别深( 树的查找跟树高成正比 )<br>多路平衡查找树(B-Tree)：(每个结点最多 m (m&gt;=2) )个孩子，称为m 阶或者度，当度超的时候会执行分裂操作，该B-Tree称为m阶的多路平衡查找树。<br>叶结点具有相同的深度<br>结点中的数据 key 从到右是递增的。<br>B-Tree没有办法实现范围查找<br>一个结点可以有多个孩子，每个节点 key 从左到右都是递增的。<br>阶就是包含最大孩子个数，如结点(25,30,31,35)，该B-Tree是一颗4阶多路平衡查找树。</p>
<p>B+树 是 B-Tree的变形<br>只在叶子结点带有指向记录的指针。<br>B+树只在叶子结点存储数据，其它非叶子结点可以存储更过孩子(对B-Tree的优化)。</p>
<p>叶子结点通过指针相连。叶子结点里面有从左到右指针，它是一个双向指针，通过这个指针就可以非常方便实现范围查询。</p>
<p>是不是树的度越多越好呢？<br>如果树的阶越高，树高就会越小，因为每个孩子结点越多整体的树高就越小。不是每个结点的阶越大就越好，硬盘是以块来存储的，内存的基本管理单位是页，实际上阶是根据磁盘块大小来去确定的，主要是根据操作系统管理硬件有关。为了让操作系统更好的来去读取和缓存数据，以磁盘块的大小来确定B+树，一个磁盘块可以存储多少的孩子也就是多少阶。</p>
<p>MySQL索引的原理<br>Mysql 实际使用的 B+Tree作为索引的数据结构。<br>MySQL索引是用一种叫做聚簇索引的数据结构实现的<br>聚簇索引是一种数据存储方式，它实际上是在同一个结构中保存了B+树索引和数据行，<br>InnoDB表是按照聚簇索引组织的（类似于Oracle的索引组织表）。</p>
<p>B+ 树是一种树数据结构，是一个n叉排序树，每个节点通常有多个孩子，一棵B+树包含根节点、内部节点和叶子节点。根节点可能是一个叶子节点，也可能是一个包含两个或两个以上孩子节点的节点。<br>B+ 树通常用于数据库和操作系统的文件系统中。NTFS, ReiserFS, NSS, XFS, JFS, ReFS 和BFS等文件系统都在使用B+树作为元数据索引。<br>B+ 树的特点是能够保持数据稳定有序，其插入与修改拥有较稳定的对数时间复杂度。B+ 树元素自底向上插入。<br>InnoDB通过主键聚簇数据，如果没有定义主键，会选择一个唯一的非空索引代替，如果没有这样的索引，会隐式定义个主键作为聚簇索引。</p>
<p>对于普通的堆组织表来说（右图），表数据和索引是分别存储的，主键索引和二级索引存储上没有任何区别。<br>而对于聚簇索引表来说（左图），表数据是和主键一起存储的，主键索引的叶结点存储行数据，二级索引的叶结点存储行的主键值。<br>聚簇索引表最大限度地提高了I/O密集型应用的性能，但它也有以下几个限制：</p>
<p>1）插入速度严重依赖于插入顺序，按照主键的顺序插入是最快的方式，否则将会出现页分裂，严重影响性能。因此，对于InnoDB表，我们一般都会定义一个自增的ID列为主键。<br>2）更新主键的代价很高，因为将会导致被更新的行移动。因此，对于InnoDB表，我们一般定义主键为不可更新。<br>3）二级索引访问需要两次索引查找，第一次找到主键值，第二次根据主键值找到行数据。<br>二级索引的叶节点存储的是主键值，而不是行指针，这是为了减少当出现行移动或数据页分裂时二级索引的维护工作，但会让二级索引占用更多的空间。</p>
<p>MyISAM索引实现？<br>MyISAM存储引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址。MyISAM的索引方式也叫做非聚簇索引的，之所以这么称呼是为了与InnoDB的聚簇索引区分。</p>
<p>MyISAM索引与InnoDB索引的区别？<br>InnoDB索引是聚簇索引，MyISAM索引是非聚簇索引。<br>InnoDB的主键索引的叶子节点存储着行数据，因此主键索引非常高效。<br>MyISAM索引的叶子节点存储的是行数据地址，需要再寻址一次才能得到数据。<br>InnoDB非主键索引的叶子节点存储的是主键和其他带索引的列数据，因此查询时做到覆盖索引会非常高效。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/call/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/call/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>模拟可调用对象</p>
<figure class="highlight plain"><figcaption><span>args...])``` 此方法会在实例作为一个函数被“调用”时被调用；如果定义了此方法，则 ```x(arg1, arg2, ...)``` 就相当于 ```x.__call__(arg1, arg2, ...)``` 的快捷方式。 也就是说在类被实例化成对象后，对象可以像函数一样被调用。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">我们可以将它们作为输入传递到其他的函数/方法中并调用它们,正如我们调用一个正常的函数那样。而类中的call()函数的意义正在于此.为了将一个类实例当作函数调用,我们需要再类中事先call()方法.假设x是X类的一个实例.调用x.__call__(1,2)等同于调用x(1,2).这个实例本身在这里相当于一个函数.</span><br><span class="line"></span><br><span class="line">下述用例可以通过，这里我定义了__call__方法，如果sorted函数生效时调用了__call__方法，那上述写法一定会出错。</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">class LargerNumKey:</span><br><span class="line">    def __init__(self, value):</span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    def __lt__(self, other):</span><br><span class="line">        return self.value + other.value &gt; other.value + self.value</span><br><span class="line"></span><br><span class="line">    def __call__(self, *args, **kwargs):</span><br><span class="line">        print('call')</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Solution:</span><br><span class="line">    def largestNumber(self, nums):</span><br><span class="line">        ans = ''.join(sorted(map(str, nums), key=LargerNumKey))</span><br><span class="line">        return '0' if ans[0] == '0' else ans</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    arr = [10, 3, 20]</span><br><span class="line">    sl = Solution()</span><br><span class="line">    l = LargerNumKey(3)</span><br><span class="line">    l1 = l()</span><br><span class="line">    print(l == l1)</span><br><span class="line">    print(sl.largestNumber(arr))</span><br><span class="line">    # call</span><br><span class="line">    # False</span><br><span class="line">    # 32010</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">10</span>, <span class="number">3</span>, <span class="number">20</span>]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/dango-auth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/dango-auth/" class="post-title-link" itemprop="url">django-auth</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-17 08:40:57" itemprop="dateModified" datetime="2021-06-17T08:40:57Z">2021-06-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="django-auth模块"><a href="#django-auth模块" class="headerlink" title="django-auth模块"></a>django-auth模块</h3><p>django-auth用户认证组件(重点)<br>实现用户注册、登录及权限验证，<br>通过取表单数据跟数据库对应表存储的值做比对<br>用于判断当前的用户是否合法，并跳转到登陆成功或失败页面。<br>功能主要有：</p>
<h3 id="自带用户认证授权系统"><a href="#自带用户认证授权系统" class="headerlink" title="自带用户认证授权系统"></a>自带用户认证授权系统</h3><ul>
<li>用户：记录用户的登录账号密码等信息</li>
<li>权限：用户是否有权限访问某一资源（执行操作）</li>
<li>组：对多个用户进行权限管理<br>登录密码：加密后的密码存储<br>自带后台管理</li>
</ul>
<h4 id="安装及配置"><a href="#安装及配置" class="headerlink" title="安装及配置"></a>安装及配置</h4><p><code>setting.py</code></p>
<ul>
<li>第一步：INSTALLED_APPS安装应用</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第二步：MIDDLEWARE中间件配置</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,  <span class="comment"># 用户登录</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>第三步：migrate同步模型到数据库</p>
</li>
<li><p>用户模型</p>
</li>
<li><p>用户认证、登录、退出等<br>分为两种用户</p>
<ul>
<li>游客(AnonymousUser )</li>
<li>注册用户（User） </li>
</ul>
</li>
</ul>
<p>User常用属性<br><code>auth_user</code>表格字段含义 对应ORM的模型或数据库中的一条记录<br>属性    描述<br><code>username</code>    用户名<br><code>password</code>    登录密码<br>email    电子邮箱<br><code>is_staff</code>    是否为内部员工，true可以登录django后台管理系统<br><code>is_active</code>    是否为激活用户，true可以登录系统<br><code>is_superuser</code>    是否为超级管理员，可以在线管理所有的数据表<br><code>is_authenticated</code> 用户是否已登录<br><code>is_anonymous</code>    用户登录是否已失效<br><code>last_login</code>    最后登录时间<br><code>date_joined</code>    注册时间<br><code>groups</code>    用户组多对多关系<br><code>user_permissions</code>    用户权限多对多关系</p>
<ul>
<li>创建普通用户 命令行输入命令</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py shell  // django控制台</span><br></pre></td></tr></tbody></table></figure>
<p>或者pycharm的<code>python Console</code></p>
<p>引入用户</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = User.objects.create_user(<span class="string">'john'</span>,<span class="string">'john@example.com'</span>,<span class="string">'johnpassword'</span>)</span><br><span class="line">user = User.objects.create_user(<span class="string">'zhangsan'</span>,<span class="string">'zhangsan@example.com'</span>,<span class="string">'123456'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>能在<code>auth_user</code>表格中看到新加的用户，<code>is_staff</code>和<code>is_superuser</code>都是0</p>
<ul>
<li>使用命令行创建超级管理员</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;python manage.py createsuperuser</span><br></pre></td></tr></tbody></table></figure>

<p>能在<code>auth_user</code>表格中看到新加的用户，<code>is_staff</code>和<code>is_superuser</code>都是1</p>
<ul>
<li><p>在<code>auth_user</code>表格修改<code>is_staff</code>和<code>is_superuser</code>切换超级管理员和普通用户</p>
</li>
<li><p>获取用户对象</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from django.contrib.auth.models import User</span><br><span class="line">&gt;&gt;&gt; u = User.objects.get(username=<span class="string">'john'</span>)</span><br><span class="line">&gt;&gt;&gt; u = User.objects.get(id=2)</span><br><span class="line">user = User.objects.get(username=<span class="string">'admin'</span>)</span><br><span class="line">`</span><br><span class="line"></span><br><span class="line">- 设置、修改用户的密码</span><br><span class="line">```bash</span><br><span class="line">&gt;&gt;python manage.py changepassword</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; u.set_password(<span class="string">'new password'</span>)</span><br><span class="line">&gt;&gt;&gt; u.set_password(<span class="string">'12345678'</span>)</span><br><span class="line">&gt;&gt;&gt; u.save()</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>检查用户的密码是否正确<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; u.check_password(<span class="string">'my password'</span>)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;</span>python manage.py clearsessions 清除过期会话</span><br><span class="line"><span class="meta">&gt;&gt;</span>python manage.py collectstatic 收集依赖中的静态文件</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>后台管理<br>浏览器<code>http://127.0.0.1:8000/admin/</code></p>
</li>
<li><p>切换超级管理员和普通用户</p>
</li>
<li><p>用户管理、权限分配<br>普通用户名zhangsan-permission-group</p>
</li>
</ul>
<p><img src="/2020/08/21/dango-auth/user_permissons.png"><br><img src="/2020/08/21/dango-auth/user_permissons.png"></p>
<ul>
<li>判断用户是否具备某权限</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.user.has_perm(<span class="string">'foo.add_bar'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>强制权限验证</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@permission_required('foo.add_bar')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span>(<span class="params">request</span>):</span></span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>命令行工具</p>
</li>
</ul>
<p>用户退出：<br>使用logout函数退出当前登录用户<br>Username (leave blank to use ‘rose’): admin<br>Email address: <a href="mailto:admin@exaple.com">admin@exaple.com</a><br>为了让 admin 界面管理某个数据模型，我们需要先注册该数据模型到 admin。<br>比如，我们之前在 TestModel 中已经创建了模型 Test 。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout_view</span>(<span class="params">request</span>):</span></span><br><span class="line">logout(request)</span><br><span class="line"><span class="comment"># 执行后面的操作</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>user</code>是一个<code>django.contrib.auth.models.User</code> 对象，代表当前登录的用户。<br>如果访问用户当前没有登录，<code>user</code>将被初始化为<code>django.contrib.auth.models.AnonymousUser</code>的实例。<br>你可以通过<code>user</code>的<code>is_authenticated()</code>方法来辨别用户是否登录：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.user.is_authenticated():</span><br><span class="line">    <span class="comment"># Do something for logged-in users.</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># Do something for anonymous users.</span></span><br></pre></td></tr></tbody></table></figure>

<p>只有激活Django中的AuthenticationMiddleware时该属性才可用</p>
<p>登录及退出<br>步骤一：认证验证用户名和密码是否匹配</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = authenticate(username=<span class="string">'john'</span>,password=<span class="string">'secret'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>步骤二：判断认证后的用户是否为None，不为None则表示用户认证通过<br>步骤三：调用login函数登录用户<br><code>login(request,user,backend=None)</code></p>
<ul>
<li><p>在视图中获取当前用户<code>request.user</code> 不必再次调用sql</p>
</li>
<li><p>需要登录才可以访问的视图</p>
</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span>(<span class="params">request</span>):</span></span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django-jie-guo-ji-queryset/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django-jie-guo-ji-queryset/" class="post-title-link" itemprop="url">django 结果集QuerySet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-01 12:41:07" itemprop="dateModified" datetime="2021-08-01T12:41:07Z">2021-08-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>查询条件的使用<br>结果集QuerySet常用方法<br>Queryset表示从数据库中取出来的对象的集合<br>它可以含有零个、一个或者多个过滤器（filter）（相当于数据库的where）</p>
<p>从模型的Manager那里取得QuerySet<br>QuerySet的筛选结果本身还是QuerySet</p>
<p>注意：对一个QuerySet实例对象，可以继续调用上面所有函数</p>
<blockquote>
<p><strong>说明2</strong>：ORM查询多个对象时会返回QuerySet对象，QuerySet使用了<strong>惰性查询</strong>，<br>即在创建QuerySet对象的过程中不涉及任何数据库活动，等真正用到对象时（对QuerySet求值）才向数据库发送SQL语句并获取对应的结果，这一点在实际开发中需要引起注意！<br>不能直接得出数据信息，只有通过循环才能得到结果的具体信息.<br><strong>说明3</strong>：缓存：结果集从数据库操作一次之后，下一次对同一个查询集进行操作不会再进行数据库的查询的，从缓存获取数据<br><strong>说明4</strong>：如果希望更新多条数据，不用先逐一获取模型对象再修改对象属性，可以直接使用QuerySet对象的<code>update()</code>方法一次性更新多条数据。</p>
</blockquote>
<p>不要对<code>QuerySet</code>调用<code>len()</code>函数。</p>
<ul>
<li><code>filter()</code>——返回筛选出满足条件的数据记录。参数中可以写查询条件。返回值也是QuerySet实例对象。获取不到数据返回一个空列表，不会抛出异常<br>pk=3 的意思是主键 primary key=3，相当于 id=3。</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询在2020年1月1日之后创建的数据</span></span><br><span class="line">user_list = WeiboUser.objects.filter(created_at__gt=<span class="string">'2020-1-1'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>exclude()</code>——返回不满足条件的数据，和filter相反<br>User.objects.all().exclude(username=’user1’).count()<br>Out[23]: 5</li>
</ul>
<p><code>get</code>:返回一条且只能有一条数据，返回值是一个对象，参数可以写查询条件。获取不到数据和查到两条数据会抛出异常。配合<code>try except</code>语句</p>
<ul>
<li><code>get_or_create()</code>——有则返回，没有则创建记录，可以实现链式的调用，通过第一次的过滤还可以再过滤</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">obj=User.objects.get_or_create(username=<span class="string">'zhangsan'</span>,password=<span class="string">'123456'</span>,nickname=<span class="string">'张三'</span>)</span><br><span class="line">obj</span><br><span class="line">Out[<span class="number">7</span>]: (&lt;WeiboUser: WeiboUser object&gt;, <span class="literal">False</span>)</span><br><span class="line">obj = User.objects.get_or_create(username=<span class="string">'zhangsan2'</span>,password=<span class="string">'1111'</span>,nickname=<span class="string">'qq'</span>)</span><br><span class="line">obj</span><br><span class="line">Out[<span class="number">9</span>]: (&lt;WeiboUser: WeiboUser object&gt;, <span class="literal">True</span>)</span><br><span class="line">obj = User.objects.get_or_create(username=<span class="string">'zhangsan2'</span>,password=<span class="string">'123456'</span>,nickname=<span class="string">'qq'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>bulk_create()</code>——创建/新增多条数据库记录，结果集从数据库中查询出来之后不会再进行数据库的查询的</p>
<pre><code>user1 = User(username='user1', nickname='用户1', password='123456')
user2 = User(username='user2', nickname='用户2', password='123456')
user3 = User(username='user3', nickname='用户3', password='123456')
User.objects.bulk_create([user1,user2,user3])
</code></pre>
<p>QuerySet链式查询方法：</p>
<ul>
<li><code>first()/last()</code>——返回第一条/最后一条记录</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User.objects.first()</span><br><span class="line">Out[<span class="number">17</span>]: &lt;WeiboUser: WeiboUser object&gt;</span><br><span class="line">User.objects.first().username</span><br><span class="line">Out[<span class="number">18</span>]: <span class="string">'quan'</span></span><br><span class="line">User.objects.last().username</span><br><span class="line">Out[<span class="number">19</span>]: <span class="string">'user3'</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>all()</code>用来查询表中的所有数据，<br>返回值是一个查询集（QuerySet）类型数据，<br>返回模型类对应表的所有数据，<br>用索引下标取出模型类的对象</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">books = models.Book.objects.all()</span><br><span class="line">print(books, type(books))</span><br><span class="line"><span class="comment"># QuerySet类型，类似于list，访问url时数据显示在命令行窗口中。</span></span><br><span class="line">foriinbooks:</span><br><span class="line">print(i.title)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>count()</code>——返回记录行数之和 返回结果集中数据的数目，返回值是一个数字</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User.objects.all().count()</span><br><span class="line">Out[<span class="number">24</span>]: <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>exists()</code>——结果集是否存在（1条以上）返回值用于<code>if</code>条件。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">User.objects.filter(username=<span class="string">'zhangsan'</span>).exists()</span><br><span class="line">Out[<span class="number">24</span>]: <span class="number">6</span></span><br><span class="line"></span><br><span class="line">a=User.objects.all().order_by(<span class="string">'id'</span>)[<span class="number">0</span>]</span><br><span class="line">b=User.objects.all().order_by(<span class="string">'-id'</span>)[<span class="number">0</span>]</span><br><span class="line">a</span><br><span class="line">Out[<span class="number">29</span>]: &lt;WeiboUser: WeiboUser object&gt;</span><br><span class="line">a.username</span><br><span class="line">Out[<span class="number">30</span>]: <span class="string">'quan'</span></span><br><span class="line">b.username</span><br><span class="line">Out[<span class="number">31</span>]: <span class="string">'user3'</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>order_by()</code>——对查询的记录结果排序<br>返回值是QuerySet，参数中写排序的字段<br>可以写多个字段，默认升序，如果降序，在字段前面加“-”<br>• 参数的字段名要加引号。<br>• 降序为在字段前面加个负号</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User.objects.all().order_by(<span class="string">'-id'</span>)[<span class="number">0</span>]  倒数第一个</span><br><span class="line">Out[<span class="number">25</span>]:&lt;WeiboUser: User:user3,pk:<span class="number">10</span>, status:<span class="number">1</span>&gt;</span><br><span class="line">User.objects.all().order_by(<span class="string">'id'</span>)[<span class="number">0</span>]   第一个</span><br><span class="line">Out[<span class="number">26</span>]: &lt;WeiboUser: WeiboUser object&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>none()</code>——创建一个空的结果集</li>
<li><code>using()</code>——使用指定的数据库查询(在settings中添加多数据库支持)</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找xx数据库的全部记录，并将其通过id降序排列</span></span><br><span class="line">User.objects.all().order_by(<span class="string">'-id'</span>).using(<span class="string">'数据库名'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>分页处理</p>
<ul>
<li>减少等待时间，提升用户体验</li>
<li>如何进行分页查询：</li>
</ul>
<p>方法一：对查询结果集QuerySet进行分片</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回前n个对象（LIMIT 5）</span></span><br><span class="line">User.objects.all()[:<span class="number">5</span>]</span><br><span class="line"><span class="comment"># （offset 5 limit 5）sql中offset偏移的意思</span></span><br><span class="line">跳过前<span class="number">5</span>条数据，从第<span class="number">6</span>条数据开始取，取<span class="number">5</span>条数据，第<span class="number">6</span>到第<span class="number">10</span>个对象</span><br><span class="line">User.objects.all()[<span class="number">5</span>:<span class="number">10</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>for i in range(100):<br>  …:   …:list.append(User(username=’user{0}’.format(i),nickname=’用户{}’.format(i),password=’123456’))</p>
<p>  …:len(list)<br>Out[7]: 100<br>User.objects.bulk_create(list)</p>
<p>obj_list = User.objects.all()[50:10]  第五列从第50行开始<br>obj_list<br>Out[10]: &lt;QuerySet []&gt;<br>list_all = User.objects.all()<br>list_all[50:60]<br>`</p>
<p>方法二：使用<code>django.core.paginator</code>进行分页处理(分页处理器)<br>分页处理相关类：<br>Paginator——分页器<br>Page——某一页对象<br>异常：<br>InvalidPage——无效的页码<br>PageNotAnInteger——页码必须是整数<br>EmptyPage——空页（没有数据）</p>
<p>分页处理器<br>    步骤一：取得分页器Paginator(objects,page_size)<br>objects——要进行分页的数据，就是我们之前查询获得的结果集<br>page_size——每页的数据放多少<br>Python<br>    1    p = Paginator(objects,2)<br>    分页器的属性：<br>    count——数据记录的总条数<br>    num_pages——总页数（总记录条数/每页大小）<br>    page_range——页码范围<br>    步骤二：取得页面实例page=p.page(page_num)<br>page_num——当前页的页码，如第几页</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = Paginator(objects,<span class="number">2</span>)</span><br><span class="line">page = p.page(<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="页面实例的属性："><a href="#页面实例的属性：" class="headerlink" title="页面实例的属性："></a>页面实例的属性：</h4><ul>
<li>number——当前页的页码</li>
<li>object_list——当前页的数据列表</li>
<li>paginator——分页器对象的引用</li>
</ul>
<h4 id="页面实例的常用方法："><a href="#页面实例的常用方法：" class="headerlink" title="页面实例的常用方法："></a>页面实例的常用方法：</h4><ul>
<li>has_next()——是否还有下一页</li>
<li>has_previous()——是否还有上一页</li>
<li>has_other_pages()——是否还有其他页（上/下一页）</li>
<li>next_page_number()——下一页的页码，如果没有，触发InvalidPage异常</li>
<li>previous_page_number()——上一页的页码，如果没有，触发InvalidPage异常</li>
</ul>
<p>Django 3.2 智能分页 <code>get_elided_page_range</code><br>接收3个参数，<br><code>number</code>为当前页码数,<br><code>on_each_side</code>为当前页码左右两边的页数<br><code>on_ends</code>为首尾页码范围。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Paginator.get_elided_page_range(number, on_each_side=<span class="number">3</span>, on_ends=<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>如果当前页码为第10页，使用该方法将输出如下页码范围(page_range)。<br>10左右两边各有3页，首尾各有2页，其余页码号码用…代替。<br>将<code>page_range</code>这个变量传递到前端模板进行遍历即可实现智能分页。<br><code>[1, 2, '…', 7, 8, 9, 10, 11, 12, 13, '…', 49, 50]</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">house_filter</span>(<span class="params">request</span>):</span></span><br><span class="line">    qs = House.objects.all()</span><br><span class="line">    paginator = Paginator(qs, <span class="number">1</span>)  <span class="comment"># 每页1条记录</span></span><br><span class="line">    page = request.GET.get(<span class="string">'page'</span>, <span class="number">1</span>)  <span class="comment"># 获取当前page页码，默认为1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        page_obj = paginator.page(page)  <span class="comment"># 分页</span></span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">        page_obj = paginator.page(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> EmptyPage:</span><br><span class="line">        page_obj = paginator.page(paginator.num_pages)</span><br><span class="line">    is_paginated = <span class="literal">True</span> <span class="keyword">if</span> paginator.num_pages &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 注意下面一行, 获取智能页码范围，并传递给模板</span></span><br><span class="line">    page_range = paginator.get_elided_page_range(page, on_each_side=<span class="number">3</span>, on_ends=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    context = {<span class="string">'page_obj'</span>: page_obj, <span class="string">'paginator'</span>: paginator,</span><br><span class="line">               <span class="string">'is_paginated'</span>: is_paginated, <span class="string">'page_range'</span>: page_range}</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'house/house_index.html'</span>, context)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Django 3.2之前 --&gt;</span></span><br><span class="line"> {% for i in page_obj.paginator.page_range %}</span><br><span class="line"><span class="comment">&lt;!-- Django 3.2之后 --&gt;</span></span><br><span class="line"> {% for i in page_range %}</span><br></pre></td></tr></tbody></table></figure>

<h5 id="按字段查找可以用的条件的使用"><a href="#按字段查找可以用的条件的使用" class="headerlink" title="按字段查找可以用的条件的使用"></a>按字段查找可以用的条件的使用</h5><p>查询语法：<br>字段名称__查询条件 = “查询内容” 注意是双下划线<br>    相等/等于</p>
<ol>
<li><code>exact</code> / <code>iexact</code>：精确匹配/忽略大小写的精确匹配查询 等于xx值（默认的形式）</li>
</ol>
<p>如：id_exact=6 或者 id=6<br>如：name_iexact=’zhangsan’<br>    # name LIKE ‘zhangsan’<br>    </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">        WeiboUser.objects.filter(username__iexact=<span class="string">'gan'</span>)</span><br><span class="line">    `</span><br><span class="line"><span class="number">2.</span> `contains` / `icontains` / `startswith` / `istartswith` / `endswith` / `iendswith`：基于`like`的模糊查询</span><br><span class="line"></span><br><span class="line">    是否包含xx字符串</span><br><span class="line">contains, icontains——包含xx值</span><br><span class="line">如：name__contains= ‘san’</span><br><span class="line">    以xx开始</span><br><span class="line">startswith、istartswith</span><br><span class="line">    以xx结束</span><br><span class="line">endswith、iendswith</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> `<span class="keyword">in</span>` ：集合运算</span><br><span class="line">    xx选项__in[列表]或（元组）</span><br><span class="line">status__in=(<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> `gt` / `gte` / `lt` / `lte`：大于/大于等于/小于/小于等于关系运算</span><br><span class="line">`isnull`：查询空值（<span class="literal">True</span>）或非空值（<span class="literal">False</span>）</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> `range`：指定范围查询（SQL中的`between…<span class="keyword">and</span>…`）</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>  查询时间日期</span><br><span class="line">date 查询条件</span><br><span class="line">`date`/`datetime`——日期</span><br><span class="line">`year`——年</span><br><span class="line">`month`——月份</span><br><span class="line">`day`——天</span><br><span class="line">`hour`/`minute`/`second`——时分秒</span><br><span class="line">`week`/`week_day`——星期</span><br><span class="line"></span><br><span class="line">`range`：指定范围查询（SQL中的`between…<span class="keyword">and</span>…`）</span><br><span class="line">`search`：基于全文索引的全文检索（一般很少使用）</span><br><span class="line">`regex` / `iregex`：基于正则表达式的模糊匹配查询</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">外键关联查询</span><br><span class="line">查询条件是外键的某个属性（字段）</span><br><span class="line"></span><br><span class="line">```Python</span><br><span class="line">    <span class="comment"># 查询外键关联表字段包含'xx'的在本表数据</span></span><br><span class="line">    model.objects.filter(model__column__icontains=<span class="string">'xx'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>手动添加微博及评论，然后举例外键关联查询：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> weibo.models <span class="keyword">import</span> WeiboUser <span class="keyword">as</span> User</span><br><span class="line">user = User.objects.get(pk=<span class="number">4</span>)</span><br><span class="line">user</span><br><span class="line">Out[<span class="number">4</span>]: &lt;WeiboUser: User:zhangsan pk:<span class="number">4</span>,nickname:zhangsan status:<span class="number">1</span>&gt;</span><br><span class="line"><span class="keyword">from</span> weibo.models <span class="keyword">import</span> Weibo</span><br><span class="line"> weibo = Weibo.objects.create(user=user,content=<span class="string">'微博内容'</span>)</span><br><span class="line">weibo.pk</span><br><span class="line">Out[<span class="number">8</span>]: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> weibo.models <span class="keyword">import</span> Comment</span><br><span class="line">Comment.objects.create(user=user,weibo=weibo,content=<span class="string">'zhangsan 评论'</span>)</span><br><span class="line">Out[<span class="number">10</span>]: &lt;Comment: Comment object&gt;</span><br><span class="line">Comment.objects.create(user=user,weibo=weibo,content=<span class="string">'zhangsan 评论2'</span>)</span><br><span class="line">Out[<span class="number">11</span>]: &lt;Comment: Comment object&gt;</span><br><span class="line">lisi = User.objects.get(pk=<span class="number">5</span>)</span><br><span class="line">Comment.objects.create(user=lisi,weibo=weibo,content=<span class="string">'lisi评论'</span>)</span><br><span class="line">Out[<span class="number">13</span>]: &lt;Comment: Comment object&gt;</span><br><span class="line">Comment.objects.create(user=lisi,weibo=weibo,content=<span class="string">'lisi评论2'</span>)</span><br><span class="line">Out[<span class="number">14</span>]: &lt;Comment: Comment object&gt;</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django/" class="post-title-link" itemprop="url">django</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-12 13:21:28" itemprop="dateModified" datetime="2021-06-12T13:21:28Z">2021-06-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Django</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py // 查看相关命令</span><br></pre></td></tr></tbody></table></figure>

<p>路由规则</p>
<ul>
<li>/index/</li>
<li>/index/\d+</li>
<li>/index/(\d+)</li>
<li>/index/?P&lt;name(\d+)&gt;</li>
<li>include</li>
<li>反向生成url<ul>
<li><code>{% url "" %}</code></li>
<li>reverse(‘a1’,args = (1,2,3))<br>url和path的区别</li>
</ul>
</li>
</ul>
<p>• Django2.x中的<code>path</code>不支持正则匹配 但在同一目录下的re_path与Django1.x中的url功能大部分相同可以替代url。</p>
<p>使用到正则匹配路径<code>(^$)</code>的时候，就需要使用<code>re_path</code>,而不能使用<code>path</code>，不然页面会显示404错误，<br>如果未用到正则，那么使用<code>path</code>即可。</p>
<p>re_path(route, view, kwargs=None, name=None)¶<br>Returns an element for inclusion in urlpatterns. For example:</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, re_path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r'^index/$'</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">    re_path(<span class="string">r'^bio/(?P&lt;username&gt;\w+)/$'</span>, views.bio, name=<span class="string">'bio'</span>),</span><br><span class="line">    re_path(<span class="string">r'^weblog/'</span>, include(<span class="string">'blog.urls'</span>)),</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django 2.x</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"><span class="comment"># django1.x</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br></pre></td></tr></tbody></table></figure>

<p>• 路由传参</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django 2.x</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'order/&lt;int:page&gt;'</span>, UserOrderView.as_view(), name=<span class="string">'order'</span>),</span><br><span class="line">    path(<span class="string">'index/'</span>, views.index, name=<span class="string">'main-view'</span>),</span><br><span class="line">    path(<span class="string">'bio/&lt;username&gt;/'</span>, views.bio, name=<span class="string">'bio'</span>),</span><br><span class="line">    path(<span class="string">'articles/&lt;slug:title&gt;/'</span>, views.article, name=<span class="string">'article-detail'</span>),</span><br><span class="line">    path(<span class="string">'articles/&lt;slug:title&gt;/&lt;int:section&gt;/'</span>, views.section, name=<span class="string">'article-section'</span>),</span><br><span class="line">    path(<span class="string">'weblog/'</span>, include(<span class="string">'blog.urls'</span>)),</span><br><span class="line">]</span><br><span class="line">------------------------------------------------------------------</span><br><span class="line"><span class="comment"># django 1.x</span></span><br><span class="line">urlpatterns=[</span><br><span class="line">    url(<span class="string">r'^order/(?P&lt;page&gt;[0-9]+)$'</span>,UserOrderView.as_view(), name=<span class="string">'order'</span>)</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>• include()函数区别</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2.x 需要指定两个参数，第二个参数为所在的app名称，不然会报错</span></span><br><span class="line">path(<span class="string">'search/'</span>, include((<span class="string">'haystack.urls'</span>, <span class="string">'haystack'</span>))),</span><br><span class="line">---------------------------------------------------------</span><br><span class="line">url(<span class="string">'search/'</span>, include(<span class="string">'haystack.urls'</span>)),</span><br></pre></td></tr></tbody></table></figure>



<p>视图函数<br>    请求相关<br>    响应相关</p>
<p>模板语言<br>    if for<br>    索引<br>    执行：不加括号自动执行函数</p>
<pre><code>filter和simple_tag
</code></pre>
<p>ORM操作<br>    创建表<br>        类  继承 models.Model<br>        字段 Inter Char Foreign MantToMany<br>    操作表<br>        增<br>        删<br>        改<br>        查<br>    补充：<br>        fliter传参：<br>            a=1,b=2<br>            **{}<br>            Q()|Q()<br>         values:<br>         values_list:</p>
<pre><code>     all/values/values_list:
     
 双下划线跨表查询:
        正向：
        反向：
</code></pre>
<p>Django的生命周期：</p>
<p>wsgi协议：web服务网关接口</p>
<pre><code>模块：wsgiref  uwsgi
</code></pre>
<p>路由系统：<br>    /index/  views.func<br>    /index/\d+  views.func<br>    /index/  views.include()</p>
<p>视图函数：<br>    FBV function based view<br>    CBV class based view</p>
<p>ORM<br>    models &lt;=&gt; sql</p>
<p>template<br>    html/css  渲染</p>
<p>渲染工作在Django中执行完毕之后，字符串返回给浏览器。</p>
<p>遇到js /css等再发一次请求，不会渲染，仅返回静态文件。</p>
<p>影响自动生成数据库时间字段；<br><code>USE_TZ=True</code>，创建UTC时间写入到数据库。<br><code>USE_TZ=False</code>，根据TIME_ZONE设置的时区进行创建时间并写入数据库</p>
<p>USE_I18N=True</p>
<p>创建你自己的配置文件¶<br>没有什么可以阻止你为你的的 Django 应用创建自己的配置，但请遵循以下原则：<br>所有配置项名称都应<strong>大写</strong>。<br>不要重新设置已存在的配置项。<br>由于配置文件是序列化的，Django 使用列表，但仅是约定俗成。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django-mo-xing-zi-duan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django-mo-xing-zi-duan/" class="post-title-link" itemprop="url">django模型字段</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-24 09:16:36" itemprop="dateModified" datetime="2021-06-24T09:16:36Z">2021-06-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><p>正确的为模型和关系字段命名。</p>
</li>
<li><p>用<code>OneToOneField</code>代替<code>ForeignKeyField(unique=True)</code>。</p>
</li>
<li><p>通过“迁移操作”（migrate）来添加模型。</p>
</li>
<li><p>用NoSQL来应对需要降低范式级别的场景。</p>
</li>
<li><p>如果布尔类型可以为空要使用<code>NullBooleanField</code>。</p>
</li>
<li><p>在模型中放置业务逻辑。</p>
</li>
<li><p>用<code>&lt;ModelName&gt;.DoesNotExists</code>取代<code>ObjectDoesNotExists</code>。</p>
</li>
<li><p>在数据库中不要出现无效数据。</p>
</li>
<li><p>用<code>DecimalField</code>来存储货币相关数据而不是<code>FloatField</code>。</p>
</li>
</ol>
<ol start="13">
<li>定义<code>__str__</code>魔法方法。对类进行<code>print</code>打印的时候，程序会自动调用<code>__str__</code>函数，将对象以 str 的方式来指定的字段。<br>我们为<code>Subject</code>类添加<code>__str__</code>魔法方法，并在该方法中返回学科名字。<br>调用这个类的查看老师的页面上显示老师所属学科时，就不再是<code>Subject object(1)</code>类名 object的信息，而是学科的名称。</li>
</ol>
<p>将你实例化的对象的名称变为__str__返回的字符串进行显示，方便查看和理解(字符串的格式自己编写，具体取决于你想看到什么样的结果)<br>修改模型中每个对象的名字，修改后台的表单项的显示名字</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不上__str__</span></span><br><span class="line">qs =model.Class_name.object.all()</span><br><span class="line">print(qs)</span><br><span class="line"><span class="comment"># 加上__str__</span></span><br><span class="line">qs =model.Class_name.object.all()</span><br><span class="line">print(qs)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModel</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name=<span class="string">''</span>, age=<span class="number">0</span>, score=<span class="number">0</span>, id=<span class="number">0</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.score = score</span><br><span class="line">        self.id = id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">"学生"</span>  <span class="comment"># 定义表名应用名_表名_类名驼峰用下划线拆开</span></span><br><span class="line">        verbose_name = <span class="string">'学生'</span>  <span class="comment"># 这个verbose_name是在管理后台显示的名称</span></span><br><span class="line">        verbose_name_plural = verbose_name  <span class="comment"># 定义复数时的名称（去除复数的s）</span></span><br><span class="line">        ordering = [<span class="string">'id'</span>]  <span class="comment"># 排序</span></span><br><span class="line">        unique_together = ((<span class="string">"first_name"</span>, <span class="string">"last_name"</span>),)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调用时返回自身的属性，不然都是显示xx object</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'编号：%d,姓名：%s'</span> % (self.id, self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s01 = StudentModel(<span class="string">'哪吒'</span>, <span class="number">3000</span>, <span class="number">59</span>, <span class="number">1</span>)</span><br><span class="line">print(s01)  <span class="comment"># 编号：1，姓名：哪吒</span></span><br></pre></td></tr></tbody></table></figure>


<ol start="14">
<li>不要将数据文件放在同一个目录中。</li>
</ol>
<blockquote>
<p><strong>说明</strong>：以上内容来自于STEELKIWI网站的<a target="_blank" rel="noopener" href="https://steelkiwi.com/blog/best-practices-working-django-models-python/"><em>Best Practice working with Django models in Python</em></a>，有兴趣的小伙伴可以阅读原文。</p>
</blockquote>
<h4 id="模型定义参考"><a href="#模型定义参考" class="headerlink" title="模型定义参考"></a>模型定义参考</h4><h5 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h5><p>对字段名称的限制</p>
<ul>
<li>字段名不能是Python的保留字，否则会导致语法错误</li>
<li>字段名不能有多个连续下划线，否则影响ORM查询操作</li>
</ul>
<p>Django模型字段类</p>
<table>
<thead>
<tr>
<th>字段类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>AutoField</code></td>
<td>自增ID字段</td>
</tr>
<tr>
<td><code>BigIntegerField</code></td>
<td>64位有符号整数</td>
</tr>
<tr>
<td><code>BinaryField</code></td>
<td>存储二进制数据的字段，对应Python的<code>bytes</code>类型</td>
</tr>
<tr>
<td><code>BooleanField</code></td>
<td>存储<code>True</code>或<code>False</code></td>
</tr>
<tr>
<td><code>CharField</code></td>
<td>长度较小的字符串，属性<code>max_length</code>=30里的30在mysql以前版本表示字节数，现在新版表示字符数，不论中文还是英文还是标点最多只能有30个　　度</td>
</tr>
<tr>
<td><code>DateField</code></td>
<td>存储日期，属性有<code>auto_now</code> 更新时间为记录更改时的时间，每次数据更新时更新。<code>auto_now_add</code>  记录创建的时间 之后便不再改变</td>
</tr>
<tr>
<td><code>DateTimeField</code></td>
<td>存储日期和日期 时间，两个附加属性同上</td>
</tr>
<tr>
<td><code>DecimalField</code></td>
<td>存储固定精度小数，有<code>max_digits</code>（有效位数）和<code>decimal_places</code>（小数点后面）两个必要的参数</td>
</tr>
<tr>
<td><code>DurationField</code></td>
<td>存储时间跨度</td>
</tr>
<tr>
<td><code>EmailField</code></td>
<td>邮件输入，与<code>CharField</code>相同，可以用<code>EmailValidator</code>验证</td>
</tr>
<tr>
<td><code>FileField</code></td>
<td>文件上传字段，验证上传的对象是不是有效</td>
</tr>
<tr>
<td><code>FielPathField</code></td>
<td>文件文件路径，验证上传的对象是不是有效</td>
</tr>
<tr>
<td><code>FloatField</code></td>
<td>存储浮点数</td>
</tr>
<tr>
<td><code>ImageField</code></td>
<td>其他同<code>FileFiled</code>，要验证上传的对象是不是有效图像</td>
</tr>
<tr>
<td><code>IntegerField</code></td>
<td>存储32位有符号整数。</td>
</tr>
<tr>
<td><code>GenericIPAddressField</code></td>
<td>存储IPv4或IPv6地址</td>
</tr>
<tr>
<td><code>NullBooleanField</code></td>
<td>存储<code>True</code>、<code>False</code>或<code>null</code>值</td>
</tr>
<tr>
<td><code>PositiveIntegerField</code></td>
<td>存储无符号整数（只能存储正数）</td>
</tr>
<tr>
<td><code>SlugField</code></td>
<td>存储slug（简短标注）</td>
</tr>
<tr>
<td><code>SmallIntegerField</code></td>
<td>存储16位有符号整数</td>
</tr>
<tr>
<td><code>TextField</code></td>
<td>存储数据量较大的文本</td>
</tr>
<tr>
<td><code>TimeField</code></td>
<td>存储时间</td>
</tr>
<tr>
<td><code>URLField</code></td>
<td>存储URL的<code>CharField</code></td>
</tr>
<tr>
<td><code>UUIDField</code></td>
<td>存储全局唯一标识符</td>
</tr>
</tbody></table>
<p><code>update_or_create()</code> 和 <code>save()</code> 方法也会更新。因为这两个方法都是走的 Django ORM。<br>而更适用于批量操作的 <code>update()</code> 方法则是直接执行数据库 SQL，不走 Django ORM，所以 <code>update_time</code> 也就得不到更新。那要想更新怎么办呢？手动给 update_time 赋值。</p>
<h5 id="字段属性"><a href="#字段属性" class="headerlink" title="字段属性"></a>字段属性</h5><p>数据库字段和ORM模型对应，是用field对应，field是一个基础的类，有很多很多子类<br>通用字段属性</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>null</code></td>
<td>数据库中对应的字段是否允许为<code>NULL</code>，默认为<code>False</code>，如果为True，表示允许为空，null是什么都没填</td>
</tr>
<tr>
<td><code>blank</code></td>
<td>后台模型管理验证数据时，是否允许为<code>NULL</code>，默认为<code>False</code> 如果为True，则该字段允许为空⽩空字符串</td>
</tr>
<tr>
<td><code>choices</code></td>
<td>设定字段的选项，各元组中的第一个值是设置在模型上的值，第二值是人类可读的值，可供选择的选项，如：性别的选项（男，女）</td>
</tr>
<tr>
<td><code>db_column</code></td>
<td>字段对应到数据库表中的列名，未指定时直接使用字段的名称</td>
</tr>
<tr>
<td><code>db_index</code></td>
<td>设置为<code>True</code>时将在该字段创建索引</td>
</tr>
<tr>
<td><code>db_tablespace</code></td>
<td>为有索引的字段设置使用的表空间，默认为<code>DEFAULT_INDEX_TABLESPACE</code></td>
</tr>
<tr>
<td><code>default</code></td>
<td>字段的默认值</td>
</tr>
<tr>
<td><code>editable</code></td>
<td>字段在后台模型管理或<code>ModelForm</code>中是否显示，默认为<code>True</code></td>
</tr>
<tr>
<td><code>error_messages</code></td>
<td>设定字段抛出异常时的默认消息的字典，其中的键包括<code>null</code>、<code>blank</code>、<code>invalid</code>、<code>invalid_choice</code>、<code>unique</code>和<code>unique_for_date</code></td>
</tr>
<tr>
<td><code>help_text</code></td>
<td>表单小组件旁边显示的额外的帮助文本，api文档对应字段的Description</td>
</tr>
<tr>
<td><code>primary_key</code></td>
<td>将字段指定为模型的主键，未指定时会自动添加<code>AutoField</code>用于主键，只读。若为True，则该字段会成为模型的主键字段，默认值是False</td>
</tr>
<tr>
<td><code>unique</code></td>
<td>设置为<code>True</code>时，表中字段的值必须是唯一的</td>
</tr>
<tr>
<td><code>verbose_name</code></td>
<td>字段在后台模型管理显示的名称，未指定时使用字段的名称 增加页面时显示的名称</td>
</tr>
</tbody></table>
<p>unique——唯一索引<br><code>get_FOO_display()</code>——展示choices对应的值</p>
<p>数据关系的几种类型<br>OneToOneField = ForeignKey(…，unique=True)设置一对一关系</p>
<p>SQL FOREIGN KEY 一个表中的 FOREIGN KEY 指向另一个表中的 UNIQUE KEY(唯一约束的键)<br>若有模型类存在外键，创建数据时，要先创建外键关联的模型类的数据，<br>不然创建包含外键的模型类的数据时，外键的关联模型类的数据会找不到。</p>
<p><code>ForeignKey</code>属性</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForeignKey</span>(<span class="params">ForeignObject</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Provide a many-to-one relation by adding a column to the local model</span></span><br><span class="line"><span class="string">    to hold the remote value.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    By default ForeignKey will target the pk of the remote model but this</span></span><br><span class="line"><span class="string">    behavior can be changed by using the ``to_field`` argument.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    descriptor_class = ForeignKeyDeferredAttribute</span><br><span class="line">    <span class="comment"># Field flags</span></span><br><span class="line">    many_to_many = <span class="literal">False</span></span><br><span class="line">    many_to_one = <span class="literal">True</span></span><br><span class="line">    one_to_many = <span class="literal">False</span></span><br><span class="line">    one_to_one = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    rel_class = ManyToOneRel</span><br><span class="line"></span><br><span class="line">    empty_strings_allowed = <span class="literal">False</span></span><br><span class="line">    default_error_messages = {</span><br><span class="line">        <span class="string">'invalid'</span>: _(<span class="string">'%(model)s instance with %(field)s %(value)r does not exist.'</span>)</span><br><span class="line">    }</span><br><span class="line">    description = _(<span class="string">"Foreign Key (type determined by related field)"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, to, on_delete, related_name=None, related_query_name=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 limit_choices_to=None, parent_link=False, to_field=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 db_constraint=True, **kwargs</span>):</span></span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><p><code>to</code>：此外键默认绑定到模型的id主键，模型虽然没有定义，迁入数据库会默认生成id字段</p>
</li>
<li><p><code>limit_choices_to</code>：值是一个Q对象或返回一个Q对象，用于限制后台显示哪些对象。</p>
</li>
<li><p><code>related_name</code>：用于获取关联对象的关联管理器对象，指定反向查询属性的名字。通过父类别可以通过该属性查询子类别<br>如果不希望执行反向查询可以将<code>related_name</code>属性设置为<code>'+'</code>或者以<code>'+'</code>开头的字符串，，或者以<code>'+'</code>结尾，可以防止一对多外键关联从“一”的一方查询“多”的一方。</p>
</li>
<li><p><code>to_field</code>：指定关联的字段，默认关联对象的主键字段。</p>
</li>
<li><p><code>db_constraint</code>：是否为外键创建约束，默认值为<code>True</code>。（提升性能或者数据分片的情况可能需要设置为<code>False</code>）</p>
</li>
<li><p><code>on_delete</code>：外键关联的对象被删除时对应的动作，可取的值包括<code>django.db.models</code>中定义的：</p>
<ul>
<li><code>CASCADE</code>：级联删除。默认的选项，无需显性指定它。</li>
<li><code>PROTECT</code>：抛出<code>ProtectedError</code>异常，阻止删除引用的对象。</li>
<li><code>SET_NULL</code>：把外键设置为<code>null</code>，当定义该字段的时候，允许为空<code>null=True</code>时才能这么做，。</li>
<li><code>SET_DEFAULT</code>：把外键设置为默认值，定义外键的时候注意提供了默认值才能这么做。</li>
<li><code>SET()</code>: 自定义一个值，该值当然只能是对应的实体了</li>
</ul>
</li>
</ol>
<p><code>ManyToManyField</code>属性</p>
<ol>
<li><code>to</code>：</li>
<li><code>symmetrical</code>：是否建立对称的多对多关系。</li>
<li><code>through</code>：指定维持多对多关系的中间表的Django模型。</li>
<li><code>throughfields</code>：定义了中间模型时可以指定建立多对多关系的字段。</li>
<li><code>db_table</code>：指定维持多对多关系的中间表的表名。</li>
</ol>
<p>多对多数据插入</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    age = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    A_name = models.ManyToManyField(to=A)</span><br><span class="line"> </span><br><span class="line">data = A.object.get(id = <span class="number">1</span>) <span class="comment"># 根据id或其他字段从A表中拿出我们希望得到的项</span></span><br><span class="line">b = B()</span><br><span class="line">b.age = <span class="number">1</span></span><br><span class="line">b.save()  <span class="comment"># 必须先保存其他值</span></span><br><span class="line">b.A_name.add(data)  <span class="comment"># 将B表中的多对多字段绑到我们A中拿到的项就行了</span></span><br></pre></td></tr></tbody></table></figure>


<h5 id="模型元数据选项和描述"><a href="#模型元数据选项和描述" class="headerlink" title="模型元数据选项和描述"></a>模型元数据选项和描述</h5><p>使用<code>Meta</code>类来表示，在定义好的模型类里面定义一个内部类，定义一些 Django 模型类的行为特性和补充说明<br>| 选项                    | 说明                                                         |<br>| ———————– | ———————————————————— |<br>| <code>abstract</code>              | 设置为True时模型是抽象父类 (抽象类不会生成相应数据表)，其他子类需要继承自这个公共类的字段部分   |<br>| <code>app_label</code>             | 如果定义模型的应用不在INSTALLED_APPS中可以用该属性指定，你的模型类不在默认的应用程序包下的 <code>models.py</code> 文件里。这时候你须要指定你这个模型类是那个应用程序的。比方你在其它地方写了一个模型类，而这个模型类是属于myapp 的，那么你这是须要指定 <code>app_label='myapp'</code>  |<br>| <code>db_table</code>              | 模型使用映射的数据表名称，指定自己定义数据库表名的。                                      |<br>| <code>db_tablespace</code>         | 模型使用的数据表空间                                         |<br>| <code>default_related_name</code>  | 关联对象回指这个模型时默认使用的名称，默认为<model_name>_set |<br>| <code>get_latest_by</code>         | 模型中可排序字段的名称。                                     |<br>| <code>managed</code>               | 设置为True时，Django在迁移中创建数据表并在执行flush管理命令时把表移除 |<br>| <code>order_with_respect_to</code> | 标记对象为可排序的                                           |<br>| <code>ordering</code>              | 对象的默认排序，指定数据表的默认排序规则                                               |<br>| <code>permissions</code>           | 创建对象时写入权限表的额外权限                               |<br>| <code>default_permissions</code>   | 默认为<code>('add', 'change', 'delete')</code>                          |<br>| <code>unique_together</code>       | 设定组合在一起时必须唯一 的字段名                         |<br>| <code>index_together</code>        | 设定一起建立索引的多个字段名                                 |<br>| <code>verbose_name</code>          | 为对象设定人类可读的名称                           |<br>| <code>verbose_name_plural</code>   | 设定对象的复数名称                                           |<br>| <code>proxy</code>   | 代理模型(对父模型的功能进行扩充) |</model_name></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/docker/" class="post-title-link" itemprop="url">docker</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-25 03:41:28" itemprop="dateModified" datetime="2021-06-25T03:41:28Z">2021-06-25</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Docker<br>Docker是一个容器化的平台，他将应用程序和所需要的依赖打包在一个容器里面，在其他的环境下 ，拿上镜像就可以运行，<br>学习docker就是，学习在docker中安装依赖和将项目部署到docker中。</p>
<p>Docker架构是什么<br>Docker deamon  ： docker的守护进程<br>Client  ：         docker的客户端<br>Images ：   docker的镜像<br>Container   ：  docker的容器<br>Registry：      docker的仓库</p>
<p>linux安装</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># docker -v</span></span><br><span class="line">Docker version 20.10.7, build f0df350</span><br></pre></td></tr></tbody></table></figure>


<p>设置开机启动docker</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># systemctl enable docker  # 设置开机启动</span></span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># systemctl start docker  # 启动服务</span></span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># ps -ef |grep docker</span></span><br><span class="line">root      3699     1  2 23:17 ?        00:00:00 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">root      3840  1544  0 23:17 pts/5    00:00:00 grep --color=auto docker</span><br><span class="line">[</span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS                      PORTS                                                                   NAMES</span><br><span class="line">000e44fb8450   rabbitmq:management             <span class="string">"docker-entrypoint.s…"</span>   16 minutes ago   Created                                                                                             rabbitmq</span><br><span class="line">bd592bce48b8   styletang/rocketmq-console-ng   <span class="string">"sh -c 'java <span class="variable">$JAVA_O</span>…"</span>   2 weeks ago      Up 2 weeks                  0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcp                               rmqconsole</span><br><span class="line">01a559d554f8   foxiswho/rocketmq:broker        <span class="string">"mqbroker -c /etc/ro…"</span>   2 weeks ago      Exited (137) 23 hours ago                                                                           rmqbroker</span><br><span class="line">bff14878447c   foxiswho/rocketmq:server        <span class="string">"/bin/sh -c 'cd <span class="variable">${RO…"   2 weeks ago      Up 2 weeks                  10909/tcp, 0.0.0.0:9876-&gt;9876/tcp, :::9876-&gt;9876/tcp, 10911-10912/tcp   rmqnamesrv</span></span></span><br><span class="line"><span class="string"><span class="variable">a7df53a51485   mysql:5.7                       "docker-entrypoint.s…"   2 weeks ago      Up 2 weeks                  0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp                    mymysql</span></span></span><br></pre></td></tr></tbody></table></figure>

<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/1207/45596">使用腾讯云 Docker 镜像源加速镜像下载</a></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># docker-compose -v</span></span><br><span class="line">docker-compose version 1.29.2, build 5becea4c</span><br></pre></td></tr></tbody></table></figure>

<p>如果本机linux的mysql启动会占用3306，先关掉，才能启动docker mysql</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># netstat -tanlp</span></span><br><span class="line">    ESTABLISHED 1097/YDService      </span><br><span class="line">tcp6       0      0 :::33060                :::*                    LISTEN      25791/mysqld        </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      25791/mysqld        </span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># kill 25791</span></span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># netstat -tanlp</span></span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># docker run -p 3306:3306 --name mymysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span></span><br><span class="line">a7df53a51485060228adcf9b7b307f1c63aa1f6de8266ee798b3b3a376af0fc6</span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># docker ps -aCONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                                                  NAMES</span></span><br><span class="line">a7df53a51485   mysql:5.7   <span class="string">"docker-entrypoint.s…"</span>   35 seconds ago   Up 35 seconds   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mymysql</span><br></pre></td></tr></tbody></table></figure>

<p>-p 3306:3306：将容器的 3306 端口映射到主机的 3306 端口。</p>
<p>-v -v $PWD/conf:/etc/mysql/conf.d：将主机当前目录下的 conf/my.cnf 挂载到容器的 /etc/mysql/my.cnf。</p>
<p>-v $PWD/logs:/logs：将主机当前目录下的 logs 目录挂载到容器的 /logs。</p>
<p>-v $PWD/data:/var/lib/mysql ：将主机当前目录下的data目录挂载到容器的 /var/lib/mysql 。</p>
<p>-e MYSQL_ROOT_PASSWORD=123456：初始化 root 用户的密码。</p>
<h3 id="容器配置"><a href="#容器配置" class="headerlink" title="容器配置"></a>容器配置</h3><p>由于mysql的安全策略，现在还不能使用root/123456来访问数据库</p>
<ol>
<li>进入容器<br>docker ps [options]  查看docker容器进程信息：<br>通过<code>docker ps -a</code>来查看mysql的容器id，status 为 up</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it a7df53a51485 /bin/bash</span><br></pre></td></tr></tbody></table></figure>
<p> 进入mysql</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123456</span><br></pre></td></tr></tbody></table></figure>

<p>建立用户并授权</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">'root'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'root'</span> WITH GRANT OPTION;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">'root'</span>@<span class="string">'127.0.0.1'</span> IDENTIFIED BY <span class="string">'root'</span> WITH GRANT OPTION;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'root'</span> WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure>

<p>密码为root</p>
<p>Docker镜像的常用的命令：<br><code>docker images</code>：  列出已经下载的镜像</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                      TAG          IMAGE ID       CREATED         SIZE</span><br><span class="line">rabbitmq                        management   94fae7da05d6   5 days ago      226MB</span><br><span class="line">mysql                           5.7          2c9028880e58   5 weeks ago     447MB</span><br><span class="line">hello-world                     latest       d1165f221234   3 months ago    13.3kB</span><br><span class="line">foxiswho/rocketmq               broker       2f4ee5914ff4   21 months ago   489MB</span><br><span class="line">foxiswho/rocketmq               server       16680398c098   21 months ago   489MB</span><br><span class="line">styletang/rocketmq-console-ng   latest       7df83bb6e638   3 years ago     702MB</span><br></pre></td></tr></tbody></table></figure>

<p>docker  search 镜像名字：tag     ：  搜索这个镜像</p>
<p>docker  pull  镜像名称:tag        拉取镜像<br>docker  rmi   镜像名称:tag         删除镜像<br>docker rmi <your-image-id>  删除镜像</your-image-id></p>
<p>docker 容器常用的命令：<br>创建容器<br>docker create -p 3306:3306 –name suiyi -e MYSQL_ROOT_PASSWORD=smallming mysql:5.7<br>新建并且启动<br>docker run -p 3306:3306 –name mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7 </p>
<p>列出正在运行的容器： docker container ls</p>
<p>docker exec [options] 容器ID [command]</p>
<p>进入 mysql 客户端<br>docker exec -it mysql /bin/bash</p>
<p>进入 Redis 客户端<br>docker exec -it b9e507a86439 redis-cli<br>其中 b9e507a86439 是我 Docker 中的 Redis 容器 ID，使用 docker ps 即可查看自己容器中的 Redis ID</p>
<p>5    停止容器<br>docker stop 容器ID<br>docker stop mysql<br>6    启动容器<br>docker start 容器ID<br>docker start mysql<br>7    强制停止容器<br>不推荐使用，容易造成容器服务不正常关闭，影响后续使用。<br>docker kill 容器ID<br>docker kill mysql<br>8    删除容器<br>要删除的容器，必须是关闭状态的。<br>docker rm 容器ID<br>docker rm mysql<br>9    查看容器日志<br>docker logs -f -t –tail 行数 容器ID<br>docker logs -f -t –tail 5 mysql<br>10    查看容器中运行的进程<br>可以知道容器中到底运行的是哪个应用程序。<br>docker top 容器ID<br>docker top mysql<br>11    查看容器内部详情<br>docker inspect 容器ID<br>docker inspect mysql<br>12    复制容器数据到宿主机<br>docker cp 容器ID:容器内路径 宿主机路径<br>复制MySQL配置到宿主机：  docker cp mysql:/etc/mysql ~/tmp/conf    </p>
<p>WARNING: IPv4 forwarding is disabled. Networking will not work.</p>
<p>在宿主机上执行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/sys/net/ipv4/ip_forward</span></span><br><span class="line">net.ipv4.ip_forward = 0</span><br></pre></td></tr></tbody></table></figure>


<p>vi /etc/sysctl.conf<br>修改net.ipv4.ip_forward的值0改为1：<br>net.ipv4.ip_forward = 1</p>
<p>sysctl -w net.ipv4.ip_forward=1</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]# sysctl net.ipv4.ip_forward</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">[root@VM-0-9-centos ~]# cat /proc/sys/net/ipv4/ip_forward</span><br><span class="line">1</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/doctest-mo-kuai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/doctest-mo-kuai/" class="post-title-link" itemprop="url">doctest模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-14 07:34:57" itemprop="dateModified" datetime="2021-04-14T07:34:57Z">2021-04-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>doctest模块<br>扫描模块并根据程序中内嵌的文档字符串执行测试。<br>测试构造如同简单的将它的输出结果剪切并粘贴到文档字符串中。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```doctest.test_mod```函数从一个模块中读取所有文档字符串，找出所有看起来像是在交互式解释器中输入的例子的文本，之后检查例子是否符合实际要求。</span><br><span class="line">在python代码中寻找类似交互解释器里执行的命令，执行它们并且和这些命令的期望值进行比较。通过用户提供的例子，它强化了文档，允许 doctest 模块确认代码的结果是否与文档一致:</span><br><span class="line">用来验证docstring中的注释和代码实际的作用是一致的</span><br><span class="line">可以作为回归测试来验证代码能够正确执行</span><br><span class="line">可以用来编写模块的文档演示这些模块是如何处理输入得到输出的。</span><br><span class="line"></span><br><span class="line">一般写在函数的docstring里面，较为标准的文档字符串格式，</span><br><span class="line">用```&gt;&gt;&gt;```表示一个用例的开始，&gt;&gt;&gt;后有一个空格，直到遇到```空行```或者下一个```&gt;&gt;&gt;```</span><br><span class="line">```’’’```后的英文文档后有一个空行。</span><br><span class="line"></span><br><span class="line">使用```#doctest: +ELLIPSIS（中文含义省略）```来表示下面的省略号匹配任意内容</span><br><span class="line"></span><br><span class="line">```python sample.py```只打印出错的用例结果</span><br><span class="line">```python sample.py -v``` 将会打印所有测试用例的结果。</span><br><span class="line">pychamr右键 run doctest</span><br><span class="line"></span><br><span class="line">定义如下函数代码square，求一个数的平方，并且在它的文档字符串中添加两个例子，文件名为my_math.py</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line"># my_math.py</span><br><span class="line">import doctest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def square(x):</span><br><span class="line">    '''</span><br><span class="line">    Squares a number and returns the result</span><br><span class="line">    </span><br><span class="line">    &gt;&gt;&gt; square(2)</span><br><span class="line">    4</span><br><span class="line">    &gt;&gt;&gt; square(3)</span><br><span class="line">    9</span><br><span class="line">    '''</span><br><span class="line">    return x * x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    import my_math</span><br><span class="line">    doctest.testmod(my_math)</span><br></pre></td></tr></tbody></table></figure>

<p>在 win或 Linux终端命令行中运行查看测试结果。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# python my_math.py</span><br><span class="line"><span class="meta">#</span><span class="bash"> 没反应，因为符合预期结果，默认只打印出错的用例结果</span></span><br><span class="line">[root@centos ~]# python my_math.py -v</span><br><span class="line">Trying:</span><br><span class="line">    square(2)</span><br><span class="line">Expecting:</span><br><span class="line">    4</span><br><span class="line">ok</span><br><span class="line">Trying:</span><br><span class="line">    square(3)</span><br><span class="line">Expecting:</span><br><span class="line">    9</span><br><span class="line">ok</span><br><span class="line">1 items had no tests:</span><br><span class="line">    my_math</span><br><span class="line">1 items passed all tests:</span><br><span class="line">   2 tests in my_math.square</span><br><span class="line">2 tests in 2 items.</span><br><span class="line">2 passed and 0 failed.</span><br><span class="line">Test passed.</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># python my_math.py</span></span><br><span class="line">**********************************************************************</span><br><span class="line">File <span class="string">"my_math.py"</span>, line 9, <span class="keyword">in</span> __main__.average</span><br><span class="line">Failed example:</span><br><span class="line">    <span class="built_in">print</span>(average([20, 30, 70]))</span><br><span class="line">Expected:</span><br><span class="line">    50.0</span><br><span class="line">Got:</span><br><span class="line">    40.0</span><br><span class="line">**********************************************************************</span><br><span class="line">1 items had failures:</span><br><span class="line">   1 of   2 <span class="keyword">in</span> __main__.average</span><br><span class="line">***Test Failed*** 1 failures.</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># python my_math.py -v</span></span><br><span class="line">Trying:</span><br><span class="line">    <span class="built_in">print</span>(average([20, 30, 70]))</span><br><span class="line">Expecting:</span><br><span class="line">    40.0</span><br><span class="line">ok</span><br><span class="line">Trying:</span><br><span class="line">    <span class="built_in">print</span>(average([20, 30, 70]))</span><br><span class="line">Expecting:</span><br><span class="line">    50.0</span><br><span class="line">**********************************************************************</span><br><span class="line">File <span class="string">"my_math.py"</span>, line 9, <span class="keyword">in</span> __main__.average</span><br><span class="line">Failed example:</span><br><span class="line">    <span class="built_in">print</span>(average([20, 30, 70]))</span><br><span class="line">Expected:</span><br><span class="line">    50.0</span><br><span class="line">Got:</span><br><span class="line">    40.0</span><br><span class="line">1 items had no tests:</span><br><span class="line">    __main__</span><br><span class="line">**********************************************************************</span><br><span class="line">1 items had failures:</span><br><span class="line">   1 of   2 <span class="keyword">in</span> __main__.average</span><br><span class="line">2 tests <span class="keyword">in</span> 2 items.</span><br><span class="line">1 passed and 1 failed.</span><br><span class="line">***Test Failed*** 1 failures.</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="string">""" add two number or string</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add(1, 2)</span></span><br><span class="line"><span class="string">    3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add("hello", " world")</span></span><br><span class="line"><span class="string">    'hello world'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add(1, 2.0)</span></span><br><span class="line"><span class="string">    3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; add("hello", " python")  # doctest: +ELLIPSIS</span></span><br><span class="line"><span class="string">    'hello ...'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> x+y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> doctest</span><br><span class="line">    doctest.testmod()</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# python my<span class="emphasis">_math.py -v</span></span><br><span class="line"><span class="emphasis">Trying:</span></span><br><span class="line"><span class="emphasis">    add(1, 2)</span></span><br><span class="line"><span class="emphasis">Expecting:</span></span><br><span class="line"><span class="emphasis">    3</span></span><br><span class="line"><span class="emphasis">ok</span></span><br><span class="line"><span class="emphasis">Trying:</span></span><br><span class="line"><span class="emphasis">    add("hello", " world")</span></span><br><span class="line"><span class="emphasis">Expecting:</span></span><br><span class="line"><span class="emphasis">    'hello world'</span></span><br><span class="line"><span class="emphasis">ok</span></span><br><span class="line"><span class="emphasis">Trying:</span></span><br><span class="line"><span class="emphasis">    add(1, 2.0)</span></span><br><span class="line"><span class="emphasis">Expecting:</span></span><br><span class="line"><span class="emphasis">    3</span></span><br><span class="line"><span class="emphasis"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">File "my<span class="emphasis">_math.py", line 9, in <span class="strong">__main__</span>.add  </span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">Failed example:</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">    add(1, 2.0)</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">Expected:</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">    3</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">Got:</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">    3.0</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">Trying:</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">    add("hello", " python")  # doctest: +ELLIPSIS</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">Expecting:</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">    'hello ...'</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">ok</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">1 items had no tests:</span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis">    <span class="strong">__main__</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">1 items had failures:</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">   1 of   4 in _<span class="emphasis">_main<span class="strong">__.add</span></span></span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">4 tests in 2 items.</span></span></span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">3 passed and 1 failed.</span></span></span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong">**<span class="emphasis">*Test Failed<span class="strong">**<span class="emphasis">* 1 failures.</span></span></span></span></span></span></span></span></span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
