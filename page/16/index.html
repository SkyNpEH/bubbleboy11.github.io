<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;bubbleboy11.github.io&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/16/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/16/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<script data-pjax src="/js/load-config.js"></script>
  <title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">165</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/mock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/mock/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>mock用来替代你测试应用的某一部分<br>好处<br>1：加快测试速度，如果你的应用是依赖于资源的，mock可以有效减少资源的占用<br>2：避免不必要的副作用</p>
<p>在单元测试进行的同时，就离不开mock模块的存在，初次接触这个概念的时候会有这样的疑问：把要测的东西都模拟掉了还测试什么呢？<br>　　但在，实际生产中的项目是非常复杂的，对其进行单元测试的时候，会遇到以下问题：<br>•接口的依赖<br>•外部接口调用<br>•测试环境非常复杂<br>单元测试应该只针对当前单元进行测试, 所有的内部或外部的依赖应该是稳定的, 已经在别处进行测试过的.使用mock 就可以对外部依赖组件实现进行模拟并且替换掉, 从而使得单元测试将焦点只放在当前的单元功能。<br>在这里插入图片描述<br>因为在为代码进行单元测试的同时，会发现该模块依赖于其他的模块，例如数据库，网络，或者第三方模块的存在，而我们对一个模块进行单元测试的目的，是测试当前模块正常工作，这样就要避开对其他模块的依赖，而mock主要作用便在于，专注于待测试的代码。而在但与测试中，如何灵活的使用mock模块是核心所在。下面便以mock为核心，结合最近所写的代码，阐述mock模块的使用。</p>
<p>这个例子，本来被调用的sum函数要执行很长时间为了加快测试进度，我们使用patch装饰器来直接mock sum函数</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> patch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    time.sleep(<span class="number">100</span>)  <span class="comment"># long running process</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCalculator</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 用patch装饰器来mock对象</span></span><br><span class="line"><span class="meta">    @patch('__main__.sum', return_value=5)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sum</span>(<span class="params">self, sum</span>):</span></span><br><span class="line">        self.assertEqual(sum(<span class="number">2</span>, <span class="number">3</span>), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Ran 1 test in 0.001s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OK</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="7">
<li>mock模块的使用<br>在mock模块中，两个常用的类型为Mock，MagicMock，两个类的关系是MagicMock继承自Mock，最重要的两个属性是return_value, side_effect。<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> mock <span class="keyword">import</span> Mock</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fake_obj = Mock()</span><br><span class="line">&gt;&gt;&gt;fake_obj.return_value = <span class="string">'This is a mock object'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fake_obj()</span><br><span class="line"><span class="string">'This is a mock object'</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>我们通过Mock()可以创建一个mock对象，通过renturn_value 指定它的返回值。即当下文出现fake_obj()会返回其return_value所指定的值。<br>也可以通过side_effect指定它的副作用，这个副作用就是当你调用这个mock对象是会调用的函数,也可以选择抛出一个异常，来对程序的错误状态进行测试。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="function"><span class="keyword">def</span> <span class="title">b</span>():</span></span><br><span class="line"><span class="meta">... </span>   <span class="keyword">print</span> <span class="string">'This is b'</span></span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;fake_obj.side_effect = b</span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line">This <span class="keyword">is</span> b</span><br><span class="line">&gt;&gt;&gt;fake_obj.side_effect = KeyError(<span class="string">'This is b'</span>)</span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line">...</span><br><span class="line">KeyError: <span class="string">'This is b'</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果要模拟一个对象而不是函数，你可以直接在mock对象上添加属性和方法，并且每一个添加的属性都是一个mock对象【注意，这种方式很有用】，也就是说可以对这些属性进行配置,并且可以一直递归的定义下去。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;fake_obj.fake_a.return_value = <span class="string">'This is fake_obj.fake_a'</span></span><br><span class="line">&gt;&gt;&gt;fake_obj.fake_a()</span><br><span class="line"><span class="string">'This is fake_obj.fake_a'</span></span><br></pre></td></tr></tbody></table></figure>
<p>上述代码片段中fake_obj是一个mock对象，而fake_obj.fake_a的这种形式使得fake_a变成了fake_obj的一个属性，作用是在fake_obj.fake_a()调用时会返回其return_value。<br>另外也可以通过为side_effect指定一个列表，这样在每次调用时会依次返回，如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fake_obj = Mock(side_effect = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line"><span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;fake_obj()</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>
<p>7.1 函数的如何mock<br>在rbd_api.py文件中如下内容：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DAO_PoolMgr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkpoolstat</span>(<span class="params">pool_name</span>)</span></span><br><span class="line">  ret， poolstat = DAO_PoolMgr.DAO_query_ispoolok(pool_name)</span><br><span class="line"><span class="keyword">if</span> ret != MGR_COMMON.MONGO_SUCCESS:</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"><span class="keyword">if</span> poolstat <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">    <span class="keyword">return</span> MGR_COMMON.POOL_STAT_ERROR</span><br><span class="line"><span class="keyword">return</span> MGR_COMMON.SUCCESS</span><br></pre></td></tr></tbody></table></figure>

<p>要为这个函数撰写单元测试，因为其有数据库的操作，因而就需要mock 出DAO_query_ispoolok操作。<br>因此，我们在test_rbd_api.py文件中可以这么写：因为DAO_query_ispoolok是类DAO_PoolMgr的操作，因此可以这么写</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> DAO_PoolMgr</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> rbd_api <span class="keyword">as</span> rbdAPI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestAuxiliaryFunction</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.pool_name = <span class="string">"aaa"</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.pool_name = <span class="literal">None</span></span><br><span class="line"><span class="meta">    @mock.patch.object(DAO_PoolMgr, "DAO_query_ispoolok")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_checkpoolstat</span>(<span class="params">self, mock_DAO_query_ispoolok</span>):</span></span><br><span class="line">        mock_DAO_query_ispoolok.return_value = (MGR_COMMON.POOL_STAT_ERROR, <span class="literal">None</span>)</span><br><span class="line">        self.<span class="keyword">assert</span>(rbdAPI.checkpoolstat(self.pool_name), MGR_COMMON.POOL_STAT_ERROR)</span><br><span class="line"></span><br><span class="line">        mock_DAO_query_ispoolok.return_value = (MGR_COMMON.SUCCESS, <span class="literal">False</span>)</span><br><span class="line">        self.<span class="keyword">assert</span>(rbdAPI.checkpoolstat(self.pool_name), MGR_COMMON.POOL_STAT_ERROR)</span><br><span class="line">        </span><br><span class="line">        mock_DAO_query_ispoolok.return_value = (MGR_COMMON.SUCCESS, <span class="literal">True</span>)</span><br><span class="line">        self.<span class="keyword">assert</span>(rbdAPI.checkpoolstat(self.pool_name), MGR_COMMON.SUCCESS)</span><br></pre></td></tr></tbody></table></figure>
<p>测试用例上的装饰器含义如下：<br>@mock.pathc.object(类名，“类中函数名”)，而如果想要忽略某个测试用例，则可以通过装饰器@unittest.skip(“原因”)<br>而对于另外一种情形则是在另外一个函数中调用了checkpoolstat函数。<br>如下rbd_api.py：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkpoolstat</span>():</span></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Disk</span>(<span class="params">Resource</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ……</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        ret = rbd_api.checkpoolstat()</span><br><span class="line">        ……</span><br></pre></td></tr></tbody></table></figure>
<p>这样，我们在为delete函数撰写单元测试时，也可以在test_rbd_api.py中使用如下的方式：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rbd_api</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDisk</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>():</span></span><br><span class="line">        …</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">teardown</span>():</span></span><br><span class="line">              …</span><br><span class="line"><span class="meta">      @mock.patch(“rbd_api.checkpoolstat”, Mock(return_value = True))</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">test_delete</span>():</span></span><br><span class="line">         <span class="comment"># rbd_api.checkpoolstat 已经成为一个mock对象了，调用时返回True</span></span><br><span class="line">            …</span><br></pre></td></tr></tbody></table></figure>
<p>此时的装饰器应该为</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@mock.patch(“模块名.函数名”)</span></span><br></pre></td></tr></tbody></table></figure>

<p>7.2 链式函数抛出异常<br>在rbd_api.py文件中，有一行代码如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = OpRBD(pool).flatten(img)</span><br></pre></td></tr></tbody></table></figure>
<p>类似这种链式调用的，在前一个函数中抛出异常，要怎么写？如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rbdServ.OpRBD = MagicMock()</span><br><span class="line">rbdServ.OpRBD(pool).side_effect = rados.Error(“Error: error connecting to the cluster: error code <span class="number">24</span>”)</span><br></pre></td></tr></tbody></table></figure>
<p>7.3 全局函数如何mock<br>例如在文件rbd_api.py中有全局函数checkpoolstat(pool)，它是一个全局函数，这样在进行单元测试的过程中，我们可能需要mock该函数。该函数的具体代码如下：</p>
<p>因此，我们在test_rbd_api.py文件中为该函数撰写单元测试，可以这么做。<br>在文件开始处导入该rbd_api模块。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rbd_api <span class="keyword">as</span> rbdAPI</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_patchInvalid_Parameter</span>(<span class="params">self</span>):</span></span><br><span class="line">    ……</span><br><span class="line">    rbdAPI.checkpoolstat.return_value = MGR_COMMON.POOL_STAT_ERROR</span><br><span class="line">    即可。</span><br></pre></td></tr></tbody></table></figure>
<p>7.4 链式调用正常<br>在rbd_api文件中有如下代码行：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = OpRBD(pool).flatten(img)</span><br></pre></td></tr></tbody></table></figure>
<p>在第一个函数未出现异常，在flatten函数中返回值可以在test_rbd_api.py文件中如下写代码：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rbdServ.OpRBD(pool).snap_rollback = MagicMock(return_value = RBD_COMMON.CODE_EXEC_SUCCESS_MODIFY)</span><br></pre></td></tr></tbody></table></figure>
<p>7.5 with子句mock</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpRBD</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">resize</span>(<span class="params">self, img, size</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> rbd.Image(self.ioctx, img) <span class="keyword">as</span> image:</span><br><span class="line">                <span class="keyword">if</span> image.size() &lt; size:</span><br><span class="line">                    image.resize(size)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> RBD_COMMON.CODE_ARGUMENT_LESS_THAN_ORIGINAL</span><br><span class="line">        <span class="keyword">except</span> rbd.ImageNotFound <span class="keyword">as</span> exce1</span><br><span class="line">          print(exce1)</span><br><span class="line">          <span class="keyword">return</span> RBD_COMMON.CODE_IMAGE_NOT_FOUND</span><br></pre></td></tr></tbody></table></figure>
<p>由于是在with子句中要进行mock，在此简单的对with的知识点进行说明：<br>要使用 with 语句，首先要明白上下文管理器这一概念。有了上下文管理器，with 语句才能工作。<br>下面是一组与上下文管理器和with 语句有关的概念。</p>
<p>上下文管理协议（Context Management Protocol）：包含方法 enter() 和 exit()，支持<br>该协议的对象要实现这两个方法。<br>上下文管理器（Context Manager）：支持上下文管理协议的对象，这种对象实现了 enter() 和 exit() 方法。上下文管理器定义执行 with 语句时要建立的运行时上下文，<br>负责执行 with 语句块上下文中的进入与退出操作。通常使用 with 语句调用上下文管理器，也可以通过直接调用其方法来使用。<br>运行时上下文（runtime context）：由上下文管理器创建，通过上下文管理器的 enter() 和<strong>exit</strong>() 方法实现，enter() 方法在语句体执行之前进入运行时上下文，exit() 在语句体执行完后从运行时上下文退出。with 语句支持运行时上下文这一概念。<br>上下文表达式（Context Expression）：with 语句中跟在关键字 with 之后的表达式，该表达式要返回一个上下文管理器对象。<br>语句体（with-body）：with 语句包裹起来的代码块，在执行语句体之前会调用上下文管理器的 enter() 方法，执行完语句体之后会执行 exit() 方法。<br>出现异常时，如果 exit(type, value, traceback) 返回 False，则会重新抛出异常，让with 之外的语句逻辑来处理异常，这也是通用做法；如果返回 True，则忽略异常，不再对异常进行处理。因此，在对with子句进行mock时，要具有两个函数，exit, enter，并且如果在with语句体重抛出异常并被with之外的代码进行捕获异常，要使得__exit__返回False，因此可以撰写测试代码如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpRBD</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">resize</span>(<span class="params">self, img, size</span>):</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> rbd.Image(self.ioctx, img) <span class="keyword">as</span> image:</span><br><span class="line">                    <span class="keyword">if</span> image.size() &lt; size:</span><br><span class="line">                        image.resize(size)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">return</span> RBD_COMMON.CODE_ARGUMENT_LESS_THAN_ORIGINAL</span><br><span class="line">            <span class="keyword">except</span> rbd.ImageNotFound <span class="keyword">as</span> exce1</span><br><span class="line">                print(exce1)</span><br><span class="line">                <span class="keyword">return</span> RBD_COMMON.CODE_IMAGE_NOT_FOUND</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestOpRBD</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">test_resize</span>(<span class="params">self</span>):</span></span><br><span class="line">            fake_image = Mock()</span><br><span class="line">            fake_image.__enter__ = Mock(return_value = fake_image)</span><br><span class="line">            fake_image.__exit__ = Mock(return_value = <span class="literal">True</span>)</span><br><span class="line">            rbd.Image = Mock(return_value = fake_image)</span><br><span class="line">            size = <span class="number">1073741824L</span> / <span class="number">2</span></span><br><span class="line">            fake_image.size = Mock(return_value = <span class="number">1073741824L</span>)</span><br><span class="line">            fake_image.resize = Mock(return_value = <span class="literal">None</span>)</span><br><span class="line">            self.assertEqual(self.opRBD.resize(self.img, size), RBD_COMMON.CODE_ARGUMENT_LESS_THAN_ORIGINAL)</span><br><span class="line">            </span><br><span class="line">            size = <span class="number">2</span> * <span class="number">1073741824L</span></span><br><span class="line">            self.assertEqual(self.opRBD.resize(self.img, size), RBD_COMMON.CODE_EXEC_SUCCESS_MODIFY)</span><br><span class="line">            rbd.Image = Mock(side_effect = rbd.ImageNotFound(<span class="string">"%s image not found!"</span> %self.img))</span><br><span class="line">            self.assertEqual(self.resize(self.img, size), RBD_COMMON.CODE_IMAGE_NOT_FOUND)</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line"><span class="number">7.6</span> 连续mock</span><br><span class="line">在rbd_api文件中有一个OpRados类的内容如下：</span><br><span class="line">```py</span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpRados</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">          self.cluster = rados.Rados(conffile=rconf[<span class="string">'conffile'</span>])</span><br><span class="line">          self.cluster.connect()</span><br><span class="line">     </span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">          self.cluster.shutdown()</span><br><span class="line">     </span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">lists</span>(<span class="params">self</span>):</span></span><br><span class="line">          <span class="keyword">return</span> util.return_format(RBD_COMMON.CODE_EXEC_SUCCESS_GET, <span class="string">""</span>, self.cluster.list_pools())</span><br><span class="line"></span><br><span class="line">为该类写单元测试，具体代码如下：</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> rados</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> Mock</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestOpRados</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>)：</span></span><br><span class="line">        fake_Rados = Mock()</span><br><span class="line">        fake_Rados.connect = Mock(return_value = <span class="literal">None</span>)</span><br><span class="line">        fake_Rados.shutdown = Mock(return_value = <span class="literal">None</span>)</span><br><span class="line">        fake_Rados.list_pools = Mock(return_value = [<span class="string">"sqh"</span>, <span class="string">"sqh1"</span>])</span><br><span class="line">        <span class="comment"># 注意：此处要使得rados.Rados()调用返回fake_Rados.</span></span><br><span class="line">        <span class="comment"># 如果写成rados.Rados = fake_Rados,只能使得self.cluster重新生成一个Mock对象</span></span><br><span class="line">        <span class="comment"># 无法有效的控制为fake_Rados所添加的属性。</span></span><br><span class="line">        rados.Rados = Mock(return_value = fake_Rados)</span><br><span class="line">        self.opRados = OpRados()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        fake_Rados = <span class="literal">None</span></span><br><span class="line">        self.opRados = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_list</span>(<span class="params">self</span>):</span></span><br><span class="line">        return_list = [<span class="string">"sqh"</span>, <span class="string">"sqh1"</span>]</span><br><span class="line">        self.assertEqual(self.opRados.lists(), util.return_format(RBD_COMMON.CODE_EXEC_SUCCESS_GET,  <span class="string">""</span>, return_list))</span><br></pre></td></tr></tbody></table></figure>
<p>7.7 Flask API 接口的模拟调用<br>有三个文件：rbd_app.py文件内容如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> flask imort Flask</span><br><span class="line"><span class="keyword">from</span> flask.ext <span class="keyword">import</span> restful</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = restful.Api(app)</span><br><span class="line"></span><br><span class="line">api_version = <span class="string">"/v1.0"</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## Actually setup the Api resource ruting here</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">api.add_resource(rbd_api.Disk, api_version+<span class="string">"pools/&lt;pool&gt;/disks/&lt;img&gt;"</span>)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == __main__:</span><br><span class="line">    <span class="keyword">from</span> gevent.wsgi <span class="keyword">import</span> WSGIServer</span><br><span class="line">    http_server = WSGIServer((<span class="string">'0.0.0.0'</span>, <span class="number">4806</span>), app)</span><br><span class="line">    http_server.serve_forever()</span><br></pre></td></tr></tbody></table></figure>

<p>rbd_api.py文件中Disk类内容如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> reqparse, Resource</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Disk</span>(<span class="params">Resource</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        ret, rbd_info = DAO_query_rbd_info(pool, img)</span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        parser = reqparser.RequestParser()</span><br><span class="line">        <span class="comment"># action: create\copy\clone</span></span><br><span class="line">        parser.add_argument(<span class="string">'action'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'src_pool'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'src_rbd'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'src_snap'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'size'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'unit'</span>, type=str)</span><br><span class="line">        </span><br><span class="line">        action = args.get(<span class="string">'action'</span>)</span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"create"</span>:</span><br><span class="line">            size = args.get(<span class="string">'size'</span>)</span><br><span class="line">            unit = args.get(<span class="string">'unit'</span>)</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">'copy'</span>:</span><br><span class="line">            src_pool = args.get(<span class="string">'src_pool'</span>)</span><br><span class="line">            src_rbd = args.get(<span class="string">'src_rbd'</span>)</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        parser = reqparser.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">'rb_snap'</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">'action'</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"flatten"</span>:</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">"rollback"</span>:</span><br><span class="line">            snap = args.get(<span class="string">"rb_snap"</span>)</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span>(<span class="params">self, pool, img</span>):</span></span><br><span class="line">        parser = reqparse.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">"action"</span>, type=srt)</span><br><span class="line">        parser.add_argument(<span class="string">"name"</span>, type=str)</span><br><span class="line">        parser.add_argument(<span class="string">"size"</span>, type=float)</span><br><span class="line">        parser.add_argument(<span class="string">"unit"</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        action = args.get(<span class="string">'action'</span>)</span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"resize"</span>:</span><br><span class="line">            size = args.get(<span class="string">'size'</span>)</span><br><span class="line">            unit = args.get(<span class="string">'unit'</span>)</span><br><span class="line">            ....</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> ...</span><br></pre></td></tr></tbody></table></figure>
<p>在test_rbd_api.py中卫Disk类撰写单元测试</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rbd_app <span class="keyword">import</span> app</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDisk</span>(<span class="params">uniitest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.disk = Disk()</span><br><span class="line">        self.content_type = <span class="string">"application/json"</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.disk = <span class="literal">None</span></span><br><span class="line">        self.content_type = <span class="literal">None</span></span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @mock.path.object(DAO_RBDMgr, "DAO_query_rbd_info")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_get</span>(<span class="params">self, mock_DAO_query_rbd_info</span>):</span></span><br><span class="line">        rbd_info = {<span class="string">"pool_name"</span>:<span class="string">"sqh"</span>, <span class="string">"parent"</span>:{}, <span class="string">"image_size"</span>:<span class="number">1073741824L</span>,...}</span><br><span class="line">        mock_DAO_query_rbd_info.return_value = (RBD_COMMON.MONGO_SUCCESS, rbd_info)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(<span class="string">"/?pool_name=sqh&amp;image_name=sqh001"</span>):</span><br><span class="line">            pool = request.args.get(<span class="string">'pool_name'</span>)</span><br><span class="line">            img=request.args.get(<span class="string">'image_name'</span>)</span><br><span class="line">            self.assertEqual(selff.disk.get(pool, img), RBD_COMMON.http_return(RBD_COMMON.MONGO_SUCCESS))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_post</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"create"</span>, <span class="string">"size"</span>:<span class="number">2</span>, <span class="string">"unit"</span>:<span class="string">"GB"</span>}</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.post(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_GET))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_delete</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url):</span><br><span class="line">            self.assertEqual(self.disk.delete(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_DELETE))</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_put</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"rollback"</span>, <span class="string">"rb_snap"</span>:<span class="string">"sqh_snap"</span>}</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.put(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_FLATTENING))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_patch</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">'v1.0/pools/%s/disks/%s'</span> %　(pool, img)</span><br><span class="line">        size = <span class="number">1073741824L</span></span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"resize"</span>, <span class="string">"size"</span>:size, <span class="string">"unit"</span>:<span class="string">"GB"</span>}</span><br><span class="line">        <span class="comment"># the action resize</span></span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.patch(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_MODIFY))</span><br></pre></td></tr></tbody></table></figure>
<p>7.7.1 Get请求</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@mock.path.object(DAO_RBDMgr, "DAO_query_rbd_info")</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_get</span>(<span class="params">self, mock_DAO_query_rbd_info</span>):</span></span><br><span class="line">        rbd_info = {<span class="string">"pool_name"</span>:<span class="string">"sqh"</span>, <span class="string">"parent"</span>:{}, <span class="string">"image_size"</span>:<span class="number">1073741824L</span>,...}</span><br><span class="line">        mock_DAO_query_rbd_info.return_value = (RBD_COMMON.MONGO_SUCCESS, rbd_info)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(<span class="string">"/?pool_name=sqh&amp;image_name=sqh001"</span>):</span><br><span class="line">            pool = request.args.get(<span class="string">'pool_name'</span>)</span><br><span class="line">            img=request.args.get(<span class="string">'image_name'</span>)</span><br><span class="line">            self.assertEqual(selff.disk.get(pool, img), RBD_COMMON.http_return(RBD_COMMON.MONGO_SUCCESS))</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">在为flask接口撰写单元测试时，最关键的是如何传递数据，</span><br><span class="line">我们在setUp函数中初始化Disk类的实例,即self.disk。在传递参数的时候通过调用app.test_request_context(“url”)。因为是restful的get请求，因而我们可以使用？param1=val1&amp;param2=val2的形式。</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.2</span> Post请求</span><br><span class="line">在Post请求，我们需要传递动作的类型，即其他参数，在app.test_request_context函数中，传递了字符串url， data字典，HTTP请求头信息。</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_post</span>(<span class="params">self</span>):</span></span><br><span class="line">        pool = <span class="string">"sqh"</span></span><br><span class="line">        img = <span class="string">"sqh001"</span></span><br><span class="line">        path_url = <span class="string">"v1.0/pools/%s/disks%s"</span> % (pool, img)</span><br><span class="line">        data = {<span class="string">"action"</span>:<span class="string">"create"</span>, <span class="string">"size"</span>:<span class="number">2</span>, <span class="string">"unit"</span>:<span class="string">"GB"</span>}</span><br><span class="line">        <span class="keyword">with</span> app.test_request_context(path_url, data=json.dumps(data), content_type=self.content_type):</span><br><span class="line">            self.assertEqual(self.disk.post(pool, img), RBD_COMMON.http_return(RBD_COMMON.CODE_EXEC_SUCCESS_GET))</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.3</span> Delete请求</span><br><span class="line">如post</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.4</span> Put请求</span><br><span class="line">如post</span><br><span class="line"></span><br><span class="line"><span class="number">7.7</span><span class="number">.5</span> Patch请求</span><br><span class="line">如post</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> Python 单元测试环境安装</span><br><span class="line">因为在python2.*中，mock是单独的模块，因而我们需要单独安装mock模块才能够正常的使用。</span><br><span class="line">因此，我们首先要在rpm find 网站下载好pip，然后通过pip安装mock。</span><br><span class="line"></span><br><span class="line">http://rpmfind.net/linux/RPM/epel/<span class="number">7</span>/x86_64/Packages/p/python2-pip<span class="number">-8.1</span><span class="number">.2</span><span class="number">-5.</span>el7.noarch.html</span><br><span class="line">依赖于python-setuptools</span><br><span class="line"></span><br><span class="line">http://rpmfind.net/linux/RPM/centos/<span class="number">7.4</span><span class="number">.1708</span>/x86_64/Packages/python-setuptools<span class="number">-0.9</span><span class="number">.8</span><span class="number">-7.</span>el7.noarch.html</span><br><span class="line"></span><br><span class="line">mock的下载网址：</span><br><span class="line"></span><br><span class="line">https://pypi.python.org/pypi/mock/<span class="number">2.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">下一章节要用的coverage，测试代码覆盖率，网址在：</span><br><span class="line"></span><br><span class="line">https://pypi.python.org/pypi/coverage/<span class="number">4.5</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="number">9.</span> 使用coverage测试覆盖率</span><br><span class="line">在单元测试的过程中，应尽量使得单元都被覆盖过，因而需要使用专门的工具来进行测试代码覆盖率。以test_rbd_api.py为准</span><br><span class="line">测试的步骤如下：</span><br><span class="line">```py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coverage run test_rbd_api.py</span><br><span class="line">&gt;&gt;&gt;coverage report -m path/to/rbd_api.py</span><br></pre></td></tr></tbody></table></figure>
<p>即可查看代码覆盖程度。</p>
<p>很多时候开发人员和其他系统联调时，如果关联系统还没有开发完成，这时只能使用mock来模拟关联系统的返回<br>自动化测试也常常遇到同样的问题，为了验证关联系统不同的返回对被测对象的影响，需要mock关联系统的返回<br>一个例子</p>
<ul>
<li>被测对象从关联接口获得用户信息</li>
<li>在关联接口开发完成之前，只能使用mock来模拟关联接口的返回，完成对被测对象的测试</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> patch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_user_info</span>(<span class="params">uid</span>):</span></span><br><span class="line">        resp = requests.get(<span class="string">"http://api.server.com/user/{0}"</span>.format(uid))</span><br><span class="line">        <span class="keyword">return</span> resp.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestUserInfo</span>(<span class="params">TestCase</span>):</span></span><br><span class="line"><span class="meta">    @patch('__main__.User')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_user_name</span>(<span class="params">self, MockUser</span>):</span></span><br><span class="line">        user = MockUser()</span><br><span class="line">        user.get_user_info.return_value = {</span><br><span class="line">            <span class="string">"user_id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"python"</span>,</span><br><span class="line">            <span class="string">"age"</span>: <span class="number">20</span></span><br><span class="line">        }</span><br><span class="line">        resp = user.get_user_info(<span class="number">1</span>)</span><br><span class="line">        self.assertEqual(resp.get(<span class="string">"name"</span>), <span class="string">"python"</span>)</span><br><span class="line">        self.assertEqual(resp.get(<span class="string">"age"</span>), <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Ran 1 test in 0.001s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OK</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> MagicMock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将要测试的排序函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span>(<span class="params">arr</span>):</span></span><br><span class="line">    l = len(arr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, l):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, l):</span><br><span class="line">            <span class="keyword">if</span> arr[i] &gt;= arr[j]:</span><br><span class="line">                tmp = arr[i]</span><br><span class="line">                arr[i] = arr[j]</span><br><span class="line">                arr[j] = tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单元测试</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSort</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 以test开头的函数会被测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sort</span>(<span class="params">self</span>):</span></span><br><span class="line">        arr = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">        sort(arr)</span><br><span class="line">        self.assertEqual(arr, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mock</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">m1</span>(<span class="params">self</span>):</span></span><br><span class="line">        val = self.m2()</span><br><span class="line">        self.m3(val)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">m2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">m3</span>(<span class="params">self, val</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_m1</span>(<span class="params">self</span>):</span></span><br><span class="line">        a = A()</span><br><span class="line">        a.m2 = MagicMock(return_value=<span class="string">"custom_val"</span>)</span><br><span class="line">        a.m3 = MagicMock()</span><br><span class="line">        a.m1()</span><br><span class="line">        self.assertTrue(a.m2.called)</span><br><span class="line">        a.m3.assert_called_with(<span class="string">"custom_val"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">side_effect</span>(<span class="params">arg</span>):</span></span><br><span class="line">    <span class="keyword">if</span> arg &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line">    mock = MagicMock()</span><br><span class="line">    mock.side_effect = side_effect</span><br><span class="line">    print(mock(<span class="number">1</span>))</span><br><span class="line">    print(mock(<span class="number">-2</span>))</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/sql/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>mysql命令行中执行多行命令时，<br>如果前边输入的命令发生错误，<br>通过<code>\c</code>来取消当前的命令，重新进入“mysql-&gt;”提示符</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">```\q```退出mysql</span><br><span class="line">```\h```帮助信息</span><br><span class="line">```\d```改变执行符号</span><br><span class="line">```\s```显示服务器状态</span><br><span class="line"></span><br><span class="line">### 整数类型范围</span><br><span class="line">1，tinyint类型占用的字节最小，表示1字节整数。取值范围也是最小的。</span><br><span class="line">2，smalllint类，表示2个字节整数。</span><br><span class="line">3，mediumint类型占用的字节最大，表示3字节整数。</span><br><span class="line">4，int类型，表示4字节整数，和integer类型的字节数和取值范围是一样的，</span><br><span class="line">5，bigint类型占用的字节最大，表示8字节整数。气质范围是最大的。</span><br><span class="line"></span><br><span class="line">属性 字段约束</span><br><span class="line">任何整数类型后面都可以加一个```unsigned```属性，表示数据是无符号的，即非负整数。</span><br><span class="line">用此类型可以增加数据长度。</span><br><span class="line">例如如果tinyint最大是127，那tinyint unsigned最大就可以到127 * 2。</span><br><span class="line">例如：int类型的整数，有符号值：-128到127，无符号值：0到255。</span><br><span class="line">不同类型的整数类型的字节数不同，根据类型所占的字节数可以算出该类型的取值范围。</span><br><span class="line">比如intyint的空间是一个字节，一个字节是8位。那么</span><br><span class="line">tinyint无符号数的最大值就是2的8次-1，也就是255。</span><br><span class="line">tinyint有符号数的最大值就是2的7次-1，也就是127。</span><br><span class="line"></span><br><span class="line">default</span><br><span class="line"></span><br><span class="line">zerofill。该属性参数表示数字不足的显示空间由0来填补。</span><br><span class="line">使用zerofill参数时，MySQL会自动加上unsinged属性。</span><br><span class="line">那么该整数类型只能表示无符号数，其显示宽度比默认宽度小1。</span><br><span class="line">默认没有零填充</span><br><span class="line"></span><br><span class="line">整数类型还有一个auto_increment属性，该属性可是使字段成为自增字段，具有该属性的字段，在插入新的记录时，该字段的值都会在前一条记录的基础上1。所以这个时候就不用人为的设值了呢，一般用来主键的设置上该属性。</span><br><span class="line">主键约束PRIMARY KEY(字段名)，自带索引，不能为null，不能重复</span><br><span class="line">为表加上一个列用来存储唯一标志即主键列建议用数字类型，</span><br><span class="line">检索速度快，加上auoto_increment自增长</span><br><span class="line">非空约束 not null</span><br><span class="line">唯一约束 unique 可以为NULL，如果不为NULL，必须唯一</span><br><span class="line">外键约束 foreign key （子表字段名）reference 父表名(字段名) 保持关联数据的逻辑性</span><br><span class="line">MySQL中显示的字段名是：外键属性名_id。</span><br><span class="line"></span><br><span class="line">数据类型参数是整数数据类型的名称</span><br><span class="line"></span><br><span class="line">定义后面Length字段，并不是指的数值范围，而是指数据库里面可见的最大数据的长度。</span><br><span class="line">int(5)就是指定int类型的显示字符的长度是5，始终是4个字节，可以存1234</span><br><span class="line">INT(11)表示长度为11的INT类型，对大多数应用是没有意义的,它不会限制值的合法范围,只会影响显示字符的个数，只是当定义了UNSIGNED ZEROFILL属性配合使用才有意义。</span><br><span class="line"></span><br><span class="line">```int(3) zerofill```自动填充0，可以存1234，012</span><br><span class="line">```int(5) zerofill```自动填充0，可以存01234，00012</span><br><span class="line">假定类型设定为INT(5)，属性为UNSIGNED ZEROFILL，如果用户插入的数据为12的话，那么数据库实际存储数据为00012。</span><br><span class="line"></span><br><span class="line">### 实数类型</span><br><span class="line">DECIMAL可存储比 BIGINT还大的整数，存储精确的小数</span><br><span class="line">FLOAT和 DOUBLE 是有取值范围的，支持使用标准的浮点进行近似计算</span><br><span class="line">FLOAT类型数据可以存储至多8位十进制数，并在内存中占4字节。</span><br><span class="line">DOUBLE类型数据可以存储至多18位十进制数，并在内存中占8字节。</span><br><span class="line"></span><br><span class="line">### 字符串类型</span><br><span class="line">VARCHAR、CHAR、TEXT、BLOB</span><br><span class="line">VARCHAR类型用于存储可变长字符串,它比定长类型更节省空间</span><br><span class="line">VARCHAR使用1或2个额外字节记录字符串的长度,</span><br><span class="line">列长度小于255字节,使用1个字节表示,否则用2个</span><br><span class="line">内部存储varchar是存入的实际字符数+1个字节（n&lt;=255）或2个字节(n&gt;255)，</span><br><span class="line">VARCHAR长度，如果存储内容超出指定长度，会被截断</span><br><span class="line">VARCHAR值保存时不进行填充。当值保存和检索时尾部的空格仍保留</span><br><span class="line"></span><br><span class="line">CHAR是定长的，根据定义的字符串长度分配足够的空间</span><br><span class="line">CHAR会根据需要采用空格进行填充以方便比较</span><br><span class="line">CHAR适合存储很短的字符串,或者所有值都接近同一个长度</span><br><span class="line">CHAR存储的内容超出设置的长度时，内容同样会被截断。</span><br><span class="line"></span><br><span class="line">当保存CHAR值时，在它们的右边填充空格以达到指定的长度。当检索到CHAR值时，尾部的空格被删除掉。</span><br><span class="line">在存储或检索过程中不进行大小写转换。</span><br><span class="line">CHAR存储定长数据很方便，</span><br><span class="line">CHAR字段上的索引效率级高，</span><br><span class="line">对于经常变更的数据,CHAR比 VARCHAR更好,CHAR不容易产生碎片</span><br><span class="line">对于非常短的列,CHAR比 VARCHAR在存储空间上更有效率</span><br><span class="line">只分配真正需要的空间,更长的列会消耗更多的内存</span><br><span class="line"></span><br><span class="line">定义一个CHAR[10]和VARCHAR[10],如果存进去的是‘ABCD’, char(10)不论你存储的数据是否达到了10个字节，都要占去10个字节的空间,不足的自动用空格填充，除了字符‘ABCD’外，后面跟六个空格，而varchar(50)中50的含义是最多存放50个字符，VARCHAR的长度变为4了，</span><br><span class="line">取数据的时候，CHAR类型的要用trim()去掉多余的空格，而VARCHAR类型是不需要的。</span><br><span class="line">char(16)表示固定长度字符串，长度为16、</span><br><span class="line">varchar(16)表示可变长度字符串，长度为16、</span><br><span class="line"></span><br><span class="line">text表示字符串类型，内部存储text是实际字符数+2个字节。能存储大字符串，最多存储65535字节数据</span><br><span class="line">尽量避免使用BLOB/TEXT类型，查询会使用临时表,导致严重的性能开销。</span><br><span class="line"></span><br><span class="line">请说明varchar和text的区别</span><br><span class="line">varchar可指定字符数，text不能指定，</span><br><span class="line">text类型不能有默认值。</span><br><span class="line">varchar可直接创建索引，text创建索引要指定前多少个字符。</span><br><span class="line">varchar查询速度快于text，在都创建索引的情况下，text的索引几乎不起作用。</span><br><span class="line"></span><br><span class="line">### 枚举类型（ENUM），</span><br><span class="line">把不重复的数据存储为一个预定义的集合。</span><br><span class="line">有时可以使用ENUM代替常用的字符串类型。</span><br><span class="line">ENUM存储非常紧凑，会把列表值压缩到一个或两个字节。</span><br><span class="line">ENUM在内部存储时，其实存的是整数。</span><br><span class="line">尽量避免使用数字作为ENUM枚举的常量，因为容易混乱。</span><br><span class="line">排序是按照内部存储的整数</span><br><span class="line">枚举表会使表大小大大减小</span><br><span class="line"></span><br><span class="line">### 日期和时间类型</span><br><span class="line">尽量使用timestamp，空间效率高于datetime，</span><br><span class="line">用整数保存时间戳通常不方便处理。</span><br><span class="line">如果需要存储微妙，可以使用bigint存储。</span><br><span class="line"></span><br><span class="line">```SELECT CURRENT_DATE();```获取当前日期</span><br><span class="line"></span><br><span class="line">InnoDB表引擎，默认事务型引擎</span><br><span class="line">数据存储在共享表空间,可以通过配置分开，也就是多个表和索引都存储在一个表空间中，可以通过配置文件改变此配置。</span><br><span class="line">对主键查询的性能高于其他类型的存储引擎</span><br><span class="line">内部做了很多优化,从磁盘读取数据时自动在内存构建hash索引，插入数据时自动构建插入缓冲区</span><br><span class="line">通过一些机制和工具支持真正的热备份</span><br><span class="line">支持崩溃后的安全恢复</span><br><span class="line">支持事务 提供了对数据库ACID事务的支持；</span><br><span class="line">支持行级锁和表锁</span><br><span class="line">支持外键</span><br><span class="line">不支持全文索引</span><br><span class="line">插入缓冲（insert buffer)</span><br><span class="line">二次写(double write)</span><br><span class="line">自适应哈希索引(ahi)</span><br><span class="line">预读(read ahead)</span><br><span class="line">没有保存表的行数</span><br><span class="line"></span><br><span class="line">MyISAM表引擎</span><br><span class="line">表存储在两个文件,MYD和MYI</span><br><span class="line">拥有全文索引、压缩、空间函数</span><br><span class="line">不支持事务和行级锁和外键,</span><br><span class="line">不支持崩溃后的安全恢复</span><br><span class="line">存储了表的行数</span><br><span class="line">只支持表锁</span><br><span class="line">设计简单,某些场景下性能很好，例如获取整个表有多少条数据，性能很高。</span><br><span class="line">全文索引不是很常用，不如使用外部的ElasticSearch或Lucene。</span><br><span class="line"></span><br><span class="line">其他表引擎</span><br><span class="line">Archive、 Blackhole、CSV、Memory</span><br><span class="line"></span><br><span class="line">### 锁机制</span><br><span class="line">表锁是日常开发当中常见的问题,因此也是面试当中最常见的考察点,</span><br><span class="line">当多个查询同一时刻进行数据修改时,就会产生并发控制的问题</span><br><span class="line"></span><br><span class="line">#### 共享锁和排他锁,其实就是读锁和写锁</span><br><span class="line">读锁：共享的，不堵塞，多个用户可以同时读一个资源，互不干扰。</span><br><span class="line">写锁：排他的，一个写锁会阻塞其他的读锁和写锁，这样可以只允许一个用户进行写入，防止其他用户读取正在写入的资源。</span><br><span class="line"></span><br><span class="line">#### 锁粒度</span><br><span class="line">行锁，最大程度的支持并发处理，但是也带来了最大的锁开销</span><br><span class="line">表锁，系统性能开销最小，会锁定整张表，MyIsam使用表锁。</span><br><span class="line"></span><br><span class="line">### 存储过程</span><br><span class="line">为以后的使用而保存的一条或多条 MySQL语句的集合</span><br><span class="line">存储过程就是有业务逻辑和流程的集合</span><br><span class="line">可以在存储过程中创建表，更新数据，删除等等</span><br><span class="line"></span><br><span class="line">使用场景：</span><br><span class="line">通过把处理封装在容易使用的单元中，简化复杂的操作</span><br><span class="line">保证数据的一致性</span><br><span class="line">简化对变动的管理</span><br><span class="line"></span><br><span class="line">### 触发器</span><br><span class="line">是指一段代码，当触发某个事件时，自动执行这些代码。</span><br><span class="line">提供给程序员和数据分析员来保证数据完整性的一种方法，</span><br><span class="line">它是与表事件相关的特殊的存储过程</span><br><span class="line">使用场景</span><br><span class="line">可通过数据库中的相关表实现级联更改</span><br><span class="line">实时监控某张表中的某个字段的更改而需要做出相应的处理</span><br><span class="line">某些业务编号的生成等</span><br><span class="line">滥用会造成数据库及应用程序的维护困难</span><br><span class="line"></span><br><span class="line">在MySQL数据库中有如下六种</span><br><span class="line">1、Before Insert</span><br><span class="line">2、After Insert</span><br><span class="line">3、Before Update</span><br><span class="line">4、After Update</span><br><span class="line">5、Before Delete</span><br><span class="line">6、After Delete</span><br><span class="line"></span><br><span class="line">十进制的浮点数转换从二进制的浮点数会丢失数据</span><br><span class="line"></span><br><span class="line">IP 该如何保存?</span><br><span class="line">最简单的办法是使用字符串（varchar）来保存，如果从效率考虑的话，</span><br><span class="line">可以将ip 保存为整型（unsigned int），</span><br><span class="line">使用 mysql 提供的函数将 ip 转换为整型，然后存储即可。</span><br><span class="line">MySQL 函数：inet_aton()和 inet_ntoa</span><br><span class="line"></span><br><span class="line">解题方法</span><br><span class="line">对于此类考题，先说明如何定位低效SQL语句，然后根据SQL语句可能低效的原因做排查，先从索引着手，如果索引没有问题，考虑以上几个方面，数据访问的问题，长难查询句的问题还是一些特定类型优化的问题，逐一回答。</span><br><span class="line"></span><br><span class="line">请简述项目中优化SQL语句执行效率的方法，从哪些方面，SQL语句性能如何分析？</span><br><span class="line">考点分析：SQL语句查询速度慢的方法</span><br><span class="line">延伸考点：</span><br><span class="line">优化查询过程中的数据访问</span><br><span class="line">优化长难的查询语句</span><br><span class="line">优化特定类型的查询语句</span><br><span class="line"></span><br><span class="line">排查查询速度慢的原因</span><br><span class="line">1. 开启并且查询慢查询日志，慢查询通常是缺少索引，索引不合理或者业务代码实现导致</span><br><span class="line">开启慢查询功能</span><br><span class="line">slow_query_log_file 慢查询日志文件路径</span><br><span class="line">slow_query_log 用于指定是否打开慢查询日志</span><br><span class="line">long_query_time 超过多少秒的查询就写入日志</span><br><span class="line">2. 调整数据修改索引；业务代码层限制不合理访问，如：因为数据类型不匹配导致全表扫描；一次获取太多数据等</span><br><span class="line"></span><br><span class="line">查找分析查询速度慢的原因</span><br><span class="line">1. 记录慢查询日志。分析查询日志，不要直接打开慢查询日志进行分析，这样比较浪费时间和精力，可以使用pt-query-digest工具进行分析</span><br><span class="line">如何排查慢查询？ </span><br><span class="line">2. 使用show profile，通过临时表的主键ID去查一条sql语句是在什么地方发生慢的操作。</span><br><span class="line">```sql</span><br><span class="line">set profiling=1; # 开启，服务器上所有执行语句会记录执行时间，存到临时表中</span><br><span class="line">mysql&gt; show profiles; # 查看临时表</span><br><span class="line">+----------+------------+-------------------+</span><br><span class="line">| Query_ID | Duration   | Query             |</span><br><span class="line">+----------+------------+-------------------+</span><br><span class="line">|        1 | 0.00315025 | SELECT DATABASE() |</span><br><span class="line">|        2 | 0.04271325 | select * from a   |</span><br><span class="line">+----------+------------+-------------------+</span><br><span class="line">2 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></tbody></table></figure>

<p>show profile for query 临时表ID，通过临时表的主键ID去查一条sql语句是在什么地方发生慢的操作。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile for query 2;</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line">| Status               | Duration |</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line">| starting             | 0.001101 |</span><br><span class="line">| checking permissions | 0.000016 |</span><br><span class="line">| Opening tables       | 0.037732 |</span><br><span class="line">| init                 | 0.000040 |</span><br><span class="line">| System <span class="keyword">lock</span>          | <span class="number">0.000021</span> |</span><br><span class="line">| optimizing           | <span class="number">0.000006</span> |</span><br><span class="line">| <span class="keyword">statistics</span>           | <span class="number">0.002043</span> |</span><br><span class="line">| preparing            | <span class="number">0.000025</span> |</span><br><span class="line">| executing            | <span class="number">0.000003</span> |</span><br><span class="line">| Sending <span class="keyword">data</span>         | <span class="number">0.001608</span> |</span><br><span class="line">| <span class="keyword">end</span>                  | <span class="number">0.000006</span> |</span><br><span class="line">| <span class="keyword">query</span> <span class="keyword">end</span>            | <span class="number">0.000007</span> |</span><br><span class="line">| closing <span class="keyword">tables</span>       | <span class="number">0.000013</span> |</span><br><span class="line">| freeing items        | <span class="number">0.000071</span> |</span><br><span class="line">| cleaning up          | <span class="number">0.000022</span> |</span><br><span class="line">+<span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="number">15</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li><p>使用show status<br>show status会返回一些计数器，<br>show global status会查看所有服务器级别的所有计数<br>有时根据这些计数，可以推测出哪些操作代价较高或者消耗时间多</p>
</li>
<li><p>show processlist</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+<span class="comment">----+------+-----------------+------+---------+------+----------+------------------+</span></span><br><span class="line">| Id | User | Host            | db   | Command | Time | State    | Info             |</span><br><span class="line">+<span class="comment">----+------+-----------------+------+---------+------+----------+------------------+</span></span><br><span class="line">|  3 | root | localhost:14778 | test | Query   |    0 | starting | <span class="keyword">show</span> <span class="keyword">processlist</span> |</span><br><span class="line">+<span class="comment">----+------+-----------------+------+---------+------+----------+------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></tbody></table></figure>
<p>观察是否有大量线程处于不正常的状态或特征</p>
</li>
<li><p>使用explain 分析单条SQL语句、排查索引问题，注意格式化 \G 输出后不需要加分号。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from a;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+</span></span><br><span class="line">|  1 | SIMPLE      | a     | NULL       | ALL  | NULL          | NULL | NULL    |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from a\G  -- 注意:格式化输出内容，\G相当于;</span><br><span class="line">*************************** 1. row **********</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: a</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 2</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>


<p>优化查询过程中的数据访问<br>访问数据太多导致查询性能下降<br>确定应用程序是否在检索大量超过需要的数据，可能是太多行或列<br>确认MySQL服务器是否在分析大量不必要的数据行<br>避免犯如下SQL语句错误<br>查询不需要的数据。解决办法：使用limit解决<br>多表关联返回全部列。解决办法：指定列名<br>总是返回全部列。解决办法：避免使用 SELECT *<br>重复查询相同的数据。解决办法：可以缓存数据，下次直接读取缓存<br>是否在扫描额外的记录。解决办法：<br>使用explain进行分析，如果发现查询需要扫描大量的数据，但只返回少数的行，可以通过如下技巧去优化：<br>使用索引覆盖扫描，把所有的列都放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果。<br>改变数据库和表的结构，修改数据表范式<br>重写SQL语句，让优化器可以以更优的方式执行查询。</p>
<p>优化长难的查询语句<br>一个复杂查询还是多个简单查询<br>MySQL内部每秒能扫描内存中上百万行数据，相比之下，响应数据给客户端就要慢得多<br>使用尽可能小的查询是好的，但是有时将一个大的查询分解为多个小的查询是很有必要的。<br>切分查询<br>将一个大的查询分为多个小的相同的查询<br>一次性删除1000万的数据要比一次删除1万，暂停一会的方案更加损耗服务器开销。</p>
<p>分解关联查询，<br>将一条关联语句分解成多条SQL来执行<br>让缓存的效率更高。<br>执行单个查询可以减少锁的竞争。<br>在应用层做关联更容易对数据库进行拆分。<br>查询效率会有大幅提升。<br>较少冗余记录的查询。</p>
<p>优化特定类型的查询语句<br>count(列名) 返回指定列的值的数目，包含非空值的记录数<br>会忽略列值为空（这里的空不是只空字符串或者0，而是表示null）的计数，<br>&nbsp;即某个字段值为NULL时，不统计。<br>count(字段) 会统计该字段在表中出现的次数，忽略字段为null 的情况。即&nbsp;不统计字段为null 的记录。&nbsp;&nbsp;<br>count(*)会忽略所有的列，直接统计所有列数，相当于行数，不会忽略列值为NULL&nbsp;&nbsp;比count(列名)效率高</p>
<p>返回表中包含空值的记录数<br>count(1) 会统计表中的所有的记录数，包含字段为null 的记录<br>包括了忽略所有列，用1代表代码行，<br>COUNT(DISTINCT column_name) 函数返回指定列的不同值的数目、<br>不重复的记录条数</p>
<p>GROUP BY product_type<br>HAVING count(*) &gt; 1 #分组内的化为一行的数量</p>
<p>MyISAM中，没有任何where条件的count(<em>)非常快。<br>当有where条件时，MyISAM的count统计不一定比其它引擎快。<br>可以使用explain查询近似值，用近似值替代count(</em>)<br>增加汇总表<br>使用缓存</p>
<p>优化GROUP BY和DISTINCT<br>这两种查询据可以使用索引来优化，是最有效的优化方法<br>关联查询中，使用标识列分组的效率更高<br>如果不需要ORDER BY，进行GROUP BY时加ORDER BY NULL，MySQL不会再进行文件排序。<br>WITH ROLLUP超级聚合，可以挪到应用程序处理</p>
<p>优化LIMIT分页<br>LIMIT偏移量大的时候，查询效率较低<br>可以记录上次查询的最大ID，下次查询时直接根据该ID来查询</p>
<p>常规sql优化思路（众多解决方案之一）<br>1、查看slow-log，分析slow-log，分析出查询慢的语句。<br>2、按照一定优先级，进行一个一个的排查所有慢语句。<br>3、分析top sql，进行explain调试，查看语句执行时间。<br>4、调整索引或语句本身。</p>
<p>SQL语句优化的一些方法？<br>1.对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。<br>2.应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">is</span> <span class="literal">null</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=</span><br></pre></td></tr></tbody></table></figure>
<p>3.应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则引擎将放弃使用索引而进行全表扫描。<br>4.应尽量避免在 where 子句中使用or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">10</span> <span class="keyword">or</span> <span class="keyword">num</span>=<span class="number">20</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以这样查询：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> </span><br><span class="line"><span class="keyword">from</span> t </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">10</span> </span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">20</span></span><br></pre></td></tr></tbody></table></figure>

<p>5.in 和 not in 也要慎用，否则会导致全表扫描，如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) </span><br></pre></td></tr></tbody></table></figure>
<p>对于连续的数值，能用 between 就不要用 in 了：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>

<p>6.下面的查询也将导致全表扫描：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'%李%'</span></span><br></pre></td></tr></tbody></table></figure>
<p>若要提高效率，可以考虑全文检索。</p>
<ol start="7">
<li>如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=@<span class="keyword">num</span></span><br></pre></td></tr></tbody></table></figure>
可以改为强制查询使用索引：<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">with</span>(<span class="keyword">index</span>(索引名)) <span class="keyword">where</span> <span class="keyword">num</span>=@<span class="keyword">num</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>8.应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>/<span class="number">2</span>=<span class="number">100</span></span><br></pre></td></tr></tbody></table></figure>
<p>应改为:</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>=<span class="number">100</span>*<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>

<p>9.应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">substring</span>(<span class="keyword">name</span>,<span class="number">1</span>,<span class="number">3</span>)=<span class="string">'abc'</span></span><br></pre></td></tr></tbody></table></figure>
<p>name以abc开头的id应改为:</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'abc%'</span></span><br></pre></td></tr></tbody></table></figure>

<p>10.不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p>
<p>分区表的工作原理<br>对用户而言，分区表是一个独立的逻辑表，但是底层MySQL将其分成了多个物理子表，这对用户来说是透明的，每一个分区表都会使用一个独立的表文件。</p>
<p>如图所示：MySQL将表分成多个物理字表，但PHP客户端并无感知，仍然认为操作的是一个表。</p>
<p>创建表时使用partition by子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有需要的数据的分区，这样只需要查询数据所在分区即可。</p>
<p>这样子表相对于未分区的表来说占用空间小，数据量更小，因此操作速度更快。</p>
<p>分区的主要目的是将数据按照一个较粗的粒度分在不同的表中，这样可以将相关的数据存放在一起，而且如果想一次性的删除整个分区的数据也和方便。</p>
<p>适用场景<br>1、表非常大，无法全部存在内存，或者只在表的最后有热点数据，其他都是历史数据。<br>2、分区表的数据更易维护，可以对独立的分区进行独立的操作。<br>3、分区表的数据可以分布在不同的机器上，从而高效适用资源。<br>4、可以使用分区表来避免某些特殊的瓶颈<br>5、可以备份和恢复独立的分区<br>限制<br>1、一个表最多只能有1024个分区<br>2、5.1版本中，分区表表达式必须是整数，5.5可以使用列分区<br>3、分区表字段如果有主键和唯一索引列，那么主键列和唯一索引列都必须包含进来<br>4、分区表中无法使用外键约束<br>5、需要对现有表的结构进行修改<br>6、所有分区都必须使用相同的存储引擎<br>7、分区函数中可以使用的函数和表达式会有一些限制<br>8、某些存储引擎不支持分区<br>9、对于MyISAM的分区表，不能使用load index into cache<br>10、对于MyISAM表，使用分区表时需要打开更多的文件描述符</p>
<p>分库分表的工作原理<br>通过一些HASH算法或者工具实现将一张数据表垂直或者水平进行物理切分<br>适用场景<br>1、单表记录条数达到百万或千万级别时<br>2、解决表锁的问题<br>分表方式<br>水平分割：表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询次数</p>
<p>适用场景<br>1、表中的数据本身就有独立性，例如表中分表记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用。<br>2、需要把数据存放在多个介质上。</p>
<p>水平切分的缺点<br>1、给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需UNION操作<br>2、在许多数据库应用中，这种复杂度会超过它带来的优点，查询时会增加读一个索引层的磁盘次数</p>
<p>垂直分表<br>把主键和一些列放在一个表，然后把主键和另外的列放在另一个表中<br>适用场景<br>1、如果一个表中某些列常用，另外一些列不常用<br>2、可以使数据行变小，一个数据页能存储更多数据，查询时减少I/O次数<br>垂直分表缺点<br>管理冗余列，查询所有数据需要join操作</p>
<p>分表缺点<br>有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差<br>对于应用层来说，逻辑算法增加开发成本</p>
<p>MySQL的复制原理及负载均衡<br>MySQL主从复制工作原理<br>在主库上把数据更高记录到二进制日志<br>从库将主库的日志复制到自己的中继日志<br>从库读取中继日志的事件，将其重放到从库数据中</p>
<p>MySQL主从复制解决的问题<br>数据分布：随意开始或停止复制，并在不同地理位置分布数据备份<br>负载均衡：降低单个服务器的压力<br>高可用和故障切换：帮助应用程序避免单点失败<br>升级测试：可以用更高版本的MySQL作为从库</p>
<p>解题方法<br>充分掌握分区分表的工作原理和适用场景，在面试中，此类题通常比较灵活，会给一些现有公司遇到问题的场景，大家可以根据分区分表，MySQL复制、负载均衡的适用场景来根据情况进行回答</p>
<p>问:28：设定网站用户数量在千万级，但是活跃用户数量只有1%，如何通过优化数据库提高活跃用户访问速度？<br>可以使用MySQL的分区，把活跃用户分在一个区，不活跃用户分在另外一个区，本身活跃用户区数据量比较少，因此可以提高活跃用户访问速度。<br>还可以水平分表，把活跃用户分在一张表，不活跃用户分在另一张表，可以提高活跃用户访问速度。</p>
<p>常见的web安全问题,原理和防范措施。安全意识<br>◆SQL注入<br>◆XSS(跨站脚本攻击, Cross-Site Scripting)<br>◆CSRF(跨站请求伪造, Cross- site request forgery)</p>
<p>web 安全一大原则：永远不要相信用户的任何输入<br>对输入参数做好检查(类型和范围)；过滤和转义特殊字符<br>不要直接拼接sql，使用ORM 有安全性考虑，通过传参的形式不会有 sql 注入问题，<br>查询错误信息不要返回给用户，将错误记录到日志，<br>不要明文存储敏感信息。<br>1、定期做数据备份<br>2、不给查询用户root权限，合理分配权限<br>3、关闭远程访问数据库权限<br>4、修改root口令，不用默认口令，使用较复杂的口令<br>5、删除多余的用户<br>6、改变root用户的名称<br>7、限制一般用户浏览其它库<br>8、限制用户对数据文件的访问权限</p>
<p>问题29：SQL语句应该考虑哪些安全性？SQL查询的安全方案、MySQL的其它安全设置<br>解题方法<br>SQL安全的优先考虑SQL注入的防护手段。</p>
<p>sql语句是解释性语言，<br>SQL注入的关键是单引号的闭合，</p>
<ul>
<li>通过构造特殊的输入参数传入Web应用，</li>
<li>通常由于程序员未对输入过滤，直接动态拼接 SQL 产生</li>
<li>可以使用开源工具 sqlmap，SQLninja 检测</li>
</ul>
<p>SQL注入（SQLi）是一种注入攻击，可以执行恶意SQL语句。<br>它通过将任意SQL代码插入数据库查询，使攻击者能够完全控制Web应用程序后面的数据库服务器。<br>攻击者可以使用SQL注入漏洞绕过应用程序安全措施；<br>可以绕过网页或Web应用程序的身份验证和授权，并检索整个SQL数据库的内容；<br>还可以使用SQL注入来添加，修改和删除数据库中的记录。</p>
<p>1、使用预处理语句防止SQL注入，</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> = ?</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SQL注入代码演示示例</span></span><br><span class="line"><span class="string">    1）创建users表和插入相应信息</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">sql</span></span><br><span class="line"> <span class="comment">--  创建users数据表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span>(</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">45</span>) <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`email`</span> <span class="built_in">VARCHAR</span>(<span class="number">45</span>) <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`password`</span> <span class="built_in">VARCHAR</span>(<span class="number">45</span>) <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">-- 插入users表三条数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">name</span>,email,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'zhangsan'</span>,<span class="string">'zhangsan@qq.com'</span>,<span class="keyword">md5</span>(<span class="string">'zhangsan123'</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">name</span>,email,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'lisi'</span>,<span class="string">'lisi@qq.com'</span>,<span class="keyword">md5</span>(<span class="string">'lisi123'</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">name</span>,email,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">'wangwu'</span>,<span class="string">'wangwu@qq.com'</span>,<span class="keyword">md5</span>(<span class="string">'wangwu123'</span>));</span><br></pre></td></tr></tbody></table></figure>

<p> 2） 存在SQL漏洞代码示例：在终端下输入名称和密码然后查询用户信息</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sql 注入演示代码 sql_inject_demo.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> MySQLdb   <span class="comment"># pip install mysqlclient</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 新建数据库链接</span></span><br><span class="line">db = MySQLdb.connect(</span><br><span class="line">    host=<span class="string">'localhost'</span>,</span><br><span class="line">    user=<span class="string">'root'</span>,</span><br><span class="line">    passwd=<span class="string">'123456'</span>,</span><br><span class="line">    db=<span class="string">'test'</span></span><br><span class="line">)</span><br><span class="line">cur = db.cursor()</span><br><span class="line"> </span><br><span class="line">name = input(<span class="string">'Enter name: '</span>)</span><br><span class="line">print(<span class="string">'您输入的用户name是: {}'</span>.format(name))</span><br><span class="line">password = input(<span class="string">'Enter password：'</span>)</span><br><span class="line">print(<span class="string">'您输入的密码是: {}'</span>.format(password))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接拼接 sql 参数,使用md5的 password</span></span><br><span class="line">sql = <span class="string">"SELECT * FROM users WHERE name='"</span> + name + <span class="string">"'"</span>+<span class="string">"AND password=md5('"</span> + password + <span class="string">"')"</span></span><br><span class="line">print(sql)</span><br><span class="line">cur.execute(sql)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur.fetchall():</span><br><span class="line">    print(<span class="string">'查询结果：'</span>, row)</span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></tbody></table></figure>

<p> 3）SQL注入演示结果<br>运行后再终端输入</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 输入正确的用户名和密码</span></span><br><span class="line">Enter name: lisi</span><br><span class="line">您输入的用户name是: lisi</span><br><span class="line">Enter password：lisi123</span><br><span class="line">您输入的密码是: lisi123</span><br><span class="line">SELECT * FROM users WHERE name='lisi'AND password=md5('lisi123')</span><br><span class="line">查询结果：(2, 'lisi', 'lisi@qq.com', 'c3cb6d12c40908943b64bc0681af47db')</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 输出错误密码</span></span><br><span class="line">Enter name: lisi</span><br><span class="line">您输入的用户name是: lisi</span><br><span class="line">Enter password：1234</span><br><span class="line">您输入的密码是: 1234</span><br><span class="line">SELECT * FROM users WHERE name='lisi'AND password=md5('1234')</span><br><span class="line"><span class="meta">#</span><span class="bash"> 没有返回查询结果用户信息的一行，说明密码不正确</span></span><br><span class="line">```~</span><br><span class="line"></span><br><span class="line">```~shell</span><br><span class="line"><span class="meta">#</span><span class="bash"> 因为代码有sql注入漏洞，在用户名后面加入中线，这里还输错误密码，</span></span><br><span class="line">Enter name: lisi' -- '   # -- 中线前后都有空格，中线在sql语句中表示注释意思</span><br><span class="line">您输入的用户name是: lisi' -- '</span><br><span class="line">Enter password：123456 </span><br><span class="line">您输入的密码是: 123456</span><br><span class="line">SELECT * FROM users WHERE name='lisi' -- ''AND password=md5('123456')</span><br><span class="line">查询结果：(2, 'lisi', 'lisi@qq.com', 'c3cb6d12c40908943b64bc0681af47db')</span><br><span class="line"><span class="meta">#</span><span class="bash"> 还是返回查询结果，这里就是通过SQL注入方式绕过网站的安全验证</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --后面的部分当作注释，不起作用</span></span><br></pre></td></tr></tbody></table></figure>

<p>4）怎么修复sql注入问题，其实只要把使用拼接的地方直接换成占位符就可以</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只需要修改成以下方式</span></span><br><span class="line">sql = <span class="string">"SELECT * from users WHERE name=%s and password=md5(%s)"</span></span><br><span class="line">print(sql)</span><br><span class="line">cur.execute(sql, (name, password)) <span class="comment"># execute它会自动执行转义操作</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Enter name: lisi' -- '</span><br><span class="line">您输入的用户name是: lisi' -- '</span><br><span class="line">Enter password：123456</span><br><span class="line">您输入的密码是: 123456</span><br><span class="line">SELECT * from users WHERE name=%s and password=md5(%s)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 没有返回查询结果用户信息的一行，说明密码不正确，并没有像上面的一样绕过安全验证</span></span><br></pre></td></tr></tbody></table></figure>

<p>数据库的三大范式：<br>第一范式:  每一列都不可以再拆分；<br>第二范式：在第一范式的基础上，非主键列完全依赖于主键，而不是主键的一部分。<br>第三范式：在第二范式的基础上，非主键完全依赖于主键，而不是其他的非主键。关联性，每列都与主键有直接关系,不存在传递依赖</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shi-xian-tong-bu-deng-lu-ji-tui-chu-shi-xian-bu-zou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shi-xian-tong-bu-deng-lu-ji-tui-chu-shi-xian-bu-zou/" class="post-title-link" itemprop="url">实现同步登录及退出实现步骤</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="实现同步登录及退出"><a href="#实现同步登录及退出" class="headerlink" title="实现同步登录及退出"></a>实现同步登录及退出</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，准备登录的Django模板、表单<br>新建<code>accounts\templates</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset="UTF-8"&gt;</span><br><span class="line">  &lt;title&gt;用户的基本信息&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">    当前登录的用户是：{{ user.username }}-{{ user.email }}</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">  {% if user.is_authenticated %}</span><br><span class="line">  &lt;a href="/accounts/user/logout/"&gt;退出登录&lt;/a&gt;</span><br><span class="line">  {% endif %}</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">```html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset="UTF-8"&gt;</span><br><span class="line">  &lt;title&gt;用户登录&lt;/title&gt;</span><br><span class="line">  &lt;style type="text/css"&gt;</span><br><span class="line">    .errorlist {</span><br><span class="line">      color: #f00;</span><br><span class="line">    }</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h3&gt;用户登录&lt;/h3&gt;</span><br><span class="line">  &lt;form action="." method="post"&gt;</span><br><span class="line">    {% csrf_token %}</span><br><span class="line">{#    {{ form.as_p }}#}</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 用户名 --&gt;</span><br><span class="line">      {{ form.username.label }}</span><br><span class="line">      {{ form.username }}</span><br><span class="line">      {{ form.username.errors.as_text }}</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 密码 --&gt;</span><br><span class="line">      {{ form.password.label }}</span><br><span class="line">      {{ form.password }}</span><br><span class="line">      {{ form.password.errors.as_text }}</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      {{ form.non_field_errors.as_text }}</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input type="submit" value="登录"&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\forms.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>, max_length=<span class="number">200</span>, min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username, ))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data[<span class="string">'username'</span>]</span><br><span class="line">        password = data[<span class="string">'password'</span>]</span><br><span class="line">        <span class="comment"># username = data.get('username', None)</span></span><br><span class="line">        <span class="comment"># password = data.get('password', None)</span></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">and</span> password:</span><br><span class="line">            <span class="comment"># 查询用户名和密码匹配的用户</span></span><br><span class="line">            user_list = User.objects.filter(username=username)</span><br><span class="line">            err_list = []</span><br><span class="line">            <span class="keyword">if</span> user_list.count() == <span class="number">0</span>:</span><br><span class="line">                err_list.append(forms.ValidationError(<span class="string">'用户名不存在'</span>))</span><br><span class="line">                <span class="comment"># raise forms.ValidationError('用户名不存在')</span></span><br><span class="line">            <span class="comment"># 验证密码是否正确</span></span><br><span class="line">            <span class="comment"># TODO 使用加密算法进行验证</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user_list.filter(password=password).exists():</span><br><span class="line">                <span class="comment"># raise forms.ValidationError('密码不正确')</span></span><br><span class="line">                err_list.append(forms.ValidationError(<span class="string">'密码不正确'</span>))</span><br><span class="line">            <span class="keyword">if</span> err_list:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(err_list)</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\views.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\urls.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户登录表单</span></span><br><span class="line">    path(<span class="string">'user/login/'</span>, views.user_login, name=<span class="string">'user_login'</span>),</span><br><span class="line">    path(<span class="string">'user/info/'</span>, views.user_info, name=<span class="string">'user_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip\urls.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 用户账户模块</span></span><br><span class="line">    path(<span class="string">'accounts/'</span>, include(<span class="string">'accounts.urls'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>第二步，设计用户模型<br><code>accounts\models.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细信息 """</span></span><br><span class="line">    <span class="comment"># 性别</span></span><br><span class="line">    <span class="comment"># 手机号码</span></span><br><span class="line">    <span class="comment"># 年龄</span></span><br><span class="line">    <span class="comment"># 生日</span></span><br><span class="line">    <span class="comment"># 真实姓名</span></span><br><span class="line">    SEX_CHOICES = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'男'</span>),</span><br><span class="line">        (<span class="number">0</span>, <span class="string">'女'</span>),</span><br><span class="line">    )</span><br><span class="line">    username = models.CharField(<span class="string">'用户名'</span>, max_length=<span class="number">64</span>, unique=<span class="literal">True</span>, editable=<span class="literal">False</span>)</span><br><span class="line">    user = models.OneToOneField(User, related_name=<span class="string">'profile'</span>, on_delete=models.CASCADE)</span><br><span class="line">    real_name = models.CharField(<span class="string">'真实姓名'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    email = models.CharField(<span class="string">'电子邮箱'</span>, max_length=<span class="number">128</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_email_valid = models.BooleanField(<span class="string">'邮箱是否已经验证'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    phone_no = models.CharField(<span class="string">'手机号码'</span>, max_length=<span class="number">20</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_phone_valid = models.BooleanField(<span class="string">'是否已经验证'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    sex = models.SmallIntegerField(<span class="string">'性别'</span>, default=<span class="number">1</span>, choices=SEX_CHOICES)</span><br><span class="line">    age = models.SmallIntegerField(<span class="string">'年龄'</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    source = models.CharField(<span class="string">'登录的来源'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    version = models.CharField(<span class="string">'登录的版本'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated_at = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'accounts_user_profile'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginRecord</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录日志 """</span></span><br><span class="line">    <span class="comment"># 关联用户</span></span><br><span class="line">    <span class="comment"># 登录账号</span></span><br><span class="line">    <span class="comment"># 登录的时间</span></span><br><span class="line">    <span class="comment"># ip</span></span><br><span class="line">    <span class="comment"># 登录的来源</span></span><br><span class="line">    <span class="comment"># 登录的客户端版本号</span></span><br><span class="line">    user = models.ForeignKey(User, related_name=<span class="string">'login_records'</span>, on_delete=models.CASCADE)</span><br><span class="line">    username = models.CharField(<span class="string">'登录的账号'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    ip = models.CharField(<span class="string">'IP'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    address = models.CharField(<span class="string">'地址'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    source = models.CharField(<span class="string">'登录的来源'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    version = models.CharField(<span class="string">'登录的版本'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'登录时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'accounts_login_record'</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;python manage.py check</span><br><span class="line">&gt;python manage.py makemigrations</span><br><span class="line">&gt;python manage.py migrate  </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第三步，实现用户的同步登录</p>
</li>
<li><p>第四步，添加登录拦截，用户登录了可以看用户信息，没登陆看用户信息先登录</p>
</li>
<li><p>第五步，实现退出登录的功能用户登录</p>
</li>
<li><p>步骤一：认证用户<br><code>user = authenticate(username='john', password='secret')</code><br><code>accounts\forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>,</span><br><span class="line">                               max_length=<span class="number">200</span>,</span><br><span class="line">                               min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        password = data.get(<span class="string">'password'</span>, <span class="literal">None</span>)</span><br><span class="line">        user = authenticate(username=username, password=password)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'用户名或者是密码不正确'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(<span class="string">'该用户已经被禁用'</span>)</span><br><span class="line">        self.user = user</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>步骤二：判断认证后的用户是否为None<br>用户不为None则表示用户认证通过</p>
</li>
<li><p>步骤三：调用<code>login(request, user, backend=None)</code>函数登录用户<br><code>accounts\forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行用户登录 """</span></span><br><span class="line">        user = self.user</span><br><span class="line">        <span class="comment"># 调用登录</span></span><br><span class="line">        login(request, user)</span><br><span class="line">        <span class="comment"># 修改最后登录的时间</span></span><br><span class="line">        user.last_login = now()</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># TODO 保存登录历史</span></span><br><span class="line">        <span class="keyword">return</span> user</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要登录以后才能访问user_info，</span></span><br><span class="line"><span class="comment"># 否则跳转到登录地址http://127.0.0.1:8000/accounts/user/login/?next=/accounts/user/info/</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="comment"># 方式二  trip/settings.py加上LOGIN_URL = '/accounts/user/login/'</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip/settings.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOGIN_URL = <span class="string">'/accounts/user/login/'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户登录表单</span></span><br><span class="line">    path(<span class="string">'user/login/'</span>, views.user_login, name=<span class="string">'user_login'</span>),</span><br><span class="line">    path(<span class="string">'user/info/'</span>, views.user_info, name=<span class="string">'user_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户退出"><a href="#用户退出" class="headerlink" title="用户退出"></a>用户退出</h3><ul>
<li>使用<code>logout</code>函数退出当前登录的用户<br><code>accounts/views.py</code><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出登录 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户退出登录</span></span><br><span class="line">    path(<span class="string">'user/logout/'</span>, views.user_logout, name=<span class="string">'user_logout'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户登录、退出接口开发"><a href="#用户登录、退出接口开发" class="headerlink" title="用户登录、退出接口开发"></a>用户登录、退出接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 登录和退出的接口</span></span><br><span class="line">    path(<span class="string">'user/api/login/'</span>, views.user_api_login, name=<span class="string">'user_api_login'</span>),</span><br><span class="line">    path(<span class="string">'user/api/logout/'</span>, views.user_api_logout, name=<span class="string">'user_api_logout'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadRequestJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 表单请求验证没有通过，错误显示 """</span></span><br><span class="line">    status_code = <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, err_list=[], *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"400000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"参数格式不正确"</span>,</span><br><span class="line">            <span class="string">"error_list"</span>: err_list</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodNotAllowedJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 请求方式不被允许 """</span></span><br><span class="line">    status_code = <span class="number">405</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"405000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"请求方式不被允许"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 用户的基础信息 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'username'</span>: user.username,</span><br><span class="line">            <span class="string">'nickname'</span>: user.nickname,</span><br><span class="line">            <span class="string">'avatar'</span>: user.avatar.url</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfileSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 用户的详细信息 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        profile = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'real_name'</span>: profile.real_name,</span><br><span class="line">            <span class="string">'sex'</span>: profile.sex,</span><br><span class="line">            <span class="string">'sex_display'</span>: profile.get_sex_display(),</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> UnauthorizedJsonResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录接口-POST """</span></span><br><span class="line">    <span class="comment"># 获取输入的内容</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># 表单验证</span></span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="comment"># 如果通过了验证，执行登录</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            user = form.do_login(request)</span><br><span class="line">            <span class="comment"># 返回内容：用户的信息（用户的基本信息、详细详细）</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果没有通过表单验证，返回表单的错误信息</span></span><br><span class="line">            err = json.loads(form.errors.as_json())</span><br><span class="line">            <span class="keyword">return</span> BadRequestJsonResponse(err)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># GET请求不被允许</span></span><br><span class="line">        <span class="keyword">return</span> MethodNotAllowedJsonResponse()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出接口 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> http.HttpResponse(status=<span class="number">201</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户详情接口开发"><a href="#用户详情接口开发" class="headerlink" title="用户详情接口开发"></a>用户详情接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
<li>第三步，模拟HTTP请求，测试验证接口<br><code>accounts/urls.py</code><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户详细信息接口</span></span><br><span class="line">    path(<span class="string">'user/api/info/'</span>, views.UserDetailView.as_view(), name=<span class="string">'user_api_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnauthorizedJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    status_code = <span class="number">401</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"401000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"请登录"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, MethodNotAllowedJsonResponse, UnauthorizedJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetailView</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细接口 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户信息</span></span><br><span class="line">        user = request.user</span><br><span class="line">        <span class="comment"># 用户：是游客吗？数据库中是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated:</span><br><span class="line">            <span class="comment"># 返回401状态码</span></span><br><span class="line">            <span class="keyword">return</span> UnauthorizedJsonResponse()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 返回详细信息</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br></pre></td></tr></tbody></table></figure>





<p>Parser功能是配置文件进行预处理，因此，每一次更新都会执行一次Parser，因此自定义规则会永远存在，只要你不删除Parser。<br>修改<code>parsers</code></p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">parsers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/profile.yaml
    <span class="token key atrule">yaml</span><span class="token punctuation">:</span>
      <span class="token key atrule">prepend-rules</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> DOMAIN<span class="token punctuation">,</span>test.com<span class="token punctuation">,</span>DIRECT <span class="token comment" spellcheck="true"># rules最前面增加一个规则</span>
      <span class="token key atrule">append-proxies</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test <span class="token comment" spellcheck="true"># proxies最后面增加一个服务</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> http
          <span class="token key atrule">server</span><span class="token punctuation">:</span> 123.123.123.123
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">456</span>
</code></pre>
<p>url：改成本人的订阅地址，如果不知道，可以直接在Profiles下点击当前订阅的Change imformation，复制其中的URL即可。<br>prepen-rules 数组合并至原配置rules数组前 此处添加你的自定义规则，每一条占一行，按照规则类型，值，代理策略排列，使用逗号分隔。注意的是，每一行都需要以一个短横线 - 加一个空格 开头，同时注意对齐。具体的自定义规则如何书写在本文的后半部分有说明。<br>点击右下角保存，<br>在Profiles里更新订阅，这样就可以将新的规则添加上了。可以点击Edit rules查看规则进行验证。之后打开相应网页看是否生效。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/wen-jian-cao-zuo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/wen-jian-cao-zuo/" class="post-title-link" itemprop="url">文件操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="文件读写模式"><a href="#文件读写模式" class="headerlink" title="文件读写模式"></a>文件读写模式</h2><p><code>open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)</code><br>打开一个文件，生成并且返回文件对象，在对文件进行处理过程（创建、读写操作）都需要使用到这个函数，如果该文件无法被打开，会抛出 OSError。<br>默认的创建的目录在当前程序所在的目录，文件不存在，则在当前目录创建该文件<br>file：一个包含了你要访问的文件路径的字符串值。</p>
<p>buffering: 设置缓冲<br>buffering:如果buffering的值被设为0，就不会有寄存。<br>如果buffering的值取1，访问文件时会寄存行。<br>如果将buffering的值设为大于1的整数，表明了这就是的寄存区的缓冲大小。<br>如果取负值，寄存区的缓冲大小则为系统默认。</p>
<p>encoding: Windows系统在写入中文时需要设置编码格式，一般使用utf8<br>errors: 报错级别<br>newline: 区分换行符<br>closefd: 传入的file参数类型<br>opener: 设置自定义开启器，开启器的返回值必须是一个打开的文件描述符。</p>
<p>mode 模式是一个可选非强制字符串，指定打开文件的模式。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">```'w'```写入模式，打开一个文件只用于写入。打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被覆盖删除。如果该文件不存在，创建新文件。</span><br><span class="line">指针在开始</span><br><span class="line"></span><br><span class="line">```'a'```追加(Attach)模式，如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</span><br><span class="line">打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。</span><br><span class="line"></span><br><span class="line">```'b'```二进制模式（与其他模式结合使用）binary mode doesn't take an encoding argument，b模式不能再加上encoding</span><br><span class="line"></span><br><span class="line">```'ab'``` 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</span><br><span class="line"></span><br><span class="line">```'rb'```    以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。</span><br><span class="line"></span><br><span class="line">```+```读写模式（与其他模式结合使用），打开一个文件进行更新(可读可写)。</span><br><span class="line"></span><br><span class="line">```'r+```打开一个文件用于读写。文件指针将会放在文件的开头。</span><br><span class="line">```'W+'```以读写的方式打开文件。打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被覆盖删除。如果该文件不存在，创建新文件。</span><br><span class="line"></span><br><span class="line">```'a+'```如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是读写追加模式。如果该文件不存在，创建新文件用于读写</span><br><span class="line"></span><br><span class="line">```'ab+```以二进制格式打开一个文件用于追加。</span><br><span class="line">如果该文件已存在，文件指针将会放在文件的结尾。</span><br><span class="line">如果该文件不存在，创建新文件用于写入。</span><br><span class="line"></span><br><span class="line">```'rb+'```    以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。</span><br><span class="line"></span><br><span class="line">```'wb'```以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，以二进制格式创建新文件。一般用于非文本文件如图片等。比特类型bytes，字符前缀```b```</span><br><span class="line"></span><br><span class="line">```'wb+'```    以二进制格式打开一个文件用于读写。如果该文件已存在则将其覆盖。如果该文件不存在，创建新文件。</span><br><span class="line"></span><br><span class="line">不使用with语句写法</span><br><span class="line">```py</span><br><span class="line">file=open('文件路径'，访问模式) </span><br><span class="line">data = file.read()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="使用with语法，到达该语句未尾时，将自动close-关闭文件释放资源，即便出现异常亦如此"><a href="#使用with语法，到达该语句未尾时，将自动close-关闭文件释放资源，即便出现异常亦如此" class="headerlink" title="使用with语法，到达该语句未尾时，将自动close()关闭文件释放资源，即便出现异常亦如此"></a>使用with语法，到达该语句未尾时，将自动close()关闭文件释放资源，即便出现异常亦如此</h3><p>中文字体写入默认是GB2312编码。</p>
<ul>
<li><p>不指定编码格式</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open（<span class="string">"file_path"</span>) <span class="keyword">as</span> file：</span><br><span class="line">    do_something(file)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>指定编码格式：<br>指定编码写入，需要打开文件的时候按指定的编码写入，open写encoding编码方式。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 打开</span></span><br><span class="line">file = open(<span class="string">"readme.txt"</span>, <span class="string">"a"</span>, encoding=<span class="string">'utf-8'</span>)  <span class="comment"># a 以追加的方式打开</span></span><br><span class="line"><span class="comment"># 2. 写入文件</span></span><br><span class="line">file.write(<span class="string">"123 hello"</span>)</span><br><span class="line"><span class="comment"># 3. 关闭</span></span><br><span class="line">file.close()</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">当一个文件对象的引用被重新指定给另一个文件时，Python 会关闭之前的文件。</span><br><span class="line">用来关闭文件并立即释放它使用的所有系统资源。如果你没有显式地关闭文件，Python的垃圾回收器最终将销毁该对象并为你关闭打开的文件，但这个文件可能会保持打开状态一段时间。</span><br><span class="line"></span><br><span class="line">一是可能忘记关闭文件句柄；</span><br><span class="line">二是文件读取数据发生异常，没有做异常处理</span><br><span class="line"></span><br><span class="line">一个文件被打开后，你有一个file对象，你可以得到有关该文件对象相关的所有属性的</span><br><span class="line">属性    描述</span><br><span class="line">```file.closed```    返回true如果文件已被关闭，否则返回false。</span><br><span class="line">```file.mode```    返回被打开文件的访问模式。</span><br><span class="line">```file.name```    返回文件的路径。</span><br><span class="line">```py</span><br><span class="line">fo = open("代码\pi_digits.txt", "w")</span><br><span class="line">print("文件路径: ", fo.name)  # 文件路径:  代码\pi_digits.txt</span><br><span class="line">print("是否已关闭 : ", fo.closed)  # 是否已关闭 :  False</span><br><span class="line">print("访问模式 : ", fo.mode)  # 访问模式 :  w</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">如果使用read读了多次，那么后面继续使用read读取的数据是从上次读完后的位置开始的</span><br><span class="line"></span><br><span class="line">```readline([count])```：对文件的数据按行读取，（行的划分是\n）.每次只读取一行。如果有多次读取的话，下面一次读取的偏移量是上面读取后的偏移量。</span><br><span class="line"></span><br><span class="line">```readlines()```：按照行的方式把整个文件中的内容进行一次性读取，读取所有行(直到结束符 EOF)并返回一个列表，其中每一行（按着换行符进行判断一行）的数据为一个元素。</span><br><span class="line"></span><br><span class="line">```write(“string”)```函数向打开的文件对象写入指定字符串，如果文件不存在那么创建，如果存在那么就先清空文件(覆盖)，然后写入数据到文件里。Python字符串可以是二进制数据，而不是仅仅是文字。不会在字符串的结尾添加换行符('\n')</span><br><span class="line"></span><br><span class="line">```writelines(string_list)```函数向打开的文件对象写入多行内容</span><br><span class="line">以往后遇加的模式与入文件</span><br><span class="line"></span><br><span class="line">在默认模式下读取文本文件时（二进制文件不可以），文件中的换行符会转换为'\n'形式。</span><br><span class="line"></span><br><span class="line">在默认模式下写入文件时，文本中的'\n'会转换为换行符。</span><br><span class="line"></span><br><span class="line">```tell()```方法告诉你文件内的当前位置, 换句话说，下一次的读写会发生在文件开头这么多字节之后。</span><br><span class="line"></span><br><span class="line">```seek(offset [,from])```方法改变当前文件的位置。Offset变量表示要移动的字节数。From变量指定开始移动字节的参考位置。</span><br><span class="line"></span><br><span class="line">如果from被设为0，这意味着将文件的开头作为移动字节的参考位置。如果设为1，则使用当前的位置作为参考位置。如果它被设为2，那么该文件的末尾将作为参考位置。</span><br><span class="line"></span><br><span class="line">```seek(3)```从文件起始位置偏移3个字符从第4个字符位置开始读取</span><br><span class="line">```seek(0，0)```重新从文件启始位置读取</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">with open(current_path + '/' + 'test1.txt', 'w+',</span><br><span class="line">          encoding='utf-8') as file_object:</span><br><span class="line">    file_object.write('Ashe正在学习Python')</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    #  &lt;class 'str'&gt; 注意前面有一个空格表示content是空字符串</span><br><span class="line">    # 因为此时读取的是最后一个字符，写完内容之后就是空字符串</span><br><span class="line">    file_object.seek(0)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    # Ashe正在学习Python &lt;class 'str'&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line"><span class="keyword">with</span> open(current_path + <span class="string">'/'</span> + <span class="string">'test1.txt'</span>, <span class="string">'ab+'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    string = <span class="string">b'Ashe Python'</span></span><br><span class="line">    file_object.write(string)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    <span class="comment"># b'' &lt;class 'bytes'&gt; 注意前面有一个空格表示content是空字符串</span></span><br><span class="line">    <span class="comment"># 因为此时读取的是最后一个字符，写完内容之后就是空字符串</span></span><br><span class="line">    file_object.seek(<span class="number">0</span>)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    <span class="comment"># b'Ashe Python' &lt;class 'bytes'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'代码\generate_text.txt'</span></span><br><span class="line"><span class="comment"># 使用‘w’来提醒python用写入的方式打开 指定编码为</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'I love your name!'</span></span><br><span class="line">                     <span class="string">'\nI love your cloth!'</span></span><br><span class="line">                     <span class="string">'\nI love your shoes!'</span></span><br><span class="line">                     <span class="string">'\nI love your hair!'</span>)</span><br><span class="line"><span class="comment"># 使用‘a’来提醒python用附加模式的方式打开指定编码为'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'\nI an superman.我是超人'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用‘a’来提醒python用附加模式的方式打开不指定编码为'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'a'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'\nI an superman.我是超人'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.readline()</span><br><span class="line">    print(<span class="string">"第一次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第一次读取:I love your name!</span></span><br><span class="line">    print(<span class="string">"第一次读取:"</span>, content)</span><br><span class="line">    <span class="comment"># 第一次读取:I love your name!</span></span><br><span class="line"></span><br><span class="line">    content = f.readline()</span><br><span class="line">    print(<span class="string">"第二次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第二次读取:I love your cloth!</span></span><br><span class="line"></span><br><span class="line">    content = f.read(<span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"第三次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第三次读取:I love</span></span><br><span class="line"></span><br><span class="line">    position = f.tell()</span><br><span class="line">    print(<span class="string">"当前文件位置 : "</span>, position)</span><br><span class="line">    <span class="comment"># 当前文件位置 :  45</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把指针再次重新定位到文件开头</span></span><br><span class="line">    position = f.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    str = f.read(<span class="number">16</span>)</span><br><span class="line">    print(<span class="string">"读取的字符串是 : "</span>, str)</span><br><span class="line">    <span class="comment"># 读取的字符串是 :  I love your name</span></span><br><span class="line">    position = f.tell()</span><br><span class="line">    print(<span class="string">"当前文件位置 : "</span>, position)</span><br><span class="line">    <span class="comment"># 当前文件位置 :  16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    print(<span class="string">"读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 读取:I love your name!</span></span><br><span class="line">    <span class="comment"># I love your cloth!</span></span><br><span class="line">    <span class="comment"># I love your shoes!</span></span><br><span class="line">    <span class="comment"># I love your hair!</span></span><br><span class="line">    <span class="comment"># I an superman.鎴戞槸瓒呬汉</span></span><br><span class="line">    <span class="comment"># I an superman.我是超人</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意如果用read（），读取全部，后面再加read(num),就没有内容可读了。返回空字符串</span></span><br><span class="line">    content = f.read(<span class="number">6</span>)</span><br><span class="line">    print(<span class="string">":%s"</span> % content)</span><br><span class="line">    <span class="comment"># :</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.readlines()</span><br><span class="line">    print(<span class="string">"读取:%s"</span> % content)</span><br><span class="line"><span class="comment">#     读取:['I love your name!\n', 'I love your cloth!\n', 'I love your </span></span><br><span class="line"><span class="comment"># shoes!\n', 'I love your hair!\n', 'I an superman.鎴戞槸瓒呬汉\n', </span></span><br><span class="line"><span class="comment"># 'I an superman.我是超人']</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 相对文件路径 （优先使用）</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    contents = file_object.read()</span><br><span class="line">    <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">    print(contents.rstrip())</span><br><span class="line">    <span class="comment"># 3.1415926535  </span></span><br><span class="line">    <span class="comment">#   8979323846  </span></span><br><span class="line">    <span class="comment">#   2643383279  </span></span><br><span class="line">    <span class="comment"># 'abc  '     </span></span><br><span class="line">    <span class="comment"># '  abc'     </span></span><br><span class="line">    <span class="comment"># abc</span></span><br><span class="line">    <span class="comment">#   abc  </span></span><br><span class="line">    print(<span class="string">'******'</span>)</span><br><span class="line">    print(contents.lstrip())</span><br><span class="line">    <span class="comment"># 3.1415926535  </span></span><br><span class="line">    <span class="comment">#   8979323846  </span></span><br><span class="line">    <span class="comment">#   2643383279  </span></span><br><span class="line">    <span class="comment"># 'abc  '     </span></span><br><span class="line">    <span class="comment"># '  abc'     </span></span><br><span class="line">    <span class="comment"># abc</span></span><br><span class="line">    <span class="comment">#   abc </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绝对文件路径</span></span><br><span class="line">file_path = <span class="string">'C:\python代码\牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'----'</span>)</span><br><span class="line">    print(file_object.read())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'======'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file_object:</span><br><span class="line">        <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">        print(line.rstrip())  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'^^^^^^^'</span>)</span><br><span class="line">    lines = file_object.readlines()</span><br><span class="line">    print(lines)</span><br><span class="line">    <span class="comment"># ['3.1415926535\n', '  8979323846\n', '  2643383279\n', "'abc  '\n", "'  abc'\n", 'abc\n', '  abc']</span></span><br><span class="line">    <span class="comment"># 遍历列表，将读取的内容显示出来，按照原来文件的行划分。</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">        print(line.rstrip())串后面的空白</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用文件的内容 读取/拼接</span></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()  <span class="comment"># 读取文件中每行的信息</span></span><br><span class="line">pi_string = <span class="string">''</span>  <span class="comment"># 创建一个字符串</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:  <span class="comment"># 遍历读取到的文件的每行信息 存储到line中</span></span><br><span class="line">    pi_string += line.strip()  <span class="comment"># 读取到的每行信息+创建的字符串  并用strip()去除两端的空格</span></span><br><span class="line">print(pi_string)  <span class="comment"># 输出拼接之后的信息</span></span><br><span class="line"><span class="comment"># 3.141592653589793238462643383279'abc  ''  abc'abcabc</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取一个百万位的大型文件</span></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()  <span class="comment"># 读取文件中每行的信息</span></span><br><span class="line">pi_string = <span class="string">''</span>  <span class="comment"># 创建一个字符串</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:  <span class="comment"># 遍历读取到的文件的每行信息 存储到line中</span></span><br><span class="line">    <span class="comment"># 读取到的每行信息+创建的字符串  并用strip()去除两端的空格</span></span><br><span class="line">    pi_string += line.strip()</span><br><span class="line"><span class="comment"># 输出拼接之后的信息 只输出列表中的前9位 如果输出百万位 把9改为1000000</span></span><br><span class="line">print(pi_string[:<span class="number">9</span>] + <span class="string">'...'</span>)</span><br><span class="line"><span class="comment"># 输出拼接之后的信息的字符串长度</span></span><br><span class="line">print(len(pi_string))</span><br><span class="line"><span class="comment"># 3.1415926...</span></span><br><span class="line"><span class="comment"># 52</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入文件 执行完之后 文件目录中 会生成一个generate_text.txt的文件 </span></span><br><span class="line"><span class="comment"># 内容就是‘正在学习Python’ 在读取写入的文件内容和文件长度</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\generate_doc.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python'</span> + <span class="string">'\n'</span>)</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python1'</span> + <span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'a'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python'</span> + <span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'r'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        print(line.strip())</span><br><span class="line">        print(len(line))</span><br><span class="line">        <span class="comment"># Ashe正在学习Python</span></span><br><span class="line">        <span class="comment"># 15</span></span><br><span class="line">        <span class="comment"># Ashe正在学习Python1</span></span><br><span class="line">        <span class="comment"># 16</span></span><br><span class="line">        <span class="comment"># Ashe正在学习Python</span></span><br><span class="line">        <span class="comment"># 15</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提示用户输入自己的姓名 再将用户输入的姓名写入到文件中输出</span></span><br><span class="line"></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\generate_input.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:  <span class="comment"># w:表示写入(Write)到这个文件中</span></span><br><span class="line">    message = input(<span class="string">'input your name：'</span>)</span><br><span class="line">    file_object.write(message)</span><br><span class="line">    <span class="comment"># input: Ashe</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表数据number存储在number.json 文件中</span></span><br><span class="line">number = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>]</span><br><span class="line">filename = <span class="string">'number.json'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> f_obj:</span><br><span class="line">    <span class="comment"># f_obj:存入到的文件的位置</span></span><br><span class="line">    <span class="comment"># json.dump用来存储。</span></span><br><span class="line">    json.dump(number, f_obj)</span><br><span class="line">    print(<span class="string">'数据存储到'</span> + filename + <span class="string">'完成！'</span>)</span><br><span class="line">    <span class="comment"># 数据存储到number.json完成！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取前面写入到number.json文件的数据内容</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> f_obj:</span><br><span class="line">    <span class="comment"># json.load用来读取。</span></span><br><span class="line">    <span class="comment"># f_obj:读取的数据源的位置</span></span><br><span class="line">    numbers = json.load(f_obj)</span><br><span class="line">    print(numbers)</span><br><span class="line">    <span class="comment"># [2, 3, 4, 5, 7, 11, 13]</span></span><br><span class="line"><span class="comment"># for循环遍历输出读取到的文件中的每条列表中的数据 并 打印输出</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers:</span><br><span class="line">    print(number)</span><br><span class="line">    <span class="comment"># 2</span></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="comment"># 4</span></span><br><span class="line">    <span class="comment"># 5</span></span><br><span class="line">    <span class="comment"># 7</span></span><br><span class="line">    <span class="comment"># 11</span></span><br><span class="line">    <span class="comment"># 13</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data_list = [{</span><br><span class="line">    <span class="string">'href'</span>: <span class="string">'https://bubbleboy11.github.io/'</span>,</span><br><span class="line">    <span class="string">'text'</span>: <span class="string">' 首页'</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'href'</span>: <span class="string">'https://bubbleboy11.github.io/'</span>,</span><br><span class="line">    <span class="string">'text'</span>: <span class="string">' python'</span></span><br><span class="line">}]</span><br><span class="line"><span class="comment"># python按行写入文件</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data_list:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'代码\generate_data.json'</span>, <span class="string">'a+'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        line = json.dumps(item, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">        f.write(line + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按行读取文件的操作方法</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_data.json'</span>, <span class="string">'r'</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 读取所有行 每行会是一个字符串</span></span><br><span class="line">    <span class="keyword">for</span> jsonstr <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="comment"># 将josn字符串转化为dict字典</span></span><br><span class="line">        jsonstr = json.loads(jsonstr)</span><br><span class="line">        print(jsonstr)</span><br><span class="line">        <span class="comment"># {"href": "https://bubbleboy11.github.io/", "text": " 首页"}</span></span><br><span class="line">        <span class="comment"># {"href": "https://bubbleboy11.github.io/", "text": " python"}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">seconds = time.time()</span><br><span class="line">print(seconds)</span><br><span class="line">localtime = time.localtime(seconds)</span><br><span class="line">print(localtime)</span><br><span class="line">print(localtime.tm_year)</span><br><span class="line">print(localtime.tm_mon)</span><br><span class="line">print(localtime.tm_mday)</span><br><span class="line">asctime = time.asctime(localtime)</span><br><span class="line">print(asctime)</span><br><span class="line">strtime = time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>, localtime)</span><br><span class="line">print(strtime)</span><br><span class="line">mydate = time.strptime(<span class="string">'2018-1-1'</span>, <span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">print(mydate)</span><br><span class="line"></span><br><span class="line">shutil.copy(<span class="string">'/Users/Hao/hello.py'</span>, <span class="string">'/Users/Hao/Desktop/first.py'</span>)</span><br><span class="line">os.system(<span class="string">'ls -l'</span>)</span><br><span class="line">os.chdir(<span class="string">'/Users/Hao'</span>)</span><br><span class="line">os.system(<span class="string">'ls -l'</span>)</span><br><span class="line">os.mkdir(<span class="string">'test'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>在项目中需要进行很多重复的操作，如要给代码的源文件添加相同的代码，这个时候一个文件一个文件的操作就很浪费时间了，<br>通过python批处理一秒不到全部添加完成，本代码只是一个抛砖引玉的效果，只要是有特征的文本修改均可由代码完成，解放双手！</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_edit_vhd</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filepath, <span class="string">'r+'</span>) <span class="keyword">as</span> file_head:</span><br><span class="line">        content = file_head.read()</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        file_head.write(<span class="string">"`protect begin \n"</span> + content)</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        file_head.write(<span class="string">"\n`protect end "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_edit_v</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filepath, <span class="string">'r+'</span>) <span class="keyword">as</span> file_head:</span><br><span class="line">        content = file_head.read()</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        file_head.write(<span class="string">"`protect \n"</span> + content)</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        file_head.write(<span class="string">" \n`endprotect "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_text</span>(<span class="params">srcpath</span>):</span>  <span class="comment"># 寻找本文件夹及子文件夹下所以符合要求的文本进行处理</span></span><br><span class="line">    srcdirs = os.listdir(srcpath)</span><br><span class="line">    <span class="keyword">for</span> dir <span class="keyword">in</span> srcdirs:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(os.path.join(srcpath, dir)):  <span class="comment"># 判断dir属性，为文件或者文件夹</span></span><br><span class="line">            add_text(os.path.join(srcpath, dir))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'.vhd'</span> == dir[<span class="number">-4</span>:]:</span><br><span class="line">                print(<span class="string">"正在处理文件中，文件路径为："</span> + os.path.join(srcpath, dir))</span><br><span class="line">                text_edit_vhd(os.path.join(srcpath, dir))</span><br><span class="line">                print(<span class="string">"文件处理完成！"</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">'.v'</span> == dir[<span class="number">-2</span>:]:</span><br><span class="line">                print(<span class="string">"正在处理文件中，文件路径为："</span> + os.path.join(srcpath, dir))</span><br><span class="line">                text_edit_v(os.path.join(srcpath, dir))</span><br><span class="line">                print(<span class="string">"文件处理完成！"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">print(<span class="string">'当前文件路径为：'</span> + current_path)</span><br><span class="line">os.chdir(<span class="string">'..'</span>)</span><br><span class="line">root_path = os.getcwd()</span><br><span class="line">handle_path = root_path + <span class="string">'\handle'</span></span><br><span class="line">print(<span class="string">'当前文件路径为：'</span> + handle_path)</span><br><span class="line">shutil.copytree(path, handle_path)  <span class="comment"># 备份后进行数据处理</span></span><br><span class="line">add_text(handle_path)</span><br><span class="line">print(<span class="string">"run done\n"</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description   : Checks to see if a directory exists in the users home directory, if not then create it</span></span><br><span class="line"><span class="comment"># 检查主目录中是否存在某文件夹，若不存在则创建</span></span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># Import the OS module</span></span><br><span class="line"></span><br><span class="line">MESSAGE = <span class="string">'The directory already exists.'</span></span><br><span class="line">TESTDIR = <span class="string">'testdir'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># Set the variable home by expanding the user's set home directory</span></span><br><span class="line">    home = os.path.expanduser(<span class="string">"~"</span>)</span><br><span class="line">    print(home)  <span class="comment"># Print the location</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># os.path.join() for making a full path safely</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.join(home, TESTDIR)):</span><br><span class="line">        <span class="comment"># If not create the directory, inside their home directory</span></span><br><span class="line">        os.makedirs(os.path.join(home, TESTDIR))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(MESSAGE)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_package</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'%s 已经存在不可创建'</span> % path)</span><br><span class="line">    os.makedirs(path)</span><br><span class="line">    init_path = os.path.join(path, <span class="string">'__init__.py'</span>)</span><br><span class="line">    f = open(init_path, <span class="string">'w'</span>)</span><br><span class="line">    f.write(<span class="string">'# coding:utf-8\n'</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, path, mode=<span class="string">'w'</span>, is_return=True</span>):</span></span><br><span class="line">        self.path = path</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.is_return = is_return</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, message</span>):</span></span><br><span class="line">        f = open(self.path, mode=self.mode)</span><br><span class="line">        <span class="keyword">if</span> self.is_return:</span><br><span class="line">            message = <span class="string">'%s\n'</span> % message</span><br><span class="line">        f.write(message)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self, is_strip=True</span>):</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">with</span> open(self.path, mode=self.mode) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">if</span> is_strip == <span class="literal">True</span>:</span><br><span class="line">                temp = line.strip()</span><br><span class="line">                <span class="keyword">if</span> temp != <span class="string">""</span>:</span><br><span class="line">                    result.append(temp)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> line != <span class="string">''</span>:</span><br><span class="line">                    result.append(line)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    current_path = os.getcwd()</span><br><span class="line">    <span class="comment"># path = os.path.join(current_path, 'test1')</span></span><br><span class="line">    <span class="comment"># create_package(path)</span></span><br><span class="line">    <span class="comment"># open_path = os.path.join(current_path, 'b.txt')</span></span><br><span class="line">    o = Open(<span class="string">'package_datetime.py'</span>, mode=<span class="string">'r'</span>)</span><br><span class="line">    <span class="comment"># o.write('你好 小慕')</span></span><br><span class="line">    data = o.read(is_strip=<span class="literal">False</span>)</span><br><span class="line">    print(data)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-yan-zheng-ma-huo-qu-jie-kou-lian-diao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-yan-zheng-ma-huo-qu-jie-kou-lian-diao/" class="post-title-link" itemprop="url">验证码获取接口联调</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="短信验证码接口开发"><a href="#短信验证码接口开发" class="headerlink" title="短信验证码接口开发"></a>短信验证码接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
</ul>
<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerErrorJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    status_code = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"500000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"服务器正忙，请稍后重试"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>


<p>验证码只存取5分钟，之后自动删除，用redis实现验证码存储<br><code>system/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendSmsCodeForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 发送验证码的表单 """</span></span><br><span class="line">    phone_num = forms.CharField(label=<span class="string">'手机号码'</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_phone_num</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证是否为手机号 """</span></span><br><span class="line">        phone_num = self.cleaned_data[<span class="string">'phone_num'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, phone_num):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(phone_num,))</span><br><span class="line">        <span class="keyword">return</span> phone_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_sms_code</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 生成验证码并发送短信 """</span></span><br><span class="line">        sms_code = random.randint(<span class="number">100000</span>, <span class="number">999999</span>)</span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'phone_num'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># TODO 调用发送验证码的短信接口</span></span><br><span class="line">            <span class="comment"># redis中的key</span></span><br><span class="line">            key = <span class="string">'sms_code_{}'</span>.format(phone_num)</span><br><span class="line">            <span class="comment"># 将验证码存入redis</span></span><br><span class="line">            timeout = <span class="number">5</span> * <span class="number">60</span></span><br><span class="line">            cache.set(key, sms_code, timeout=timeout)</span><br><span class="line">            <span class="keyword">return</span> {</span><br><span class="line">                <span class="string">'phone_num'</span>: phone_num,</span><br><span class="line">                <span class="string">'sms_code'</span>: sms_code,</span><br><span class="line">                <span class="string">'timeout'</span>: timeout</span><br><span class="line">            }</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>system/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> FormView</span><br><span class="line"><span class="keyword">from</span> system.forms <span class="keyword">import</span> SendSmsCodeForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, ServerErrorJsonResponse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_sms</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 1. 拿到手机号，判断是否为真实的手机号码</span></span><br><span class="line">    <span class="comment"># 2. 生成验证码，并存储</span></span><br><span class="line">    <span class="comment"># TODO 3. 调用短信的发送接口</span></span><br><span class="line">    <span class="comment"># 4. 告诉用户验证码发送是否成功（会把验证码直接告诉用户）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmsCodeView</span>(<span class="params">FormView</span>):</span></span><br><span class="line">    form_class = SendSmsCodeForm</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_valid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单已经通过验证 """</span></span><br><span class="line">        data = form.send_sms_code()</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> ServerErrorJsonResponse()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_invalid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单没有通过验证 """</span></span><br><span class="line">        err_list = json.loads(form.errors.as_json())</span><br><span class="line">        <span class="keyword">return</span> BadRequestJsonResponse(err_list)</span><br></pre></td></tr></tbody></table></figure>

<p><code>system/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 发送验证码</span></span><br><span class="line">    path(<span class="string">'send/sms/'</span>, views.SmsCodeView.as_view(), name=<span class="string">"send_sms"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="用户注册接口开发"><a href="#用户注册接口开发" class="headerlink" title="用户注册接口开发"></a>用户注册接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
</ul>
<p><code>utils/constants.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户注册时，发送验证码的redis key</span></span><br><span class="line">REGISTER_MSM_CODE_KEY = <span class="string">'reg_sms_'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>system/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendSmsCodeForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 发送验证码的表单 """</span></span><br><span class="line">    phone_num = forms.CharField(label=<span class="string">'手机号码'</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_phone_num</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证是否为手机号 """</span></span><br><span class="line">        phone_num = self.cleaned_data[<span class="string">'phone_num'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, phone_num):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(phone_num,))</span><br><span class="line">        <span class="keyword">return</span> phone_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_sms_code</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 生成验证码并发送短信 """</span></span><br><span class="line">        sms_code = random.randint(<span class="number">100000</span>, <span class="number">999999</span>)</span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'phone_num'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># TODO 调用发送验证码的短信接口</span></span><br><span class="line">            <span class="comment"># redis中的key</span></span><br><span class="line">            key = <span class="string">'{}{}'</span>.format(constants.REGISTER_MSM_CODE_KEY, phone_num)</span><br><span class="line">            <span class="comment"># 将验证码存入redis</span></span><br><span class="line">            timeout = <span class="number">5</span> * <span class="number">60</span></span><br><span class="line">            cache.set(key, sms_code, timeout=timeout)</span><br><span class="line">            <span class="keyword">return</span> {</span><br><span class="line">                <span class="string">'phone_num'</span>: phone_num,</span><br><span class="line">                <span class="string">'sms_code'</span>: sms_code,</span><br><span class="line">                <span class="string">'timeout'</span>: timeout</span><br><span class="line">            }</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User, Profile</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>,</span><br><span class="line">                               max_length=<span class="number">200</span>,</span><br><span class="line">                               min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        password = data.get(<span class="string">'password'</span>, <span class="literal">None</span>)</span><br><span class="line">        user = authenticate(username=username, password=password)</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'用户名或者是密码不正确'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(<span class="string">'该用户已经被禁用'</span>)</span><br><span class="line">        self.user = user</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行用户登录 """</span></span><br><span class="line">        user = self.user</span><br><span class="line">        <span class="comment"># 调用登录</span></span><br><span class="line">        login(request, user)</span><br><span class="line">        <span class="comment"># 修改最后登录的时间</span></span><br><span class="line">        user.last_login = now()</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># TODO 保存登录历史</span></span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'手机号码'</span>, max_length=<span class="number">16</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>, max_length=<span class="number">128</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入密码'</span></span><br><span class="line">    })</span><br><span class="line">    nickname = forms.CharField(label=<span class="string">'昵称'</span>, max_length=<span class="number">16</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入昵称'</span></span><br><span class="line">    })</span><br><span class="line">    sms_code = forms.CharField(label=<span class="string">'验证码'</span>, max_length=<span class="number">6</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入验证码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">if</span> User.objects.filter(username=username).exists():</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号已经被使用'</span>)</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_nickname</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 昵称验证 """</span></span><br><span class="line">        nickname = self.cleaned_data[<span class="string">'nickname'</span>]</span><br><span class="line">        <span class="keyword">if</span> User.objects.filter(nickname=nickname).exists():</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'昵称已经被使用'</span>)</span><br><span class="line">        <span class="keyword">return</span> nickname</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        sms_code = self.cleaned_data.get(<span class="string">'sms_code'</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># redis 中的验证码key</span></span><br><span class="line">        key = <span class="string">'{}{}'</span>.format(constants.REGISTER_MSM_CODE_KEY, phone_num)</span><br><span class="line">        code = cache.get(key)</span><br><span class="line">        <span class="comment"># code 已失效</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> code:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'验证码已经失效'</span>)</span><br><span class="line">        <span class="keyword">if</span> str(code) != sms_code:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'验证码输入不正确'</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">    @transaction.atomic</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_register</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行注册 """</span></span><br><span class="line">        data = self.cleaned_data</span><br><span class="line">        version = request.headers.get(<span class="string">'version'</span>, <span class="string">''</span>)</span><br><span class="line">        source = request.headers.get(<span class="string">'source'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 1. 创建基础信息表</span></span><br><span class="line">            user = User.objects.create_user(</span><br><span class="line">                username=data.get(<span class="string">'username'</span>, <span class="literal">None</span>),</span><br><span class="line">                password=data.get(<span class="string">'password'</span>, <span class="literal">None</span>),</span><br><span class="line">                nickname=data.get(<span class="string">'nickname'</span>, <span class="literal">None</span>)</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># 2. 创建详细表</span></span><br><span class="line">            profile = Profile.objects.create(</span><br><span class="line">                user=user,</span><br><span class="line">                username=user.username,</span><br><span class="line">                version=version,</span><br><span class="line">                source=source</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># 3. 执行登录</span></span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="comment"># 4. 记录登录日志</span></span><br><span class="line">            user.last_login = now()</span><br><span class="line">            user.save()</span><br><span class="line">            ip = request.META.get(<span class="string">'REMOTE_ADDR'</span>, <span class="string">''</span>)</span><br><span class="line">            user.add_login_record(username=user.username, ip=ip, source=source, version=version)</span><br><span class="line">            <span class="keyword">return</span> user, profile</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> FormView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm, RegisterForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, MethodNotAllowedJsonResponse, UnauthorizedJsonResponse, \</span><br><span class="line">    ServerErrorJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要登录以后才能访问user_info，</span></span><br><span class="line"><span class="comment"># 否则跳转到登录地址http://127.0.0.1:8000/accounts/user/login/?next=/accounts/user/info/</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出登录 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录接口-POST """</span></span><br><span class="line">    <span class="comment"># 获取输入的内容</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># 表单验证</span></span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="comment"># 如果通过了验证，执行登录</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            user = form.do_login(request)</span><br><span class="line">            <span class="comment"># 返回内容：用户的信息（用户的基本信息、详细详细）</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果没有通过表单验证，返回表单的错误信息</span></span><br><span class="line">            err = json.loads(form.errors.as_json())</span><br><span class="line">            <span class="keyword">return</span> BadRequestJsonResponse(err)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># GET请求不被允许</span></span><br><span class="line">        <span class="keyword">return</span> MethodNotAllowedJsonResponse()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出接口 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> http.HttpResponse(status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetailView</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细接口 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户信息</span></span><br><span class="line">        user = request.user</span><br><span class="line">        <span class="comment"># 用户：是游客吗？数据库中是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated:</span><br><span class="line">            <span class="comment"># 返回401状态码</span></span><br><span class="line">            <span class="keyword">return</span> UnauthorizedJsonResponse()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 返回详细信息</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_register</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册 """</span></span><br><span class="line">    <span class="comment"># 1. 表单，验证用户输入的信息（用户名、昵称、验证码）</span></span><br><span class="line">    <span class="comment"># 2. 创建用户基础信息表、用户详细信息表</span></span><br><span class="line">    <span class="comment"># 3. 执行登录</span></span><br><span class="line">    <span class="comment"># 4. 保存登录日志</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRegisterView</span>(<span class="params">FormView</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册接口 """</span></span><br><span class="line">    form_class = RegisterForm</span><br><span class="line">    http_method_names = [<span class="string">'post'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_valid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单已经通过验证 """</span></span><br><span class="line">        result = form.do_register(request=self.request)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            user, profile = result</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> ServerErrorJsonResponse()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_invalid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单没有通过验证 """</span></span><br><span class="line">        err_list = json.loads(form.errors.as_json())</span><br><span class="line">        <span class="keyword">return</span> BadRequestJsonResponse(err_list)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">   <span class="comment"># 用户注册</span></span><br><span class="line">    path(<span class="string">'user/api/register/'</span>, views.UserRegisterView.as_view(), name=<span class="string">'user_api_register'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="验证码获取接口联调"><a href="#验证码获取接口联调" class="headerlink" title="验证码获取接口联调"></a>验证码获取接口联调</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，阅读接口文档</li>
<li>第二步，配置接口地址<br><code>src\utils\apis.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统模块的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> SystemApis = {</span><br><span class="line">  <span class="comment">// 发送短信验证码</span></span><br><span class="line">  sendSmsCodeUrl: apiHost + <span class="string">'/system/send/sms/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>src\components\common\SendSmsCode.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 短信验证码发送相关的逻辑 --&gt;</span><br><span class="line">  &lt;van-button</span><br><span class="line">    size="small"</span><br><span class="line">    type="primary"</span><br><span class="line">    @click.prevent="sendSmsCode()"</span><br><span class="line">    :disabled="isSmsSend"</span><br><span class="line">    &gt;{{ sendBtnText }}&lt;/van-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SystemApis } from '@/utils/apis'</span><br><span class="line">export default {</span><br><span class="line">  props: ['phoneNum'],</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 是否已经发送了验证码，不能再点击发送验证码</span><br><span class="line">      isSmsSend: false,</span><br><span class="line">      sendBtnText: '点击发送验证码',</span><br><span class="line">      timer: null,</span><br><span class="line">      counter: 60</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    reset () {</span><br><span class="line">      this.isSmsSend = false</span><br><span class="line">      this.sendBtnText = '点击发送验证码'</span><br><span class="line">      if (this.timer) {</span><br><span class="line">        clearInterval(this.timer)</span><br><span class="line">        this.counter = 60</span><br><span class="line">        this.timer = null</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 倒计时</span><br><span class="line">     */</span><br><span class="line">    countDown () {</span><br><span class="line">      this.timer = setInterval(() =&gt; {</span><br><span class="line">        this.sendBtnText = `(${this.counter}秒)后重新发送`</span><br><span class="line">        this.counter--</span><br><span class="line">        if (this.counter &lt; 0) {</span><br><span class="line">          this.reset()</span><br><span class="line">        }</span><br><span class="line">      }, 1000)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 发送验证码</span><br><span class="line">     */</span><br><span class="line">    sendSmsCode () {</span><br><span class="line">      // 判断手机号是否已经输入</span><br><span class="line">      if (!this.phoneNum) {</span><br><span class="line">        this.$notify('请输入手机号')</span><br><span class="line">        return false // 不在执行后面的逻辑</span><br><span class="line">      }</span><br><span class="line">      // TODO 调用接口，发送短信验证码</span><br><span class="line">      ajax.post(SystemApis.sendSmsCodeUrl, {</span><br><span class="line">        phone_num: this.phoneNum</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        // 提示用户验证码已经发送</span><br><span class="line">        this.$notify({</span><br><span class="line">          message: `验证码为：${data.sms_code}，${data.timeout / 60}分钟内有效`,</span><br><span class="line">          duration: 1000 * 10, // 提示持续时间 </span><br><span class="line">          type: 'success'</span><br><span class="line">        })</span><br><span class="line">        this.isSmsSend = true</span><br><span class="line">        // 开启倒计时, 60s之后才能再次点击</span><br><span class="line">        this.countDown()</span><br><span class="line">      }).catch(err =&gt; {</span><br><span class="line">        // 如果产生了异常，提示用户重新操作</span><br><span class="line">        this.isSmsSend = false</span><br><span class="line">        this.sendBtnText = '点击发送验证码'</span><br><span class="line">        console.log(err)</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>第三步，使用axios获取数据</li>
<li>第四步，将数据设置到模型层</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lian-biao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lian-biao/" class="post-title-link" itemprop="url">链表</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>python用类来实现链表的数据结构</p>
<p>数组 就是连续的 同一个类型的 元素，而且必须是固定的长度。<br>把数组看做一个内存空间，数组下标就是这个空间的地址，支持根据下标快速访问。<br>但连续存储的缺点也很明显，增加容量，增删元素的成本很高，时间复杂度均为 O(n)。<br>增加数组容量需要先申请一块新的内存，然后复制原有的元素。<br>如果需要的话，可能还要删除原先的内存。</p>
<p>线性表的实际存储方式，分为两种实现模型：<br>1顺序表的构建需要预先知道数据大小来申请连续的存储空间，<br>将元素顺序地存放在一块连续的存储区里<br>而在进行扩充时又需要进行数据的搬迁，<br>元素间的顺序关系由它们的存储顺序自然表示。<br>访问指定元素时无需从头遍历，通过计算便可获得对应地址，其时间复杂度为O(1)。<br>一个顺序表的完整信息包括两部分，<br>一部分是表中的元素集合，<br>另一部分是为实现正确操作而需记录的信息，即有关表的整体情况的信息，<br>这部分信息主要包括元素存储区的容量和当前表中已有的元素个数两项。</p>
<p>2.链表Linked list：知道了它的头就知道了它的全部，所以最后直接返回头节<br>算法题的自变量head都是链表头节点，不是链表<br>将元素存放在通过链接构造起来的一系列存储块中。<br>如果我们想要非固定的长度来存储数据。这个时候就出现了表链。<br>链表是一种物理存储单元上非连续、非顺序的存储结构，<br>链表失去了顺序表随机读取的优点，同时链表由于增加了结点的指针域，<br>空间开销比较大，但对存储空间的使用要相对灵活。<br>充分利用计算机内存空间，实现灵活的内存动态管理。<br>数据元素的逻辑顺序是通过链表中的指针链接次序实现的。</p>
<p>单向链表链表由一系列结点（链表中每一个元素称为结点）组成，<br>结点可以在运行时动态生成。</p>
<p>顺序表查找很快，主要耗时的操作是拷贝覆盖。<br>因为除了目标元素在尾部的特殊情况，<br>顺序表进行插入和删除时需要对操作点之后的所有元素进行前后移位操作，<br>只能通过拷贝和覆盖的方法进行。</p>
<p>相比于线性表顺序结构，操作复杂。由于不必须按顺序存储，<br>链表在插入的时候可以达到O(1)的复杂度，<br>但是查找一个节点或者访问特定编号的节点，不能像数组一样随机根据下标访问，<br>你想查找一个元素只能老老实实从头遍历，则需要O(n)的时间，</p>
<p>无法高效获取长度，无法根据偏移快速访问元素，是链表的两个劣势。<br>然而面试的时候经常碰见诸如获取倒数第k个元素，获取中间位置的元素，<br>判断链表是否存在环，判断环的长度等和长度与位置有关的问题。<br>这些问题都可以通过灵活运用双指针来解决。</p>
<p>Tips：双指针并不是固定的公式，而是一种思维方式</p>
<p>链表中的基本要素：<br>1.节点类（Node）或元素)，单链表每个结点有两个域，<br>左边部份叫值域（数据域），value 属性保存值 存储数据元素的域)。<br>头结点的内存地址没有存储在其他结点的指针域<br>右边叫指针域(next)，有一个指针保存指向下一个节点地址位置信，next存储直接后继存储位置的域称为。<br>用 node.next 访问下一个节点。最后一个结点的next指向为None(空值)</p>
<p>对于单链表结构可以使用 calss 的两个属性表示 val , next。</p>
<p>实现一个Node类：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.val = x  <span class="comment"># val: 节点保存的数据元素</span></span><br><span class="line">        self.next = <span class="literal">None</span>  <span class="comment"># next: 保存下一个节点对象的地址</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>此节点类只有一个构建函数，接收一个数据参数，<br>其中next表示指针域的指针，</p>
<p>实例化后得到一个节点对象</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node = Node(<span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>此节点对象数据为4，指针指向None。<br>[]C:\python代码\牛客网剑指offer66题思路分析\图解说明\节点.jpg</p>
<p>2.head结点，head结点永远指向第一个结点<br>3.tail结点，tail结点永远指向最后一个节点<br>4.None，链表中最后一个结点tail指针域的指针next指向None值，</p>
<p><img src="/2020/08/21/lian-biao/%E5%9B%BE%E8%A7%A3%E8%AF%B4%E6%98%8E%5C%E9%93%BE%E8%A1%A8.png" alt="linked_list">  </p>
<p><img src="/2020/08/21/lian-biao/python代码\牛客网剑指offer66题思路分析\图解说明\append1.jpg" alt="avatar"><br><img src="/2020/08/21/lian-biao/python代码\牛客网剑指offer66题思路分析\图解说明\链表.png" alt="avatar"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span>  <span class="comment"># 传入一个参数</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Node(<span class="number">1</span>)</span><br><span class="line">b = Node(<span class="number">2</span>)</span><br><span class="line">c = Node(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">a.next = b</span><br><span class="line">b.next = c</span><br><span class="line"></span><br><span class="line">head = a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(a.next.val)  <span class="comment"># 2</span></span><br><span class="line">print(a.next.next.val)  <span class="comment"># 3</span></span><br><span class="line">print(a.next.next.next.val)</span><br><span class="line"><span class="comment"># AttributeError: 'NoneType' object has no attribute 'val'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 链表的创建</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_linklist_head</span>(<span class="params">li</span>):</span></span><br><span class="line">    <span class="comment"># 头插</span></span><br><span class="line">    head = Node(li[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> li[<span class="number">1</span>:]:</span><br><span class="line">        node = Node(item)  <span class="comment"># 生成节点</span></span><br><span class="line">        node.next = head  <span class="comment"># next指向原来的头部</span></span><br><span class="line">        head = node  <span class="comment"># head 指向在头部插入的节点</span></span><br><span class="line">    <span class="keyword">return</span> head  <span class="comment"># 返回头部</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_linklist_tail</span>(<span class="params">li</span>):</span></span><br><span class="line">    <span class="comment"># 尾插</span></span><br><span class="line">    head = Node(li[<span class="number">0</span>])</span><br><span class="line">    tail = head</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> li[<span class="number">1</span>:]:</span><br><span class="line">        node = Node(item)  <span class="comment"># Node类实例化得到一个node对象。</span></span><br><span class="line">        tail.next = node  <span class="comment"># 把原来尾巴的下一个指针指向当前node</span></span><br><span class="line">        tail = node  <span class="comment"># 尾巴 指向新部插入的节点</span></span><br><span class="line">    <span class="keyword">return</span> head  <span class="comment"># 返回头部</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_linklist</span>(<span class="params">linklist</span>):</span></span><br><span class="line">    <span class="keyword">while</span> linklist:</span><br><span class="line">        print(linklist.val, end=<span class="string">', '</span>)</span><br><span class="line">        linklist = linklist.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lk = create_linklist_head([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print_linklist(lk)  <span class="comment"># 3, 2, 1,</span></span><br><span class="line">print(<span class="string">'---'</span>)</span><br><span class="line">lk_tail = create_linklist_tail([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print_linklist(lk_tail)  <span class="comment"># 1, 2, 3,</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedListNode</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, next=None, value=None</span>):</span></span><br><span class="line">        self.next = next</span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个链表</span></span><br><span class="line">lk_head = LinkedListNode()</span><br><span class="line">myList = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(myList)):</span><br><span class="line">    lk_head = LinkedListNode(lk_head, myList[i])</span><br><span class="line">print(lk_head)  <span class="comment"># &lt;__main__.LinkedListNode object at 0x00000271CCFBFDF0&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_linklist</span>(<span class="params">lk</span>):</span>  <span class="comment"># lk任意命名</span></span><br><span class="line">    <span class="keyword">while</span> lk:</span><br><span class="line">        print(lk.value, end=<span class="string">', '</span>)</span><br><span class="line">        lk = lk.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 头插：链表新插入的节点在表头，</span></span><br><span class="line"><span class="comment"># 因此，实际上链表中的顺序，与插入列表的顺序是反过来 逆序</span></span><br><span class="line">print_linklist(lk_head)  <span class="comment"># 5, 4, 3, 2, 1, None,</span></span><br></pre></td></tr></tbody></table></figure>

<p>链表的常用方法：<br>LinkedList() 创建空链表，不需要参数，返回值是空链表</p>
<p>is_empty() 测试链表是否为空，不需要参数，只需要检查head节点是否指向None</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> self.head <span class="keyword">is</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>
<p>返回值是布尔值，如果是空列表返回True，否则返回False</p>
<p>append(data) 尾插：在尾部增加一个元素作为链表最后一个<br>参数是要追加的元素，无返回值</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        node = Node(data)</span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># head指向None，链表是一个空链表</span></span><br><span class="line">            self.head = node  <span class="comment"># 把链表的head和tail都指向了node，</span></span><br><span class="line">            self.tail = node</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 当链表不是空链表时</span></span><br><span class="line">            self.tail.next = node  <span class="comment"># 将尾节点的next指向新节点</span></span><br><span class="line">            self.tail = node  <span class="comment"># 将尾节点指向新节点</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link_list(append(<span class="number">4</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>增加第二个节点的操作需要分两步完成，<br>第一步：self.tail.next = node，即把上一个节点的next指针指向当前node；<br>第二步：self.tail = node，把tail移动到node，</p>
<p>当if self.head is None:为False时,<br>说明链表已经增加了一个节点了，<br>再增加一个节点时head已经指向了第一个节点，<br>所以不为None，<br>比如增加的第二个节点为：</p>
<p>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append1.jpg<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append2.jpg<br>当增加第三个、第四个等节点时，按照上边的操作依次类推。</p>
<p>iter() 遍历链表，无参数，无返回值，此方法一般是一个生成器<br>在遍历链表时也要首先考虑空链表的情况。<br>遍历链表时从head开始，直到一个节点的next指向None结束</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.head:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        <span class="keyword">yield</span> cur.data</span><br><span class="line">        <span class="keyword">while</span> cur.next:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">yield</span> cur.data</span><br></pre></td></tr></tbody></table></figure>
<p>当是遍历一个空链表时，if not self.head:为True，直接返回None；<br>如果不是空链表就让一个局部变量cur指向head,<br>并把head的data属性yield出来，<br>再对cur的next指针指向的对象做while循环，<br>直到next指向None，这样就遍历了链表。</p>
<p>insert(idx,value) 插入一个元素，参数为插入元素的索引和值<br>假如采取append方法又增加了两个节点，增加完成后如下图：<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append3.jpg</p>
<p>如果想在数据域为6的那节点处插入一个节点，需要做的操作有两步：<br>1.把新节点的next指针指向数据域为6的这个节点，即为数据域为5节点的next指向指向的对象<br>2.把数据域为5节点的next指针指向新加的节点<br>注： 这两个步骤不能颠倒，如果颠倒，数据域为6的节点会被丢失，数据域为7的节点不再是链表的节点。<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\insert.jpg</p>
<p>还要额外考虑两种情况：<br>1.空链表时<br>2.插入位置超出链表节点的长度时<br>3.插入位置是链表的最后一个节点时，需要移动tail<br>当是在链表最后一个节点插入时，示意图如下：<br>[]C:\python代码\牛客网剑指offer66题思路分析\图解说明\insert2.jpg<br>要在指定的索引位置插入一个节点，前提是需要找到这个位置，<br>在链表中只有采用遍历的方式，具有O(n)的速度，<br>最糟糕时会遍历链表的所有节点，<br>而当找到插入点时，我们并不需要当前节点的信息，<br>而是需要前一个节点的信息，<br>所以代码中巧妙的使用了while cur_idx &lt; idx-1:的方式，<br>这样能使用cur这个变量能指向插入点上一个节点对象。<br>实现insert方法的代码如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, idx, value</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="comment"># 在某元素后插入</span></span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx<span class="number">-1</span>:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        node = Node(value)</span><br><span class="line">        node.next = cur.next  <span class="comment"># 新插入的节点指向第一个的原来next的指向</span></span><br><span class="line">        cur.next = node</span><br><span class="line">        <span class="keyword">if</span> node.next <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.tail = node</span><br></pre></td></tr></tbody></table></figure>

<p>remove(idx)移除1个元素，参数为要移除的元素或索引，并修改链表<br>接收一个idx参数，表示要删除节点的索引，此方法要考虑以下几种情况：<br>1.空链表，直接抛出异常<br>2.删除第一个节点时，移动head到删除节点的next指针指向的对象<br>3.链表只有一个节点时，把head与tail都指向None即可<br>4.删除最后一个节点时，需要移动tail到上一个节点<br>5.遍历链表时要判断给定的索引是否大于链表的长度，如果大于则抛出异常信息<br>O(n)</p>
<p>请看下边图例：<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\remove1.jpg<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\remove2.jpg<br>以下为remove函数的代码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">       cur = self.head</span><br><span class="line">       cur_idx = <span class="number">0</span></span><br><span class="line">       <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 空链表时</span></span><br><span class="line">           <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">       <span class="keyword">while</span> cur_idx &lt; idx<span class="number">-1</span>:</span><br><span class="line">           cur = cur.next</span><br><span class="line">           <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">               <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">           cur_idx += <span class="number">1</span></span><br><span class="line">       <span class="keyword">if</span> idx == <span class="number">0</span>:   <span class="comment"># 当删除第一个节点时</span></span><br><span class="line">           self.head = cur.next</span><br><span class="line">           cur = cur.next</span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       <span class="keyword">if</span> self.head <span class="keyword">is</span> self.tail:   <span class="comment"># 当只有一个节点的链表时</span></span><br><span class="line">           self.head = <span class="literal">None</span></span><br><span class="line">           self.tail = <span class="literal">None</span></span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       cur.next = cur.next.next</span><br><span class="line">       <span class="keyword">if</span> cur.next <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 当删除的节点是链表最后一个节点时</span></span><br><span class="line">           self.tail = cur</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 在某元素后删除节点node = cur.next </span></span><br><span class="line">       <span class="comment"># cur.next = cur.next.next  # 被删的节点指向第一个的原来next的指向</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>size() 返回链表的元素数，不接收参数，返回值是链表中节点的个数，<br>要获得链表的节点个数，必定会遍历链表，<br>直到最后一个节点的next指针指向None时链表遍历完成，<br>遍历时可以用一个累加器来计算节点的个数，如下代码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">size</span>(<span class="params">self</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> current <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'The list is an empty list'</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            current = current.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br></pre></td></tr></tbody></table></figure>

<p>search(item) 查找链表某元素，<br>search函数接收一个item参数，表示查找节点中数据域的值,要查找的元素或索引。<br>search函数遍历链表，每到一个节点把当前节点的data值与item作比较，<br>最糟糕的情况下会全遍历链表。O(n)<br>如果查找到有些数据则返回True，否则返回False，代码如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.data == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current = current.next</span><br><span class="line">        <span class="keyword">return</span> found</span><br></pre></td></tr></tbody></table></figure>

<p>Node类与LinkedList类完整代码整理如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.head = <span class="literal">None</span></span><br><span class="line">        self.tail = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.head <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        node = Node(data)  <span class="comment"># 实列化节点</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.head = node</span><br><span class="line">            self.tail = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.tail.next = node</span><br><span class="line">            self.tail = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">iter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.head:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        <span class="keyword">yield</span> cur.data</span><br><span class="line">        <span class="keyword">while</span> cur.next:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">yield</span> cur.data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, idx, value</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 判断是否是空链表</span></span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx - <span class="number">1</span>:  <span class="comment"># 遍历链表</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 判断是不是最后一个元素</span></span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        node = Node(value)</span><br><span class="line">        node.next = cur.next</span><br><span class="line">        cur.next = node</span><br><span class="line">        <span class="keyword">if</span> node.next <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.tail = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 空链表时</span></span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx - <span class="number">1</span>:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> idx == <span class="number">0</span>:  <span class="comment"># 当删除第一个节点时</span></span><br><span class="line">            self.head = cur.next</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> self.tail:  <span class="comment"># 当只有一个节点的链表时</span></span><br><span class="line">            self.head = <span class="literal">None</span></span><br><span class="line">            self.tail = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur.next = cur.next.next</span><br><span class="line">        <span class="keyword">if</span> cur.next <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 当删除的节点是链表最后一个节点时</span></span><br><span class="line">            self.tail = cur</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span>(<span class="params">self</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> current <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'The list is an empty list'</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            current = current.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.data == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current = current.next</span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    link_list = LinkedList()  <span class="comment"># 实列化链表</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        link_list.append(i)</span><br><span class="line">    print(link_list)</span><br><span class="line">    <span class="comment">#    print(link_list.is_empty())</span></span><br><span class="line">    <span class="comment">#    link_list.insert(10, 30)</span></span><br><span class="line">    <span class="comment">#    link_list.remove(0)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> link_list.iter():</span><br><span class="line">        print(<span class="string">'node is {0}'</span>.format(node))</span><br><span class="line">    print(link_list.size())</span><br><span class="line"><span class="comment">#    print(link_list.search(20))</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>单向循环链表<br>单链表的一个变形是单向循环链表，链表中最后一个节点的next域不再为None，而是指向链表的头节点。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""节点"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        self.item = item</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SinCycLinkedlist</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""单向循环链表"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""判断链表是否为空"""</span></span><br><span class="line">        <span class="keyword">return</span> self._head == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">length</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""返回链表的长度"""</span></span><br><span class="line">        <span class="comment"># 如果链表为空，返回长度0</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">travel</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""遍历链表"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        print(cur.item)</span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            print(cur.item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""头部添加节点"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            self._head = node</span><br><span class="line">            node.next = self._head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#添加的节点指向_head</span></span><br><span class="line">            node.next = self._head</span><br><span class="line">            <span class="comment"># 移到链表尾部，将尾部节点的next指向node</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment">#_head指向添加node的</span></span><br><span class="line">            self._head = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""尾部添加节点"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            self._head = node</span><br><span class="line">            node.next = self._head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 移到链表尾部</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将尾节点指向node</span></span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment"># 将node指向头节点_head</span></span><br><span class="line">            node.next = self._head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, pos, item</span>):</span></span><br><span class="line">        <span class="string">"""在指定位置添加节点"""</span></span><br><span class="line">        <span class="keyword">if</span> pos &lt;= <span class="number">0</span>:</span><br><span class="line">            self.add(item)</span><br><span class="line">        <span class="keyword">elif</span> pos &gt; (self.length()<span class="number">-1</span>):</span><br><span class="line">            self.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = Node(item)</span><br><span class="line">            cur = self._head</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 移动到指定位置的前一个位置</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; (pos<span class="number">-1</span>):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                cur = cur.next</span><br><span class="line">            node.next = cur.next</span><br><span class="line">            cur.next = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""删除一个节点"""</span></span><br><span class="line">        <span class="comment"># 若链表为空，则直接返回</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># 将cur指向头节点</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        pre = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 若头节点的元素就是要查找的元素item</span></span><br><span class="line">        <span class="keyword">if</span> cur.item == item:</span><br><span class="line">            <span class="comment"># 如果链表不止一个节点</span></span><br><span class="line">            <span class="keyword">if</span> cur.next != self._head:</span><br><span class="line">                <span class="comment"># 先找到尾节点，将尾节点的next指向第二个节点</span></span><br><span class="line">                <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                    cur = cur.next</span><br><span class="line">                <span class="comment"># cur指向了尾节点</span></span><br><span class="line">                cur.next = self._head.next</span><br><span class="line">                self._head = self._head.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 链表只有一个节点</span></span><br><span class="line">                self._head = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pre = self._head</span><br><span class="line">            <span class="comment"># 第一个节点不是要删除的</span></span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                <span class="comment"># 找到了要删除的元素</span></span><br><span class="line">                <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                    <span class="comment"># 删除</span></span><br><span class="line">                    pre.next = cur.next</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pre = cur</span><br><span class="line">                    cur = cur.next</span><br><span class="line">            <span class="comment"># cur 指向尾节点</span></span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="comment"># 尾部删除</span></span><br><span class="line">                pre.next = cur.next</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""查找节点是否存在"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">if</span> cur.item == item:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    ll = SinCycLinkedlist()</span><br><span class="line">    ll.add(<span class="number">1</span>)</span><br><span class="line">    ll.add(<span class="number">2</span>)</span><br><span class="line">    ll.append(<span class="number">3</span>)</span><br><span class="line">    ll.insert(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">    ll.insert(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    ll.insert(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br><span class="line">    print(ll.search(<span class="number">3</span>))</span><br><span class="line">    print(ll.search(<span class="number">7</span>))</span><br><span class="line">    ll.remove(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br></pre></td></tr></tbody></table></figure>

<p>双链表<br>相比单链表来说，每个节点既保存了指向下一个节点的指针，最后一个结点next指向为None(空)。<br>同时还保存了上一个节点的指针，双链表第一个结点pre指向为None(空)</p>
<p>双链表每个结点包括三个域，<br>pre指针指向上一个结点，val存储数据值，next指针指向下一个结点。</p>
<p>对于双链表可以使用class 的三个属性pre, val, next。</p>
<p>对， 就多了 prev，有啥优势嘛？</p>
<ul>
<li><p>直接删除节点，当然如果给的是一个值，我们还是需要查找这个值在哪个节点？ - 但是如果给了一个节点，我们把它拿掉，直接让它的前后节点互相指过去不就行了？哇欧，删除就是 O(1) 了，两步操作就行啦</p>
</li>
<li><p>看似我们反过来遍历双链表了。反过来从哪里开始呢？我们只要让 root 的 prev 指向 tail 节点，不就串起来了吗？<br>循环双端列表就是在双列表基础上把最后一个结点next指向第一个结点，第一个结点pre指向最后一个结点，这样就形成循环双端链表。</p>
</li>
</ul>
<p>最 </p>
<table>
<thead>
<tr>
<th>循环双端链表操作 CircularDoubleLinkedList 大写字母缩写 cdll</th>
<th>平均时间复杂度</th>
</tr>
</thead>
<tbody><tr>
<td>cdll.append(value)</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.appendleft(value)</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.remove(node)，注意这里参数是 node</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.headnode()</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.tailnode()</td>
<td>O(1)</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="comment"># 如果节点很多，我们可以用 __slots__ 来节省内存，把属性保存在一个 tuple 而不是 dict 里</span></span><br><span class="line">    <span class="comment"># 感兴趣可以自行搜索  python  __slots__</span></span><br><span class="line">    __slots__ = (<span class="string">'value'</span>, <span class="string">'prev'</span>, <span class="string">'next'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value=None, prev=None, next=None</span>):</span></span><br><span class="line">        self.value, self.prev, self.next = value, prev, next</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""双向链表节点"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        self.item = item</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line">        self.prev = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DLinkList</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""双向链表"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""判断链表是否为空"""</span></span><br><span class="line">        <span class="keyword">return</span> self._head == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">length</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""返回链表的长度"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">travel</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""遍历链表"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            print(cur.item,</span><br><span class="line">            cur = cur.next</span><br><span class="line">        print(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""头部插入元素"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将_head指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 将node的next指向_head的头节点</span></span><br><span class="line">            node.next = self._head</span><br><span class="line">            <span class="comment"># 将_head的头节点的prev指向node</span></span><br><span class="line">            self._head.prev = node</span><br><span class="line">            <span class="comment"># 将_head 指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""尾部插入元素"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将_head指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 移动到链表尾部</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != <span class="literal">None</span>:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将尾节点cur的next指向node</span></span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment"># 将node的prev指向cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""查找元素是否存在"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure>


<p>双链表节点的插入<br>中间值插入的情况<br>p.next = cur.next<br>cur.next.prev = p<br>p.prev = cur<br>cur.next = p</p>
<p>指定位置插入节点</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, pos, item</span>):</span></span><br><span class="line">        <span class="string">"""在指定位置添加节点"""</span></span><br><span class="line">        <span class="keyword">if</span> pos &lt;= <span class="number">0</span>:</span><br><span class="line">            self.add(item)</span><br><span class="line">        <span class="keyword">elif</span> pos &gt; (self.length()<span class="number">-1</span>):</span><br><span class="line">            self.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = Node(item)</span><br><span class="line">            cur = self._head</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 移动到指定位置的前一个位置</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; (pos<span class="number">-1</span>):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将node的prev指向cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line">            <span class="comment"># 将node的next指向cur的下一个节点</span></span><br><span class="line">            node.next = cur.next</span><br><span class="line">            <span class="comment"># 将cur的下一个节点的prev指向node</span></span><br><span class="line">            cur.next.prev = node</span><br><span class="line">            <span class="comment"># 将cur的next指向node</span></span><br><span class="line">            cur.next = node</span><br></pre></td></tr></tbody></table></figure>

<p>双链表节点的删除，<br>当然如果给的是一个值，我们还是需要查找这个值在哪个节点？ </p>
<ul>
<li>但是如果给了一个节点，我们把它拿掉，直接让它的前后节点互相指过去不就行了？<br>删除就是 O(1) 了，两步操作就行啦</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""删除元素"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="comment"># 如果首节点的元素即是要删除的元素</span></span><br><span class="line">                <span class="keyword">if</span> cur.next == <span class="literal">None</span>:</span><br><span class="line">                    <span class="comment"># 如果链表只有这一个节点</span></span><br><span class="line">                    self._head = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 将第二个节点的prev设置为None</span></span><br><span class="line">                    cur.next.prev = <span class="literal">None</span></span><br><span class="line">                    <span class="comment"># 将_head指向第二个节点</span></span><br><span class="line">                    self._head = cur.next</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                    <span class="comment"># 将cur的前一个节点的next指向cur的后一个节点</span></span><br><span class="line">                    cur.prev.next = cur.next</span><br><span class="line">                    <span class="comment"># 将cur的后一个节点的prev指向cur的前一个节点</span></span><br><span class="line">                    cur.next.prev = cur.prev</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                cur = cur.next</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    ll = DLinkList()</span><br><span class="line">    ll.add(<span class="number">1</span>)</span><br><span class="line">    ll.add(<span class="number">2</span>)</span><br><span class="line">    ll.append(<span class="number">3</span>)</span><br><span class="line">    ll.insert(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">    ll.insert(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    ll.insert(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br><span class="line">    print(ll.search(<span class="number">3</span>))</span><br><span class="line">    print(ll.search(<span class="number">4</span>))</span><br><span class="line">    ll.remove(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br></pre></td></tr></tbody></table></figure>


<p>中间值p = cur.next删除的情况<br>cur.next = p.next<br>p.next.prev = cur<br>cur.next = p<br>del p</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/vue/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="广泛使用的前端开发框架"><a href="#广泛使用的前端开发框架" class="headerlink" title="广泛使用的前端开发框架"></a>广泛使用的前端开发框架</h3><p>-PC端网页<br>-移动端H5站点<br>-小程序<br>-App(安卓、ios)</p>
<h3 id="用于开发单页面应用"><a href="#用于开发单页面应用" class="headerlink" title="用于开发单页面应用"></a>用于开发单页面应用</h3><p>-只有一个HTML页面( Single Page web Application,SPA)<br>-使用 JavaScript动态切换HTML内容</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>-用户体验更好<br>-减轻服务器的压力<br>-前后端完全分离,通过接口( Restful api)进行通信<br>-接口代码的复用<br>1.体积小<br>压缩后33K<br>2.更高的运行效率<br>基于虚拟dom,一种可以预先通过 JavaScript进行各种计算,把最终的DOM操作<br>计算出来并优化的技术,由于这个DOM操作属于预处理操作,并没有真实的操<br>作DOM,所以叫做虚拟DOM<br>3.双向数据绑定<br>让开发者不用再去操作dom对象,把更多的精力投入到业务逻辑上<br>4生态丰富、学习成本低<br>市场上拥有大量成熟、稳定的基于 vue.S的u框架、常用组件!拿来<br>即用实现快速开发!<br>对初学者友好、入门容易、学习资料多;</p>
<p>Vue生态圈<br>-官方维护开发的框架及扩展<br>-第三方UI框架、组件库<br>如:实战中要使用的 VantUI<br>-基于 Node.js的模块<br>-完整的技术文档和学习资料</p>
<p>vue项目<br>方式一:引用 vue.Js<br><code>&lt;script src="./vue.Js&gt;&lt;/script&gt;</code></p>
<p>-方式二:使用∨ue CLI搭建项目</p>
<p>vue的实例</p>
<ul>
<li><p>示例代码<br><code>var app= new Vue(options)</code></p>
</li>
<li><p><code>el</code>参数<br>挂载到某个HTML标签</p>
</li>
<li><p><code>data</code>参数/属性</p>
<ul>
<li>存放当前组件所需要的数据</li>
<li>它是响应式的,data某一属性改变当值发生改变的同时，视图也会改变，浏览器dom结构当中会自动跟随改变<br>放在data中的属性。</li>
</ul>
</li>
<li><p><code>computed</code>计算属性</p>
<ul>
<li>用于复杂的逻辑</li>
<li>定义的js函数没有形式参数</li>
<li>必须有返回值，使用插值语法，在界面上显示<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">computed: {</span><br><span class="line">    a() {</span><br><span class="line"></span><br><span class="line">    },</span><br><span class="line">    b() {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
<li><p><code>methods</code>参数，不能少复数的<code>s</code></p>
<ul>
<li>可以直接通过∨ue实例访问的方法</li>
<li>定义的js函数有形式参数，可以相互调用</li>
<li>处理js事件</li>
</ul>
</li>
<li><p><code>template</code>参数</p>
<ul>
<li>模板,如果不指定,则使用默认的html模板</li>
<li>有template参数选项，可以通过 <code>render</code>参数从组建渲染,将其作为模板编译成render函数。</li>
<li>如果没有template选项，则将外部HTML作为模板编译。</li>
<li>template中的模板优先级要高于outer HTML的优先级。</li>
</ul>
</li>
</ul>
<p>MVVM架构<br>       View Model<br>View  DOM Listeners =&gt; model<br>(DOM)  Directives       JavaScript Object<br>        DOM操作 </p>
<p>Vue.js中 ViewModel层处理了DOM的操作，使我们的开发更简单</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单操作<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- v-model, @click都是vue.js的属性  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 点击事件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> @<span class="attr">click</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>{{ uname }}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>动态列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"加载"</span> @<span class="attr">click</span>=<span class="string">"load"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in dataList"</span>&gt;</span>{{item}}<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> app = <span class="keyword">new</span> Vue({</span></span><br><span class="line"><span class="javascript">            el: <span class="string">"#app"</span>,  <span class="comment">// Vue实例接管el指定的标签id ="app"当中所有的内容</span></span></span><br><span class="line"><span class="javascript">            data: { <span class="attr">username</span>: <span class="string">'admin'</span>, <span class="attr">dataList</span>: [] },</span></span><br><span class="line">            computed: {</span><br><span class="line">                uname() {</span><br><span class="line"><span class="javascript">                    <span class="comment">// 类方法中的this指向类的实例</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> <span class="built_in">this</span>.username[<span class="number">0</span>] + <span class="string">"***"</span></span></span><br><span class="line">                }</span><br><span class="line">            },</span><br><span class="line">            methods: {</span><br><span class="line">                submit() {</span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">"获取表单的值："</span>, <span class="built_in">this</span>.username)</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">this</span>.load()</span></span><br><span class="line">                },</span><br><span class="line">                load() {</span><br><span class="line"><span class="javascript">                    <span class="built_in">this</span>.dataList = [<span class="string">'Beijing'</span>, <span class="string">'Shanghai'</span>, <span class="string">'Guangzhou'</span>, <span class="string">'Shenzhen'</span>]</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        })</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>在通过live server在浏览器中，F12或右键inspector-console，<br>点击提交按钮，控制台会输出<code>获取表单的值： admin</code><br>页面会加载’Beijing’, ‘Shanghai’, ‘Guangzhou’, ‘Shenzhen’</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>对于一个程序或Vue.js中的一个实例来说，其生命周期经过一系列的初始化过程开始创建，<br>一个程序本身和程序中的每一个实例和组件都存在生命周期。<br>生命周期：就是从一个组件或实例开始初始化、创建实例到该实例被销毁的过程。</p>
<p>在这个生命周期之间，进行初始化事件，进行数据的观测，可以看到在created的时候数据已经和data属性进行绑定<br>每个 Vue 实例在被创建时都要经过一系列的初始化过程——例如，需要设置数据监听、编译模板、将实例挂载到 DOM 并在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做生命周期钩子的函数，这给了用户在不同阶段添加自己的代码的机会。</p>
<h3 id="钩子函数-不能使用箭头函数"><a href="#钩子函数-不能使用箭头函数" class="headerlink" title="钩子函数 不能使用箭头函数"></a>钩子函数 不能使用箭头函数</h3><p>Vue实例从创建到销毁的过程中 ，这些过程中会伴随着一些函数的自调用，在某一个时间点Vue实例会自动执行的函数称为钩子函数。<br>为什么叫做钩子呢？原因是对于某个实例事件发生后需要响应已经预设好的代码，即某一个钩子钩住了一个实例的状态或者事件。</p>
<ol>
<li><p>beforeCreate<br>在实例初始化之后，数据观测 (data observer) 和 event/watcher 事件配置之前被调用。此时的 data 和 methods 中的 数据都还没有没初始化。</p>
</li>
<li><p>created<br>在实例创建完成后被立即调用。在这一步，实例已完成以下的配置：数据观测 (data observer)，属性和方法的运算，watch/event 事件回调。也就是此时 data 和 methods已经初始化完成了。然而，挂载阶段还没开始，<code>$el</code> 属性目前尚不可用。 页面还没有渲染出来。<br>注意：<br>如果要调用 methods 中的方法，或者操作 data 中的数据，最早只能在 created 中进行操作。</p>
</li>
<li><p>beforeMount</p>
</li>
</ol>
<ul>
<li>如果有<code>el</code>和<code>template</code>，在挂载开始之前被调用。此时页面上还看不到真实的数据，因为模板在内存中编译完成了，但是还没有把模板渲染到页面中。<br>注意：<br>在 beforeMount 执行的时候，页面中的元素还没有被真正替换过来，显示的是之前写的一些模板字符串。</li>
</ul>
<p>以下代码在浏览器显示是一级标题的test，<code>template: '&lt;h1&gt;test&lt;/h1&gt;'</code>替换了<code>el: '#app'</code>也就是替换了<code>id="app"</code>为<code>&lt;div&gt;</code>的所有内容</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单操作<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> @<span class="attr">click</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>动态列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"加载"</span> @<span class="attr">click</span>=<span class="string">"load"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue({  <span class="comment">// app是全局变量，在浏览器控制台输入app可以访问到此象</span></span></span><br><span class="line"><span class="javascript">        el: <span class="string">'#app'</span>,</span></span><br><span class="line"><span class="handlebars"><span class="xml">        template: '<span class="tag">&lt;<span class="name">h1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>',</span></span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            username: <span class="string">'admin'</span>,</span></span><br><span class="line">            dataList: []</span><br><span class="line">        },</span><br><span class="line">        methods: {</span><br><span class="line">            submit() {</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'获取表单的值：'</span>, <span class="built_in">this</span>.username)</span></span><br><span class="line">            },</span><br><span class="line">            load() {</span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.dataList = [<span class="string">'北京'</span>, <span class="string">'上海'</span>, <span class="string">'广州'</span>, <span class="string">'深圳'</span>]</span></span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        beforeCreate() {  <span class="comment">// 没有箭头函数</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeCreate'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="comment">// console.log(this.load())</span></span></span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        <span class="comment">// beforeCreate: () =&gt; {</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   console.log('beforeCreate')</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   // console.log(this.load())</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// },</span></span></span><br><span class="line">        created() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'created'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.load())</span></span><br><span class="line">        },</span><br><span class="line">        beforeMount() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeMount'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        mounted() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'mounted'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeDestroy() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeDestroy'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        destroyed() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'destroyed'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeUpdate() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeUpdate'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        updated() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'updated'</span>)</span></span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">beforeCreate</span></span><br><span class="line"><span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line"><span class="selector-tag">beforeMount</span></span><br><span class="line"><span class="selector-tag">mounted</span></span><br><span class="line"><span class="selector-tag">indexVue</span><span class="selector-class">.html</span><span class="selector-pseudo">:98</span> <span class="selector-tag">Live</span> <span class="selector-tag">reload</span> <span class="selector-tag">enabled</span>.</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>如果没有<code>el</code>，浏览器显示<code>id="app"</code>为<code>&lt;div&gt;</code>的所有内容</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单操作<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> @<span class="attr">click</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>动态列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"加载"</span> @<span class="attr">click</span>=<span class="string">"load"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue({  <span class="comment">// app是全局变量，在浏览器控制台输入app可以访问到此象</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// el: '#app',</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">        template: '<span class="tag">&lt;<span class="name">h1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>',</span></span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            username: <span class="string">'admin'</span>,</span></span><br><span class="line">            dataList: []</span><br><span class="line">        },</span><br><span class="line">        methods: {</span><br><span class="line">            submit() {</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'获取表单的值：'</span>, <span class="built_in">this</span>.username)</span></span><br><span class="line">            },</span><br><span class="line">            load() {</span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.dataList = [<span class="string">'北京'</span>, <span class="string">'上海'</span>, <span class="string">'广州'</span>, <span class="string">'深圳'</span>]</span></span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        beforeCreate() {  <span class="comment">// 没有箭头函数</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeCreate'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="comment">// console.log(this.load())</span></span></span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        <span class="comment">// beforeCreate: () =&gt; {</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   console.log('beforeCreate')</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   // console.log(this.load())</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// },</span></span></span><br><span class="line">        created() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'created'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.load())</span></span><br><span class="line">        },</span><br><span class="line">        beforeMount() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeMount'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        mounted() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'mounted'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeDestroy() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeDestroy'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        destroyed() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'destroyed'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeUpdate() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeUpdate'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        updated() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'updated'</span>)</span></span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight actionscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate</span><br><span class="line">created</span><br><span class="line"><span class="literal">undefined</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>如果没有<code>el</code>，在手动<code>$mount('#app')</code>指定挂载到</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单操作<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> @<span class="attr">click</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>动态列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"加载"</span> @<span class="attr">click</span>=<span class="string">"load"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue({  <span class="comment">// app是全局变量，在浏览器控制台输入app可以访问到此象</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// el: '#app',</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">        template: '<span class="tag">&lt;<span class="name">h1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>',</span></span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            username: <span class="string">'admin'</span>,</span></span><br><span class="line">            dataList: []</span><br><span class="line">        },</span><br><span class="line">        methods: {</span><br><span class="line">            submit() {</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'获取表单的值：'</span>, <span class="built_in">this</span>.username)</span></span><br><span class="line">            },</span><br><span class="line">            load() {</span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.dataList = [<span class="string">'北京'</span>, <span class="string">'上海'</span>, <span class="string">'广州'</span>, <span class="string">'深圳'</span>]</span></span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        beforeCreate() {  <span class="comment">// 没有箭头函数</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeCreate'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="comment">// console.log(this.load())</span></span></span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        <span class="comment">// beforeCreate: () =&gt; {</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   console.log('beforeCreate')</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   // console.log(this.load())</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// },</span></span></span><br><span class="line">        created() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'created'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.load())</span></span><br><span class="line">        },</span><br><span class="line">        beforeMount() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeMount'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        mounted() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'mounted'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeDestroy() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeDestroy'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        destroyed() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'destroyed'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeUpdate() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeUpdate'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        updated() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'updated'</span>)</span></span><br><span class="line">        }</span><br><span class="line"><span class="javascript">    }).$mount(<span class="string">'#app'</span>)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">indexVue</span><span class="selector-class">.html</span><span class="selector-pseudo">:37</span> <span class="selector-tag">beforeCreate</span></span><br><span class="line"><span class="selector-tag">indexVue</span><span class="selector-class">.html</span><span class="selector-pseudo">:45</span> <span class="selector-tag">created</span></span><br><span class="line"><span class="selector-tag">indexVue</span><span class="selector-class">.html</span><span class="selector-pseudo">:46</span> <span class="selector-tag">undefined</span></span><br><span class="line"><span class="selector-tag">indexVue</span><span class="selector-class">.html</span><span class="selector-pseudo">:49</span> <span class="selector-tag">beforeMount</span></span><br><span class="line"><span class="selector-tag">indexVue</span><span class="selector-class">.html</span><span class="selector-pseudo">:52</span> <span class="selector-tag">mounted</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>如果没有<code>template</code>和<code>el</code>属性，浏览器显示<code>id="app"</code>为<code>&lt;div&gt;</code>的所有内容</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单操作<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> @<span class="attr">click</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>动态列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"加载"</span> @<span class="attr">click</span>=<span class="string">"load"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue({  <span class="comment">// app是全局变量，在浏览器控制台输入app可以访问到此象</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// el: '#app',</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">        // template: '<span class="tag">&lt;<span class="name">h1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>',</span></span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            username: <span class="string">'admin'</span>,</span></span><br><span class="line">            dataList: []</span><br><span class="line">        },</span><br><span class="line">        methods: {</span><br><span class="line">            submit() {</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'获取表单的值：'</span>, <span class="built_in">this</span>.username)</span></span><br><span class="line">            },</span><br><span class="line">            load() {</span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.dataList = [<span class="string">'北京'</span>, <span class="string">'上海'</span>, <span class="string">'广州'</span>, <span class="string">'深圳'</span>]</span></span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        beforeCreate() {  <span class="comment">// 没有箭头函数</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeCreate'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="comment">// console.log(this.load())</span></span></span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        <span class="comment">// beforeCreate: () =&gt; {</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   console.log('beforeCreate')</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//   // console.log(this.load())</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// },</span></span></span><br><span class="line">        created() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'created'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.load())</span></span><br><span class="line">        },</span><br><span class="line">        beforeMount() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeMount'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        mounted() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'mounted'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeDestroy() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeDestroy'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        destroyed() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'destroyed'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeUpdate() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeUpdate'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        updated() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'updated'</span>)</span></span><br><span class="line">        }</span><br><span class="line"><span class="javascript">    }).$mount(<span class="string">'#app'</span>)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">beforeCreate</span></span><br><span class="line"><span class="keyword">created</span></span><br><span class="line"><span class="keyword">undefined</span></span><br><span class="line"><span class="keyword">beforeMount</span></span><br><span class="line"><span class="keyword">mounted</span></span><br></pre></td></tr></tbody></table></figure>
<p>在浏览器控制台输入<code>app</code></p>
<figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app</span><br><span class="line"><span class="keyword">wn</span>&nbsp;{_uid: <span class="number">0</span>, _isVue: true, $option<span class="variable">s:</span> {…}, _renderProxy: <span class="keyword">wn</span>, _self: <span class="keyword">wn</span>,&nbsp;…}$attr<span class="variable">s:</span> (...)$children: []$createElemen<span class="variable">t:</span> ƒ (<span class="keyword">e</span>,n,r,i)$<span class="keyword">e</span><span class="variable">l:</span> div#app$listener<span class="variable">s:</span> (...)$option<span class="variable">s:</span> {component<span class="variable">s:</span> {…}, directive<span class="variable">s:</span> {…}, <span class="built_in">filter</span><span class="variable">s:</span> {…}, _base: ƒ, dat<span class="variable">a:</span> ƒ,&nbsp;…}$paren<span class="variable">t:</span> undefined$ref<span class="variable">s:</span> {}$roo<span class="variable">t:</span> <span class="keyword">wn</span>&nbsp;{_uid: <span class="number">0</span>, _isVue: true, $option<span class="variable">s:</span> {…}, _renderProxy: <span class="keyword">wn</span>, _self: <span class="keyword">wn</span>,&nbsp;…}$scopedSlot<span class="variable">s:</span> {}$slot<span class="variable">s:</span> {}$vnode: undefineddataLis<span class="variable">t:</span> (...)load: ƒ ()submi<span class="variable">t:</span> ƒ ()username: (...)_c: ƒ (<span class="keyword">e</span>,n,r,i)_dat<span class="variable">a:</span> {__ob__: we}_directInactive: false_event<span class="variable">s:</span> {}_hasHookEven<span class="variable">t:</span> false_inactive: null_isBeingDestroyed: false_isDestroyed: false_isMounted: true_isVue: true_renderProxy: <span class="keyword">wn</span>&nbsp;{_uid: <span class="number">0</span>, _isVue: true, $option<span class="variable">s:</span> {…}, _renderProxy: <span class="keyword">wn</span>, _self: <span class="keyword">wn</span>,&nbsp;…}_self: <span class="keyword">wn</span>&nbsp;{_uid: <span class="number">0</span>, _isVue: true, $option<span class="variable">s:</span> {…}, _renderProxy: <span class="keyword">wn</span>, _self: <span class="keyword">wn</span>,&nbsp;…}_staticTree<span class="variable">s:</span> null_uid: <span class="number">0</span>_vnode: <span class="keyword">pe</span>&nbsp;{<span class="keyword">ta</span><span class="variable">g:</span> <span class="string">"div"</span>, dat<span class="variable">a:</span> {…}, children: Array(<span class="number">11</span>), tex<span class="variable">t:</span> undefined, elm: div#app,&nbsp;…}_watcher: fn&nbsp;{<span class="keyword">vm</span>: <span class="keyword">wn</span>, deep: false, user: false, lazy: false, <span class="keyword">sync</span>: false,&nbsp;…}_watcher<span class="variable">s:</span> [fn]$dat<span class="variable">a:</span> (...)$isServer: (...)$prop<span class="variable">s:</span> (...)$ssrContex<span class="variable">t:</span> (...)<span class="built_in">get</span> $attr<span class="variable">s:</span> ƒ ()<span class="keyword">set</span> $attr<span class="variable">s:</span> ƒ (t)<span class="built_in">get</span> $listener<span class="variable">s:</span> ƒ ()<span class="keyword">set</span> $listener<span class="variable">s:</span> ƒ (t)<span class="built_in">get</span> dataLis<span class="variable">t:</span> ƒ ()<span class="keyword">set</span> dataLis<span class="variable">t:</span> ƒ (<span class="keyword">e</span>)<span class="built_in">get</span> username: ƒ ()<span class="keyword">set</span> username: ƒ (<span class="keyword">e</span>)__proto__: Object</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>在浏览器控制台输入<code>app.$destroy()</code></p>
<figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">app</span>.<span class="variable">$destroy</span>()</span><br><span class="line">beforeDestroy</span><br><span class="line">destroyed</span><br></pre></td></tr></tbody></table></figure>

<ol start="4">
<li>mounted</li>
</ol>
<ul>
<li>如果有<code>el</code>，实例被挂载后调用，这时 <code>el</code> 被新创建的 <code>vm.$el</code> 替换了。此时数据已经真实渲染到页面上了。<br>mounted 是实例创建期间的最后一个生命周期函数，当执行完 mounted 就表示，实例已经被完全创建好了。</li>
</ul>
<p>注意：<br>mounted 不会保证所有的子组件也都一起被挂载。如果你希望等到整个视图都渲染完毕，可以在 mounted 内部使用 vm.$nextTick：</p>
<ol start="5">
<li>beforeUpdate Update<br>当vue发现data中的数据发生了改变，会触发对应组件的重新渲染，先后调用beforeUpdate和updated钩子函数。</li>
</ol>
<p>console能打印出来并不一定就是有“值”，console当打印出来的是基本数据类型时候当然没问题，否则对于复杂数据类型是会发生改变的，因为只是地址引用而已</p>
<p>在通过live server在浏览器中，F12或右键inspect-console，<br>点击提交按钮，控制台会输出</p>
<p>以下代码在浏览器显示是一级标题的test，<code>template: '&lt;h1&gt;test&lt;/h1&gt;'</code>替换了<code>el: '#app'</code>也就是替换了<code>id="app"</code>为<code>&lt;div&gt;</code>的所有内容</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单操作<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span> @<span class="attr">click</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>动态列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"加载"</span> @<span class="attr">click</span>=<span class="string">"load"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in dataList"</span>&gt;</span>{{ item }}<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue({</span></span><br><span class="line"><span class="javascript">        <span class="comment">// el: '#app',</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">        // template: '<span class="tag">&lt;<span class="name">h1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>',</span></span></span><br><span class="line">        data: {</span><br><span class="line"><span class="javascript">            username: <span class="string">'admin'</span>,</span></span><br><span class="line">            dataList: []</span><br><span class="line">        },</span><br><span class="line">        methods: {</span><br><span class="line">            submit() {</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'获取表单的值：'</span>, <span class="built_in">this</span>.username)</span></span><br><span class="line">            },</span><br><span class="line">            load() {</span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.dataList = [<span class="string">'北京'</span>, <span class="string">'上海'</span>, <span class="string">'广州'</span>, <span class="string">'深圳'</span>]</span></span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        beforeCreate: <span class="function">() =&gt;</span> {  <span class="comment">// 有箭头函数</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeCreate'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>)  <span class="comment">// window 指向window</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// console.log(this.load())  // 报错，不可以调用vue的实例的方法</span></span></span><br><span class="line">        },</span><br><span class="line"><span class="javascript">        created() {  <span class="comment">// 没有箭头函数</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'created'</span>)</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>)  <span class="comment">// wn  指向vue的实例</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.load())  <span class="comment">// 可以调用vue的实例的方法</span></span></span><br><span class="line">        },</span><br><span class="line">        beforeMount() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeMount'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        mounted() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'mounted'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeDestroy() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeDestroy'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        destroyed() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'destroyed'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        beforeUpdate() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'beforeUpdate'</span>)</span></span><br><span class="line">        },</span><br><span class="line">        updated() {</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'updated'</span>)</span></span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate</span><br><span class="line">Window&nbsp;{<span class="attr">window:</span> Window, <span class="attr">self:</span> Window, <span class="attr">document:</span> document, <span class="attr">name:</span> <span class="string">""</span>, <span class="attr">location:</span> Location,&nbsp;…}</span><br><span class="line">created</span><br><span class="line">wn&nbsp;{<span class="attr">_uid:</span> <span class="number">0</span>, <span class="attr">_isVue:</span> <span class="literal">true</span>, <span class="attr">$options:</span> {…}, <span class="attr">_renderProxy:</span> wn, <span class="attr">_self:</span> wn,&nbsp;…}</span><br><span class="line">undefined</span><br></pre></td></tr></tbody></table></figure>




<hr>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>{{ message }}<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> app = <span class="keyword">new</span> Vue({</span></span><br><span class="line"><span class="javascript">            el: <span class="string">"#app"</span>,</span></span><br><span class="line">            data() {</span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> { <span class="attr">message</span>: <span class="string">"Hello World"</span> }</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            created: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"created"</span>)</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            beforeCreate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"beforeCreate"</span>)</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            beforeMount: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"beforeMount"</span>)</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            beforeUpdate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"beforeUpdate"</span>)</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"mounted"</span>)</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            beforeDestroy: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"beforeDestroy"</span>)</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            updated: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"updated"</span>)</span></span><br><span class="line">            },</span><br><span class="line"><span class="javascript">            destroyed: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"destroyed"</span>)</span></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">beforeCreate</span></span><br><span class="line"><span class="keyword">created</span></span><br><span class="line"><span class="keyword">beforeMount</span></span><br><span class="line"><span class="keyword">mounted</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue生命周期学习<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/vue/2.4.2/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>{{message}}<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue({</span></span><br><span class="line"><span class="javascript">    el: <span class="string">'#app'</span>,</span></span><br><span class="line">    data: {</span><br><span class="line"><span class="javascript">      message: <span class="string">'Vue的生命周期'</span></span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    beforeCreate: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'------beforeCreate创建前状态------'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span> , <span class="string">"el     : "</span> + <span class="built_in">this</span>.$el); <span class="comment">//undefined</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); <span class="comment">//undefined </span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message) </span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    created: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'------created创建完毕状态------'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"el     : "</span> + <span class="built_in">this</span>.$el); <span class="comment">//undefined</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); <span class="comment">//已被初始化 </span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message); <span class="comment">//已被初始化</span></span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    beforeMount: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'------beforeMount挂载前状态------'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"el     : "</span> + (<span class="built_in">this</span>.$el)); <span class="comment">//已被初始化</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.$el);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); <span class="comment">//已被初始化  </span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message); <span class="comment">//已被初始化  </span></span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    mounted: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'------mounted 挂载结束状态------'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"el     : "</span> + <span class="built_in">this</span>.$el); <span class="comment">//已被初始化</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.$el);    </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); <span class="comment">//已被初始化</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message); <span class="comment">//已被初始化 </span></span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    beforeUpdate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'beforeUpdate 更新前状态===============》'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"el     : "</span> + <span class="built_in">this</span>.$el);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.$el);   </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message); </span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    updated: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'updated 更新完成状态===============》'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"el     : "</span> + <span class="built_in">this</span>.$el);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.$el); </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message); </span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    beforeDestroy: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'beforeDestroy 销毁前状态===============》'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"el     : "</span> + <span class="built_in">this</span>.$el);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.$el);    </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message); </span></span><br><span class="line">    },</span><br><span class="line"><span class="javascript">    destroyed: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.group(<span class="string">'destroyed 销毁完成状态===============》'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"el     : "</span> + <span class="built_in">this</span>.$el);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.$el);  </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"data   : "</span> + <span class="built_in">this</span>.$data); </span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"%c%s"</span>, <span class="string">"color:red"</span>,<span class="string">"message: "</span> + <span class="built_in">this</span>.message)</span></span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight ldif"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">------beforeCreate创建前状态------</span></span><br><span class="line"><span class="attribute">el     </span>: undefined</span><br><span class="line"><span class="attribute">data   </span>: undefined</span><br><span class="line"><span class="attribute">message</span>: undefined</span><br><span class="line"><span class="literal">------created创建完毕状态------</span></span><br><span class="line"><span class="attribute">el     </span>: undefined</span><br><span class="line"><span class="attribute">data   </span>: [object Object]</span><br><span class="line"><span class="attribute">message</span>: Vue的生命周期</span><br><span class="line"><span class="literal">------beforeMount挂载前状态------</span></span><br><span class="line"><span class="attribute">el     </span>: [object HTMLDivElement]</span><br><span class="line">&lt;div id=​"app"&gt;​…​&lt;/div&gt;​</span><br><span class="line"><span class="attribute">data   </span>: [object Object]</span><br><span class="line"><span class="attribute">message</span>: Vue的生命周期</span><br><span class="line"><span class="literal">------mounted 挂载结束状态------</span></span><br><span class="line"><span class="attribute">el     </span>: [object HTMLDivElement]</span><br><span class="line">&lt;div id=​"app"&gt;​…​&lt;/div&gt;​</span><br><span class="line"><span class="attribute">data   </span>: [object Object]</span><br><span class="line"><span class="attribute">message</span>: Vue的生命周期</span><br></pre></td></tr></tbody></table></figure>

<p>Vue CLI<br>-快速搭建项目<br>-内置 Babel、 ESlint、 PostCSS等插件<br>-基于 webpack,可灵活配置<br>-图形化的创建和管理工具</p>
<p>npm（node package manager）：<br>nodejs的包管理器，用于node插件管理（包括安装、卸载、管理依赖等）<br>cnpm:因为npm安装插件是从国外服务器下载，受网络的影响比较大，可能会出现异常，如果npm的服务器在中国就好了，<br>所以我们乐于分享的淘宝团队干了这事。<br>来自官网：“这是一个完整 npmjs.org 镜像，你可以用此代替官方版本(只读)，同步频率目前为 10分钟 一次以保证尽量与官方服务同步。”</p>
<p><code>npm install -g cnpm --registry=https://registry.npm.taobao.org</code><br>D:\Program Files\nodejs\node_global\node_modules</p>
<h3 id="创建第一个Vue项目"><a href="#创建第一个Vue项目" class="headerlink" title="创建第一个Vue项目"></a>创建第一个Vue项目</h3><ul>
<li>切换项目路径<br><code>cd C:\Vue\</code></li>
<li>命令行创建，<br><code>vue create project_name</code><br><code>vue create hello-world</code></li>
<li>图形化界面创建<br><code>Vue ui</code></li>
<li>命令行启动，确定已经切换项目路径<br><code>npm run serve</code>不是<code>server</code></li>
</ul>
<h3 id="项目结构分析"><a href="#项目结构分析" class="headerlink" title="项目结构分析"></a>项目结构分析</h3><p>理解∨ue的项目结构才能开发单页面应用</p>
<ul>
<li>文件解释<ul>
<li><code>package.json</code>——项目描述文件（包含一些依赖配置）</li>
<li><code>vue.config.js</code>——配置文件扩展</li>
<li><code>src/</code>——源代码</li>
<li><code>dist/</code>——构建后的代码（混合、压缩）</li>
<li><code>public/</code>——公共的静态文件</li>
<li><code>node_modules/</code>——项目依赖的安装目录，对应python的site-packages</li>
</ul>
</li>
</ul>
<p>vue项目模板</p>
<ul>
<li><code>src/assets</code>:存放突变</li>
<li><code>src/components</code>:存放一组件文件</li>
<li><code>src/App.vue</code>:项目入口文件，我们也可以直接将组建写这里，而不使用<br>Vue根组件，可以通过 render参数从组件渲染</li>
<li><code>src/mian.js</code> 程序的逻辑入口文件，项目核心文件</li>
<li>新建目录<code>src/views</code>，存放页面组件<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue3 </span></span><br><span class="line"><span class="keyword">import</span> { createApp } <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"></span><br><span class="line">createApp(App).mount(<span class="string">'#app'</span>)</span><br><span class="line"><span class="comment">// Vue3里面没有全局的Vue，但是有个新的全局API：createApp</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue2.X</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    components: { App },</span><br><span class="line">    template: <span class="string">'&lt;App/&gt;'</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>public/index.html 模板文件</p>
<h3 id="面向组件编程"><a href="#面向组件编程" class="headerlink" title="面向组件编程"></a>面向组件编程</h3><p>组件化开发方式<br>把一个页面按照模块拆分成N个小块</p>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p>带有一个名字：<br>可复用的 Vue 实例，<br>与<code>new vue</code>接收相同的选项，例如 <code>data</code>、<code>computed</code>、<code>watch</code>、<code>methods</code> 以及生命周期钩子等。<br>仅有的例外是像 <code>el</code> 这样根实例特有的选项。</p>
<ul>
<li>按模块划分的前端代码片段</li>
<li>可复用的前端代码片段，每个组件都会各自独立</li>
<li>容易维护的前端代码片段<br>一个组件的模板必须有一个根节点<br>为了能在模板中使用，这些组件必须先注册以便 Vue 能够识别。</li>
</ul>
<h4 id="创建局部组件"><a href="#创建局部组件" class="headerlink" title="创建局部组件"></a>创建局部组件</h4><p>全局注册所有的组件意味着即便你已经不再使用一个组件了，它仍然会被包含在你最终的构建结果中。这造成了用户下载的 JavaScript 的无谓的增加。</p>
<p>创建vue对象，在vue函数的一个参数是一个对象形式，在对象内申明一个compoents属性，在内部进行组件的局部注册<br>对于 components 对象中的每个 property 来说，其 property 名就是自定义元素的名字，其 property 值就是这个组件的选项对象。</p>
<p>通过一个普通的 JavaScript 对象来定义组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ComponentA = { <span class="comment">/* ... */</span> }</span><br><span class="line"><span class="keyword">var</span> ComponentB = { <span class="comment">/* ... */</span> }</span><br><span class="line"><span class="keyword">var</span> ComponentC = { <span class="comment">/* ... */</span> }</span><br></pre></td></tr></tbody></table></figure>
<p>在 <code>components</code> 选项中定义你想要使用的组件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    components: {</span><br><span class="line">        <span class="string">'component-a'</span>: ComponentA,</span><br><span class="line">        <span class="string">'component-b'</span>: ComponentB,</span><br><span class="line">        App: {</span><br><span class="line">            template: <span class="string">""</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>局部注册的组件在其子组件中不可用。<br>例如，如果你希望 <code>ComponentA</code> 在 <code>ComponentB</code> 中可用，则你需要这样写：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ComponentA = { <span class="comment">/* ... */</span> }</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ComponentB = {</span><br><span class="line">  components: {</span><br><span class="line">    <span class="string">'component-a'</span>: ComponentA</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="创建全局组件"><a href="#创建全局组件" class="headerlink" title="创建全局组件"></a>创建全局组件</h4><p>全局注册的组件可以用在其被注册之后的任何 (通过 <code>new Vue</code>) 新创建的 Vue 根实例，<br>也包括其组件树中的所有子组件的模板中。<br>在所有子组件中也是如此，也就是说这三个组件在各自内部也都可以相互使用。</p>
<ul>
<li>步骤一:新建组件vue文件，不写<code>.vue</code>后缀<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">```js</span><br><span class="line">Vue.component('my-component-name', {</span><br><span class="line">    // … options ...</span><br><span class="line">    data: function () {</span><br><span class="line">        return {</span><br><span class="line">            count: 0</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    template: '&lt;button v-on:click="count++"&gt;You clicked me {{ count }} times.&lt;/button&gt;'</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
在一个通过 new Vue 创建的 Vue 根实例中，把这个组件作为自定义元素来使用：<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue({ <span class="attr">el</span>: <span class="string">'#components-demo'</span> })</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"components-demo"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将组件进行任意次数的复用 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component-name</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component-name</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component-name</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>步骤二:导入该组件</li>
<li>步骤三:注册该组件</li>
<li>步骤四:使用该组件</li>
</ul>
<h4 id="组件的复用"><a href="#组件的复用" class="headerlink" title="组件的复用"></a>组件的复用</h4><p>组件中的<code>data</code>属性必须是一个函数<br>一定要在<code>main.js</code>里面。<br>并不是像这样直接提供一个对象：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data: {</span><br><span class="line">  count: <span class="number">0</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>取而代之的是，一个组件的 <code>data</code> 选项必须是一个函数，</p>
<blockquote>
<p>因此每个实例可以维护一份被返回对象的独立的拷贝：</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="在模块系统中局部注册"><a href="#在模块系统中局部注册" class="headerlink" title="在模块系统中局部注册"></a>在模块系统中局部注册</h3><p>使用了诸如 Babel 和 webpack 的模块系统。<br>在这些情况下，我们推荐创建一个 <code>components</code> 目录，并将每个组件放置在其各自的文件中。<br>然后你需要在局部注册之前导入每个你想使用的组件。<br>使用<code>export default</code>命令，为模块指定默认输出，这样就不需要知道所要加载模块的变量名。</p>
<p>例如，在一个假设的 <code>ComponentB.js</code> 或 <code>ComponentB.vue</code> 文件中：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ComponentA <span class="keyword">from</span> <span class="string">'./ComponentA'</span></span><br><span class="line"><span class="keyword">import</span> ComponentC <span class="keyword">from</span> <span class="string">'./ComponentC'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  components: {</span><br><span class="line">    ComponentA,</span><br><span class="line">    ComponentC</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>现在 <code>ComponentA</code> 和 <code>ComponentC</code> 都可以在 <code>ComponentB</code> 的模板中使用了</p>
<h3 id="基础组件的自动化全局注册"><a href="#基础组件的自动化全局注册" class="headerlink" title="基础组件的自动化全局注册"></a>基础组件的自动化全局注册</h3><p>可能你的许多组件只是包裹了一个输入框或按钮之类的元素，是相对通用的。<br>我们有时候会把它们称为基础组件，它们会在各个组件中被频繁的用到。</p>
<p>所以会导致很多组件里都会有一个包含基础组件的长列表：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> BaseButton <span class="keyword">from</span> <span class="string">'./BaseButton.vue'</span></span><br><span class="line"><span class="keyword">import</span> BaseIcon <span class="keyword">from</span> <span class="string">'./BaseIcon.vue'</span></span><br><span class="line"><span class="keyword">import</span> BaseInput <span class="keyword">from</span> <span class="string">'./BaseInput.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line">  components: {</span><br><span class="line">    BaseButton,</span><br><span class="line">    BaseIcon,</span><br><span class="line">    BaseInput</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>而只是用于模板中的一小部分：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">BaseInput</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"searchText"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">keydown.enter</span>=<span class="string">"search"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BaseButton</span> @<span class="attr">click</span>=<span class="string">"search"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">BaseIcon</span> <span class="attr">name</span>=<span class="string">"search"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">BaseButton</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果你恰好使用了 webpack (或在内部使用了 webpack 的 Vue CLI 3+)，那么就可以使用 require.context 只全局注册这些非常通用的基础组件。<br>这里有一份可以让你在应用入口文件 (比如 src/main.js) 中全局导入基础组件的示例代码：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> upperFirst <span class="keyword">from</span> <span class="string">'lodash/upperFirst'</span></span><br><span class="line"><span class="keyword">import</span> camelCase <span class="keyword">from</span> <span class="string">'lodash/camelCase'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> requireComponent = <span class="built_in">require</span>.context(</span><br><span class="line">  <span class="comment">// 其组件目录的相对路径</span></span><br><span class="line">  <span class="string">'./components'</span>,</span><br><span class="line">  <span class="comment">// 是否查询其子目录</span></span><br><span class="line">  <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 匹配基础组件文件名的正则表达式</span></span><br><span class="line">  /Base[A-Z]\w+\.(vue|js)$/</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">requireComponent.keys().forEach(<span class="function"><span class="params">fileName</span> =&gt;</span> {</span><br><span class="line">  <span class="comment">// 获取组件配置</span></span><br><span class="line">  <span class="keyword">const</span> componentConfig = requireComponent(fileName)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取组件的 PascalCase 命名</span></span><br><span class="line">  <span class="keyword">const</span> componentName = upperFirst(</span><br><span class="line">    camelCase(</span><br><span class="line">      <span class="comment">// 获取和目录深度无关的文件名</span></span><br><span class="line">      fileName</span><br><span class="line">        .split(<span class="string">'/'</span>)</span><br><span class="line">        .pop()</span><br><span class="line">        .replace(<span class="regexp">/\.\w+$/</span>, <span class="string">''</span>)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 全局注册组件</span></span><br><span class="line">  Vue.component(</span><br><span class="line">    componentName,</span><br><span class="line">    <span class="comment">// 如果这个组件选项是通过 `export default` 导出的，</span></span><br><span class="line">    <span class="comment">// 那么就会优先使用 `.default`，</span></span><br><span class="line">    <span class="comment">// 否则回退到使用模块的根。</span></span><br><span class="line">    componentConfig.default || componentConfig</span><br><span class="line">  )</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>记住全局注册的行为必须在根 Vue 实例 (通过 new Vue) 创建之前发生。</p>
<h3 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h3><ul>
<li>显示普通文本<br><code>&lt;span&gt;消息内容:{{msg}}&lt;/span&gt;</code></li>
<li>JavaScript表达式<br><code>{{ msg.split('').reverse.join('')}}</code><br><code>{{ result &gt;0? 'YES':'NO'}}</code></li>
</ul>
<p>指令(Directives)是带有<code>v-</code>前缀的特殊属性</p>
<ul>
<li>富文本(HTML)<br><code>span V-html="rawHtml"&gt;&lt;/span&gt;</code></li>
<li>普通文本(text<br><code>span V-text="rawHtml"&gt;&lt;/span&gt;</code></li>
</ul>
<h4 id="V-bind"><a href="#V-bind" class="headerlink" title="V-bind"></a>V-bind</h4><ul>
<li><p>作用<br>响应式的更新HTML属性</p>
</li>
<li><p>常用的场景<br>设置 class, style、href、src等<br><code>&lt;a v-bind:href="url"&gt;...&lt;/a&gt;</code>等同于<code>&lt;a :href="url"&gt;...&lt;/a&gt;</code></p>
</li>
<li><p>设置class</p>
<ul>
<li>对象语法<br><code>v-bind:class="{active:isActive, 'text-danger': hasError }</code></li>
<li>数组语法<br><code>bind:class="[{ active:isActive }, errorClass]"</code><br>加冒号<code>:</code>是<code>v-bind</code>语法</li>
</ul>
</li>
<li><p>设置style</p>
<ul>
<li><p>对象语法<br><code>v-bind:style="{ color: activeColor, fontSize:fontSize +'px'}"</code></p>
</li>
<li><p>数组语法<br><code>v-bind:style="[baseStyles, overridingStyles]"</code></p>
</li>
<li><p>浏览器适配(默认自动适配)<br><code>:style="{display:['-Webkit-box', '-ms-flexbox','flex']}</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">不满足条件时，在dom里面找不到元素</span><br><span class="line">```html</span><br><span class="line">&lt;div v-if="score&gt;=90"&gt;A&lt;/div&gt;</span><br><span class="line">&lt;div v-else-if="score &gt;=80"&gt;B&lt;/div&gt;</span><br><span class="line">&lt;div v-else-if="score &gt;=60"&gt;C&lt;/div&gt;</span><br><span class="line">&lt;div v-else&gt;D&lt;/div&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h4><p>通过切换css的 display属性来控制元素的显示与隐藏<br>不满足条件时，在dom里面能找到元素</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-show</span>=<span class="string">"hasError"</span>&gt;</span>还有错误哦!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="V-tor"><a href="#V-tor" class="headerlink" title="V-tor"></a>V-tor</h4><ul>
<li><p>基本语法</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in items"</span> <span class="attr">:key</span>=<span class="string">"item id"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"item of items"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><p>key的作用<br>渲染性能优化（修改DOM还是替换DOM）</p>
</li>
<li><p>渲染数组</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(item, index) in items"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">{{index}}-{{item.message}}</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>渲染对象</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(value, key, index) in object"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">{{index}}.{{key}}:{{value}}</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h4 id="v-on-指令监听-DOM-事件"><a href="#v-on-指令监听-DOM-事件" class="headerlink" title="v-on 指令监听 DOM 事件"></a><code>v-on</code> 指令监听 DOM 事件</h4><p>v-on指令后面“:”后的参数是要触发的事件类型。<br>v-on的事件类型由参数指定。<br><code>&lt;button v-on:click="counter += 1"&gt;Add 1&lt;/button&gt;</code><br><code>&lt;button @click="counter += 1"&gt;Add 1&lt;/button&gt;</code></p>
<h3 id="鼠标事件修饰符"><a href="#鼠标事件修饰符" class="headerlink" title="鼠标事件修饰符"></a>鼠标事件修饰符</h3><ul>
<li>阻止事件冒泡<br><code>&lt;a v-on:click.stop="doThis"&gt;&lt;/a&gt;</code></li>
<li>阻止默认行为<br><code>&lt;a v-on:click.prevent="doThis"&gt;&lt;/a&gt;</code></li>
<li>点击事件只触发一次<br><code>&lt;a v-on:click.once="doThis"&gt;&lt;/a&gt;</code></li>
</ul>
<h3 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h3><ul>
<li><p>监听事件 每次输入键盘抬起的时候<br><code>&lt;input type="text" v-on:keyup="submit"&gt;</code><br><code>&lt;input type="text" @keyup="submit"&gt;</code></p>
</li>
<li><p>监听回车键<br><code>&lt;input type="text" v-on:keyup.enter="submit"&gt;</code><br><code>&lt;input type="text" @keyup.enter="submit"&gt;</code></p>
</li>
<li><p>监听删除、退格键<br><code>&lt;input type="text" v-on:keyup.delete="submit"&gt;</code><br>```&lt;input type=”text” @keyup=”submit”&gt;``</p>
</li>
</ul>
<h3 id="表单输入绑定"><a href="#表单输入绑定" class="headerlink" title="表单输入绑定"></a>表单输入绑定</h3><ul>
<li><p>基本语法<br><code>&lt;input v-model="message"&gt;</code></p>
</li>
<li><p>单选、多选的绑定</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">"hobby"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">:value</span>=<span class="string">"opion"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">"(opion, index) in opitons"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span>{{opion.text}}<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>您选择了： {{hobby.text}}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><p>修饰符：检索代码量</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">```number```自动转为数值类型</span><br><span class="line"></span><br><span class="line">### 过滤器是一个JavaScript函数</span><br><span class="line">但是在 vue3.x 中过滤器属性已删除，不再支持</span><br><span class="line">#### 过滤器的注册</span><br><span class="line">- 在组件内注册,在该组件内使用</span><br><span class="line">```js</span><br><span class="line">  filters: {</span><br><span class="line">    priceFormat: function(price) {</span><br><span class="line">      /**</span><br><span class="line">       * 过滤器的内容 格式化价格显示</span><br><span class="line">       */</span><br><span class="line">      if (price === undefined || price === null || isNaN(price)) {</span><br><span class="line">        return price </span><br><span class="line">      }  </span><br><span class="line">      return '￥' + (price).toFixed(2)</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>过滤器的使用<ul>
<li>方式一:在双大括号中 已经过时？<br><code>{{ message |priceFormat }}</code></li>
<li>方式二:在v-bind中<br><code>&lt;div v-bind:id="rawld | priceFormat"&gt;&lt;/div&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li><p>全局注册,在所有组件内均可使用</p>
</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Vue.filter(<span class="string">'priceFormat'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>{</span><br><span class="line">    <span class="comment">//过滤器的内容</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>组件中的常见的通信方式</p>
<ul>
<li>参数传递</li>
<li>全局共享<ul>
<li>浏览器的存储(storage、 cookie)</li>
<li>Vuex</li>
</ul>
</li>
</ul>
<p>父组件到子组件的数据传递</p>
<ul>
<li><p>传递方式<br>为子组件定义<code>props</code>属性</p>
</li>
<li><p>传递的数据类型<br>数值、布尔值、数组、对象</p>
</li>
<li><p>添加数据类型验证 </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">props: {</span><br><span class="line">  userName1: {</span><br><span class="line">    type:<span class="built_in">String</span>,</span><br><span class="line">    required:<span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>设置默认值 </p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">props: {</span><br><span class="line">  userName1: {</span><br><span class="line">    type:<span class="built_in">Number</span>,</span><br><span class="line">    <span class="keyword">default</span>:<span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>type</code>所支持的类型</p>
<ul>
<li>String:字符串</li>
<li>Object:对象</li>
<li>Number:数字</li>
<li>Date:日期</li>
<li>Boolean:布尔值</li>
<li>Function:方法/函数</li>
<li>Array:数组</li>
<li>Symbol</li>
</ul>
<p>子组件到父组件的数据传递</p>
<ul>
<li>在子组件触发自定义事件<br><code>this.$emit('myEvent')</code></li>
<li>在父组件监听事件<br><code>&lt;my-component v-on:myEvent="doSomething"&gt;&lt;my-component&gt;</code></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/jian-zhi-offer40-50/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/jian-zhi-offer40-50/" class="post-title-link" itemprop="url">剑指offer40 -50</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="字符串比较大小就是字典序的大小"><a href="#字符串比较大小就是字典序的大小" class="headerlink" title="字符串比较大小就是字典序的大小"></a>字符串比较大小就是字典序的大小</h2><p>字符串的比较是通过 内置函数 ord() 获得每个字符的 Unicode 编码进行大小比较</p>
<p>单个字符<br>常见ASCII码的大小规则：<code>0～9　&lt;　A～Z　&lt;　a～z。</code><br>1）数字比字母要小。如 “7”&lt;“F”；<br>2）数字0比数字9要小，并按0到9顺序递增。<br>3）字母A比字母Z要小，并按A到Z顺序递增。<br>4）同个字母的大写字母比小写字母要小32。如“A”&lt;“a” 。</p>
<p>多个字符<br>按位进行字符比对，从字符串的第一个字符开始比较，谁的ASCII码大谁就大。<br>只有首字符相同、再去比较下一个字符，以此类推。如果都相同则相等</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'xnjilhntm'</span>==<span class="string">'xnjilhntm'</span>)   <span class="comment"># True</span></span><br><span class="line">print(<span class="string">'xnjilhntm'</span>&lt;<span class="string">'xnjilhntz'</span>)  <span class="comment"># True</span></span><br><span class="line">print(<span class="string">'abbbbbbb'</span>&gt;<span class="string">'b'</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="string">''</span>&gt;<span class="string">'a'</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="string">'A'</span>&gt;<span class="string">'a'</span>)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'3'</span> &gt; <span class="string">'20'</span> &gt; <span class="string">'100'</span>)  <span class="comment"># True</span></span><br><span class="line">print(<span class="string">'20'</span> &lt; <span class="string">'200'</span>)  <span class="comment"># True</span></span><br><span class="line">print(max([<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]))  <span class="comment"># 3</span></span><br><span class="line">print(max([<span class="string">'31'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]))  <span class="comment"># 31</span></span><br><span class="line">print(max([<span class="string">'13'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]))  <span class="comment"># 3</span></span><br><span class="line">print(max([<span class="string">'10'</span>, <span class="string">'11'</span>, <span class="string">'12'</span>]))  <span class="comment"># 12</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="179-最大数"><a href="#179-最大数" class="headerlink" title="179. 最大数"></a>179. 最大数</h2><p>给定一组非负整数 nums，重新排列它们每个数字的顺序（每个数字不可拆分）使之组成一个最大的整数。</p>
<p>注意：输出结果可能非常大，所以你需要返回一个字符串而不是整数。</p>
<p>示例 1：</p>
<figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [<span class="number">10</span>,<span class="number">2</span>]</span><br><span class="line">输出：<span class="string">"210"</span></span><br></pre></td></tr></tbody></table></figure>
<p>示例 2：</p>
<figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [<span class="number">3</span>,<span class="number">30</span>,<span class="number">34</span>,<span class="number">5</span>,<span class="number">9</span>]</span><br><span class="line">输出：<span class="string">"9534330"</span></span><br></pre></td></tr></tbody></table></figure>
<p>示例 3：</p>
<figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [<span class="number">1</span>]</span><br><span class="line">输出：<span class="string">"1"</span></span><br></pre></td></tr></tbody></table></figure>
<p>示例 4：</p>
<figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [<span class="number">10</span>]</span><br><span class="line">输出：<span class="string">"10"</span></span><br></pre></td></tr></tbody></table></figure>

<p>想法<br>为了构建最大数字，希望越高位的数字越大越好。</p>
<p>设计一个类似从高位开始的基数排序。但在处理不同位长数的排序时，我发现很难给出一个统一的大小判别规律，例如962,96,9的最优排序是996962，而162,16,1的最优排序是162161。因此这个思路就只能毙掉了</p>
<p>算法<br>首先，将每个整数变成字符串。然后进行排序。<br>如果仅按降序排序，有相同的开头数字的时候会出现问题。<br>比方说，样例 2 按降序排序得到的数字是 95343303 ，<br>然而交换 3 和 30 的位置可以得到正确答案 9534330 。</p>
<p>例如962,96,9962,96,9的最优排序是996962996962,<br>而162,16,1162,16,1的最优排序是162161162161。</p>
<p>因此，每一对数在排序的比较过程中，比较两种连接顺序哪一种更好。<br>可以证明这样的做法是正确的：</p>
<p>假设（不是一般性），某一对整数 a 和 b ，的比较结果是 a 应该在 b 前面，<br>这意味着 a⌢b&gt;b⌢a ，其中 ⌢ 表示连接。<br>如果排序结果是错的，说明存在一个 c ， b 在 c 前面且 c 在 a 的前面。<br>这产生了矛盾，因为 a⌢b&gt;b⌢a 和 b⌢c&gt;c⌢b 意味着 a⌢c&gt;c⌢a 。<br>换言之，我们的自定义比较方法保证了传递性，所以这样子排序是对的。</p>
<p>一旦数组排好了序，最“重要”的数字会在最前面。<br>有一个需要注意的情况是如果数组只包含 0 ，我们直接返回结果 0 即可。<br>否则，我们用排好序的数组形成一个字符串并返回。</p>
<p>反证法：<br>假设存在一个最大序列不满足该排序规则，<br>那么至少存在两个数字的顺序不按上述传递性的定义排列，<br>如……s2s1…….，其中s2s1 &lt; s1s2。接下来，其他字符串的位置不变，<br>按照传递性定义，将s2和s1交换位置后，<br>可证明……s1s2…… &gt; ……s2s1……，这与假设不符，<br>即……s2s1…….并不是最大序列，所以最优序列必定满足上述传递性的定义。</p>
<p>已知：s1应该在s2前边，s2应该在s3前边；<br>求证：s1应该在s3前边。<br>证明：<br>假设“s3在s1前面”成立，则结合已知“s2应该在s3前边”，推出“s2在s1前面”，与已知“s1应该在s2前边”矛盾，故假设不成立，得证。</p>
<ul>
<li><p>时间复杂度：O(nlgn)<br>尽管我们在比较函数中做了一些额外的工作，但是这只是一个常数因子。</p>
</li>
<li><p>空间复杂度：O(n)<br>用了 O(n) 的额外空间去保存 nums 的副本。<br>尽管我们就地进行了一些额外的工作，但最后返回的数组需要 O(n) 的空间。<br>因此，需要的额外空间与 nums 大小成线性关系。</p>
</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">```key```仅仅支持接受一个参数的函数，该函数用于从从每个被排序元素中提取一个比较键(例如，key=str.lower)。对列表中每个项对应的键计算一次，并返回另一个用以排序的值的可调用对象用于整个排序过程。</span><br><span class="line">None的默认值意味着列表项是直接排序的，不需要计算单独的键值。就无法实现两个参数之间的对比</span><br><span class="line">这里传入一个类名，生成的实际上是这个类对象。</span><br><span class="line"></span><br><span class="line">&gt;```sorted()```在对元素进行默认排序是从低到高时会用到小于号&lt;</span><br><span class="line"></span><br><span class="line">经历如下过程：</span><br><span class="line">- 从元素a(用a指代待排序列表中的元素)中提取比较键：LargerNumKey(a)类对象</span><br><span class="line">- 比较这些类对象的大小，&lt;调用LargerNumKey类的自定义的富比较函数__lt__进行排序. </span><br><span class="line">这样就实现了按自定义排序规则进行排序。</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">from typing import List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class LargerNumKey(str):</span><br><span class="line">    # LargerNumKey类继承了字符串str类，数组中所有元素类型改为字符串</span><br><span class="line">    # 所以可以直接使用类名作为函数</span><br><span class="line">    def __lt__(x, y):</span><br><span class="line">        """重写了富比较方法"""</span><br><span class="line">        # x 就是 self, 正常点的写法 就是 __lt__(self, y)</span><br><span class="line">        # self 只是惯例，可以叫其他名字</span><br><span class="line">        # 本题根据官方题解的字符排列传导性，</span><br><span class="line">        # x + y &gt; y + x 等价于 x 必须排在 y 的前面，即compare函数返回 -1</span><br><span class="line">        # x + y &lt; y + x 等价于 y 必须排在 x 的前面，即compare函数返回 1</span><br><span class="line">        return x + y &gt; y + x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Solution:</span><br><span class="line">    def largestNumber(self, nums: List[int]) -&gt; str:</span><br><span class="line">        # key指向一个类，利用了类的实例化生成类对象用作比较键。</span><br><span class="line">        # sorted(map(str, nums), key=LargerNumKey) 比较的是字符串大小，我之前想的是根据 __lt__(x, y) 返回的布尔值比较大小。</span><br><span class="line">        largest_num = ''.join(sorted(map(str, nums), key=LargerNumKey))</span><br><span class="line">        # If, after being sorted, the largest number is `0`, the entire number is zero.</span><br><span class="line">        return '0' if largest_num[0] == '0' else largest_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    arr = [10, 3, 20]</span><br><span class="line">    s = Solution()</span><br><span class="line">    print(s.largestNumber(arr))  # 32010</span><br><span class="line">    print(s.largestNumber([824, 8247]) == '8248247')</span><br><span class="line">    print(s.largestNumber([0, 0]) == '0')</span><br><span class="line">    print(s.largestNumber([1, 1, 1]) == '111')</span><br><span class="line">    print(s.largestNumber([3, 30, 34, 5, 9]) == "9534330")</span><br><span class="line">    print(s.largestNumber([10, 2]) == '210')</span><br><span class="line">    print(s.largestNumber([0, 2]) == '20')</span><br><span class="line">    print(s.largestNumber([1]) == '1')</span><br><span class="line">    print(s.largestNumber([0]) == '0')</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sqf"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">10</span>, <span class="number">3</span>, <span class="number">20</span>]</span><br><span class="line">key=LargerNumKey继承 <span class="built_in">str</span> 的，把int变成<span class="built_in">str</span></span><br><span class="line">x 就是 self</span><br><span class="line"></span><br><span class="line">开始执行<span class="built_in">sort</span>()</span><br><span class="line">默认排序是从低到高，两个元素比较用到小于号&lt;，调用<span class="variable">__lt__</span>(x, y)</span><br><span class="line"></span><br><span class="line"><span class="variable">__lt__</span>(<span class="string">'3'</span>, <span class="string">'10'</span>)</span><br><span class="line">x = <span class="string">'3'</span> y = <span class="string">'10'</span>  </span><br><span class="line"><span class="string">'3'</span> + <span class="string">'10'</span> &gt; <span class="string">'10'</span> + <span class="string">'3'</span>  </span><br><span class="line">返回<span class="literal">True</span></span><br><span class="line">所以 <span class="string">'3'</span> &lt; <span class="string">'10'</span>为 <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="variable">__lt__</span>(<span class="string">'20'</span>, <span class="string">'3'</span>)</span><br><span class="line">x = <span class="string">'20'</span> y = <span class="string">'3'</span>  </span><br><span class="line"><span class="string">'20'</span> + <span class="string">'3'</span> &gt; <span class="string">'3'</span> + <span class="string">'20'</span>  </span><br><span class="line">返回<span class="literal">False</span></span><br><span class="line">所以 <span class="string">'20'</span> &lt; <span class="string">'3'</span>为 <span class="literal">False</span></span><br><span class="line">即<span class="string">'3'</span> &lt; <span class="string">'20'</span>为 <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="variable">__lt__</span>(<span class="string">'20'</span>, <span class="string">'10'</span>)</span><br><span class="line">x = <span class="string">'20'</span> y = <span class="string">'10'</span>  </span><br><span class="line"><span class="string">'20'</span> + <span class="string">'10'</span> &gt; <span class="string">'10'</span> + <span class="string">'20'</span>  </span><br><span class="line">返回<span class="literal">True</span></span><br><span class="line">所以 <span class="string">'20'</span> &lt; <span class="string">'10'</span>为 <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">所以<span class="string">"10"</span>, <span class="string">"3"</span>, <span class="string">"20"</span>的从小到大的顺序为[<span class="string">"3"</span>, <span class="string">"20"</span>, <span class="string">"10"</span>]</span><br><span class="line">largest_num = <span class="string">''</span>.<span class="built_in">join</span>([<span class="string">"3"</span>, <span class="string">"20"</span>, <span class="string">"10"</span>]) = <span class="string">'32010'</span></span><br><span class="line">largest_num[<span class="number">0</span>] == <span class="string">'3'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrLt</span>(<span class="params">str</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, y</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self + y &gt; y + self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line"></span><br><span class="line">        nums.sort(key=StrLt)</span><br><span class="line">        res = <span class="string">""</span>.join(map(str, nums))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"0"</span> <span class="keyword">if</span> res[<span class="number">0</span>] == <span class="string">"0"</span> <span class="keyword">else</span> res</span><br></pre></td></tr></tbody></table></figure>

<p>把sorted的reverse参数设置为True，排序的顺序是大到小。<br>__lt__方法的返回值和小于的原意一样，<br>可以直接用&lt;、&gt;来比较两个类实例的大小关系，<br>也可以将类传入sorted和sort函数的key参数中，用于类元素组成的序列等的排序。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LargerNumKey</span>(<span class="params">str</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">x, y</span>):</span></span><br><span class="line">        <span class="keyword">return</span> x + y &lt; y + x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        largest_num = <span class="string">''</span>.join(</span><br><span class="line">            sorted(map(str, nums), key=LargerNumKey, reverse=<span class="literal">True</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span> <span class="keyword">if</span> largest_num[<span class="number">0</span>] == <span class="string">'0'</span> <span class="keyword">else</span> largest_num</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LargerNumKey</span>(<span class="params">str</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__gt__</span>(<span class="params">x, y</span>):</span></span><br><span class="line">        <span class="keyword">return</span> x + y &gt; y + x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        largest_num = <span class="string">''</span>.join(</span><br><span class="line">            sorted(map(str, nums), key=LargerNumKey, reverse=<span class="literal">True</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span> <span class="keyword">if</span> largest_num[<span class="number">0</span>] == <span class="string">'0'</span> <span class="keyword">else</span> largest_num</span><br></pre></td></tr></tbody></table></figure>

<p>法二<br>不再让LargerNumKey类去继承str类，<br>这个函数的比较实现依赖传入参数value的类型，只要value类型支持‘+’和比较运算符，这个函数就能正常工作。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LargerNumKey</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.value + other.value &gt; other.value + self.value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        ans = <span class="string">''</span>.join(sorted(map(str, nums), key=LargerNumKey))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span> <span class="keyword">if</span> ans[<span class="number">0</span>] == <span class="string">'0'</span> <span class="keyword">else</span> ans</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">cmp_large</span>:</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">                self.value = str(value)</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">                <span class="keyword">return</span> self.value + other.value &gt; other.value + self.value</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__gt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">                <span class="keyword">return</span> self.value + other.value &lt; other.value + self.value</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">                <span class="keyword">return</span> self.value + other.value == other.value + self.value</span><br><span class="line"></span><br><span class="line">        res = [cmp_large(value) <span class="keyword">for</span> value <span class="keyword">in</span> nums]</span><br><span class="line">        ans = <span class="string">""</span>.join(a.value <span class="keyword">for</span> a <span class="keyword">in</span> sorted(res))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span> <span class="keyword">if</span> ans[<span class="number">0</span>] == <span class="string">'0'</span> <span class="keyword">else</span> ans</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">large_num</span>(<span class="params">str</span>):</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">                <span class="keyword">return</span> self + other &gt; other + self</span><br><span class="line"></span><br><span class="line">        largest_num = <span class="string">""</span>.join(sorted(map(str, nums), key=large_num))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span> <span class="keyword">if</span> largest_num[<span class="number">0</span>] == <span class="string">'0'</span> <span class="keyword">else</span> largest_num</span><br></pre></td></tr></tbody></table></figure>

<p>假设a,b,c分别有m,n,k位数<br>ab &gt; ba =&gt; a * 10^n + b &gt; b * 10^m+ a<br>bc &gt; cb =&gt; b * 10^k + c &gt; c * 10^n + b)<br>可以推出: a * 10^k + c &gt; c * 10^m + a =&gt; ac &gt; ca<br>a=123 b=34，m=3,n=2<br>ab=12334=123*10^2+34;</p>
<p>法三：<br>cmp_to_key 函数，接收比较函数cmp(x, y) 接受两个参数用于比较 2 个对象</p>
<ul>
<li>返回1，是 x &gt; y，</li>
<li>返回-1，表示 x &lt; y，</li>
<li>返回0，表示 x == y</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="keyword">from</span> functools <span class="keyword">import</span> cmp_to_key</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">cmp</span>(<span class="params">x, y</span>):</span></span><br><span class="line">            <span class="keyword">if</span> x + y &gt; y + x:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">            <span class="keyword">elif</span> x + y &lt; y + x:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        ans = <span class="string">""</span>.join(sorted(map(str, nums), key=cmp_to_key(cmp)))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span> <span class="keyword">if</span> ans[<span class="number">0</span>] == <span class="string">'0'</span> <span class="keyword">else</span> ans</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">3</span>, <span class="number">20</span>]</span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(x, y)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'20'</span>, <span class="string">'3'</span>)</span></span></span><br><span class="line"><span class="string">'20'</span> + <span class="string">'3'</span> &lt; <span class="string">'3'</span> + <span class="string">'20'</span></span><br><span class="line"><span class="string">'203'</span> &lt; <span class="string">'320'</span></span><br><span class="line">return <span class="number">1</span></span><br><span class="line"><span class="string">'20'</span> &gt; <span class="string">'3'</span> </span><br><span class="line"><span class="string">'3'</span> &lt; <span class="string">'20'</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="keyword">from</span> functools <span class="keyword">import</span> cmp_to_key</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">cmp</span>(<span class="params">a, b</span>):</span>  <span class="comment"># eg.30&lt;3</span></span><br><span class="line">            <span class="keyword">if</span> a + b &lt; b + a:  <span class="comment"># 30+3&lt;3+30-&gt;-1</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">            <span class="keyword">elif</span> a + b &gt; b + a:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        res = <span class="string">''</span>.join(</span><br><span class="line">            sorted(map(str, nums), key=cmp_to_key(cmp), reverse=<span class="literal">True</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'0'</span> <span class="keyword">if</span> res[<span class="number">0</span>] == <span class="string">'0'</span> <span class="keyword">else</span> res</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">3</span>, <span class="number">20</span>]</span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(x, y)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'3'</span>, <span class="string">'20'</span>)</span></span></span><br><span class="line"><span class="string">'3'</span> + <span class="string">'20'</span> &gt; <span class="string">'20'</span> + <span class="string">'3'</span></span><br><span class="line"><span class="string">'320'</span> &gt; <span class="string">'203'</span></span><br><span class="line">return <span class="number">1</span></span><br><span class="line"><span class="string">'3'</span> &gt; <span class="string">'20'</span> </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">3</span>, <span class="number">20</span>]</span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(x, y)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'3'</span>, <span class="string">'20'</span>)</span></span></span><br><span class="line"><span class="string">'3'</span> + <span class="string">'20'</span> &gt; <span class="string">'20'</span> + <span class="string">'3'</span></span><br><span class="line">return <span class="number">1</span></span><br><span class="line"><span class="string">'3'</span> &gt; <span class="string">'20'</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'10'</span>, <span class="string">'3'</span>)</span></span></span><br><span class="line"><span class="string">'10'</span> + <span class="string">'3'</span> &lt; <span class="string">'3'</span> + <span class="string">'10'</span></span><br><span class="line">return -<span class="number">1</span></span><br><span class="line"><span class="string">'10'</span> &lt; <span class="string">'3'</span> </span><br><span class="line"><span class="string">'3'</span> &gt; <span class="string">'10'</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'10'</span>, <span class="string">'20'</span>)</span></span></span><br><span class="line"><span class="string">'10'</span> + <span class="string">'20'</span> &lt; <span class="string">'20'</span> + <span class="string">'10'</span></span><br><span class="line">return -<span class="number">1</span></span><br><span class="line"><span class="string">'10'</span> &lt; <span class="string">'20'</span> </span><br><span class="line"><span class="string">'20'</span> &gt; <span class="string">'10'</span> </span><br></pre></td></tr></tbody></table></figure>

<p>如果是int对象比较大小，一般用 x - y来返回，这样就可以很形象的体现两者之间的位置关系了。<br>把数字转换成字符串。然后需要定义一种比较两个数的规则，<br>即把数字m和n拼接为mn，nm，只需要按照字符串大小的比较。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        <span class="keyword">from</span> functools <span class="keyword">import</span> cmp_to_key</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">str_cmp</span>(<span class="params">a, b</span>):</span></span><br><span class="line">            <span class="keyword">return</span> int(a + b) - int(b + a)</span><br><span class="line"></span><br><span class="line">        strs = [str(i) <span class="keyword">for</span> i <span class="keyword">in</span> nums]</span><br><span class="line">        strs.sort(key=cmp_to_key(str_cmp), reverse=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> str(int(<span class="string">''</span>.join(strs)))</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">strs = [<span class="string">'10'</span>, <span class="string">'3'</span>, <span class="string">'20'</span>]</span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'3'</span>, <span class="string">'20'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">int</span><span class="params">(a + b)</span></span> - int(<span class="selector-tag">b</span> + a)</span><br><span class="line"><span class="function"><span class="title">int</span><span class="params">(<span class="string">'3'</span> + <span class="string">'20'</span>)</span></span> - int(<span class="string">'20'</span> + <span class="string">'3'</span>)</span><br><span class="line"><span class="number">320</span> - <span class="number">203</span> = <span class="number">117</span></span><br><span class="line"><span class="string">'3'</span> &gt; <span class="string">'20'</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'10'</span>, <span class="string">'3'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">int</span><span class="params">(<span class="string">'10'</span> + <span class="string">'3'</span>)</span></span> - int(<span class="string">'3'</span> + <span class="string">'10'</span>)</span><br><span class="line"><span class="number">103</span> - <span class="number">310</span> = -<span class="number">207</span> </span><br><span class="line"><span class="string">'10'</span> &lt; <span class="string">'3'</span> </span><br><span class="line"><span class="string">'3'</span> &gt; <span class="string">'10'</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cmp</span><span class="params">(<span class="string">'10'</span>, <span class="string">'20'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">int</span><span class="params">(<span class="string">'10'</span> + <span class="string">'20'</span>)</span></span> - int(<span class="string">'20'</span> + <span class="string">'10'</span>)</span><br><span class="line"><span class="number">1020</span> - <span class="number">2010</span> = -<span class="number">990</span></span><br><span class="line"><span class="string">'10'</span> &lt; <span class="string">'20'</span> </span><br><span class="line"><span class="string">'20'</span> &gt; <span class="string">'10'</span> </span><br><span class="line"></span><br><span class="line">-<span class="number">990</span> &lt; -<span class="number">207</span> &lt; <span class="number">117</span></span><br><span class="line">strs = [<span class="string">'3'</span>, <span class="string">'20'</span>, <span class="string">'10'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>返回大于0的值代表x&gt;y，令x排在y后面</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="keyword">from</span> functools <span class="keyword">import</span> cmp_to_key</span><br><span class="line">        <span class="comment"># 比较两个数xy和yx的大小</span></span><br><span class="line">        key = cmp_to_key(<span class="keyword">lambda</span> x, y: int(y + x) - int(x + y))</span><br><span class="line">        <span class="comment"># lstrip() 方法: 截掉字符串左边的空格或指定字符  0012-&gt;12</span></span><br><span class="line">        res = <span class="string">''</span>.join(sorted(map(str, nums), key=key)).lstrip(<span class="string">'0'</span>)</span><br><span class="line">        <span class="keyword">return</span> res <span class="keyword">or</span> <span class="string">'0'</span></span><br></pre></td></tr></tbody></table></figure>

<p>冒泡<br>把需要判断的两个连续的字符串连起来，直接比较大小，然后根据比较的大小来决定需不需要做交换。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,len(nums)-i<span class="number">-1</span>):</span><br><span class="line">                <span class="keyword">if</span> str(nums[j]) + str(nums[j+<span class="number">1</span>]) &lt; str(nums[j+<span class="number">1</span>])+ str(nums[j]):</span><br><span class="line">                    nums[j] ,nums[j+<span class="number">1</span>] =nums[j+<span class="number">1</span>], nums[j]</span><br><span class="line">        res=<span class="string">""</span>.join(str(i) <span class="keyword">for</span> i <span class="keyword">in</span> nums)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"0"</span> <span class="keyword">if</span> nums[<span class="number">0</span>]==<span class="number">0</span> <span class="keyword">else</span> res</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(nums) - i - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> str(nums[j]) + str(nums[j + <span class="number">1</span>]) &gt; str(nums[j + <span class="number">1</span>]) + str(nums[j]):</span><br><span class="line">                    nums[j], nums[j + <span class="number">1</span>] = nums[j + <span class="number">1</span>], nums[j]</span><br><span class="line">        s = <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> nums[<span class="number">-1</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span>(<span class="string">'0'</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nums:</span><br><span class="line">            s = str(i) + s</span><br><span class="line">        <span class="keyword">return</span> s</span><br></pre></td></tr></tbody></table></figure>

<p>本质是排序算法，只是在判断大小的地方，把直接通过数学&lt;、&gt;的地方改成compare函数；<br>快速排序实现</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">largestNumber</span>(<span class="params">self, nums</span>):</span></span><br><span class="line">        self.quickSort(nums, <span class="number">0</span>, len(nums) - <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 边界case</span></span><br><span class="line">        <span class="keyword">if</span> nums[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"0"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join((str(n) <span class="keyword">for</span> n <span class="keyword">in</span> nums))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quickSort</span>(<span class="params">self, nums, L, R</span>):</span></span><br><span class="line">        <span class="keyword">if</span> L &lt; R:</span><br><span class="line">            p = self.partition(nums, L, R)</span><br><span class="line">            self.quickSort(nums, L, p - <span class="number">1</span>)</span><br><span class="line">            self.quickSort(nums, p + <span class="number">1</span>, R)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">self, nums, L, R</span>):</span></span><br><span class="line">        plv = nums[L]</span><br><span class="line"></span><br><span class="line">        i = L + <span class="number">1</span></span><br><span class="line">        j = R</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> i &lt;= j:</span><br><span class="line">            <span class="keyword">if</span> self.custom_compare(nums[i], plv) == <span class="number">-1</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> self.custom_compare(nums[j], plv) == <span class="number">1</span>:</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h2 id="剑指-Offer-45-把数组排成最小的数"><a href="#剑指-Offer-45-把数组排成最小的数" class="headerlink" title="剑指 Offer 45. 把数组排成最小的数"></a>剑指 Offer 45. 把数组排成最小的数</h2><p><strong>输入一个非负整数数组，把数组里所有数字拼接起来排成一个数，打印能拼接出的所有数字中最小的一个。</strong></p>
<blockquote>
<p>输出结果可能非常大，所以你需要返回一个字符串而不是整数<br>拼接起来的数字可能会有前导 0，最后结果不需要去掉前导 0</p>
</blockquote>
<p>示例 1:</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: [<span class="number">10</span>,<span class="number">2</span>]</span><br><span class="line">输出: <span class="string">"102"</span></span><br></pre></td></tr></tbody></table></figure>

<p>示例 2:</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: [<span class="number">3</span>,<span class="number">30</span>,<span class="number">34</span>,<span class="number">5</span>,<span class="number">9</span>]</span><br><span class="line">输出: <span class="string">"3033459"</span></span><br></pre></td></tr></tbody></table></figure>

<p>本题的“数字”指的就是每个元素整体</p>
<p>放数字的顺序肯定是先放第一位(最左边一位)最小的元素，如果第一位相等，比较第二位….，以此类推。<br>排列大小比较和字符串大小有点区别，比如 3 和 30，明显 30 排在前面比较好，</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ord(<span class="string">"3"</span> &gt; <span class="string">"30"</span>))  <span class="comment"># TypeError: ord() expected a character, but string of length 2 found</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">字典序方法</span><br><span class="line"><span class="string">"330"</span> &gt; <span class="string">"303"</span></span><br><span class="line"><span class="string">"3"</span> + <span class="string">"30"</span> &gt; <span class="string">"30"</span> + <span class="string">"3"</span></span><br><span class="line"><span class="string">"3"</span> &gt; <span class="string">"30"</span></span><br></pre></td></tr></tbody></table></figure>

<p>解题思路：</p>
<ul>
<li><p>此题求拼接起来的 “最小数字” ，本质上是一个排序问题。</p>
</li>
<li><p>排序判断规则： 设 nums 任意两数字的字符串格式 x 和 y ，则</p>
<ul>
<li>若拼接字符串 x + y &gt; y + x ，则 x &gt; y ；</li>
<li>反之，若 x + y &lt; y + x ，则 x &lt; y ；<br>不能加等于，要执行严格弱序，编译器发现相等会反序参数调用。也就是说a compare b和b compare a的结果必须是相反的。  </li>
</ul>
</li>
<li><p>根据以上规则，套用任何排序方法对 nums 执行排序即可。</p>
</li>
</ul>
<p>算法流程：</p>
<ol>
<li>初始化： 字符串列表 strs ，保存各数字的字符串格式；</li>
<li>列表排序： 应用以上 “排序判断规则” ，对 strs 执行排序；</li>
<li>返回值： 拼接 strs 中的所有字符串，并返回。</li>
</ol>
<p>复杂度分析：<br>时间复杂度 O(NlogN) ： N 为最终返回值的字符数量（ strs 列表的长度 ≤ N ）；使用快排或内置函数的平均时间复杂度为 O(NlogN) ，最差为 O(N^2) 。<br>空间复杂度 O(N) ： 字符串列表 strs 占用线性大小的额外空间。</p>
<p>法一<br>快速排序：</p>
<ul>
<li>需修改快速排序函数中的排序判断规则。字符串大小（字典序）对比的实现方法：</li>
</ul>
<p>跟 l 还是 r 比取决于我们把哪个元素看作”哨兵“，跟 l 比也可以，<br>如果要用 l ，哨兵 i, j 的移动先后顺序也要对换<br>因为最后要把 strs[i], strs[l] 交换，因此要保证 ``strs[i] &gt; strs[l]` （和 r 的情况正好相反），这样交换后才符合快排定义。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line"></span><br><span class="line">        arr = [str(i) <span class="keyword">for</span> i <span class="keyword">in</span> nums]</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span>(<span class="params">left, right</span>):</span></span><br><span class="line">            <span class="keyword">if</span> left &gt;= right: <span class="keyword">return</span> </span><br><span class="line">            low, high = left, right</span><br><span class="line">            target = arr[left]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> left &lt; right:</span><br><span class="line">                <span class="keyword">while</span> left &lt; right <span class="keyword">and</span> arr[right] + target &gt;= target + arr[right] : right -= <span class="number">1</span></span><br><span class="line">                arr[left] = arr[right]</span><br><span class="line">                <span class="keyword">while</span> left &lt; right <span class="keyword">and</span> arr[left] + target &lt;= target + arr[left]: left += <span class="number">1</span></span><br><span class="line">                arr[right] = arr[left]</span><br><span class="line">            </span><br><span class="line">            arr[left] = target</span><br><span class="line">            quick_sort(low, left<span class="number">-1</span>)</span><br><span class="line">            quick_sort(right+<span class="number">1</span>, high)</span><br><span class="line"></span><br><span class="line">        quick_sort(<span class="number">0</span>, len(arr)<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(arr)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">fast_sort</span>(<span class="params">l, r</span>):</span></span><br><span class="line">            <span class="keyword">if</span> l &gt;= r: <span class="keyword">return</span></span><br><span class="line">            i, j = l, r</span><br><span class="line">            <span class="keyword">while</span> i &lt; j:</span><br><span class="line">                <span class="keyword">while</span> strs[j] + strs[l] &gt;= strs[l] + strs[j] <span class="keyword">and</span> i &lt; j:</span><br><span class="line">                    j -= <span class="number">1</span>  <span class="comment"># 先移动 j</span></span><br><span class="line">                <span class="keyword">while</span> strs[i] + strs[l] &lt;= strs[l] + strs[i] <span class="keyword">and</span> i &lt; j:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">            strs[i], strs[l] = strs[l], strs[i]</span><br><span class="line">            fast_sort(l, i - <span class="number">1</span>)</span><br><span class="line">            fast_sort(i + <span class="number">1</span>, r)</span><br><span class="line"></span><br><span class="line">        strs = [str(num) <span class="keyword">for</span> num <span class="keyword">in</span> nums]</span><br><span class="line">        fast_sort(<span class="number">0</span>, len(strs) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(strs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    nums1 = [<span class="number">10</span>, <span class="number">2</span>]</span><br><span class="line">    nums2 = [<span class="number">3</span>, <span class="number">30</span>, <span class="number">34</span>, <span class="number">5</span>, <span class="number">9</span>]</span><br><span class="line">    print(solution.minNumber(nums1))  <span class="comment"># 102</span></span><br><span class="line">    <span class="comment"># print(solution.minNumber(nums2))  # 3033459</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">3</span>, <span class="number">30</span>, <span class="number">34</span>, <span class="number">5</span>, <span class="number">9</span>]</span><br><span class="line">strs = ['<span class="number">3</span>', '<span class="number">30</span>', '<span class="number">34</span>', '<span class="number">5</span>', '<span class="number">9</span>']</span><br><span class="line">fast_sort(<span class="number">0</span>, len(strs) - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">5</span> - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">i = l = <span class="number">0</span>, j = r = <span class="number">4</span></span><br><span class="line">strs[j] + strs[l] &gt;= strs[l] + strs[j] and i &lt; j</span><br><span class="line">strs[<span class="number">4</span>] + strs[<span class="number">0</span>] &gt; strs[<span class="number">0</span>] + strs[<span class="number">4</span>] and <span class="number">0</span> &lt; <span class="number">4</span></span><br><span class="line">'<span class="number">9</span>' + '<span class="number">3</span>' &gt; '<span class="number">3</span>' + '<span class="number">9</span>' and <span class="number">0</span> &lt; <span class="number">4</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">4</span> - <span class="number">1</span> = <span class="number">0</span> = <span class="number">3</span></span><br><span class="line">strs[<span class="number">3</span>] + strs[<span class="number">0</span>] &gt; strs[<span class="number">0</span>] + strs[<span class="number">3</span>] and <span class="number">0</span> &lt; <span class="number">3</span></span><br><span class="line">'<span class="number">5</span>' + '<span class="number">3</span>' &gt; '<span class="number">3</span>' + '<span class="number">5</span>' and <span class="number">0</span> &lt; <span class="number">3</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">3</span> - <span class="number">1</span> = <span class="number">0</span> = <span class="number">2</span></span><br><span class="line">strs[<span class="number">2</span>] + strs[<span class="number">0</span>] &gt; strs[<span class="number">0</span>] + strs[<span class="number">2</span>] and <span class="number">0</span> &lt; <span class="number">2</span></span><br><span class="line">'<span class="number">34</span>' + '<span class="number">3</span>' &gt; '<span class="number">3</span>' + '<span class="number">34</span>' and <span class="number">0</span> &lt; <span class="number">2</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">2</span> - <span class="number">1</span> = <span class="number">0</span> = <span class="number">1</span></span><br><span class="line">strs[<span class="number">1</span>] + strs[<span class="number">0</span>] &lt; strs[<span class="number">0</span>] + strs[<span class="number">1</span>] and <span class="number">0</span> &lt; <span class="number">1</span></span><br><span class="line">'<span class="number">30</span>' + '<span class="number">3</span>' &lt; '<span class="number">3</span>' + '<span class="number">30</span>' and <span class="number">0</span> &lt; <span class="number">1</span></span><br><span class="line">i = i + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = j </span><br><span class="line">strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">strs[<span class="number">1</span>], strs[<span class="number">1</span>] = strs[<span class="number">1</span>], strs[<span class="number">1</span>]</span><br><span class="line">跳出循环</span><br><span class="line">strs[i], strs[l] = strs[l], strs[i]</span><br><span class="line">strs[<span class="number">1</span>], strs[<span class="number">0</span>] = strs[<span class="number">0</span>], strs[<span class="number">1</span>]</span><br><span class="line">strs = ['<span class="number">30</span>', '<span class="number">3</span>', '<span class="number">34</span>', '<span class="number">5</span>', '<span class="number">9</span>']</span><br><span class="line"></span><br><span class="line">fast_sort(l, i - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">1</span> - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">i = <span class="number">0</span> = j</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line">fast_sort(i + <span class="number">1</span>, r)</span><br><span class="line">fast_sort(<span class="number">1</span> + <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">fast_sort(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">i = l = <span class="number">2</span>, j = r = <span class="number">4</span></span><br><span class="line">strs[j] + strs[l] &gt;= strs[l] + strs[j] and i &lt; j</span><br><span class="line">strs[<span class="number">4</span>] + strs[<span class="number">2</span>] &gt; strs[<span class="number">2</span>] + strs[<span class="number">4</span>] and <span class="number">2</span> &lt; <span class="number">4</span></span><br><span class="line">'<span class="number">9</span>' + '<span class="number">34</span>' &gt; '<span class="number">34</span>' + '<span class="number">9</span>' and <span class="number">2</span> &lt; <span class="number">4</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">4</span> - <span class="number">1</span> = <span class="number">0</span> = <span class="number">3</span></span><br><span class="line">strs[<span class="number">3</span>] + strs[<span class="number">2</span>] &gt; strs[<span class="number">2</span>] + strs[<span class="number">3</span>] and <span class="number">2</span> &lt; <span class="number">3</span></span><br><span class="line">'<span class="number">5</span>' + '<span class="number">34</span>' &gt; '<span class="number">34</span>' + '<span class="number">5</span>' and <span class="number">2</span> &lt; <span class="number">3</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">3</span> - <span class="number">1</span> = <span class="number">0</span> = <span class="number">2</span> = i</span><br><span class="line">strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">strs[<span class="number">2</span>], strs[<span class="number">2</span>] = strs[<span class="number">2</span>], strs[<span class="number">2</span>]</span><br><span class="line">跳出循环</span><br><span class="line">strs[i], strs[l] = strs[l], strs[i]</span><br><span class="line">strs[<span class="number">2</span>], strs[<span class="number">2</span>] = strs[<span class="number">2</span>], strs[<span class="number">2</span>]</span><br><span class="line">strs = ['<span class="number">30</span>', '<span class="number">3</span>', '<span class="number">34</span>', '<span class="number">5</span>', '<span class="number">9</span>']</span><br><span class="line"></span><br><span class="line">fast_sort(l, i - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">2</span>, <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line">fast_sort(i + <span class="number">1</span>, r)</span><br><span class="line">fast_sort(<span class="number">2</span> + <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">fast_sort(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">i = l = <span class="number">3</span>, j = r = <span class="number">4</span></span><br><span class="line">strs[j] + strs[l] &gt;= strs[l] + strs[j] and i &lt; j</span><br><span class="line">strs[<span class="number">4</span>] + strs[<span class="number">3</span>] &gt; strs[<span class="number">3</span>] + strs[<span class="number">4</span>] and <span class="number">3</span> &lt; <span class="number">4</span></span><br><span class="line">'<span class="number">9</span>' + '<span class="number">5</span>' &gt; '<span class="number">5</span>' + '<span class="number">9</span>' and <span class="number">3</span> &lt; <span class="number">4</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">4</span> - <span class="number">1</span> = <span class="number">0</span> = <span class="number">3</span> = i</span><br><span class="line">strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">strs[<span class="number">3</span>], strs[<span class="number">3</span>] = strs[<span class="number">3</span>], strs[<span class="number">3</span>]</span><br><span class="line">跳出循环</span><br><span class="line">strs[i], strs[l] = strs[l], strs[i]</span><br><span class="line">strs[<span class="number">3</span>], strs[<span class="number">3</span>] = strs[<span class="number">3</span>], strs[<span class="number">3</span>]</span><br><span class="line">strs = ['<span class="number">30</span>', '<span class="number">3</span>', '<span class="number">34</span>', '<span class="number">5</span>', '<span class="number">9</span>']</span><br><span class="line"></span><br><span class="line">fast_sort(i + <span class="number">1</span>, r)</span><br><span class="line">fast_sort(<span class="number">3</span> + <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">fast_sort(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">reuturn</span><br><span class="line"></span><br><span class="line">return ''.join(strs) = '<span class="number">3303459</span>'</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">10</span>, <span class="number">2</span>]</span><br><span class="line">strs = ['<span class="number">10</span>', '<span class="number">2</span>']</span><br><span class="line">fast_sort(<span class="number">0</span>, len(strs) - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">i = l = <span class="number">0</span>, j = r = <span class="number">1</span></span><br><span class="line">strs[j] + strs[l] &gt;= strs[l] + strs[j] and i &lt; j</span><br><span class="line">strs[<span class="number">1</span>] + strs[<span class="number">0</span>] &gt; strs[<span class="number">0</span>] + strs[<span class="number">1</span>] and <span class="number">0</span> &lt; <span class="number">1</span></span><br><span class="line">'<span class="number">2</span>' + '<span class="number">10</span>' &gt; '<span class="number">10</span>' + '<span class="number">2</span>' and <span class="number">0</span> &lt; <span class="number">1</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">1</span> - <span class="number">1</span> = <span class="number">0</span> = i</span><br><span class="line"></span><br><span class="line">strs[j] + strs[l] &gt;= strs[l] + strs[j] and i &lt; j</span><br><span class="line">strs[<span class="number">1</span>] + strs[<span class="number">0</span>] &gt;= strs[<span class="number">0</span>] + strs[<span class="number">1</span>] and <span class="number">0</span> &lt; <span class="number">1</span></span><br><span class="line">j = j - <span class="number">1</span> = <span class="number">1</span> - <span class="number">1</span> = <span class="number">0</span> = i</span><br><span class="line">strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">strs[<span class="number">0</span>], strs[<span class="number">0</span>] = strs[<span class="number">0</span>], strs[<span class="number">0</span>]</span><br><span class="line">j = <span class="number">0</span> = i</span><br><span class="line"></span><br><span class="line">strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">strs[<span class="number">0</span>], strs[<span class="number">0</span>] = strs[<span class="number">0</span>], strs[<span class="number">0</span>]</span><br><span class="line">跳出循环</span><br><span class="line">strs[i], strs[l] = strs[l], strs[i]</span><br><span class="line">strs[<span class="number">0</span>], strs[<span class="number">0</span>] = strs[<span class="number">0</span>], strs[<span class="number">0</span>]</span><br><span class="line">strs = ['<span class="number">10</span>', '<span class="number">2</span>']</span><br><span class="line"></span><br><span class="line">fast_sort(l, i - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">0</span> - <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">i = l = <span class="number">0</span> &gt; j = r = <span class="number">-1</span></span><br><span class="line">return</span><br><span class="line"></span><br><span class="line">fast_sort(i + <span class="number">1</span>, r)</span><br><span class="line">fast_sort(<span class="number">0</span> + <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">fast_sort(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">i = l = <span class="number">1</span> = j = r </span><br><span class="line">return</span><br><span class="line"></span><br><span class="line">return ''.join(strs) = '<span class="number">102</span>'</span><br></pre></td></tr></tbody></table></figure>

<p>本文排序规则的传递性证明：</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">字符串 xy &lt; yx , yz &lt; zy ，需证明 xz &lt; zx 一定成立。</span><br><span class="line"></span><br><span class="line">设十进制数 x, y, z 分别有 a, b, c 位，则有：</span><br><span class="line">（左边是字符串拼接，右边是十进制数计算，两者等价）</span><br><span class="line">xy = x * <span class="number">10</span>^b + y </span><br><span class="line">yx = y * <span class="number">10</span>^a + x</span><br><span class="line"></span><br><span class="line">则 xy &lt; yx 可转化为：</span><br><span class="line">x * <span class="number">10</span>^b + y &lt; y * <span class="number">10</span>^a + x</span><br><span class="line">x (<span class="number">10</span>^b - <span class="number">1</span>) &lt; y (<span class="number">10</span>^a - <span class="number">1</span>)</span><br><span class="line">x / (<span class="number">10</span>^a - <span class="number">1</span>) &lt; y / (<span class="number">10</span>^b - <span class="number">1</span>)     ①</span><br><span class="line"></span><br><span class="line">同理， 可将 yz &lt; zy 转化为：</span><br><span class="line">y / (<span class="number">10</span>^b - <span class="number">1</span>) &lt; z / (<span class="number">10</span>^c - <span class="number">1</span>)     ②</span><br><span class="line"></span><br><span class="line">将 ① ② 合并，整理得：</span><br><span class="line">x / (<span class="number">10</span>^a - <span class="number">1</span>) &lt; y / (<span class="number">10</span>^b - <span class="number">1</span>) &lt; z / (<span class="number">10</span>^c - <span class="number">1</span>)</span><br><span class="line">x / (<span class="number">10</span>^a - <span class="number">1</span>) &lt; z / (<span class="number">10</span>^c - <span class="number">1</span>)</span><br><span class="line">x (<span class="number">10</span>^c - <span class="number">1</span>) &lt; z (<span class="number">10</span>^a - <span class="number">1</span>)</span><br><span class="line">x * <span class="number">10</span>^c + z &lt; z * <span class="number">10</span>^a + x</span><br><span class="line">∴  可推出 xz &lt; zx ，传递性证毕</span><br></pre></td></tr></tbody></table></figure>

<p>跟 l 还是 r 比取决于我们把哪个元素看作”哨兵“，跟 r 比也可以，<br>如果要用 r ，哨兵 i, j 的移动先后顺序也要对换<br>因为最后要把 strs[i], strs[r] 交换，因此要保证 ``strs[i] &gt; strs[r]` （和 l 的情况正好相反），这样交换后才符合快排定义。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">fast_sort</span>(<span class="params">l , r</span>):</span></span><br><span class="line">            <span class="keyword">if</span> l &gt;= r: <span class="keyword">return</span></span><br><span class="line">            i, j = l, r</span><br><span class="line">            <span class="keyword">while</span> i &lt; j:</span><br><span class="line">                <span class="keyword">while</span> strs[i] + strs[r] &lt;= strs[r] + strs[i] <span class="keyword">and</span> i &lt; j:</span><br><span class="line">                    i += <span class="number">1</span>  <span class="comment"># 先移动 i</span></span><br><span class="line">                <span class="keyword">while</span> strs[j] + strs[r] &gt;= strs[r] + strs[j] <span class="keyword">and</span> i &lt; j: </span><br><span class="line">                    j -= <span class="number">1</span></span><br><span class="line">                strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">            strs[i], strs[r] = strs[r], strs[i]</span><br><span class="line">            fast_sort(l, i - <span class="number">1</span>)</span><br><span class="line">            fast_sort(i + <span class="number">1</span>, r)</span><br><span class="line">        </span><br><span class="line">        strs = [str(num) <span class="keyword">for</span> num <span class="keyword">in</span> nums]</span><br><span class="line">        fast_sort(<span class="number">0</span>, len(strs) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(strs)</span><br></pre></td></tr></tbody></table></figure>

<p>函数 A 内部 定义 函数B ，则 B 的用途就是让 A 去调用的。函数 A 外，是无法访问函数 B 的，可以运行以下代码理解：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        strs = [str(num) <span class="keyword">for</span> num <span class="keyword">in</span> nums]</span><br><span class="line">        fast_sort(<span class="number">0</span>, len(strs) - <span class="number">1</span>) <span class="comment"># 报错 not defined</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(strs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">fast_sort</span>(<span class="params">l , r</span>):</span></span><br><span class="line">            <span class="keyword">if</span> l &gt;= r: <span class="keyword">return</span></span><br><span class="line">            i, j = l, r</span><br><span class="line">            <span class="keyword">while</span> i &lt; j:</span><br><span class="line">                <span class="keyword">while</span> strs[j] + strs[l] &gt;= strs[l] + strs[j] <span class="keyword">and</span> i &lt; j: j -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">while</span> strs[i] + strs[l] &lt;= strs[l] + strs[i] <span class="keyword">and</span> i &lt; j: i += <span class="number">1</span></span><br><span class="line">                strs[i], strs[j] = strs[j], strs[i]</span><br><span class="line">            strs[i], strs[l] = strs[l], strs[i]</span><br><span class="line">            fast_sort(l, i - <span class="number">1</span>)</span><br><span class="line">            fast_sort(i + <span class="number">1</span>, r)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>

<p>内置函数：<br>需定义排序规则：<br>Python 定义在函数 sort_rule(x, y) 中；<br>本题可以转化为排序问题，因此我们要定义一个“有效的排序规则”，然后按照这个排序规则、使用任意排序方法，将数组排序~<br>3.8 新版功能.<br><code>functools.cmp_to_key(func)</code><br>将(旧式的)比较函数转换为新式的 key function . 在类似于 sorted() ， min() ， max() ， heapq.nlargest() ， heapq.nsmallest() ， itertools.groupby() 等函数的 key 参数中使用。此函数主要用作将 Python 2 程序转换至新版的转换工具，以保持对比较函数的兼容。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">sort_rule</span>(<span class="params">x, y</span>):</span></span><br><span class="line">            a, b = x + y, y + x</span><br><span class="line">            <span class="keyword">if</span> a &gt; b: <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> a &lt; b: <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        strs = [str(num) <span class="keyword">for</span> num <span class="keyword">in</span> nums]</span><br><span class="line">        strs.sort(key=functools.cmp_to_key(sort_rule))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(strs)</span><br></pre></td></tr></tbody></table></figure>


<p>key 指向这个cmpSmaller ，然后sorted调用过程中，会强制转换类型 将原先的 str 字符串类型改为 这个 cmpSmaller 类型，然后排序的时候，就会调用这个 重写 的 <strong>lt</strong> 方法，从而使用了自定义的 排序规则，得到了最终结果。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cmpSmaller</span>(<span class="params">str</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, y</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self + y &lt; y + self  <span class="comment"># 字符串拼接比较(两两比较)</span></span><br><span class="line">    <span class="comment"># 按由小到大来排列</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        res=sorted(map(str, nums),key=cmpSmaller)</span><br><span class="line">        smallest = <span class="string">''</span>.join(res)</span><br><span class="line">        <span class="keyword">return</span> smallest</span><br></pre></td></tr></tbody></table></figure>


<p>冒泡</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumber</span>(<span class="params">self, nums: List[int]</span>) -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            nums[i] = str(nums[i])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>,len(nums)):</span><br><span class="line">                <span class="keyword">if</span> nums[i] + nums[j] &gt; nums[j] + nums[i]:</span><br><span class="line">                    nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(nums)</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h2 id="386-字典序排数"><a href="#386-字典序排数" class="headerlink" title="386. 字典序排数"></a>386. 字典序排数</h2><p><strong>给定一个整数&nbsp;n, 返回从&nbsp;1&nbsp;到&nbsp;n&nbsp;的字典顺序。</strong></p>
<p>例如，<br>给定 n =13，返回 [1,10,11,12,13,2,3,4,5,6,7,8,9] 。</p>
<p>例子是1在10之前<br>数字最高位是以1-9开头的，<br>给你一个数字1，把这个数字开头的，并且不大于n的所有数字按照位数由低到高依次排列<br>给你一个数字2，把这个数字开头的，并且不大于n的所有数字按照位数由低到高依次排列<br>当两个数字最高位相同的时候，就需要比较其次高位，比较方式与最高位的比较方式是一致的，也就是递归下去。（这是我的理解，可能有点不太准确）</p>
<p>将n个数按照一定的顺序构建成树，然后从左到右对每棵树进行dfs就行了</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                    root</span><br><span class="line">            /           |            |          \  </span><br><span class="line">            <span class="number">1</span>            <span class="number">2</span>            <span class="number">3</span>    ...     <span class="number">9</span></span><br><span class="line">        /      \       \ </span><br><span class="line">      <span class="number">10</span>        <span class="number">11</span>    </span><br><span class="line">   /  |   \     /  |  |  \ </span><br><span class="line"><span class="number">100</span>  <span class="number">101</span>   <span class="number">109</span> <span class="number">110</span></span><br></pre></td></tr></tbody></table></figure>

<p>时间复杂度: O(N)，使用了递归，时间复杂度为进入递归函数的次数，我们遍历了每一个结点<br>空间复杂度: O(1)</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lexicalOrder</span>(<span class="params">self, n: int</span>) -&gt; List[int]:</span></span><br><span class="line">        res = []</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">cur</span>):</span>  <span class="comment"># N叉树 深度优先搜索 对每棵树进行dfs cur为根结点</span></span><br><span class="line">            <span class="keyword">if</span> cur &gt; n:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            res.append(cur)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):  <span class="comment"># 遍历0 ~ 9</span></span><br><span class="line">                dfs(cur * <span class="number">10</span> + j)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>):  <span class="comment"># 遍历1 ~ 9</span></span><br><span class="line">            dfs(i)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.lexicalOrder(<span class="number">13</span>))</span><br><span class="line"><span class="comment"># [1, 10, 11, 12, 13, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line">print(s.lexicalOrder(<span class="number">0</span>))  <span class="comment"># []</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">13</span></span><br><span class="line">res = []</span><br><span class="line"></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line">dfs(<span class="number">1</span>)</span><br><span class="line">    cur = <span class="number">1</span> &lt; n = <span class="number">13</span></span><br><span class="line">    res.append(cur)</span><br><span class="line">    res= [<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">1</span> * <span class="number">10</span> + <span class="number">0</span>)</span><br><span class="line">    dfs(<span class="number">10</span>)</span><br><span class="line">        cur = <span class="number">10</span> &lt; n = <span class="number">13</span></span><br><span class="line">        res.append(cur)</span><br><span class="line">        res= [<span class="number">1</span>, <span class="number">10</span>]</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">10</span> * <span class="number">10</span> + <span class="number">0</span>)</span><br><span class="line">        dfs(<span class="number">100</span>)</span><br><span class="line">            cur = <span class="number">100</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">10</span> * <span class="number">10</span> + <span class="number">1</span>)</span><br><span class="line">        dfs(<span class="number">101</span>)</span><br><span class="line">            cur = <span class="number">101</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>        </span><br><span class="line">        ....</span><br><span class="line">        j = <span class="number">9</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">10</span> * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">109</span>)</span><br><span class="line">            cur = <span class="number">109</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>               </span><br><span class="line"></span><br><span class="line">    j = <span class="number">1</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">1</span> * <span class="number">10</span> + <span class="number">1</span>)</span><br><span class="line">    dfs(<span class="number">11</span>)</span><br><span class="line">        cur = <span class="number">11</span> &lt; n = <span class="number">13</span></span><br><span class="line">        res.append(cur)</span><br><span class="line">        res= [<span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>]</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">11</span> * <span class="number">10</span> + <span class="number">0</span>)</span><br><span class="line">        dfs(<span class="number">110</span>)</span><br><span class="line">            cur = <span class="number">110</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">11</span> * <span class="number">10</span> + <span class="number">1</span>)</span><br><span class="line">        dfs(<span class="number">111</span>)</span><br><span class="line">            cur = <span class="number">111</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>  </span><br><span class="line">        ....</span><br><span class="line">        j = <span class="number">9</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">11</span> * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">119</span>)</span><br><span class="line">            cur = <span class="number">119</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>      </span><br><span class="line"></span><br><span class="line">    j = <span class="number">2</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">1</span> * <span class="number">10</span> + <span class="number">2</span>)</span><br><span class="line">    dfs(<span class="number">12</span>)</span><br><span class="line">        cur = <span class="number">12</span> &lt; n = <span class="number">13</span></span><br><span class="line">        res.append(cur)</span><br><span class="line">        res= [<span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">12</span> * <span class="number">10</span> + <span class="number">0</span>)</span><br><span class="line">        dfs(<span class="number">120</span>)</span><br><span class="line">            cur = <span class="number">120</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">12</span> * <span class="number">10</span> + <span class="number">1</span>)</span><br><span class="line">        dfs(<span class="number">121</span>)</span><br><span class="line">            cur = <span class="number">121</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>  </span><br><span class="line">        ....</span><br><span class="line">        j = <span class="number">9</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">12</span> * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">129</span>)</span><br><span class="line">            cur = <span class="number">129</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">    j = <span class="number">3</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">1</span> * <span class="number">10</span> + <span class="number">3</span>)</span><br><span class="line">    dfs(<span class="number">13</span>)</span><br><span class="line">        cur = <span class="number">13</span> = n</span><br><span class="line">        res.append(cur)</span><br><span class="line">        res= [<span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">13</span> * <span class="number">10</span> + <span class="number">0</span>)</span><br><span class="line">        dfs(<span class="number">130</span>)</span><br><span class="line">            cur = <span class="number">130</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">        dfs(<span class="number">13</span> * <span class="number">10</span> + <span class="number">1</span>)</span><br><span class="line">        dfs(<span class="number">131</span>)</span><br><span class="line">            cur = <span class="number">131</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">        ....</span><br><span class="line"></span><br><span class="line">        j = <span class="number">9</span></span><br><span class="line">        dfs(cur * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">13</span> * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">        dfs(<span class="number">139</span>)</span><br><span class="line">            cur = <span class="number">139</span> &gt; n = <span class="number">13</span></span><br><span class="line">            <span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">    j = <span class="number">4</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">1</span> * <span class="number">10</span> + <span class="number">4</span>)</span><br><span class="line">    dfs(<span class="number">14</span>)</span><br><span class="line">        cur = <span class="number">14</span> &gt; n = <span class="number">13</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    j = <span class="number">5</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">1</span> * <span class="number">10</span> + <span class="number">5</span>)</span><br><span class="line">    dfs(<span class="number">15</span>)</span><br><span class="line">        cur = <span class="number">15</span> &gt; n = <span class="number">13</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    j = <span class="number">9</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">1</span> * <span class="number">10</span> + <span class="number">9</span>)</span><br><span class="line">    dfs(<span class="number">19</span>)</span><br><span class="line">        cur = <span class="number">19</span> &gt; n = <span class="number">13</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">2</span></span><br><span class="line">dfs(<span class="number">2</span>)</span><br><span class="line">    cur = <span class="number">2</span> &lt; n = <span class="number">13</span></span><br><span class="line">    res.append(cur)</span><br><span class="line">    res= [<span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">2</span> * <span class="number">10</span> + <span class="number">0</span>)</span><br><span class="line">    dfs(<span class="number">20</span>)</span><br><span class="line">        cur = <span class="number">20</span> &gt; n = <span class="number">13</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">3</span></span><br><span class="line">dfs(<span class="number">3</span>)</span><br><span class="line">    cur = <span class="number">3</span> &lt; n = <span class="number">13</span></span><br><span class="line">    res.append(cur)</span><br><span class="line">    res= [<span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    dfs(cur * <span class="number">10</span> + j)</span><br><span class="line">    dfs(<span class="number">3</span> * <span class="number">10</span> + <span class="number">0</span>)</span><br><span class="line">    dfs(<span class="number">30</span>)</span><br><span class="line">        cur = <span class="number">30</span> &gt; n = <span class="number">13</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lexicalOrder</span>(<span class="params">self, n: int</span>) -&gt; List[int]:</span></span><br><span class="line">        self.n, self.res = n, []</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">dfs</span>(<span class="params">cur</span>):</span> </span><br><span class="line">            <span class="keyword">if</span> cur &gt; self.n: <span class="keyword">return</span> </span><br><span class="line">            self.res.append(cur)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                dfs(<span class="number">10</span> * cur + i)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">            dfs(i)</span><br><span class="line">        <span class="keyword">return</span> self.res</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lexicalOrder</span>(<span class="params">self, n: int</span>) -&gt; List[int]:</span></span><br><span class="line">        <span class="keyword">return</span> sorted(range(<span class="number">1</span>, n+<span class="number">1</span>), key=str) </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lexicalOrder</span>(<span class="params">self, n: int</span>) -&gt; List[int]:</span></span><br><span class="line">        <span class="keyword">return</span> sorted(list(range(<span class="number">1</span>,n+<span class="number">1</span>)),key=<span class="keyword">lambda</span> x:str(x))</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h2 id="剑指-Offer-19-正则表达式匹配"><a href="#剑指-Offer-19-正则表达式匹配" class="headerlink" title="剑指 Offer 19. 正则表达式匹配"></a>剑指 Offer 19. 正则表达式匹配</h2><p><strong>请实现一个函数用来匹配包含<code>'. '</code>和<code>'*'</code>的正则表达式。模式中的字符<code>'.'</code>表示任意一个字符，而<code>'*'</code>表示它前面的字符可以出现任意次（含0次）。在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串<code>"aaa"</code>与模式<code>"a.a"</code>和<code>"ab*ac*a"</code>匹配，但与<code>"aa.a"</code>和<code>"ab*a"</code>均不匹配。</strong></p>
<p>示例 1:</p>
<figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">输入:</span></span><br><span class="line">s = <span class="string">"aa"</span></span><br><span class="line">p = <span class="string">"a"</span></span><br><span class="line"><span class="section">输出: false</span></span><br><span class="line"><span class="section">解释: "a" 无法匹配 "aa" 整个字符串。</span></span><br></pre></td></tr></tbody></table></figure>

<p>示例 2:</p>
<figure class="highlight smalltalk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入:</span><br><span class="line">s = <span class="comment">"aa"</span></span><br><span class="line">p = <span class="comment">"a*"</span></span><br><span class="line">输出: <span class="keyword">true</span></span><br><span class="line">解释: 因为 <span class="string">'*'</span> 代表可以匹配零个或多个前面的那一个元素, 在这里前面的元素就是 <span class="string">'a'</span>。因此，字符串 <span class="comment">"aa"</span> 可被视为 <span class="string">'a'</span> 重复了一次。</span><br></pre></td></tr></tbody></table></figure>

<p>示例 3:</p>
<figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">输入:</span></span><br><span class="line">s = <span class="string">"ab"</span></span><br><span class="line">p = <span class="string">".*"</span></span><br><span class="line"><span class="section">输出: true</span></span><br><span class="line"><span class="section">解释: ".*" 表示可匹配零个或多个（'*'）任意字符（'.'）。</span></span><br></pre></td></tr></tbody></table></figure>

<p>示例 4:</p>
<figure class="highlight smalltalk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入:</span><br><span class="line">s = <span class="comment">"aab"</span></span><br><span class="line">p = <span class="comment">"c*a*b"</span></span><br><span class="line">输出: <span class="keyword">true</span></span><br><span class="line">解释: 因为 <span class="string">'*'</span> 表示零个或多个，这里 <span class="string">'c'</span> 为 <span class="number">0</span> 个, <span class="string">'a'</span> 被重复一次。因此可以匹配字符串 <span class="comment">"aab"</span>。</span><br></pre></td></tr></tbody></table></figure>
<p>示例 5:</p>
<figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">输入:</span></span><br><span class="line">s = <span class="string">"mississippi"</span></span><br><span class="line">p = <span class="string">"mis*is*p*."</span></span><br><span class="line"><span class="section">输出: false</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>s 可能为空，且只包含从 a-z 的小写字母。</li>
<li>p 可能为空，且只包含从 a-z 的小写字母以及字符 . 和 <em>，无连续的 ‘</em>‘。</li>
</ul>
<p>解题思路：</p>
<blockquote>
<p>设 s 的长度为 n ， p 的长度为 m ；将 s 的第 i 个字符记为 s_i ，p 的第 j 个字符记为 p_j ，将 s 的前 i 个字符组成的子字符串记为 s[:i] , 同理将 p 的前 j 个字符组成的子字符串记为 p[:j] 。</p>
</blockquote>
<blockquote>
<p>因此，本题可转化为求 s[:n] 是否能和 p[:m] 匹配。</p>
</blockquote>
<p>总体思路是从 s[:1] 和 p[:1] 是否能匹配开始判断，每轮添加一个字符并判断是否能匹配，直至添加完整个字符串 s 和 p 。展开来看，假设 s[:i] 与 p[:j] 可以匹配，那么下一状态有两种：</p>
<ol>
<li>添加一个字符 s_{i+1} 后是否能匹配？</li>
<li>添加字符 p_{j+1} 后是否能匹配？</li>
</ol>
<p>因此，本题的状态共有 m×n 种，应定义状态矩阵 dp ，dp[i][j] 代表 s[:i] 与 p[:j] 是否可以匹配。</p>
<p>做好状态定义，接下来就是根据 「<code>普通字符</code>」 , 「<code>.</code>」 , 「<code>*</code>」三种字符的功能定义，分析出动态规划的转移方程。</p>
<h3 id="动态规划解析："><a href="#动态规划解析：" class="headerlink" title="动态规划解析："></a>动态规划解析：</h3><ul>
<li><p>状态定义： 设动态规划矩阵 <code>dp</code> ， <code>dp[i][j]</code> 代表字符串 <code>s</code> 的前 <code>i</code> 个字符和 <code>p</code> 的前 <code>j</code> 个字符能否匹配。</p>
</li>
<li><p>转移方程： 需要注意，由于 <code>dp[0][0]</code> 代表的是空字符的状态， 因此 <code>dp[i][j]</code> 对应的添加字符是 <code>s[i - 1]</code> 和 <code>p[j - 1]</code> 。</p>
</li>
</ul>
<p>当 <code>p[j - 1] = '*'</code> 时， dp[i][j] 在当以下任一情况为 truetrue 时等于 truetrue ：</p>
<p>dp[i][j - 2]： 即将字符组合 p[j - 2] * 看作出现 0 次时，能否匹配；<br>dp[i][j - 1]： 即将字符组合 p[j - 2] * 看作出现 1 次时，能否匹配；<br>dp[i - 1][j] 且 s[i - 1] = p[j - 2]: 即让字符 p[j - 2] 多出现 1 次时，能否匹配；<br>dp[i - 1][j] 且 p[j - 2] = ‘.’: 即让字符 ‘.’ 多出现 1 次时，能否匹配；<br>当 p[j - 1] != ‘*’ 时， dp[i][j] 在当以下任一情况为 truetrue 时等于 truetrue ：</p>
<p>dp[i - 1][j - 1] 且 s[i - 1] = p[j - 1]： 即让字符 p[j - 1] 多出现一次时，能否匹配；<br>dp[i - 1][j - 1] 且 p[j - 1] = ‘.’： 即将字符 . 看作字符 s[i - 1] 时，能否匹配；<br>初始化： 需要先初始化 dp 矩阵首行，以避免状态转移时索引越界。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">```dp[0][j] = dp[0][j - 2]``` 且 ```p[j - 1] = '*'```： 首行 s 为空字符串，因此当 p 的偶数位为 * 时才能够匹配（即让 p 的奇数位出现 0 次，保持 p 是空字符串）。因此，循环遍历字符串 p ，步长为 2（即只看偶数位）。</span><br><span class="line"></span><br><span class="line">- 返回值： ```dp``` 矩阵右下角字符，代表字符串 s 和 p 能否匹配。</span><br><span class="line"></span><br><span class="line">时间复杂度 O(MN) ： 其中 M, N 分别为 ```s``` 和 ```p``` 的长度，状态转移需遍历整个 ```dp``` 矩阵。</span><br><span class="line">空间复杂度 O(MN) ： 状态矩阵 ```dp``` 使用 O(MN) 的额外空间。</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">class Solution:</span><br><span class="line">    def isMatch(self, s: str, p: str) -&gt; bool:</span><br><span class="line">        m, n = len(s) + 1, len(p) + 1</span><br><span class="line">        dp = [[False] * n for _ in range(m)]</span><br><span class="line">        dp[0][0] = True</span><br><span class="line">        # 初始化首行</span><br><span class="line">        for j in range(2, n, 2):</span><br><span class="line">            dp[0][j] = dp[0][j - 2] and p[j - 1] == '*'</span><br><span class="line">        # 状态转移</span><br><span class="line">        for i in range(1, m):</span><br><span class="line">            for j in range(1, n):</span><br><span class="line">                if p[j - 1] == '*':</span><br><span class="line">                    if dp[i][j - 2]:</span><br><span class="line">                        dp[i][j] = True  # 1.</span><br><span class="line">                    elif dp[i][j - 1]:</span><br><span class="line">                        dp[i][j] = True  # 2.</span><br><span class="line">                    elif dp[i - 1][j] and s[i - 1] == p[j - 2]:</span><br><span class="line">                        dp[i][j] = True  # 3.</span><br><span class="line">                    elif dp[i - 1][j] and p[j - 2] == '.':</span><br><span class="line">                        dp[i][j] = True  # 4.</span><br><span class="line">                else:</span><br><span class="line">                    if dp[i - 1][j - 1] and s[i - 1] == p[j - 1]:</span><br><span class="line">                        dp[i][j] = True  # 1.</span><br><span class="line">                    elif dp[i - 1][j - 1] and p[j - 1] == '.':</span><br><span class="line">                        dp[i][j] = True  # 2.</span><br><span class="line">        return dp[-1][-1]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    solution = Solution()</span><br><span class="line">    nums1 = 'aaa'</span><br><span class="line">    nums2 = 'ab*.*'</span><br><span class="line">    print(solution.isMatch(nums1, nums2))  # True</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">s = 'aaa'</span><br><span class="line">p = 'ab<span class="emphasis">*.*</span>'</span><br><span class="line">m = len(s) + 1 = 4</span><br><span class="line">n = len(p) + 1 = 6</span><br><span class="line"></span><br><span class="line"><span class="emphasis">_ = 0</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">dp = [</span></span><br><span class="line"><span class="emphasis">    [False, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">    [False, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">    [False, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">    [False, False, False, False, False, False, False, False] </span></span><br><span class="line"><span class="emphasis">    ]</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">dp[<span class="string">0</span>][<span class="symbol">0</span>] = True</span></span><br><span class="line"><span class="emphasis">dp = [</span></span><br><span class="line"><span class="emphasis">    [True, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">    [False, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">    [False, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">    [False, False, False, False, False, False, False, False] </span></span><br><span class="line"><span class="emphasis">    ]</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">j = 2   </span></span><br><span class="line"><span class="emphasis">dp[<span class="string">0</span>][<span class="symbol">j</span>] = dp[<span class="string">0</span>][<span class="symbol">j - 2</span>]</span></span><br><span class="line"><span class="emphasis">dp[<span class="string">0</span>][<span class="symbol">2</span>] = dp[<span class="string">0</span>][<span class="symbol">2 - 2</span>]</span></span><br><span class="line"><span class="emphasis">dp[<span class="string">0</span>][<span class="symbol">2</span>] = dp[<span class="string">0</span>][<span class="symbol">0</span>]</span></span><br><span class="line"><span class="emphasis">p[j - 1] == '*'</span></span><br><span class="line"><span class="emphasis">p[2 - 1] == '*'</span></span><br><span class="line"><span class="emphasis">p[1] == '*'</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">j = 4</span></span><br><span class="line"><span class="emphasis">dp[<span class="string">0</span>][<span class="symbol">4</span>] = dp[<span class="string">0</span>][<span class="symbol">4 - 2</span>]</span></span><br><span class="line"><span class="emphasis">dp[<span class="string">0</span>][<span class="symbol">4</span>] = dp[<span class="string">0</span>][<span class="symbol">2</span>]</span></span><br><span class="line"><span class="emphasis">p[j - 1] == '*'</span></span><br><span class="line"><span class="emphasis">p[4 - 1] == '*'</span></span><br><span class="line"><span class="emphasis">p[3] == '*'</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">i = 1</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 1</span></span><br><span class="line"><span class="emphasis">    p[j - 1] == p[1 - 1] == p[0] = 'a' != '*'</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i - 1</span>][<span class="symbol">j - 1</span>] = dp[<span class="string">1 - 1</span>][<span class="symbol">1 - 1</span>]  = dp[<span class="string">0</span>][<span class="symbol">0</span>] = True</span></span><br><span class="line"><span class="emphasis">    s[i - 1] = s[1 - 1] == s[0] = 'a' = p[1 - 1] = p[0]</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i</span>][<span class="symbol">j</span>] = dp[<span class="string">1</span>][<span class="symbol">1</span>] = True</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    dp = [</span></span><br><span class="line"><span class="emphasis">        [True, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, True, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, False, False, False, False, False, False, False] </span></span><br><span class="line"><span class="emphasis">        ]</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 2</span></span><br><span class="line"><span class="emphasis">    p[j - 1] == p[2 - 1] == p[1] = 'b' != '*'</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i - 1</span>][<span class="symbol">j - 1</span>] = dp[<span class="string">1 - 1</span>][<span class="symbol">2 - 1</span>]  = dp[<span class="string">0</span>][<span class="symbol">1</span>] = True</span></span><br><span class="line"><span class="emphasis">    s[i - 1] = s[1 - 1] == s[0] = 'a' != p[2 - 1] = p[1] = 'b'</span></span><br><span class="line"><span class="emphasis">    False</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i - 1</span>][<span class="symbol">j - 1</span>] = dp[<span class="string">1 - 1</span>][<span class="symbol">2 - 1</span>] = dp[<span class="string">0</span>][<span class="symbol">1</span>] = False</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 3</span></span><br><span class="line"><span class="emphasis">    p[j - 1] == p[3 - 1] == p[2] = '*'</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i</span>][<span class="symbol">j - 2</span>] = dp[<span class="string">1</span>][<span class="symbol">3 - 2</span>] = dp[<span class="string">1</span>][<span class="symbol">1</span>] = True</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i</span>][<span class="symbol">j</span>] = dp[<span class="string">1</span>][<span class="symbol">3</span>] = True</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    dp = [</span></span><br><span class="line"><span class="emphasis">        [True, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, True, False, True, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, False, False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, False, False, False, False, False, False, False] </span></span><br><span class="line"><span class="emphasis">        ]</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 4</span></span><br><span class="line"><span class="emphasis">    p[j - 1] == p[4 - 1] == p[3] = '.' != '*'</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i - 1</span>][<span class="symbol">j - 1</span>] = dp[<span class="string">1 - 1</span>][<span class="symbol">4 - 1</span>] = dp[<span class="string">0</span>][<span class="symbol">3</span>] = False</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 5</span></span><br><span class="line"><span class="emphasis">    p[j - 1] == p[5 - 1] == p[4] = '*'</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i</span>][<span class="symbol">j - 2</span>] = dp[<span class="string">1</span>][<span class="symbol">5 - 2</span>] = dp[<span class="string">1</span>][<span class="symbol">3</span>] = True</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i</span>][<span class="symbol">j</span>] = dp[<span class="string">1</span>][<span class="symbol">5</span>] = True</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    dp = [</span></span><br><span class="line"><span class="emphasis">        [True, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, True, False, True, False, True], </span></span><br><span class="line"><span class="emphasis">        [False, False, False, False, False, False], </span></span><br><span class="line"><span class="emphasis">        [False, False, False, False, False, False] </span></span><br><span class="line"><span class="emphasis">        ]</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">i = 2</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 1</span></span><br><span class="line"><span class="emphasis">    p[j - 1] == p[1 - 1] == p[0] = 'a' != '*'</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i - 1</span>][<span class="symbol">j - 1</span>] = dp[<span class="string">2 - 1</span>][<span class="symbol">1 - 1</span>]  = dp[<span class="string">1</span>][<span class="symbol">0</span>] = False</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 2</span></span><br><span class="line"><span class="emphasis">    p[j - 1] == p[2 - 1] == p[1] = 'b' != '*'</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i - 1</span>][<span class="symbol">j - 1</span>] = dp[<span class="string">2 - 1</span>][<span class="symbol">2 - 1</span>]  = dp[<span class="string">1</span>][<span class="symbol">1</span>] = True</span></span><br><span class="line"><span class="emphasis">    s[i - 1] = s[2 - 1] = s[1] = 'a' != p[j - 1] = p[2 - 1] = p[1] = 'b'</span></span><br><span class="line"><span class="emphasis">    False</span></span><br><span class="line"><span class="emphasis">    p[j - 1] = p[2 - 1] = p[1] = 'b' != '.'</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    j = 3</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i</span>][<span class="symbol">j - 2</span>] = dp[<span class="string">2</span>][<span class="symbol">3 - 2</span>] = dp[<span class="string">2</span>][<span class="symbol">1</span>] = False</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i</span>][<span class="symbol">j - 1</span>] = dp[<span class="string">2</span>][<span class="symbol">3 - 1</span>] = dp[<span class="string">2</span>][<span class="symbol">2</span>] = False</span></span><br><span class="line"><span class="emphasis">    dp[<span class="string">i - 1</span>][<span class="symbol">j</span>] = dp[<span class="string">2 - 1</span>][<span class="symbol">3</span>] = dp[<span class="string">1</span>][<span class="symbol">3</span>] = False</span></span><br><span class="line"><span class="emphasis"></span></span><br></pre></td></tr></tbody></table></figure>

<p>利用布尔运算实现简短长度</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span>(<span class="params">self, s: str, p: str</span>) -&gt; bool:</span></span><br><span class="line">        m, n = len(s) + <span class="number">1</span>, len(p) + <span class="number">1</span></span><br><span class="line">        dp = [[<span class="literal">False</span>] * n <span class="keyword">for</span> _ <span class="keyword">in</span> range(m)]</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>, n, <span class="number">2</span>):</span><br><span class="line">            dp[<span class="number">0</span>][j] = dp[<span class="number">0</span>][j - <span class="number">2</span>] <span class="keyword">and</span> p[j - <span class="number">1</span>] == <span class="string">'*'</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">                dp[i][j] = dp[i][j - <span class="number">2</span>] <span class="keyword">or</span> dp[i][j - <span class="number">1</span>] <span class="keyword">or</span> dp[i - <span class="number">1</span>][j] <span class="keyword">and</span> (s[i - <span class="number">1</span>] == p[j - <span class="number">2</span>] <span class="keyword">or</span> p[j - <span class="number">2</span>] == <span class="string">'.'</span>) \</span><br><span class="line">                           <span class="keyword">if</span> p[j - <span class="number">1</span>] == <span class="string">'*'</span> <span class="keyword">else</span> \</span><br><span class="line">                           dp[i - <span class="number">1</span>][j - <span class="number">1</span>] <span class="keyword">and</span> (p[j - <span class="number">1</span>] == <span class="string">'.'</span> <span class="keyword">or</span> s[i - <span class="number">1</span>] == p[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">-1</span>][<span class="number">-1</span>]</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/leetcode-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/leetcode-sql/" class="post-title-link" itemprop="url">leetcode sql</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>正常情况下SELECT的书写顺序和执行顺序</p>
<h3 id="写法顺序："><a href="#写法顺序：" class="headerlink" title="写法顺序："></a>写法顺序：</h3><p>SELECT →FROM → JOIN → ON → WHERE → GROUP BY → HAVING → ORDER BY→ LIMIT</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 查询列表                ⑦                    </span><br><span class="line"><span class="keyword">FROM</span> 表 <span class="number">1</span>                    ①                                      </span><br><span class="line">【连接类型】 <span class="keyword">JOIN</span> 表 <span class="number">2</span>        ③                           </span><br><span class="line"><span class="keyword">ON</span> 连接条件                    ②</span><br><span class="line"><span class="keyword">WHERE</span> 筛选条件                ④</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列表            ⑤</span><br><span class="line"><span class="keyword">HAVING</span> 分组后的筛选条件        ⑥</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序的字段            ⑧</span><br><span class="line"><span class="keyword">LIMIT</span> 起始的条目索引，条目数;    ⑨</span><br></pre></td></tr></tbody></table></figure>

<h3 id="执行顺序："><a href="#执行顺序：" class="headerlink" title="执行顺序："></a>执行顺序：</h3><p>FROM → ON → JOIN → WHERE → GROUP BY → with HAVING → SELECT → ORDER BY→ LIMIT<br>TOP</p>
<p>若 每页显示条目数：<code>pageSize</code>，要显示的页数：<code>page</code><br>则有：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表 <span class="keyword">LIMIT</span> （page<span class="number">-1</span>）* pageSize,pageSize</span><br></pre></td></tr></tbody></table></figure>

<p>解题方法<br>根据考题要搞清楚表的结果和多表之间的关系，根据想要的结果思考使用那种关联方式，通常把要查询的列先写出来，然后分析这些列都属于哪些表，才考虑使用关联查询</p>
<p>其中每一个操作都会产生一张虚拟的表，这个虚拟的表作为一个处理的输入，只是这些虚拟的表对用户来说是透明的，但是只有最后一个虚拟的表才会被作为结果返回。如果没有在语句中指定某一个子句，那么将会跳过相应的步骤</p>
<p>因为ON是先把不符合条件的记录过滤后才进行统计，它就可以减少中间运算要处理的数据，按理说应该速度是最快的，WHERE也应该比HAVING快点的，因为它过滤数据后才进行SUM，在两个表联接时才用ON的，所以在一个表的时候，就剩下WHERE跟HAVING比较了。</p>
<p>表连接，同时查询多张表格，效率高于子查询<br>数据库在通过连接两张或多张表来返回记录时，都会生成一张中间的临时表，然后再将这张临时表返回给用户。</p>
<p>from子句中on条件主要用来连接表，其他不属于连接表的条件可以使用where子句来指定；<br>考虑联接优先顺序：<br>join连接分为三种  外连接的outer 和内连接的inner 都可以省略：</p>
<ol>
<li>内连接 inner join ，默认，所以可以省略inner关键字，又叫等值连接，只返回两个表中不一定必须有同名字段，只要连接字段相等的行、公共数据、符合连接条件。查询条件放在&nbsp;on子句和where子句的返回的结果集是相同的。<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A,B <span class="keyword">WHERE</span> A.id=B.id</span><br></pre></td></tr></tbody></table></figure>
或者<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> a <span class="keyword">inner</span> <span class="keyword">Join</span> b <span class="keyword">on</span> A.id=B.id</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> a <span class="keyword">Join</span> b <span class="keyword">on</span> A.id=B.id <span class="keyword">JOIN</span> c <span class="keyword">on</span> B.id=c.id;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>自连接（自身连接）的本质是把一张表复制出多张一模一样的表来使用。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 列名 </span><br><span class="line"><span class="keyword">from</span> 表名 <span class="keyword">as</span> 别名<span class="number">1</span>,表名 <span class="keyword">as</span> 别名<span class="number">2</span>;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A T1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> A T2 <span class="keyword">ON</span> T1.id=T2.pid</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li><p>外连接 outer join 是指的要保存未匹配信息 包括<br>left join,在mysql是left outer join的简写 ，左外连接，左联结</p>
<p>在使用&nbsp;left jion&nbsp;时，on&nbsp;和&nbsp;where&nbsp;条件的区别如下：<br>• on&nbsp;条件是在生成临时表时使用的补充条件，以左表为主,先查询出左表,不管&nbsp;on&nbsp;上的条件是否为真，都会返回左表的全部数据都会在结果集中，左表有而右表中不匹配的行，右表选择字段列置为null<br>• where&nbsp;条件是在临时表生成好后，再对临时表进行过滤的条件。这时已经没有&nbsp;left join&nbsp;的含义（必须返回左边表的记录）了，条件不为真的就过滤掉，条件真假直接影响结果实际的执行效果相当于inner join .</p>
</li>
</ol>
<p>right join right outer join ，右外连接，结果表中除了匹配行外，还包括右表有而左表中不匹配的行，对于这样的行，左表选择列置为null </p>
<ol start="3">
<li>full join 是full outer join的简写，全连接，<br>mysql不支持full outer join，Mysql可以用left join+union+right join来解决<br>将多个查询语句的结果进行合并</li>
</ol>
<p>联合查询</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FROM</span> A <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="keyword">FROM</span> B <span class="keyword">UNION</span></span><br></pre></td></tr></tbody></table></figure>
<p>就是把多个结果集集中在一起, UNION前的结果为基准,需要注意的是联合查询的列数要相等,相同的记录行会合并,字段个数相同，结果集字段名称相同</p>
<p>SELECT FRoM A left Join b on A id=B id UNIOn<br>SELECT FRoM A RIGHT Join BoN A. id=Bid</p>
<p>查询语句 union （查询语句）union （查询语句）<br>如果使用 UNION ALL,不会合并重复的记录行,会显示重复的数据<br>优化UNION查询 UNION ALL的效率高于UNION</p>
<p>natural join，自然连接，分为natural left outer join和natural right outer join，语义定义与inner join相同 </p>
<p>3：cross join，交叉连接，没有任何关联条件,将两个表进行笛卡尔积运算，结果表的行数等于两表行数之积，就是第一个表的行数乘以第二个表的行数。结果集会很大,没有意义,很少使用</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A B(,C)</span><br></pre></td></tr></tbody></table></figure>
<p>或者</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> A <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> B (<span class="keyword">CROSS</span> <span class="keyword">JOIN</span> C)</span><br></pre></td></tr></tbody></table></figure>

<p>在IN后面值的列表中，将出现最频繁的值放在最前面，出现得最少的放在最后面，减少判断的次数。</p>
<p>子查询是一种查询中嵌套在 where子句 from子句 select子句查询的语句，<br>效率不好把握<br>不能写在order子句</p>
<p>当一个SQL语句的结果是作为另外一条SQL语句的条件时则需要用到子查询。</p>
<p>from子查询不是相关子查询，把结果集作为一张表，与其他的数据表做表连接</p>
<p>嵌套子查询：执行不依赖与外部的查询。<br>优化子查询：用关联查询替代<br>执行过程：先执行子查询再执行主查询<br>（1）执行子查询总共执行一次，执行完毕后结果不被显示，而是=将值传递给外部查询，作为外部查询的条件使用。<br>（2）执行外部查询，并显示整个结果。　　<br>嵌套子查询一般可以分为：</p>
<ol>
<li>返回单值的子查询 单行子查询：返回一条记录<br>查询底薪超过公司平均底薪的员工的信息<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WHERE 价格 &gt;</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">AVG</span>(价格)</span><br><span class="line">    <span class="keyword">FROM</span> Books</span><br><span class="line">  )</span><br></pre></td></tr></tbody></table></figure></li>
<li>返回一个列表的子查询 ，多行子查询：返回多条记录，只能出现在where from子句<br>select子句中其他字段的一条记录没办法和子查询的多条记录合并</li>
</ol>
<p>相关子查询，先执行主查询再执行子查询。<br>外部查询执行一行，子查询就执行一次。执行依赖于外部查询。<br>优化关联查询<br>确定ON或者USING子句中是否有索引。<br>确保GROUP BY和ORDER BY只有一个表中的列，这样MySQL才有可能使用索引。<br>一般是子查询的WHERE子句中引用了外部查询的表。<br>可以用IN、NOT IN、EXISTS、NOT EXISTS引入<br>执行过程：<br>（1）从外层查询中取出一个元组（即一行），将元组相关列的值传给内层查询。<br>什么是元组？关系是一张表，表中的每行bai（即数据库中的每条记录）就是一个元组。<br>（2）执行内层查询，得到子查询操作的值。<br>（3）外查询根据子查询返回的结果或结果集得到满足条件的行。<br>（4）然后外层查询取出下一个元组重复做步骤1-3，直到外层的元组全部处理完毕。<br>对于外部查询返回的每一行数据，内部查询都要执行一次。另外，在关联子查询中是信息流是双向的。外部查询的每行数据传递一个值给子查询，然后子查询为每一行数据执行一次并返回它的记录。然后，外部查询根据返回的记录做出决策。</p>
<p>“选取出各商品种类中高于该商品种类的平均销售单价的商品。” 的关联子查询SELECT语句：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type , product_name, sale_price</span><br><span class="line"><span class="keyword">FROM</span> Product <span class="keyword">AS</span> P1</span><br><span class="line"><span class="keyword">WHERE</span> sale_price &gt; (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">    <span class="keyword">FROM</span> Product <span class="keyword">AS</span> P2</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type</span><br><span class="line">    );</span><br></pre></td></tr></tbody></table></figure>
<p>这个语句是错误的，原因是sale_price是一行数据，子查询的结果是3行数据，无法进行比较。更无法得到我们想要的“选取出各商品种类中高于该商品种类的平均销售单价的商品。”这个结果。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type , product_name, sale_price</span><br><span class="line"><span class="keyword">FROM</span> Product <span class="keyword">AS</span> P1</span><br><span class="line"><span class="keyword">WHERE</span> sale_price &gt; (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">    <span class="keyword">FROM</span> Product <span class="keyword">AS</span> P2</span><br><span class="line">    <span class="keyword">WHERE</span> P1.product_type = P2.product_type</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type</span><br><span class="line">    );</span><br></pre></td></tr></tbody></table></figure>
<p>实际上，‘WHERE P1.product_type = P2.product_type’这个语句是关联子查询，<br>关联子查询的执行逻辑和正常的SELECT语句执行逻辑完全不同<br>下面，我们来说明一下上面的关联子查询代码的执行过程：</p>
<p>先执行主查询， select 语句的 from，，把  Product 表里面每行数据查询出来，查询每一行数据，都要执行一次内层 select 语句，这个时候是完整的执行内层 select 语句，就是内层里面的 from … where … group by … select avg(sale_price)，作用是把和外层查询出来的一行数据里面的 type 相同的所有行取出来，算sale_price列的平均值，然后继续执行外层的 where 条件，最后选出需要的列数据</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type , product_name, sale_price</span><br><span class="line"><span class="keyword">FROM</span> Product <span class="keyword">AS</span> P1</span><br></pre></td></tr></tbody></table></figure>

<p>该子查询从主查询一个“product_type”的值。而这个值是个变量，随SQLSever检索Product表中的不同行而改变<br>先将Product表中的第一条记录的“product_type”取第一个值=‘衣服’，通过WHERE P1.product_type = P2.product_type传入子查询，子查询变为：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">AVG</span>(sale_price)</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">    Product <span class="keyword">AS</span> P2</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">    P2.product_type = ‘衣服’</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">    product_type);</span><br></pre></td></tr></tbody></table></figure>
<p>子查询得到的结果为该类product_type的平均价格，AVG(sale_price)=2500，<br>返回主查询：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type , product_name, sale_price</span><br><span class="line"><span class="keyword">FROM</span> Product <span class="keyword">AS</span> P1</span><br><span class="line"><span class="keyword">WHERE</span> sale_price &gt; <span class="number">2500</span> <span class="keyword">AND</span> product_type = ‘衣服’</span><br></pre></td></tr></tbody></table></figure>
<p>如果WHERE条件为True，则第一条结果包括在结果集中，则否不包括。</p>
<p>然后，product _type取第二个值，得到整个语句的第二结果，依次类推，把product _type全取值一遍，所有行运行相同的过程，最后形成整个语句的的结果集及最后返回结果。</p>
<p>事实上，所有关联子查询的执行过程都和上面的过程一样。<br>（1）先从主查询的Product表中product _type列取出第一个值，进入子查询中，得到子查询结果，然后返回父查询，判断父查询的where子句条件，则返回整个语句的第1条结果。<br>（2）重复上述操作，直到所有主查询中的Product表中product _type列记录取完为止。得出整个语句的结果集，就是最后的答案。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table counttest(name char(1), age char(2));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; insert into counttest values</span><br><span class="line">    -&gt; ('a', '14'),('a', '15'), ('a', '15'), </span><br><span class="line">    -&gt; ('b', NULL), ('b', '16'), </span><br><span class="line">    -&gt; ('c', '17'),</span><br><span class="line">    -&gt; ('d', null), </span><br><span class="line">    -&gt;('e', '');</span><br><span class="line">Query OK, 8 rows affected (0.01 sec)</span><br><span class="line">Records: 8  Duplicates: 0  Warnings: 0</span><br><span class="line"> </span><br><span class="line">mysql&gt; select * from counttest;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| name | age  |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | 14   |</span><br><span class="line">| a    | 15   |</span><br><span class="line">| a    | 15   |</span><br><span class="line">| b    | NULL |</span><br><span class="line">| b    | 16   |</span><br><span class="line">| c    | 17   |</span><br><span class="line">| d    | NULL |</span><br><span class="line">| e    |      |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">8 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">count</span>(<span class="keyword">name</span>), <span class="keyword">count</span>(<span class="number">1</span>), <span class="keyword">count</span>(*), <span class="keyword">count</span>(age), <span class="keyword">count</span>(<span class="keyword">distinct</span>(age))</span><br><span class="line">    -&gt; <span class="keyword">from</span> counttest</span><br><span class="line">    -&gt; <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br><span class="line">+<span class="comment">------+-------------+----------+----------+------------+----------------------+</span></span><br><span class="line">| name | count(name) | count(1) | count(*) | count(age) | count(distinct(age)) |</span><br><span class="line">+<span class="comment">------+-------------+----------+----------+------------+----------------------+</span></span><br><span class="line">| a    |           3 |        3 |        3 |          3 |                    2 |</span><br><span class="line">| b    |           2 |        2 |        2 |          1 |                    1 |</span><br><span class="line">| c    |           1 |        1 |        1 |          1 |                    1 |</span><br><span class="line">| d    |           1 |        1 |        1 |          0 |                    0 |</span><br><span class="line">| e    |           1 |        1 |        1 |          1 |                    1 |</span><br><span class="line">+<span class="comment">------+-------------+----------+----------+------------+----------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>

<p>经典topN问题：每组最大的N条记录。<br>涉及到“既要分组，又要排序”的情况，要能想到用窗口函数来实现。</p>
<p>窗口函数，OLAP函数（Online Anallytical Processing，联机分析处理）<br>1）同时具有分组（partition by）和排序（order by）的功能<br>2）不减少原表的行数，所以经常用来在每组内排名<br>group by分组汇总后改变了表的行数，一行只有一个类别。<br>当一条sql语句没有group by的话，整张表的数据会自成一组。</p>
<p>比如下面的业务需求：<br>每组内排名问题：每个部门按业绩来排名<br>topN问题：找出每个部门排名前N的员工进行奖励：</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;窗口函数&gt; over (partition by &lt;用于分组的列名&gt;</span><br><span class="line">                order by &lt;用于排序的列名&gt;)</span><br></pre></td></tr></tbody></table></figure>
<p>partition子句可是省略，省略就是不指定分组排名<br>&lt;窗口函数&gt;的位置，可以放以下两种函数：<br>1） 专用窗口函数，包括后面要讲到的rank, dense_rank, row_number等专用窗口函数。<br>2） 聚合函数，如sum. avg, count, max, min等</p>
<p>因为窗口函数是对where或者group by子句处理后的结果进行操作，所以窗口函数原则上只能写在select子句中。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *,</span><br><span class="line">   <span class="keyword">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 成绩 <span class="keyword">desc</span>) <span class="keyword">as</span> ranking,</span><br><span class="line">   <span class="keyword">dense_rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 成绩 <span class="keyword">desc</span>) <span class="keyword">as</span> dese_rank,</span><br><span class="line">   row_number() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 成绩 <span class="keyword">desc</span>) <span class="keyword">as</span> row_num</span><br><span class="line"><span class="keyword">from</span> 班级</span><br></pre></td></tr></tbody></table></figure>
<p>专用窗口函数后面的括号不需要任何参数，保持()空着就可以。<br>1）rank函数：如果有并列名次的行，会占用下一名次的位置，同薪同名重复但总排名不连续。比如正常排名是1，2，3，4，但是现在前3名是并列的名次，结果是：1，1，1，4。 </p>
<p>2）dense_rank函数：如果有并列名次的行，不占用下一名次的位置，同薪同名但总排名连续。比如正常排名是1，2，3，4，但是现在前3名是并列的名次，结果是：1，1，1，2。 </p>
<p>3）row_number函数：不考虑并列名次的情况，连续排名不重复，。比如前3名是并列的名次，排名是正常的1，2，3，4。每一条数据加一个序号，用于分页查询<br> 例如薪水3000、2000、2000、1000排名结果为1-2-3-4，体现同薪不同名，排名类似于编号</p>
<p>聚和窗口函数和上面提到的专用窗口函数用法完全相同，只需要把聚合函数写在窗口函数的位置即可，但是函数后面括号里面不能为空，需要指定聚合的列名。聚合函数作为窗口函数，可以在每一行的数据里直观的看到，截止到本行数据，统计数据是多少（最大值、最小值等）。同时可以看出每一行数据，对整体统计数据的影响。想要知道所有人成绩的总和、平均等聚合结果，看最后一行即可。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *,</span><br><span class="line">   <span class="keyword">sum</span>(成绩) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 学号) <span class="keyword">as</span> current_sum,</span><br><span class="line">   <span class="keyword">avg</span>(成绩) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 学号) <span class="keyword">as</span> current_avg,</span><br><span class="line">   <span class="keyword">count</span>(成绩) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 学号) <span class="keyword">as</span> current_count,</span><br><span class="line">   <span class="keyword">max</span>(成绩) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 学号) <span class="keyword">as</span> current_max,</span><br><span class="line">   <span class="keyword">min</span>(成绩) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> 学号) <span class="keyword">as</span> current_min</span><br><span class="line"><span class="keyword">from</span> 班级表</span><br></pre></td></tr></tbody></table></figure>

<p>查询结果排序，默认升序<br>select 字段1，字段2 from 表名 order by 列名 ASC或者DESC;</p>
<p>查询结果分页<br><code>limit y offset x</code>简写成<code>limit x, y</code><br>参数x为可选参数，表示查询结果跳过前 x 条数据，x 默认为 0，从第 x+1 条数据开始取，<br>参数y为必选参数，表示取前 y 条(行)数据</p>
<p>eg1：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">LIMIT</span> <span class="number">5</span>;     //检索前 5 个记录行</span><br></pre></td></tr></tbody></table></figure>
<p>等价于</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">5</span>;     //检索前 5 个记录行,0可以省略不写</span><br></pre></td></tr></tbody></table></figure>
<p>eg2：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">LIMIT</span> <span class="number">5</span>,<span class="number">10</span>;  // 检索记录行 6-15</span><br></pre></td></tr></tbody></table></figure>
<p>eg3：<br>为了检索某行开始到最后的所有数据，可以设置第二个参数为-1</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">LIMIT</span> <span class="number">95</span>,<span class="number">-1</span>; // 检索记录行 96-last</span><br></pre></td></tr></tbody></table></figure>

<h3 id="175-组合两个表"><a href="#175-组合两个表" class="headerlink" title="175. 组合两个表"></a>175. 组合两个表</h3><p><strong>编写一个 SQL 查询，获取 Employee&nbsp;表中第二高的薪水（Salary）。</strong><br>表1: Person</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+-------------+</span>---------+</span><br><span class="line">| 列名         | 类型     |</span><br><span class="line"><span class="code">+-------------+</span>---------+</span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| FirstName   | varchar |</span><br><span class="line">| LastName    | varchar |</span><br><span class="line"><span class="code">+-------------+</span>---------+</span><br><span class="line">PersonId 是上表主键</span><br></pre></td></tr></tbody></table></figure>
<p>表2: Address</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+-------------+</span>---------+</span><br><span class="line">| 列名         | 类型    |</span><br><span class="line"><span class="code">+-------------+</span>---------+</span><br><span class="line">| AddressId   | int     |</span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| City        | varchar |</span><br><span class="line">| State       | varchar |</span><br><span class="line"><span class="code">+-------------+</span>---------+</span><br><span class="line">AddressId 是上表主键</span><br></pre></td></tr></tbody></table></figure>
<p>编写一个 SQL 查询，满足条件：无论 person 是否有地址信息，都需要基于上述两表提供&nbsp;person 的以下信息：</p>
<figure class="highlight autohotkey"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">FirstName,</span> LastName, City, State</span><br></pre></td></tr></tbody></table></figure>

<p>使用 outer join<br>算法</p>
<p>因为表 Address 中的 personId 是表 Person 的外关键字，所以我们可以连接这两个表来获取一个人的地址信息。</p>
<p>考虑到可能不是每个人都有地址信息，我们应该使用 outer join 而不是默认的 inner join。所以是左连接保留所有的人名。right连接的话是会保留右表所有的地址信息<br>注意：如果没有某个人的地址信息，使用 where 子句过滤记录将失败，因为它不会显示姓名信息。</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> FirstName, LastName, City, State</span><br><span class="line"><span class="keyword">from</span> Person <span class="keyword">left</span> <span class="keyword">join</span> Address</span><br><span class="line"><span class="keyword">on</span> Person.PersonId = Address.PersonId;</span><br><span class="line">```~</span><br><span class="line"></span><br><span class="line">```~sql</span><br><span class="line"><span class="keyword">select</span> P.FirstName, P.LastName, A.City, A.State</span><br><span class="line"><span class="keyword">from</span> Person <span class="keyword">as</span> P <span class="keyword">left</span> <span class="keyword">join</span> Address <span class="keyword">as</span> A </span><br><span class="line"><span class="keyword">on</span> (P.PersonId = A.PersonId);</span><br><span class="line">```~</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 176. 第二高的薪水</span></span><br><span class="line">**编写一个 SQL 查询，获取 Employee&nbsp;表中第二高的薪水（Salary）。**</span><br></pre></td></tr></tbody></table></figure>
<p>+—-+——–+<br>| Id | Salary |<br>+—-+——–+<br>| 1  | 100    |<br>| 2  | 200    |<br>| 3  | 300    |<br>+—-+——–+</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">例如上述</span>&nbsp;<span class="string">Employee</span>&nbsp;<span class="string">表，SQL查询应该返回</span>&nbsp;<span class="number">200</span> <span class="string">作为第二高的薪水。如果不存在第二高的薪水，那么查询应返回</span> <span class="literal">null</span><span class="string">。</span></span><br></pre></td></tr></tbody></table></figure>
<p>+———————+<br>| SecondHighestSalary |<br>+———————+<br>| 200                 |<br>+———————+</p>
<figure class="highlight pgsql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">方法一：使用子查询和 <span class="keyword">LIMIT</span> 子句  </span><br><span class="line">降序排列再返回第二条记录可以得到第二大的值。</span><br><span class="line">```<span class="keyword">distinct</span>```排除掉多行数据并列第二的情况，例如只有两行记录都是 <span class="number">100</span>，<span class="number">100</span>，此时结果应当是<span class="keyword">null</span>，如果不用<span class="keyword">distinct</span>，得到结果就是<span class="number">100</span>  </span><br><span class="line"></span><br><span class="line">关键是这个不存在返回<span class="keyword">null</span>，不存在又分为表数据不够，比如表只有一行。或者另一种情况，薪水全部一样，则也不存在第二高的薪水，因此这题除了按薪水降序排序外，还需要筛掉薪水相同的记录。可以像下面这样写使用<span class="keyword">group</span> <span class="keyword">by</span>或者用<span class="keyword">distinct</span> + <span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line"></span><br><span class="line">```<span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">DISTINCT</span> Salary <span class="keyword">AS</span> SecondHighestSalary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    Salary <span class="keyword">AS</span> SecondHighestSalary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>然而，如果没有这样的第二最高工资，不存在第二高记录的话会返回为空的结果集。而不是null，这个解决方案将被判断为 “错误答案”，因为本表可能只有一项记录。为了克服这个问题，我们可以将其作为临时表。 执行返回结果集不为空包含一行为NULL的记录，</p>
<figure class="highlight plain"><figcaption><span>NULL```返回null值，可以不接from单独用，子查询数据出虚表嵌套查询虚表,如果查询不到会返回null。相当于查询的列。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在oracle中只写查询列没有查询表需要加上 from dual（伪表）。</span><br><span class="line">而mysql不用写</span><br><span class="line">```SQL</span><br><span class="line">SELECT</span><br><span class="line">    (SELECT DISTINCT</span><br><span class="line">            Salary</span><br><span class="line">        FROM</span><br><span class="line">            Employee</span><br><span class="line">        ORDER BY Salary DESC</span><br><span class="line">        LIMIT 1 OFFSET 1) AS SecondHighestSalary</span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        Salary</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        Employee</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> Salary </span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line">    <span class="keyword">LIMIT</span> <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span></span><br><span class="line">) <span class="keyword">AS</span> SecondHighestSalary</span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> (</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        Salary </span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">        Employee</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span></span><br><span class="line">    <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span></span><br><span class="line">) <span class="keyword">as</span> SecondHighestSalary</span><br></pre></td></tr></tbody></table></figure>

<p>方法二：<br>求最大值。一定要借助于MAX函数<br>先去掉最大的，然后第二大的就是最大的了,<br>考虑了扩展性，求第三，求第四呢?一直套</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(Salary) SecondHighestSalary </span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">where</span> Salary &lt; (<span class="keyword">select</span> <span class="keyword">max</span>(Salary) <span class="keyword">from</span> Employee);</span><br></pre></td></tr></tbody></table></figure>

<p>方法三：使用 IFNULL 和 LIMIT 子句</p>
<p>mysql中isnull,ifnull,nullif的用法如下：</p>
<p>isnull(expr) 的用法： 如expr 为null，那么isnull() 的返回值为 1，否则返回值为 0。<br>mysql&gt; select isnull(1+1);<br>-&gt; 0<br>mysql&gt; select isnull(1/0);<br>-&gt; 1 使用= 的null 值对比通常是错误的。</p>
<p>isnull() 函数同 is null比较操作符具有一些相同的特性。请参见有关is null 的说明。</p>
<p>IFNULL(expr1,expr2)的用法：条件函数 写在查询条件里面里面<br>判断是否为null的，不是判断是否为空。如下所示。<br>假如expr1 不为 NULL，则 IFNULL() 的返回值为 expr1;<br>假如expr1 为 NULL，其返回值为 expr2。<br>IFNULL()的返回值是数字或是字符串，具体情况取决于其所使用的语境。<br>ifnull(x, null) 如果返回null值，不就已经说明 x 的值为null</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT IFNULL(1,0);</span><br><span class="line">-&gt; 1</span><br><span class="line">mysql&gt; SELECT IFNULL(NULL,10);</span><br><span class="line">-&gt; 10</span><br><span class="line">mysql&gt; SELECT IFNULL(1/0,10);</span><br><span class="line">-&gt; 10</span><br><span class="line">mysql&gt; SELECT</span><br><span class="line">IFNULL(1/0,'yes');</span><br><span class="line">-&gt;   'yes</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">IFNULL</span>(</span><br><span class="line">      (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Salary</span><br><span class="line">       <span class="keyword">FROM</span> Employee</span><br><span class="line">       <span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line">        <span class="keyword">LIMIT</span> <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span>),</span><br><span class="line">    <span class="literal">NULL</span>) <span class="keyword">AS</span> SecondHighestSalary</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="177-第N高的薪水"><a href="#177-第N高的薪水" class="headerlink" title="177. 第N高的薪水"></a>177. 第N高的薪水</h3><p><strong>编写一个 SQL 查询，获取 Employee 表中第 n 高的薪水（Salary）。</strong></p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line"><span class="code">+----+</span>--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line"><span class="code">+----+</span>--------+</span><br></pre></td></tr></tbody></table></figure>
<p>例如上述 Employee 表，n = 2 时，应返回第二高的薪水 200。如果不存在第 n 高的薪水，那么查询应返回 null。</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+------------------------+</span></span><br><span class="line">| getNthHighestSalary(2) |</span><br><span class="line"><span class="code">+------------------------+</span></span><br><span class="line">| 200                    |</span><br><span class="line"><span class="code">+------------------------+</span></span><br></pre></td></tr></tbody></table></figure>

<p>思路1：单表查询<br>本题不存在分组排序，只需返回全局第N高的一个，所以自然想到的想法是用order by排序加limit限制得到。需要注意两个细节：</p>
<ol>
<li>同薪同名且不跳级的问题，解决办法是用group by按薪水分组后再order by</li>
<li>排名第N高意味着要跳过N-1个薪水，由于无法直接用limit N-1，所以需先在函数开头用set把N赋值为N=N-1。调整下limit的起始点即可，<br>注：这里不能直接用limit N-1,1，这样写要报语法错误，是因为limit和offset字段后面只接受正整数（意味着负数、小数都不行, limit的偏移从0开始。0是可以 但是没有啥意义）或者单一变量（意味着不能用表达式），也就是说想取一条，limit 2-1、limit 1.1这类的写法都是报错的。<br>注：这种解法形式最为简洁直观，但仅适用于查询全局排名问题，如果要求各分组的每个第N名，则该方法不适用；而且也不能处理存在重复值的情况。</li>
</ol>
<p>第N个变成参数变量时，要改为N-1。不是数字。作者认为出题的目的是不使用变量的情况下解题</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> getNthHighestSalary(N <span class="built_in">int</span>) <span class="keyword">returns</span> <span class="built_in">int</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">set</span> n=N<span class="number">-1</span>;  // sql 不区分到小写，所以只有一个N</span><br><span class="line">    return (</span><br><span class="line">        <span class="keyword">select</span>(</span><br><span class="line">            <span class="keyword">select</span> </span><br><span class="line">                <span class="keyword">distinct</span> Salary</span><br><span class="line">            <span class="keyword">from</span> </span><br><span class="line">                Employee</span><br><span class="line">            <span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">                Salary <span class="keyword">desc</span></span><br><span class="line">            <span class="keyword">limit</span> n,<span class="number">1</span></span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">set</span> n = N<span class="number">-1</span>;</span><br><span class="line">  RETURN (</span><br><span class="line">      <span class="keyword">select</span> <span class="keyword">ifnull</span>(</span><br><span class="line">          (</span><br><span class="line">          <span class="keyword">select</span> </span><br><span class="line">              <span class="keyword">distinct</span> Salary </span><br><span class="line">          <span class="keyword">from</span> </span><br><span class="line">              Employee</span><br><span class="line">          <span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">              Salary <span class="keyword">desc</span></span><br><span class="line">          <span class="keyword">limit</span> n, <span class="number">1</span></span><br><span class="line">          )</span><br><span class="line">          , <span class="literal">null</span>)</span><br><span class="line">  );</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></tbody></table></figure>

<p>窗口函数</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">RETURN</span> (</span><br><span class="line">      <span class="comment"># Write your MySQL query statement below.</span></span><br><span class="line">      <span class="keyword">select</span> <span class="keyword">distinct</span> Salary </span><br><span class="line">      <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>) <span class="keyword">num</span>,Salary <span class="keyword">from</span> Employee</span><br><span class="line">      ) t </span><br><span class="line">      <span class="keyword">where</span> t.num=N</span><br><span class="line">  );</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></tbody></table></figure>

<p>法2：子查询<br>排名第N的薪水意味着该表中存在N-1个比其更高的薪水<br>注意这里的N-1个更高的薪水是指去重后的N-1个，实际对应人数可能不止N-1个<br>最后返回的薪水也应该去重，因为可能不止一个薪水排名第N<br>由于对于每个薪水的where条件都要执行一遍子查询，注定其效率低下</p>
<p>对每一个薪水A，只要大于等于A的不同薪水个数等于N即可。<br>子查询查找比当前薪资大与等于的个数，个数即排名。<br>也就是在做查找当前记录的排名，对salary进行了排名，salary相同的排同一个名次</p>
<p>假设现在给你一个分数X，如何算出它的排名Rank呢？<br>我们可以先提取出大于等于X的所有分数集合H，将H去重后的元素个数就是X的排名。<br>比如你考了99分，但最高的就只有99分，那么去重之后集合H里就只有99一个元素，个数为1，因此你的Rank为1。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">RETURN</span> (</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        <span class="keyword">distinct</span> t1.Salary</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">        Employee t1</span><br><span class="line">    <span class="keyword">where</span> N = (</span><br><span class="line">        <span class="keyword">select</span> </span><br><span class="line">            <span class="keyword">count</span>(<span class="keyword">distinct</span> t2.Salary)</span><br><span class="line">        <span class="keyword">from</span> </span><br><span class="line">            Employee t2</span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            t2.Salary &gt;= t1.Salary</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></tbody></table></figure>
<p>只用一个sql，那么要先查出前N薪水，然后取最小就好了，注意可能总数不够前N，count一下比较即可<br>取的distinct后的前N条吧，去重以后就是N条，但是如果有重复的就会导至原本可能有N条，去重以后就小于 N条，所以最后的选择步骤会加上一个IF条件判断是否有到达第N个，达不到返回NULL。比如原本100个数，其中有60个是相同的，其余40个是不同的；要取第50大的，就会返回NULL，因为不重复的数只有41个，只对这41个数排序取值。</p>
<figure class="highlight plain"><figcaption><span>里面的 列变量。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">```SQL</span><br><span class="line">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">  RETURN (     </span><br><span class="line">  SELECT  IF(count&lt;N,NULL,min) // N &gt; count 那么取 NULL 否者 取 min 的值</span><br><span class="line">  FROM</span><br><span class="line">    (SELECT MIN(Salary) AS min, COUNT(1) AS count</span><br><span class="line">    FROM</span><br><span class="line">      (SELECT DISTINCT Salary</span><br><span class="line">      FROM Employee ORDER BY Salary DESC LIMIT N) AS a</span><br><span class="line">    ) as b</span><br><span class="line">  );</span><br><span class="line">END</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> </span><br><span class="line"><span class="keyword">when</span> <span class="keyword">count</span>(*) &lt; N </span><br><span class="line"><span class="keyword">then</span> <span class="literal">NULL</span> </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">min</span>(Salary) </span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">distinct</span> Salary </span><br><span class="line">    <span class="keyword">from</span> Employee </span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span> </span><br><span class="line">    <span class="keyword">limit</span> N) </span><br><span class="line">    temp</span><br></pre></td></tr></tbody></table></figure>
<p>mysql中自定义变量需要用@作为前缀符引导符，针对于当前会话（连接）有效，同于会话变量的作用域应用在任何地方<br>定义@r表示排名信息(rank)，<br>定义@p表示前一个薪水(previous) </p>
<p>对用户变量赋值有两种方式，一种是直接用”=”号，另一种是用”:=”号。<br>其区别在于使用set命令对用户变量进行赋值时，两种方式都可以使用；<br>当使用select语句对用户变量进行赋值时，只能使用”:=”方式，因为在select语句中，”=”号被看作是比较操作符。<br>“:=”用来给变量rank赋值</p>
<hr>
<h3 id="178-分数排名"><a href="#178-分数排名" class="headerlink" title="178. 分数排名"></a>178. 分数排名</h3><p><strong>编写一个 SQL 查询来实现分数排名。</strong></p>
<p>如果两个分数相同，则两个分数排名（Rank）相同。<br>请注意，平分后的下一个名次应该是下一个连续的整数值。<br>换句话说，名次之间不应该有“间隔”。</p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+</span><br><span class="line">|<span class="string"> Id </span>|<span class="string"> Score </span>|</span><br><span class="line">+----+-------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> 3.50  </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> 3.65  </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> 4.00  </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> 3.85  </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> 4.00  </span>|</span><br><span class="line">|<span class="string"> 6  </span>|<span class="string"> 3.65  </span>|</span><br><span class="line">+----+-------+</span><br></pre></td></tr></tbody></table></figure>

<p>例如，根据上述给定的 Scores 表，你的查询应该返回（按分数从高到低排列）：</p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------+------+</span><br><span class="line">|<span class="string"> Score </span>|<span class="string"> Rank </span>|</span><br><span class="line">+-------+------+</span><br><span class="line">|<span class="string"> 4.00  </span>|<span class="string"> 1    </span>|</span><br><span class="line">|<span class="string"> 4.00  </span>|<span class="string"> 1    </span>|</span><br><span class="line">|<span class="string"> 3.85  </span>|<span class="string"> 2    </span>|</span><br><span class="line">|<span class="string"> 3.65  </span>|<span class="string"> 3    </span>|</span><br><span class="line">|<span class="string"> 3.65  </span>|<span class="string"> 3    </span>|</span><br><span class="line">|<span class="string"> 3.50  </span>|<span class="string"> 4    </span>|</span><br><span class="line">+-------+------+</span><br></pre></td></tr></tbody></table></figure>
<p>重要提示：对于 MySQL 解决方案，如果要转义用作列名的保留字，可以在关键字之前和之后使用撇号。例如 <code>Rank</code> rank是mysql的关键字不能使用</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> score, </span><br><span class="line">       <span class="keyword">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Score <span class="keyword">desc</span>) <span class="keyword">as</span> <span class="string">`Rank`</span></span><br><span class="line"><span class="keyword">from</span> Scores;</span><br></pre></td></tr></tbody></table></figure>

<p>法二：<br>最后的结果包含两个部分，<br>第一部分是降序排列的分数</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.Score <span class="keyword">as</span> Score</span><br><span class="line"><span class="keyword">from</span> Scores a</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> a.Score <span class="keyword">DESC</span></span><br></pre></td></tr></tbody></table></figure>

<p>第二部分是每个分数对应的排名<br>假设现在给你一个分数X，如何算出它的排名Rank呢？<br>我们可以先提取出大于等于X的所有分数集合H，将H去重后的元素个数就是X的排名。<br>比如你考了99分，但最高的就只有99分，那么去重之后集合H里就只有99一个元素，个数为1，因此你的Rank为1。<br>先提取集合H：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    b.Score </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    Scores b </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    b.Score &gt;= X;</span><br></pre></td></tr></tbody></table></figure>
<p>我们要的是集合H去重之后的元素个数就是X的排名，因此升级为：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    <span class="keyword">count</span>(<span class="keyword">distinct</span> b.Score) </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    Scores b </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    b.Score &gt;= X <span class="keyword">as</span> <span class="keyword">Rank</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>而从结果的角度来看，第二部分的Rank是对应第一部分的分数来的，<br>所以这里的X就是上面的a.Score，把两部分结合在一起为：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    a.Score <span class="keyword">as</span> Score,</span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> </span><br><span class="line">            <span class="keyword">count</span>(<span class="keyword">distinct</span> b.Score) </span><br><span class="line">        <span class="keyword">from</span> </span><br><span class="line">            Scores b </span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            b.Score &gt;= a.Score</span><br><span class="line">        ) <span class="keyword">as</span> <span class="string">'Rank'</span></span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    Scores a</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">    a.Score <span class="keyword">DESC</span></span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="180-连续出现的数字"><a href="#180-连续出现的数字" class="headerlink" title="180. 连续出现的数字"></a>180. 连续出现的数字</h3><p><strong>编写一个 SQL 查询，查找所有至少连续出现三次的数字。</strong></p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----+-----+</span><br><span class="line">|<span class="string"> Id </span>|<span class="string"> Num </span>|</span><br><span class="line">+----+-----+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string">  2  </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 6  </span>|<span class="string">  2  </span>|</span><br><span class="line">|<span class="string"> 7  </span>|<span class="string">  2  </span>|</span><br><span class="line">+----+-----+</span><br></pre></td></tr></tbody></table></figure>
<p>例如，给定上面的 Logs 表， 1 是唯一连续出现至少三次的数字。</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+-----------------+</span></span><br><span class="line">| ConsecutiveNums |</span><br><span class="line"><span class="code">+-----------------+</span></span><br><span class="line">| 1               |</span><br><span class="line"><span class="code">+-----------------+</span></span><br></pre></td></tr></tbody></table></figure>

<p>思路：</p>
<ol>
<li><p>由于要获取至少连续三次出现的数字，看到这个题肯定是会变的，<br>如果是至少连续出现四次呢(100次呢)，咱们连接四个表(连接一千个?)？<br>这种方法肯定是不可取的。</p>
</li>
<li><p>找规律，找出这连续起来的数字有什么规律呢，我们会发现连续的数字是相同的数字，<br>但是id有可能不是连续的，工作的生产环境某一行记录经常会被删除,<br>所以id=1之后下一个id可能是3也可以是10000，我们就需要通过对结果集进行再次编号，让其变成连续的。</p>
</li>
<li><p>首先我们获取到对每条数据编号从1开始使用row_number()函数使用id来排序，<code>row_number() over(order by id)</code><br>4、然后我们通过另一种方式排序将，这些num值一样的进行排序，然后对其编号同样使用row_bumber()使用num来分组使用id排序 over(partition by num order by id)<br>5、通过3、4步骤我们能得到什么呢，两个相减之后我们可以得到，只要是相等的，则相减的值是一样的。而且如果不连续的话相减值也不一样。</p>
</li>
</ol>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">NUM</span> <span class="keyword">As</span> ConsecutiveNums </span><br><span class="line"><span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> <span class="keyword">Num</span>,<span class="keyword">count</span>(*) <span class="keyword">as</span> Num_count </span><br><span class="line">    <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> *, </span><br><span class="line">        row_number() <span class="keyword">over</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span>)</span><br><span class="line">        - row_number() <span class="keyword">over</span> (</span><br><span class="line">            <span class="keyword">PARTITION</span> <span class="keyword">by</span> <span class="keyword">Num</span> </span><br><span class="line">            <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span></span><br><span class="line">            )<span class="keyword">AS</span> orde </span><br><span class="line">        <span class="keyword">FROM</span> <span class="keyword">logs</span> </span><br><span class="line">    ) <span class="keyword">as</span> W <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">Num</span>,orde </span><br><span class="line">)<span class="keyword">as</span> S </span><br><span class="line"><span class="keyword">WHERE</span> Num_count&gt;=<span class="number">3</span>; </span><br></pre></td></tr></tbody></table></figure>

<p>对应id的减的是row_number（）函数的排序号<br>如果pre与t.num 相等，则cnt加1， 否则cnt重置为1</p>
<p>法二<br>定义为一张表：(select @pre:= null,@count:=1) as pc<br>Logs与pc叉积，计算出与每行数字连续相同的数字个数。</p>
<p>①首先遍历一遍整张表，找出每个数字的连续重复次数<br>定义两个用户变量并初始化<br>@pre：记录的是当前行的num值，在下一次循环里，pre和下一次循环if（）里的num值比较<br>pre初始值最好不要赋值为一个数字，因为不确定赋值的数字是否会出现在测试表中。</p>
<p>@count：记录上一个数字已经连续出现的次数。与前一行数据连续相同的个数，统计连续次数</p>
<p>然后调用if()函数，与前一行数据比较的逻辑为：<br>如果pre和当前行数字相同，count加1即为连续出现的次数；<br>如果不同，意味着重新开始一个数字，count重新从1开始。<br>最后，将当前的Num数字赋值给pre，开始下一行扫描。</p>
<p>这些结果形成一张新表：a(Num,count,USELESS)。<br>适用连续重复次数为n的情况，无论需要连续重复多少次，只需要改最后的数字就可以了，复用性很好。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">        <span class="keyword">Num</span>,    <span class="comment">#当前的Num 数字</span></span><br><span class="line">        <span class="keyword">if</span>(@pre=<span class="keyword">Num</span>,@<span class="keyword">count</span> := @<span class="keyword">count</span>+<span class="number">1</span>,@<span class="keyword">count</span> := <span class="number">1</span>) <span class="keyword">as</span> nums, <span class="comment">#判断 和 计数</span></span><br><span class="line">        @pre:=<span class="keyword">Num</span>   <span class="comment">#将当前Num赋值给pre</span></span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">Logs</span> <span class="keyword">as</span> l ,</span><br><span class="line">        (<span class="keyword">select</span> @pre:= <span class="literal">null</span>,@<span class="keyword">count</span>:=<span class="number">1</span>) <span class="keyword">as</span> pc <span class="comment">#这里需要别名</span></span><br><span class="line">    <span class="comment">#上面这段代码执行结果就是一张三列为Num,count as nums,pre的表。</span></span><br></pre></td></tr></tbody></table></figure>
<p>②将上面表的结果中，重复次数大于等于3的数字选出，<br>再去重即为连续至少出现三次的数字。最终只要从a中取出count大于等于3的行。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    <span class="keyword">distinct</span> <span class="keyword">Num</span> <span class="keyword">as</span> ConsecutiveNums </span><br><span class="line"><span class="keyword">from</span>  </span><br><span class="line">    (<span class="keyword">select</span> <span class="keyword">Num</span>,</span><br><span class="line">            <span class="keyword">if</span>(@pre=<span class="keyword">Num</span>,@<span class="keyword">count</span> := @<span class="keyword">count</span>+<span class="number">1</span>,@<span class="keyword">count</span> := <span class="number">1</span>) <span class="keyword">as</span> <span class="keyword">count</span>,</span><br><span class="line">            @pre:=<span class="keyword">Num</span></span><br><span class="line">        <span class="keyword">from</span> <span class="keyword">Logs</span> <span class="keyword">as</span> l ,</span><br><span class="line">            (<span class="keyword">select</span> @pre:= <span class="literal">null</span>,@<span class="keyword">count</span>:=<span class="number">1</span>) <span class="keyword">as</span> pc</span><br><span class="line">    ) <span class="keyword">as</span> n</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">count</span> &gt;=<span class="number">3</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>Every derived table must have its own alias，<br>进行嵌套查询的时候子查询出来的的结果是作为一个派生表来进行上一级的查询的，所以子查询的结果临时表必须要有一个别名，应该是一种规范吧！</p>
<hr>
<h3 id="181-超过经理收入的员工"><a href="#181-超过经理收入的员工" class="headerlink" title="181. 超过经理收入的员工"></a>181. 超过经理收入的员工</h3><p><strong>Employee 表包含所有员工，他们的经理也属于员工。每个员工都有一个 Id，此外还有一列对应员工的经理的 Id。</strong></p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+-----------+</span><br><span class="line">|<span class="string"> Id </span>|<span class="string"> Name  </span>|<span class="string"> Salary </span>|<span class="string"> ManagerId </span>|</span><br><span class="line">+----+-------+--------+-----------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> Joe   </span>|<span class="string"> 70000  </span>|<span class="string"> 3         </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> Henry </span>|<span class="string"> 80000  </span>|<span class="string"> 4         </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> Sam   </span>|<span class="string"> 60000  </span>|<span class="string"> NULL      </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> Max   </span>|<span class="string"> 90000  </span>|<span class="string"> NULL      </span>|</span><br><span class="line">+----+-------+--------+-----------+</span><br></pre></td></tr></tbody></table></figure>
<p>给定 Employee 表，编写一个 SQL 查询，该查询可以获取收入超过他们经理的员工的姓名。在上面的表格中，Joe 是唯一一个收入超过他的经理的员工。</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----------+</span></span><br><span class="line">| Employee |</span><br><span class="line"><span class="code">+----------+</span></span><br><span class="line">| Joe      |</span><br><span class="line"><span class="code">+----------+</span></span><br></pre></td></tr></tbody></table></figure>

<p>”和自己的xxx比”这种问题基本都是自连接问题。<br>方法 1：使用 WHERE 语句<br>算法</p>
<p>如下面表格所示，表格里存有每个雇员经理的信息，我们也许需要从这个表里获取两次信息。<br>从两个表里使用 Select 语句可能会导致产生 笛卡尔乘积 。<br>不指定两个表的连接方式、 没有关联条件，这种情况下就会产生笛卡尔积，这是笛卡尔积的定义<br>在这种情况下，输出会产生 4*4=16 个记录。<br>然而我们只对雇员工资高于经理的人感兴趣。<br>所以我们应该用 WHERE 语句加 2 个判断条件。<br>a表的经理Id=b表的员工Id，即b表中的人员都是a表的经理</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    a.Name <span class="keyword">AS</span> Employee</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee <span class="keyword">AS</span> a,</span><br><span class="line">    Employee <span class="keyword">AS</span> b</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    a.ManagerId = b.Id</span><br><span class="line">        <span class="keyword">AND</span> a.Salary &gt; b.Salary</span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<p>方法 2：使用 JOIN 语句<br>JOIN 是一个更常用也更有效的将表连起来的办法，我们使用 ON 来指明条件。<br>因为JOIN 运算优先级高于逗号<br>join相关联查语句，使用小表驱动大表，可以提高效率。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">     a.NAME <span class="keyword">AS</span> Employee</span><br><span class="line"><span class="keyword">FROM</span> Employee <span class="keyword">AS</span> a <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> b</span><br><span class="line">     <span class="keyword">ON</span> a.ManagerId = b.Id</span><br><span class="line">     <span class="keyword">AND</span> a.Salary &gt; b.Salary</span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">Name</span> Employee</span><br><span class="line"><span class="keyword">from</span> Employee E1</span><br><span class="line"><span class="keyword">where</span> Salary &gt; (<span class="keyword">select</span> Salary</span><br><span class="line">                <span class="keyword">from</span> Employee </span><br><span class="line">                <span class="keyword">where</span> <span class="keyword">Id</span> = E1.ManagerId);</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.Name <span class="keyword">as</span> Employee </span><br><span class="line"><span class="keyword">from</span> Employee a </span><br><span class="line"><span class="keyword">where</span> a.Salary &gt; (<span class="keyword">select</span> b.Salary </span><br><span class="line">                    <span class="keyword">from</span> Employee b </span><br><span class="line">                    <span class="keyword">where</span> b.Id = a.ManagerId)</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="182-查找重复的电子邮箱"><a href="#182-查找重复的电子邮箱" class="headerlink" title="182. 查找重复的电子邮箱"></a>182. 查找重复的电子邮箱</h3><p><strong>编写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。</strong><br>示例：</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>---------+</span><br><span class="line">| Id | Email   |</span><br><span class="line"><span class="code">+----+</span>---------+</span><br><span class="line">| 1  | a@b.com |</span><br><span class="line">| 2  | c@d.com |</span><br><span class="line">| 3  | a@b.com |</span><br><span class="line"><span class="code">+----+</span>---------+</span><br></pre></td></tr></tbody></table></figure>
<p>根据以上输入，你的查询应返回以下结果：</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+---------+</span></span><br><span class="line">| Email   |</span><br><span class="line"><span class="code">+---------+</span></span><br><span class="line">| a@b.com |</span><br><span class="line"><span class="code">+---------+</span></span><br></pre></td></tr></tbody></table></figure>
<p>说明：所有电子邮箱都是小写字母。</p>
<p>方法一：看到“找重复”的关键字眼，首先要用分组函数（group by），<br>再用聚合函数中的计数函数count()给电子邮件列计数。</p>
<p>分组汇总后，生成了一个如下的表。使用临时表</p>
<p>从这个表里选出计数大于1的电子邮件，就是重复的电子邮件。<br>重复的电子邮箱存在多次。要计算每封电子邮件的存在次数</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Email, <span class="keyword">count</span>(Email) <span class="keyword">as</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">from</span> Person</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> Email;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> Email   </span>|<span class="string"> num </span>|</span><br><span class="line">|<span class="string">---------</span>|<span class="string">-----</span>|</span><br><span class="line">|<span class="string"> a@b.com </span>|<span class="string"> 2   </span>|</span><br><span class="line">|<span class="string"> c@d.com </span>|<span class="string"> 1   </span>|</span><br></pre></td></tr></tbody></table></figure>
<p>以此作为临时表，我们可以得到下面的解决方案。<br>将“创建辅助表”的步骤放入子查询<br>选出辅助表中计数大于1的姓名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Email <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">select</span> Email, <span class="keyword">count</span>(Email) <span class="keyword">as</span> <span class="keyword">num</span></span><br><span class="line">  <span class="keyword">from</span> Person</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> Email</span><br><span class="line">) <span class="keyword">as</span> statistic</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">num</span> &gt; <span class="number">1</span></span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<p>方法二：使用 GROUP BY 和 HAVING 条件<br>向 GROUP BY 添加条件的一种更常用的方法是使用 HAVING 子句，该子句更为简单高效。<br>在 SQL 中增加 HAVING 子句原因是，where后面不能接聚合函数，<br>因为where子句的运行顺序排在group by之前，表还没有被分组。<br>HAVING 子句对分组后的分组查询的结果进行筛选<br>having子句即可包含聚合函数作用的字段也可包括普通的标量字段<br>having子句必须于group&nbsp;by&nbsp;子句同时使用，不能单独使用<br>where在分组前过滤，having在分组后过滤，两者之间不冲突。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    Email</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    Person</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    Email</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">count</span>(Email)&gt;<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>
<p>法三自联结。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> p1.Email </span><br><span class="line"><span class="keyword">from</span> Person <span class="keyword">as</span> p1, Person <span class="keyword">as</span> p2 </span><br><span class="line"><span class="keyword">where</span> p1.Email =p2.Email <span class="keyword">and</span> p1.Id!=p2.Id;</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="183-从不订购的客户"><a href="#183-从不订购的客户" class="headerlink" title="183. 从不订购的客户"></a>183. 从不订购的客户</h3><p><strong>某网站包含两个表，Customers 表和 Orders 表。编写一个 SQL 查询，找出所有从不订购任何东西的客户。</strong><br>Customers 表：</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>-------+</span><br><span class="line">| Id | Name  |</span><br><span class="line"><span class="code">+----+</span>-------+</span><br><span class="line">| 1  | Joe   |</span><br><span class="line">| 2  | Henry |</span><br><span class="line">| 3  | Sam   |</span><br><span class="line">| 4  | Max   |</span><br><span class="line"><span class="code">+----+</span>-------+</span><br></pre></td></tr></tbody></table></figure>
<p>Orders 表：</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>------------+</span><br><span class="line">| Id | CustomerId |</span><br><span class="line"><span class="code">+----+</span>------------+</span><br><span class="line">| 1  | 3          |</span><br><span class="line">| 2  | 1          |</span><br><span class="line"><span class="code">+----+</span>------------+</span><br></pre></td></tr></tbody></table></figure>
<p>例如给定上述表格，你的查询应返回：</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+-----------+</span></span><br><span class="line">| Customers |</span><br><span class="line"><span class="code">+-----------+</span></span><br><span class="line">| Henry     |</span><br><span class="line">| Max       |</span><br><span class="line"><span class="code">+-----------+</span></span><br></pre></td></tr></tbody></table></figure>
<p>方法：使用子查询和 NOT IN 子句<br>如果我们有一份曾经订购过的客户名单，就很容易知道谁从未订购过。<br>我们可以使用下面的代码来获得这样的列表。<br><code>select customerid from orders;</code><br>然后，我们可以使用 NOT IN 查询不在此列表中的客户。<br>集合差定义：C=A-B。C中的元素等于在A中但是不在B中。因此，对A中的每个元素a，如果元素a不在B中，则元素a就是集合C的元素。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    t1.name <span class="keyword">as</span> Customers</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    customers t1</span><br><span class="line"><span class="keyword">where</span> t1.id <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> customerid </span><br><span class="line">    <span class="keyword">from</span> orders</span><br><span class="line">    )</span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<p>法二：<br>如果订单表orders太大，那么会导致使用in的时候，信息都放入内存，效率降低；<br>使用left join只是做了个笛卡尔积运算，不占内存，求集合差的方法。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.Name Customers </span><br><span class="line"><span class="keyword">FROM</span> Customers t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Orders t2 </span><br><span class="line"><span class="keyword">ON</span> t1.Id = t2.CustomerId </span><br><span class="line"><span class="keyword">WHERE</span> t2.CustomerId <span class="keyword">is</span> <span class="literal">null</span></span><br></pre></td></tr></tbody></table></figure>
<p> =后面要讲一个确定的值，而null不能算一个确定的值，<br> 因为int型的可为null，varchar型的可为nul</p>
<p>方法三<br>EXISTS是布尔运算符，常用于测试子查询。<br>当subquery返回任何行时，EXISTS返回true，否则返回false。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    select_list</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    a_table</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    [<span class="keyword">NOT</span>] <span class="keyword">EXISTS</span>(subquery);</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> C.name <span class="keyword">as</span> <span class="string">`Customers`</span></span><br><span class="line"><span class="keyword">from</span> Customers <span class="keyword">as</span> C </span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">distinct</span> customerid</span><br><span class="line">    <span class="keyword">from</span> Orders <span class="keyword">as</span> O</span><br><span class="line">    <span class="keyword">where</span> O.customerid = C.id</span><br><span class="line">) ;</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="184-部门工资最高的员工"><a href="#184-部门工资最高的员工" class="headerlink" title="184. 部门工资最高的员工"></a>184. 部门工资最高的员工</h3><p><strong>Employee 表包含所有员工信息，每个员工有其对应的 Id, salary 和 department Id。</strong></p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+--------------+</span><br><span class="line">|<span class="string"> Id </span>|<span class="string"> Name  </span>|<span class="string"> Salary </span>|<span class="string"> DepartmentId </span>|</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> Joe   </span>|<span class="string"> 70000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> Jim   </span>|<span class="string"> 90000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> Henry </span>|<span class="string"> 80000  </span>|<span class="string"> 2            </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> Sam   </span>|<span class="string"> 60000  </span>|<span class="string"> 2            </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> Max   </span>|<span class="string"> 90000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">+----+-------+--------+--------------+</span><br></pre></td></tr></tbody></table></figure>
<p>Department 表包含公司所有部门的信息。</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line"><span class="code">+----+</span>----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line"><span class="code">+----+</span>----------+</span><br></pre></td></tr></tbody></table></figure>
<p>编写一个 SQL 查询，找出每个部门工资最高的员工。对于上述表，您的 SQL 查询应返回以下行（行的顺序无关紧要）。</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+------------+</span>----------<span class="code">+--------+</span></span><br><span class="line">| Department | Employee | Salary |</span><br><span class="line"><span class="code">+------------+</span>----------<span class="code">+--------+</span></span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line">| IT         | Jim      | 90000  |</span><br><span class="line">| Sales      | Henry    | 80000  |</span><br><span class="line"><span class="code">+------------+</span>----------<span class="code">+--------+</span></span><br></pre></td></tr></tbody></table></figure>
<p>解释：Max 和 Jim 在 IT 部门的工资都是最高的，Henry 在销售部的工资最高。</p>
<p>方法一：使用 JOIN 和 IN 语句</p>
<p>首先对 DepartmentId 字段分组查询每个部门内查询最高工资。<br>有可能有多个员工同时拥有最高工资，所以最好在这个查询中不包含雇员名字的信息，<br>包含 Salary 和 DepartmentId 字段，<br>例如技术部最高20k 但是客服部有个人20k 这样没有部门ID的话条件不足的</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    DepartmentId, <span class="keyword">MAX</span>(Salary)</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> DepartmentId;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> DepartmentId </span>|<span class="string"> MAX(Salary) </span>|</span><br><span class="line">|<span class="string">--------------</span>|<span class="string">-------------</span>|</span><br><span class="line">|<span class="string"> 1            </span>|<span class="string"> 90000       </span>|</span><br><span class="line">|<span class="string"> 2            </span>|<span class="string"> 80000       </span>|</span><br></pre></td></tr></tbody></table></figure>

<p>然后判断表中每条数据的分组和Salary是否和这个相等<br>把表 Employee 和 Department 连接，<br>再在这张临时表里用where或者IN语句筛选出 符合【工资=这个部门最高工资】 的员工信息。根据 Salary 和 DepartmentId 查找 Department.Name 字段</p>
<p>当两列同时作为关键字段进行条件查询时，是将两列合成二元组(部门id,部门最高薪水)作为一个值来查找。<br>，结合in判断 是否在已存在的组合中。<br>比如这个案例里是(课程号,成绩) in，<br>比如，“语文”和“90”合并为值“语文 90”。<br>如果部门A的最高薪水和部门B第二高的薪水是一样的，<br>此时不把DepartmentId对应起来的话，<br>仅仅是通过薪水查询则会把部门A薪水第二高的员工也查询出来，这是不符合要求的。</p>
<p>所以这两列的顺序要和子查询里列的顺序保持一致。<br>如果列的段顺序不一样，比如“90 语文”和“语文 90”就匹配不上，那么查询结果就是空的了。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    Department.name <span class="keyword">AS</span> <span class="string">'Department'</span>,</span><br><span class="line">    Employee.name <span class="keyword">AS</span> <span class="string">'Employee'</span>,</span><br><span class="line">    Salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee</span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line">    Department <span class="keyword">ON</span> Employee.DepartmentId = Department.Id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    (Employee.DepartmentId , Salary) <span class="keyword">IN</span>(</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            DepartmentId, <span class="keyword">MAX</span>(Salary)</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            Employee</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> </span><br><span class="line">            DepartmentId</span><br><span class="line">    )</span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<p>使用left join 要注意 部门名字 不能是NULL 。所以，如果使用Left join在官方解答后面加上一句判断 AND Department.name is not null… 。两张表都有可能为空，所以不能left和right，departmentid是null，leftjoin就会保留null</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    Department.name <span class="keyword">AS</span> <span class="string">'Department'</span>,</span><br><span class="line">    Employee.name <span class="keyword">AS</span> <span class="string">'Employee'</span>,</span><br><span class="line">    Salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    Department <span class="keyword">ON</span> Employee.DepartmentId = Department.Id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    (Employee.DepartmentId , Salary) <span class="keyword">IN</span></span><br><span class="line">    (   <span class="keyword">SELECT</span></span><br><span class="line">            DepartmentId, <span class="keyword">MAX</span>(Salary)</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            Employee</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> DepartmentId</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">AND</span> Department.name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<p>法二<br>连接临时表<br>Employee和查询出来的每个分组的最大值连接。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.Name <span class="keyword">as</span> Department, e.Name <span class="keyword">as</span> Employee, e.Salary</span><br><span class="line"><span class="keyword">from</span> Employee e </span><br><span class="line"><span class="keyword">join</span> Department d <span class="keyword">on</span> e.DepartmentId = d.Id </span><br><span class="line"><span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> DepartmentId, <span class="keyword">max</span>(Salary) <span class="keyword">as</span> Salary</span><br><span class="line">    <span class="keyword">from</span> Employee</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> DepartmentId</span><br><span class="line">    ) t </span><br><span class="line">    <span class="keyword">on</span> e.DepartmentId = t.DepartmentId <span class="keyword">and</span> e.Salary = t.Salary;</span><br></pre></td></tr></tbody></table></figure>

<p>法三<br>Employee和自身连接，on的条件为部门相同且同时约束Salary的大小。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.Name <span class="keyword">as</span> Department, e1.Name <span class="keyword">as</span> Employee, e1.Salary</span><br><span class="line"><span class="keyword">from</span> Employee e1 </span><br><span class="line"><span class="keyword">join</span> Department d <span class="keyword">on</span> e1.DepartmentId = d.Id </span><br><span class="line"><span class="keyword">join</span> Employee e2 <span class="keyword">on</span> e1.DepartmentId = e2.DepartmentId <span class="keyword">and</span> e1.Salary &lt;= e2.Salary</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e1.Id</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> e2.Salary) = <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure>


<hr>
<h3 id="185-部门工资前三高的所有员工"><a href="#185-部门工资前三高的所有员工" class="headerlink" title="185. 部门工资前三高的所有员工"></a>185. 部门工资前三高的所有员工</h3><p><strong>Employee 表包含所有员工信息，每个员工有其对应的工号&nbsp;Id，姓名 Name，工资 Salary 和部门编号 DepartmentId 。</strong></p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+--------------+</span><br><span class="line">|<span class="string"> Id </span>|<span class="string"> Name  </span>|<span class="string"> Salary </span>|<span class="string"> DepartmentId </span>|</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string"> Joe   </span>|<span class="string"> 85000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string"> Henry </span>|<span class="string"> 80000  </span>|<span class="string"> 2            </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string"> Sam   </span>|<span class="string"> 60000  </span>|<span class="string"> 2            </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string"> Max   </span>|<span class="string"> 90000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string"> Janet </span>|<span class="string"> 69000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">|<span class="string"> 6  </span>|<span class="string"> Randy </span>|<span class="string"> 85000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">|<span class="string"> 7  </span>|<span class="string"> Will  </span>|<span class="string"> 70000  </span>|<span class="string"> 1            </span>|</span><br><span class="line">+----+-------+--------+--------------+</span><br></pre></td></tr></tbody></table></figure>
<p>Department 表包含公司所有部门的信息。</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line"><span class="code">+----+</span>----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line"><span class="code">+----+</span>----------+</span><br></pre></td></tr></tbody></table></figure>
<p>编写一个&nbsp;SQL 查询，找出每个部门获得前三高工资的所有员工。例如，根据上述给定的表，查询结果应返回：</p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------------+----------+--------+</span><br><span class="line">|<span class="string"> Department </span>|<span class="string"> Employee </span>|<span class="string"> Salary </span>|</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">|<span class="string"> IT         </span>|<span class="string"> Max      </span>|<span class="string"> 90000  </span>|</span><br><span class="line">|<span class="string"> IT         </span>|<span class="string"> Randy    </span>|<span class="string"> 85000  </span>|</span><br><span class="line">|<span class="string"> IT         </span>|<span class="string"> Joe      </span>|<span class="string"> 85000  </span>|</span><br><span class="line">|<span class="string"> IT         </span>|<span class="string"> Will     </span>|<span class="string"> 70000  </span>|</span><br><span class="line">|<span class="string"> Sales      </span>|<span class="string"> Henry    </span>|<span class="string"> 80000  </span>|</span><br><span class="line">|<span class="string"> Sales      </span>|<span class="string"> Sam      </span>|<span class="string"> 60000  </span>|</span><br><span class="line">+------------+----------+--------+</span><br></pre></td></tr></tbody></table></figure>
<p>IT 部门中，Max 获得了最高的工资，Randy 和 Joe 都拿到了第二高的工资，Will 的工资排第三。<br>销售部门（Sales）只有两名员工，Henry 的工资最高，Sam 的工资排第二。</p>
<p>感觉应该改为各部门工资级别前三的员工<br>不能理解为前三名员工，如果拿90000的有四个人的话，你只取三个人，那怎么取都是错的了</p>
<p>方法：使用 JOIN 和子查询<br>公司里前 3 高的薪水意味着有不超过 3 个工资值比这些值大。</p>
<p>统计了有多少人的工资比 e1.Salary 高</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e1.Name <span class="keyword">as</span> <span class="string">'Employee'</span>, e1.Salary</span><br><span class="line"><span class="keyword">from</span> Employee e1</span><br><span class="line"><span class="keyword">where</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> e2.Salary)</span><br><span class="line">    <span class="keyword">from</span> Employee e2</span><br><span class="line">    <span class="keyword">where</span> e2.Salary &gt; e1.Salary</span><br><span class="line">    ) &lt; <span class="number">3</span> </span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>
<p>样例的输出应该如下所示。</p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> Employee </span>|<span class="string"> Salary </span>|</span><br><span class="line">|<span class="string">----------</span>|<span class="string">--------</span>|</span><br><span class="line">|<span class="string"> Joe      </span>|<span class="string"> 85000  </span>|</span><br><span class="line">|<span class="string"> Henry    </span>|<span class="string"> 80000  </span>|</span><br><span class="line">|<span class="string"> Max      </span>|<span class="string"> 90000  </span>|</span><br><span class="line">|<span class="string"> Randy    </span>|<span class="string"> 85000  </span>|</span><br></pre></td></tr></tbody></table></figure>
<p>当 &lt;3 改为 =0,第一高工资 比他高的工资 个数为0 </p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> Employee </span>|<span class="string"> Salary </span>|</span><br><span class="line">|<span class="string">----------</span>|<span class="string">--------</span>|</span><br><span class="line">|<span class="string"> Max      </span>|<span class="string"> 90000  </span>|</span><br></pre></td></tr></tbody></table></figure>
<p>当 &lt;3 改为 =1，第二高工资 ,比他的高的 工资个数为1，</p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> Employee </span>|<span class="string"> Salary </span>|</span><br><span class="line">|<span class="string">----------</span>|<span class="string">--------</span>|</span><br><span class="line">|<span class="string"> Joe      </span>|<span class="string"> 85000  </span>|</span><br><span class="line">|<span class="string"> Randy    </span>|<span class="string"> 85000  </span>|</span><br></pre></td></tr></tbody></table></figure>
<p>当 &lt;3 改为 =2，有2个比某个数大，就是最3大，</p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> Employee </span>|<span class="string"> Salary </span>|</span><br><span class="line">|<span class="string">----------</span>|<span class="string">--------</span>|</span><br><span class="line">|<span class="string"> Henry    </span>|<span class="string"> 80000  </span>|</span><br></pre></td></tr></tbody></table></figure>

<p>题目要查出为同一部门的前三高工资，在同一部门内 其他的工资&gt;该员工的薪资 的个数小于3  ，即为子查询里面的条件<br>把表 Employee 和表 Department 连接来获得部门信息。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">工资是同一个部门里的，不加这个条件的话，就会所有部门比较了</span><br><span class="line">SQL查询e1表是按行查询的，每查询一行，执行一次where后面的内容，</span><br><span class="line">也就是拿这一行的salary跟e2表里同部门的所有salary作比较，</span><br><span class="line">得到不超过这一行里salary值的个数。</span><br><span class="line">```SQL</span><br><span class="line">SELECT</span><br><span class="line">    d.Name AS 'Department', e1.Name AS 'Employee', e1.Salary</span><br><span class="line">FROM</span><br><span class="line">    Employee e1</span><br><span class="line">JOIN</span><br><span class="line">    Department d ON e1.DepartmentId = d.Id</span><br><span class="line">WHERE (SELECT</span><br><span class="line">            COUNT(DISTINCT e2.Salary)</span><br><span class="line">        FROM</span><br><span class="line">            Employee e2</span><br><span class="line">        WHERE</span><br><span class="line">            e2.Salary &gt; e1.Salary</span><br><span class="line">                AND e1.DepartmentId = e2.DepartmentId</span><br><span class="line">        ) &lt; 3 </span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Write your MySQL query statement below</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">解题思路:先对Employee表进行部门分组工资排名，</span></span><br><span class="line"><span class="comment">再关联Department表查询部门名称，</span></span><br><span class="line"><span class="comment">再使用WHERE筛选出排名小于等于3的数据（也就是每个部门排名前3的工资）。</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">D.Name <span class="keyword">AS</span> Department,</span><br><span class="line">A.Name <span class="keyword">AS</span> Employee,</span><br><span class="line">A.Salary</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DENSE_RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">partition</span> <span class="keyword">by</span> DepartmentId <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>) <span class="keyword">AS</span> ranking,DepartmentId,<span class="keyword">Name</span>,Salary</span><br><span class="line">      <span class="keyword">FROM</span> Employee) <span class="keyword">AS</span> A</span><br><span class="line"><span class="keyword">JOIN</span> Department <span class="keyword">AS</span> D <span class="keyword">ON</span> A.DepartmentId=D.id</span><br><span class="line"><span class="keyword">WHERE</span> A.ranking&lt;=<span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">d.Name <span class="keyword">AS</span> <span class="string">'Department'</span>, e1.Name <span class="keyword">AS</span> <span class="string">'Employee'</span>, e1.Salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"> Employee e1</span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line">Department d <span class="keyword">ON</span> e1.DepartmentId = d.Id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="comment">#工资级别数量小于等于3，即最多只有3个工资级别，也就是前三高</span></span><br><span class="line"> <span class="number">3</span> &gt;= (</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> e2.Salary)</span><br><span class="line"> <span class="keyword">FROM</span></span><br><span class="line">Employee e2</span><br><span class="line">  <span class="keyword">WHERE</span></span><br><span class="line"><span class="comment">#e2的工资级别大于等于e1的工资级别</span></span><br><span class="line"> e2.Salary &gt;= e1.Salary</span><br><span class="line"> <span class="keyword">AND</span> e1.DepartmentId = e2.DepartmentId</span><br><span class="line"> )</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> e1.DepartmentId,e1.Salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    t2.Name <span class="keyword">as</span> Department,</span><br><span class="line">    t1.Name <span class="keyword">as</span> Employee,</span><br><span class="line">    t1.Salary <span class="keyword">as</span> Salary</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    Employee <span class="keyword">as</span> t1,</span><br><span class="line">    Department <span class="keyword">as</span> t2</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    t1.DepartmentId = t2.Id <span class="keyword">and</span></span><br><span class="line">    <span class="number">3</span> &gt; (</span><br><span class="line">            <span class="keyword">select</span> </span><br><span class="line">                <span class="keyword">count</span>(<span class="keyword">distinct</span> Salary)</span><br><span class="line">            <span class="keyword">from</span></span><br><span class="line">                Employee</span><br><span class="line">            <span class="keyword">where</span></span><br><span class="line">                Salary&gt;t1.Salary <span class="keyword">and</span></span><br><span class="line">                DepartmentId = t1.DepartmentId</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> t2.Name,t1.Salary <span class="keyword">desc</span></span><br></pre></td></tr></tbody></table></figure>
<p>这一题做的有点混乱了，本来按自己的想法来说，前几前几这种问题，一般都是排好序之后用limit，但是好像很多题目都是两表连接，用比较符盒count判断，这个思路要学会转换。还有就是看了一些别人题解，发现也有用自定义变量等这些方法的，姿势还是很多的，哎，太菜了。</p>
<p>为了记录足球比赛的结果，设计表如下：<br>team：参赛队伍表<br>match：赛程表<br>match赛程表中的 hostTeamID与 guestTeamID都和team表中的 teamID关联,查询2006-6-1到2006-7-1之间举行的所有比赛,并且用以下形式列出:<br>拜仁 2:0 不莱梅 2006-6-21<br>首先列出需要查询的列：<br>参赛队伍表 team<br>字段名称 字段类型 描述<br>teamID int 主键<br>teamName varchar(20) 队伍名称<br>赛程表match<br>字段名称 字段类型 描述<br>match ID int 主键<br>hostTeamID int 主队的ID<br>guestTeamID int 客队的ID<br>matchTime date   比赛开始时间<br>matchResult varchar(20) 比赛结果，如（2:0）<br>其次列出结果列：<br>主队 结果 客对 时间</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建参赛队伍表CREATE TABLE team(</span></span><br><span class="line">teamID INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY, teamName VARCHAR(30) NOT NULL</span><br><span class="line">);</span><br><span class="line"><span class="comment">#向参赛队伍表中插入记录</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">' 拜 仁 '</span>); <span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">' 不 莱 梅 '</span>); <span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">'皇家马德里'</span>); <span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">'巴塞罗那'</span>); <span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">' 切 尔 西 '</span>); <span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">' 曼 联 '</span>); <span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">'AC 米 兰 '</span>); <span class="keyword">INSERT</span> <span class="keyword">INTO</span> team(teamName) <span class="keyword">VALUES</span>(<span class="string">'国际米兰'</span>);</span><br><span class="line"><span class="comment">#创建 match 赛程表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mat(</span><br><span class="line">matchID <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEy</span>,</span><br><span class="line">hostTeamID <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, guestTeamID <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">matchResult <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, matchTime <span class="built_in">DATE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">#向赛程表中插入几条记录</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mat(hostTeamID,guestTeamID,matchResult,matchTime) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="string">'3:1'</span>,<span class="string">'2006-6-15'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mat(hostTeamID,guestTeamID,matchResult,matchTime) <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="string">'2:2'</span>,<span class="string">'2006-6-28'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mat(hostTeamID,guestTeamID,matchResult,matchTime) <span class="keyword">VALUES</span>(<span class="number">5</span>,<span class="number">6</span>,<span class="string">'0:2'</span>,<span class="string">'2006-7-10'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mat(hostTeamID,guestTeamID,matchResult,matchTime) <span class="keyword">VALUES</span>(<span class="number">7</span>,<span class="number">8</span>,<span class="string">'5:3'</span>,<span class="string">'2006-5-30'</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>1、先进行一次左连接 得到主队的名字</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> hid,m1.tname,mres,gid,matime  <span class="keyword">from</span> m <span class="keyword">left</span> <span class="keyword">join</span> t <span class="keyword">as</span> m1 <span class="keyword">on</span> m.hid= m1.tid;</span><br><span class="line">1、先进行一次左连接 得到主队的名字</span><br></pre></td></tr></tbody></table></figure>

<p>2、再进行一次左连接 得到客队的名字</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> hid,m1.tname,mres,gid,t1.tname <span class="keyword">from</span> m <span class="keyword">left</span> <span class="keyword">join</span> t <span class="keyword">as</span> m1 <span class="keyword">on</span> m.hid= m1.tid <span class="keyword">left</span> <span class="keyword">join</span> t <span class="keyword">as</span> t1 <span class="keyword">on</span> m.gid=t1.tid;</span><br><span class="line">1、先进行一次左连接 得到主队的名字</span><br></pre></td></tr></tbody></table></figure>

<p>通过外键联表，完成最终SQL：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t1.teamName,m.matchResult,t2.teamName,m.matchTime </span><br><span class="line"><span class="keyword">from</span> <span class="keyword">match</span> <span class="keyword">as</span> m </span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> team <span class="keyword">as</span> t1 <span class="keyword">on</span> m.hostTeamID = t1.teamID, </span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> team <span class="keyword">as</span> t2 <span class="keyword">on</span> m.guestTeamID = t2.TeamID </span><br><span class="line"><span class="keyword">where</span> matchTime <span class="keyword">between</span> <span class="string">"2006-6-1"</span> <span class="keyword">and</span> <span class="string">"2006-7-1"</span></span><br></pre></td></tr></tbody></table></figure>


<p>问题22：一个6亿的表a，一个3亿的表b，通过外键tid关联，<br>你如何最快的查询出满足条件的第50000到第50200中的这200条数据记录。</p>
<p>1、如果A表TID是自增长,并且是连续的,B表的ID为索引</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> a,b </span><br><span class="line"><span class="keyword">where</span> a.tid = b.id <span class="keyword">and</span> a.tid&gt;<span class="number">50000</span> </span><br><span class="line"><span class="keyword">limit</span> <span class="number">200</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>2、如果A表的TID不是连续的,那么就需要使用覆盖索引.TID要么是主键,要么是辅助索引,B表ID也需要有索引。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> b , </span><br><span class="line">    (<span class="keyword">select</span> tid </span><br><span class="line">    <span class="keyword">from</span> a </span><br><span class="line">    <span class="keyword">limit</span> <span class="number">50000</span>,<span class="number">200</span>) a </span><br><span class="line"><span class="keyword">where</span> b.id = a .tid;</span><br></pre></td></tr></tbody></table></figure>

<p>拷贝表( 拷贝数据, 源表名：a 目标表名：b)</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> b(a, b, c) <span class="keyword">select</span> d,e,f <span class="keyword">from</span> a;</span><br></pre></td></tr></tbody></table></figure>

<p>Student(S#,Sname,Sage,Ssex) 学生表 Course(C#,Cname,T#) 课程表 SC(S#,C#,score) 成绩表 Teacher(T#,Tname) 教师表 查询没学过“叶平”老师课的同学的学号、姓名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Student.S<span class="comment">#,Student.Sname</span></span><br><span class="line"><span class="keyword">from</span> Student</span><br><span class="line"><span class="keyword">where</span> S<span class="comment"># not in (select distinct( SC.S#) </span></span><br><span class="line">    <span class="keyword">from</span> SC,Course,Teacher </span><br><span class="line">    <span class="keyword">where</span> SC.C<span class="comment">#=Course.C# and Teacher.T#=Course.T# and Teacher.Tname=’叶平’);</span></span><br></pre></td></tr></tbody></table></figure>

<p>随机取出10条数据</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">users</span> </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> &gt;= (</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(<span class="keyword">id</span>) <span class="keyword">FROM</span> <span class="keyword">users</span>)-(<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(<span class="keyword">id</span>) <span class="keyword">FROM</span> <span class="keyword">users</span>)</span><br><span class="line">    ) * <span class="keyword">RAND</span>() + (<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(<span class="keyword">id</span>) <span class="keyword">FROM</span> <span class="keyword">users</span>) </span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">10</span></span><br></pre></td></tr></tbody></table></figure>
<p>#此方法效率比直接用高很多</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">rand</span>() <span class="keyword">LIMIT</span> <span class="number">10</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/" class="post-title-link" itemprop="url">旅游网景点详细页面</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="旅游网景点详细页面"><a href="#旅游网景点详细页面" class="headerlink" title="旅游网景点详细页面"></a>旅游网景点详细页面</h1><h3 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h3><ul>
<li>面向组件方式编程</li>
<li>单页面应用</li>
</ul>
<p>如何在Vue项目中实现“多页面”<br>VueRouter用来在单页面应用中实现“多页面”<br>通过url的规则进行匹配，<br>满足url规则1，展示组件1的内容<br>满足url规则2，展示组件2的内容<br>满足url规则3，展示组件3的内容</p>
<h3 id="Vue中的路由管理"><a href="#Vue中的路由管理" class="headerlink" title="Vue中的路由管理"></a>Vue中的路由管理</h3><ul>
<li><p>Vue Router是Vue.js官方的路由管理器</p>
</li>
<li><p>新建项目</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">cd</span> C:/Vue</span><br><span class="line">&gt;&gt; npm create <span class="built_in">test</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>安装<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; cnpm install vue-router -S</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="路由的使用"><a href="#路由的使用" class="headerlink" title="路由的使用"></a>路由的使用</h3><ul>
<li>新建<code>/src/router.js</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="comment">// VueRouter是Vue.js的一个插件</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line">Vue.use(VueRouter)  <span class="comment">// 使用这个插件</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>设置路由规则<br><code>/src/router.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 页面1 匹配指定规则，匹配/home在对应的组件中显示首页的内容</span></span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/home'</span>, <span class="attr">component</span>: HomePage, <span class="attr">name</span>: <span class="string">'home'</span>},</span><br><span class="line">  <span class="comment">// 页面2</span></span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/about'</span>, <span class="attr">component</span>: AboutPage}</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></li>
<li>配置路由规则<br><code>/src/router.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter({</span><br><span class="line">  routes <span class="comment">// (缩写) 相当于 routes: routes</span></span><br><span class="line">})</span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  router</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>/src/router.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> route</span><br></pre></td></tr></tbody></table></figure>

<p><code>/src/main.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  <span class="comment">// router: router,</span></span><br><span class="line">  router,</span><br><span class="line">}).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>设置路由切换后页面的显示位置<br>在模板中指定路由切换后组件的渲染位置<br><code>&lt;router-view&gt;&lt;/router-view&gt;</code><br><code>/src/App.vue&gt;</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;!-- 路由变化之后，在这里显示组件的内容 --&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>在模板中实现路由跳转 转换成html的a标签<br><code>&lt;router-link to="/about"&gt;&lt;/router-link&gt;</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```/src/App.vue&gt;```</span><br><span class="line">```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;router-link to="/home"&gt;首页&lt;/router-link&gt; | </span><br><span class="line">    &lt;router-link to="/about"&gt;关于&lt;/router-link&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="Vue-js中的路由中的参数传递"><a href="#Vue-js中的路由中的参数传递" class="headerlink" title="Vue.js中的路由中的参数传递"></a>Vue.js中的路由中的参数传递</h3><p>景点详情的路由如何设计？</p>
<ul>
<li><p>get参数通过问号<br><code>/detail?id=1</code><br><code>/detail?id=2</code><br><code>/detail?id=3</code></p>
</li>
<li><p>django里的url设计原则<br><code>/detail/1</code><br><code>/detail/2</code><br><code>/detail/3</code></p>
</li>
</ul>
<h3 id="动态路由匹配"><a href="#动态路由匹配" class="headerlink" title="动态路由匹配"></a>动态路由匹配</h3><ul>
<li>设置动态匹配规则<ul>
<li>动态路由参数<br><code>/src/router.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DetailPage <span class="keyword">from</span> <span class="string">'./views/Detail.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter({</span><br><span class="line">  routes: [</span><br><span class="line">    <span class="comment">// http://localhost:8080/#/detail/1234/type1?name=ashe&amp;sort=asc</span></span><br><span class="line">    {<span class="attr">path</span>: <span class="string">'/d/:id/:types'</span>, <span class="attr">component</span>: DetailPage}</span><br><span class="line">    ]</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
等同于<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://localhost:8080/#/detail/1234/type1?name=ashe&amp;sort=asc</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/d/:id/:types'</span>, <span class="attr">component</span>: DetailPage}</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> VueRouter({</span><br><span class="line">  <span class="comment">// routes: routes</span></span><br><span class="line">  routes <span class="comment">// (缩写) 相当于 routes: routes</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
</li>
</ul>
<p><code>App.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: '',</span><br><span class="line">      name: '',</span><br><span class="line">      type: ''</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;    </span><br></pre></td></tr></tbody></table></figure>

<p>新建<code>/test/src/views/Detail.vue</code></p>
<ul>
<li><p>在组件中获取匹配参数和查询</p>
<ul>
<li><p>在JS中获取参数</p>
<figure class="highlight plain"><figcaption><span>``` 获取当前路由</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">```Detial.vue```</span><br><span class="line">```vue</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  created () {</span><br><span class="line">    let id = this.$route.params.id</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>响应参数的变化<br><code>Detial.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  watch: {</span><br><span class="line">    $route(to, from) {</span><br><span class="line">      // 对路由变化作出响应...</span><br><span class="line">      console.log('to:', to)</span><br><span class="line">      console.log('from:', from)</span><br><span class="line">      this.id = this.$route.params.id</span><br><span class="line">    },</span><br><span class="line">    id (to, from) {</span><br><span class="line">      console.log('to-id:', to)</span><br><span class="line">      console.log('from-id:', from)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;  </span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
<li><p>URL中的查询参数<br><code>/sight/list?name=ashe</code></p>
</li>
<li><p>获取方式<br><code>Detail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;详情页：{{ id }} : {{ name }} : {{ type }}&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  created () {</span><br><span class="line">    let name = this.$route.query.name</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="路由的跳转"><a href="#路由的跳转" class="headerlink" title="路由的跳转"></a>路由的跳转</h3><ul>
<li>在模板中标签跳转 router-link<br><code>App.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;router-link to="/d/123/type1"&gt;详情1&lt;/router-link&gt;|</span><br><span class="line">    &lt;!-- &lt;HelloWorld msg="Welcome to Your Vue.js App"/&gt; --&gt;</span><br><span class="line">    &lt;!-- 路由变化之后，在这里显示组件的内容 --&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
在浏览器点击点我回到详情1跳转<br><code>http://localhost:8080/#/d/123/type1</code></li>
</ul>
<ul>
<li><p>路由命名 方便URL修改<br><code>rounter.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DetailPage <span class="keyword">from</span> <span class="string">'./views/Detail.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义路由规则</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/home'</span>, <span class="attr">component</span>: HomePage, <span class="attr">name</span>: <span class="string">'home'</span>},</span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/about'</span>, <span class="attr">component</span>: AboutPage},</span><br><span class="line">  <span class="comment">// http://localhost:8080/#/detail/1234/type1?name=ashe&amp;sort=asc</span></span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/d/:id/:types'</span>, <span class="attr">component</span>: DetailPage, <span class="attr">name</span>: <span class="string">'detail-page'</span>}</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>按照名称跳转</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;router-link :to='"/d/" + id + "/" + types'&gt;详情2&lt;/router-link&gt;|</span><br><span class="line">    &lt;router-link :to='{path: "/d/" + id + "/" + types, query: {name: "abc", sort: "desc"}}'&gt;详情3&lt;/router-link&gt;|</span><br><span class="line">    &lt;router-link :to='{name: "detail-page", params: {id: "abc123", types: "type3"}, query: {name: "abc", sort: "desc"}}'&gt;详情4&lt;/router-link&gt;|</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// import HelloWorld from './components/HelloWorld.vue'</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  name: 'App',</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: 456,</span><br><span class="line">      types: 'type2'</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>在浏览器点击点我回到详情2跳转<br><code>http://localhost:8080/#/d/456/type2</code><br>在浏览器点击点我回到详情3跳转<br><code>http://localhost:8080/#/d/456/type2?name=abc&amp;sort=desc</code><br>在浏览器点击点我回到详情4跳转<br><code>http://localhost:8080/#/d/abc123/type3?name=abc&amp;sort=desc</code></p>
</li>
</ul>
<ul>
<li>在JS中事件跳转<figure class="highlight plain"><figcaption><span>vue```得到的实例</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;传参是 ```router```，接收参数是 ```route```</span><br><span class="line">```$router```表示vue实例上所挂载的在```main.js```的```new vue```中的```router```这个对象，</span><br><span class="line">跳转到不同的url，但这个方法会向history栈添加一个记录，点击后退会返回到上一个页面。</span><br><span class="line"></span><br><span class="line">```App.vue```</span><br><span class="line">```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;-- 字符串 --&gt;</span><br><span class="line">    this.$router.push('/home')  </span><br><span class="line">    &lt;-- 对象 --&gt;</span><br><span class="line">    this.$router.push({path:'/home'})</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>③ query 传参，相当于get请求，页面跳转时参数会在地址栏中显示，通过this.$route.query.id获取</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变成 /user?id=2</span></span><br><span class="line"><span class="built_in">this</span>.$router.push({ </span><br><span class="line">    path:<span class="string">'/user'</span>,</span><br><span class="line">    query:{</span><br><span class="line">        id:<span class="built_in">this</span>.id</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>④ params 传参，相当于post请求，页面跳转时参数不会在地址栏中显示,通过this.$route.params.id获取</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$router.push({ </span><br><span class="line">    path:<span class="string">'/user'</span>,</span><br><span class="line">    params:{</span><br><span class="line">        id:<span class="built_in">this</span>.id</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;a href="javascript:;" @click="goHome"&gt;点我跳转&lt;/a&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: 'App',</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: 456,</span><br><span class="line">      types: 'type2'</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goHome () {</span><br><span class="line">      this.$router.push('/home')</span><br><span class="line">      // this.$router.push({name: 'home'})</span><br><span class="line">      // this.$router.push({name: "detail-page", params: {id: "abc123", types: "type3"}, query: {name: "abc", sort: "desc"}})</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在浏览器点击点我回到首页跳转<br><code>http://localhost:8080/#/home</code></p>
<h3 id="路由的跳转方式"><a href="#路由的跳转方式" class="headerlink" title="路由的跳转方式"></a>路由的跳转方式</h3><ul>
<li>页面跳转</li>
</ul>
<p><code>this.$router.push(location, onComplete?, onAbort?)</code></p>
<ul>
<li>页面前进或后退<br><code>this.$router.go(n)</code><br>n可为正数可为负数。正数返回上一个页面。<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在浏览器记录中前进1步，相当于history.forward()</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后退一步记录，等同于history.back()</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前进三步记录</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果history记录不够用，就会失败</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">-100</span>)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;a href="javascript:;" @click="goBack"&gt;点我跳转&lt;/a&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: 'App',</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: 456,</span><br><span class="line">      types: 'type2'</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>替换浏览历史记录<br>同样是跳转到指定的url，但是这个方法不会向history里面添加新的记录，点击返回，会跳转到上上一个页面。上一个记录是不存在的。<br>场景是用户登录了后退，支付成功后退，不能回到原来的页面</li>
</ul>
<p><code>this.$router.replace(location, onComplete?, onAbort?)</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: 'App',</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: 456,</span><br><span class="line">      types: 'type2'</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goHome () {</span><br><span class="line">      this.$router.replace({name: 'home'})</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="景点搜索页面"><a href="#景点搜索页面" class="headerlink" title="景点搜索页面"></a>景点搜索页面</h3><p>实现步骤</p>
<ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分</li>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<p>使用Vant中可用的组件<br>复用景点列表组件<br>结合VueRouter实现页面跳转</p>
<p>新建<code>/src/views/Search.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 搜索页面 --&gt;</span><br><span class="line">  &lt;div class="page-search"&gt;</span><br><span class="line">    &lt;!-- 标题 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="搜索景点"</span><br><span class="line">      left-text="返回"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"</span><br><span class="line">      v-if="isHome"/&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;van-search</span><br><span class="line">      v-model="sightName"</span><br><span class="line">      show-action</span><br><span class="line">      label="景点"</span><br><span class="line">      placeholder="请输入搜索关键词"</span><br><span class="line">      @search="onSearch"</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;div @click="onSearch"&gt;搜索&lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line">    &lt;!-- 景点列表 --&gt;</span><br><span class="line">    &lt;div class="sight-list"&gt;</span><br><span class="line">      &lt;sight-item v-for="item in dataList"</span><br><span class="line">        :key="item.id"</span><br><span class="line">        :item="item"/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 分页 --&gt;</span><br><span class="line">    &lt;van-pagination v-model="currentPage"</span><br><span class="line">    :total-items="totalItems"</span><br><span class="line">    :items-per-page="perPage" /&gt;</span><br><span class="line">    &lt;!-- 底部导航 --&gt;</span><br><span class="line">    &lt;TripFooter/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 景点列表的每一项</span><br><span class="line">import SightItem from '@/components/common/ListSight'</span><br><span class="line">// 底部导航</span><br><span class="line">import TripFooter from '@/components/common/Footer'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 景点名称</span><br><span class="line">      sightName: '',</span><br><span class="line">      // 景点列表的数据</span><br><span class="line">      dataList: [],</span><br><span class="line">      // 总记录数</span><br><span class="line">      totalItems: 0,</span><br><span class="line">      // 当前的页码</span><br><span class="line">      currentPage: 1,</span><br><span class="line">      // 每页数据的大小</span><br><span class="line">      perPage: 5</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    SightItem,</span><br><span class="line">    TripFooter</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    onSearch () {</span><br><span class="line">      console.log('onSearch ')</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>/src/router/index.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">'../views/Search.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/search'</span>,</span><br><span class="line">    name: <span class="string">'Search'</span>,</span><br><span class="line">    component: Search</span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>点击底部导航跳转到搜索<br><code>/src/components/common/Footer.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 底部导航（公共组件） --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 开启路由模式，默认为false --&gt;</span><br><span class="line">    &lt;van-tabbar v-model="active" route&gt;</span><br><span class="line">      &lt;van-tabbar-item name="home" icon="wap-home-o" :to="{name: 'Home'}"&gt;首页&lt;/van-tabbar-item&gt;</span><br><span class="line">      &lt;van-tabbar-item name="search" icon="search" :to="{name: 'Search'}"&gt;搜索&lt;/van-tabbar-item&gt;    </span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="搭建前端详情页"><a href="#搭建前端详情页" class="headerlink" title="搭建前端详情页"></a>搭建前端详情页</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li><p>设计URL路由规则<br><code>/src/router/index.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SightList <span class="keyword">from</span> <span class="string">'../views/sight/SightList.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightDetail <span class="keyword">from</span> <span class="string">'../views/sight/SightDetail.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightInfo <span class="keyword">from</span> <span class="string">'../views/sight/SightInfo.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightComment <span class="keyword">from</span> <span class="string">'../views/sight/SightComment.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightImage <span class="keyword">from</span> <span class="string">'../views/sight/SightImage.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 景点列表</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/list'</span>,</span><br><span class="line">    name: <span class="string">'SightList'</span>,</span><br><span class="line">    component: SightList</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 景点详情</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/detail/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightDetail'</span>,</span><br><span class="line">    component: SightDetail</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 景点介绍</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/info/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightInfo'</span>,</span><br><span class="line">    component: SightInfo</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 评论列表</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/comment/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightComment'</span>,</span><br><span class="line">    component: SightComment</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 景点下的图片</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/image/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightImage'</span>,</span><br><span class="line">    component: SightImage</span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>新建详情页页面</p>
<ul>
<li><p>新建目录<code>/src/views/sight</code></p>
</li>
<li><p>新建<code>/src/views/sight/SightList.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点列表 --&gt;</span><br><span class="line">  &lt;div class="page-sight-list"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>新建<code>/src/views/sight/SightDetail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>新建<code>/src/views/sight/SightInfo.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点介绍 --&gt;</span><br><span class="line">  &lt;div class="page-sight-info"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>新建<code>/src/views/sight/SightComment.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点评论 --&gt;</span><br><span class="line">  &lt;div class="page-sight-comment"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>新建<code>/src/views/sight/SightImage.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点图片 --&gt;</span><br><span class="line">  &lt;div class="page-sight-image"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
<li><p>修改景点列表组件，支持路由跳转<br>从景点列表跳到景点详情<br><code>/src/components/common/ListSight.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;router-link class="sight-item"</span><br><span class="line">    :to="{name: 'SightDetail', params: {id: item.id}}"&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/router-link&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>从标题热门景点和更多跳到景点列表<br>从热门景点的地点跳到对应景点详情<br><code>/src/components/home/Hot.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 热门景点 --&gt;</span><br><span class="line">  &lt;div class="home-hot-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      :to="{name: 'SightList', query: {name: '热门推荐'}}"/&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">    &lt;!-- 景点列表 --&gt;</span><br><span class="line">    &lt;div class="box-main"&gt;</span><br><span class="line">      &lt;router-link class="hot-item"</span><br><span class="line">        :to="{name: 'SightDetail', params: {id: item.id}}"&gt;</span><br><span class="line">        &lt;div class="img"&gt;</span><br><span class="line">      &lt;/router-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //景点列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>从标题精选景点和更多跳到景点列表<br>从精选景点的地点跳到对应景点列表<br><code>/src/components/home/Fine.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 精选景点 --&gt;</span><br><span class="line">  &lt;div class="home-fine-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      title="精选景点"</span><br><span class="line">      :to="{name: 'SightList', query: {name: '精选景点'}}"/&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">    &lt;!-- 景点的列表 --&gt;</span><br><span class="line">    &lt;div class="box-main"&gt;</span><br><span class="line">      &lt;sight-item v-for="item in dataList"</span><br><span class="line">        :key="item.id"</span><br><span class="line">        :item="item"/&gt;</span><br><span class="line">        &lt;!-- 不需要:to --&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //景点的列表 --&gt;    </span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>拆分详情页组件<br><code>/src/views/sight/SightDetail.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 页面头部 --&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">    left-text="返回"</span><br><span class="line">    left-arrow</span><br><span class="line">    fixed</span><br><span class="line">    @click-left="goBack"</span><br><span class="line">  /&gt;</span><br><span class="line">    &lt;!-- 大图 --&gt;</span><br><span class="line">    &lt;!-- //大图 --&gt;</span><br><span class="line">    &lt;!-- 评分、景点介绍 --&gt;</span><br><span class="line">    &lt;!-- //评分、景点介绍 --&gt;</span><br><span class="line">    &lt;!-- 地址信息 --&gt;</span><br><span class="line">    &lt;!-- //地址信息 --&gt;</span><br><span class="line">    &lt;!-- 门票列表 --&gt;</span><br><span class="line">    &lt;!-- //门票列表 --&gt;</span><br><span class="line">    &lt;!-- 用户评价 --&gt;</span><br><span class="line">    &lt;!-- //用户评价 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang="less"&gt;</span><br><span class="line">.page-sight-detail {</span><br><span class="line">  // 导航栏  </span><br><span class="line">  .van-nav-bar {</span><br><span class="line">    background-color: transparent;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="景点大图部分"><a href="#景点大图部分" class="headerlink" title="景点大图部分"></a>景点大图部分</h3><h4 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 大图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sight-banner"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-image</span> <span class="attr">src</span>=<span class="string">"/static/home/hot/h1_max.jpg"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">height</span>=<span class="string">"100%"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tips"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">class</span>=<span class="string">"pic-sts"</span> <span class="attr">:to</span>=<span class="string">"{name: 'SightImage', params: {id: 123}}"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"video-o"</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>10 图片<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>景点标题<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- //大图 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">```vue</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.page-sight-detail</span> {</span></span><br><span class="line">  // 景点大图</span><br><span class="line"><span class="css">  <span class="selector-class">.sight-banner</span>{</span></span><br><span class="line">    position: relative;</span><br><span class="line"><span class="css">    <span class="selector-class">.tips</span> {</span></span><br><span class="line">      position: absolute;</span><br><span class="line">      left: 10px;</span><br><span class="line">      bottom: 10px;</span><br><span class="line">      font-size: 16px;</span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.pic-sts</span> {</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">        border-radius: 30px;</span><br><span class="line">        font-size: 14px;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-tag">rgba</span>(0,0,0,0<span class="selector-class">.4</span>);</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="评分、景点介绍"><a href="#评分、景点介绍" class="headerlink" title="评分、景点介绍"></a>评分、景点介绍</h3><h4 id="实现步骤-2"><a href="#实现步骤-2" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评分、景点介绍 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sight-info"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-title"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">strong</span>&gt;</span>5分<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">small</span>&gt;</span>很棒<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-tips"</span>&gt;</span>50 评论<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"arrow"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-title"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>景点介绍<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-tips"</span>&gt;</span>开放时间、贴士<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"arrow"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- //评分、景点介绍 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">```    </span><br><span class="line">```vue</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.page-sight-detail</span> {</span></span><br><span class="line">  // 评分、景点介绍</span><br><span class="line"><span class="css">  <span class="selector-class">.sight-info</span> {</span></span><br><span class="line">    display: flex;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">border-bottom</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#f6f6f6</span>;</span></span><br><span class="line"></span><br><span class="line">    &amp; &gt; div {</span><br><span class="line">      flex: 1;</span><br><span class="line">      position: relative;</span><br><span class="line">    }</span><br><span class="line"><span class="css">    <span class="selector-class">.right</span> {</span></span><br><span class="line"><span class="css">      <span class="selector-tag">border-left</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#f6f6f6</span>;</span></span><br><span class="line">    }</span><br><span class="line"><span class="css">    <span class="selector-class">.info-title</span> {</span></span><br><span class="line">      text-align: left;</span><br><span class="line">      padding: 5px 10px;</span><br><span class="line">      strong {</span><br><span class="line"><span class="css">        <span class="selector-tag">color</span>: <span class="selector-id">#ff8300</span>;</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"><span class="css">    <span class="selector-class">.info-tips</span> {</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#999</span>;</span></span><br><span class="line">      font-size: 12px;</span><br><span class="line">      text-align: left;</span><br><span class="line">      padding: 5px 10px;</span><br><span class="line">    }</span><br><span class="line"><span class="css">    <span class="selector-class">.van-icon</span> {</span></span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 5px;</span><br><span class="line">      top: 5px</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="地址信息"><a href="#地址信息" class="headerlink" title="地址信息"></a>地址信息</h3><h4 id="实现步骤-3"><a href="#实现步骤-3" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 地址信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"广东省广州市番禺区番禺大道"</span> <span class="attr">icon</span>=<span class="string">"location-o"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">is-link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:title-style</span>=<span class="string">"{'text-align': 'left'}"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">right-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"arrow"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- //地址信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">### 门票列表</span><br><span class="line">#### 实现步骤</span><br><span class="line">- 查找Vant中可以使用的组件</span><br><span class="line">- 实现组件模板部分</span><br><span class="line">```html</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 门票列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sight-ticket"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"门票"</span> <span class="attr">icon</span>=<span class="string">"bookmark-o"</span> <span class="attr">title-style</span>=<span class="string">"text-align:left"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ticket-item"</span> <span class="attr">v-for</span>=<span class="string">"i in 5"</span> <span class="attr">:key</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>成人票<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tips"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"clock-o"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>7点之前可以预定<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tags"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-tag</span> <span class="attr">mark</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>标签1<span class="tag">&lt;/<span class="name">van-tag</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"price"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>￥<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">strong</span>&gt;</span>65<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">"warning"</span> <span class="attr">size</span>=<span class="string">"small"</span>&gt;</span>预定<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- //门票列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">```vue</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.page-sight-detail</span> {</span></span><br><span class="line">  // 门票列表</span><br><span class="line"><span class="css">  <span class="selector-class">.sight-ticket</span> {</span></span><br><span class="line">    margin-top: 10px;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.ticket-item</span> {</span></span><br><span class="line">      display: flex;</span><br><span class="line"><span class="css">      <span class="selector-tag">border-bottom</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#f6f6f6</span>;</span></span><br><span class="line">      padding-bottom: 10px;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.left</span> {</span></span><br><span class="line">        flex: 1;</span><br><span class="line">        text-align: left;</span><br><span class="line">        padding: 5px 10px;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.title</span> {</span></span><br><span class="line">          padding: 5px 0;</span><br><span class="line">        }</span><br><span class="line"><span class="css">        <span class="selector-class">.tips</span> {</span></span><br><span class="line">          font-size: 12px;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line"><span class="css">      <span class="selector-class">.right</span> {</span></span><br><span class="line">        width: 100px;</span><br><span class="line"><span class="css">        <span class="selector-class">.price</span> {</span></span><br><span class="line"><span class="css">          <span class="selector-tag">color</span>: <span class="selector-id">#ff9800</span>;</span></span><br><span class="line">          strong {</span><br><span class="line">            font-size: 20px;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="用户评价列表"><a href="#用户评价列表" class="headerlink" title="用户评价列表"></a>用户评价列表</h3><h4 id="实现步骤-4"><a href="#实现步骤-4" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分</li>
</ul>
<p>当<code>key=value</code>，<code>key:value</code>等同于<code>key</code><br><code>params: {id: id}</code>等同于<code>params: {id}</code><br><code>/src/views/sight/SightDetail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 用户评价 --&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;van-cell title="热门评论" icon="comment-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;comment-item/&gt;</span><br><span class="line">      &lt;router-link class="link-more" :to="{name: 'SightComment', params: {id}}"&gt;查看更多&lt;/router-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //用户评价 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>点击查看更多跳到景点评价</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: ''</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">  }</span><br><span class="line">  // 查看更多</span><br><span class="line">  .link-more {</span><br><span class="line">    display: block;</span><br><span class="line">    color: #666;</span><br><span class="line">    padding: 10px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;    </span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">```vue</span><br><span class="line">&lt;style lang="less"&gt;</span><br><span class="line">.page-sight-detail {</span><br><span class="line">  // 评论列表</span><br><span class="line">  .sight-comment {</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>评价列表只在景点模块的详情页和查看更多复用<br>新建目录<code>/src/components/sight</code><br>新建<code>/src/components/sight/CommentItem.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 评论列表的每一项 --&gt;</span><br><span class="line">  &lt;div class="comment-item-box"&gt;</span><br><span class="line">    &lt;div class="cmt-header"&gt;</span><br><span class="line">      &lt;div class="rate"&gt;</span><br><span class="line">        &lt;van-rate v-model="value"</span><br><span class="line">        allow-half</span><br><span class="line">        readonly</span><br><span class="line">        void-icon="star"</span><br><span class="line">        void-color="#eee" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="user"&gt;张三*** 2021-3-19&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="cmt-content"&gt;</span><br><span class="line">      &lt;p&gt;评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 图片列表 --&gt;</span><br><span class="line">    &lt;div class="cmt-imgs" @click="show=true"&gt;</span><br><span class="line">      &lt;van-image width="100" height="100" src="https://img.yzcdn.cn/vant/cat.jpeg" /&gt;</span><br><span class="line">      &lt;van-image width="100" height="100" src="https://img.yzcdn.cn/vant/cat.jpeg" /&gt;</span><br><span class="line">      &lt;van-image width="100" height="100" src="https://img.yzcdn.cn/vant/cat.jpeg" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;van-image-preview v-model="show" :images="images" @change="onChange"&gt;</span><br><span class="line">      &lt;template v-slot:index&gt;第{{ index + 1 }}页&lt;/template&gt;</span><br><span class="line">    &lt;/van-image-preview&gt;</span><br><span class="line">    &lt;!-- //图片列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      show: false,</span><br><span class="line">      index: 0,</span><br><span class="line">      images: [</span><br><span class="line">        'https://img.yzcdn.cn/vant/apple-1.jpg',</span><br><span class="line">        'https://img.yzcdn.cn/vant/apple-2.jpg'</span><br><span class="line">      ],</span><br><span class="line">      value: 4.5</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    onChange (index) {</span><br><span class="line">      this.index = index</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>详情<code>/src/views/sight/SightDetail.vue</code>引入评价模块<br><code>&lt;comment-item/&gt;</code>等同于<code>&lt;CommentItem/&gt;</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 用户评价 --&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;comment-item/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //用户评价 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="ORM模型设计"><a href="#ORM模型设计" class="headerlink" title="ORM模型设计"></a>ORM模型设计</h3><p>开发步骤</p>
<ul>
<li>分析并设计模型<br>pdman工具</li>
<li>完成ORM模型编码<br>新建一个package<code>utils</code><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonModel</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 模型公共类 """</span></span><br><span class="line">    is_valid = models.BooleanField(<span class="string">'是否有效'</span>, default=<span class="literal">True</span>)</span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated_at = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\django\trip&gt;python manage.py startapp accounts</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/models.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.models <span class="keyword">import</span> CommonModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 用户模型 """</span></span><br><span class="line">    username = models.CharField(<span class="string">'用户名'</span>, max_length=<span class="number">32</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    password = models.CharField(<span class="string">'密码'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    avatar = models.ImageField(<span class="string">'用户头像'</span>, upload_to=<span class="string">'avatar/%Y%m'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    nickname = models.CharField(<span class="string">'昵称'</span>, max_length=<span class="number">32</span>, unique=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'account_user'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>trip\setting.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># 用户账户</span></span><br><span class="line">    <span class="string">'accounts.apps.AccountsConfig'</span></span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>system/models.py</code>和<code>sight/models.py</code><br>删掉</p>
<figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">is_valid</span> = models.BooleanField(<span class="string">'是否有效'</span>, default=<span class="literal">True</span>)</span><br><span class="line"><span class="attr">created_at</span> = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line"><span class="attr">updated_at</span> = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>system/models.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageRelated</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 图片关联 """</span></span><br><span class="line">    img = models.ImageField(<span class="string">'图片'</span>, upload_to=<span class="string">'%Y%m/file/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    summary = models.CharField(<span class="string">'图片说明'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    user = models.ForeignKey(User,</span><br><span class="line">                             on_delete=models.SET(<span class="literal">None</span>),</span><br><span class="line">                             related_name=<span class="string">'upload_images'</span>,</span><br><span class="line">                             verbose_name=<span class="string">'上传的用户'</span>,</span><br><span class="line">                             null=<span class="literal">True</span>)</span><br><span class="line">    content_type = models.ForeignKey(ContentType, on_delete=models.CASCADE)</span><br><span class="line">    object_id = models.IntegerField(<span class="string">'关联的模型'</span>)</span><br><span class="line">    <span class="comment"># 查到某一个图片要得到关联的某一个模型的对象</span></span><br><span class="line">    content_object = GenericForeignKey(<span class="string">'content_type'</span>, <span class="string">'object_id'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'system_image_related'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/models.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.contenttypes.fields <span class="keyword">import</span> GenericRelation</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> system.models <span class="keyword">import</span> ImageRelated</span><br><span class="line"><span class="keyword">from</span> utils.models <span class="keyword">import</span> CommonModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sight</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 景点基础信息 """</span></span><br><span class="line"></span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    main_img = models.ImageField(<span class="string">'主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    banner_img = models.ImageField(<span class="string">'详情主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    content = models.TextField(<span class="string">'详细'</span>)</span><br><span class="line">    score = models.FloatField(<span class="string">'评分'</span>, default=<span class="number">5</span>)</span><br><span class="line">    min_price = models.FloatField(<span class="string">'最低价格'</span>, default=<span class="number">0</span>)</span><br><span class="line">    province = models.CharField(<span class="string">'省份'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    city = models.CharField(<span class="string">'市区'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    area = models.CharField(<span class="string">'区/县'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line">    town = models.CharField(<span class="string">'乡镇'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    is_top = models.BooleanField(<span class="string">'是否为精选景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    is_hot = models.BooleanField(<span class="string">'是否为热门景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向关联，景点和系统的图片关联上</span></span><br><span class="line">    images = GenericRelation(ImageRelated,</span><br><span class="line">                             verbose_name=<span class="string">'关联的图片'</span>,</span><br><span class="line">                             <span class="comment"># 通过一个景点的模型对象，找到对应id的记录，转换为sight的对象，</span></span><br><span class="line">                             <span class="comment"># 通过其属性找到它的图片</span></span><br><span class="line">                             related_query_name=<span class="string">'rel_sight_iamges'</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight'</span></span><br><span class="line">        ordering = [<span class="string">'-updated_at'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>新建<code>sight/choices.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span>  models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketTypes</span>(<span class="params">models.IntegerChoices</span>):</span></span><br><span class="line">    ADULT = <span class="number">11</span>, <span class="string">'成人票'</span></span><br><span class="line">    CHILD = <span class="number">12</span>, <span class="string">'儿童票'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketStatus</span>(<span class="params">models.IntegerChoices</span>):</span></span><br><span class="line">    <span class="string">""" 门票的状态 """</span></span><br><span class="line">    OPEN = <span class="number">1</span>, <span class="string">'开放购买'</span></span><br><span class="line">    CLOSED = <span class="number">0</span>, <span class="string">'暂未开放'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EntryWay</span>(<span class="params">models.IntegerChoices</span>):</span></span><br><span class="line">    <span class="string">""" 入园方式 """</span></span><br><span class="line">    BY_TICKET = <span class="number">0</span>, <span class="string">'短信换票入园'</span></span><br><span class="line">    BY_CODE = <span class="number">1</span>, <span class="string">'凭借验证码入园'</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>检测ORM模型</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">python manage.py check</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">- 第四步，模型同步</span><br><span class="line">```bash</span><br><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">### 重构响应对象</span></span><br><span class="line"><span class="comment">#### 开发步骤</span></span><br><span class="line">- 设计响应单个对象的基类  接口返回统一的封装</span><br><span class="line">对象转为字典，再转为json对象</span><br><span class="line">新建```utils/serializers.py```定义两种接口所响应的数据类型， 一个是详情，直接返回响应对象 ，一个是列表，有```meta```和```object```的结构</span><br><span class="line">```python</span><br><span class="line">class BaseSerializer(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, obj):</span><br><span class="line">        self.obj = obj</span><br><span class="line"></span><br><span class="line">    def to_dict(self):</span><br><span class="line">        <span class="built_in">return</span> {}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MetaSerializer(object):</span><br><span class="line">    <span class="string">""</span><span class="string">" 分页元数据 "</span><span class="string">""</span></span><br><span class="line">    def __init__(self, page, page_count, total_count, **kwargs):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        :param page: 当前页</span></span><br><span class="line"><span class="string">        :param page_count: 总页数</span></span><br><span class="line"><span class="string">        :param total_count: 总记录数</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        self.page = page</span><br><span class="line">        self.page_count = page_count</span><br><span class="line">        self.total_count = total_count</span><br><span class="line"></span><br><span class="line">    def to_dict(self):</span><br><span class="line">        <span class="built_in">return</span> {</span><br><span class="line">            <span class="string">'total_count'</span>: self.total_count,</span><br><span class="line">            <span class="string">'page_count'</span>: self.page_count,</span><br><span class="line">            <span class="string">'current_page'</span>: self.page</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BaseListPageSerializer(object):</span><br><span class="line">    <span class="string">""</span><span class="string">" 分页类封装 "</span><span class="string">""</span></span><br><span class="line">    def __init__(self, page_obj, paginator=None, object_list=[]):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        :param page_obj: 当前页的对象</span></span><br><span class="line"><span class="string">        :param paginator: 分页器的对象</span></span><br><span class="line"><span class="string">        :param object_list: 当前页的数据列表</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        self.page_obj = page_obj</span><br><span class="line">        self.paginator = paginator <span class="keyword">if</span> paginator <span class="keyword">else</span> page_obj.paginator</span><br><span class="line">        self.object_list = object_list <span class="keyword">if</span> object_list <span class="keyword">else</span> page_obj.object_list</span><br><span class="line"></span><br><span class="line">    def get_object(self, obj):</span><br><span class="line">        <span class="string">""</span><span class="string">" 对象的内容，子类重写 "</span><span class="string">""</span></span><br><span class="line">        <span class="built_in">return</span> {}</span><br><span class="line"></span><br><span class="line">    def to_dict(self):</span><br><span class="line">        page = self.page_obj.number  <span class="comment"># 当前页</span></span><br><span class="line">        page_count = self.paginator.num_pages  <span class="comment"># 总页数</span></span><br><span class="line">        total_count = self.paginator.count  <span class="comment"># 总记录数</span></span><br><span class="line">        meta = MetaSerializer(page=page, page_count=page_count, total_count=total_count).to_dict()</span><br><span class="line"></span><br><span class="line">        objects = []</span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> self.object_list:</span><br><span class="line">            objects.append(self.get_object(obj))</span><br><span class="line">        <span class="built_in">return</span> {</span><br><span class="line">            <span class="string">'meta'</span>: meta,</span><br><span class="line">            <span class="string">'objects'</span>: objects</span><br><span class="line">        }</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">```sight/serializers.py```</span><br><span class="line">```py</span><br><span class="line">from utils.serializers import BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class SightListSerializer(BaseListPageSerializer):</span><br><span class="line">    <span class="string">""</span><span class="string">" 景点列表 "</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">    def get_object(self, obj):</span><br><span class="line">        <span class="built_in">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'main_img'</span>: obj.main_img.url,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="comment"># TODO 评论数量暂时无法获取</span></span><br><span class="line">            <span class="string">'comment_count'</span>: 0</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>设计响应列表对象的基类</p>
</li>
<li><p>设计错误基础类<br><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotFoundJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 400 对应JSON响应 """</span></span><br><span class="line">    status_code = <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line"></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"404000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"您访问的内容不存在或已被删除。"</span></span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>sight/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Sight</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> NotFoundJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line">    <span class="comment"># 每页放5条数据</span></span><br><span class="line">    paginate_by = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 重写查询方法 """</span></span><br><span class="line">        query = Q(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 1. 热门景点</span></span><br><span class="line">        is_hot = self.request.GET.get(<span class="string">'is_hot'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> is_hot:</span><br><span class="line">            query = query &amp; Q(is_hot=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 2. 精选景点</span></span><br><span class="line">        is_top = self.request.GET.get(<span class="string">'is_top'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> is_top:</span><br><span class="line">            query = query &amp; Q(is_top=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># TODO 3. 景点名称搜索</span></span><br><span class="line">        queryset = Sight.objects.filter(query)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]  <span class="comment"># 当前页的对象</span></span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            data = serializers.SightListSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="景点详情接口开发"><a href="#景点详情接口开发" class="headerlink" title="景点详情接口开发"></a>景点详情接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li><p>设计接口返回内容及字段</p>
</li>
<li><p>编写接口代码<br><code>sight/urls.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.2 景点详细信息</span></span><br><span class="line">    path(<span class="string">'sight/detail/&lt;int:pk&gt;/'</span>, views.SightDetailView.as_view(), name=<span class="string">"sight_detail"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<p><code>sight/serializers.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightDetailSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点详情 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        obj = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'img'</span>: obj.banner_img.url,</span><br><span class="line">            <span class="string">'content'</span>: obj.content,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="string">'area'</span>: obj.area,</span><br><span class="line">            <span class="string">'town'</span>: obj.town,</span><br><span class="line">            <span class="comment"># TODO 评论数量暂时无法获取</span></span><br><span class="line">            <span class="string">'comment_count'</span>: <span class="number">0</span></span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>sight/views.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> DetailView</span><br><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Sight</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightDetailView</span>(<span class="params">DetailView</span>):</span></span><br><span class="line">    <span class="string">""" 2.2 景点详细信息 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># return Sight.objects.filter(is_valid=True)</span></span><br><span class="line">        <span class="keyword">return</span> Sight.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        page_obj = context[<span class="string">'object'</span>]</span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> page_obj.is_valid:</span><br><span class="line">                <span class="keyword">return</span> NotFoundJsonResponse()</span><br><span class="line">            data = serializers.SightDetailSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="景点评论列表接口开发"><a href="#景点评论列表接口开发" class="headerlink" title="景点评论列表接口开发"></a>景点评论列表接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>设计接口返回内容及字段<br><code>sight/urls.py</code>  <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.3 景点下的评论列表</span></span><br><span class="line">    path(<span class="string">'comment/list/&lt;int:pk&gt;/'</span>, views.SightCommentListView.as_view(), name=<span class="string">"sight_comment_list"</span>),</span><br><span class="line">]</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">新建```system/serializers.py```</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseImageSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 序列化基础图片：其它列表需要引用到时使用 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        image = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'img'</span>: image.img.url,</span><br><span class="line">            <span class="string">'summary'</span>: image.summary</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>sight/serializers.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> system.serializers <span class="keyword">import</span> BaseImageSerializer</span><br><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 评论列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        user = obj.user</span><br><span class="line">        images = []</span><br><span class="line">        <span class="keyword">for</span> image <span class="keyword">in</span> obj.images.filter(is_valid=<span class="literal">True</span>):</span><br><span class="line">            images.append(BaseImageSerializer(image).to_dict())</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'user'</span>: {</span><br><span class="line">                <span class="string">'pk'</span>: user.pk,</span><br><span class="line">                <span class="string">'nickname'</span>: user.nickname</span><br><span class="line">            },</span><br><span class="line">            <span class="string">'pk'</span>: obj.pk,</span><br><span class="line">            <span class="string">'content'</span>: obj.content,</span><br><span class="line">            <span class="string">'is_top'</span>: obj.is_top,</span><br><span class="line">            <span class="string">'love_count'</span>: obj.love_count,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'is_public'</span>: obj.is_public,</span><br><span class="line">            <span class="string">'images'</span>: images,</span><br><span class="line">            <span class="string">'created_at'</span>: obj.created_at.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>编写接口代码<br><code>sight/views.py</code>  <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Comment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightCommentListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 2.3 景点下的评论列表 """</span></span><br><span class="line">    paginate_by = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 根据景点ID查询景点</span></span><br><span class="line">        sight_id = self.kwargs.get(<span class="string">'pk'</span>, <span class="literal">None</span>)</span><br><span class="line">        sight = Sight.objects.filter(pk=sight_id, is_valid=<span class="literal">True</span>).first()</span><br><span class="line">        <span class="keyword">if</span> sight:</span><br><span class="line">            <span class="comment"># return Comment.objects.filter(is_valid=True, sight=sight)</span></span><br><span class="line">            <span class="keyword">return</span> sight.comments.filter(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Comment.objects.none()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        <span class="string">""" 重写响应的返回 """</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]  <span class="comment"># 分页的某一页对象</span></span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            data = serializers.CommentListSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure></li>
<li>模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="门票列表接口开发"><a href="#门票列表接口开发" class="headerlink" title="门票列表接口开发"></a>门票列表接口开发</h3><h4 id="开发步骤-2"><a href="#开发步骤-2" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li><p>设计接口返回内容及字段<br><code>sight/urls.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.4 景点下的门票列表</span></span><br><span class="line">    path(<span class="string">'ticket/list/&lt;int:pk&gt;/'</span>, views.SightTicketListView.as_view(), name=<span class="string">"sight_ticket_list"</span>),</span><br><span class="line">]</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">```sight/serializers.py```  </span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 门票列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'pk'</span>: obj.pk,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'types'</span>: obj.types,</span><br><span class="line">            <span class="string">'price'</span>: obj.price,</span><br><span class="line">            <span class="string">'discount'</span>: obj.discount,</span><br><span class="line">            <span class="string">'total_stock'</span>: obj.total_stock,</span><br><span class="line">            <span class="string">'remain_stock'</span>: obj.remain_stock</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>编写接口代码<br><code>sight/views.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Ticket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightTicketListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 2.4 景点下的门票列表 """</span></span><br><span class="line"></span><br><span class="line">    paginate_by = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 根据景点ID查询景点</span></span><br><span class="line">        sight_id = self.kwargs.get(<span class="string">'pk'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> Ticket.objects.filter(is_valid=<span class="literal">True</span>, sight__id=sight_id)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        <span class="string">""" 重写响应的返回 """</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]</span><br><span class="line">        <span class="keyword">if</span> page_obj <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            data = serializers.TicketListSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>模拟HTTP请求，测试验证接口</p>
</li>
</ul>
<h3 id="景点介绍接口开发"><a href="#景点介绍接口开发" class="headerlink" title="景点介绍接口开发"></a>景点介绍接口开发</h3><h4 id="开发步骤-3"><a href="#开发步骤-3" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li><p>设计接口返回内容及字段<br><code>sight/urls.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.5 景点介绍</span></span><br><span class="line">    path(<span class="string">'sight/info/&lt;int:pk&gt;/'</span>, views.SightInfoDetailView.as_view(), name=<span class="string">"sight_info"</span>),</span><br><span class="line">]</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">```sight/serializers.py```  </span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightInfoSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点介绍 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        obj = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'pk'</span>: obj.sight.pk,  <span class="comment"># 景点ID</span></span><br><span class="line">            <span class="string">'entry_explain'</span>: obj.entry_explain,</span><br><span class="line">            <span class="string">'play_way'</span>: obj.play_way,</span><br><span class="line">            <span class="string">'tips'</span>: obj.tips,</span><br><span class="line">            <span class="string">'traffic'</span>: obj.traffic,</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>编写接口代码<br><code>sight/views.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightInfoDetailView</span>(<span class="params">DetailView</span>):</span></span><br><span class="line">    <span class="string">""" 2.5 景点介绍 """</span></span><br><span class="line">    slug_field = <span class="string">'sight__pk'</span>  <span class="comment"># url传递过来的这个变化的参数指代的是哪个字段</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Info.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        page_obj = context[<span class="string">'object'</span>]</span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            data = serializers.SightInfoSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>模拟HTTP请求，测试验证接口</p>
</li>
</ul>
<h3 id="景点搜索接口联调"><a href="#景点搜索接口联调" class="headerlink" title="景点搜索接口联调"></a>景点搜索接口联调</h3><h4 id="实现步骤-5"><a href="#实现步骤-5" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li><p>修改景点列表接口，支持搜索<br><code>sight/views.py</code>  </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line">    <span class="comment"># 每页放5条数据</span></span><br><span class="line">    paginate_by = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 重写查询方法 """</span></span><br><span class="line">        query = Q(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 3. 景点名称搜索</span></span><br><span class="line">        name = self.request.GET.get(<span class="string">'name'</span>, <span class="literal">None</span>)  <span class="comment"># 从前端获取搜索字段</span></span><br><span class="line">        <span class="keyword">if</span> name:</span><br><span class="line">            query = query &amp; Q(name__icontains=name)  <span class="comment"># 景点名称是否包含搜索字段</span></span><br><span class="line">        queryset = Sight.objects.filter(query)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_paginate_by</span>(<span class="params">self, queryset</span>):</span></span><br><span class="line">        <span class="string">""" 从前端控制每一页的分页大小 """</span></span><br><span class="line">        page_size = self.request.GET.get(<span class="string">'limit'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> page_size <span class="keyword">or</span> self.paginate_by   </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>配置接口地址<br>从首页底部点击搜索，保留底部组件，查询所有<br>从首页点击热门推荐和精选节点更多，去掉底部组件，增加左上角返回按钮，只查询热门推荐和精选景点</p>
</li>
</ul>
<p><code>src\components\home\Hot.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 热门景点 --&gt;</span><br><span class="line">  &lt;div class="home-hot-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      title="热门推荐"</span><br><span class="line">      icon="/static/home/hot/fire.png"</span><br><span class="line">      is-link</span><br><span class="line">      title-style="text-align:left"</span><br><span class="line">      value="全部榜单"</span><br><span class="line">      :to="{name: 'Search', query: {isHot: 1}}"/&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\components\home\Fine.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 精选景点 --&gt;</span><br><span class="line">  &lt;div class="home-fine-box"&gt;</span><br><span class="line">    &lt;!-- 顶上导航 --&gt;</span><br><span class="line">    &lt;van-cell</span><br><span class="line">      title="精选景点"</span><br><span class="line">      icon="location-o"</span><br><span class="line">      is-link</span><br><span class="line">      title-style="text-align:left"</span><br><span class="line">      value="更多"</span><br><span class="line">      :to="{name: 'Search', query: {isTop: 1}}"/&gt;</span><br><span class="line">    &lt;!-- // 顶上导航 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\views\Search.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 搜索页面 --&gt;</span><br><span class="line">  &lt;div class="page-search"&gt;</span><br><span class="line">    &lt;!-- 标题 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="搜索景点"</span><br><span class="line">      left-text="返回"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"</span><br><span class="line">      v-if="isHome"/&gt;</span><br><span class="line">    &lt;van-nav-bar title="搜索景点" v-else/&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;van-search</span><br><span class="line">      v-model="sightName"</span><br><span class="line">      show-action</span><br><span class="line">      label="景点"</span><br><span class="line">      placeholder="请输入搜索关键词"</span><br><span class="line">      @search="onSearch"</span><br><span class="line">      @clear="clear"</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;div @click="onSearch"&gt;搜索&lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2 v-if="isHot"&gt;热门推荐&lt;/h2&gt;</span><br><span class="line">    &lt;h2 v-if="isTop"&gt;精选景点&lt;/h2&gt;</span><br><span class="line">    &lt;!-- 景点列表 --&gt;</span><br><span class="line">    &lt;div class="sight-list"&gt;</span><br><span class="line">      &lt;sight-item v-for="item in dataList"</span><br><span class="line">        :key="item.id"</span><br><span class="line">        :item="item"/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 分页 --&gt;</span><br><span class="line">    &lt;van-pagination</span><br><span class="line">    v-model="currentPage"</span><br><span class="line">    :total-items="totalItems"</span><br><span class="line">    :items-per-page="perPage"</span><br><span class="line">    @change="pageChange" /&gt;</span><br><span class="line">    &lt;!-- 底部导航 --&gt;</span><br><span class="line">    &lt;TripFooter v-if="!isHome"/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 景点列表的每一项</span><br><span class="line">import SightItem from '@/components/common/ListSight'</span><br><span class="line">// 底部导航</span><br><span class="line">import TripFooter from '@/components/common/Footer'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 景点名称</span><br><span class="line">      sightName: '',</span><br><span class="line">      // 景点列表的数据</span><br><span class="line">      dataList: [],</span><br><span class="line">      // 总记录数</span><br><span class="line">      totalItems: 0,</span><br><span class="line">      // 当前的页码</span><br><span class="line">      currentPage: 1,</span><br><span class="line">      // 每页数据的大小</span><br><span class="line">      perPage: 4,</span><br><span class="line">      // 热门景点和精选景点</span><br><span class="line">      isHot: '',</span><br><span class="line">      isTop: ''</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    SightItem,</span><br><span class="line">    TripFooter</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 是否从首页过来</span><br><span class="line">     */</span><br><span class="line">    isHome () {</span><br><span class="line">      return this.isHot || this.isTop</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 景点列表接口</span><br><span class="line">     */</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          page: this.currentPage,</span><br><span class="line">          name: this.sightName,</span><br><span class="line">          limit: this.perPage,</span><br><span class="line">          is_top: this.isTop,</span><br><span class="line">          is_hot: this.isHot</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data: { meta, objects } }) =&gt; {</span><br><span class="line">        this.dataList = objects</span><br><span class="line">        // 总记录数</span><br><span class="line">        this.totalItems = meta.total_count</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    clear () {</span><br><span class="line">      this.dataList = []</span><br><span class="line">      this.currentPage = 1</span><br><span class="line">      this.getDataList()</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 页码发生变化后调用</span><br><span class="line">     */</span><br><span class="line">    pageChange () {</span><br><span class="line">      this.getDataList()</span><br><span class="line">    },</span><br><span class="line">    onSearch () {</span><br><span class="line">      console.log('onSearch ')</span><br><span class="line">      // 判断搜索内容是否为空</span><br><span class="line">      if (!this.sightName) {</span><br><span class="line">        this.$toast('请输入搜索词') // 弹框提示</span><br><span class="line">        return</span><br><span class="line">      }</span><br><span class="line">      // 重置数据</span><br><span class="line">      this.dataList = []</span><br><span class="line">      this.currentPage = 1</span><br><span class="line">      // 执行查询</span><br><span class="line">      this.getDataList()</span><br><span class="line">    }</span><br><span class="line">  },  </span><br><span class="line">  mounted () {</span><br><span class="line">    // 热门景点和精选景点</span><br><span class="line">    this.isHot = this.$route.query.isHot</span><br><span class="line">    this.isTop = this.$route.query.isTop</span><br><span class="line">    this.getDataList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>使用axios获取数据</li>
<li>将数据设置到模型层</li>
</ul>
<h3 id="景点详情和评论接口联调"><a href="#景点详情和评论接口联调" class="headerlink" title="景点详情和评论接口联调"></a>景点详情和评论接口联调</h3><h4 id="实现步骤-6"><a href="#实现步骤-6" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>阅读接口文档</li>
<li>配置接口地址<br><code>src\utils\apis.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 景点模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> SightApis = {</span><br><span class="line">  <span class="comment">// 景点列表</span></span><br><span class="line">  sightListUrl: apiHost + <span class="string">'/sight/sight/list/'</span>,</span><br><span class="line">  <span class="comment">// 景点详情</span></span><br><span class="line">  sightDetailUrl: apiHost + <span class="string">'/sight/sight/detail/#{id}/'</span>,</span><br><span class="line">  <span class="comment">// 门票列表</span></span><br><span class="line">  sightTicketUrl: apiHost + <span class="string">'/sight/ticket/list/#{id}/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>src\views\sight\SightDetail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 大图 --&gt;</span><br><span class="line">    &lt;div class="sight-banner"&gt;</span><br><span class="line">      &lt;van-image :src="sightDetail.img" width="100%" height="100%"/&gt;</span><br><span class="line">      &lt;div class="tips"&gt;</span><br><span class="line">        &lt;router-link class="pic-sts" :to="{name: 'SightImage', params: {id}}"&gt;</span><br><span class="line">          &lt;van-icon name="video-o" /&gt;</span><br><span class="line">          &lt;span&gt;{{ sightDetail.image_count }} 图片&lt;/span&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">        &lt;div class="title"&gt;{{ sightDetail.name }}&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //大图 --&gt;</span><br><span class="line">    &lt;!-- 评分、景点介绍 --&gt;</span><br><span class="line">    &lt;div class="sight-info"&gt;</span><br><span class="line">      &lt;div class="left"&gt;</span><br><span class="line">        &lt;div class="info-title"&gt;</span><br><span class="line">          &lt;strong&gt;{{ sightDetail.score }}分&lt;/strong&gt;</span><br><span class="line">          &lt;small&gt;很棒&lt;/small&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info-tips"&gt;{{ sightDetail.comment_count }} 评论&lt;/div&gt;</span><br><span class="line">        &lt;van-icon name="arrow" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="right"&gt;</span><br><span class="line">        &lt;div class="info-title"&gt;</span><br><span class="line">          &lt;span&gt;景点介绍&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info-tips"&gt;开放时间、贴士&lt;/div&gt;</span><br><span class="line">        &lt;van-icon name="arrow" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //评分、景点介绍 --&gt;</span><br><span class="line">    &lt;!-- 门票列表 --&gt;</span><br><span class="line">    &lt;div class="sight-ticket"&gt;</span><br><span class="line">      &lt;van-cell title="门票" icon="bookmark-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;div class="ticket-item" v-for="item in ticketList" :key="item.pk"&gt;</span><br><span class="line">        &lt;div class="left"&gt;</span><br><span class="line">          &lt;div class="title"&gt;{{ item.name }}&lt;/div&gt;</span><br><span class="line">          &lt;div class="tips"&gt;</span><br><span class="line">            &lt;van-icon name="clock-o" /&gt;</span><br><span class="line">            &lt;span&gt;{{ item.desc }}&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="tags"&gt;</span><br><span class="line">            &lt;van-tag mark type="primary"&gt;标签1&lt;/van-tag&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="right"&gt;</span><br><span class="line">          &lt;div class="price"&gt;</span><br><span class="line">            &lt;span&gt;￥&lt;/span&gt;</span><br><span class="line">            &lt;strong&gt;{{ item.sell_price }}&lt;/strong&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;router-link to="#"&gt;</span><br><span class="line">            &lt;van-button type="warning" size="small"&gt;预定&lt;/van-button&gt;</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //门票列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: '',</span><br><span class="line">      // 景点详细信息</span><br><span class="line">      sightDetail: {},</span><br><span class="line">      // 门票列表</span><br><span class="line">      ticketList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 地址的全部信息</span><br><span class="line">     */</span><br><span class="line">    fullArea () {</span><br><span class="line">      let area = this.sightDetail.province + this.sightDetail.city</span><br><span class="line">      if (this.sightDetail.area) {</span><br><span class="line">        area += this.sightDetail.area</span><br><span class="line">      }</span><br><span class="line">      if (this.sightDetail.town) {</span><br><span class="line">        area += this.sightDetail.town</span><br><span class="line">      }</span><br><span class="line">      return area</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 获取景点详细信息</span><br><span class="line">     */</span><br><span class="line">    getSightDetail () {</span><br><span class="line">      const url = SightApis.sightDetailUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data }) =&gt; {</span><br><span class="line">        this.sightDetail = data</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">      * 门票列表</span><br><span class="line">      */</span><br><span class="line">    getTicketList () {</span><br><span class="line">      const url = SightApis.sightTicketUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.ticketList = objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">    // 获取景点详细信息</span><br><span class="line">    this.getSightDetail()</span><br><span class="line">    // 获取门票列表</span><br><span class="line">    this.getTicketList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>详情页的图片数量和评论数量<br><code>sight/models.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.contenttypes.fields <span class="keyword">import</span> GenericRelation</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> system.models <span class="keyword">import</span> ImageRelated</span><br><span class="line"><span class="keyword">from</span> sight.choices <span class="keyword">import</span> TicketTypes, EntryWay, TicketStatus</span><br><span class="line"><span class="keyword">from</span> utils.models <span class="keyword">import</span> CommonModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sight</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 景点基础信息 """</span></span><br><span class="line"></span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    main_img = models.ImageField(<span class="string">'主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    banner_img = models.ImageField(<span class="string">'详情主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    content = models.TextField(<span class="string">'详细'</span>)</span><br><span class="line">    score = models.FloatField(<span class="string">'评分'</span>, default=<span class="number">5</span>)</span><br><span class="line">    min_price = models.FloatField(<span class="string">'最低价格'</span>, default=<span class="number">0</span>)</span><br><span class="line">    province = models.CharField(<span class="string">'省份'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    city = models.CharField(<span class="string">'市区'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    area = models.CharField(<span class="string">'区/县'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line">    town = models.CharField(<span class="string">'乡镇'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    is_top = models.BooleanField(<span class="string">'是否为精选景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    is_hot = models.BooleanField(<span class="string">'是否为热门景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向关联，景点和系统的图片关联上</span></span><br><span class="line">    images = GenericRelation(ImageRelated,</span><br><span class="line">                             verbose_name=<span class="string">'关联的图片'</span>,</span><br><span class="line">                             <span class="comment"># 通过一个景点的模型对象，找到对应id的记录，转换为sight的对象，</span></span><br><span class="line">                             <span class="comment"># 通过其属性找到它的图片</span></span><br><span class="line">                             related_query_name=<span class="string">'rel_sight_iamges'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight'</span></span><br><span class="line">        ordering = [<span class="string">'-updated_at'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">comment_count</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 评论总数 """</span></span><br><span class="line">        <span class="keyword">return</span> self.comments.filter(is_valid=<span class="literal">True</span>).count()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">image_count</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 景点图片的数量 """</span></span><br><span class="line">        <span class="keyword">return</span> self.images.filter(is_valid=<span class="literal">True</span>).count()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 景点详情 """</span></span><br><span class="line">    sight = models.OneToOneField(Sight, on_delete=models.CASCADE)</span><br><span class="line">    entry_explain = models.CharField(<span class="string">'入园参考'</span>, max_length=<span class="number">1024</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    play_way = models.TextField(<span class="string">'特色玩法'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    tips = models.TextField(<span class="string">'温馨提示'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    traffic = models.TextField(<span class="string">'交通到达'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight_info'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 门票 """</span></span><br><span class="line">    sight = models.ForeignKey(Sight, related_name=<span class="string">'tickets'</span>, verbose_name=<span class="string">'景点门票'</span>,</span><br><span class="line">                              on_delete=models.PROTECT)</span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">128</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">64</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    types = models.SmallIntegerField(<span class="string">'类型'</span>,</span><br><span class="line">                                     choices=TicketTypes.choices,</span><br><span class="line">                                     default=TicketTypes.ADULT,</span><br><span class="line">                                     help_text=<span class="string">'默认为成人票'</span>)</span><br><span class="line">    price = models.FloatField(<span class="string">'价格（原价）'</span>)</span><br><span class="line">    discount = models.FloatField(<span class="string">'折扣'</span>, default=<span class="number">10</span>)</span><br><span class="line">    total_stock = models.PositiveIntegerField(<span class="string">'总库存'</span>, default=<span class="number">0</span>)</span><br><span class="line">    remain_stock = models.PositiveIntegerField(<span class="string">'剩余库存'</span>, default=<span class="number">0</span>)</span><br><span class="line">    expire_date = models.IntegerField(<span class="string">'有效期'</span>, default=<span class="number">1</span>)</span><br><span class="line">    return_policy = models.CharField(<span class="string">'退改政策'</span>, max_length=<span class="number">64</span>, default=<span class="string">'条件退'</span>)</span><br><span class="line">    has_invoice = models.BooleanField(<span class="string">'是否提供发票'</span>, default=<span class="literal">True</span>)</span><br><span class="line">    entry_way = models.SmallIntegerField(<span class="string">'入园方式'</span>,</span><br><span class="line">                                         choices=EntryWay.choices,</span><br><span class="line">                                         default=EntryWay.BY_TICKET)</span><br><span class="line">    tips = models.TextField(<span class="string">'预定须知'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    remark = models.TextField(<span class="string">'其他说明'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    status = models.SmallIntegerField(<span class="string">'状态'</span>,</span><br><span class="line">                                      choices=TicketStatus.choices,</span><br><span class="line">                                      default=TicketStatus.OPEN)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight_ticket'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sell_price</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 销售价 = 原价 x 折扣 """</span></span><br><span class="line">        <span class="keyword">return</span> self.price * self.discount / <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 评论及回复 """</span></span><br><span class="line">    <span class="comment"># 评论关联到用户</span></span><br><span class="line">    user = models.ForeignKey(User, verbose_name=<span class="string">'评论人'</span>,</span><br><span class="line">                             related_name=<span class="string">'comments'</span>,</span><br><span class="line">                             on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># 评论关联到景点</span></span><br><span class="line">    sight = models.ForeignKey(Sight, verbose_name=<span class="string">'景点'</span>,</span><br><span class="line">                              related_name=<span class="string">'comments'</span>,</span><br><span class="line">                              on_delete=models.CASCADE)</span><br><span class="line">    content = models.TextField(<span class="string">'评论内容'</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>)</span><br><span class="line">    is_top = models.BooleanField(<span class="string">'是否置顶'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    love_count = models.IntegerField(<span class="string">'点赞次数'</span>, default=<span class="number">0</span>)</span><br><span class="line">    score = models.FloatField(<span class="string">'评分'</span>, default=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    ip_address = models.CharField(<span class="string">'IP地址'</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    is_public = models.SmallIntegerField(<span class="string">'是否公开'</span>, default=<span class="number">1</span>)</span><br><span class="line">    reply = models.ForeignKey(</span><br><span class="line">        <span class="string">'self'</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>,</span><br><span class="line">        related_name=<span class="string">'reply_comment'</span>,</span><br><span class="line">        verbose_name=<span class="string">'回复'</span>,</span><br><span class="line">        on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># 反向关联，评论和系统的图片关联上</span></span><br><span class="line">    images = GenericRelation(ImageRelated,</span><br><span class="line">                             verbose_name=<span class="string">'关联的图片'</span>,</span><br><span class="line">                             related_query_name=<span class="string">"rel_comment_images"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight_comment'</span></span><br><span class="line">        ordering = [<span class="string">'-love_count'</span>, <span class="string">'-created_at'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'main_img'</span>: obj.main_img.url,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="string">'comment_count'</span>: obj.comment_count</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightDetailSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点详情 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        obj = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'img'</span>: obj.banner_img.url,</span><br><span class="line">            <span class="string">'content'</span>: obj.content,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="string">'area'</span>: obj.area,</span><br><span class="line">            <span class="string">'town'</span>: obj.town,</span><br><span class="line">            <span class="string">'comment_count'</span>: obj.comment_count,</span><br><span class="line">            <span class="string">'image_count'</span>: obj.image_count,</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 门票列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'pk'</span>: obj.pk,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'types'</span>: obj.types,</span><br><span class="line">            <span class="string">'price'</span>: obj.price,</span><br><span class="line">            <span class="string">'sell_price'</span>: obj.sell_price,</span><br><span class="line">            <span class="string">'discount'</span>: obj.discount,</span><br><span class="line">            <span class="string">'total_stock'</span>: obj.total_stock,</span><br><span class="line">            <span class="string">'remain_stock'</span>: obj.remain_stock</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>使用axios获取数据</li>
<li>将数据设置到模型层</li>
</ul>
<h3 id="景点评论接口联调"><a href="#景点评论接口联调" class="headerlink" title="景点评论接口联调"></a>景点评论接口联调</h3><h4 id="实现步骤-7"><a href="#实现步骤-7" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>阅读接口文档</li>
<li>配置接口地址<br>评论的每一项在景点详情、单独的评论列表，封装成公共组件，<br>获取里面内容在详情页url发生变化的时候，watch监听路由变化，重新获取数据</li>
</ul>
<p><code>src\utils\filters.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户名称脱敏处理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{*}</span> </span>name 用户名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unameFormat</span> (<span class="params">name</span>) </span>{</span><br><span class="line">  <span class="keyword">if</span> (!name) {</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> name.substr(<span class="number">0</span>, <span class="number">2</span>) + <span class="string">'***'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> {</span><br><span class="line">  unameFormat</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\utils\apis.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SightApis = {</span><br><span class="line">  <span class="comment">// 评论列表</span></span><br><span class="line">  sightCommentUrl: apiHost + <span class="string">'/sight/comment/list/#{id}/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\views\sight\SightComment.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点评论 --&gt;</span><br><span class="line">  &lt;div class="page-sight-comment"&gt;</span><br><span class="line">    &lt;!-- 页面头部 --&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      left-text="返回"</span><br><span class="line">      title="景点评论"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;comment-item v-for="item in commentList" :key="item.pk" :item="item" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 评论列表</span><br><span class="line">      commentList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 评论列表</span><br><span class="line">     */</span><br><span class="line">    getCommentList () {</span><br><span class="line">      const url = SightApis.sightCommentUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.commentList = objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">    this.getCommentList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\views\sight\SightDetail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 门票列表 --&gt;</span><br><span class="line">    &lt;div class="sight-ticket"&gt;</span><br><span class="line">      &lt;van-cell title="门票" icon="bookmark-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;div class="ticket-item" v-for="item in ticketList" :key="item.pk"&gt;</span><br><span class="line">        &lt;div class="left"&gt;</span><br><span class="line">          &lt;div class="title"&gt;{{ item.name }}&lt;/div&gt;</span><br><span class="line">          &lt;div class="tips"&gt;</span><br><span class="line">            &lt;van-icon name="clock-o" /&gt;</span><br><span class="line">            &lt;span&gt;{{ item.desc }}&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="tags"&gt;</span><br><span class="line">            &lt;van-tag mark type="primary"&gt;标签1&lt;/van-tag&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="right"&gt;</span><br><span class="line">          &lt;div class="price"&gt;</span><br><span class="line">            &lt;span&gt;￥&lt;/span&gt;</span><br><span class="line">            &lt;strong&gt;{{ item.sell_price }}&lt;/strong&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;router-link to="#"&gt;</span><br><span class="line">            &lt;van-button type="warning" size="small"&gt;预定&lt;/van-button&gt;</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //门票列表 --&gt;</span><br><span class="line">    &lt;!-- 用户评价 --&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;van-cell title="热门评论" icon="comment-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;comment-item v-for="item in commentList" :key="item.pk" :item="item" /&gt;</span><br><span class="line">      &lt;router-link class="link-more" :to="{name: 'SightComment', params: {id}}"&gt;查看更多&lt;/router-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //用户评价 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: '',</span><br><span class="line">      // 景点详细信息</span><br><span class="line">      sightDetail: {},</span><br><span class="line">      // 门票列表</span><br><span class="line">      ticketList: [],</span><br><span class="line">      // 评论列表</span><br><span class="line">      commentList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 地址的全部信息</span><br><span class="line">     */</span><br><span class="line">    fullArea () {</span><br><span class="line">      let area = this.sightDetail.province + this.sightDetail.city</span><br><span class="line">      if (this.sightDetail.area) {</span><br><span class="line">        area += this.sightDetail.area</span><br><span class="line">      }</span><br><span class="line">      if (this.sightDetail.town) {</span><br><span class="line">        area += this.sightDetail.town</span><br><span class="line">      }</span><br><span class="line">      return area</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  watch: {</span><br><span class="line">    $route () {</span><br><span class="line">      this.loadData()</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 跳转到评论列表</span><br><span class="line">     */</span><br><span class="line">    goPage () {</span><br><span class="line">      this.$router.push({name: 'SightComment', params: {id: this.id}})</span><br><span class="line">    },</span><br><span class="line">    loadData () {</span><br><span class="line">      this.id = this.$route.params.id</span><br><span class="line">      // 获取景点详细信息</span><br><span class="line">      this.getSightDetail()</span><br><span class="line">      // 门票列表</span><br><span class="line">      this.getTicketList()</span><br><span class="line">      // 评论列表</span><br><span class="line">      this.getCommentList()</span><br><span class="line">    },</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 获取景点详细信息</span><br><span class="line">     */</span><br><span class="line">    getSightDetail () {</span><br><span class="line">      const url = SightApis.sightDetailUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data }) =&gt; {</span><br><span class="line">        this.sightDetail = data</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 门票列表</span><br><span class="line">     */</span><br><span class="line">    getTicketList () {</span><br><span class="line">      const url = SightApis.sightTicketUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.ticketList = objects</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 评论列表</span><br><span class="line">     */</span><br><span class="line">    getCommentList () {</span><br><span class="line">      const url = SightApis.sightCommentUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.commentList = objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.loadData()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>使用axios获取数据</li>
<li>将数据设置到模型层</li>
</ul>
<h3 id="前端代码优化"><a href="#前端代码优化" class="headerlink" title="前端代码优化"></a>前端代码优化</h3><ul>
<li>添加loading动画和添加请求拦截<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">window.app = new Vue({</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: h =&gt; h(App)</span><br><span class="line">}).$mount('#app')</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>src\utils\ajax.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line">ajax.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>{</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'请求拦截到了'</span>)</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.loading({</span><br><span class="line">    message: <span class="string">'加载中...'</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span>,</span><br><span class="line">    loadingType: <span class="string">'spinner'</span></span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">ajax.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line">  <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'响应拦截到了'</span>)</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> response</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">  <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">  <span class="keyword">if</span> (error.response) {</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) {</span><br><span class="line">      <span class="built_in">window</span>.alert(<span class="string">'未登录，即将跳转到登录页面'</span>)</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (error.response.status === <span class="number">500</span>) {</span><br><span class="line">      <span class="built_in">window</span>.app.$notify({</span><br><span class="line">        message: <span class="string">'服务器正忙，请稍后重试'</span>,</span><br><span class="line">        type: <span class="string">'danger'</span></span><br><span class="line">      })</span><br><span class="line">      <span class="comment">// window.alert('服务器正忙，请稍后重试')</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>修改页面标题<br><code>public\index.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"&lt;%= BASE_URL %&gt;favicon.ico"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>旅游网<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>添加滚动加载，请求失败，点击重新加载和下拉刷新，<br>在评论列表的场景添加<br><code>src\views\sight\SightComment.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点评论 --&gt;</span><br><span class="line">  &lt;div class="page-sight-comment"&gt;</span><br><span class="line">    &lt;van-pull-refresh v-model="refreshing" @refresh="onRefresh"&gt;</span><br><span class="line">      &lt;van-list</span><br><span class="line">        class="sight-comment"</span><br><span class="line">        v-model="loading"</span><br><span class="line">        :finished="finished"</span><br><span class="line">        finished-text="没有更多了"</span><br><span class="line">        :error.sync="error"</span><br><span class="line">        error-text="请求失败，点击重新加载"</span><br><span class="line">        @load="getCommentList"</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;comment-item v-for="item in commentList" :key="item.pk" :item="item" /&gt;</span><br><span class="line">      &lt;/van-list&gt;</span><br><span class="line">    &lt;/van-pull-refresh&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 评论列表</span><br><span class="line">      commentList: [],</span><br><span class="line">      // 当前的页码</span><br><span class="line">      currentPage: 1,</span><br><span class="line">      // 正在加载中</span><br><span class="line">      loading: false,</span><br><span class="line">      // 所有的内容加载完</span><br><span class="line">      finished: false,</span><br><span class="line">      // 请求失败</span><br><span class="line">      error: false,</span><br><span class="line">      // 是否正在下拉刷新中</span><br><span class="line">      refreshing: false</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 下拉刷新执行</span><br><span class="line">     */</span><br><span class="line">    onRefresh () {</span><br><span class="line">      // 清空数据</span><br><span class="line">      this.commentList = []</span><br><span class="line">      this.currentPage = 1</span><br><span class="line"></span><br><span class="line">      this.finished = false</span><br><span class="line">      this.error = false</span><br><span class="line"></span><br><span class="line">      // 重新加载数据</span><br><span class="line">      this.getCommentList()</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 评论列表</span><br><span class="line">     */</span><br><span class="line">    getCommentList () {</span><br><span class="line">      const url = SightApis.sightCommentUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url, {</span><br><span class="line">        params: {</span><br><span class="line">          page: this.currentPage</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data: { meta, objects } }) =&gt; {</span><br><span class="line">        this.commentList = this.commentList.concat(objects)</span><br><span class="line">        // 加载状态结束</span><br><span class="line">        this.loading = false</span><br><span class="line">        // 设置下一页的页码</span><br><span class="line">        this.currentPage = meta.current_page + 1</span><br><span class="line">        // 数据全部加载完成： 当前页面 == 总页数</span><br><span class="line">        if (meta.current_page === meta.page_count) {</span><br><span class="line">          this.finished = true</span><br><span class="line">        }</span><br><span class="line">        this.refreshing = false</span><br><span class="line">      }).catch(() =&gt; {</span><br><span class="line">        this.loading = false</span><br><span class="line">        this.error = true</span><br><span class="line">        this.refreshing = false</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">    // this.getCommentList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="实现图片列表接口"><a href="#实现图片列表接口" class="headerlink" title="实现图片列表接口"></a>实现图片列表接口</h3><p><code>src\views\sight\SightImage.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点图片 --&gt;</span><br><span class="line">  &lt;div class="page-sight-image"&gt;</span><br><span class="line">    &lt;!-- 顶部导航 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="景点图片" left-text="返回" left-arrow @click-left="goBack" /&gt;</span><br><span class="line">    &lt;!-- 图片列表 --&gt;</span><br><span class="line">    &lt;van-pull-refresh v-model="refreshing" @refresh="onRefresh"&gt;</span><br><span class="line">      &lt;van-list</span><br><span class="line">        class="sight-image"</span><br><span class="line">        v-model="loading"</span><br><span class="line">        :finished="finished"</span><br><span class="line">        finished-text="没有更多了"</span><br><span class="line">        :error.sync="error"</span><br><span class="line">        error-text="请求失败，点击重新加载"</span><br><span class="line">        @load="getImageList"</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;van-row&gt;</span><br><span class="line">          &lt;van-col span="12" v-for="(item, index) in imageList" :key="index"&gt;</span><br><span class="line">            &lt;van-image width="100%" height="100%" :src="item.img" @click="showPreview=true"/&gt;</span><br><span class="line">          &lt;/van-col&gt;</span><br><span class="line">        &lt;/van-row&gt;</span><br><span class="line">      &lt;/van-list&gt;</span><br><span class="line">    &lt;/van-pull-refresh&gt;</span><br><span class="line">    &lt;!-- //图片列表 --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 图片预览 --&gt;</span><br><span class="line">    &lt;van-image-preview v-model="showPreview" :images="imgUrlList" @change="onChange"&gt;</span><br><span class="line">      &lt;template v-slot:index&gt;第{{ index + 1 }}页 / 共{{ imageList.length }}张&lt;/template&gt;</span><br><span class="line">    &lt;/van-image-preview&gt;</span><br><span class="line">    &lt;!-- // 图片预览 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">export default {</span><br><span class="line">  components: {},</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 图片列表</span><br><span class="line">      imageList: [],</span><br><span class="line">      // 图片预览</span><br><span class="line">      index: 0,</span><br><span class="line">      showPreview: false,</span><br><span class="line">      // 当前的页码</span><br><span class="line">      currentPage: 1,</span><br><span class="line">      // 正在加载中</span><br><span class="line">      loading: false,</span><br><span class="line">      // 所有的内容加载完</span><br><span class="line">      finished: false,</span><br><span class="line">      // 请求失败</span><br><span class="line">      error: false,</span><br><span class="line">      // 是否正在下拉刷新中</span><br><span class="line">      refreshing: false</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 预览切换图片</span><br><span class="line">     */</span><br><span class="line">    onChange (index) {</span><br><span class="line">      this.index = index</span><br><span class="line">    },</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 下拉刷新执行</span><br><span class="line">     */</span><br><span class="line">    onRefresh () {</span><br><span class="line">      // 清空数据</span><br><span class="line">      this.imageList = []</span><br><span class="line">      this.currentPage = 1</span><br><span class="line"></span><br><span class="line">      this.finished = false</span><br><span class="line">      this.error = false</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 图片列表</span><br><span class="line">     */</span><br><span class="line">    getImageList () {</span><br><span class="line">      const url = SightApis.sightImageUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url, {</span><br><span class="line">        params: {</span><br><span class="line">          page: this.currentPage</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data: { meta, objects } }) =&gt; {</span><br><span class="line">        this.imageList = this.imageList.concat(objects)</span><br><span class="line">        // 加载状态结束</span><br><span class="line">        this.loading = false</span><br><span class="line">        // 设置下一页的页码</span><br><span class="line">        this.currentPage = meta.current_page + 1</span><br><span class="line">        // 数据全部加载完成： 当前页面 == 总页数</span><br><span class="line">        if (meta.current_page === meta.page_count) {</span><br><span class="line">          this.finished = true</span><br><span class="line">        }</span><br><span class="line">        this.refreshing = false</span><br><span class="line">      }).catch(() =&gt; {</span><br><span class="line">        this.loading = false</span><br><span class="line">        this.error = true</span><br><span class="line">        this.refreshing = false</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 图片地址</span><br><span class="line">     */</span><br><span class="line">    imgUrlList () {</span><br><span class="line">      return this.imageList.map(item =&gt; item.img)</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang="less"&gt;</span><br><span class="line">.page-sight-image {</span><br><span class="line">  padding: 5px;</span><br><span class="line">  .van-col {</span><br><span class="line">    padding: 5px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
