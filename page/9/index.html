<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;bubbleboy11.github.io&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/9/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/9/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<script data-pjax src="/js/load-config.js"></script>
  <title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">179</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/unittest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/unittest/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>unittest基于Java的流行测试框架Junit，通过使用unittest我们可以以结构化的方式编写大型而且周详的测试集。</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">help(<span class="string">'unittest'</span>)</span><br><span class="line">DESCRIPTION</span><br><span class="line">    Python unit testing framework, based on Erich Gamma<span class="string">'s JUnit and Kent Beck'</span>s</span><br><span class="line">    Smalltalk testing framework (used <span class="keyword">with</span> permission).</span><br><span class="line"></span><br><span class="line">    This module contains the core framework classes that form the basis of   </span><br><span class="line">    specific test cases <span class="keyword">and</span> suites (TestCase, TestSuite etc.), <span class="keyword">and</span> also a    </span><br><span class="line">    text-based utility <span class="class"><span class="keyword">class</span> <span class="title">for</span> <span class="title">running</span> <span class="title">the</span> <span class="title">tests</span> <span class="title">and</span> <span class="title">reporting</span> <span class="title">the</span> <span class="title">results</span> </span></span><br><span class="line"><span class="class">     (<span class="params">TextTestRunner</span>).</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">dir</span>(<span class="params">unittest</span>)</span></span><br><span class="line">[‘BaseTestSuite’, ‘FunctionTestCase’, ‘SkipTest’, ‘TestCase’, ‘TestLoader’, ‘TestProgram’, ‘TestResult’, ‘TestSuite’, ‘TextTestResult’, ‘TextTestRunner’, ‘_TextTestResult’, ‘all’, ‘builtins’, ‘doc’, ‘file’, ‘name’, ‘package’, ‘path’, ‘__unittest’, ‘_expectedFailureInRpmBuild’, ‘_skipInRpmBuild’, ‘case’, ‘defaultTestLoader’, ‘expectedFailure’, ‘findTestCases’, ‘getTestCaseNames’, ‘installHandler’, ‘loader’, ‘main’, ‘makeSuite’, ‘registerResult’, ‘removeHandler’, ‘removeResult’, ‘result’, ‘runner’, ‘signals’, ‘skip’, ‘skipIf’, ‘skipUnless’, ‘suite’, ‘util’]</span><br></pre></td></tr></tbody></table></figure>

<p>四大组件</p>
<ul>
<li><p>TestCase 测试用例<br>所有测试用例类继承的基本类。测试行为的最小单位，通过对一些输入输出值的对比来进行测试检查。放置测试步骤和检查点</p>
</li>
<li><p>TestLoader 测试加载器</p>
</li>
<li><p>负责根据各种各样的规则收集测试用例，并把这些测试用例包装在一个TestSuite中。</p>
</li>
<li><p>test fixture: 用来在多个用例之间分享的预置条件操作和清理操作，说白了就是setup和teardown的集合。<br>三种fixture类型</p>
<ul>
<li>setUp, tearDown每个测试类的用例都会执行</li>
<li>setUpClass, tearDownClass每个类的第一个用例被执行前和最后一个用例执行后被执行</li>
<li>setUpModule, tearDownModule每个测试模的第一个用例被执行前和最后一个用例执行后被执行</li>
</ul>
</li>
</ul>
<p>出现异常</p>
<ul>
<li><p>如果setup和teardown间的用例出现异常或者失败，teardown照样会被执行</p>
</li>
<li><p>如果setUpClass和setUpModule中出现异常，那么他们控制范围内的用例不会被执行，<br>并且对应的tearDownClass和tearDownModule也不会被执行</p>
</li>
<li><p>TestSuite 测试套件<br>组织测试用例的实例，支持测试用例的添加和删除，最终将传递给 testRunner进行测试执行。一个test suite由许多个TestCase组成，常见的情形是创建一个TestSuite的实例，然后向TestSuite实例添加测试用例TestCase实例，当所有测试添加之后，可以把TestSuite的实例传递给TextTestRunner，它会按照添加测试用例的顺序逐个去执行测试用例，并手机测试结果<br>一组测试用例的集合，用来管理和组织测试用例。</p>
</li>
<li><p>TextTestRunner<br>一个test runner类会以文本的形式显示结果，在它们运行时会打印测试名字，发生的错误，并且在测试运行结束之后打印结果概要。将测试用例或测试用例集合聚合起来的集合，批量执行，并且向用户提供测试结果。</p>
</li>
<li><p>TextTestResult<br>由TextTestRunner调用，会显示出格式化的文本。</p>
</li>
</ul>
<h3 id="unittest-模块使用的模式有三种，如下："><a href="#unittest-模块使用的模式有三种，如下：" class="headerlink" title="unittest 模块使用的模式有三种，如下："></a>unittest 模块使用的模式有三种，如下：</h3><ol>
<li>通过调用<code>unittest.main()</code>来执行模块里所有的测试用例</li>
<li>想要运行指定的用例需要将这些用例加入测试套件TestSuite中来运行，主要是4步<ul>
<li>新建一个测试套件TestSuite</li>
<li>将测试用例一个一个加入该TestSuite</li>
<li>新建一个TestRunner</li>
<li>用该TestRunner来运行TestSuite</li>
</ul>
</li>
<li>通过testloader运行测试集</li>
</ol>
<p>测试类必须继承自<code>unittest.TestCase</code><br>测试用例必须以小写test开头<br>断言函数需要通过测试类的self调用</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStringMethods</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_upper</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="string">'foo'</span>.upper(), <span class="string">'FOO'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isupper</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(<span class="string">'FOO'</span>.isupper())</span><br><span class="line">        self.assertFalse(<span class="string">'Foo'</span>.isupper())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_split</span>(<span class="params">self</span>):</span></span><br><span class="line">        s = <span class="string">'hello world'</span></span><br><span class="line">        self.assertEqual(s.split(), [<span class="string">'hello'</span>, <span class="string">'world'</span>])</span><br><span class="line">        <span class="comment"># check that s.split fails when the separator is not a string</span></span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(TypeError):</span><br><span class="line">            s.split(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Ran 3 tests in 0.001s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OK</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setUpModule</span>():</span></span><br><span class="line">    print(<span class="string">"setUpModule &gt;&gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tearDownModule</span>():</span></span><br><span class="line">    print(<span class="string">"tearDownModule &gt;&gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"setUpClass for Test1 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"tearDownClass for Test1 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试前需执行的操作</span></span><br><span class="line">        print(<span class="string">"setUp for Test1 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例执行完后所需执行的操作</span></span><br><span class="line">        print(<span class="string">"tearDown for Test1 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例1 具体的测试脚本</span></span><br><span class="line">        print(<span class="string">"testCase1 for Test1"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例2 具体的测试脚本</span></span><br><span class="line">        print(<span class="string">"testCase2 for Test1"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"setUpClass for Test2 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"tearDownClass for Test2 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"setUp for Test2 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"tearDown for Test2 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"testCase1 for Test2"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"testCase2 for Test2"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"><span class="comment"># setUpModule &gt;&gt;&gt;</span></span><br><span class="line"><span class="comment"># setUpClass for Test1 &gt;&gt;</span></span><br><span class="line"><span class="comment"># setUp for Test1 &gt;</span></span><br><span class="line"><span class="comment"># testCase1 for Test1</span></span><br><span class="line"><span class="comment"># tearDown for Test1 &gt;</span></span><br><span class="line"><span class="comment"># .setUp for Test1 &gt;</span></span><br><span class="line"><span class="comment"># testCase2 for Test1</span></span><br><span class="line"><span class="comment"># tearDown for Test1 &gt;</span></span><br><span class="line"><span class="comment"># .tearDownClass for Test1 &gt;&gt;</span></span><br><span class="line"><span class="comment"># setUpClass for Test2 &gt;&gt;</span></span><br><span class="line"><span class="comment"># setUp for Test2 &gt;</span></span><br><span class="line"><span class="comment"># testCase1 for Test2</span></span><br><span class="line"><span class="comment"># tearDown for Test2 &gt;</span></span><br><span class="line"><span class="comment"># .setUp for Test2 &gt;</span></span><br><span class="line"><span class="comment"># testCase2 for Test2</span></span><br><span class="line"><span class="comment"># tearDown for Test2 &gt;</span></span><br><span class="line"><span class="comment"># .tearDownClass for Test2 &gt;&gt;</span></span><br><span class="line"><span class="comment"># tearDownModule &gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Ran 4 tests in 0.002s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OK</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a, b</span>):</span></span><br><span class="line">        self.a = int(a)</span><br><span class="line">        self.b = int(b)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.a + self.b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCount</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"Test Start"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"Test End"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add1</span>(<span class="params">self</span>):</span></span><br><span class="line">        j = Count(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        self.assertEqual(j.add(), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add2</span>(<span class="params">self</span>):</span></span><br><span class="line">        j = Count(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">        self.assertEqual(j.add(), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 1. 新建测试套件</span></span><br><span class="line">    suite = unittest.TestSuite()</span><br><span class="line">    <span class="comment"># 2. 将用例加入测试套件</span></span><br><span class="line">    suite.addTest(TestCount(<span class="string">"test_add1"</span>))</span><br><span class="line">    suite.addTest(TestCount(<span class="string">"test_add2"</span>))</span><br><span class="line">    <span class="comment"># 3. 新建TestRunner</span></span><br><span class="line">    runner = unittest.TextTestRunner()</span><br><span class="line">    <span class="comment"># 4. 用TestRunner来执行TestSuite</span></span><br><span class="line">    runner.run(suite)</span><br><span class="line"><span class="comment"># Test Start</span></span><br><span class="line"><span class="comment"># Test End</span></span><br><span class="line"><span class="comment"># .Test Start</span></span><br><span class="line"><span class="comment"># Test End</span></span><br><span class="line"><span class="comment"># F</span></span><br><span class="line"><span class="comment"># ======================================================================</span></span><br><span class="line"><span class="comment"># FAIL: test_add2 (__main__.TestCount)</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment">#   File "c:/python代码/牛客网剑指offer66题思路 </span></span><br><span class="line"><span class="comment"># 分析/空.py", line 26, in test_add2</span></span><br><span class="line"><span class="comment">#     self.assertEqual(j.add(), 5)</span></span><br><span class="line"><span class="comment"># AssertionError: 6 != 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Ran 2 tests in 0.001s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FAILED (failures=1)    </span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest </span><br><span class="line"><span class="comment"># 执行测试的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UCTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment">#测试前需执行的操作</span></span><br><span class="line">        .....       </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment">#测试用例执行完后所需执行的操作</span></span><br><span class="line">        .....</span><br><span class="line"><span class="comment"># 测试用例1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCreateFolder</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment">#具体的测试脚本</span></span><br><span class="line">        ......     </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">testDeleteFolder</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="comment"># 具体的测试脚本</span></span><br><span class="line">If __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">       <span class="comment"># 构造测试集， 添加测试用例</span></span><br><span class="line">            suite = unittest.TestSuite()</span><br><span class="line">suite.addTest(UC7TestCase(<span class="string">"testCreateFolder"</span>))</span><br><span class="line">suite.addTest(UC7TestCase(<span class="string">"testDeleteFolder"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行测试， 构造runner。</span></span><br><span class="line">  runner = unittest.TextTestRunner()</span><br><span class="line">runner.run(suite)</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCase1</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment">#def setUp(self):</span></span><br><span class="line">    <span class="comment">#def tearDown(self):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'aaa'</span>      </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'bbb'</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">TestCase2</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment">#def setUp(self):</span></span><br><span class="line">    <span class="comment">#def tearDown(self):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'aaa1'</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'bbb1'</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment">#此用法可以同时测试多个类</span></span><br><span class="line">suite1=unittest.TestLoader().loadTestsFromTestCase(TestCase1) </span><br><span class="line">    suite2=unittest.TestLoader().loadTestsFromTestCase(TestCase2) </span><br><span class="line">suite = unittest.TestSuite([suite1, suite2]) </span><br><span class="line">unittest.TextTestRunner(verbosity=<span class="number">2</span>).run(suite)</span><br></pre></td></tr></tbody></table></figure>

<ol start="5">
<li>TestCase的用法<br>源文件widget.py，也即我们要进行单元测试的文件。很简单的一个类，该类可以设置长宽，并且能够获取这两个值。<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Widget</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, size=(<span class="params"><span class="number">40</span>, <span class="number">40</span></span>)</span>):</span></span><br><span class="line">         self._size = size</span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">get_size</span>(<span class="params">self</span>):</span></span><br><span class="line">         <span class="keyword">return</span> self._size</span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">resize</span>(<span class="params">self, width, height</span>):</span></span><br><span class="line">         <span class="keyword">if</span> width &lt; <span class="number">0</span> <span class="keyword">or</span> height &lt; <span class="number">0</span>:</span><br><span class="line">             <span class="keyword">raise</span> ValueError, <span class="string">'illegal size'</span></span><br><span class="line">             self._size = (width, height)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    widget = Widget()</span><br><span class="line">    <span class="keyword">print</span> widget.get_size()</span><br></pre></td></tr></tbody></table></figure>
因此，我们可以撰写的单元测试代码文件widgettest.py如下：</li>
</ol>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> widget <span class="keyword">import</span> Widget</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WidgetTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的初始化工作可以在setUp()方法中完成</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget = Widget()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的资源的释放则可以在tearDown()方法中完成</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget.dispose()</span><br><span class="line">        self.widget = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应widget类中的get_size函数测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_size</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(self.widget.get_size(), (<span class="number">40</span>, <span class="number">40</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应widget类中resize函数的测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_Resize</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget.resize(<span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">        self.assertEqual(self.widget.get_size(), (<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>

<p>其中有两个测试用例，分别为test_size, test_Resize， 在每个测试用例执行的过程中会首先执行setUp，然后执行测试用例，最后执行tearDown操作。每个测试用例的执行遵循相同的模式。<br>其中要注意的是setUp和tearDown两个，又称为测试装置，setUp完成对象的初始化动作，而tearDown则完成资源的释放之类的操作。<br>在实际工作中，最常见的实践仍是写一个测试类继承自unittest.TestCase，然后让每一个测试用例名称以test开头，在运行测试集合时使用unittest.main（）函数即可。自动化测试便是建立在这样的基础上。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/unittest-mo-kuai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/unittest-mo-kuai/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>可以在一个独立的文件里提供一个更全面的测试集</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStatisticalFunctions</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_average</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(average([<span class="number">20</span>, <span class="number">30</span>, <span class="number">70</span>]), <span class="number">40.0</span>)</span><br><span class="line">        self.assertEqual(round(average([<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>]), <span class="number">1</span>), <span class="number">4.3</span>)</span><br><span class="line">        self.assertRaises(ZeroDivisionError, average, [])</span><br><span class="line">        self.assertRaises(TypeError, average, <span class="number">20</span>, <span class="number">30</span>, <span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unittest.main()  <span class="comment"># Calling from the command line invokes all tests</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/yaml/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/yaml/" class="post-title-link" itemprop="url">yaml</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-11 04:28:17" itemprop="dateModified" datetime="2021-04-11T04:28:17Z">2021-04-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="yaml-YAML-Ain’t-Markup-Language"><a href="#yaml-YAML-Ain’t-Markup-Language" class="headerlink" title="yaml YAML Ain’t Markup Language"></a>yaml YAML Ain’t Markup Language</h1><p>YAML 不是标记语言 文本文件  它是一种数据格式语言，并且是JSON的超集。<br>与 JSON 不同，它可以存储更复杂的对象并引用其自己的元素，还可以编写注释，使其特别适合编写一些定义好不常修改的内容配置文件，<br><code>pip install --index-url https://pypi.tuna.tsinghua.edu.cn/simple/ pyyaml</code><br>不规定某一种文件或者key它对应的数据类型，从python的角度来说是字符串，但不需要加引号，当我们进行load的时候，python会对它进行额外的数据类型分析<br>yaml文件在读取后得到的是字典类型的数据</p>
<p>注意格式<code>muke.yaml</code></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># key-value</span></span><br><span class="line"><span class="attr">url:</span></span><br><span class="line">  <span class="string">https://www.imooc.com/</span></span><br><span class="line"><span class="comment"># 列表</span></span><br><span class="line"><span class="attr">types:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前沿</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">后端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">移动端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">云计算</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">运维</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ui</span></span><br><span class="line"><span class="comment"># 字典</span></span><br><span class="line"><span class="attr">python:</span></span><br><span class="line">  <span class="attr">web:</span> <span class="string">django</span></span><br><span class="line">  <span class="attr">spader:</span> <span class="string">bs5</span></span><br><span class="line"><span class="attr">a:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">b:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">c:</span> [<span class="string">a</span>, <span class="string">b</span>, <span class="string">c</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    result = yaml.load(data, Loader=yaml.FullLoader)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    result = read(<span class="string">'muke.yaml'</span>)  <span class="comment"># 传递相对路径</span></span><br><span class="line">    print(result)</span><br><span class="line">    <span class="comment"># {'url': 'https://www.imooc.com/', 'types': ['前沿', '前端', '后端', '移动端', '云计算', '运维', 'ui'], 'python': {'web': 'django', 'spader': 'bs5'}, 'a': 1, 'b': 2, 'c': ['a', 'b', 'c']} </span></span><br><span class="line">    print(type(result))</span><br><span class="line">    <span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">document = <span class="string">"""</span></span><br><span class="line"><span class="string">    a: 1</span></span><br><span class="line"><span class="string">    b:</span></span><br><span class="line"><span class="string">    c: 3</span></span><br><span class="line"><span class="string">    d: 4</span></span><br><span class="line"><span class="string">    ...: </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">print(yaml.load(document, Loader=yaml.FullLoader))</span><br><span class="line"><span class="comment"># {'a': 1, 'b': None, 'c': 3, 'd': 4, '...': None}</span></span><br><span class="line">print(type(yaml.load(document, Loader=yaml.FullLoader)))</span><br><span class="line"><span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(dir(yaml))</span><br><span class="line"><span class="comment"># ['AliasEvent', 'AliasToken', 'AnchorToken', 'BaseDumper', 'BaseLoader', 'BlockEndToken', 'BlockEntryToken', 'BlockMappingStartToken', 'BlockSequenceStartToken', 'CBaseDumper', 'CBaseLoader', 'CDumper', 'CFullLoader', 'CLoader', 'CSafeDumper', 'CSafeLoader', 'CUnsafeLoader', 'CollectionEndEvent', 'CollectionNode', 'CollectionStartEvent', 'DirectiveToken', 'DocumentEndEvent', 'DocumentEndToken', 'DocumentStartEvent', 'DocumentStartToken', 'Dumper', 'Event', 'FlowEntryToken', 'FlowMappingEndToken', 'FlowMappingStartToken', 'FlowSequenceEndToken', 'FlowSequenceStartToken', 'FullLoader', 'KeyToken', 'Loader', 'MappingEndEvent', 'MappingNode', 'MappingStartEvent', 'Mark', 'MarkedYAMLError', 'Node', 'NodeEvent', 'SafeDumper', 'SafeLoader', 'ScalarEvent', 'ScalarNode', 'ScalarToken', 'SequenceEndEvent', 'SequenceNode', 'SequenceStartEvent', 'StreamEndEvent', 'StreamEndToken', 'StreamStartEvent', 'StreamStartToken', 'TagToken', 'Token', 'UnsafeLoader', 'ValueToken', 'YAMLError', 'YAMLLoadWarning', 'YAMLObject', 'YAMLObjectMetaclass', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__', '__version__', '__with_libyaml__', '_warnings_enabled', 'add_constructor', 'add_implicit_resolver', 'add_multi_constructor', 'add_multi_representer', 'add_path_resolver', 'add_representer', 'compose', 'compose_all', 'composer', 'constructor', 'cyaml', 'dump', 'dump_all', 'dumper', 'emit', 'emitter', 'error', 'events', 'full_load', 'full_load_all', 'io', 'load', 'load_all', 'load_warning', 'loader', 'nodes', 'parse', 'parser', 'reader', 'representer', 'resolver', 'safe_dump', 'safe_dump_all', 'safe_load', 'safe_load_all', 'scan', 'scanner', 'serialize', 'serialize_all', 'serializer', 'tokens', 'unsafe_load', 'unsafe_load_all', 'warnings']</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/san-yuan-biao-da-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/san-yuan-biao-da-shi/" class="post-title-link" itemprop="url">三元表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>用简单的一行快速判断，而不是使用复杂的多行if语句。<br>condition_is_true if condition else condition_is_false<br>如果a&gt;b的结果为真，h=”变量1”,<br>如果为假，h=”变量2”</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">print(<span class="string">"变量1"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"变量2"</span>)  <span class="comment"># 变量2</span></span><br><span class="line">print(<span class="string">"True"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"False"</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="literal">True</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="literal">False</span>)  <span class="comment"># False</span></span><br><span class="line">print(a &gt; b)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">h = a - b <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> a + b</span><br><span class="line">print(h)  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">is_fat = <span class="literal">True</span></span><br><span class="line">state = <span class="string">"fat"</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">"not fat"</span></span><br><span class="line">print(state)  <span class="comment"># fat</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shi-wu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shi-wu/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Relational Database Management System 关系数据库管理系统<br>RDBMS=SQL语句+事务(ACID)</p>
<p>事务transaction：</p>
<ul>
<li>是数据库并发控制的基本单位</li>
<li>是一个或者多个sql语句、数据库逻辑操作组成的集合</li>
</ul>
<p>默认，mysql执行每条sql语句都会自动开启和提交事务<br>为了让多条sql语句纳入到一个事务之下，可以手动管理事务<br>START TRANSACTION;</p>
<p>例子转账了。假如小明要给小红转账1000元，这个转账会涉及到两个关键操作就是：将小明的余额减少1000元，将小红的余额增加1000元。万一在这两个操作之间突然出现错误比如银行系统崩溃，导致小明余额减少而小红的余额没有增加，这样就不对了。事务就是保证这两个关键操作要么都成功，要么都要失败。</p>
<ol>
<li>原子性(Atomicity)事务是最小的执行单位，不允许分割。一个事务中所有操作要么全部完成，要么全部失败。事务执行后，不允许停留在中间某个状态， </li>
<li>一致性(consistency)：事务开始和结束之后数据完整性没有被破坏，执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是相同的；</li>
<li>隔离性(Isolation)：允许多个事务同时对数据库修改和读写，事务不受其他并发事务的影响，如同在给定的时间内，该事务时数据库唯一运行的事务，各并发事务之间数据库是独立的；</li>
<li>持久性(Durability):事务一旦提交，它对数据库中数据的改变是持久的。即便发生宕机数据库发生故障也不应该对其有任何影响，仍然可以依靠事务日志完成数据的持久化</li>
</ol>
<p>事务与回滚：<br>COMMIT； 让redo日志与数据文件同步，事务的所有操作都会被持久化到数据库里面，提交了就会把事务操作下的结果同步<br>ROLLBACK;把该事务所有的数据都打上标记，这些数据全都不会同步到数据文件里面，不存在中间状态的数据<br>回滚：多个逻辑中某个操作出错，回到初始状态，一旦执行失败需要回滚操作来保持之前数据库的完整性）<br>rollback就是数据库里做修改后&nbsp;（update，insert，delete）未commit&nbsp;之前，使用rollback可以恢复数据到修改之前</p>
<p>事务处理<br>MySQL提供事务处理的表引擎, InnoDB<br>服务器层不管理事务，由下层的引擎实现，所以同一个事务中，使用多种存储引擎不靠谱。比如在操纵两张表时候做一个事务，不能是一张表InnoDB另一张表MyISAM，这样事务是做不成功的。需要两张表都是InnoDB。</p>
<p>在非事务的表上执行事务操作 MySQL不会发出提醒，也不会报错，如：在MyISAM表上做事务处理。</p>
<p>举例说明数据库事务的使用场景以及注意事项<br>在操纵(增删改)重要数据时，如：钱款等。需要开启事务。<br>注意事项：事务的隔离级别越高安全性就越高，但并发就越低，这就需要选择合适的隔离级别。</p>
<p>事务的并发控制可能产生哪些问题<br>在典型的应用程序中，多个事务并发运行，经常会操作相同的数据来完成各自的任务（多个用户对统一数据进行操作）。并发虽然是必须的，如果不对事务进行并发控制,可能会产生四种异常情况</p>
<ul>
<li><p>幻读(phantom read):在同一个事务第二次查出现第一次没有的结果，说明别的事务已经插入一些数据<br>幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，</p>
</li>
<li><p>非重复读( nonrepeatable read):一个事务重复读两次得到不同结果，说明读取操作结果是不可重复的。<br>指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</p>
</li>
<li><p>脏读(dirty read):一个事务读取到另一个事务没有提交的修改，就是当另一个事务它还没有提交修改一个事务就读取到了修改。当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。</p>
</li>
<li><p>丢失修改(lost update)：并发写入造成其中一些修改丢失。<br>指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。</p>
</li>
</ul>
<p>Transaction 示例：Python的ORM框架SQLALchemy代码</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">session.begin()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    item1 =session.query(Item).get(<span class="number">1</span>)</span><br><span class="line">    item2 =session.query(Item).get(<span class="number">2</span>)</span><br><span class="line">    item1.foo = <span class="string">'bar'</span></span><br><span class="line">    item2.bar = <span class="string">'foo'</span></span><br><span class="line">    session.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    session.rollback()</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></tbody></table></figure>

<p>把10部门中manager员工调往20部门，其他岗位的员工调往30部门，然后删除10部门 </p>
<p>为了解决并发控制可能产生的异常问题，数据库定义了<br>四种事务的隔离级别</p>
<ul>
<li><p>读未提交(read uncommitted)：别的事务可以读取到未提交改变</p>
</li>
<li><p>读已提交(read committed)：只能读取已经提交的数据</p>
</li>
<li><p>可重复读(repeatable read)：同一个事务先后查询结果一样，Mysql InnoDB默认实现可重复读级别。</p>
</li>
<li><p>可串行化(Serializable)：事务完全串行化的执行，隔离级别最高，执行效率最低。相当于把数据库在一个事务执行的时候完全锁住，等它执行完才能执行下一个。</p>
<p>  ① 读取未提交( Read Uncommitted )</p>
<pre><code>   读未提交是隔离级别最低的一种事务级别。在这种隔离级别下，一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据，这就是脏读（Dirty Read）。
</code></pre>
<p> ② 读取已提交( Read Committed )</p>
<pre><code>  在 Read Committed 隔离级别下，一个事务可能会遇到不可重复读（Non Repeatable Read）的问题。不可重复读是指，在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致。
</code></pre>
<p>③ 可重复读取( Repeatable Read )</p>
<pre><code>  在Repeatable Read隔离级别下，一个事务可能会遇到幻读（Phantom Read）的问题。幻读是指，在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。幻读就是没有读到的记录，以为不存在，但其实是可以更新成功的，并且，更新成功后，再次读取，就出现了。
</code></pre>
<p>④ 可串行化、序列化( Serializable )</p>
<pre><code>  Serializable 是最严格的隔离级别。在Serializable隔离级别下，所有事务按照次序依次执行，因此，脏读、不可重复读、幻读都不会出现。

 虽然 Serializable 隔离级别下的事务具有最高的安全性，但是，由于事务是串行执行，所以效率会大大下降，应用程序的性能会急剧降低。如果没有特别重要的情景，一般都不会使用Serializable隔离级别。

  默认隔离级别：如果没有指定隔离级别，数据库就会使用默认的隔离级别。在MySQL中，如果使用 InnoDB，默认的隔离级别是Repeatable Read。
</code></pre>
</li>
</ul>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;<br>读取其他事务未提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;<br>只能读取其他事务提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>事务在执行中反复读取数据，得到的结果是一致的，不会受其他事务影响</p>
<p>START TRANSACTION;<br>UPDATE t_emp set sal=1;<br>COMMIT;<br>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>START TRANSACTION;<br>SELECT empno, ename, sal FROM t_emp;<br>COMMIT;<br>ROLLBACK;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL live SERIALIZABLE;<br>由于事务并发执行所带来的各种问题，前三种隔离级别只适用在某些业务场景中，但是序列化的隔离性，让事务逐一执行，就不会产生上述问题了。</p>
<p>如何解决高并发场景下的插入重复<br>高并发场景下，写入数据库会有数据重复问题</p>
<ol>
<li><p>使用数据库的唯一索引，就是不允许某些字段重复，如果重复数据库就会抛出一个异常出来，这样就知道那些数据重复了，直接把这个异常忽略掉就可以，这样就可以实现非重复插入。虽然好用但有些场景没有办法实现，如已经做了分库分表，这个时候就要使用队列去执行一个异步写入。</p>
</li>
<li><p>使用队列异步写入，其实很多高并发问题都可以通过缓存和队列去解决。</p>
</li>
<li><p>使用 redis 等实现分布式锁，这样就可以在插入的时候持有这个锁，插入完成之后再去释放这个锁。</p>
</li>
</ol>
<p>并发控制也是通过行锁或者表锁实现的。通过事务再读取或者写入的时候加入一些表锁或者行锁就可以实现不同并发控制的等级。</p>
<p>悲观锁是先获取锁再进行操作。一锁二查三更新 select for update</p>
<p>乐观锁是先修改，更新的时候发现数据已经变了就回滚(check and set)，乐观锁一般通过版本号或者时间戳实现</p>
<p>使需要根据响应速度、冲突频率、重试代价来判断使用哪一种</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/wei-yun-suan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/wei-yun-suan/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>位运算符是把数字看作二进制来进行计算的</p>
<figure class="highlight plain"><figcaption><span>按位与运算符：参与运算的两个值，如果两个相应位都为1，则该位的结果为1，否则为0</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">print(0b110 &amp; 0b011)   # 2，即0b010</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight plain"><figcaption><span>按位或运算符：只要对应的二个二进位有一个为1时，结果位就为1。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```py</span><br><span class="line">print(0b110 | 0b101)  # 7,即0b111</span><br><span class="line">print(-0b001 | 0b101)  # -1</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>按位取反运算符：对数据的每个二进制位取反，即把1变为0，把0变为1，包括符号位</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- 正数各位取反变为负数，显示时转化为其补码</span><br><span class="line">- 负数本身需要先转换为补码（符号位不变，各位取反再加 1），再对其补码进行各位取反</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">print(~0b101)  # 2，即0b010</span><br><span class="line">print(~5)  # -6</span><br></pre></td></tr></tbody></table></figure>

<p>5 的二进制为 0101，<br>~5 正数取反</p>
<ul>
<li>（1）各位取反，1010，最高位为1是负数</li>
<li>（2）负数转化为其补码<br>符号位保持不变，各位取反 1101，再加1，1110，也即 -6</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">print(~<span class="number">-3</span>)  <span class="comment"># 2</span></span><br><span class="line">print(~(<span class="number">-3</span>))  <span class="comment"># 2</span></span><br><span class="line">print(~(<span class="number">-5</span>))  <span class="comment"># 4</span></span><br><span class="line">``` </span><br><span class="line"><span class="number">-3</span> <span class="number">10.</span>.<span class="number">.011</span>，负数存储的是其补码：</span><br><span class="line">- <span class="number">-3</span> 的补码是：<span class="number">11.</span>.<span class="number">.101</span></span><br><span class="line">- ~(<span class="number">-5</span>)将其各位取反（包括符号位），也即 <span class="number">00.</span>.<span class="number">.010</span>（<span class="number">2</span>）</span><br><span class="line"><span class="number">-5</span>的原码是    <span class="number">10.</span>.<span class="number">.011</span></span><br><span class="line"><span class="number">-5</span>的反码是    <span class="number">11.</span>.<span class="number">.100</span></span><br><span class="line">           + <span class="number">00.</span>.<span class="number">.001</span> </span><br><span class="line"><span class="number">-5</span>的补码    = <span class="number">11.</span>.<span class="number">.101</span></span><br><span class="line">对其补码取反 = <span class="number">00.</span>.<span class="number">.010</span>（<span class="number">2</span>）</span><br><span class="line"></span><br><span class="line"><span class="number">-5</span> <span class="number">10.</span>.<span class="number">.101</span>，负数存储的是其补码：</span><br><span class="line">- <span class="number">-5</span> 的补码是：<span class="number">1011</span></span><br><span class="line">- ~(<span class="number">-5</span>)将其各位取反（包括符号位），也即 <span class="number">00.</span>.<span class="number">.100</span>（<span class="number">4</span>）</span><br><span class="line"><span class="number">-5</span>的原码是    <span class="number">10.</span>.<span class="number">.101</span></span><br><span class="line"><span class="number">-5</span>的反码是    <span class="number">11.</span>.<span class="number">.010</span></span><br><span class="line">           + <span class="number">00.</span>.<span class="number">.001</span> </span><br><span class="line"><span class="number">-5</span>的补码    = <span class="number">11.</span>.<span class="number">.011</span></span><br><span class="line">对其补码取反 = <span class="number">00.</span>.<span class="number">.100</span>（<span class="number">4</span>）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```^``` 按位异或运算符：当两对应的二进位相异时，结果为<span class="number">1</span></span><br><span class="line">```py</span><br><span class="line">print(<span class="number">0b111</span> ^ <span class="number">0b111</span>)  <span class="comment"># 0</span></span><br><span class="line">print(<span class="number">0b100</span> ^ <span class="number">0b111</span>)  <span class="comment"># 3</span></span><br><span class="line">print(<span class="number">0b1010</span> ^ <span class="number">0b1111</span>)  <span class="comment"># 5，即0b0101</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><figcaption><span>左移运算符：运算数的各二进位全部左移若干位，</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    由"&lt;&lt;"右边的数指定移动的位数，高位丢弃，低位补0。</span><br><span class="line"></span><br><span class="line">左移操作相当于乘以2**n</span><br><span class="line">负数的左移 </span><br><span class="line">```py</span><br><span class="line">print(0b11 &lt;&lt; 2)  # 12, 即0b1100</span><br><span class="line">print(-2 &lt;&lt; 2)  # -8</span><br></pre></td></tr></tbody></table></figure>
<p>-2的原码是  10000000000000000000000000000010（32位系统），<br>-2的反码是  11111111111111111111111111111101，<br>其补码为    11111111111111111111111111111110，<br>左移2位变为 11111111111111111111111111111000，<br>再转化为原码 10000000000000000000000000001000，<br>也就是-8，也就是-2*(2**2)=-8</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">5</span> &lt;&lt; <span class="number">3</span>)  <span class="comment"># 40</span></span><br></pre></td></tr></tbody></table></figure>
<p>相当于5(2*3)=40。</p>
<figure class="highlight plain"><figcaption><span>右移运算符：把"&gt;&gt;"左边的运算数的各二进位全部右移若干位，</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   "&gt;&gt;"右边的数指定移动的位数</span><br><span class="line">相当于除以2**n，</span><br><span class="line">如果符号位为0，则右移后高位补0，如果符号位为1，则高位补1；</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">print(0b11 &gt;&gt; 1)  # 1, 即0b1</span><br><span class="line">print(5 &gt;&gt; 1)  # 2，即0b10</span><br><span class="line">print(-8 &gt;&gt; 3)  # -1 </span><br></pre></td></tr></tbody></table></figure>
<p>先转化为补码再进行计算，<br>以-8 &gt;&gt; 3为例，<br>-8的原码为10…01000,<br>-8的反码为11…10111,<br>-8的补码为11…11000,<br>右移3位变为11…11111,<br>相应的原码为10…01，即-1。<br>8/(2**3)=1</p>
<p>-1的源码10…01<br>-1的反码11…10<br>-1的补码11…11</p>
<p>假如n=10转换二进制为0000 1010，<br>1的二进制为0000 0001<br>把n转换成二进制，然后看n二进制的最后一位，<br>如果最后一位为1的话，结果就是1，如果最后一位是0的话，那就是0。<br>&amp; 相当于AND<br>因为2的倍数的二进制最后一位都是0，</p>
<blockquote>
<p>所以n &amp; 0x1表达式跟n%2都能判断n是为奇数还是偶数</p>
</blockquote>
<p>变换符号位 ~n + 1</p>
<pre class=" language-python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">60</span>  <span class="token comment" spellcheck="true"># 60 = 0011 1100</span>
b <span class="token operator">=</span> <span class="token number">13</span>  <span class="token comment" spellcheck="true"># 13 = 0000 1101</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 12 = 0000 1100</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 61 = 0011 1101</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 49 = 0011 0001</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># -61 = 1100 0011</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 240 = 1111 0000  向左移动两位</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 15 = 0000 1111</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 52 = 0011 0100  向左移动两位</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 3 = 0000 0011</span>
```




</code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/yuan-lei-he-shi-yong-chang-jing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/yuan-lei-he-shi-yong-chang-jing/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-04 09:44:15" itemprop="dateModified" datetime="2021-04-04T09:44:15Z">2021-04-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="元类-Meta-Class-是创建类的类。元类创建类，然后类再去创建实例。"><a href="#元类-Meta-Class-是创建类的类。元类创建类，然后类再去创建实例。" class="headerlink" title="元类 (Meta Class)是创建类的类。元类创建类，然后类再去创建实例。"></a>元类 (Meta Class)是创建类的类。元类创建类，然后类再去创建实例。</h3><ul>
<li>元类允许我们控制类的生成，比如修改类的属性等</li>
<li>使用 type 来定义一个元类</li>
<li>元类最常见的一个使用场景就是 ORM 框架。</li>
</ul>
<ol>
<li>type的等价使用</li>
</ol>
<p>（1）没有方法时type等价使用</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">x</span>:</span></span><br><span class="line">    a = <span class="number">1</span>    </span><br></pre></td></tr></tbody></table></figure>
<p>等价于<br>类的名字x, 类的基类object，类的属性dict</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = type(<span class="string">'x'</span>, (object,), dict(a=<span class="number">1</span>))  <span class="comment"># 类的属性保存在字典里面因此这里用dict</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span>(<span class="params">Base</span>):</span>  <span class="comment"># 继承Base</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 等价定义，注意Base后加上逗号，否则就不是tuple了</span></span><br><span class="line">SameChild == type(<span class="string">'Child'</span>, (Base,), {})</span><br></pre></td></tr></tbody></table></figure>

<p>（2）有方法的type等价使用</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 加上方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildWithMethod</span>(<span class="params">Base</span>):</span></span><br><span class="line">    bar = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span> </span><br><span class="line">    print(<span class="string">'hello'</span>)</span><br><span class="line">``` </span><br><span class="line">```python </span><br><span class="line"><span class="comment"># 等价定义，方法用的类外面hello方法</span></span><br><span class="line">ChildWithMethod = type(      </span><br><span class="line">    <span class="string">'ChildWithMethod'</span>, (Base,), {<span class="string">'bar'</span>:<span class="literal">True</span>, <span class="string">'hello'</span>:hello}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>元类 作用 控制类生成实例之前就把里面的属性变成小写,<br>   Python中 <strong>new</strong> 生成实例，<strong>init</strong> 初始化实例<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 元类继承自 type</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LowercaseMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="string">''' 修改类的属性名称为小写的元类 '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">mcs, name, bases, attrs</span>):</span>    <span class="comment"># 生成实例</span></span><br><span class="line">        lower_attrs = {}    <span class="comment"># 定义字典</span></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():   <span class="comment"># 遍历类所有属性，把非内置方法(魔术方法)都改成小写</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> k.startswith(<span class="string">'__'</span>):   <span class="comment"># 排除magic method魔术方法</span></span><br><span class="line">                lower_attrs[k.lower()] = v  <span class="comment"># 方法名变成小写</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lower_attrs[k] = v</span><br><span class="line">            <span class="comment"># 当前类mcs,名称name,基类bases,当前属性lower_attrs</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(mcs, name, bases, lower_attrs)</span><br><span class="line">            </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LowercaseClass</span>(<span class="params">metaclass=LowercaseMeta</span>):</span> <span class="comment"># py3</span></span><br><span class="line">    BAR = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">HELLO</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">    </span><br><span class="line">print(dir(LowercaseClass))  <span class="comment"># 你会发现“BAR”和“HELLO”都变小了</span></span><br><span class="line"><span class="comment"># 用一个类的实例调用hello方法，修改了类定义时候的属性名称！！！</span></span><br><span class="line">LowercaseClass().hello()</span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>输出结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__',</span></span><br><span class="line"><span class="comment"># '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__',</span></span><br><span class="line"><span class="comment"># '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__',</span></span><br><span class="line"><span class="comment"># '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__',</span></span><br><span class="line"><span class="comment"># 'bar', 'hello']</span></span><br><span class="line"><span class="comment"># hello</span></span><br></pre></td></tr></tbody></table></figure>
<p>metaclass一般翻译成“元类”，但也有人认为应该更关注元类“超越变形”的能力，应该翻译成超越类之类的。但是个人觉得“元类”比较顺口，其“本元”的含义也是实打实存在的，故本文用元类作为metaclass的中文翻译。</p>
<p>metaclass(元类)可以理解成是类的抽象、本元。类元编程即使用自定义metaclass获取极强灵活性的一种编程方式。</p>
<p>不过，在多处都有提到的需要注意的是：如果不是开发框架，不要使用元类，除非只是为了寻找乐趣：）。</p>
<p>什么是本元？<br>首先还是要搞清楚什么是本元？这个概念很抽象，必须弄清楚。</p>
<p>本元可以理解成一种更高程度的抽象。首先，类（class）是对象（object）的抽象，对象是类的实例。因此可以说类是对象的本元。而在python中，所有类都是type类的实例，也就是说type是所有类的抽象，所以你可以理解type就是那个元类。</p>
<p>type<br>一般我们会常用type(obj)来获取obj对象的类型。但type也可以用来创建新类型。这时需要传入三个参数：类名、父类tuple、属性字典。</p>
<p>class MyClass: … 等价于MyClass = type(classname, superclasses, attributedict)</p>
<p>class SuperCls:<br>    def <strong>init</strong>(self):<br>        print(“<strong>init</strong> in super class.”)</p>
<p>class A(SuperCls):<br>    pass</p>
<p>B = type(“B”, (SuperCls, ), {})</p>
<p>a = A()</p>
<h1 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>init</strong> in super class.<br>“””</p>
<p>b = B()</p>
<h1 id="输出-1"><a href="#输出-1" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>init</strong> in super class.<br>“””</p>
<p>print(A.mro())</p>
<h1 id="输出-2"><a href="#输出-2" class="headerlink" title="输出"></a>输出</h1><p>“””<br>[&lt;class ‘__main__.A’&gt;, &lt;class ‘__main__.SuperCls’&gt;, &lt;class ‘object’&gt;]<br>“””</p>
<p>print(B.mro())</p>
<h1 id="输出-3"><a href="#输出-3" class="headerlink" title="输出"></a>输出</h1><p>“””<br>[&lt;class ‘__main__.B’&gt;, &lt;class ‘__main__.SuperCls’&gt;, &lt;class ‘object’&gt;]<br>“””<br>上面类对象的mro()方法代表Method Resolution Order，即方法解析顺序，可以看到这个类的继承顺序。</p>
<p>通过上面的代码可以看出，使用type来动态创建类和你自己写代码创建一个类是完全一样的。</p>
<p>还有个问题，当我们使用type的时候，它自己是个type类还是type对象？如果你直接在解释器中输入print(type)会得到返回&lt;class ‘type’&gt;，因此可以认为你使用的就是type类。</p>
<p>MetaClass<br>OK，搞清楚了什么是“本元”和type，我们再来看metaclass。</p>
<h1 id="自定义metaclass"><a href="#自定义metaclass" class="headerlink" title="自定义metaclass"></a>自定义metaclass</h1><p>class MyMeta(type):<br>    def <strong>call</strong>(self, <em>args, **kwargs):<br>        print(“<strong>call</strong> in MyMeta”)<br>        return super().<strong>call</strong>(*args, *</em>kwargs)</p>
<pre><code>def __init__(cls, what, bases=None, dict=None):
    print("__init__ in MyMeta")
    super().__init__(what, bases, dict)

def __new__(*args, **kwargs):
    print("__new__ in MyMeta")
    return type.__new__(*args, **kwargs)
</code></pre>
<p>class SuperCls:<br>    pass</p>
<h1 id="使用metaclass方法1：类定义代码中指定"><a href="#使用metaclass方法1：类定义代码中指定" class="headerlink" title="使用metaclass方法1：类定义代码中指定"></a>使用metaclass方法1：类定义代码中指定</h1><p>class MyClass(SuperCls, metaclass=MyMeta):<br>    pass</p>
<h1 id="输出-4"><a href="#输出-4" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>new</strong> in MyMeta<br><strong>init</strong> in MyMeta<br>“””</p>
<h1 id="使用metaclass方法2：直接像调用type那样调用MyMeta"><a href="#使用metaclass方法2：直接像调用type那样调用MyMeta" class="headerlink" title="使用metaclass方法2：直接像调用type那样调用MyMeta"></a>使用metaclass方法2：直接像调用type那样调用MyMeta</h1><p>MyClass = MyMeta(“MyClass”, (SuperCls, ), {})</p>
<h1 id="输出-5"><a href="#输出-5" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>new</strong> in MyMeta<br><strong>init</strong> in MyMeta<br>“””</p>
<h1 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h1><p>my_obj = MyClass()</p>
<h1 id="输出-6"><a href="#输出-6" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>call</strong> in MyMeta<br>“””<br>看，我们的元类继承自type类。你在使用这个元类去定义一个新的类时，会调用元类的__new__和__init__；当你用这个新类去实例化一个新对象时又会调用元类的__new__。</p>
<p>因此，你可以可以重载type的这三个方法来修改type的行为，但要理清这几个方法被调用的时机：</p>
<p><strong>init</strong>(cls, what, bases=None, dict=None)<br><strong>new</strong>(<em>args, **kwargs)<br><strong>call</strong>(self, *args, *</em>kwargs)<br>典型案例<br>来看几个类元编程的典型案例。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Singleton单例模式</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls.instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls.instance = super(SingletonMeta, cls).__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CurrentUser</span>(<span class="params">object, metaclass=SingletonMeta</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name=None</span>):</span></span><br><span class="line">        super(CurrentUser, self).__init__()</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> repr(self) + <span class="string">":"</span> + repr(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    u = CurrentUser(<span class="string">"liu"</span>)</span><br><span class="line">    print(u)</span><br><span class="line">    u2 = CurrentUser()</span><br><span class="line">    u2.name = <span class="string">"xin"</span></span><br><span class="line">    print(u2)</span><br><span class="line">    print(u)</span><br><span class="line">    <span class="keyword">assert</span> u <span class="keyword">is</span> u2</span><br></pre></td></tr></tbody></table></figure>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://github.com/Meteorix/python-design-patterns">https://github.com/Meteorix/python-design-patterns</a> 。</p>
<p>这里重载的是type的__call__方法。改变了用户类实例化的行为，使其只能得到唯一的实例。</p>
<p>简易ORM框架<br>class Field(object):<br>    def <strong>init</strong>(self, name, column_type):<br>        self.name = name<br>        self.column_type = column_type</p>
<pre><code>def __str__(self):
    return '&lt;%s:%s&gt;' % (self.__class__.__name__, self.name)
</code></pre>
<p>class StringField(Field):<br>    def <strong>init</strong>(self, name):<br>        super().<strong>init</strong>(name, ‘varchar(100)’)</p>
<p>class IntegerField(Field):<br>    def <strong>init</strong>(self, name):<br>        super().<strong>init</strong>(name, ‘bigint’)</p>
<p>class ModelMetaclass(type):<br>    def <strong>new</strong>(cls, name, bases, attrs):<br>        if name == ‘Model’:<br>            return type.<strong>new</strong>(cls, name, bases, attrs)<br>        print(‘Found model: %s’ % name)<br>        mappings = dict()<br>        for k, v in attrs.items():<br>            if isinstance(v, Field):<br>                print(‘Found mapping: %s ==&gt; %s’ % (k, v))<br>                mappings[k] = v<br>        for k in mappings.keys():<br>            attrs.pop(k)<br>        attrs[‘<strong>mappings</strong>‘] = mappings  # 保存属性和列的映射关系<br>        attrs[‘<strong>table</strong>‘] = name  # 假设表名和类名一致<br>        return type.<strong>new</strong>(cls, name, bases, attrs)</p>
<p>class Model(dict, metaclass=ModelMetaclass):<br>    def <strong>init</strong>(self, **kw):<br>        super(Model, self).<strong>init</strong>(**kw)</p>
<pre><code>def __getattr__(self, key):
    try:
        return self[key]
    except KeyError:
        raise AttributeError(r"'Model' object has no attribute '%s'" % key)

def __setattr__(self, key, value):
    self[key] = value

def save(self):
    fields = []
    params = []
    args = []
    for k, v in self.__mappings__.items():
        fields.append(v.name)
        params.append('?')
        args.append(getattr(self, k, None))
    sql = 'insert into %s (%s) values (%s)' % (self.__table__, ','.join(fields), ','.join(params))
    print('SQL: %s' % sql)
    print('ARGS: %s' % str(args))
</code></pre>
<p>class User(Model):<br>    # 定义类的属性到列的映射：<br>    id = IntegerField(‘id’)<br>    name = StringField(‘username’)<br>    email = StringField(‘email’)<br>    password = StringField(‘password’)</p>
<h1 id="创建一个实例："><a href="#创建一个实例：" class="headerlink" title="创建一个实例："></a>创建一个实例：</h1><p>u = User(id=12345, name=’Michael’, email=’test@orm.org’, password=’my-pwd’)</p>
<h1 id="保存到数据库："><a href="#保存到数据库：" class="headerlink" title="保存到数据库："></a>保存到数据库：</h1><p>u.save()</p>
<h1 id="输出-7"><a href="#输出-7" class="headerlink" title="输出"></a>输出</h1><p>“””<br>Found model: User<br>Found mapping: id ==&gt; <a href="IntegerField:id">IntegerField:id</a><br>Found mapping: name ==&gt; <a href="StringField:username">StringField:username</a><br>Found mapping: email ==&gt; <a href="StringField:email">StringField:email</a><br>Found mapping: password ==&gt; <a href="StringField:password">StringField:password</a><br>SQL: insert into User (id,username,email,password) values (?,?,?,?)<br>ARGS: [12345, ‘Michael’, ‘test@orm.org’, ‘my-pwd’]<br>“””<br>注：代码来自 <a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072">https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072</a></p>
<p>这里重载的是type的__new__方法，因此改变的是用户类在定义时的行为。这里用户类是一个数据模型，元类编程做的是在用户定义一个数据模型类的时候，把所有是Field类型的属性收集起来，统一放到mapping属性中。这样基类的方法save可以直接通过mapping属性来保存需要保存的Field属性们。</p>
<p>YAMLObject<br>class YAMLObjectMetaclass(type):<br>  def <strong>init</strong>(cls, name, bases, kwds):<br>    super(YAMLObjectMetaclass, cls).<strong>init</strong>(name, bases, kwds)<br>    if ‘yaml_tag’ in kwds and kwds[‘yaml_tag’] is not None:<br>      cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)</p>
<h1 id="省略其余定义"><a href="#省略其余定义" class="headerlink" title="省略其余定义"></a>省略其余定义</h1><p>class YAMLObject(metaclass=YAMLObjectMetaclass):<br>    yaml_loader = Loader</p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>class Monster(yaml.YAMLObject):<br>  yaml_tag = u’!Monster’<br>  def <strong>init</strong>(self, name, hp, ac, attacks):<br>    self.name = name<br>    self.hp = hp<br>    self.ac = ac<br>    self.attacks = attacks<br>  def <strong>repr</strong>(self):<br>    return “%s(name=%r, hp=%r, ac=%r, attacks=%r)” % (<br>       self.<strong>class</strong>.<strong>name</strong>, self.name, self.hp, self.ac,<br>       self.attacks)</p>
<p>yaml.load(“””<br>— !Monster<br>name: Cave spider<br>hp: [2,6]    # 2d6<br>ac: 16<br>attacks: [BITE, HURT]<br>“””)</p>
<p>Monster(name=’Cave spider’, hp=[2, 6], ac=16, attacks=[‘BITE’, ‘HURT’])</p>
<p>print yaml.dump(Monster(<br>    name=’Cave lizard’, hp=[3,6], ac=16, attacks=[‘BITE’,’HURT’]))</p>
<h1 id="输出-8"><a href="#输出-8" class="headerlink" title="输出"></a>输出</h1><p>“””<br>!Monster<br>ac: 16<br>attacks: [BITE, HURT]<br>hp: [3, 6]<br>name: Cave lizard<br>“””<br>这里重载的是type的__init__方法，因此改变的是用户类在定义时的行为。在定义了用户类Monster时，便通过cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)将Monster类注册到系统。</p>
<p>PyText<br>class ComponentMeta(type):<br>    def <strong>new</strong>(metacls, typename, bases, namespace):<br>        if “Config” not in namespace:<br>            # We need to dynamically create a new Config class per<br>            # instance rather than inheriting a single empty config class<br>            # because components are registered uniquely by config class.<br>            # If a parent class specifies a config class, inherit from it.<br>            parent_config = next(<br>                (base.Config for base in bases if hasattr(base, “Config”)), None<br>            )<br>            if parent_config is not None:</p>
<pre><code>            class Config(parent_config):
                pass

        else:

            class Config(ConfigBase):
                pass

        namespace["Config"] = Config

    component_type = next(
        (
            base.__COMPONENT_TYPE__
            for base in bases
            if hasattr(base, "__COMPONENT_TYPE__")
        ),
        namespace.get("__COMPONENT_TYPE__"),
    )
    new_cls = super().__new__(metacls, typename, bases, namespace)

    new_cls.Config.__COMPONENT_TYPE__ = component_type
    new_cls.Config.__name__ = f"{typename}.Config"
    new_cls.Config.__COMPONENT__ = new_cls
    new_cls.Config.__EXPANSIBLE__ = namespace.get("__EXPANSIBLE__")
    if component_type:
        Registry.add(component_type, new_cls, new_cls.Config)
    return new_cls
</code></pre>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://github.com/facebookresearch/pytext/blob/351a060b479cbfe1db46b74f1fc975a5b6523122/pytext/config/component.py#L87">https://github.com/facebookresearch/pytext/blob/351a060b479cbfe1db46b74f1fc975a5b6523122/pytext/config/component.py#L87</a></p>
<p>这里重载的是type的__new__方法，因此改变的是用户类在定义时的行为。在定义了用户组件类时，便通过Registry.add(component_type, new_cls, new_cls.Config)将该组件类注册到系统。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span>(<span class="params">yaml.YAMLObject</span>):</span></span><br><span class="line">    yaml_tag = <span class="string">"Monster"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, hp, ac, attacks</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.hp = hp</span><br><span class="line">        self.ac = ac</span><br><span class="line">        self.attacks = attacks</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"{}(name = {}, hp = {}, ac = {}, attacks = {}"</span>.format(self.__class__.__name__, self.name, self.hp, self.ac, self.attacks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    Monster(name = <span class="string">"zym"</span>, hp = [<span class="number">2</span>, <span class="number">6</span>], ac = <span class="number">16</span>, attacks = [<span class="string">"BITE"</span>, <span class="string">"HURT"</span>])</span><br><span class="line">    print(yaml.dump(Monster(name = <span class="string">"zym2"</span>, hp = [<span class="number">3</span>, <span class="number">6</span>], ac = <span class="number">18</span>, attacks = [<span class="string">"BITE"</span>, <span class="string">"HURT"</span>])))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 所有用户自定义类，是type的实例</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    instance = MyClass()</span><br><span class="line">    print(type(instance))</span><br><span class="line">    print(type(MyClass))</span><br><span class="line">    <span class="comment"># 用户自定义类，是type类的__call__运算符重载</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass2</span>:</span></span><br><span class="line">        data = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    instance = MyClass2()</span><br><span class="line">    print(MyClass2, instance, instance.data)</span><br><span class="line"></span><br><span class="line">    MyClass = type(<span class="string">"MyClass"</span>, (), {<span class="string">"data"</span>:<span class="number">1</span>})</span><br><span class="line">    instance = MyClass()</span><br><span class="line">    print(MyClass, instance, instance.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 网友的例子</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, bases, dic</span>):</span></span><br><span class="line">            super().__init__(name, bases, dic)</span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__init__"</span>)</span><br><span class="line">            print(self.__name__)</span><br><span class="line">            print(dic)</span><br><span class="line">            print(self.yaml_tag)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__new__"</span>)</span><br><span class="line">            print(cls.__name__)</span><br><span class="line">            <span class="keyword">return</span> type.__new__(cls, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__call__"</span>)</span><br><span class="line">            obj = cls.__new__(cls)</span><br><span class="line">            cls.__init__(cls, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Foo</span>(<span class="params">metaclass=MyMeta</span>):</span></span><br><span class="line">        yaml_tag = <span class="string">"!Foo"</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">            print(<span class="string">"Foo.__init__"</span>)</span><br><span class="line">            self.name = name</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"Foo.__new__"</span>)</span><br><span class="line">            <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line"></span><br><span class="line">    foo = Foo(<span class="string">"foo"</span>)</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/han-shu-shi-bian-cheng-filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/han-shu-shi-bian-cheng-filter/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="filter-函数应用"><a href="#filter-函数应用" class="headerlink" title="filter()函数应用"></a>filter()函数应用</h3><p>filter(function or None, iterable) –&gt; filter object</p>
<p>function or None：函数或者为None。<br>iterable：可迭代对象。</p>
<p>filter就是把每个function应用到可迭代对象上，如果为True就返回。<br>功能：过滤序列<br>注意：参数函数返回值必须为真值或假值<br>返回值：迭代器对象</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f = filter(<span class="keyword">lambda</span> x: <span class="literal">True</span> <span class="keyword">if</span> x!=<span class="number">0</span> <span class="keyword">else</span> <span class="literal">False</span> , [<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">print(list(f))  <span class="comment"># [1, 2, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回所有的偶数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(filter(<span class="keyword">lambda</span> x: x%<span class="number">2</span>==<span class="number">0</span>, range(<span class="number">10</span>)))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用列表推导式实现</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i % <span class="number">2</span>==<span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  计算200内所有奇数的平分根是整数，需要使用filter函数</span></span><br><span class="line"><span class="comment"># filter 函数传入两个参数，第一个参入的是lambda函数，第二个参数是一到两百的列表</span></span><br><span class="line">f2 = filter(<span class="keyword">lambda</span> x: <span class="keyword">not</span> x &amp; <span class="number">1</span> <span class="keyword">and</span> pow(int(x**<span class="number">0.5</span>), <span class="number">2</span>) == x, range(<span class="number">1</span>, <span class="number">201</span>))</span><br><span class="line"><span class="comment"># not x&amp;1 计算出一到两百所有奇数</span></span><br><span class="line"><span class="comment"># x**0.5计算平分根</span></span><br><span class="line"><span class="comment"># print(pow(3, 2) == 3**2 == 9)  # True</span></span><br><span class="line"><span class="comment"># pow(int(x**0.5), 2) 计算平分根的正整数的平方</span></span><br><span class="line"><span class="comment"># pow(int(x**0.5), 2) == x  平分根的正整数的平方是否等于自己x,x&gt;0,平方根不是整数平方后都变小</span></span><br><span class="line">x = <span class="number">2</span></span><br><span class="line">print(pow(int(x**<span class="number">0.5</span>), <span class="number">2</span>) == x)  <span class="comment"># False 平分根的正整数的平方是否等于自己x</span></span><br><span class="line">print(f2)  <span class="comment"># &lt;filter object at 0x000001C27B350B80&gt;</span></span><br><span class="line">print(list(f2))  <span class="comment"># [4, 16, 36, 64, 100, 144, 196]</span></span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/han-shu-shi-bian-cheng-map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/han-shu-shi-bian-cheng-map/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Python支持部分函数式编程特性"><a href="#Python支持部分函数式编程特性" class="headerlink" title="Python支持部分函数式编程特性"></a>Python支持部分函数式编程特性</h3><ul>
<li>把电脑的运算视作数学上的函数计算（lambda 演算）</li>
<li>高阶函数：map / reduce / filter</li>
<li>无副作用，相同的参数调用始终产生同样的结果，可以减少代码出错的几率</li>
<li>推荐尽量使用列表推导式代替函数式编程</li>
</ul>
<h3 id="map-函数应用"><a href="#map-函数应用" class="headerlink" title="map()函数应用"></a>map()函数应用</h3><p>map(function, iterable, …) –&gt; map object<br>func：表示函数。以参数序列中的每一个元素调用 function 函数，<br>*iterables：可以多个可迭代对象。</p>
<p>map含义就是让每一个可迭代对象都去应用一下func函数<br>根据提供的函数对指定序列做映射。<br>python2.x版本返回的是列表，而python3.x返回的是迭代器。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>map(<span class="keyword">lambda</span> x:x*<span class="number">2</span>, range(<span class="number">10</span>))</span><br><span class="line">&lt;map object at <span class="number">0x0000029809EAB400</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(<span class="keyword">lambda</span> x:x*<span class="number">2</span>, range(<span class="number">10</span>)))   <span class="comment"># 每个元素乘以2</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>]</span><br><span class="line"><span class="comment"># 推荐列表推导代理 map</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[i*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> num * num</span><br><span class="line"></span><br><span class="line">res = map(test, [<span class="number">1</span>, <span class="number">23</span>])</span><br><span class="line">print(list(res))  <span class="comment"># [1, 529]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># map最终得到结果的元素个数，取决于此三者最短长度</span></span><br><span class="line">list_x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">list_y = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">list_z = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x, y, z</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x * x + y + z</span><br><span class="line"></span><br><span class="line"><span class="comment"># map函数</span></span><br><span class="line">m1 = map(square, list_x, list_y, list_z)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数</span></span><br><span class="line">m2 = map(<span class="keyword">lambda</span> x, y, z: x * x + y + z, list_x, list_y, list_z)</span><br><span class="line"></span><br><span class="line">print(list(m1))  <span class="comment"># [5, 12, 21, 32]</span></span><br><span class="line">print(list(m2))  <span class="comment"># [5, 12, 21, 32]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用map函数将[1，2，3，4]处理成[1,0,1,0]</span></span><br><span class="line">a1 = list(map(<span class="keyword">lambda</span> x: x % <span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))  <span class="comment"># 取余数</span></span><br><span class="line">print(a1)  <span class="comment"># [1, 0, 1, 0]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请将列表[1,2,3,4,5]转变成[1,4,9,16,25]。然后提取大于10的数，最终输出[16,25]</span></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">print(<span class="string">'-------'</span>)</span><br><span class="line"><span class="comment"># 方法一</span></span><br><span class="line">b = list()</span><br><span class="line">c = list()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    b.append(i * i)</span><br><span class="line">print(b)  <span class="comment"># [1, 4, 9, 16, 25]  # 第一步</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">10</span>:</span><br><span class="line">        c.append(i)</span><br><span class="line">print(c)  <span class="comment"># [16, 25]  # 第二步</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二</span></span><br><span class="line">x = list(map(<span class="keyword">lambda</span> x: x * x, a))  <span class="comment"># 第一步 [1, 4, 9, 16, 25]</span></span><br><span class="line">print(x)</span><br><span class="line"></span><br><span class="line">y = [i <span class="keyword">for</span> i <span class="keyword">in</span> map(<span class="keyword">lambda</span> x: x * x, a) <span class="keyword">if</span> i &gt; <span class="number">10</span>]</span><br><span class="line">print(y)  <span class="comment"># [6]: [16, 25]  # 第二步</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法三</span></span><br><span class="line">print(<span class="string">'---方法三----'</span>)</span><br><span class="line">print([x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] <span class="keyword">if</span> x**<span class="number">2</span> &gt; <span class="number">10</span>])</span><br><span class="line">print([i**<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] <span class="keyword">if</span> i**<span class="number">2</span> &gt; <span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法四</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fn</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x**<span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'==方法四==='</span>)</span><br><span class="line">res = map(fn, a)</span><br><span class="line"><span class="comment"># for x in res:</span></span><br><span class="line"><span class="comment">#     print(x)</span></span><br><span class="line">res = [i <span class="keyword">for</span> i <span class="keyword">in</span> res <span class="keyword">if</span> i &gt; <span class="number">10</span>]</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法五</span></span><br><span class="line">print(<span class="string">'----'</span>)</span><br><span class="line">a = list(map(<span class="keyword">lambda</span> x: pow(x, <span class="number">2</span>), a))  <span class="comment"># 第一步</span></span><br><span class="line">print(a)  <span class="comment"># [1, 4, 9, 16, 25]</span></span><br><span class="line"></span><br><span class="line">b = [i <span class="keyword">for</span> i <span class="keyword">in</span> map(<span class="keyword">lambda</span> x: pow(x, <span class="number">2</span>), a) <span class="keyword">if</span> i &gt; <span class="number">10</span>]</span><br><span class="line">print(b)  <span class="comment"># [16, 25]  # 第二步</span></span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/han-shu-shi-bian-cheng-reduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/han-shu-shi-bian-cheng-reduce/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="reduce-函数应用"><a href="#reduce-函数应用" class="headerlink" title="reduce()函数应用"></a>reduce()函数应用</h3><p>reduce(function, sequence[, initial]) -&gt; value 归约，前面的结果每次都应用到后面去。<br>function：函数。sequence：序列。initial：初始值。</p>
<p>py2中是自带函数，py3转移到functools里面</p>
<p>功能：对参数序列中元素进行累积<br>注意：参数函数应至少有两个参数<br>reduce把一个函数作用在一个序列[x1, x2, x3, …]上，<br>reduce把结果继续和序列的下一个元素做累积计算<br>给mul传入参数的过程是这样的。<br>先从有序列表中取前两个，传入函数进行计算，会得到一个结果，<br>这时再从列表中取出一个还未计算过的值与这个函数的计算结果，<br>再次传入函数计算。重复此过程，直到所有的列表元素都参与计算，<br>以此来完成类似累加累乘这样的操作,函数可以大大减少代码量</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce </span><br><span class="line"></span><br><span class="line">DIGITS = {</span><br><span class="line">    <span class="string">'0'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'1'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'2'</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">'3'</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">'4'</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">'5'</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">'6'</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="string">'7'</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="string">'8'</span>: <span class="number">8</span>,</span><br><span class="line">    <span class="string">'9'</span>: <span class="number">9</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">char2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> DIGITS[s]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2int</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x * <span class="number">10</span> + y, map(char2num, s))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = <span class="string">'67373'</span></span><br><span class="line">print(type(map(char2num, s)))  <span class="comment"># &lt;class 'map'&gt;</span></span><br><span class="line">print(list(map(char2num, s)))  <span class="comment"># [6, 7, 3, 7, 3]</span></span><br><span class="line"></span><br><span class="line">print(str2int(s))  <span class="comment"># 67373</span></span><br><span class="line">print(type(str2int(s)))  <span class="comment"># &lt;class 'int'&gt;</span></span><br><span class="line"></span><br><span class="line">list_x = [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>]</span><br><span class="line">print(reduce(<span class="keyword">lambda</span> x, y: x + y, list_x))  <span class="comment"># 12345 字符串相加，不是数字相加</span></span><br><span class="line"><span class="comment"># x = '1' </span></span><br><span class="line"><span class="comment"># y = '2'</span></span><br><span class="line"><span class="comment"># return '12'</span></span><br><span class="line"><span class="comment"># x = 'hello1' </span></span><br><span class="line"><span class="comment"># y = '2'</span></span><br><span class="line"><span class="comment"># return 'hello11'</span></span><br><span class="line">print(type(reduce(<span class="keyword">lambda</span> x, y: x + y, list_x)))  <span class="comment"># &lt;class 'str'&gt;</span></span><br><span class="line">print(reduce(<span class="keyword">lambda</span> x, y: x + y, list_x, <span class="string">'hello'</span>))  <span class="comment"># hello12345</span></span><br><span class="line"><span class="comment"># x = 'hello' </span></span><br><span class="line"><span class="comment"># y = '1'</span></span><br><span class="line"><span class="comment"># return 'hello1'</span></span><br><span class="line"><span class="comment"># x = 'hello1' </span></span><br><span class="line"><span class="comment"># y = '2'</span></span><br><span class="line"><span class="comment"># return 'hello11'</span></span><br><span class="line"></span><br><span class="line">print(type(reduce(<span class="keyword">lambda</span> x, y: x + y, list_x, <span class="string">'hello'</span>)))  <span class="comment"># &lt;class 'str'&gt;</span></span><br><span class="line"></span><br><span class="line">list_y = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">print(reduce(<span class="keyword">lambda</span> x, y: x + y, list_y))  </span><br><span class="line"><span class="comment"># 15 数字相加 ((((1+2)+3)+4)+5)，最后把和返回</span></span><br><span class="line">print(type(reduce(<span class="keyword">lambda</span> x, y: x + y, list_y)))  </span><br><span class="line"><span class="comment"># &lt;class 'int'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>模拟计算器，整数计算的整数，小数计算得小数</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> eval(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">exp</span>):</span></span><br><span class="line">    ss = exp.split(<span class="string">'+'</span>)</span><br><span class="line">    ns = map(str2num, ss)</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> acc, x: acc + x, ns)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = calc(<span class="string">'100 + 200 + 345'</span>)</span><br><span class="line">print(<span class="string">'100 + 200 + 345 ='</span>, r)</span><br><span class="line"><span class="comment"># 100 + 200 + 345 = 645</span></span><br><span class="line">r = calc(<span class="string">'99 + 88 + 7.6'</span>)</span><br><span class="line">print(<span class="string">'99 + 88 + 7.6 ='</span>, r)</span><br><span class="line"><span class="comment"># 99 + 88 + 7.6 = 194.6</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> int(s)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> float(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">exp</span>):</span></span><br><span class="line">    ss = exp.split(<span class="string">'+'</span>)</span><br><span class="line">    ns = map(str2num, ss)</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> acc, x: acc + x, ns)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    r = calc(<span class="string">'100 + 200 + 345'</span>)</span><br><span class="line">    print(<span class="string">'100 + 200 + 345 ='</span>, r)</span><br><span class="line">    r = calc(<span class="string">'99 + 88 + 7.6'</span>)</span><br><span class="line">    print(<span class="string">'99 + 88 + 7.6 ='</span>, r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
