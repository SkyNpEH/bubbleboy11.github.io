<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;bubbleboy11.github.io&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/12/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/12/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<script data-pjax src="/js/load-config.js"></script>
  <title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">241</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/replace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/replace/" class="post-title-link" itemprop="url">replace</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>主串.replace(‘旧子串’,’新子串’,匹配次数)<br>多种异常字段替换成一种字段</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原数据</span></span><br><span class="line">data = [<span class="number">123</span>, <span class="number">234</span>, <span class="string">'零'</span>, <span class="string">'None'</span>, <span class="number">8975</span>]</span><br><span class="line"><span class="comment"># 需要替换字段</span></span><br><span class="line">replace = [<span class="string">'零'</span>, <span class="string">'None'</span>]</span><br><span class="line">result = [<span class="number">0</span> <span class="keyword">if</span> i <span class="keyword">in</span> replace <span class="keyword">else</span> i <span class="keyword">for</span> i <span class="keyword">in</span> data]</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># [123, 234, 0, 0, 8975]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多字段替换</span></span><br><span class="line"><span class="comment"># 原数据</span></span><br><span class="line">data = [<span class="number">123</span>, <span class="number">234</span>, <span class="string">'零'</span>, <span class="string">'None'</span>, <span class="number">8975</span>]</span><br><span class="line"><span class="comment"># 需要替换字段</span></span><br><span class="line">replace = {<span class="string">'零'</span>: <span class="number">0</span>, <span class="number">123</span>: <span class="string">'一二三'</span>}</span><br><span class="line">result = [replace[i] <span class="keyword">if</span> i <span class="keyword">in</span> replace <span class="keyword">else</span> i <span class="keyword">for</span> i <span class="keyword">in</span> data]</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># ['一二三', 234, 0, 'None', 8975]</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'tea for too'</span>.replace(<span class="string">'too'</span>, <span class="string">'two'</span>))</span><br><span class="line"><span class="comment"># 'tea for two'</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/request-mo-kuai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/request-mo-kuai/" class="post-title-link" itemprop="url">request模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-08 02:51:34" itemprop="dateModified" datetime="2021-05-08T02:51:34Z">2021-05-08</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>urllib 是 Python 标准库中用于网络请求的库。该库有四个模块，分别是urllib.request，urllib.error，urllib.parse，urllib.robotparser。其中urllib.request，urllib.error两个库在爬虫程序中应用比较频繁。urllib一般要先构建get或者post请求，然后再发起请求。</p>
<p>requests模块 基于HTTP请求的模块第三方的Python库，<br>小规模，数据量小，速度不敏感、爬取网页</p>
<p>requests可以直接构建常用的get和post请求并发起，<br>使用了urllib3，多次请求重复使用一个socket，<br>“connection”:”keep-alive”，说明多次请求使用一个连接，消耗更少的资源</p>
<p>作用：模拟浏览器发送HTTP请求。用于爬虫或接口的测试<br>如何使用：</p>
<ul>
<li><p>指定url</p>
</li>
<li><p>发起请求</p>
</li>
<li><p>获取响应数据</p>
</li>
<li><p>持久化存储</p>
</li>
<li><p><code>requests.request()</code>    构造一个请求，支撑以下各方法的基础方法</p>
</li>
<li><p><code>requests.head()</code>    获取HTML网页头信息的方法，对应于HTTP的HEAD</p>
</li>
<li><p><code>requests.put()</code>    向HTML网页提交PUT请求的方法，对应于HTTP的PUT</p>
</li>
<li><p><code>requests.patch()</code>    向HTML网页提交局部修改请求，对应于HTTP的PATCH</p>
</li>
<li><p><code>requests.delete()</code>    向HTML网页提交删除请求，对应于HTTP的DELETE</p>
</li>
<li><p><code>requests.post()</code>    向HTML网页提交POST请求的方法，对应于HTTP的POST</p>
</li>
<li><p><code>requests.get(url,params=None,**kwarge)</code> 构造一个向服务器请求资源的requests对象，返回一个包含服务器资源的requests对象，获取HTML网页的主要方法，对应于HTTP的GET<br>Requests方法的13个访问控制参数<br>参数名    说明<br><code>url</code>:获取页面的url链接<br><code>params</code>字典或字节序列，作为参数增加到url中<br><code>s</code>：12个控制访问的参数<br><code>data</code>    字典、字节序列或文件对象，作为Request的内容<br><code>json</code>    JSON格式的数据，作为Request的内容<br><code>headers</code>字典、HTTP定制头<br><code>cookies</code>字典或CookieJar，Request中的cookie<br><code>auth</code>    元组，支持HTTP认证功能<br><code>files</code>    字典类型，传输文件<br><code>timeout</code>    设定超时时间，秒为单位<br><code>proxies</code>    字典类型，设定访问代理服务器，可以增加登录认证<br><code>allow_redirects</code>    True/False,默认为True，重定向开关<br><code>stream</code>默认为True，获取内容立即下载开关<br><code>verify</code>默认为True，认证SSL证书开关<br><code>cert</code>    本地SSL证书路径</p>
</li>
</ul>
<p>Request:构造一个向服务器请求资源的Request对象<br>Response：返回一个包含服务器资源的Response对象</p>
<h3 id="Response对象的属性"><a href="#Response对象的属性" class="headerlink" title="Response对象的属性"></a>Response对象的属性</h3><p><code>r.status_code</code>    HTTP请求的返回状态码<br><code>r.text</code>    HTTP响应内容的字符串形式，即 url对应的页面内容<br><code>r.encoding</code>    从HTTP header中猜测的响应内容编码方式，如果header中不存在charset字段，则认为编码为 ISO-8859-1<br><code>r.apparent_encoding</code>    从内容中分析出的响应内容编码方式（备选编码方式）<br><code>r.content</code>    HTTP响应内容的二进制形式</p>
<h3 id="Requests库的异常"><a href="#Requests库的异常" class="headerlink" title="Requests库的异常"></a>Requests库的异常</h3><p><code>requests.ConnectionError</code>    网络连接异常，如DNS查询失败、拒绝连接等<br><code>requests.HTTPError</code>    HTTP错误异常<br><code>requests.URLRequired</code>    URL缺失异常<br><code>requests.TooManyRedirects</code>    超过最大重定向次数，产生重定向异常<br><code>requests.ConnectTimeout</code>    连接远程服务器超时异常<br><code>requests.Timeout</code>    请求URL超时，产生异常</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 . 组装请求</span></span><br><span class="line">url1 = <span class="string">"http://api.tianapi.com/txapi/aqi/index?key=4dce7e012c6391364928602666813641&amp;area=上海"</span></span><br><span class="line">url2 = <span class="string">"http://api.tianapi.com/txapi/aqi/index"</span></span><br><span class="line">url3 = <span class="string">"http://api.tianapi.com/txapi/aqi/index"</span></span><br><span class="line">params = {<span class="string">"key"</span>: <span class="string">"4dce7e012c6391364928602666813641"</span>, <span class="string">"area"</span>: <span class="string">"上海"</span>}</span><br><span class="line">data = {<span class="string">"key"</span>: <span class="string">"4dce7e012c6391364928602666813641"</span>, <span class="string">"area"</span>: <span class="string">"上海"</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 发送请求，获取响应</span></span><br><span class="line">res1 = requests.get(url=url1)</span><br><span class="line">res2 = requests.get(url=url2, params=data)</span><br><span class="line">res3 = requests.post(url=url3, data=data)</span><br><span class="line"><span class="comment"># 3. 解析响应</span></span><br><span class="line">print(res1.text)</span><br><span class="line">print(res2.text)</span><br><span class="line">print(res3.text)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"msg"</span>:<span class="string">"success"</span>,<span class="attr">"newslist"</span>:[{<span class="attr">"area"</span>:<span class="string">"上海"</span>,<span class="attr">"area_code"</span>:<span class="string">"shanghai"</span>,<span class="attr">"so2"</span>:<span class="string">"5"</span>,<span class="attr">"o3"</span>:<span class="string">"36"</span>,<span class="attr">"pm2_5"</span>:<span class="string">"49"</span>,<span class="attr">"primary_pollutant"</span>:<span class="string">"颗粒物(PM2.5)"</span>,<span class="attr">"co"</span>:<span class="string">"0.7"</span>,<span class="attr">"num"</span>:<span class="string">"231"</span>,<span class="attr">"no2"</span>:<span class="string">"71"</span>,<span class="attr">"quality"</span>:<span class="string">"良好"</span>,<span class="attr">"aqi"</span>:<span class="string">"68"</span>,<span class="attr">"pm10"</span>:<span class="string">"57"</span>,<span class="attr">"o3_8h"</span>:<span class="string">"52"</span>,<span class="attr">"time"</span>:<span class="string">"2021-04-27 20:40:10.642"</span>}]}</span><br><span class="line">{<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"msg"</span>:<span class="string">"success"</span>,<span class="attr">"newslist"</span>:[{<span class="attr">"area"</span>:<span class="string">"上海"</span>,<span class="attr">"area_code"</span>:<span class="string">"shanghai"</span>,<span class="attr">"so2"</span>:<span class="string">"5"</span>,<span class="attr">"o3"</span>:<span class="string">"36"</span>,<span class="attr">"pm2_5"</span>:<span class="string">"49"</span>,<span class="attr">"primary_pollutant"</span>:<span class="string">"颗粒物(PM2.5)"</span>,<span class="attr">"co"</span>:<span class="string">"0.7"</span>,<span class="attr">"num"</span>:<span class="string">"231"</span>,<span class="attr">"no2"</span>:<span class="string">"71"</span>,<span class="attr">"quality"</span>:<span class="string">"良好"</span>,<span class="attr">"aqi"</span>:<span class="string">"68"</span>,<span class="attr">"pm10"</span>:<span class="string">"57"</span>,<span class="attr">"o3_8h"</span>:<span class="string">"52"</span>,<span class="attr">"time"</span>:<span class="string">"2021-04-27 20:40:10.642"</span>}]}</span><br><span class="line">{<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"msg"</span>:<span class="string">"success"</span>,<span class="attr">"newslist"</span>:[{<span class="attr">"area"</span>:<span class="string">"上海"</span>,<span class="attr">"area_code"</span>:<span class="string">"shanghai"</span>,<span class="attr">"so2"</span>:<span class="string">"5"</span>,<span class="attr">"o3"</span>:<span class="string">"36"</span>,<span class="attr">"pm2_5"</span>:<span class="string">"49"</span>,<span class="attr">"primary_pollutant"</span>:<span class="string">"颗粒物(PM2.5)"</span>,<span class="attr">"co"</span>:<span class="string">"0.7"</span>,<span class="attr">"num"</span>:<span class="string">"231"</span>,<span class="attr">"no2"</span>:<span class="string">"71"</span>,<span class="attr">"quality"</span>:<span class="string">"良好"</span>,<span class="attr">"aqi"</span>:<span class="string">"68"</span>,<span class="attr">"pm10"</span>:<span class="string">"57"</span>,<span class="attr">"o3_8h"</span>:<span class="string">"52"</span>,<span class="attr">"time"</span>:<span class="string">"2021-04-27 20:40:10.642"</span>}]}</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">print(r.status_code)  <span class="comment"># 检测请求网页的状态码</span></span><br><span class="line"><span class="comment"># 输出200</span></span><br><span class="line">r.encoding = <span class="string">'utf-8'</span></span><br><span class="line">print(r.text)</span><br><span class="line"><span class="comment"># 输出网页内容</span></span><br></pre></td></tr></tbody></table></figure>

<p>通用框架</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHTMLText</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(url, timeout=<span class="number">30</span>)</span><br><span class="line">        r.raise_for_status()  <span class="comment"># 如果状态不是200，引发HTTPError异常</span></span><br><span class="line">        r.encoding = r.apparent_encoding  <span class="comment"># 使得返回内容的解码是正确的</span></span><br><span class="line">        <span class="keyword">return</span> r.text</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"产生异常"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    url = <span class="string">"http://www.baidu.com"</span></span><br><span class="line">    print(getHTMLText(url))</span><br></pre></td></tr></tbody></table></figure>

<p>request使用代理<br>很多网站如果发现同一个IP发出的大量请求，就会封禁这样的IP<br>爬虫为了避免被封IP，必须不断地更换IP地址发出请求，这个时候就需要使用代理</p>
<p>requests库有一个代理参数proxies可以指定通过代理服务器发起请求<br>proxies参数是一个字典，里面包含了http和https的代理URL</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用代理</span></span><br><span class="line">resp = requests.get(<span class="string">'http://httpbin.org/ip'</span>)</span><br><span class="line">print(resp.text)</span><br><span class="line"><span class="comment"># {"origin": "114.93.163.248"}</span></span><br><span class="line"></span><br><span class="line">proxies = {</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://139.227.252.141:8118'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://139.227.252.141:8118'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用代理</span></span><br><span class="line">resp = requests.get(<span class="string">'http://httpbin.org/ip'</span>, proxies=proxies)</span><br><span class="line">print(resp.text)</span><br><span class="line"><span class="comment"># {"origin": "139.227.252.141"}</span></span><br></pre></td></tr></tbody></table></figure>

<p>需求1：爬取搜狗首页的页面数据</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 第一步：指定url</span></span><br><span class="line">    url = <span class="string">'https://www.sogou.com/'</span></span><br><span class="line">    <span class="comment"># 第二步：发起请求</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="comment"># 第三步：获取响应数据</span></span><br><span class="line">    page_text = response.text</span><br><span class="line">    <span class="comment"># print(page_text)</span></span><br><span class="line">    <span class="comment"># 第四步：持久化存储</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'./搜狗首页.html'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)<span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text)</span><br><span class="line">    print(<span class="string">'爬取结束'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求2：实现一个简易的网页采集器（爬取搜狗指定词条对应的搜索结果页面）<br>UA伪装：门户网站的服务器会检测载体身份标识，如果检测到是爬虫发起就会拒绝访问，所以需要伪装成正常的浏览器访问身份。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'https://www.sogou.com/web'</span></span><br><span class="line">    <span class="comment"># 处理url携带的参数：封装到字典中</span></span><br><span class="line">    keyWord = input(<span class="string">'请输入关键字：'</span>)</span><br><span class="line">    param = {</span><br><span class="line">        <span class="string">'query'</span>: keyWord</span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.get(url=url, params=param, headers=headers)</span><br><span class="line">    page_text = response.text</span><br><span class="line">    filename = <span class="string">'./简易网页采集/'</span> + keyWord + <span class="string">'.html'</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text)</span><br><span class="line">    print(keyWord + <span class="string">'  保存成功！'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求3：破解百度翻译<br>注意：响应数据为json类型；请求方式为POST</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'https://fanyi.baidu.com/sug'</span></span><br><span class="line">    keyWord = input(<span class="string">'请输入关键字：'</span>)</span><br><span class="line">    data = {</span><br><span class="line">        <span class="string">'kw'</span>: keyWord</span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.post(url=url, data=data, headers=headers)</span><br><span class="line">    page_json = response.json()</span><br><span class="line">    <span class="comment"># print(page_json)</span></span><br><span class="line">    fp = open(<span class="string">'./百度翻译/'</span> + keyWord + <span class="string">".json"</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    json.dump(page_json, fp=fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    print(<span class="string">'翻译结束！已保存'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求4：爬取豆瓣电影分类排行榜</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'https://movie.douban.com/j/chart/top_list'</span></span><br><span class="line">    num = input(<span class="string">'请输入前多少名数据:'</span>)</span><br><span class="line">    param = {</span><br><span class="line">        <span class="string">'type'</span>: <span class="string">'11'</span>,</span><br><span class="line">        <span class="string">'interval_id'</span>: <span class="string">'100:90'</span>,</span><br><span class="line">        <span class="string">'action'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'start'</span>: <span class="string">'0'</span>,</span><br><span class="line">        <span class="string">'limit'</span>: num</span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.get(url=url, params=param, headers=headers)</span><br><span class="line">    list_data = response.json()</span><br><span class="line">    fp = open(<span class="string">'./豆瓣排行/豆瓣排行.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    json.dump(list_data, fp=fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    print(<span class="string">'保存完成'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求5：肯德基餐厅查询（<a target="_blank" rel="noopener" href="http://www.kfc.com.cn/kfccda/storelist/index.aspx%EF%BC%89">http://www.kfc.com.cn/kfccda/storelist/index.aspx）</a></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx'</span></span><br><span class="line">    cname = input(<span class="string">'请输入城市：'</span>)</span><br><span class="line">    keyword = input(<span class="string">'请输入关键字：'</span>)</span><br><span class="line">    op = <span class="string">'keyword'</span></span><br><span class="line">    param = {</span><br><span class="line">        <span class="string">'op'</span>: op</span><br><span class="line">    }</span><br><span class="line">    data = {</span><br><span class="line">        <span class="string">'cname'</span>: cname,</span><br><span class="line">        <span class="string">'pid'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'keyword'</span>: keyword,</span><br><span class="line">        <span class="string">'pageIndex'</span>: <span class="string">'1'</span>,</span><br><span class="line">        <span class="string">'pageSize'</span>: <span class="string">'10'</span></span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.post(url=url, data=data, headers=headers, params=param)</span><br><span class="line">    print(response.json())</span><br><span class="line">    table_data = response.json()</span><br><span class="line">    fp = open(<span class="string">'./肯德基餐厅/'</span>+cname+<span class="string">'_'</span>+keyword+<span class="string">'.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    json.dump(table_data, fp=fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    print(<span class="string">'保存完成'</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL_GET = <span class="string">"https://api.douban.com/v2/event/list"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_params_requests</span>():</span></span><br><span class="line">    <span class="comment"># 构建请求参数</span></span><br><span class="line">    params = {<span class="string">'loc'</span>: <span class="string">'108288'</span>, <span class="string">'day_type'</span>: <span class="string">'weekend'</span>, <span class="string">'type'</span>: <span class="string">'exhibition'</span>}</span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    response = requests.get(URL_GET, params=params)</span><br><span class="line">    <span class="comment"># 处理响应</span></span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;Response Headers:'</span>)</span><br><span class="line">    print(response.headers)</span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;Status Code:'</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;Response Body:'</span>)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Use params requests:'</span>)</span><br><span class="line">    use_params_requests()</span><br></pre></td></tr></tbody></table></figure>

<p>网络图片爬取及存储</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''r.content  #表示返回内容的二进制格式'''</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">new_folder = <span class="string">'./Picture/'</span>  <span class="comment"># 相对路径</span></span><br><span class="line">url = <span class="string">'http://img0.dili360.com/ga/M00/02/AB/wKgBzFQ26i2AWujSAA_-xvEYLbU441.jpg@!rw9'</span></span><br><span class="line">path = new_folder + url.split(<span class="string">'/'</span>)[<span class="number">-1</span>].split(<span class="string">'@'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(new_folder):</span><br><span class="line">        os.mkdir(new_folder)  <span class="comment"># 创建新目录</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line"></span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        <span class="comment"># 如何将二进制转化为图片保存</span></span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment"># 新建wKgBzFQ26i2AWujSAA_-xvEYLbU441.jpg</span></span><br><span class="line">            f.write(r.content)</span><br><span class="line">            f.close()</span><br><span class="line">            print(<span class="string">'图片保存成功'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'文件已存在'</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"爬取失败"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>百度/360搜索关键字</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#实例3：爬取搜索页面</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    kw = {<span class="string">'wd'</span>: <span class="string">'python'</span>}</span><br><span class="line">    r = requests.get(<span class="string">'https://www.baidu.com/s'</span>, params=kw)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    print(len(r.text))  <span class="comment"># 227</span></span><br><span class="line">    <span class="comment"># r.request.url  返回的是百度安全验证的链接？</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"爬取失败"</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    kw = {<span class="string">'q'</span>: <span class="string">'python'</span>}  <span class="comment"># 360搜索的关键字的键为q</span></span><br><span class="line">    r = requests.get(<span class="string">'https://www.so.com/s'</span>, params=kw)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    print(len(r.text))  <span class="comment">#257468</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"爬取失败"</span>)</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/restful/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/restful/" class="post-title-link" itemprop="url">REST</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-14 06:27:35" itemprop="dateModified" datetime="2021-05-14T06:27:35Z">2021-05-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>http是应用协议而非传输协议</li>
</ul>
<h3 id="REST-Representational-State-Transfer-表示（表述）性状态转换，表现层状态转义，"><a href="#REST-Representational-State-Transfer-表示（表述）性状态转换，表现层状态转义，" class="headerlink" title="REST - Representational State Transfer 表示（表述）性状态转换，表现层状态转义，"></a>REST - Representational State Transfer 表示（表述）性状态转换，表现层状态转义，</h3><ul>
<li>是一种以资源为中心的 万维网web软件系统架构设计风格(它既不是一个标准规范也不是一个强制性约束)，</li>
</ul>
<ul>
<li>一种分布式系统的应用层解决方案，</li>
<li><strong>Representational：数据的表现形式（JSON、XML…..），数据描述简单、可读。</strong></li>
<li><strong>State: 当前状态或者数据</strong></li>
<li><strong>Transfer: 数据传输通信</strong></li>
</ul>
<ul>
<li>目的：用来创建网络服务的，</li>
<li>可以用 Ajax 和RESTful web服务构建应用</li>
<li>可以降低开发的复杂性，提高系统的可伸缩性。<br>RESTful架构就是：<strong>“每一个URI代表一种资源，客户端通过四个HTTP动词，对服务器端资源进行操作，实现资源的表现层状态转移”。</strong></li>
</ul>
<h5 id="RESTful-六大限制"><a href="#RESTful-六大限制" class="headerlink" title="RESTful 六大限制"></a>RESTful 六大限制</h5><ol>
<li><p><strong>客户-服务器（Client-Server）</strong></p>
<ul>
<li>关注点分离</li>
<li>服务端专注数据存储，提高了简单性</li>
<li>前端专注用户界面，提升了可移植性</li>
</ul>
</li>
<li><p><strong>无状态（StateLess）</strong></p>
<ul>
<li>所有会话信息都保存在客户端</li>
<li>每次请求必须包括所有信息，不能依赖上下文信息</li>
<li>服务端不用保存会话信息，提升简单性、可靠性、可见性（软件工程中接口之间透明程度）</li>
</ul>
</li>
<li><p><strong>缓存（Cache）</strong></p>
<ul>
<li>所有服务端响应都要被表示为可缓存（缓存在客户端（浏览器））或不可缓存</li>
<li>减少前后端交互，提升性能</li>
</ul>
</li>
<li><p><strong>统一接口（Uniform Interface）</strong></p>
<ul>
<li>接口设计尽可能统一通用，提升了简单性、可见性</li>
<li>遵循接口规范，接口与实现解耦，使前后端可以独立开发迭代</li>
</ul>
</li>
<li><p><strong>分层系统（Layered System）</strong></p>
<ul>
<li>每层只知道相邻的一层，后面隐藏的就不知道了</li>
<li>客户端不知道是和代理还是真实服务器通信</li>
<li>其它层：安全层、负载均衡、缓存层等</li>
</ul>
</li>
<li><p><strong>按需代码（Code-On-Demand）（可选）</strong></p>
<ul>
<li>客户端可以下载运行服务端传来的数据（比如JS）</li>
<li>通过减少一些功能，简化了客户端</li>
</ul>
</li>
</ol>
<h5 id="统一接口的限制"><a href="#统一接口的限制" class="headerlink" title="统一接口的限制"></a>统一接口的限制</h5><ol>
<li><strong>资源的标识</strong></li>
</ol>
<ul>
<li>Resources(资源)：任意可以命名的事物抽象为资源，在RESTFul设计里一切都是资源。<br>就是网络上的一个实体，或者说是网络上的一个具体信息。它可以是一段文本、一张图片、一首歌曲、一个用户、或者一个订单或一种服务或数据。<br>每个资源可以通过<code>URI</code>（统一资源标识符）被唯一的标识(identifier)和定位和指向资源而不是操作资源。标识符在网站上的表现形式就是URI。每一个URL 指向的一个实体资源，要获取到这个资源，访问它的URI即可，URI就是资源在互联网上的唯一标识。<br><a target="_blank" rel="noopener" href="https://api.z.cn/v1/product/recent?page=3&amp;size=20">https://api.z.cn/v1/product/recent?page=3&amp;size=20</a></li>
</ul>
<ol start="2">
<li><p><strong>通过表述来操作资源</strong></p>
<ul>
<li>通过表述<code>Representation</code> 操作资源，比如<code>JSON</code>、<code>XML</code>等</li>
<li>客户端不能直接操作（比如<code>SQL</code>）服务端资源</li>
<li>客户端应该通过表述（比如<code>JSON</code>）来操作资源</li>
</ul>
</li>
<li><p><strong>自描述消息</strong></p>
<ul>
<li>每个消息（请求或响应）必须提供足够的信息让接受者理解</li>
<li>消息：如媒体类型（<code>application/json、application/xml</code>）</li>
<li>消息：如HTTP方法： <code>GET、POST、DELETE</code></li>
<li>是否缓存： <code>Cache-Control</code></li>
</ul>
</li>
<li><p><strong>超媒体作为应用状态引擎</strong></p>
<ul>
<li>超媒体： 带文字的链接</li>
<li>应用转态：一个网页</li>
<li>引擎：驱动、跳转</li>
<li>合起来就是：点击链接跳转到另一个网页</li>
</ul>
</li>
</ol>
<h3 id="RESTful-API："><a href="#RESTful-API：" class="headerlink" title="RESTful API："></a>RESTful API：</h3><p>符合REST架构风格的<strong>API</strong>就是 <strong>RESTful API</strong>，设计概念和准则规范，<br>接口实现 是前后端分离的最佳实践，</p>
<p>我们在设计Web应用时，如果需要向客户端提供资源，就可以使用REST风格的URI，这是实现RESTful架构的第一步。当然，真正的RESTful架构并不只是URI符合REST风格，更为重要的是“无状态”和“幂等性”两个词，我们在后面的课程中会为大家阐述这两点。</p>
<ul>
<li><p>轻量，直接通过http(s)做传输协议，不需要额外的协议</p>
</li>
<li><p>面向资源的接口设计 （不同于 SOAP协议，SOAP 是面向服务的）一目了然，具有解释性</p>
<ul>
<li>Representation(表现层)：资源的“表现层、表现形式。资源可以有多种外在表现形式。我们把资源具体呈现出来的形式，叫做它的“表现层”。比如，文本可以用<code>text/plain</code>格式表现，也可以用<code>text/html</code>格式、<code>text/xml</code>格式、<code>application/json</code>格式表现，甚至可以采用二进制格式；图片可以用<code>image/jpeg</code>格式表现，也可以用<code>image/png</code>格式表现。URI只代表资源的实体，不代表它的表现形式。严格地说，有些网址最后的<code>.html</code>后缀名是不必要的，因为这个后缀名表示格式，属于“表现层”范畴，而URI应该只代表“资源”的位置，它的具体表现形式，应该在HTTP请求的头信息中用<code>Accept</code>和<code>Content-Type</code>字段指定，这两个字段才是对“表现层”的描述。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>通过表述来操作资源</strong><ul>
<li>通过表述<code>Representation</code> 操作资源，比如传输的数据媒体类型<code>JSON</code>、<code>XML</code>等</li>
<li>客户端不能直接操作（比如<code>SQL</code>）服务端资源</li>
<li>客户端应该通过表述（比如<code>JSON</code>）来操作资源</li>
</ul>
</li>
</ol>
<ul>
<li>State Transfer(状态转化)： </li>
<li>客户端通过对资源的四种HTTP的GET、POST、PUT（或PATCH）、DELETE动词语义的增删改查操作实现这个url对应的资源状态的改变，<br>(把 HTTP 请求方式和数据库的增删改查CRUD(create/retrieve/update/delete)联系结合到一起)，</li>
<li>资源通过接口进行操作实现状态转移，操作本身是无状态的。因为HTTP协议本身就是一个无状态的协议，它只能通过每次发的cookie值来识别用户，但是每两次http之间的请求它们是没有任何关系的、没有先后顺序。</li>
<li>对资源的操作不会改变资源的标识。因为你一旦改变了资源的标识就会导致链接不可用或者资源查找不到。访问一个网站，就代表了客户端和服务器的一个互动过程。在这个过程中，势必涉及到数据和状态的变化。Web应用通常使用HTTP作为其通信协议，客户端想要操作服务器，必须通过HTTP请求，让服务器端发生“状态转移”，而这种转移是建立在表现层之上的，所以就是“表现层状态转移”。</li>
<li>在服务器新建或更新资源-用HTTP POST请求、</li>
<li>从服务器获取资源-用HTTP GET请求、</li>
<li>从服务器获取某个资源的头部信息-用HTTP HEAD请求、</li>
<li>在服务器更新资源-用HTTP PUT（或PATCH）请求、</li>
<li>从服务器删除资源-用HTTP DELETE请求</li>
<li>更“精简”的方式处理返回结果设计<br>对于每一个http请求的响应结果都要指明一个状态码，具体产品由具体产品 api 文档给出。<br>比如修改一个数据的时候，只需要得到http状态码的结果，200或201表示修改成功<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"msg"</span>:<span class="string">"uri_not_found"</span>,</span><br><span class="line">    <span class="attr">"code"</span>:<span class="number">1001</span>,</span><br><span class="line">    <span class="attr">"request"</span>: <span class="string">"GET \/v2\/photo\/132"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>下面的例子给出了一些符合REST风格的URI，供大家在设计URI时参考。<br>REST API 接口实例 url用名词<br>| 请求方法（HTTP动词） | URI后缀                        | 动作解释                               |<br>| ——————– | ————————– | ————————————-|<br>| <strong>head</strong>     | <code>/student/</code>               | 获取学生，请求获取URL位置资源的响应消息报告，头部信息元数据 |<br>| <strong>GET</strong>      | <code>/students/</code>               | 获取所有学生信息列表 ，请求获取URL位置的资源  |<br>| <strong>GET</strong>      | <code>/students/ID/</code>            | 获取指定ID的学生信息                   |<br>| <strong>GET</strong>      | <code>/students/ID/friends/</code>    | 列出查看指定ID的学生的所有朋友信息（商品的所有投资者） |<br>| <strong>GET</strong>      | <code>/students/ID/friends/ID/</code>  | 列出查看指定ID的学生的所有朋友信息 商品的指定投资者信息|<br>| <strong>POST</strong>     | <code>/students/</code>               | 新建一个学生，请求向URL位置的资源后附加新的数据 |<br>| <strong>PUT</strong>      | <code>/students/ID/</code>            | 更新指定ID的学生信息（提供该学生的全部字段信息）请求向URL位置存储一个资源，覆盖原URL位置的资源|<br>| <strong>PATCH</strong>    | <code>/students/ID/</code>            | 更新指定ID的学生信息（提供该学生的部分字段信息）请求局部更新URL位置的资源，覆盖原URL位置的资源|<br>| <strong>DELETE</strong>   | <code>/students/ID/</code>            | 删除指定ID的学生信息，请求删除URL位置存储的资源 |<br>| <strong>DELETE</strong>   | <code>/students/ID/friends/ID/</code> | 删除指定ID的学生的指定ID的朋友           </p>
<ul>
<li>一般 web 框架都有相应的插件支持 RESTful API。比如Django有 rest framework，Flask和Tornado分别有flask restful 和 tornado restful。<br>现在主流的web框架都是相关的RESTful API插件。</li>
</ul>
<p>如何设计RESTful API 规范：<br>请求设计规范</p>
<ul>
<li>协议：API与用户的通信协议，使用 HTTPs 协议，确保交互数据的传输安全。</li>
<li>域名：应该尽量将 API 部署在专用域名之下。i.e (<a href="https://api.example.com)[https://api.example.com]">https://api.example.com)[https://api.example.com]</a></li>
<li>版本控制：将版本号放在 URL 或者 HTTP头 Header 中 (<a target="_blank" rel="noopener" href="https://api.example.com/v1/)[https://api.example.com/v1/]">https://api.example.com/v1/)[https://api.example.com/v1/]</a></li>
<li>路径：只能包含复数名词且与数据库的表格名对应，不能包括动词，因为是定位和指向资源 。</li>
<li>URI使用嵌套表示关联关系，(<a target="_blank" rel="noopener" href="https://api.example.com/v1/users/12/repos/5)[https://api.example.com/v1/users/12/repos/5]">https://api.example.com/v1/users/12/repos/5)[https://api.example.com/v1/users/12/repos/5]</a></li>
<li>使用正确的HTTP方法，如：GET/POST/PUT/DELETE</li>
<li>不符合CRUD的情况：POST /action/子资源</li>
</ul>
<p>响应设计规范<br>查询<br>分页<br>字段过滤</p>
<ul>
<li><code>?limit=10</code> 指定返回记录的数量</li>
<li><code>?offset=10</code> 指定返回记录的开始位置。</li>
<li><code>?page=2&amp;per_page=100</code>：指定第几页，以及每页的记录数。 </li>
<li><code>?sortby=name&amp;order=asc</code>：指定返回结果按照哪个属性排序，以及排序顺序</li>
<li><code>?animal_type_id=1</code>：指定筛选条件<br>状态码</li>
</ul>
<p>错误处理（Error handling）<br>如果状态码是4xx，就应该向用户返回出错信息。一般来说，返回的信息中将error作为键名，出错信息作为键值即可。</p>
<figure class="highlight subunit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line"><span class="keyword">error: </span>"Invalid API key"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2.4.3 返回信息分类<br>业务数据信息。<br>操作成功提示信息。<br>错误异常信息，决定API的优劣程度，如果返回的错误异常信息不够标准，客户端很难处理错误。<br>{<br>    “msg”: “xxx”, // 错误异常信息<br>    “error_code”: 1000, // 错误码<br>    “request”: url // 当前的http请求url路径<br>}<br>3. 异常处理<br>3.1 已知异常<br>我们可以预知的异常。 解决办法：抛出APIException。</p>
<p>3.2 未知异常<br>我们没有意识到的异常，如何统一数据的返回格式？即json格式。</p>
<p>解决办法：在全局的某个地方捕获到所有未知异常，统一处理未知异常——AOP思想。 将未知异常分为两种：HTTPException/Exception。分别代表HTTP错误和服务器代码错误，最后都包装成APIException抛出。</p>
<p>参数的设计允许存在冗余，即允许API路径和URL参数偶尔有重复。比如，GET <code>/zoo/ID/animals</code> 与 GET <code>/animals?zoo_id=ID</code> 的含义是相同的。</p>
<ul>
<li>Hypermedia API：在返回结果中提供相关资源的url链接，连向其他 API 方法，使得用户不查文档，也知道下一步应该做什么。<br>　　比如，当用户向api.example.com的根目录发出请求，会得到这样一个文档。<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{<span class="attr">"link"</span>: { </span><br><span class="line">  <span class="attr">"rel"</span>:   <span class="string">"collection https://www.example.com/zoos"</span>,</span><br><span class="line">  <span class="attr">"href"</span>:  <span class="string">"https://api.example.com/zoos"</span>,</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"List of zoos"</span>,</span><br><span class="line">  <span class="attr">"type"</span>:  <span class="string">"application/vnd.yourformat+json"</span>}}</span><br></pre></td></tr></tbody></table></figure>
上面代码表示，文档中有一个link属性，用户读取这个属性就知道下一步该调用什么API了。rel表示这个API与当前网址的关系（collection关系，并给出该collection的网址），href表示API的路径，title表示API的标题，type表示返回类型。<br>　　Hypermedia API的设计被称为HATEOAS。Github的API就是这种设计，访问api.github.com会得到一个所有可用API的网址列表。<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"current_user_url"</span>: <span class="string">"https://api.github.com/user"</span>,</span><br><span class="line">  <span class="attr">"authorizations_url"</span>: <span class="string">"https://api.github.com/authorizations"</span>,</span><br><span class="line">  <span class="comment">// ...}</span></span><br></pre></td></tr></tbody></table></figure>
从上面可以看到，如果想获取当前用户的信息，应该去访问api.github.com/user，然后就得到了下面结果。<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"Requires authentication"</span>,</span><br><span class="line">  <span class="attr">"documentation_url"</span>: <span class="string">"https://developer.github.com/v3"</span>}</span><br></pre></td></tr></tbody></table></figure>
上面代码表示，服务器给出了提示信息，以及文档的网址。</li>
</ul>
<p>安全</p>
<ul>
<li>HTTPS</li>
<li>限流 Rate limiting</li>
<li>验证鉴权（Authentication）：确定用户是其申明的身份，比如提供账户的密码。</li>
<li>授权（Authorization）：保证用户有对请求资源特定操作的权限。比如用户的私人信息只能自己能访可，其他人无法看到；有些特殊的操作只能管理员可以操作，其他用户有只读的权限等。</li>
</ul>
<p>开发者友好</p>
<ul>
<li>文档</li>
<li>超媒体</li>
</ul>
<p>DRF通过视图集ViewSet的方式让我们对某一个数据类Model可以进行增删改查，<br>而且不同的操作对应于不同的请求方式，<br>比如查看所有books用get方法，添加一本book用post方法等，让整个后端服务是restful的。</p>
<p>前端的展示和表单，希望达到两个目标，一是能从后端请求到所有的books列表，二是能往后端添加一条book数据。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.route('', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_book</span>():</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'get book'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>():</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'create book'</span></span><br></pre></td></tr></tbody></table></figure>

<p>REST的使用场景有两个：内部开发API，开放API。</p>
<p>标准的REST 不适合内部开发，适合开放性的API。只负责提供数据，不负责业务逻辑、不关心具体的前端是什么<br>因为标准 REST 有 CURD 四种操作，不一定能够承载业务。<br>缺点</p>
<ol>
<li><p>由于内部的开发，业务逻辑非常复杂，想用简单的四个接口来标示所有的业务逻辑，基本上是不可能的，会在视图函数增加大量的参数适配复杂的逻辑</p>
</li>
<li><p>REST的接口粒度比较粗（返回的资源属性比较多；服务器不会负责处理数据），这样前端的开发是不太方便的<br>比如前端需要用户的年龄，但是 user 类下面有 name、iphone、age、email、password 等，查询返回的就是整个 user 的信息，需要前端而不是服务器再进行筛选！</p>
</li>
<li><p>标准的REST 不考虑业务逻辑，一个接口只返回一个资源，当需要返回多个有关联资源时，无法一次性全部返回，只能发送多个请求依次取得数据，造成 HTTP 请求的数量大幅增加。</p>
</li>
</ol>
<ul>
<li>尽量遵从REST的设计风格规范，同时也不要死板追求 REST 要求，要灵活一些，</li>
<li>如果前端需要接口考虑业务逻辑的话，那么我们的接口就不要完全遵守资源的限制，应该让API具有业务逻辑的性质</li>
<li>如果前端需要几个资源合并在一起的数据，那么我们就为前端定制一个合并数据的接口，一次性把数据全部返回到前端</li>
</ul>
<ol start="4">
<li>Token<br>用户有效身份的凭据。</li>
</ol>
<p>4.1 三个特征<br>有效期，一般为2小时。<br>标识用户的身份，存储用户ID号。<br>Token是加密的。<br>4.2 Token有什么用<br>4.2.1 保护接口（auth拦截器）<br>只有登录的用户，才可访问某些接口，而是否可访问的校验通过Token实现。 访问接口时若令牌没有过期，而且合法，那么可以通过接口进行正确操作。</p>
<p>4.3 Token如何使用<br>可自定义传入账号和密码，但HTTP协议本身就规定了一种传递账号和密码的方法。 将账号和密码放入header中发送：<br>key=Authorization<br>value=basic base64(account:password)<br>将Token当作account发送，password不传任何数据。<br>4.4 验证Token的代码应该写在什么地方？<br>利用装饰器，哪个接口需要Token验证，就在哪个接口上方加入装饰器。</p>
<p>关于用户的思考<br>不管是网站也好，还是API也好，我们都逃脱不了用户这个概念，我们下面就要来讨论用户的相关操作。</p>
<p>对于用户而言，第一件事情，我们就要完成用户注册的操作，说到注册用户，我们想到，可以在视图函数文件中增加一个注册用户的视图函数–create_user，并且我们会在其中接受账号和密码，来完成用户的注册，这个逻辑是通常意义上的用户的概念。</p>
<p>普通用户：使用鱼书的人相对于鱼书来说，就是用户；我们相对于QQ和微信，也是他的用户。</p>
<p>但是我们在做API的时候，不能只考虑这些普通意义的用户，我们还要考虑一些特别的用户。例如：我们开发了一个向外提供数据的API，假如有一天，有一个公司，想使用我们的API开发他们自己的产品（小程序或者APP），这些其他的客户端，都是我们API的用户。</p>
<p>根据以上的分析，我们可以得出几个结论：<br>对于API而言，再叫做用户就不太合适 ，我们更倾向于把人，第三方的产品等同于成为客户端（client）来代替User。</p>
<p>客户端的种类非常多，注册的形式就非常多。如对于普通的用户而言，就是账号和密码，但是账号和密码又可以分成，短信，邮件，社交用户。对于多种的注册形式，也不是所有的都需要密码，如小程序就不需要。<br>API和普通的业务系统是不一样的，他具有开放性和通用性。</p>
<p>因为注册的形式就非常多，所以我们不可能用万能的方式来解决。如果我们不能很好的处理多种多样的形式，我们的代码就会非常的杂乱。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/selenium/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/selenium/" class="post-title-link" itemprop="url">selenium</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-07 13:55:02" itemprop="dateModified" datetime="2021-05-07T13:55:02Z">2021-05-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一个浏览器自动化测试的框架，可以通过 Python 代码来控制浏览器完成相关的测试，同时也能辅助完成数据的爬取。利用它我们可以驱动浏览器执行特定的动作，如点击、下拉等操作。对于一些JavaScript渲染的页面来说，这种抓取方式非常有效。</p>
<ul>
<li>开源免费</li>
<li>使用灵活、简单</li>
<li>后期用例易于维护</li>
<li>支持多种语言</li>
<li>容易与单元测试框架结合</li>
<li>可支持多浏览器同时，支持远程启动其他服务器</li>
<li>高度复用性</li>
<li>代码可自主掌控，对于搭建框架、平台等有不可替代的优势</li>
</ul>
<p>安装chrome浏览器驱动<br>为什么需要浏览器驱动呢？这还得从selenium的原理开始讲：</p>
<p>​    当Selenium提出了WebDriver的概念之后，它提供了利用浏览器原生的接口，封装成一套更加面向对象的Selenium WebDriver API，直接操作浏览器页面里的元素，甚至操作浏览器本身（截屏，窗口大小，启动，关闭，安装插件）。</p>
<p>​     由于使用的是浏览器原生的接口，速度大大提高，而且调用的稳定性交给了浏览器厂商本身，显然是更加科学。然而带来的一些副作用就是，不同的浏览器厂商，对Web元素的操作和呈现多少会有一些差异，这就直接导致了Selenium  WebDriver要分浏览器厂商不同，而提供不同的实现。例如Firefox就有专门的geckoDriver驱动，Chrome就有专门的Chrome驱动等。</p>
<p>这里特别要注意：chrome浏览器驱动必须和安装的chrome浏览器版本对应。那么如何保证对应呢？</p>
<p>1.先检查chrome浏览器的版本：点击chrome浏览器右上角的三个点–&gt;帮助–&gt;关于Google Chrome，如下图所示：</p>
<p><img src="https://img-blog.csdnimg.cn/20200404072628618.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlbmdqaWFuZ2NodW4=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>2.chrome浏览器驱动下载地址：</p>
<p>Chromedriver驱动下载地址：<a target="_blank" rel="noopener" href="http://npm.taobao.org/mirrors/chromedriver/">http://npm.taobao.org/mirrors/chromedriver/</a></p>
<p>找到和上图chrome版本最接近的版本：上图为：78.0.3904.108，所以这里驱动选择：</p>
<p><img src="https://img-blog.csdnimg.cn/20200404073158790.png" alt="img"></p>
<p>下载完成后：把chrome驱动包放入：C:\python37 目录下 （这个是必须的）</p>
<p>Edge驱动 <a target="_blank" rel="noopener" href="https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/">https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/</a></p>
<ul>
<li>火狐 驱动<ul>
<li>下载firefox浏览器驱动 Mozilla GeckoDriver<br> （ 官网 <a target="_blank" rel="noopener" href="https://github.com/mozilla/geckodriver/releases/tag/v0.23.0%EF%BC%89">https://github.com/mozilla/geckodriver/releases/tag/v0.23.0）</a></li>
</ul>
</li>
</ul>
<p><img src="/2020/08/21/selenium/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200814235134327.png" alt="image-20200814235134327"></p>
<p><a target="_blank" rel="noopener" href="https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/">https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/</a></p>
<p>python只能启动浏览器稳定版本，不能启动canary，除非改edge的软链接？</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># driver = 'C:\\Users\\rose\\Downloads\\Compressed\\chromedriver.exe'</span></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\edgedriver_win64\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver=webdriver.Edge(driver_path)  <span class="comment"># 创建chrome驱动</span></span><br><span class="line">driver.get(<span class="string">"https://www.baidu.com"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>（3）将驱动移动到python安装目录 C:\Users\rose\AppData\Local\Programs\Python\Python38\</p>
<p>（4）重启 IDEA，记得一定要</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># driver = 'C:\\Users\\rose\\Downloads\\Compressed\\chromedriver.exe'</span></span><br><span class="line"><span class="comment"># driver_path = 'C:\\Users\\rose\\Downloads\\edgedriver_win64\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge()  <span class="comment"># 创建Edge浏览器驱动</span></span><br><span class="line">driver = webdriver.Firefox()    <span class="comment"># Firefox浏览器</span></span><br><span class="line">driver = webdriver.Chrome()     <span class="comment"># Chrome浏览器</span></span><br><span class="line">driver = webdriver.Ie()         <span class="comment"># Ie浏览器</span></span><br><span class="line">driver = webdriver.PhantomJS()  <span class="comment"># PhantomJS()</span></span><br><span class="line">driver.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"></span><br><span class="line">deiver.quit()  <span class="comment"># 关闭当前的浏览器窗口，退出webdriver释放资源</span></span><br><span class="line">deiver.close()  <span class="comment"># 关闭当前的浏览器窗口，关闭之后还想开 </span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>deiver.quit()</code> 关闭当前的浏览器窗口，退出webdriver释放资源</li>
<li><code>deiver.close()</code> 关闭当前的浏览器窗口，关闭之后还想开</li>
</ul>
<p><code>EC.title_contains</code>/<code>EC.title_is</code><br>这两个方法都是用来判断title的，区别是：<br><code>EC.title_contains</code>只要包含即可<br><code>EC.title_is</code>必须完全匹配</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># title中包含即可</span></span><br><span class="line">print(EC.title_contains(<span class="string">"百度"</span>)(driver))  <span class="comment"># True</span></span><br><span class="line">print(EC.title_contains(<span class="string">"必应"</span>)(driver))  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># title完全匹配</span></span><br><span class="line">print(EC.title_is(<span class="string">"百度一下"</span>)(driver))  <span class="comment"># False</span></span><br><span class="line">print(EC.title_is(<span class="string">"百度一下，你就知道"</span>)(driver))  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="控制浏览器操作"><a href="#控制浏览器操作" class="headerlink" title="控制浏览器操作"></a>控制浏览器操作</h3><ul>
<li><code>set_window_size()</code> 来设置浏览器窗口的大小 </li>
<li><code>maximize_window()</code> 使打开的浏览器全屏显示。</li>
<li><code>back()</code> 和 <code>forward()</code> 来模拟控制浏览器后退、前进按钮。</li>
<li><code>refresh()</code> 刷新页面 F5</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.get(<span class="string">"https://www.imooc.com"</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.back()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.forward()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.refresh()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'browser will be closed'</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<p><strong>2.Selenium元素定位</strong><br>HTML浏览器的开发者模式选择元素复制对应元素属性值</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">link</span>=<span class="string">"#0000cc"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"result_logo"</span> <span class="attr">href</span>=<span class="string">"/"</span> <span class="attr">onmousedown</span>=<span class="string">"return c({'fm':'tab','tab':'logo'})"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form"</span> <span class="attr">class</span>=<span class="string">"fm"</span> <span class="attr">name</span>=<span class="string">"f"</span> <span class="attr">action</span>=<span class="string">"/s"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"soutu-btn"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"kw"</span> <span class="attr">class</span>=<span class="string">"s_ipt"</span> <span class="attr">name</span>=<span class="string">"wd"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">maxlength</span>=<span class="string">"255"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p> Message: element not interactable</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 id 定位</span></span><br><span class="line">dr.find_element_by_id(<span class="string">"kw"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过name定位:</span></span><br><span class="line">dr.find_element_by_name(<span class="string">"wd"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 class_name定位:</span></span><br><span class="line">dr.find_element_by_class_name(<span class="string">"s_ipt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 tag_name 标签名定位:</span></span><br><span class="line">dr.find_element_by_tag_name(<span class="string">"input"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 xpath 定位的几种写法</span></span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//*[@id='kw']"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//*[@name='wd']"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//input[@class='s_ipt']"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"/html/body/form/span/input"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//span[@class='soutu-btn']/input"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//form[@id='form']/span/input"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//input[@id='kw' and @name='wd']"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 css 定位的几种写法</span></span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"#kw"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"[name=wd]"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">".s_ipt"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"html &gt; body &gt; form &gt; span &gt; input"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"span.soutu-btn&gt; input#kw"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"form#form &gt; span &gt; input"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 link_text / partial_link_text 定位</span></span><br><span class="line">dr.find_element_by_link_text(<span class="string">"新闻"</span>)</span><br><span class="line">dr.find_element_by_link_text(<span class="string">"hao123"</span>)</span><br><span class="line">dr.find_element_by_partial_link_text(<span class="string">"新"</span>)</span><br><span class="line">dr.find_element_by_partial_link_text(<span class="string">"hao"</span>)</span><br><span class="line">dr.find_element_by_partial_link_text(<span class="string">"123"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是定位一组元素，用下面</span></span><br><span class="line">find_elements_by_id()</span><br><span class="line">find_elements_by_name()</span><br><span class="line">find_elements_by_class_name()</span><br><span class="line">find_elements_by_tag_name()</span><br><span class="line">find_elements_by_link_text()</span><br><span class="line">find_elements_by_partial_link_text()</span><br><span class="line">find_elements_by_xpath()</span><br><span class="line">find_elements_by_css_selector()</span><br></pre></td></tr></tbody></table></figure>

<hr>
<p><code>form.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">title</span>&gt;</span>Form<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">async</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bootstrap-combined.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">h3</span>&gt;</span>simple login form<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputEmail"</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"inputEmail"</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span> <span class="attr">name</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputPassword"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"inputPassword"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> Remember me</span><br><span class="line">           <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(<span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/form.html"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># by id</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'inputEmail'</span>).click()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by name</span></span><br><span class="line">driver.find_element_by_name(<span class="string">'password'</span>).click()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by tagname</span></span><br><span class="line">print(driver.find_element_by_tag_name(<span class="string">'form'</span>).get_attribute(<span class="string">'class'</span>))  <span class="comment"># form-horizontal</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by classname</span></span><br><span class="line">el = driver.find_element_by_class_name(<span class="string">'controls'</span>)</span><br><span class="line">driver.```<span class="string">'$(arguments[0]).fadeOut().fadeIn()'</span>,el)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by linktext</span></span><br><span class="line">link = driver.find_element_by_link_text(<span class="string">'register'</span>)</span><br><span class="line">driver.```<span class="string">'$(arguments[0]).fadeOut().fadeIn()'</span>,link)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">partial = driver.find_element_by_partial_link_text(<span class="string">'reg'</span>)</span><br><span class="line">driver.```<span class="string">'$(arguments[0]).fadeOut().fadeIn()'</span>,partial)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># by css selector</span></span><br><span class="line"><span class="comment"># div = driver.find_element_by_css_selector('body &gt; form &gt; div:nth-child(1) &gt; div')</span></span><br><span class="line"><span class="comment"># driver.execute_script('$(arguments[0]).fadeOut().fadeIn()',div)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#by xpath</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">'//*[@id="inputEmail"]'</span>).click()</span><br><span class="line">driver.find_element_by_xpath(<span class="string">'//*[name="email"]'</span>).click()</span><br><span class="line"><span class="comment"># driver.find_element_by_xpath("/html/body/form/div[3]/div/button").click()</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">定位一组同类型元素批量操作</span><br><span class="line">```py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">driver_path = 'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/checkbox.html")</span><br><span class="line"># 所有的checkbox 并勾选</span><br><span class="line"></span><br><span class="line"># css_selector定位</span><br><span class="line"># checkboxes = driver.find_elements_by_css_selector('input[type=checkbox]')</span><br><span class="line"># for chk in checkboxes:</span><br><span class="line">#     chk.click()</span><br><span class="line"></span><br><span class="line"># tag定位</span><br><span class="line">inputs = driver.find_elements_by_tag_name('input')</span><br><span class="line">for input in inputs:</span><br><span class="line">    if input.get_attribute('type') == 'checkbox':</span><br><span class="line">        input.click()</span><br><span class="line">        sleep(1)</span><br><span class="line">sleep(1)</span><br><span class="line"></span><br><span class="line"># 最后一个取消勾选</span><br><span class="line">driver.find_elements_by_css_selector('input[type=checkbox]').pop().click()</span><br><span class="line">sleep(1)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<h4 id="元素简单操作"><a href="#元素简单操作" class="headerlink" title="元素简单操作"></a>元素简单操作</h4><ul>
<li><code>.click()</code> 点击、</li>
<li><code>.clear()</code> 清除</li>
<li><code>el.send_keys('hello')</code> 输入</li>
<li><code>submit()</code> 方法用于提交表单，在搜索框后输入关键字后，可用于“回车”模拟。</li>
<li><code>size</code>： 返回元素的尺寸。</li>
<li><code>text</code>： 获取元素的文本。</li>
<li><code>get_attribute(name)</code>： 获得属性值。</li>
<li><code>is_displayed()</code>： 设置该元素是否用户可见。</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line">browser.get(base_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 其他常用方法</span></span><br><span class="line">size = browser.find_element_by_id(<span class="string">'kw'</span>).size</span><br><span class="line">print(<span class="string">"返回元素的尺寸：%s"</span> % size)</span><br><span class="line"></span><br><span class="line">text = browser.find_element_by_id(<span class="string">'cp'</span>).text</span><br><span class="line">print(<span class="string">"返回元素的文本：%s"</span> % text)</span><br><span class="line"></span><br><span class="line">attribute = browser.find_element_by_id(<span class="string">'kw'</span>).get_attribute(<span class="string">'type'</span>)</span><br><span class="line">print(<span class="string">"返回元素的属性：%s"</span> % attribute)</span><br><span class="line"></span><br><span class="line">result = browser.find_element_by_id(<span class="string">'kw'</span>).is_displayed()</span><br><span class="line">print(<span class="string">"返回元素是否可见：%s"</span> % result)</span><br><span class="line"></span><br><span class="line">browser.quit()</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/form.html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">el = driver.find_element_by_xpath(<span class="string">"//*[@id='inputEmail']"</span>)</span><br><span class="line">el.send_keys(<span class="string">'jackson'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.clear()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='inputPassword']"</span>).send_keys(<span class="string">'123456'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"/html/body/form/div[3]/div/button"</span>).click()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><strong>1.鼠标事件</strong></p>
<p>在webdriver中，鼠标操作的方法封装在 <code>ActionChains</code> 类提供。<code>ActionChains</code> 类提供了鼠标操作的常用方法：</p>
<blockquote>
<p>ActionChains(driver)，将浏览器驱动 driver 作为参数传入。</p>
<p>(1) <code>perform()</code>: 执行所有 ActionChains 中存储的行为，是对整个操作的提交动作；</p>
<p>(2) <code>context_click()</code>: 右击</p>
<p>(3) <code>double_click()</code>: 双击</p>
<p>(4) <code>drag_and_drop()</code>: 拖动</p>
<p>(5) <code>move_to_element()</code>: 鼠标悬停， 在调用时需要指定元素定位</p>
</blockquote>
<p>Action<br>key_down 模拟按键按下<br>key_up<br>click<br>send_keys<br>click_and_hold<br>release<br>move_to</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/sendkeys.html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">double_click_el = driver.find_element_by_id(<span class="string">'A'</span>)</span><br><span class="line">ActionChains(driver).double_click(double_click_el).context_click(</span><br><span class="line">    double_click_el).perform()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p>键盘事件<br> 前面的 send_keys() 方法用来模拟键盘输入；keys() 类提供了键盘上几乎所有按键的方法，组合键也是可以的。</p>
<p>常用的键盘操作如下：</p>
<blockquote>
<p>send_keys(Keys.BACK_SPACE) 删除键（BackSpace）<br>send_keys(Keys.SPACE) 空格键(Space)<br>send_keys(Keys.TAB) 制表键(Tab)<br>send_keys(Keys.ESCAPE) 回退键（Esc）<br>send_keys(Keys.ENTER) 回车键（Enter）<br>send_keys(Keys.CONTROL,’a’) 全选（Ctrl+A）<br>send_keys(Keys.CONTROL,’c’) 复制（Ctrl+C）<br>send_keys(Keys.CONTROL,’x’) 剪切（Ctrl+X）<br>send_keys(Keys.CONTROL,’v’) 粘贴（Ctrl+V）<br>send_keys(Keys.F1) 键盘 F1<br>……<br>send_keys(Keys.F12) 键盘 F12</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line">driver.get(base_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 先输入百度</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(<span class="string">'百度'</span>)</span><br><span class="line"><span class="comment"># 1.删除度</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.BACK_SPACE)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.键入空格</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.SPACE)</span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(<span class="string">'加入空格'</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ctrl+a 全选输入框里的内容</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.CONTROL, <span class="string">'a'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ctrl+x 剪切输入框里的内容</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.CONTROL, <span class="string">'x'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. ctrl+v 粘贴剪切的内容</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.CONTROL, <span class="string">'v'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 回车</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'su'</span>).send_keys(Keys.ENTER)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/sendkeys.html"</span></span><br><span class="line">)</span><br><span class="line">driver.find_element_by_id(<span class="string">'A'</span>).send_keys((Keys.CONTROL, <span class="string">'a'</span>))</span><br><span class="line">driver.find_element_by_id(<span class="string">'A'</span>).send_keys((Keys.CONTROL, <span class="string">'x'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'B'</span>).send_keys((Keys.CONTROL, <span class="string">'v'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'B'</span>).send_keys((Keys.CONTROL, <span class="string">'a'</span>))</span><br><span class="line">driver.find_element_by_id(<span class="string">'B'</span>).send_keys((Keys.CONTROL, <span class="string">'c'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'A'</span>).send_keys((Keys.CONTROL, <span class="string">'v'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>






<p><strong>Selenium之-警告框处理</strong></p>
<p>在 webdriver 中处理 JavaScript 所生成的 alert、confirm 以及 prompt 十分简单，<br>具体做法是使用  switch_to.alert 方法定位到 alert/confirm/prompt，然后使用 text/accept/dismiss/  send_keys 等方法进行操作。<br>弹出框处理</p>
<blockquote>
<p><code>text</code>：返回 alert/confirm/prompt 中的文字信息。<br><code>accept()</code>：接受现有警告框。<br><code>dismiss()</code>：无视现有警告框。<br><code>send_keys(keysToSend)</code>：发送文本至prompt警告框。keysToSend：将文本发送至警告框。原生的js，不会在python终端显示</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">driver.get(base_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 鼠标悬停至 “设置” 链接</span></span><br><span class="line">link = driver.find_element_by_link_text(<span class="string">'设置'</span>)</span><br><span class="line">ActionChains(driver).move_to_element(link).perform()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开搜索设置</span></span><br><span class="line">driver.find_element_by_link_text(<span class="string">'搜索设置'</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击 “搜索设置”</span></span><br><span class="line">driver.find_element_by_class_name(<span class="string">'prefpanelgo'</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接受警告框prefpanelgo</span></span><br><span class="line">driver.switch_to.alert.accept()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><code>alert.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>attribute<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">async</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"D:/Besttest/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>alert<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row-fluid"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"span6"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"tooltip"</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">data-toggle</span>=<span class="string">"tooltip"</span> <span class="attr">title</span>=<span class="string">"selenium-webdriver"</span> <span class="attr">onclick</span>=<span class="string">"alert(this.title);"</span>&gt;</span>hover to see tooltip<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(<span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/alert.html"</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'tooltip'</span>).click()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">alert = driver.switch_to.alert</span><br><span class="line">print(alert.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">alert.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<p><code>confirm.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>confirm<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">???????????????</span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"JavaScript"</span>&gt;</span></span><br><span class="line">            </span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(confirm(<span class="string">"are you ready?"</span>)){</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">"Go!"</span>);</span></span><br><span class="line">            }</span><br><span class="line"><span class="javascript">            <span class="keyword">else</span>{</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">"Hold on!"</span>);</span></span><br><span class="line">            }</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/confirm.html"</span></span><br><span class="line">)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">confirm = driver.switch_to.alert</span><br><span class="line">print(confirm.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">confirm.dismiss()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">print(confirm.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">confirm.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 法一</span></span><br><span class="line"><span class="comment"># alert = driver.switch_to.alert</span></span><br><span class="line"><span class="comment"># print(alert.text)</span></span><br><span class="line"><span class="comment"># sleep(2)</span></span><br><span class="line"><span class="comment"># alert.accept()</span></span><br><span class="line"><span class="comment"># sleep(2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line">print(confirm.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">confirm.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<p><code>prompt.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">'JavaScript'</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> aa= prompt(<span class="string">"What's your name?"</span>,<span class="string">"haha"</span>);</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.write(<span class="string">"Welcome to my world, "</span>+aa+<span class="string">"&lt;br&gt;"</span>)</span></span><br><span class="line">/*</span><br><span class="line"><span class="javascript"><span class="keyword">if</span>(confirm(<span class="string">"准备好了吗？？"</span>)){</span></span><br><span class="line"><span class="javascript">  alert(<span class="string">"那就开始吧！！"</span>);</span></span><br><span class="line">}</span><br><span class="line"><span class="javascript"><span class="keyword">else</span>{</span></span><br><span class="line"><span class="javascript">  alert(<span class="string">"再等一下"</span>);</span></span><br><span class="line">}</span><br><span class="line">*/</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/prompt.html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">prompt = driver.switch_to.alert</span><br><span class="line">print(prompt.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">prompt.send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">prompt.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><br>Selenium 场景警告场景学习<br>在页面操作过程中有时候点击某个链接会弹出新的窗口，这时就需要主机切换到新打开的窗口上进行多页面切换</p>
<blockquote>
<p><code>current_window_handle</code>：获得当前窗口句柄<br><code>window_handles</code>：返回所有窗口的句柄到当前会话<br><code>switch_to.window()</code>：用于切换到相应的窗口</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line"><span class="comment"># 隐式等待10秒</span></span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">browser.get(base_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得搜索窗口的句柄</span></span><br><span class="line">search_windows = browser.current_window_handle</span><br><span class="line">browser.find_element_by_link_text(<span class="string">'登录'</span>).click()</span><br><span class="line">browser.find_element_by_link_text(<span class="string">'立即注册'</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得当前打开窗口的句柄</span></span><br><span class="line">all_handles = browser.window_handles</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入注册窗口</span></span><br><span class="line"><span class="keyword">for</span> handle <span class="keyword">in</span> all_handles:</span><br><span class="line">    <span class="keyword">if</span> handle != search_windows:</span><br><span class="line">        browser.switch_to.window(handle)</span><br><span class="line">        print(<span class="string">'now register window!'</span>)</span><br><span class="line">        browser.find_element_by_name(<span class="string">'account'</span>).send_keys(<span class="string">'username'</span>)</span><br><span class="line">        browser.find_element_by_name(<span class="string">'password'</span>).send_keys(<span class="string">'password'</span>)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">browser.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><code>multi.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">title</span>&gt;</span>Form<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">async</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bootstrap-combined.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">h3</span>&gt;</span>simple login form<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputEmail"</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"inputEmail"</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span> <span class="attr">name</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputPassword"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"inputPassword"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> Remember me</span><br><span class="line">           <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.baidu.com"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)//multi.html"</span></span><br><span class="line">)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">first_window = driver.current_window_handle  <span class="comment"># 将首页句柄暂存</span></span><br><span class="line">driver.find_element_by_link_text(<span class="string">'register'</span>).click()</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">all_window = driver.window_handles  <span class="comment"># 获取所有句柄</span></span><br><span class="line"><span class="keyword">for</span> handle <span class="keyword">in</span> all_window:</span><br><span class="line">    <span class="keyword">if</span> handle != first_window:  <span class="comment"># 遍历找到不等于首页的</span></span><br><span class="line">        driver.switch_to.window(handle)</span><br><span class="line">        print(<span class="string">'jumping!!'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'su'</span>).click()</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">driver.switch_to.window(first_window)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">el = driver.find_element_by_xpath(<span class="string">"//*[@id='inputEmail']"</span>)</span><br><span class="line">el.send_keys(<span class="string">'jackson'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.clear()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='inputPassword']"</span>).send_keys(<span class="string">'123456'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"/html/body/form/div[3]/div/button"</span>).click()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># driver.quit()</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/sort-sorted/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/sort-sorted/" class="post-title-link" itemprop="url">sort sorted</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-24 14:43:40" itemprop="dateModified" datetime="2021-04-24T14:43:40Z">2021-04-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="list-sort"><a href="#list-sort" class="headerlink" title="list.sort()"></a><code>list.sort()</code></h1><p>只是为列表定义的，返回的是对已经存在的列表进行操作，没有新建列表</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line">a.sort()  <span class="comment"># sort返回的是对已经存在的列表进行操作</span></span><br><span class="line">print(a)  <span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line">print([<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>].sort())  <span class="comment"># None sort返回的是对已经存在的列表进行操作，没有新建列表</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>sorted(iterable, key=None, reverse=False)</code><br>返回的是一个新的对所有可迭代的对象进行排序操作的列表，而不是在原来的基础上进行的操作。<br>iterable – 可迭代对象。<br>key – 用来进行比较的元素，只有一个参数，具体的函数的参数就是取自于可迭代对象中，<br>指定可迭代对象中的一个元素来进行排序。<br>Key参数/键函数<br>从python2.4开始，list.sort()和sorted()函数增加了key参数来指定在进行比较前要在每个列表元素上调用的函数（或其他可调用对象）。<br>key 形参的值应该是个函数（或其他可调用对象），它接受一个参数并返回一个用于排序的键。 这种机制速度很快，因为对于每个输入记录只会调用一次键函数。</p>
<p>reverse – 排序规则，reverse = True 降序 ，reverse = False 升序（默认）。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">example_list = [<span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">result_list = sorted(example_list)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [0, 1, 2, 3, 4, 5, 6, 7]默认升序</span></span><br><span class="line">result_list = sorted(example_list, reverse=<span class="literal">True</span>)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [7, 6, 5, 4, 3, 2, 1, 0] 反转降序</span></span><br><span class="line">result_list = sorted(example_list, key=<span class="keyword">lambda</span> x: x * <span class="number">-1</span>)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [7, 6, 5, 4, 3, 2, 1, 0]</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="将列表-1-2-3-4-5-6-7-8-9-按照元素与5距离从小到大进行排序"><a href="#将列表-1-2-3-4-5-6-7-8-9-按照元素与5距离从小到大进行排序" class="headerlink" title="将列表[1, 2, 3, 4, 5, 6, 7, 8, 9]按照元素与5距离从小到大进行排序"></a>将列表[1, 2, 3, 4, 5, 6, 7, 8, 9]按照元素与5距离从小到大进行排序</h2><p>法一</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(sorted([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], key=<span class="keyword">lambda</span> x: abs(<span class="number">5</span> - x)))  </span><br><span class="line"><span class="comment"># [5, 4, 6, 3, 7, 2, 8, 1, 9]</span></span><br></pre></td></tr></tbody></table></figure>

<p>法二</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> abs(<span class="number">5</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(sorted(list, key=run))  <span class="comment"># [5, 4, 6, 3, 7, 2, 8, 1, 9]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(sorted({<span class="number">1</span>: <span class="string">'D'</span>, <span class="number">2</span>: <span class="string">'B'</span>, <span class="number">3</span>: <span class="string">'B'</span>, <span class="number">4</span>: <span class="string">'E'</span>, <span class="number">5</span>: <span class="string">'A'</span>}))</span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line">print(sorted({<span class="number">1</span>: <span class="string">'D'</span>, <span class="number">2</span>: <span class="string">'B'</span>, <span class="number">3</span>: <span class="string">'B'</span>, <span class="number">4</span>: <span class="string">'E'</span>, <span class="number">5</span>: <span class="string">'A'</span>}, key=<span class="keyword">lambda</span> x: x * <span class="number">-1</span>))</span><br><span class="line"><span class="comment"># [5, 4, 3, 2, 1]</span></span><br></pre></td></tr></tbody></table></figure>

<p>通过key指定的内置函数来</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照小写字母排序</span></span><br><span class="line">print(sorted(<span class="string">"This is a test string from Andrew"</span>.split(), key=str.lower))</span><br><span class="line"><span class="comment"># ['a', 'Andrew', 'from', 'is', 'string', 'test', 'This']</span></span><br><span class="line"></span><br><span class="line">print(sorted([<span class="string">"adf"</span>, <span class="string">"Adfdg"</span>, <span class="string">"aDfgbdfafg"</span>, <span class="string">"Gahgfh"</span>], key = str.lower)) <span class="comment">#输出 ['adf', 'Adfdg', 'aDfgbdfafg', 'Gahgfh']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把数组按照长度大小进行排序，只需设置key等于一个函数即可</span></span><br><span class="line">sorted([<span class="string">"adf"</span>, <span class="string">"Adfdg"</span>, <span class="string">"aDfgbdfafg"</span>, <span class="string">"Gahgfh"</span>], key = len) </span><br><span class="line"><span class="comment">#输出 ['adf', 'adfdg', 'gahgfh', 'adfgbdfafg']</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>一种常见的模式是使用对象的一些索引作为键对复杂对象进行排序。例如：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>student_tuples = [</span><br><span class="line">        (<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>),</span><br><span class="line">        (<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>),</span><br><span class="line">        (<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>),</span><br><span class="line">]</span><br><span class="line"><span class="comment"># sort by age</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(student_tuples, key=<span class="keyword">lambda</span> student: student[<span class="number">2</span>])</span><br><span class="line">[(<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>), (<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>), (<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>)]</span><br></pre></td></tr></tbody></table></figure>

<p>同样的技术也适用拥有命名属性的对象，例如：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在排序时, 可以用lambda表达式将对象map成keys</span></span><br><span class="line"><span class="comment"># 亦可以使用operator包中的attrgetter和itemgetter函数以提高效率</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, grade, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.grade = grade</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> repr((self.name, self.grade, self.age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立一组Student对象</span></span><br><span class="line">students = [</span><br><span class="line">    Student(<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>),</span><br><span class="line">    Student(<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>),</span><br><span class="line">    Student(<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter</span><br><span class="line"></span><br><span class="line">print(sorted(students, key=<span class="keyword">lambda</span> o: o.age))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line">print(sorted(students, key=itemgetter(<span class="number">2</span>))) </span><br><span class="line"><span class="comment"># TypeError: 'Student' object is not subscriptable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对students按照年龄排序</span></span><br><span class="line">print(sorted(students, key=attrgetter(<span class="string">'age'</span>)))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Operator 模块功能允许多级排序。 先按age再按grade排序</span></span><br><span class="line">print(sorted(students, key=attrgetter(<span class="string">'age'</span>, <span class="string">'grade'</span>)))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例如，要按 grade 降序然后 age 升序对学生数据进行排序，请先 age 排序，然后再使用 grade 排序：</span></span><br><span class="line"><span class="comment"># sort on secondary key</span></span><br><span class="line">s = sorted(students, key=attrgetter(<span class="string">'age'</span>))</span><br><span class="line"><span class="comment"># now sort on primary key, descending</span></span><br><span class="line">print(sorted(s, key=attrgetter(<span class="string">'grade'</span>), reverse=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象为一个包装函数，该函数能接受一个列表以及字段和顺序的元组，以对它们进行多重排序。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multisort</span>(<span class="params">xs, specs</span>):</span></span><br><span class="line">    <span class="keyword">for</span> key, reverse <span class="keyword">in</span> reversed(specs):</span><br><span class="line">        xs.sort(key=attrgetter(key), reverse=reverse)</span><br><span class="line">    <span class="keyword">return</span> xs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(multisort(list(students), ((<span class="string">'grade'</span>, <span class="literal">True</span>), (<span class="string">'age'</span>, <span class="literal">False</span>))))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'blackmatrix'</span></span><br><span class="line"></span><br><span class="line">get_name = <span class="keyword">lambda</span> user: user[<span class="string">'name'</span>]</span><br><span class="line"></span><br><span class="line">get_address = <span class="keyword">lambda</span> user: getattr(user, <span class="string">'address'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, address</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.address = address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">laowang = {<span class="string">'name'</span>: <span class="string">'老王'</span>, <span class="string">'address'</span>: <span class="string">'隔壁'</span>}</span><br><span class="line">laoli = User(<span class="string">'老李'</span>, <span class="string">'楼下'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># itemgetter('name') 和 get_name 作用是相同的</span></span><br><span class="line">    <span class="comment"># 都是接受一个对象，获取对象key为name的值</span></span><br><span class="line">    <span class="comment"># 主要用来替代只是为了获取value的lambda函数</span></span><br><span class="line">    print(itemgetter(<span class="string">'name'</span>)(laowang))  <span class="comment"># 老王</span></span><br><span class="line">    print(itemgetter(<span class="string">'address'</span>)(laowang))  <span class="comment"># 隔壁</span></span><br><span class="line">    print(get_name(laowang))  <span class="comment"># 老王</span></span><br><span class="line">    <span class="comment"># print(get_address(laowang))  # 'dict' object has no attribute 'address'  </span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 同样的，attrgetter('address')也是等同于get_address</span></span><br><span class="line">    <span class="comment"># 用来替代只为了获取attr的lambda函数</span></span><br><span class="line">    print(attrgetter(<span class="string">'address'</span>)(laoli))  <span class="comment"># 楼下</span></span><br><span class="line">    print(get_address(laoli))  <span class="comment"># 楼下</span></span><br></pre></td></tr></tbody></table></figure>


<p>多字段排序<br>按照第一个数从小到大排序，如果第一个数相同，就按第二个数从大到小。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [[<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">1</span>],(<span class="number">2</span>,<span class="number">8</span>),(<span class="number">2</span>,<span class="number">1</span>),(<span class="number">3</span>,<span class="number">4</span>)]</span><br><span class="line">sorted(a, key = <span class="keyword">lambda</span> x: (x[<span class="number">0</span>], -x[<span class="number">1</span>])) </span><br><span class="line"><span class="comment"># 输出：[(2, 8), [2, 3], (2, 1), (3, 4), [4, 1]]</span></span><br></pre></td></tr></tbody></table></figure>
<p>其实掌握自定义规则排序，多字段排序也就会了，因为它是自定义排序的子集！</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">array = [{</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"a"</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"b"</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"c"</span></span><br><span class="line">}]</span><br><span class="line"><span class="comment"># 法一</span></span><br><span class="line">array = sorted(array, key=<span class="keyword">lambda</span> x: x[<span class="string">"age"</span>])</span><br><span class="line">print(array)</span><br><span class="line"><span class="comment"># [{'age': 10, 'name': 'c'}, {'age': 20, 'name': 'a'}, {'age': 25, 'name': 'b'}]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line"><span class="comment"># def by_age(info):</span></span><br><span class="line"><span class="comment">#     array = [{"age": 20, "name": "a"}, {"age": 25, "name": "b"}, {"age": 10, "name": "c"}]</span></span><br><span class="line"><span class="comment">#     return array.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># l1 = sorted(array, key=by_age)</span></span><br><span class="line"><span class="comment"># print('***')</span></span><br><span class="line"><span class="comment"># print(l1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多列排序</span></span><br><span class="line"><span class="comment"># 先按照成绩降序排序，相同成绩的按照名字升序排序：</span></span><br><span class="line">d1 = [{</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'alice'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">38</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'bob'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">18</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'darl'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">28</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'christ'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">28</span></span><br><span class="line">}]</span><br><span class="line">l = sorted(d1, key=<span class="keyword">lambda</span> x: (-x[<span class="string">'score'</span>], x[<span class="string">'name'</span>]))</span><br><span class="line">print(l)</span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line"><span class="comment"># [{'name': 'alice', 'score': 38}, {'name': 'christ', 'score': 28}, {'name': 'darl', 'score': 28}, {'name': 'bob', 'score': 18}]</span></span><br><span class="line"></span><br><span class="line">dictionary = {<span class="string">'name'</span>: <span class="string">'Ashe'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'city'</span>: <span class="string">'Guilin'</span>, <span class="string">'tel'</span>: <span class="string">'110'</span>}</span><br><span class="line">print(<span class="string">'---------'</span>)</span><br><span class="line"><span class="comment"># dict.items()结果是键值对元组</span></span><br><span class="line">print(dictionary.items())</span><br><span class="line"><span class="comment"># dict_items([('name', 'Ashe'), ('age', 18), ('city', 'Guilin'), ('tel', '110')])</span></span><br><span class="line"><span class="comment"># i[0]表示key i[1]表示value</span></span><br><span class="line">list = sorted(dictionary.items(), key=<span class="keyword">lambda</span> i: i[<span class="number">0</span>], reverse=<span class="literal">False</span>)  <span class="comment"># 不反转，即升序</span></span><br><span class="line">print(<span class="string">'sorted根据字典key排序'</span>, list)</span><br><span class="line">print(<span class="string">'-----'</span>)</span><br><span class="line">new_dict = {}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> list:</span><br><span class="line">    new_dict[i[<span class="number">0</span>]] = i[<span class="number">1</span>]</span><br><span class="line">print(<span class="string">'new dict'</span>, new_dict)</span><br><span class="line">print(<span class="string">'***'</span>)</span><br><span class="line"><span class="comment"># list = sorted(dictionary.items(), key=lambda i: i[1], reverse=False)</span></span><br><span class="line"><span class="comment"># print('sorted根据字典value排序', list)</span></span><br><span class="line"><span class="comment"># new_dict = {}</span></span><br><span class="line"><span class="comment"># for i in list:</span></span><br><span class="line"><span class="comment">#     new_dict[i[0]] = i[1]</span></span><br><span class="line"><span class="comment"># print('***')</span></span><br><span class="line"><span class="comment"># print('new dict', new_dict)</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">L = [(<span class="string">'Bob'</span>, <span class="number">75</span>), (<span class="string">'Adam'</span>, <span class="number">92</span>), (<span class="string">'Bart'</span>, <span class="number">66</span>), (<span class="string">'Lisa'</span>, <span class="number">88</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_name</span>(<span class="params">info</span>):</span>  <span class="comment"># 名字排序</span></span><br><span class="line">    <span class="comment"># print(info[0])</span></span><br><span class="line">    <span class="keyword">return</span> info[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_grade</span>(<span class="params">info</span>):</span>  <span class="comment"># 成绩排序</span></span><br><span class="line">    <span class="keyword">return</span> info[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L1 = sorted(L, key=by_name)</span><br><span class="line">L2 = sorted(L, key=by_name, reverse=<span class="literal">True</span>)</span><br><span class="line">L3 = sorted(L, key=by_grade)</span><br><span class="line">L4 = sorted(L, key=by_grade, reverse=<span class="literal">True</span>)</span><br><span class="line">print(L1)</span><br><span class="line">print(L2)</span><br><span class="line">print(L3)</span><br><span class="line">print(L4)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight scheme"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="symbol">'Adam</span>', <span class="number">92</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>)]</span><br><span class="line">[(<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Adam</span>', <span class="number">92</span>)]</span><br><span class="line">[(<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Adam</span>', <span class="number">92</span>)]</span><br><span class="line">[(<span class="symbol">'Adam</span>', <span class="number">92</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>)]</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/turtle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/turtle/" class="post-title-link" itemprop="url">turtle</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>turtle在屏幕上绘制图形<br>1.画布(canvas)<br>画布就是turtle为我们展开用于绘图区域默认大小(400, 300)，我们可以设置它的大小和初始位置。</p>
<p>2.画笔（pen）<br>2.1画笔的状态<br>在画布上，默认有一个坐标原点为画布中心的坐标轴，坐标原点上有一只面朝x轴正方向小乌龟。这里我们描述小乌龟时使用了两个词语：坐标原点(位置)，面朝x轴正方向(方向)， turtle绘图中，就是使用位置方向描述小乌龟(画笔)的状态。</p>
<p>2.2 画笔的属性<br>画笔(画笔的属性，颜色、画线的宽度等)</p>
<p>turtle.pensize()：设置画笔的宽度；<br>turtle.pencolor()：没有参数传入，返回当前画笔颜色，传入参数设置画笔颜色，可以是字符串如”green”,&nbsp;“red”,也可以是RGB&nbsp;3元组。<br>turtle.speed(speed)：设置画笔移动速度，画笔绘制的速度范围[0,10]整数，数字越大越快。<br>2.3 绘图命令<br>操纵海龟绘图有着许多的命令，这些命令可以划分为3种：一种为运动命令，一种为画笔控制命令，还有一种是全局控制命令。</p>
<p>2.3.1 画笔运动命令:</p>
<p>命令    说明<br>turtle.home()    将turtle移动到起点（0,0）和向东<br>turtle.speed(speed)    画笔绘制的速度范围[0,10]整数<br>turtle.forward(distance)    向当前画笔方向移动distance像素长<br>turtle.backward(distance)    向当前画笔相反方向移动distance像素长度<br>turtle.right(degree)    顺时针移动degree°<br>turtle.left(degree)    逆时针移动degree°<br>turtle.pendown()    移动时绘制图形放下笔,,默认绘制<br>turtle.penup()    移动时不绘制图形,提起笔，用于另起一个地方绘制时用<br>turtle.circle(r,extent,step)    绘制一个指定半径、弧度范围、阶数(正多边形)的圆<br>turtle.dot(diameter,color)    绘制一个指定直径和颜色的圆</p>
<p>绘制长方形</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line"></span><br><span class="line">turtle.pensize(<span class="number">4</span>)</span><br><span class="line">turtle.pencolor(<span class="string">'red'</span>)</span><br><span class="line"></span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">turtle.mainloop()</span><br></pre></td></tr></tbody></table></figure>

<p>绘制奥运五环</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line">turtle.width(<span class="number">10</span>)</span><br><span class="line">turtle.color(<span class="string">"blue"</span>)</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"black"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">120</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"red"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">240</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"yellow"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">60</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"green"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">180</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle <span class="comment">#导入 turtle 模块</span></span><br><span class="line">turtle.showturtle() <span class="comment">#显示箭头</span></span><br><span class="line">turtle.write(<span class="string">"xy"</span>) <span class="comment">#写字符串</span></span><br><span class="line">turtle.forward(<span class="number">300</span>) <span class="comment">#前进 300 像素</span></span><br><span class="line">turtle.color(<span class="string">"red"</span>) <span class="comment">#画笔颜色改为 red</span></span><br><span class="line">turtle.left(<span class="number">90</span>) <span class="comment">#箭头左转 90 度</span></span><br><span class="line">turtle.forward(<span class="number">300</span>)</span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">50</span>) <span class="comment">#去坐标（0,50）</span></span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">turtle.penup() <span class="comment">#抬笔。这样，路径就不会画出来</span></span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">300</span>)</span><br><span class="line">turtle.pendown() <span class="comment">#下笔。这样，路径就会画出来</span></span><br><span class="line">turtle.circle(<span class="number">100</span>) <span class="comment">#画圆</span></span><br></pre></td></tr></tbody></table></figure>

<p>pentagram</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">turtle</span></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">time</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.pensize</span>(<span class="number">5</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.pencolor</span>(<span class="string">"yellow"</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.fillcolor</span>(<span class="string">"red"</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.begin_fill</span>()</span><br><span class="line"><span class="selector-tag">for</span> <span class="selector-tag">_</span> <span class="selector-tag">in</span> <span class="selector-tag">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="selector-tag">turtle</span><span class="selector-class">.forward</span>(<span class="number">200</span>)</span><br><span class="line">    <span class="selector-tag">turtle</span><span class="selector-class">.right</span>(<span class="number">144</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.end_fill</span>()</span><br><span class="line"><span class="selector-tag">time</span><span class="selector-class">.sleep</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.penup</span>()</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.goto</span>(-<span class="number">150</span>, -<span class="number">120</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.color</span>(<span class="string">"violet"</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.write</span>(<span class="string">"Done"</span>, font=(<span class="string">'Arial'</span>, <span class="number">40</span>, <span class="string">'normal'</span>))</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.mainloop</span>()</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/unittest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/unittest/" class="post-title-link" itemprop="url">unittest</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 09:21:50" itemprop="dateModified" datetime="2021-05-01T09:21:50Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>unittest基于Java的流行测试框架Junit，<br>unittest特点</p>
<ul>
<li>python自带的单元测试框架，无需安装</li>
<li>用例执行互不干扰 互不影响</li>
<li>丰富的比较方法： 不论是功能测试， 还是单元测试， 在用例执行完成之后都需要将实际结果与进行 预期结果的进行比较（断言） ， 从而断定用例是否执行通过。 所以， 作为单元测试框架一般也会提供丰富的 断言方法。 例如， 判断相等/不等、 包含/不包含、 Trure/False 的断言方法等。</li>
<li> 提供灵活用例组织与执行： 当你的测试用例只有几条时， 可以不必考虑用例的组织， 但是， 当测试用例达到 成百上千条时， 大量的测试用例堆砌在一起， 就产生了扩展性与维护性等问题， 需要考虑用例的规范与组织 问题了。 单元测试框架以结构化的方式编写大型而且周详的测试集就是用来解决这个问题的。</li>
</ul>
<p>- 提供丰富的日志： 当测试用例执行失败时能抛出清晰的失败原因， 当所有用例执行完成后能提供丰富的 执行情况结果信息。 例如， 总执行时间、 失败用例数、 成功用例数等。<br>- 单元测试框架可以帮助我们完成任何级别测试的自动化。<br>- 单元测试： unittest 单元测试框架不单单只适用于程序单元级别的测试。<br>- HTTP 接口自动化测试： unittest + Requests<br>- Web UI 自动化测试： unittest + Selenium<br>- 移动自动化测试： unittest + Appium</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">help(<span class="string">'unittest'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Help <span class="keyword">on</span> <span class="title">package</span> <span class="title">unittest</span>:</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    unittest</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">    Python unit testing framework, based <span class="keyword">on</span> <span class="title">Erich</span> <span class="title">Gamma</span><span class="string">'s JUnit and Kent Beck'</span><span class="title">s</span></span><br><span class="line">    Smalltalk testing framework (used <span class="keyword">with</span> permission).</span><br><span class="line"></span><br><span class="line">    This module <span class="keyword">contains</span> <span class="keyword">the</span> core framework classes that form <span class="keyword">the</span> basis <span class="keyword">of</span>   </span><br><span class="line">    specific test cases <span class="keyword">and</span> suites (TestCase, TestSuite etc.), <span class="keyword">and</span> also <span class="keyword">a</span>    </span><br><span class="line">    <span class="keyword">text</span>-based utility class <span class="keyword">for</span> running <span class="keyword">the</span> tests <span class="keyword">and</span> reporting <span class="keyword">the</span> results </span><br><span class="line">     (TextTestRunner).</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir(unittest)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[‘BaseTestSuite’, ‘FunctionTestCase’, ‘SkipTest’, ‘TestCase’, ‘TestLoader’, ‘TestProgram’, ‘TestResult’, ‘TestSuite’, ‘TextTestResult’, ‘TextTestRunner’, ‘_TextTestResult’, ‘all’, ‘builtins’, ‘doc’, ‘file’, ‘name’, ‘package’, ‘path’, ‘__unittest’, ‘_expectedFailureInRpmBuild’, ‘_skipInRpmBuild’, ‘case’, ‘defaultTestLoader’, ‘expectedFailure’, ‘findTestCases’, ‘getTestCaseNames’, ‘installHandler’, ‘loader’, ‘main’, ‘makeSuite’, ‘registerResult’, ‘removeHandler’, ‘removeResult’, ‘result’, ‘runner’, ‘signals’, ‘skip’, ‘skipIf’, ‘skipUnless’, ‘suite’, ‘util’]</span><br></pre></td></tr></tbody></table></figure>


<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>断言函数需要通过测试类的 <code>self</code> 调用</p>
<p>判断相等</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="number">1</span>, <span class="number">2</span> / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIs(<span class="number">1</span>, <span class="number">2</span> / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight subunit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Failure</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "C:\python代码\牛客网剑指offer66题思路分析\代码\1.py", line 8, in test_equals</span><br><span class="line">    self.assertIs(1, 2 / 2)</span><br><span class="line">AssertionError: 1 is not 1.0</span><br><span class="line"></span><br><span class="line">Failure</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "C:\python代码\牛客网剑指offer66题思路分析\代码\1.py", line 8, in test_equals</span><br><span class="line">    self.assertIs(1, 2 / 2)  # 是否是同一个对象</span><br><span class="line">AssertionError: 1 is not 1.0</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertListEqual([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_equals (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/牛客网剑指offer66题思路分析/代码/1.py", line 10, in test_</span>equals</span><br><span class="line"><span class="code">    self.assertListEqual([1, 2], [2, 1])</span></span><br><span class="line">AssertionError: Lists differ: [1, 2] != [2, 1]</span><br><span class="line"></span><br><span class="line">First differing element 0:</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>[1, 2]</span><br><span class="line">+ [2, 1]</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertDictEqual({<span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"b"</span>: <span class="number">2</span>}, {<span class="string">"b"</span>: <span class="number">2</span>, <span class="string">"a"</span>: <span class="number">1</span>})</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsNone({})</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_empty (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 15, in test_</span>empty</span><br><span class="line"><span class="code">    self.assertIsNone({})</span></span><br><span class="line">AssertionError: {} is not None</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsNone(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_empty (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 16, in test_</span>empty</span><br><span class="line"><span class="code">    self.assertIsNone("")</span></span><br><span class="line">AssertionError: '' is not None</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsNone(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断真假</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_istrue</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断真假</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_istrue</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertFalse(<span class="number">1</span>==<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 是否包含</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isin</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIn(<span class="string">"ha"</span>,<span class="string">"hello"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_isin (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 27, in test_</span>isin</span><br><span class="line"><span class="code">    self.assertIn("ha","hello")</span></span><br><span class="line">AssertionError: <span class="emphasis">'ha'</span> not found in <span class="emphasis">'hello'</span></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 是否包含</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isin</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertNotIn(<span class="string">"ha"</span>,<span class="string">"hello"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>




<p>一个方法只执行第一个断言Fail就停止执行了</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 大小判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_greater</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertGreater(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_greater (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "C:/python代码/步骤4 Flask基础及项目实战/第30周   实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 32, in test_</span>greater</span><br><span class="line"><span class="code">    self.assertGreater(2, 2)</span></span><br><span class="line">AssertionError: 2 not greater than 2</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 大小判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_greater</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertGreaterEqual(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_greater (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 34, in test_</span>greater</span><br><span class="line"><span class="code">    self.assertGreaterEqual(1, 2)</span></span><br><span class="line">AssertionError: 1 not greater than or equal to 2        </span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 类型判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_type</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsInstance({<span class="string">"a"</span>: <span class="number">1</span>}, list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_type (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 40, in test_</span>type</span><br><span class="line"><span class="code">    self.assertIsInstance({"a": 1}, list)</span></span><br><span class="line">AssertionError: {<span class="emphasis">'a'</span>: 1} is not an instance of &lt;class <span class="emphasis">'list'</span>&gt;</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStringMethods</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_upper</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="string">'foo'</span>.upper(), <span class="string">'FOO'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isupper</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(<span class="string">'FOO'</span>.isupper())</span><br><span class="line">        self.assertFalse(<span class="string">'Foo'</span>.isupper())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_split</span>(<span class="params">self</span>):</span></span><br><span class="line">        s = <span class="string">'hello world'</span></span><br><span class="line">        self.assertEqual(s.split(), [<span class="string">'hello'</span>, <span class="string">'world'</span>])</span><br><span class="line">        <span class="comment"># check that s.split fails when the separator is not a string</span></span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(TypeError):</span><br><span class="line">            s.split(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 3 tests in 0.001s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>

<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><ul>
<li><p>TestCase 测试用例对象，编写测试用例时所有测试用例类继承的基本类。测试行为的最小单位，通过对一些输入输出值的对比来进行测试检查。放置测试步骤和检查点</p>
</li>
<li><p>Test Fixtures(用例包裹方法): 用来在多个用例之间分享的预置条件操作和清理操作，说白了就是setup和teardown的集合。用例的组织及运行<br>按不同作用划分三种fixture类型</p>
<ul>
<li><p><code>setUp()</code>, <code>tearDown()</code> 分别在测试类的每一个测试用例执行的开始和结束执行。setUp() 方法用于测试用例执行前的初始化工作， 例如初始化变量、 生成数据库测试数据、 打开浏览器等。 用于测试用例执行之后的善后工作， 例如清除数据库测试数据、 关闭文件、 关闭 浏览器等。</p>
</li>
<li><p><code>setUpClass</code>, <code>tearDownClass</code> 每个测试类的第一个用例被执行前和最后一个用例执行后被执行， </p>
</li>
<li><p><code>setUpModule</code>, <code>tearDownModule</code>每个测试模块（python文件）的执行前和执行后被执行</p>
</li>
</ul>
</li>
</ul>
<p>出现异常</p>
<ul>
<li>如果setup和teardown间的用例出现异常或者失败，teardown照样会被执行</li>
<li>如果setUpClass和setUpModule中出现异常，那么他们控制范围内的用例不会被执行，<br>并且对应的tearDownClass和tearDownModule也不会被执行<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setUpModule</span>():</span></span><br><span class="line">    print(<span class="string">"setUpModule &gt;&gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tearDownModule</span>():</span></span><br><span class="line">    print(<span class="string">"tearDownModule &gt;&gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass1</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"setUpClass for TestClass1 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"tearDownClass for TestClass1 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试前需执行的操作</span></span><br><span class="line">        print(<span class="string">"setUp for TestClass1 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例执行完后所需执行的操作</span></span><br><span class="line">        print(<span class="string">"tearDown for TestClass1 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例1 具体的测试脚本</span></span><br><span class="line">        print(<span class="string">"testCase1 for TestClass1"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例2 具体的测试脚本</span></span><br><span class="line">        print(<span class="string">"testCase2 for TestClass1"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass2</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"setUpClass for TestClass2 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"tearDownClass for TestClass2 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"setUp for TestClass2 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"tearDown for TestClass2 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"testCase1 for TestClass2"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"testCase2 for TestClass2"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">setUpModule</span> <span class="string">&gt;&gt;&gt;</span></span><br><span class="line"><span class="attr">setUpClass</span> <span class="string">for TestClass1 &gt;&gt;</span></span><br><span class="line"><span class="attr">setUp</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="attr">testCase1</span> <span class="string">for TestClass1</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="meta">.setUp</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="attr">testCase2</span> <span class="string">for TestClass1</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="meta">.tearDownClass</span> <span class="string">for TestClass1 &gt;&gt;</span></span><br><span class="line"><span class="attr">setUpClass</span> <span class="string">for TestClass2 &gt;&gt;</span></span><br><span class="line"><span class="attr">setUp</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="attr">testCase1</span> <span class="string">for TestClass2</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="meta">.setUp</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="attr">testCase2</span> <span class="string">for TestClass2</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="meta">.tearDownClass</span> <span class="string">for TestClass2 &gt;&gt;</span></span><br><span class="line"><span class="attr">tearDownModule</span> <span class="string">&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">----------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">Ran</span> <span class="string">4 tests in 0.002s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">OK</span></span><br></pre></td></tr></tbody></table></figure>


</li>
</ul>
<ul>
<li>TestSuite 测试套件，可以将测试套件理解成运行测试用例的集合。<br>组织测试用例的实例，支持测试用例的添加和删除，<br>一个test suite由许多个TestCase组成，</li>
</ul>
<ol start="2">
<li>想要运行指定的用例需要将这些用例加入测试套件TestSuite中来运行，主要是4步<ul>
<li>创建一个TestSuite的实例，</li>
<li>调用 <code>unittest.TestSuite()</code>类中的 <code>addTest()</code>或者 <code>addTests([])</code> 方法向测试套件TestSuite实例一个一个添加测试用例TestCase实例<br>当所有测试添加之后，<br>用来管理和组织测试用例。</li>
</ul>
</li>
</ol>
<ul>
<li><p>TextTestRunner 用例执行器</p>
<ul>
<li>创建一个 unittest.TextTestRunner()类实例，run()方法运行测试套件TestSuite中的测试用例。<br>可以把TestSuite的实例传递给 TextTestRunner，它会按照添加测试用例的顺序逐个去执行测试用例，<br>会以文本的形式显示结果，在它们运行时会打印测试名字，发生的错误，并且在测试运行结束之后打印结果概要。<br>将测试用例或测试用例集合聚合起来的集合，批量执行，并且向用户提供测试结果 </li>
</ul>
</li>
<li><p>TextTestResult  测试结果<br>由TextTestRunner调用，会显示出格式化的文本。</p>
</li>
</ul>
<h3 id="unittest-模块使用的模式有三种，如下："><a href="#unittest-模块使用的模式有三种，如下：" class="headerlink" title="unittest 模块使用的模式有三种，如下："></a>unittest 模块使用的模式有三种，如下：</h3><p>首先， 通过 import 导入 unittest 单元测试框架。<br>写一个测试类必须继承自 <code>unittest.TestCase</code>，<br>该测试类下面的每一个测试用例方法名称必须以小写 <code>test</code> 开头，例如， test_add、 test_sub 等。</p>
<p>用例模块内的组织，在一个类内规定或者通过unittest的组织方式来决定哪些用例哪些代码执行的次数</p>
<p>通过调用 <code>unittest.main()</code> 来默认运行当前测试模块文件下的所有测试用例 测试集合</p>
<p>默认执行顺序不是书写顺序，而是按照用例名的ASCII码先后顺序执行<br>执行结果可以看到通过一个小点 <code>.</code> 来表示一条运行通过的用例</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行测试的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UCTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试前需执行的操作</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例执行完后所需执行的操作</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试用例1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCreateFolder</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 具体的测试脚本</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testDeleteFolder</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 具体的测试脚本</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 构造测试集， 添加测试用例</span></span><br><span class="line">    suite = unittest.TestSuite()</span><br><span class="line">    suite.addTest(UCTestCase(<span class="string">"testCreateFolder"</span>))</span><br><span class="line">    suite.addTest(UCTestCase(<span class="string">"testDeleteFolder"</span>))</span><br><span class="line">    <span class="comment"># 执行测试， 构造runner。</span></span><br><span class="line">    runner = unittest.TextTestRunner()</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>py</span><br><span class="line">import unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span>(<span class="title">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, a, b)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.a = int(a)</span><br><span class="line">        <span class="keyword">self</span>.b = int(b)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.a + <span class="keyword">self</span>.b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCount</span>(<span class="title">unittest</span>.<span class="title">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        print(<span class="string">"Test Start"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        print(<span class="string">"Test End"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add1</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        j = Count(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">self</span>.assertEqual(j.add(), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add2</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        j = Count(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">self</span>.assertEqual(j.add(), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">"__main__"</span><span class="symbol">:</span></span><br><span class="line">    <span class="comment"># 1. 新建测试套件</span></span><br><span class="line">    suite = unittest.TestSuite()</span><br><span class="line">    <span class="comment"># 2. 将用例加入测试套件</span></span><br><span class="line">    <span class="comment"># suite.addTest(TestCount("test_add1"))</span></span><br><span class="line">    <span class="comment"># suite.addTest(TestCount("test_add2"))</span></span><br><span class="line"></span><br><span class="line">    suite.addTests([TestCount(<span class="string">"test_add1"</span>), TestCount(<span class="string">"test_add2"</span>)])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 新建TestRunner</span></span><br><span class="line">    runner = unittest.TextTestRunner()</span><br><span class="line">    <span class="comment"># 4. 用TestRunner来执行TestSuite</span></span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight subunit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Ran 2 tests in 0.007s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br><span class="line"><span class="keyword">Test </span>Start</span><br><span class="line"><span class="keyword">Test </span>End</span><br><span class="line"><span class="keyword">Test </span>Start</span><br><span class="line"><span class="keyword">Test </span>End</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5 != 6</span><br><span class="line"></span><br><span class="line">Expected :6</span><br><span class="line">Actual   :5</span><br><span class="line">&lt;Click to see difference&gt;</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "C:\1.py", line 26, in test_add2</span><br><span class="line">    self.assertEqual(j.add(), 5)</span><br><span class="line">AssertionError: 6 != 5</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>TestLoader 测试用例加载器<br>负责根据各种各样的规则收集测试用例，并把这些测试用例包装在一个TestSuite中。运行测试集</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCase1</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># def setUp(self):</span></span><br><span class="line">    <span class="comment"># def tearDown(self):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'aaa'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'bbb'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCase2</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># def setUp(self):</span></span><br><span class="line">    <span class="comment"># def tearDown(self):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'aaa1'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'bbb1'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 此用法可以同时测试多个类</span></span><br><span class="line">    suite1 = unittest.TestLoader().loadTestsFromTestCase(TestCase1)</span><br><span class="line">    suite2 = unittest.TestLoader().loadTestsFromTestCase(TestCase2)</span><br><span class="line">    suite = unittest.TestSuite([suite1, suite2])</span><br><span class="line">    unittest.TextTestRunner(verbosity=<span class="number">2</span>).run(suite)</span><br></pre></td></tr></tbody></table></figure>

<ol start="5">
<li>TestCase的用法<br>源文件widget.py，也即我们要进行单元测试的文件。很简单的一个类，该类可以设置长宽，并且能够获取这两个值。<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Widget</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, size=(<span class="params"><span class="number">40</span>, <span class="number">40</span></span>)</span>):</span></span><br><span class="line">         self._size = size</span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">get_size</span>(<span class="params">self</span>):</span></span><br><span class="line">         <span class="keyword">return</span> self._size</span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">resize</span>(<span class="params">self, width, height</span>):</span></span><br><span class="line">         <span class="keyword">if</span> width &lt; <span class="number">0</span> <span class="keyword">or</span> height &lt; <span class="number">0</span>:</span><br><span class="line">             <span class="keyword">raise</span> ValueError, <span class="string">'illegal size'</span></span><br><span class="line">             self._size = (width, height)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    widget = Widget()</span><br><span class="line">    <span class="keyword">print</span> widget.get_size()</span><br></pre></td></tr></tbody></table></figure>
因此，我们可以撰写的单元测试代码文件 widgettest.py 如下：</li>
</ol>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> widget <span class="keyword">import</span> Widget</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WidgetTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的初始化工作可以在setUp()方法中完成</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget = Widget()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的资源的释放则可以在tearDown()方法中完成</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget.dispose()</span><br><span class="line">        self.widget = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应widget类中的get_size函数测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_size</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(self.widget.get_size(), (<span class="number">40</span>, <span class="number">40</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应widget类中resize函数的测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_Resize</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget.resize(<span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">        self.assertEqual(self.widget.get_size(), (<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>

<p>其中有两个测试用例，分别为test_size, test_Resize， 在每个测试用例执行的过程中会首先执行setUp，然后执行测试用例，最后执行tearDown操作。每个测试用例的执行遵循相同的模式。<br>其中要注意的是setUp和tearDown两个，又称为测试装置，setUp完成对象的初始化动作，而tearDown则完成资源的释放之类的操作。</p>
<p>可以在一个独立的文件里提供一个更全面的测试集</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> average</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStatisticalFunctions</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_average</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(average([<span class="number">20</span>, <span class="number">30</span>, <span class="number">70</span>]), <span class="number">40.0</span>)</span><br><span class="line">        self.assertEqual(round(average([<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>]), <span class="number">1</span>), <span class="number">4.3</span>)</span><br><span class="line">        self.assertRaises(ZeroDivisionError, average, [])</span><br><span class="line">        self.assertRaises(TypeError, average, <span class="number">20</span>, <span class="number">30</span>, <span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unittest.main()  <span class="comment"># Calling from the command line invokes all tests</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">FF</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_equals (__main__.MyTestCase)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:/python代码/步骤4 Flask基础及项目实战/第30周   实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战接口自动化测试/接口测试/apitest/test_verify_demo.py"</span>, line <span class="number">8</span>, <span class="keyword">in</span> test_equals</span><br><span class="line">    self.assertNotEqual(<span class="number">1</span>, <span class="number">2</span> / <span class="number">2</span>)</span><br><span class="line">AssertionError: <span class="number">1</span> == <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_type (__main__.MyTestCase)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:/python代码/步骤4 Flask基础及项目实战/第30周   实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战接口自动化测试/接口测试/apitest/test_verify_demo.py"</span>, line <span class="number">31</span>, <span class="keyword">in</span> test_type</span><br><span class="line">    self.assertIsInstance({<span class="string">"a"</span>: <span class="number">1</span>}, list)</span><br><span class="line">AssertionError: {<span class="string">'a'</span>: <span class="number">1</span>} <span class="keyword">is</span> <span class="keyword">not</span> an instance of &lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">----------------------------------------------------------------------</span></span><br><span class="line"><span class="class"><span class="title">Ran</span> 2 <span class="title">tests</span> <span class="title">in</span> 0.001<span class="title">s</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">FAILED</span> (<span class="params">failures=<span class="number">2</span></span>)</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/yaml/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/yaml/" class="post-title-link" itemprop="url">yaml</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-11 04:28:17" itemprop="dateModified" datetime="2021-04-11T04:28:17Z">2021-04-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="yaml-YAML-Ain’t-Markup-Language"><a href="#yaml-YAML-Ain’t-Markup-Language" class="headerlink" title="yaml YAML Ain’t Markup Language"></a>yaml YAML Ain’t Markup Language</h1><p>YAML 不是标记语言 文本文件  它是一种数据格式语言，并且是JSON的超集。<br>与 JSON 不同，它可以存储更复杂的对象并引用其自己的元素，还可以编写注释，使其特别适合编写一些定义好不常修改的内容配置文件，<br><code>pip install --index-url https://pypi.tuna.tsinghua.edu.cn/simple/ pyyaml</code><br>不规定某一种文件或者key它对应的数据类型，从python的角度来说是字符串，但不需要加引号，当我们进行load的时候，python会对它进行额外的数据类型分析<br>yaml文件在读取后得到的是字典类型的数据</p>
<p>注意格式<code>muke.yaml</code></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># key-value</span></span><br><span class="line"><span class="attr">url:</span></span><br><span class="line">  <span class="string">https://www.imooc.com/</span></span><br><span class="line"><span class="comment"># 列表</span></span><br><span class="line"><span class="attr">types:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前沿</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">后端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">移动端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">云计算</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">运维</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ui</span></span><br><span class="line"><span class="comment"># 字典</span></span><br><span class="line"><span class="attr">python:</span></span><br><span class="line">  <span class="attr">web:</span> <span class="string">django</span></span><br><span class="line">  <span class="attr">spader:</span> <span class="string">bs5</span></span><br><span class="line"><span class="attr">a:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">b:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">c:</span> [<span class="string">a</span>, <span class="string">b</span>, <span class="string">c</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    result = yaml.load(data, Loader=yaml.FullLoader)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    result = read(<span class="string">'muke.yaml'</span>)  <span class="comment"># 传递相对路径</span></span><br><span class="line">    print(result)</span><br><span class="line">    <span class="comment"># {'url': 'https://www.imooc.com/', 'types': ['前沿', '前端', '后端', '移动端', '云计算', '运维', 'ui'], 'python': {'web': 'django', 'spader': 'bs5'}, 'a': 1, 'b': 2, 'c': ['a', 'b', 'c']} </span></span><br><span class="line">    print(type(result))</span><br><span class="line">    <span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">document = <span class="string">"""</span></span><br><span class="line"><span class="string">    a: 1</span></span><br><span class="line"><span class="string">    b:</span></span><br><span class="line"><span class="string">    c: 3</span></span><br><span class="line"><span class="string">    d: 4</span></span><br><span class="line"><span class="string">    ...: </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">print(yaml.load(document, Loader=yaml.FullLoader))</span><br><span class="line"><span class="comment"># {'a': 1, 'b': None, 'c': 3, 'd': 4, '...': None}</span></span><br><span class="line">print(type(yaml.load(document, Loader=yaml.FullLoader)))</span><br><span class="line"><span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(dir(yaml))</span><br><span class="line"><span class="comment"># ['AliasEvent', 'AliasToken', 'AnchorToken', 'BaseDumper', 'BaseLoader', 'BlockEndToken', 'BlockEntryToken', 'BlockMappingStartToken', 'BlockSequenceStartToken', 'CBaseDumper', 'CBaseLoader', 'CDumper', 'CFullLoader', 'CLoader', 'CSafeDumper', 'CSafeLoader', 'CUnsafeLoader', 'CollectionEndEvent', 'CollectionNode', 'CollectionStartEvent', 'DirectiveToken', 'DocumentEndEvent', 'DocumentEndToken', 'DocumentStartEvent', 'DocumentStartToken', 'Dumper', 'Event', 'FlowEntryToken', 'FlowMappingEndToken', 'FlowMappingStartToken', 'FlowSequenceEndToken', 'FlowSequenceStartToken', 'FullLoader', 'KeyToken', 'Loader', 'MappingEndEvent', 'MappingNode', 'MappingStartEvent', 'Mark', 'MarkedYAMLError', 'Node', 'NodeEvent', 'SafeDumper', 'SafeLoader', 'ScalarEvent', 'ScalarNode', 'ScalarToken', 'SequenceEndEvent', 'SequenceNode', 'SequenceStartEvent', 'StreamEndEvent', 'StreamEndToken', 'StreamStartEvent', 'StreamStartToken', 'TagToken', 'Token', 'UnsafeLoader', 'ValueToken', 'YAMLError', 'YAMLLoadWarning', 'YAMLObject', 'YAMLObjectMetaclass', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__', '__version__', '__with_libyaml__', '_warnings_enabled', 'add_constructor', 'add_implicit_resolver', 'add_multi_constructor', 'add_multi_representer', 'add_path_resolver', 'add_representer', 'compose', 'compose_all', 'composer', 'constructor', 'cyaml', 'dump', 'dump_all', 'dumper', 'emit', 'emitter', 'error', 'events', 'full_load', 'full_load_all', 'io', 'load', 'load_all', 'load_warning', 'loader', 'nodes', 'parse', 'parser', 'reader', 'representer', 'resolver', 'safe_dump', 'safe_dump_all', 'safe_load', 'safe_load_all', 'scan', 'scanner', 'serialize', 'serialize_all', 'serializer', 'tokens', 'unsafe_load', 'unsafe_load_all', 'warnings']</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/san-yuan-biao-da-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/san-yuan-biao-da-shi/" class="post-title-link" itemprop="url">python 三元表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 03:01:51" itemprop="dateModified" datetime="2021-05-01T03:01:51Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>用简单的一行快速判断，而不是使用复杂的多行if语句。<br><code>condition_is_true if condition else condition_is_false</code><br>如果a&gt;b的结果为真，h=”变量1”,<br>如果为假，h=”变量2”</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">print(<span class="string">"变量1"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"变量2"</span>)  <span class="comment"># 变量2</span></span><br><span class="line">print(<span class="string">"True"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"False"</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="literal">True</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="literal">False</span>)  <span class="comment"># False</span></span><br><span class="line">print(a &gt; b)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">h = a - b <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> a + b</span><br><span class="line">print(h)  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">is_fat = <span class="literal">True</span></span><br><span class="line">state = <span class="string">"fat"</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">"not fat"</span></span><br><span class="line">print(state)  <span class="comment"># fat</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shi-wu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shi-wu/" class="post-title-link" itemprop="url">事务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 03:00:23" itemprop="dateModified" datetime="2021-05-01T03:00:23Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Relational Database Management System 关系数据库管理系统<br>RDBMS=SQL语句+事务(ACID)</p>
<p>事务transaction：</p>
<ul>
<li>是数据库并发控制的基本单位</li>
<li>是一个或者多个sql语句、数据库逻辑操作组成的集合</li>
</ul>
<p>默认，mysql执行每条sql语句都会自动开启和提交事务<br>为了让多条sql语句纳入到一个事务之下，可以手动管理事务<br>START TRANSACTION;</p>
<p>例子转账了。假如小明要给小红转账1000元，这个转账会涉及到两个关键操作就是：将小明的余额减少1000元，将小红的余额增加1000元。万一在这两个操作之间突然出现错误比如银行系统崩溃，导致小明余额减少而小红的余额没有增加，这样就不对了。事务就是保证这两个关键操作要么都成功，要么都要失败。</p>
<ol>
<li>原子性(Atomicity)事务是最小的执行单位，不允许分割。一个事务中所有操作要么全部完成，要么全部失败。事务执行后，不允许停留在中间某个状态， </li>
<li>一致性(consistency)：事务开始和结束之后数据完整性没有被破坏，执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是相同的；</li>
<li>隔离性(Isolation)：允许多个事务同时对数据库修改和读写，事务不受其他并发事务的影响，如同在给定的时间内，该事务时数据库唯一运行的事务，各并发事务之间数据库是独立的；</li>
<li>持久性(Durability):事务一旦提交，它对数据库中数据的改变是持久的。即便发生宕机数据库发生故障也不应该对其有任何影响，仍然可以依靠事务日志完成数据的持久化</li>
</ol>
<p>事务与回滚：<br>COMMIT； 让redo日志与数据文件同步，事务的所有操作都会被持久化到数据库里面，提交了就会把事务操作下的结果同步<br>ROLLBACK;把该事务所有的数据都打上标记，这些数据全都不会同步到数据文件里面，不存在中间状态的数据<br>回滚：多个逻辑中某个操作出错，回到初始状态，一旦执行失败需要回滚操作来保持之前数据库的完整性）<br>rollback就是数据库里做修改后&nbsp;（update，insert，delete）未commit&nbsp;之前，使用rollback可以恢复数据到修改之前</p>
<p>事务处理<br>MySQL提供事务处理的表引擎, InnoDB<br>服务器层不管理事务，由下层的引擎实现，所以同一个事务中，使用多种存储引擎不靠谱。比如在操纵两张表时候做一个事务，不能是一张表InnoDB另一张表MyISAM，这样事务是做不成功的。需要两张表都是InnoDB。</p>
<p>在非事务的表上执行事务操作 MySQL不会发出提醒，也不会报错，如：在MyISAM表上做事务处理。</p>
<p>举例说明数据库事务的使用场景以及注意事项<br>在操纵(增删改)重要数据时，如：钱款等。需要开启事务。<br>注意事项：事务的隔离级别越高安全性就越高，但并发就越低，这就需要选择合适的隔离级别。</p>
<p>事务的并发控制可能产生哪些问题<br>在典型的应用程序中，多个事务并发运行，经常会操作相同的数据来完成各自的任务（多个用户对统一数据进行操作）。并发虽然是必须的，如果不对事务进行并发控制,可能会产生四种异常情况</p>
<ul>
<li><p>幻读(phantom read):在同一个事务第二次查出现第一次没有的结果，说明别的事务已经插入一些数据<br>幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，</p>
</li>
<li><p>非重复读( nonrepeatable read):一个事务重复读两次得到不同结果，说明读取操作结果是不可重复的。<br>指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</p>
</li>
<li><p>脏读(dirty read):一个事务读取到另一个事务没有提交的修改，就是当另一个事务它还没有提交修改一个事务就读取到了修改。当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。</p>
</li>
<li><p>丢失修改(lost update)：并发写入造成其中一些修改丢失。<br>指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。</p>
</li>
</ul>
<p>Transaction 示例：Python的ORM框架SQLALchemy代码</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">session.begin()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    item1 =session.query(Item).get(<span class="number">1</span>)</span><br><span class="line">    item2 =session.query(Item).get(<span class="number">2</span>)</span><br><span class="line">    item1.foo = <span class="string">'bar'</span></span><br><span class="line">    item2.bar = <span class="string">'foo'</span></span><br><span class="line">    session.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    session.rollback()</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></tbody></table></figure>

<p>把10部门中manager员工调往20部门，其他岗位的员工调往30部门，然后删除10部门 </p>
<p>为了解决并发控制可能产生的异常问题，数据库定义了<br>四种事务的隔离级别</p>
<ul>
<li><p>读未提交(read uncommitted)：别的事务可以读取到未提交改变</p>
</li>
<li><p>读已提交(read committed)：只能读取已经提交的数据</p>
</li>
<li><p>可重复读(repeatable read)：同一个事务先后查询结果一样，Mysql InnoDB默认实现可重复读级别。</p>
</li>
<li><p>可串行化(Serializable)：事务完全串行化的执行，隔离级别最高，执行效率最低。相当于把数据库在一个事务执行的时候完全锁住，等它执行完才能执行下一个。</p>
<p>  ① 读取未提交( Read Uncommitted )</p>
<pre><code>   读未提交是隔离级别最低的一种事务级别。在这种隔离级别下，一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据，这就是脏读（Dirty Read）。
</code></pre>
<p> ② 读取已提交( Read Committed )</p>
<pre><code>  在 Read Committed 隔离级别下，一个事务可能会遇到不可重复读（Non Repeatable Read）的问题。不可重复读是指，在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致。
</code></pre>
<p>③ 可重复读取( Repeatable Read )</p>
<pre><code>  在Repeatable Read隔离级别下，一个事务可能会遇到幻读（Phantom Read）的问题。幻读是指，在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。幻读就是没有读到的记录，以为不存在，但其实是可以更新成功的，并且，更新成功后，再次读取，就出现了。
</code></pre>
<p>④ 可串行化、序列化( Serializable )</p>
<pre><code>  Serializable 是最严格的隔离级别。在Serializable隔离级别下，所有事务按照次序依次执行，因此，脏读、不可重复读、幻读都不会出现。

 虽然 Serializable 隔离级别下的事务具有最高的安全性，但是，由于事务是串行执行，所以效率会大大下降，应用程序的性能会急剧降低。如果没有特别重要的情景，一般都不会使用Serializable隔离级别。

  默认隔离级别：如果没有指定隔离级别，数据库就会使用默认的隔离级别。在MySQL中，如果使用 InnoDB，默认的隔离级别是Repeatable Read。
</code></pre>
</li>
</ul>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;<br>读取其他事务未提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;<br>只能读取其他事务提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>事务在执行中反复读取数据，得到的结果是一致的，不会受其他事务影响</p>
<p>START TRANSACTION;<br>UPDATE t_emp set sal=1;<br>COMMIT;<br>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>START TRANSACTION;<br>SELECT empno, ename, sal FROM t_emp;<br>COMMIT;<br>ROLLBACK;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL live SERIALIZABLE;<br>由于事务并发执行所带来的各种问题，前三种隔离级别只适用在某些业务场景中，但是序列化的隔离性，让事务逐一执行，就不会产生上述问题了。</p>
<p>如何解决高并发场景下的插入重复<br>高并发场景下，写入数据库会有数据重复问题</p>
<ol>
<li><p>使用数据库的唯一索引，就是不允许某些字段重复，如果重复数据库就会抛出一个异常出来，这样就知道那些数据重复了，直接把这个异常忽略掉就可以，这样就可以实现非重复插入。虽然好用但有些场景没有办法实现，如已经做了分库分表，这个时候就要使用队列去执行一个异步写入。</p>
</li>
<li><p>使用队列异步写入，其实很多高并发问题都可以通过缓存和队列去解决。</p>
</li>
<li><p>使用 redis 等实现分布式锁，这样就可以在插入的时候持有这个锁，插入完成之后再去释放这个锁。</p>
</li>
</ol>
<p>并发控制也是通过行锁或者表锁实现的。通过事务再读取或者写入的时候加入一些表锁或者行锁就可以实现不同并发控制的等级。</p>
<p>悲观锁是先获取锁再进行操作。一锁二查三更新 select for update</p>
<p>乐观锁是先修改，更新的时候发现数据已经变了就回滚(check and set)，乐观锁一般通过版本号或者时间戳实现</p>
<p>使需要根据响应速度、冲突频率、重试代价来判断使用哪一种</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
