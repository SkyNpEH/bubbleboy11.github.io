<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/12/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/12/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/12/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">343</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/django-ce-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/django-ce-shi/" class="post-title-link" itemprop="url">django旅游网项目测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-02 04:05:19" itemprop="dateModified" datetime="2021-05-02T04:05:19Z">2021-05-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Django测试<br>为何要学习它</p>
<ul>
<li>代码可以运行起来 != 功能正常</li>
<li>测试驱动开发 测试先行</li>
<li>测试不仅能发现错误，还能预防错误</li>
<li>自动化测试可提升工作效率</li>
</ul>
<p>Django 使用的是内置于 Python 标准库模块中的 unittest 单元测试框架。 该模块定义使用基于类的方法测试。 </p>
<p>Django 提供了一个 API 和工具， 可以融合其它的单元测试框架，也可以使用任何其他的 Python 测试 框架； </p>
<p>Django 的单元测试使用<br>在我们创建 Django 应用时， 默认已经帮我们生成了 <code>tests.py</code> 文件， </p>
<p>打开 <code>.../system\tests.py</code> 文件， 编写测试如下代码</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase, Client</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> system.models <span class="keyword">import</span> Slider</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SliderTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="string">""" 轮播图接口 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        Slider.objects.create(name=<span class="string">'test1'</span>, types=<span class="number">11</span>, img=<span class="string">'a.jpg'</span>)</span><br><span class="line">        Slider.objects.create(name=<span class="string">'test2'</span>, types=<span class="number">12</span>, img=<span class="string">'b.jpg'</span>)</span><br><span class="line">        <span class="comment"># 请求对象</span></span><br><span class="line">        self.client = Client()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_slider_list</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 发起get请求</span></span><br><span class="line">        response = self.client.get(<span class="string">'/system/slider/list/'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查状态码</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_slider_list_types</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 按条件查询 """</span></span><br><span class="line">        <span class="comment"># 发起get请求</span></span><br><span class="line">        response = self.client.get(<span class="string">'/system/slider/list/'</span>, {<span class="string">'types'</span>: <span class="number">11</span>})</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查状态码</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">        data_list = json.loads(response.content)[<span class="string">'objects'</span>]</span><br><span class="line">        self.assertEqual(len(data_list), <span class="number">1</span>, <span class="string">'按条件查询失败'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\tests.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase, Client</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User, Profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 请求对象</span></span><br><span class="line">        self.client = Client()</span><br><span class="line">        user = User.objects.create_user(username=<span class="string">'13800000001'</span>,</span><br><span class="line">                                        password=<span class="string">'A123123123'</span>,</span><br><span class="line">                                        nickname=<span class="string">'张三'</span>)</span><br><span class="line">        Profile.objects.create(user=user, username=user.username)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_user_login_passed</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 登录接口-登录成功 """</span></span><br><span class="line">        <span class="comment"># 发起post请求</span></span><br><span class="line">        response = self.client.post(<span class="string">'/accounts/user/api/login/'</span>, {</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">'13800000001'</span>,</span><br><span class="line">            <span class="string">'password'</span>: <span class="string">'A123123123'</span></span><br><span class="line">        })</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查状态码</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_user_login_failure</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 登录接口-登录失败 """</span></span><br><span class="line">        <span class="comment"># 发起post请求</span></span><br><span class="line">        response = self.client.post(<span class="string">'/accounts/user/api/login/'</span>, {</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">'13800000001'</span>,</span><br><span class="line">            <span class="string">'password'</span>: <span class="string">'A1231231231'</span></span><br><span class="line">        })</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查状态码</span></span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">400</span>)</span><br><span class="line">        data = json.loads(response.content)</span><br><span class="line">        self.assertIn(<span class="string">'密码不正确'</span>, str(data))</span><br></pre></td></tr></tbody></table></figure>

<p>测试指定模块</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py <span class="built_in">test</span> system</span><br></pre></td></tr></tbody></table></figure>

<p>测试全部模块</p>
<figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> test</span><br></pre></td></tr></tbody></table></figure>


<ol>
<li><p>测试Django视图 - Django中提供的<code>TestCase</code>扩展了<code>unittest</code>中的<code>TestCase</code>，绑定了一个名为<code>client</code>的属性，可以用来模拟浏览器发出的GET、POST、DELETE、PUT等请求。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeViewTest</span>(<span class="params">TestCase</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_example_view</span>(<span class="params">self</span>):</span></span><br><span class="line">        resp = self.client.get(reverse(<span class="string">'index'</span>))</span><br><span class="line">        self.assertEqual(<span class="number">200</span>, resp.status_code)</span><br><span class="line">        self.assertEqual(<span class="number">5</span>, resp.context[<span class="string">'num'</span>])</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>运行测试 - 配置测试数据库。</p>
</li>
</ol>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = {</span><br><span class="line">    <span class="string">'default'</span>: {</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="number">3306</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'DbName'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: os.environ[<span class="string">'DB_USER'</span>],</span><br><span class="line">        <span class="string">'PASSWORD'</span>: os.environ[<span class="string">'DB_PASS'</span>],</span><br><span class="line">        <span class="string">'TEST'</span>: {</span><br><span class="line">            <span class="string">'NAME'</span>: <span class="string">'DbName_for_testing'</span>,</span><br><span class="line">            <span class="string">'CHARSET'</span>: <span class="string">'utf8'</span>,</span><br><span class="line">        },</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python manage.py test</span><br><span class="line">python manage.py test common</span><br><span class="line">python manage.py test common.tests.UtilsTest</span><br><span class="line">python manage.py test common.tests.UtilsTest.test_to_md5_hex</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>评估测试覆盖度</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pip install coverage</span><br><span class="line">coverage run --source=&lt;path1&gt; --omit=&lt;path2&gt; manage.py test common</span><br><span class="line">coverage report</span><br><span class="line"></span><br><span class="line">Name                            Stmts   Miss  Cover</span><br><span class="line">---------------------------------------------------</span><br><span class="line">common/__init__.py                  0      0   100%</span><br><span class="line">common/admin.py                     1      0   100%</span><br><span class="line">common/apps.py                      3      3     0%</span><br><span class="line">common/forms.py                    16     16     0%</span><br><span class="line">common/helper.py                   32     32     0%</span><br><span class="line">common/middlewares.py              19     19     0%</span><br><span class="line">common/migrations/__init__.py       0      0   100%</span><br><span class="line">common/models.py                   71      2    97%</span><br><span class="line">common/serializers.py              14     14     0%</span><br><span class="line">common/tests.py                    14      8    43%</span><br><span class="line">common/urls_api.py                  3      3     0%</span><br><span class="line">common/urls_user.py                 3      3     0%</span><br><span class="line">common/utils.py                    22      7    68%</span><br><span class="line">common/views.py                    69     69     0%</span><br><span class="line">---------------------------------------------------</span><br><span class="line">TOTAL                             267    176    34%</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/go/" class="post-title-link" itemprop="url">go基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 03:38:42" itemprop="dateModified" datetime="2021-07-11T03:38:42Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>python负责微服务的底层接口开发<br>go处于中间层负责底层接口调用、与网关交互、负载均衡<br>强类型、静态、编译语言</p>
<p>Go 语言用途<br>Go 语言被设计成一门应用于搭载 Web 服务器 gin beego，存储集群或类似用途的巨型中央服务器的系统编程语言。<br>是云计算<br>中间件 etcd tidb influxdb nsq<br>容器虚拟化 docker k8s<br>区块链 以太坊 fabric<br>微服务生态好 kit、go-micro、rpcx、 kratos、 dubbo-go</p>
<p>微服务架构适合多语言开发</p>
<p>对于高性能分布式系统领域而言，Go 语言无疑比大多数其它语言有着更高的开发效率。它提供了海量并行的支持</p>
<ul>
<li>原生支持http服务</li>
<li>原生支持并发编程 非常高效- goroutine</li>
<li>支持长链接</li>
<li>语法简单-开发效率高，引用一个包、定义一个变量没有使用它就会有错误提示</li>
<li>集各种语言的优势-大量参考C和 python</li>
<li>执行性能高-直接编译成二进制，</li>
</ul>
<p>开发效率高(完整的开发工程链tools, test, benchmark, builtin .etc)<br>部署简单(Compile once, run everywhere)<br>良好的native http库以及模版引擎(无需任何第三方框架)<br>并发模型</p>
<p>Go 是编译型语言<br>Go 使用编译器来编译代码。编译器将源代码编译成二进制（或字节码）格式；在编译代码时，编译器检查错误、优化性能并输出可在不同平台上运行的二进制文件。要创建并运行 Go 程序，程序员必须执行如下步骤。</p>
<p>使用文本编辑器创建 Go 程序；<br>保存文件；<br>编译程序；<br>运行编译得到的可执行文件。<br>这不同于 Python、Ruby 和 JavaScript 等语言，它们不包含编译步骤。Go 自带了编译器，因此无须单独安装编译解释器。部署非常简单</p>
<ul>
<li>编译速度快 .exe -比c++、java编译快   c/c++ .so .lib .dll java .class<br>GO是强类型语言，这一点倒类似C++，在使用一个变量前必须明确该变量的类型。当然了，GO可以不写变量类型而让编译器来推导出变量类型，这一点C++11中的auto关键字也做到了，当然那样我还要写一个auto，而GO不用。另外还要补充的一点是，GO也是静态类型语言，编译时就知道变量类型，一个变量一旦被声明成一个类型，就不可以变为另一个类型（除非类型转换，但是也只能在兼容类型之间做类型转换，比如int不可以转换为string），相比于动态类型语言（Python），速度要快很多。</li>
</ul>
<p>GO是编译型语言。编译型语言相对于解释型语言最大的好处就是它的速度非常快。因此上面的说的静态类型+编译型语言，就决定了GO语言程序的运行速度，GO具有堪比与C的运行速度（当然C还是最快的），和C++的运行速度也是差不多了，比Python差不多要快30倍</p>
<p>GO具有脚本化的语法，语法简单。说真的，作为一个C++忠实用户，我也觉得C++的语法太复杂了，所以这也是我转型的一个方面，写的代码少并且完成效率差不多毕竟是个好事。后续的学习过程中，一些语法方面的细节，我也会仔细分析和C++的差别</p>
<p>支持多种编程范式，包括函数式编程以及面向对象编程。不过需要注意的是，GO并没有像C++和Java一样有一个class来表示类，它本身其实没有对象这样的概念，是用strcut来模拟面向对象的。因为没有对象，所以GO语言也没有继承多态这些概念（这些东西其实都是由接口来实现的），也没有泛型编程（学C++的时候继承多态确实把我学的够呛）。那么GO语言有什么？GO语言有接口，函数式编程，接口interface在GO语言中是一个很重要的东西，面向接口的编程也是GO的一个主流编程范式</p>
<p>GO语言相比于别的语言最大的好处就是，GO原生的支持并发。像我在写C++的时候，都是调用一些系统调用来创建线程（其实C++有自己封装的和线程相关的函数，我没用而已）。这里需要注意的是原生的支持和通过第三方库来支持的区别，GO是在语法上支持，而C++需要调用第三方库来支持（std::thread，其实也是一个C++的标准库吧）。这部分概念其实还是要到后面真正学到GO并发了才会了解到，所以这里先“吹”为敬。之后会学到goroutine和channel，这是GO并发的关键</p>
<p><code>goroot</code>是go skd的安装路径 GO语言开发包的目录,src里面是标准库</p>
<p>GOPATH使用绝对路径提供项目的工作目录。<br><code>gopath</code>是指向工作目录文件夹路径，以后我们下载的第三方包和我们自己开发的程序代码包都要放在这个目录里面。当你在源码里使用 import 语句导入一个包时，编译器都会来 GOPATH 目录下面搜索源码文件和包。包含src,pkg,bin文件夹。<br>src,源代码文件，项目开始之地。src下面的路径确定导入路径或可执行文件名。<br>pkg存放编译好的包库文件，主要是*.a文件;<br>bin文件夹,也就是gobin 存放编译后的可执行文件<br><code>path</code>是skd下方bin的路径</p>
<p>需要把GOPATH中的可执行目录也配置到环境变量中, 否则你自行下载的第三方go工具就无法使用了</p>
<p>安装完GoLand之后，需要在Settings设置Go的环境变量GOROOT和GOPATH，</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">help</span> gopath</span></span><br></pre></td></tr></tbody></table></figure>

<p>新建项目以包为单位，每个文件都隶属于一个包</p>
<p>用不了clash的terminal，会出错，用<br>用本身的terminal</p>
<p><a target="_blank" rel="noopener" href="https://goproxy.cn/">https://goproxy.cn/</a>有教程，go1.11引入gomodule<br><a target="_blank" rel="noopener" href="https://goproxy.cn拉取不了就从direct拉/">https://goproxy.cn拉取不了就从direct拉</a></p>
<p>windows</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go env -w GO111MODULE=on</span><br><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></tbody></table></figure>

<p>macOS 或 Linux：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export GO111MODULE=on</span><br><span class="line">export GOPROXY=https://goproxy.cn</span><br></pre></td></tr></tbody></table></figure>

<p>或者</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo "export GO111MODULE=on" &gt;&gt; ~/.profile</span><br><span class="line">echo "export GOPROXY=https://goproxy.cn" &gt;&gt; ~/.profile</span><br><span class="line">source ~/.profile</span><br></pre></td></tr></tbody></table></figure>

<p>golang 新建项目都选择gomodule而不是go<br>每个项目都要<br>setting-tools-File Watchers-导入goimports，<br>gofmt 保存的时候自动 格式化go代码<br>goimports 保存的时候自动导入处理包<br>gometalinter 保存的时候自动检查go语法</p>
<p>Edit configurations run kind选择file可以运行每个文件，如果是package，整个目录只能有一个main函数</p>
<p>Go 的源文件以 <code>.go</code> 为后缀名存储在计算机中，这些文件名均由小写字母组成，如 <code>scanner.go</code> 。<br>如果文件名由多个部分组成，则使用下划线 <code>_</code> 对它们进行分隔，如 <code>scanner_test.go</code> 。<br>文件名不包含空格或其他特殊字符。</p>
<p>gofmt 大部分的格式问题可以通过gofmt解决， gofmt 自动格式化代码，保证所有的 go 代码与官方推荐的格式保持一致，于是所有格式有关问题，都以 gofmt 的结果为准。</p>
<p>goimport 我们强烈建议使用 goimport ，该工具在 gofmt 的基础上增加了自动删除和引入包.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get golang.org/x/tools/cmd/goimports</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">/* 这是我的第一个简单的程序 */</span></span><br><span class="line">   fmt.Println(<span class="string">"Hello, World!"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><p>第一行代码 <code>package main</code> 定义了包名。如：<br><code>package main</code>表示一个可独立执行的程序，每个 Go 应用程序都包含一个名为 <code>main</code> 的包。<br><code>main</code> 的包包含可执行入口，有main函数，go语言编译器会把main包编译成可执行的二进制文件<br>包名为 main 的包为应用程序的入口包，编译源码没有 main 包时，将无法编译输出可执行的文件</p>
</li>
<li><p>下一行 <code>import "fmt"</code> 告诉 Go 编译器这个程序需要使用 <code>fmt</code> 包（的函数，或其他元素），<code>fmt</code> 包实现了格式化 <code>IO</code>（输入/输出）的函数，比内置<code>buildin</code>的<code>println</code>功能强大</p>
</li>
<li><p>下一行 <code>func main() {}</code> 是程序开始执行的函数。<br><code>main</code> 函数是每一个可执行程序所必须包含的，一般来说都是在启动后第一个执行的函数（如果有 <code>init()</code> 函数则会先执行该函数）。不像python用<code>def</code>定义函数， <code>def func</code> 还要显示调用<code>func()</code></p>
</li>
<li><p>下一行 <code>/*...*/</code> 是注释，注释在程序执行时将被忽略不会被编译，每一个包应该有相关注释。<br>单行注释是最常见的注释形式，你可以在任何地方使用以 <code>//</code> 开头的单行注释。<br>多行注释也叫块注释，均已以 <code>/*</code> 开头，并以 <code>*/</code> 结尾，且不可以嵌套使用，多行注释一般用于包的文档描述或注释成块的代码片段。</p>
</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单行注释</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Author by 菜鸟教程</span></span><br><span class="line"><span class="comment"> 我是多行注释</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="5">
<li><p>下一行 <code>fmt.Println(...)</code> 可以将字符串输出到控制台，并在最后自动增加换行字符 <code>\n</code>。<br>使用 <code>fmt.Print("hello, world\n")</code> 可以得到相同的结果。<br><code>Print</code> 和 <code>Println</code> 这两个函数也支持使用变量，如：<code>fmt.Println(arr)</code>。<br>如果没有特别指定，它们会以默认的打印格式将变量 <code>arr</code> 输出到控制台。</p>
</li>
<li><p>当标识符（包括常量、变量、类型、函数名、结构字段等等）以<strong>一个大写字母开头</strong>，<br>如：<code>Group1</code>，那么使用这种形式的标识符的对象就可以被外部包的代码所使用（客户端程序需要先导入这个包），这被称为导出（像面向对象语言中的 <code>public</code>）；<br>标识符如果以<strong>小写字母开头</strong>，则对包外是不可见的，但是他们在整个包的内部是可见并且可用的（像面向对象语言中的 <code>protected</code> ）。</p>
</li>
</ol>
<p>标识符<br>用来命名变量、类型等程序实体。一个标识符实际上就是一个或是多个字母(A<del>Z和a</del>z)数字(0~9)、下划线_组成的序列，<br>但是第一个字符必须是字母或下划线而不能是数字。<br>以下是无效的标识符：<br><code>1ab</code>（以数字开头）<br><code>case</code>（Go 语言的关键字）<br><code>a+b</code>（运算符是不允许的）</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_,x := <span class="number">22</span>,<span class="number">100</span></span><br><span class="line">fmt.Println(_, x)  <span class="comment">// cannot use _ as value</span></span><br></pre></td></tr></tbody></table></figure>

<p>打开命令行终端，并进入程序文件保存的目录中。<br>并按回车执行 Go 语言代码<br>文件的名字是 hello.go</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run hello.go</span></span><br><span class="line">Hello, World!</span><br></pre></td></tr></tbody></table></figure>

<p>是不是有一种操纵脚本的感觉，写完代码直接运行，中间的编译链接过程似乎都省去了。<br>不过 go run 指令只是用来开发调试用的，在生产环境中程序可不是这样跑的。<br>在开发完成后，需要将程序编译成没有任何依赖的二进制可执行文件，扔到服务器上运行起来。这个编译成二进制文件的指令就是</p>
<p><code>go build</code> 命令将默认会编译当前目录下和所有子目录下的所有go文件编译生成没有任何依赖的可执行二进制文件。即使服务器上没有 go 环境，它也是可以直接运行的。因为编译器已经将运行时依赖项都融进了这单一的可执行文件。这也是 go 语言的特色之处，让用户编写的程序可以轻装上阵。</p>
<p>（go build 后面也可以带具体的文件名，只编译那个文件，不会报错）<br>可能会报错，因为多个go文件中可能存在重复的main函数<br>解决办法：将main函数文件存放在各自的单独的目录下（这个方法也是go语言官方的解决办法，一个项目其实也不会有很多的main函数，所以这个是可行的）<br>每次遇到import会触发gomod，去镜像拉取一些库放到本地统一的缓存<br>所有的依赖</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go build hello.go</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">hello    hello.go</span><br><span class="line"><span class="meta">$</span><span class="bash"> ./hello</span></span><br><span class="line">Hello, World!</span><br><span class="line"><span class="meta">$</span><span class="bash"> hello.exe</span></span><br><span class="line">Hello, World!</span><br></pre></td></tr></tbody></table></figure>

<p>执行完毕后可以看到目录下多了一个 hello 的可执行文件。运行它可以直接看到输出结果。</p>
<h3 id="在哪里写代码？"><a href="#在哪里写代码？" class="headerlink" title="在哪里写代码？"></a>在哪里写代码？</h3><p>如果你只是跑一下 demo ，写一个 main 方法，那么你可以在任意路径编写 main.go 文件，然后执行 go run main.go 就可以运行代码了。<br>如果你要自己编写一个 package，那么就必须在 GOPATH 里面的指定路径来编写代码。</p>
<p>在基础学习阶段，大部分代码都是一个简单的 main 函数，所以对于源码路径没有限制。<br>到了高级阶段，我们免不了要自己编写 package，这时候就必须在 GOPATH 目录下面工作了。</p>
<p>Go 语言中变量的声明必须使用空格隔开，如：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age <span class="keyword">int</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>语句中适当使用空格能让程序更易阅读。</p>
<p>无空格：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fruit=apples+oranges;</span><br></pre></td></tr></tbody></table></figure>

<p>在变量与运算符间加入空格，程序看起来更加美观，如：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fruit = apples + oranges;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>需要注意的是 <code>{</code> 不能单独放在一行，所以以下代码在运行时会产生错误：</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line">{  <span class="comment">// 错误，{ 不能在单独的行上</span></span><br><span class="line">fmt.Println(<span class="string">"Hello, World!"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="行分隔符"><a href="#行分隔符" class="headerlink" title="行分隔符"></a>行分隔符</h3><p>在 Go 程序中，一行代表一个语句结束。每个语句不需要像 C 家族中的其它语言一样以分号 <code>;</code> 结尾，因为这些工作都将由 Go 编译器自动完成。<br>如果你打算将多个语句写在同一行，它们则必须使用 <code>;</code> 人为区分，但在实际开发中我们并不鼓励这种做法。<br>以下为两个语句：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">"Hello, World!"</span>)</span><br><span class="line">fmt.Println(<span class="string">"菜鸟教程：runoob.com"</span>)</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/go-bian-liang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/go-bian-liang/" class="post-title-link" itemprop="url">go变量</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-02 10:25:53" itemprop="dateModified" datetime="2021-08-02T10:25:53Z">2021-08-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>变量几乎在所有编程语言中都存在。变量相当于是内存中的一块数据、存储空间，可以通过定义一个变量来申请一块数据存储空间，之后可以通过所定义的变量名来操作我们申请的这块存储空间。可以说变量是我们编写的程序的一个最基本的组成单元或者叫组成单位。</p>
<p>在编程中，变量在其实现了变量的功能后 ，作用范围越小 ，所造成的问题可能性越小，<br>每一个变量代表一个状态，有状态的地方，状态就会被修改，<br>函数的局部变量只会影响一个函数的执行，<br>但全局 变量可能会影响所有代码的执行状态，因此限制变量的作用范围对代码的稳定性有很大的帮助 。</p>
<p>那么每一块存储空间应该存储什么类型的变量呢？这就引出了我们的数据类型。</p>
<ol>
<li>作用<br>通过对变量的操作来实现对我们关注的数据的操作。</li>
<li>应用场景<br>在计算机中存储我们需要的数据，这时候就需要使用到变量</li>
</ol>
<p>go语言是静态语言，要求变量的类型和赋值的类型必须一致。<br>变量名不能冲突。(同一个作用于域内不能冲突)</p>
<p>变量必须先定义才能使用，定义了必须要使用<br>如果你在定义变量 a 之前使用它，则会得到编译错误 <code>undefined: a</code>。</p>
<p>如果在相同的代码块中，我们不可以再次对于相同名称的变量使用初始化声明，<br>例如：<code>a := 20</code> 就是不被允许的，编译器会提示错误 <code>no new  variables on left side of :=</code>，但是 <code>a = 20</code> 是可以的，因为这是给相同的变量赋予一个新的值。</p>
<p>如果你声明了一个局部变量却没有在相同的代码块中使用它，对于已声明但未使用的变量会无法通过编译，抛出<code>declared and not used</code></p>
<p>单纯地给 a 赋值也是不够的，这个值必须被使用，所以使用在同一个作用域中，已存在同名的变量，则之后的声明初始化，则退化为赋值操作。但这个前提是，最少要有一个新的变量被定义，且在同一作用域，</p>
<p>变量命名<br>和结构体类似，变量名称一般遵循驼峰法，首字母根据访问控制原则大写或者小写，但遇到特有名词时，需要遵循以下规则：<br>如果变量为私有，且特有名词为首个单词，则使用小写，如 apiClient<br>其它情况都应当使用该名词原有的写法，如 APIClient、repoID、UserID<br>错误示例：UrlArray，应该写成 urlArray 或者 URLArray<br>若变量类型为 bool 类型，则名称应以 Has, Is, Can 或 Allow 开头</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isExist <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">var</span> hasConflict <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">var</span> canManage <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">var</span> allowGitHook <span class="keyword">bool</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    x := <span class="number">140</span></span><br><span class="line">    fmt.Println(&amp;x)</span><br><span class="line">    x, y := <span class="number">200</span>, <span class="string">"abc"</span></span><br><span class="line">    fmt.Println(&amp;x, x)</span><br><span class="line">    fmt.Print(y)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> index <span class="keyword">int</span></span><br><span class="line"><span class="comment">// 如果一个变量暂时不使用，可以赋值给他自己</span></span><br><span class="line">index = index</span><br></pre></td></tr></tbody></table></figure>

<p>在使用多重赋值时候，如果不需要在左值中接收变量，没有名称的变量、类型或方法。<br>虽然这不是必须的，但有时候这样做可以极大地增强代码的灵活性，这些变量被统称为匿名变量<code>_</code>。<br>有些情况下并不会使用index这个变量。但是这个时候index的变量不使用但是index这个名称却被占用了<br>python中申明了变量名后续代码中不使用并没有问题，<br>但是go语言中声明了变量不使用就会报错，所以匿名变量在go语言中会更加的常用。<br><code>_</code> 本身就是一个特殊的标识符，被称为空白标识符。<br>它可以像其他标识符那样用于变量的声明或赋值（任何类型都可以赋值给它），<br>但任何赋给这个标识符的值都将被抛弃，因此这些值不能在后续的代码中使用，<br>也不可以使用这个标识符作为变量对其它变量进行赋值或运算。<br>用在函数多返回的时候。<br>接收函数返回值的时候使用到了匿名变量。因为此处我们并不打印返回的值而只是关心函数调用是否成功</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span> <span class="params">(<span class="keyword">int</span>, error)</span></span>  {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    _, err := test()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(<span class="string">"函数调用成功"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="申请变量的几个方法"><a href="#申请变量的几个方法" class="headerlink" title="申请变量的几个方法"></a>申请变量的几个方法</h3><h4 id="单变量声明"><a href="#单变量声明" class="headerlink" title="单变量声明"></a>单变量声明</h4><p><code>var</code>名称类型是声明单个变量的语法。</p>
<ol>
<li>指定变量类型，声明后不赋值有默认的零值(根据数据类型来确定零值)</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> variables1 <span class="keyword">int</span> <span class="comment">// 不同于 java 的 int i</span></span><br><span class="line">fmt.Println(variables1)  <span class="comment">// 0</span></span><br></pre></td></tr></tbody></table></figure>

<p>变量零值：变量或者说数组在定义时未赋值时的默认值</p>
<p>整型：默认值0<br>int 0<br>int8 0<br>int32 0<br>int64 0<br>rune 0 // rune 的实际类型是 int32<br>float32 0 // 长度为 4 byte<br>float64 0 // 长度为 8 byte<br>bool false // bool默认为false<br>string “”  字符串<br>pointer nil</p>
<ol start="2">
<li>简短声明，不需要声明变量类型，省略<code>var</code>，</li>
</ol>
<p><strong>只能在函数体内部使用，不能用于包里面的全局变量的声明与赋值</strong><br><code>:=</code>左侧的变量不应该是已经声明过的(多个变量同时声明时，至少保证一个是新变量)，否则会导致编译错误(简短声明)</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    variables2 := <span class="string">"ashe"</span></span><br><span class="line">    fmt.Println(variables2)  <span class="comment">// ashe</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bb := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(bb)  <span class="comment">// syntax error: non-declaration statement outside function body</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li><code>var variables = value</code> 形式，赋值并没有设置类型，编译器根据值自动判断推断推导变量类型(Type inference)<br>如果一个变量有一个初始值，Go将自动能够使用初始值来推断该变量的类型。<br>因此，如果变量具有初始值，则可以省略变量声明中的类型。</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义并初始化</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">10</span> <span class="comment">// 尽量省略变量声明中的类型</span></span><br><span class="line">fmt.Println(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variables3 = <span class="number">10</span></span><br><span class="line">fmt.Println(variables1)  <span class="comment">// 10</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="多变量声明定义-以逗号分隔"><a href="#多变量声明定义-以逗号分隔" class="headerlink" title="多变量声明定义 以逗号分隔"></a>多变量声明定义 以逗号分隔</h4><ol start="4">
<li>声明与赋值分开，若不赋值，存在默认值</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a, b, c <span class="keyword">int</span></span><br><span class="line">a, b, c = <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span></span><br><span class="line">fmt.Println(a, b, c)</span><br></pre></td></tr></tbody></table></figure>

<p>声明与赋值合并 下面的变量类型可以是不同的类型</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d, e, f <span class="keyword">int</span> = <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span></span><br><span class="line">fmt.Println(d, e, f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g, h, i = <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span></span><br><span class="line">fmt.Println(g, h, i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variables4, variables5, variables6, variables7 = <span class="number">1</span>, <span class="string">"ashe"</span>, <span class="number">3.14</span>, <span class="literal">true</span></span><br><span class="line">fmt.Println(variables4, variables5, variables6, variables7)</span><br><span class="line"><span class="comment">// 1 ashe 3.14 true</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="6">
<li>简短声明，多次赋值</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">variables4, variables5, variables6, variables7 := <span class="number">1</span>, <span class="string">"ashe"</span>, <span class="number">3.14</span>, <span class="literal">true</span></span><br><span class="line">fmt.Println(variables4, variables5, variables6, variables7)</span><br><span class="line"><span class="comment">// 1 ashe 3.14 true</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="7">
<li>集合类型，申请多个全局变量，不用重复写多个 <code>var</code> ，在函数体外部</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    variablesx <span class="keyword">int</span></span><br><span class="line">    slicex     []<span class="keyword">int</span></span><br><span class="line">    interfacex <span class="keyword">interface</span>{}</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">)</span><br><span class="line">fmt.Println(variablesx, slicex, interfacex)</span><br><span class="line"><span class="comment">// 0 [] &lt;nil&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>7.变量的交换</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">100</span></span><br><span class="line"><span class="keyword">var</span> j = <span class="number">200</span></span><br><span class="line">fmt.Println(i, j)</span><br><span class="line"><span class="comment">// 100 200</span></span><br><span class="line">i,j = j,i</span><br><span class="line">fmt.Println(i, j)</span><br><span class="line"><span class="comment">// 200 100</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/linux-fang-huo-qiang-fu-wu-pei-zhi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/linux-fang-huo-qiang-fu-wu-pei-zhi/" class="post-title-link" itemprop="url">linux 防火墙 服务配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-25 05:23:09" itemprop="dateModified" datetime="2021-06-25T05:23:09Z">2021-06-25</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>防火墙选择让请求通过，从而保证网络安全性。</p>
<p>在linux下配置</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld.service</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl restart firewalld.service</span><br><span class="line"></span><br><span class="line">firewall-cmd start 启动</span><br><span class="line">firewall-cmd stop 关闭</span><br><span class="line">firewall-cmd restart 重启</span><br><span class="line"></span><br><span class="line">firewall-cmd --version</span><br><span class="line">firewall-cmd --<span class="built_in">help</span></span><br><span class="line">firewall-cmd --state  查看防火墙状态</span><br></pre></td></tr></tbody></table></figure>

<p>端口管理 </p>
<p>开放端口 设置是一个范围，删除必须是一个范围</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=3306-3307/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=3306/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=8080-8085/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=8000/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=80/tcp --permanent</span><br></pre></td></tr></tbody></table></figure>

<p>查询端口是否开放</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --query-port=3306/tcp</span><br><span class="line">firewall-cmd --query-port=8000/tcp</span><br><span class="line">firewall-cmd --query-port=80/tcp</span><br></pre></td></tr></tbody></table></figure>

<p>查看开发的端口</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-ports --permanent</span><br></pre></td></tr></tbody></table></figure>

<p>移除3306端口</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --remove-port=3307/tcp --permanent</span><br><span class="line">firewall-cmd --remove-port=8080-8085/tcp --permanent</span><br></pre></td></tr></tbody></table></figure>

<p>重启防火墙（修改配置后要重启加载设置）</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></tbody></table></figure>

<p>firewall-cmd –get-zones（查看所有区域）<br>firewall-cmd –get-default-zone（查看默认区域）<br>firewall-cmd –list-all  显示目前的设定<br>firewall-cmd –list-all-zone（查看所有区域配置信息）</p>
<p>查询服务：firewall-cmd –zone=public（默认为此）–query-service=ssh<br>删除服务：firewall-cmd –zone=public（默认为此）–remove-service=ssh<br>添加服务：firewall-cmd –add-service=ssh<br>列出服务（service）：<br>firewall-cmd –list-services<br>firewall-cmd –list-services  –permanent 查看哪些程序使用互联网</p>
<p>sudo firewall-cmd –zone=public –permanent –add-port=4369/tcp –add-port=25672/tcp –add-port=5671-5672/tcp –add-port=15672/tcp –add-port=61613-61614/tcp –add-port=1883/tcp –add-port=8883/tcp<br>sudo firewall-cmd –reload</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/web-xiang-mu-bu-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/web-xiang-mu-bu-shu/" class="post-title-link" itemprop="url">web项目部署</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-20 11:34:16" itemprop="dateModified" datetime="2021-07-20T11:34:16Z">2021-07-20</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>常见的部署方式</p>
<ul>
<li>nginx + gunicorn</li>
<li>nginx + uwsgi</li>
<li>docker</li>
</ul>
<h2 id="Web服务器nginx"><a href="#Web服务器nginx" class="headerlink" title="Web服务器nginx"></a>Web服务器nginx</h2><p>原理<br>静态文件(js/css/img) &lt;–&gt; nginx &lt;–&gt; 磁盘<br>动态请求  &lt;–&gt; nginx &lt;–&gt;  wsgi</p>
<p>yum安装nginx(和源码安装的安装命令和路径不一样)<br>安装必备软件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install yum-utils</span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">vim nginx.repo</span><br></pre></td></tr></tbody></table></figure>

<p>进入交互模式 按i，复制下面内容</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br></pre></td></tr></tbody></table></figure>

<p>Esc :wq</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --<span class="built_in">enable</span> nginx-mainline</span><br><span class="line">sudo yum install nginx</span><br><span class="line">nginx</span><br><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></tbody></table></figure>

<p>浏览器输入 <code>http:公网IP</code><br><a target="_blank" rel="noopener" href="http://nginx.org/en/linux_packages.html"></a></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># cd /etc/nginx/</span></span><br><span class="line">[root@VM-0-9-centos nginx]<span class="comment"># ls</span></span><br><span class="line">conf.d  fastcgi_params  mime.types  modules  nginx.conf  scgi_params  uwsgi_params</span><br><span class="line">[root@VM-0-9-centos nginx]<span class="comment"># vim nginx.conf </span></span><br><span class="line">[root@VM-0-9-centos nginx]<span class="comment"># cd conf.d/</span></span><br><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># ls</span></span><br><span class="line">default.conf</span><br><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># vim default.conf </span></span><br><span class="line">/usr/share/nginx/html</span><br></pre></td></tr></tbody></table></figure>

<h2 id="部署Vue-js"><a href="#部署Vue-js" class="headerlink" title="部署Vue.js"></a>部署Vue.js</h2><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> apiHost = <span class="string">'/api'</span></span><br></pre></td></tr></tbody></table></figure>

<p>当是<code>/api</code>开头，nginx把它转发给wsgi对应的内容进行处理，就会处理django的内容</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></tbody></table></figure>

<p>把写好的代码组件、相关引用构建成一个生产使用的代码，里面的js进行压缩，css经过提取，vue项目打包后，在工程目录下出现一个dist文件夹，包括的静态文件和项目的请求IP都打入包内，如果后台服务改动，这时你的前端文件，又要重新编译打包，<br>压缩成zip文件上传到这台服务器<code>/mnt/www/trip-mobile/dist</code>，可以用ftp文件上传或者scp命令 <code>scp ./dist.zip root@8.129.38.87:/mnt/www/trip-mobile</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># cd /</span></span><br><span class="line">[root@VM-0-9-centos /]<span class="comment"># cd /mnt/</span></span><br><span class="line">[root@VM-0-9-centos mnt]<span class="comment"># mkdir www</span></span><br><span class="line">[root@VM-0-9-centos mnt]<span class="comment"># cd www/</span></span><br><span class="line">[root@VM-0-9-centos www]<span class="comment"># mkdir trip-mobile</span></span><br><span class="line">[root@VM-0-9-centos www]<span class="comment"># cd trip-mobile</span></span><br><span class="line">[root@VM-0-9-centos www]<span class="comment"># unzip dist.zip</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="配置ngix"><a href="#配置ngix" class="headerlink" title="配置ngix"></a>配置ngix</h2><p>linux通常会禁止绑定使用1024以下的端口，除非在root用户权限。<br>很多人在使用gunicorn时试图将其绑定到80或者443端口，发现无效。<br>如果想绑定到这些端口，常见的有如下的几种方法：</p>
<ul>
<li>使用Nginx代理转发。</li>
<li>sudo启动gunicorn。</li>
</ul>
<p>把Nginx服务器的默认路径改成我们项目所在的路径。<br>如果你的vue工程用的路由是history模式，需要将客户端发来的url重定向到默认的index.html，才能正常访问。否则只能看到主页。刷新或点击其他页面都会404。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d/</span><br><span class="line">vim default.conf</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">    # 1.监听 80 端口</span><br><span class="line">    listen       80;</span><br><span class="line"></span><br><span class="line">    # 2.这是你部署的IP，你服务器的公网IP 可以localhost或者具体的ip号码</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    # 3.这里配置前端打包文件的映射路径</span><br><span class="line">    root /usr/local/nginx/html;</span><br><span class="line"></span><br><span class="line"># root后面的地址是前端项目文件上传的路径 \路径配置指向静态文件的文件夹, 这样会直接访问该文件夹下的index.html文件的..</span><br><span class="line">location / {</span><br><span class="line">    root   /mnt/www/trip-mobile/dist;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"># 解决跨域问题，将需要代理的后端地址写在 proxy_pass 后面</span><br><span class="line"># 将所有的 http://localhost/api/ 请求，转发到 http://127.0.0.1:8000/api/</span><br><span class="line">location ^~/api/ {</span><br><span class="line">    proxy_pass http://127.0.0.1:8000/;</span><br><span class="line">    add_header X-Slave $upstream_addr;</span><br><span class="line">    proxy_redirect     off;</span><br><span class="line">    proxy_set_header   Host             $host;</span><br><span class="line">    proxy_set_header   X-Real-IP        $remote_addr;</span><br><span class="line">    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">location ^~/admin {</span><br><span class="line">    proxy_pass http://127.0.0.1:8000/admin;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">location ^~/master {</span><br><span class="line">    proxy_pass http://127.0.0.1:8000/master;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">location ^~/static {</span><br><span class="line">    alias /mnt/www/trip/static;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Esc</span> + <span class="selector-pseudo">:wq</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果需要配置多个vue项目，只需添加多个 server 配置即可。</p>
<p>测试语法和配置是否正常</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></tbody></table></figure>

<p>重启</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></tbody></table></figure>

<p>Nginx后可能发现访问不到Nginx主页，至少我第一次没成功，这是因为防火墙配置的问题。<br>我测试的时候装的是CentOS7下执行以下命令打开80端口。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br></pre></td></tr></tbody></table></figure>

<p>浏览器输入服务器IP和配置的端口 <a target="_blank" rel="noopener" href="http://81.69.41.250/">http://81.69.41.250:80/</a>  可以打开页面，但是只有前端页面没有后台数据，<br><a target="_blank" rel="noopener" href="http://81.69.41.250/admin">http://81.69.41.250/admin</a> 打开admin后台管理<br><a target="_blank" rel="noopener" href="http://81.69.41.250/master">http://81.69.41.250/master</a> 打开echart可视化</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /mnt/www/trip/trip/settings.py</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip\settings.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MEDIA_URL = 'http://localhost:8080'</span></span><br><span class="line">MEDIA_URL = <span class="string">'http://81.69.41.250/'</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'81.69.41.250'</span>, <span class="string">'127.0.0.1'</span>]</span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">'static'</span>)</span><br><span class="line"><span class="comment"># STATICFILES_DIRS = [</span></span><br><span class="line"><span class="comment">#     os.path.join(BASE_DIR, "static")</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mnt/www/trip/</span><br><span class="line">python manage.py collectstatic</span><br></pre></td></tr></tbody></table></figure>

<p>收集完后要改回来</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALLOWED_HOSTS = [<span class="string">'81.69.41.250'</span>, <span class="string">'127.0.0.1'</span>]</span><br><span class="line"><span class="comment"># STATIC_ROOT = os.path.join(BASE_DIR, 'static')</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">"static"</span>)</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>新建 <code>trip.ini</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos www]<span class="comment"># vim trip.ini</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">socket</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9090</span></span><br><span class="line"><span class="attr">master</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">pidfile</span> = /var/run/trip.pid</span><br><span class="line"><span class="attr">daemonize</span> = /var/log/uwsgi/trip.log</span><br><span class="line"><span class="attr">module</span>= trip.wsgi:application</span><br><span class="line"><span class="attr">chdir</span> = /mnt/www/trip</span><br><span class="line"><span class="attr">listen</span> = <span class="number">100</span></span><br><span class="line"><span class="attr">buffer-size</span> = <span class="number">32768</span></span><br><span class="line"><span class="attr">max-requests</span> = <span class="number">200</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos www]<span class="comment"># mkdir -p /var/log/uwsgi/</span></span><br><span class="line">[root@VM-0-9-centos www]<span class="comment"># uwsgi --ini trip.ini</span></span><br><span class="line">[uWSGI] getting INI configuration from trip.ini</span><br><span class="line">[root@VM-0-9-centos www]<span class="comment"># ps -ef|grep uwsgi</span></span><br><span class="line">root     17716     1  2 13:55 ?        00:00:00 uwsgi --ini trip.ini</span><br><span class="line">root     17722 17716  0 13:55 ?        00:00:00 uwsgi --ini trip.ini</span><br><span class="line">root     17806 28919  0 13:55 pts/7    00:00:00 grep --color=auto uwsgi</span><br></pre></td></tr></tbody></table></figure>

<p>python代码发生变化，重启uwsgi，使用 <code>kill -9 进程ID</code> 命令来杀掉主进程，子进程会随之结束</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos www]<span class="comment"># kill -HUP 17716</span></span><br><span class="line">[root@VM-0-9-centos www]<span class="comment"># ps -ef|grep uwsgi</span></span><br><span class="line">root     17716     1  0 13:55 ?        00:00:00 /usr/<span class="built_in">local</span>/bin/uwsgi --ini trip.ini</span><br><span class="line">root     18454 17716  0 13:58 ?        00:00:00 /usr/<span class="built_in">local</span>/bin/uwsgi --ini trip.ini</span><br><span class="line">root     18460 28919  0 13:58 pts/7    00:00:00 grep --color=auto uwsgi</span><br></pre></td></tr></tbody></table></figure>

<p>动态的接口分发到uwsgi上处理</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos www]<span class="comment"># cd /etc</span></span><br><span class="line">[root@VM-0-9-centos etc]<span class="comment"># cd nginx/</span></span><br><span class="line">[root@VM-0-9-centos nginx]<span class="comment"># cd conf.d/</span></span><br><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># ls</span></span><br><span class="line">default.conf  default.conf.bak</span><br><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># cp default.conf django.conf</span></span><br><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># vim d</span></span><br><span class="line">default.conf      default.conf.bak  django.conf</span><br><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># vim django.conf</span></span><br></pre></td></tr></tbody></table></figure>

<p>location 的内容</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    location / {</span><br><span class="line">      uwsgi_pass 127.0.0.1:9090;</span><br><span class="line">      uwsgi_param UWSGI_SCRIPT trip.wsgi;</span><br><span class="line">      include uwsgi_params;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">    location ^~/static {</span><br><span class="line">        alias /mnt/www/trip/static;</span><br><span class="line">    }</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># nginx -t</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos conf.d]<span class="comment"># systemctl stop firewalld.service</span></span><br></pre></td></tr></tbody></table></figure>

<p>把静态文件移动到django项目</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos trip-mobile]<span class="comment"># cd dist/</span></span><br><span class="line">[root@VM-0-9-centos dist]<span class="comment"># ls</span></span><br><span class="line">css  favicon.ico  index.html  js  static</span><br><span class="line">[root@VM-0-9-centos dist]<span class="comment"># cd static/</span></span><br><span class="line">[root@VM-0-9-centos static]<span class="comment"># ls</span></span><br><span class="line">home  mine  qrcode.png  sight</span><br><span class="line">[root@VM-0-9-centos static]<span class="comment"># cp qrcode.png /mnt/www/trip/static/</span></span><br><span class="line">[root@VM-0-9-centos static]<span class="comment"># cp -r home /mnt/www/trip/static/</span></span><br><span class="line">[root@VM-0-9-centos static]<span class="comment"># cp -r mine/ /mnt/www/trip/static/</span></span><br><span class="line">[root@VM-0-9-centos static]<span class="comment"># cp -r sight/ /mnt/www/trip/static/</span></span><br></pre></td></tr></tbody></table></figure>

<p>远程调试</p>
<p>setting-Add Python Interpreter- SSH Interpreter</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/drf-parser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/drf-parser/" class="post-title-link" itemprop="url">drf Parser</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 07:35:01" itemprop="dateModified" datetime="2021-06-16T07:35:01Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>为什么DRF支持这么轻松的上传文件？</p>
<p>在DRF Api <a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/parsers/#multipartparser">https://www.django-rest-framework.org/api-guide/parsers/#multipartparser</a></p>
<p>MultiPartParser<br>Parses multipart HTML form content, which supports file uploads. Both <code>request.data</code> will be populated with a <code>QueryDict</code>.<br>解析多部分HTML表单内容，支持文件上传。<code>request.data</code> 都将被一个 <code>QueryDict</code>填充。</p>
<p>You will typically want to use both <code>FormParser</code> and <code>MultiPartParser</code> together in order to fully support HTML form data.你通常会同时使用<code>FormParser</code>和<code>MultiPartParser</code>两者，以便完全支持HTML表单数据。</p>
<p><strong>.media_type</strong>: <code>multipart/form-data</code></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/go-chang-liang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/go-chang-liang/" class="post-title-link" itemprop="url">go常量</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-03 11:13:28" itemprop="dateModified" datetime="2021-08-03T11:13:28Z">2021-08-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><ul>
<li>一个简单值的标识符</li>
<li>在编译的时候确定的值，在程序运行时，不会被修改的量。</li>
</ul>
<p>常量均需使用全部大写字母组成，并使用下划线分词，如果首字母大写可读性</p>
<p>显式类型定义： <code>const A string = "abc"</code><br>隐式类型定义： <code>const A = "abc"</code> <code>const APP_VER = "1.0"</code></p>
<p>如果是枚举类型的常量，需要先创建相应类型</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Scheme <span class="keyword">string</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    HTTP  Scheme = <span class="string">"http"</span></span><br><span class="line">    HTTPS Scheme = <span class="string">"https"</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>显示指定类型的时候，必须确保常量左右值类型一致，需要时可做显示类型转换。<br>这与变量就不一样了，变量是可以是不同的类型值</p>
<ul>
<li><p>常量中的数据类型只可以是布尔型、数字型（整数型、浮点型和复数）和字符串型</p>
</li>
<li><p>不曾使用的常量，在编译的时候，是不会报错的</p>
</li>
</ul>
<p>作用<br>全局唯一，编译期就已经确定的值，提高程序执行效率</p>
<h2 id="常量引入-应用场景"><a href="#常量引入-应用场景" class="headerlink" title="常量引入 应用场景"></a>常量引入 应用场景</h2><ul>
<li>当程序中需要引入一个在整个程序运行期，数据不发生改变时，使用常量</li>
<li>枚举数据</li>
</ul>
<h3 id="Go-语言预定义常量"><a href="#Go-语言预定义常量" class="headerlink" title="Go 语言预定义常量"></a>Go 语言预定义常量</h3><ul>
<li>true</li>
<li>false</li>
<li>iota</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="keyword">const</span> LENGTH <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">   <span class="keyword">const</span> WIDTH <span class="keyword">int</span> = <span class="number">5</span></span><br><span class="line">   <span class="keyword">var</span> area <span class="keyword">int</span></span><br><span class="line">   <span class="keyword">const</span> a, b, c = <span class="number">1</span>, <span class="literal">false</span>, <span class="string">"str"</span> <span class="comment">// 多重赋值 不指定类型</span></span><br><span class="line"></span><br><span class="line">   area = LENGTH * WIDTH</span><br><span class="line">   fmt.Printf(<span class="string">"面积为 : %d"</span>, area)</span><br><span class="line">   fmt.Println(a, b, c)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>常量可以作为枚举，常量组</p>
<ul>
<li>常量组中如不指定类型和初始化值，该类型和值和上一行非空常量的表达式(值和类型)相同</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">const</span> (</span><br><span class="line">        x <span class="keyword">int</span> = <span class="number">16</span></span><br><span class="line">        y</span><br><span class="line">        s = <span class="string">"abc"</span></span><br><span class="line">        z</span><br><span class="line">        u</span><br><span class="line">    )</span><br><span class="line">    fmt.Println(x, y, s, z) <span class="comment">// 16 16 abc abc</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T,%v\n"</span>, y, y)  <span class="comment">// int,16</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T,%v\n"</span>, z, z)  <span class="comment">// string,abc</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h3><ul>
<li>是希腊字母中第9个字母：Ι, ι，英文释义为极小值</li>
<li>特殊常量，可以认为是一个可以被编译器修改的常量，常量计数器</li>
<li>iota只能在常量组中是使用</li>
<li>使用iota能简化定义，在定义枚举时很有用。</li>
<li>不同的const定义块互相不干扰</li>
<li>没有表达式的常量定义复用上一行上的一个常量的的表达式</li>
<li>每个 <code>const</code> 出现时，都会让 iota 初始化重置为0.</li>
<li>iota代表的是这里的行数，从第一行开始，iota从0逐行加一<br>每当 iota 在新的一行被使用时，它的值都会自动加 1</li>
</ul>
<p>如果中断iota自增，则必须显式恢复。且后续自增值按行序递增</p>
<p>自增默认是int类型，可以自行进行显示指定类型</p>
<p>数字常量不会分配存储空间，无须像变量那样通过内存寻址来取值，因此无法获取地址</p>
<p>源码</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// iota is a predeclared identifier representing the untyped integer ordinal</span></span><br><span class="line"><span class="comment">// number of the current const specification in a (usually parenthesized)</span></span><br><span class="line"><span class="comment">// const declaration. It is zero-indexed.</span></span><br><span class="line"><span class="keyword">const</span> <span class="literal">iota</span> = <span class="number">0</span> <span class="comment">// Untyped int.</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a    = <span class="literal">iota</span>       <span class="comment">// iota  = 0</span></span><br><span class="line">    b                 <span class="comment">// iota = 1 每一行iota加一</span></span><br><span class="line">    c                 <span class="comment">// iota = 2 每一行iota加一</span></span><br><span class="line">    d    = <span class="string">"ha"</span>       <span class="comment">//独立值，d = "ha" iota += 1 = 3</span></span><br><span class="line">    e                 <span class="comment">// e = "ha"   iota += 1 = 4</span></span><br><span class="line">    f    = <span class="number">100</span>        <span class="comment">// f = 100 iota +=1 = 5</span></span><br><span class="line">    g                 <span class="comment">// g = 100  iota += 6</span></span><br><span class="line">    h    = <span class="literal">iota</span>       <span class="comment">// iota += 7,恢复计数</span></span><br><span class="line">    i                 <span class="comment">// iota += 8</span></span><br><span class="line">    j, k = <span class="literal">iota</span>, <span class="literal">iota</span> <span class="comment">//  iota += 9</span></span><br><span class="line">)</span><br><span class="line">fmt.Println(a, b, c, d, e, f, g, h, i, j, k)</span><br><span class="line"><span class="comment">// 0 1 2 ha ha 100 100 7 8 9 9</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    b = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)</span><br><span class="line">    kb</span><br><span class="line">    mb</span><br><span class="line">    gb</span><br><span class="line">    tb</span><br><span class="line">    pb</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fmt.Println(b, kb, mb, gb, tb, pb)</span><br><span class="line"><span class="comment">// 1 1024 1048576 1073741824 1099511627776</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/django-dan-biao-de-zeng-shan-gai-cha/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/django-dan-biao-de-zeng-shan-gai-cha/" class="post-title-link" itemprop="url">Django单表的增删改查</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 11:12:07" itemprop="dateModified" datetime="2021-07-11T11:12:07Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 教师表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">35</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = ‘teacher’</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加教师</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addteacher</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 添加的方式有多种结合postman测试添加</span></span><br><span class="line">    name = request.POST.get(<span class="string">'name'</span>,<span class="string">''</span>)</span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># try捕获异常</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tea = Teacher(name=name)</span><br><span class="line">        tea.save()</span><br><span class="line">        <span class="keyword">if</span> tea:</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'OK'</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'fail'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admins</span>(<span class="params">request</span>):</span></span><br><span class="line">    tea = Teacher.objects.all()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'index.html'</span>,locals())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">request,uid</span>):</span></span><br><span class="line">    tea = Teacher.objects.get(id=uid)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        id = request.POST.get(<span class="string">'id'</span>)</span><br><span class="line">        name = request.POST.get(<span class="string">'name'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            teacher = Teacher.objects.filter(id=id).update(name=name)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'update.html'</span>,locals())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">request</span>):</span></span><br><span class="line">    id = request.GET.get(<span class="string">'id'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        Teacher.objects.filter(id=id).delete()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'OK'</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">```py</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/go-yi-lai-guan-li/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/go-yi-lai-guan-li/" class="post-title-link" itemprop="url">go依赖管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 03:25:51" itemprop="dateModified" datetime="2021-07-11T03:25:51Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>GOPATH以及目录结构<br>GOPATH 环境变量<br>默认在~/go(Unix, Linux), %USERPROFILE%\go(Windows)<br>官方推荐：所有项目和第三方库都放在同一个 GOPATH 下<br>也可以将每个项目放在不同的 GOPATH</p>
<p>以 Mac 为例(~/.bash_profile)</p>
<p>export GOPATH=/Users/alan/go<br>export PATH=”$GOPATH/bin:$PATH”</p>
<p>export GOPATH=/Users/alan/go<br>export PATH=”$GOPATH/bin:$PATH”</p>
<h3 id="go-modules是一个统一管理，用户不必关心目录结构"><a href="#go-modules是一个统一管理，用户不必关心目录结构" class="headerlink" title="go modules是一个统一管理，用户不必关心目录结构"></a>go modules是一个统一管理，用户不必关心目录结构</h3><p>go module 是Go语言从 1.11 版本之后官方推出的版本管理工具，并且从 Go1.13 版本开始，go module 成为了Go语言默认的依赖管理工具。</p>
<p>通过<code>GO111MODULE</code>环境变量来开启或者关闭<br>GO111MODULE=off 禁用 go module，编译时会从 GOPATH 和 vendor 文件夹中查找包。<br>GO111MODULE=on 启用 go module，编译时会忽略 GOPATH 和 vendor 文件夹，只根据 go.mod 下载依赖。<br>GO111MODULE=auto（默认值），当项目在 $GOPATH/src 目录之外，并且项目根目录有 go.mod 文件时，开启 go module。</p>
<p>◆ 使用module后,GOPATH不再用于解析。把下载的依赖储存在 $GOPATH/pkg/mod 中，也会把 go install 的结果放在 $GOPATH/bin</p>
<p>◆ 要用module ,第一步将项目从中移出去，在以后的开发中就没有必要在 GOPATH/src 中创建项目了，可以把需要统一维护的 repo 放到自己想要放置的任何一个文件夹下，在 Goland 中打开开关后，同样可以正常索引代码，并且还能够很好的管理项目依赖的第三方包信息。</p>
<p>在auto模式下，在$GOPATH/src路径下build时，默认使用vendor、GOPATH导入第三方包，而在GOPATH之外编译时，默认使用go.mod设置导入项目。我们知道vendor机制只有在GOPATH路径之下才起作用，到了GOPATH之外就没用了。</p>
<p>goland会自动生成一个 go.mod 文件</p>
<ul>
<li>来管理依赖,定义模块依赖</li>
<li>放在项目根目录</li>
<li>面向行,由指令+参数组成</li>
</ul>
<p>go.mod 主要指令<br>◆ module:定义当前引用模块和包路径<br>◆ require: 定义依赖的模块的最小版本<br>◆ exclude: 排除特定模块和版本的使用<br>◆ replace:模块源的替换 比方说远程的 module 拉不下来，可以用 replace 替换成另一个来源的 module 或本地的 module。</p>
<p>go.mod 命令<br>go.mod文件用go mod命令来创建和维护</p>
<p>◆ 命令格式</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod &lt;命令&gt; [可选参数]</span><br></pre></td></tr></tbody></table></figure>

<p>命令行生成<br>命令  作用<br>go mod download 下载依赖包模块到本地缓存 ，缓存路径是 $GOPATH/pkg/mod/cache<br>go mod edit 编辑 go.mod 文件<br>go mod graph 打印模块之间的依赖图<br>go mod init xxx(xxx 为module名称 可以自定义) 初始化当前文件夹，创建和初始化go.mod文件</p>
<p><code>go mod tidy</code> will also add requirements sums needed by all packages in the main module. It will also remove requirements and sums that aren’t needed anymore.<br>对于已存在项目进行module化,即可使用该命令 会添加依赖的包,移除go.mod未使用的依赖。执行后会生成go.sum文件(模块下载条目) 自动维护require包版本控制<br>go.sum 文件则是用来记录每个依赖包的版本及哈希值</p>
<p>go mod vendor 将依赖复制到 vendor 目录下<br>go mod verify 校验当前模块的依赖是否已经存储在本地下载的源代码缓存中，以及检查自从下载下来是否有修改，删除不需要的依赖、新增需要的依赖，这个操作不会改变依赖版本。<br>go mod why 解释为什么需要依赖<br>go build go tidy go verify 都会自动维护require包版本控制</p>
<p>go mod edit -require=golang.org/x/net@v0.0.0</p>
<p>手动加入被墙的包(原始包)，一定要记住版本号，实在不知道的话，就试试v0.0.0 版本可以通过执行go build 或者go tidy查看报错中版本号</p>
<p>go mod edit -replace=golang.org/x/net@v0.0.0=github.com/golang/net@latest</p>
<p>用新的包路径替换掉被墙的原始包，在这里新的包版本可以使用latest和master，这个有点人性了！</p>
<p>go mod edit -require 和 -replace 可以通过修改go.mod文件来做</p>
<h3 id="go-get命令下载更新指定版本的第三方扩展依赖包"><a href="#go-get命令下载更新指定版本的第三方扩展依赖包" class="headerlink" title="go get命令下载更新指定版本的第三方扩展依赖包"></a>go get命令下载更新指定版本的第三方扩展依赖包</h3><p>执行go get 命令，在下载依赖包的同时还可以指定依赖包的版本。<br>运行go get -u命令会将项目中的包升级到最新的次要版本或者修订版本；<br>运行go get -u=patch命令会将项目中的包升级到最新的修订版本；<br>运行go get [包名]@[版本号]命令会下载对应包的指定版本或者将对应包升级到指定的版本。<br>提示：go get [包名]@[版本号]命令中版本号可以是 x.y.z 的形式，例如 go get <a href="mailto:foo@v1.2.3">foo@v1.2.3</a>，也可以是 git 上的分支或 tag，例如 go get foo@master，保持最新请使用latest ,还可以是 git 提交时的哈希值，例如 go get foo@e3702bed2。它要求仓库必须用 v1.2.0 格式打 tag，像 v1.2 少个零都不行的，必须是语义化的、带 v 前缀的版本号。,</p>
<p>第一种：命令行拉取</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">go get -u xxx@版本号  # 拉取制定版本号</span><br><span class="line">go get -u xxx  #拉取最新版本</span><br><span class="line"></span><br><span class="line">go get -u go.uber.org/zap</span><br><span class="line">go get -u go.uber.org/zap@v1.11</span><br></pre></td></tr></tbody></table></figure>

<p>第二种：直接在代码里面写入import, 会直接帮你拉下来。</p>
<p>增加依赖:go get xxx 或者import然后get build或者点击快捷方式时自动生成依赖</p>
<p>导入外部包,一个或多个外部的包，<br><code>go get 远程的包名[@v...]</code> 从远程拉取代码以及相关的依赖库，自动完成安装与定义 ,支持github,bitbucket,google code,<br>-u 更新</p>
<p>内部做了两个步骤</p>
<ol>
<li>下载远程的源码包 $GOPATH/src</li>
<li>go install 安装    $GOPATH/pkg/跨平台文件名/包的路径/xxx.a新建一个包是新建一个文件夹，一般小写，在这个包中我们定义一个功能，只是简单的打印，</li>
</ol>
<p>安装git ,svn</p>
<p>项目迁移到go mod：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go build ./...</span><br><span class="line"></span><br><span class="line">go install ./... # 产生的结果在GOPATH目录下的bin目录</span><br></pre></td></tr></tbody></table></figure>

<p>incompatible<br>Module version numbering</p>
<p>一个 module 的版本由三个编号组成，Golang 认为第一个编号变更的时候是大型变更，所以需要新起一个 module。 比方说 v2.2.3 ，我们应该新建一个文件夹 v2，在其中新建一个 go.mod，然后新版本的代码都放在里面。 这样的好处是同一功能不同版本的代码都在同一代码仓库下。</p>
<p>在 Golang 引入 module 前，有一些仓库的 tag 的首位编号已经大于等于 2 ，对于这些没有迁移到 go.mod 的仓库，在作为包引入的时候，就会在我们的仓库下的 go.mod 中打上 +incompatible 标记。</p>
<p>require directive<br>A require directive declares a minimum required version of a given module dependency. 申明了所依赖 module 的最小版本。</p>
<p>indirect<br>An // indirect comment indicates that no package from the required module is directly imported by any package in the main module. The go command adds an indirect requirement when the selected version of a module is higher than what is already implied (transitively) by the main module’s other dependencies. That may occur because of an explicit upgrade (go get -u), removal of some other dependency that previously imposed the requirement (go mod tidy), or a dependency that imports a package without a corresponding requirement in its own go.mod file (such as a dependency that lacks a go.mod file altogether).</p>
<p>如果我们依赖的某个 module 所引用的包不是一个 module（即不包含 go.mod），或者我们用 go get -u 主动升级过非我们直接依赖的 module，那么都会用 indirect 去标记。</p>
<p><code>go clean -modcache</code> 清理本地缓存</p>
<h3 id="传统的-GOPATH-方案"><a href="#传统的-GOPATH-方案" class="headerlink" title="传统的 GOPATH 方案"></a>传统的 GOPATH 方案</h3><p>导致我所有的代码 repo 都在同一个gopath目录之下的src文件夹下，没办法很好的分组。<br>所有项目都在GOPATH目录下，这样会导致目录越来越大，几乎所有的github都镜像到GOPATH下</p>
<ol start="2">
<li>要记得设置GO111MODULE=off, 开始go modules要记得GO111MODULE=on</li>
</ol>
<p>先查找 gopath/src 或 goroot/src 目录之下的包是否有<br>其实就是不做包管理</p>
<p>能用go modules就用modules 不用去考虑以前的开发模式<br>即使你使用了以前的模式 也可以自动设置为现在的modules模式</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/04/19/go-bian-ma-gui-fan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/19/go-bian-ma-gui-fan/" class="post-title-link" itemprop="url">Go编码规范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-18 17:46:44" itemprop="dateCreated datePublished" datetime="2021-04-18T17:46:44Z">2021-04-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 03:39:43" itemprop="dateModified" datetime="2021-07-11T03:39:43Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Go编码规范"><a href="#Go编码规范" class="headerlink" title="Go编码规范"></a>Go编码规范</h1><p>本文参考自<br>     <a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go.html">Effective Go</a>.<br>     <a target="_blank" rel="noopener" href="https://github.com/golang/go/wiki/CodeReviewComments#initialisms">Golang Code Review</a></p>
<pre><code> 侵删。
</code></pre>
<ul>
<li><a href="#gofmt">Gofmt</a></li>
<li><a href="#%E6%B3%A8%E9%87%8A%E8%AF%AD%E5%8F%A5">注释语句</a></li>
<li><a href="#contexts">Contexts</a></li>
<li><a href="#goroutine-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">Goroutine 生命周期</a></li>
<li><a href="#%E6%8B%B7%E8%B4%9D">拷贝</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8crypto-rand%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E5%80%BC">使用crypto rand生成随机值</a></li>
<li><a href="#%E7%A9%BA%E5%88%87%E7%89%87">空切片</a></li>
<li><a href="#panic">Panic</a></li>
<li><a href="#%E9%94%99%E8%AF%AF">错误</a></li>
<li><a href="#%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B">用法示例</a></li>
<li><a href="#imports">Imports</a></li>
<li><a href="#%E6%8E%A5%E5%8F%A3">接口</a></li>
<li><a href="#%E5%8D%95%E8%A1%8C%E4%BB%A3%E7%A0%81%E9%95%BF%E5%BA%A6">单行代码长度</a></li>
<li><a href="#%E5%90%8D%E7%A7%B0">名称</a></li>
<li><a href="#%E4%BC%A0%E5%80%BC">传值</a></li>
<li><a href="#receiver">Receiver</a></li>
<li><a href="#%E5%90%8C%E6%AD%A5%E5%87%BD%E6%95%B0">同步函数</a></li>
<li><a href="#%E6%9C%89%E6%95%88%E6%B5%8B%E8%AF%95%E4%BF%A1%E6%81%AF">有效测试信息</a></li>
<li><a href="#%E5%87%BD%E6%95%B0">函数</a></li>
</ul>
<h2 id="Gofmt"><a href="#Gofmt" class="headerlink" title="Gofmt"></a>Gofmt</h2><p>  你可以在你的代码中运行 <a target="_blank" rel="noopener" href="https://golang.org/cmd/gofmt/">Gofmt</a> 以解决大多数代码格式问题。几乎所有的代码都使用 <code>gofmt</code>。如果使用<a target="_blank" rel="noopener" href="https://github.com/visualfc/liteide">liteide</a>编写Go代码时，使用ctrl+s即可调用gofmt。<br>  另一种方法是使用 <a target="_blank" rel="noopener" href="https://godoc.org/golang.org/x/tools/cmd/goimports">goimports</a>，它是 <code>gofmt</code>的超集，可根据需要添加（删除）行。</p>
<h2 id="注释语句"><a href="#注释语句" class="headerlink" title="注释语句"></a>注释语句</h2><p>  参考 [<a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go.html#commentary]">https://golang.org/doc/effective_go.html#commentary]</a> </p>
<p>  所有导出的名称、函数声明、结构声明等都应该有注释  </p>
<p>  Go语言提供C风格的<code>/* */</code>块注释和C++风格的<code>//</code>行注释。</p>
<p>  包应该有一个包注释，对于多文件包，注释只需要出现在任意一个文件中。包注释应当提供整个包相关的信息。</p>
<p>  注释的句子应当具有完整性，这使得它们在提取到文档时能保持良好的格式。使用godoc时包注释将与声明一起提取，作为项目的解释性文本。这些注释的风格和内容决定了文档的质量。</p>
<p>  注释应当以描述的事物名称开头，以句点（或者 ! ? ）结束。</p>
<p>代码逻辑注释<br>对于一些关键位置的代码逻辑，或者局部较为复杂的逻辑，需要有相应的逻辑说明，方便其他开发者阅读该段代码，实例如下：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 Redis 中批量读取属性，对于没有读取到的 id ， 记录到一个数组里面，准备从 DB 中读取</span></span><br><span class="line">xxxxx</span><br><span class="line">xxxxxxx</span><br><span class="line">xxxxxxx</span><br></pre></td></tr></tbody></table></figure>

<p>注释风格<br>统一使用中文注释，对于中英文字符之间严格使用空格分隔， 这个不仅仅是中文和英文之间，英文和中文标点之间也都要使用空格分隔，例如：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 Redis 中批量读取属性，对于没有读取到的 id ， 记录到一个数组里面，准备从 DB 中读取</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面 Redis 、 id 、 DB 和其他中文字符之间都是用了空格分隔。</p>
<p>建议全部使用单行注释<br>和代码的规范一样，单行注释不要过长，禁止超过 120 字符。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Request represents a request to run a command.</span></span><br><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> { ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encode writes the JSON encoding of req to w.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Encode</span><span class="params">(w io.Writer, req *Request)</span></span> { ...</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Package regexp implements a simple library for regular expressions.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">The syntax of the regular expressions accepted is:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    regexp:</span></span><br><span class="line"><span class="comment">        concatenation { '|' concatenation }</span></span><br><span class="line"><span class="comment">    concatenation:</span></span><br><span class="line"><span class="comment">        { closure }</span></span><br><span class="line"><span class="comment">    closure:</span></span><br><span class="line"><span class="comment">        term [ '*' | '+' | '?' ]</span></span><br><span class="line"><span class="comment">    term:</span></span><br><span class="line"><span class="comment">        '^'</span></span><br><span class="line"><span class="comment">        '$'</span></span><br><span class="line"><span class="comment">        '.'</span></span><br><span class="line"><span class="comment">        character</span></span><br><span class="line"><span class="comment">        '[' [ '^' ] character-ranges ']'</span></span><br><span class="line"><span class="comment">        '(' regexp ')'</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> regexp</span><br></pre></td></tr></tbody></table></figure>

<h3 id="包的注释"><a href="#包的注释" class="headerlink" title="包的注释"></a>包的注释</h3><p>与godoc呈现的所有注释一样，包的注释必须出现在package子句的旁边，且不带空行：</p>
<p>包注释<br>每个包都应该有一个包注释，一个位于package子句之前的块注释或行注释。包如果有多个go文件，只需要出现在一个go文件中（一般是和包同名的文件）即可。<br> 包注释应该包含下面基本信息(请严格按照这个顺序，简介，创建人，创建时间）</p>
<p>包的基本简介（包名，简介）<br>创建者，格式： 创建人： rtx 名<br>创建时间，格式：创建时间： yyyyMMdd<br>例如 util 包的注释示例如下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// util 包， 该包包含了项目共用的一些常量，封装了项目中一些共用函数。</span></span><br><span class="line"><span class="comment">// 创建人： hanru</span></span><br><span class="line"><span class="comment">// 创建时间： 20190419</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package math provides basic constants and mathematical functions.</span></span><br><span class="line"><span class="keyword">package</span> math</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Package template implements data-driven templates for generating textual</span></span><br><span class="line"><span class="comment">output such as HTML.</span></span><br><span class="line"><span class="comment">....</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> template</span><br></pre></td></tr></tbody></table></figure>

<p>对于main包的注释，很多种注释格式都是可以接受的，比如在目录<code>seedgen</code>中的 <code>package main</code>包，注释可以这下写:</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Binary seedgen ...</span></span><br><span class="line"><span class="keyword">package</span> main</span><br></pre></td></tr></tbody></table></figure>
<p>或</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Command seedgen ...</span></span><br><span class="line"><span class="keyword">package</span> main</span><br></pre></td></tr></tbody></table></figure>
<p>or</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program seedgen ...</span></span><br><span class="line"><span class="keyword">package</span> main</span><br></pre></td></tr></tbody></table></figure>
<p>或</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The seedgen command ...</span></span><br><span class="line"><span class="keyword">package</span> main</span><br></pre></td></tr></tbody></table></figure>
<p>或</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The seedgen program ...</span></span><br><span class="line"><span class="keyword">package</span> main</span><br></pre></td></tr></tbody></table></figure>
<p>或</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Seedgen ..</span></span><br><span class="line"><span class="keyword">package</span> main</span><br></pre></td></tr></tbody></table></figure>
<p>请注意，以小写字母开头的句子不在包注释的可接受选项中，因为包是公开可见的，应当用合适的英语格式写成，包括将第一个词首字母大写。</p>
<p><a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go.html#commentary">获取更多有关包注释的规范</a></p>
<h2 id="Contexts"><a href="#Contexts" class="headerlink" title="Contexts"></a>Contexts</h2><p>Go提供了<code>context</code>包来管理gorountine的生命周期。</p>
<p><code>context.Context</code>类型的值包括了跨API和进程边界的安全凭证，跟踪信息，结束时间和取消信号。</p>
<p>使用context包时请遵循以下规则：</p>
<ul>
<li><p>不要将 Contexts 放入结构体，context应该作为第一个参数传入。 不过也有例外，函数签名(method signature)必须与标准库或者第三方库中的接口相匹配</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">(ctx context.Context, /* other arguments */)</span></span> {}</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>即使函数允许，也不要传入nil的 Context。如果不知道用哪种 Context，可以使用context.TODO()</p>
</li>
<li><p>使用context的Value相关方法只应该用于在程序和接口中传递的和请求相关的元数据，不要用它来传递一些可选的参数</p>
</li>
<li><p>相同的 Context 可以传递给共享结束时间、取消信号、安全凭证和父进程追踪等信息的多个goroutine，Context 是并发安全的</p>
</li>
<li><p>从不做特定请求的函数可以使用 context.Background()，但即使您认为不需要，也可以在传递Context时使用错误(error)。如果您有充分的理由认为替代方案是错误的，那么只能直接使用context.Background()</p>
</li>
<li><p>不要在函数签名中创建Context类型或者使用Context以外的接口。</p>
</li>
</ul>
<p>官方使用context的例子：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"context"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    d := time.Now().Add(<span class="number">50</span> * time.Millisecond)</span><br><span class="line">    ctx, cancel := context.WithDeadline(context.Background(), d)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Even though ctx will be expired, it is good practice to call its</span></span><br><span class="line">    <span class="comment">// cancelation function in any case. Failure to do so may keep the</span></span><br><span class="line">    <span class="comment">// context and its parent alive longer than necessary.</span></span><br><span class="line">    <span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">        fmt.Println(<span class="string">"overslept"</span>)</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">        fmt.Println(ctx.Err())</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Goroutine-生命周期"><a href="#Goroutine-生命周期" class="headerlink" title="Goroutine 生命周期"></a>Goroutine 生命周期</h2><p>当你需要使用goruntines时，请确保它们什么时候/什么条件下退出。</p>
<p>Goroutines可能会因阻塞channel的send或者receives而泄露,即使被阻塞的通道无法访问，垃圾收集器也不会终止goroutine。</p>
<p>即使gorountine没有泄露，当不再需要它们时仍在继续运行会导致难以诊断的问题。即使在不需要结果后，修改正在使用的数据也会导致数据竞争。</p>
<p>尽量保证并发代码足够简单，使gorountine的生命周期更明显。如果难以做到，请记录gorountines退出的时间和原因。</p>
<h2 id="拷贝"><a href="#拷贝" class="headerlink" title="拷贝"></a>拷贝</h2><p>为了避免意外的别名(alias)，从另一个包复制结构时要小心。比如， <code>bytes.Buffer</code> 类型包含了 <code>[]byte</code> 切片类型，并且作为小字符串的优化，可被较小的字节数组引用。如果你拷贝了一个<code>Buffer</code>，拷贝中的切片可能会alias原始数组中的切片，从而导致后续的操作带来不可预测的结果。</p>
<p>通常来说，如果一个类型 <code>T</code>其方法与指针结构相关，那么请不要拷贝 <code>T</code>的值。</p>
<h2 id="使用crypto-rand生成随机值"><a href="#使用crypto-rand生成随机值" class="headerlink" title="使用crypto rand生成随机值"></a>使用crypto rand生成随机值</h2><p>请不要使用包 <code>math/rand</code> 来生成密钥，即使是一次性的。如果不提供种子，则密钥完全可以被预测到。就算用<code>time.Nanoseconds()</code>作为种子，也仅仅只有几个位上的差别。</p>
<p>使用<code>crypto/rand</code>‘s Reader作为代替。并且如果你需要生成文本，打印成16进制或者base64类型即可。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"crypto/rand"</span></span><br><span class="line">    <span class="comment">// "encoding/base64"</span></span><br><span class="line">    <span class="comment">// "encoding/hex"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Key</span><span class="params">()</span> <span class="title">string</span></span> {</span><br><span class="line">    buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">16</span>)</span><br><span class="line">    _, err := rand.Read(buf)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)  <span class="comment">// out of randomness, should never happen</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%x"</span>, buf)</span><br><span class="line">    <span class="comment">// or hex.EncodeToString(buf)</span></span><br><span class="line">    <span class="comment">// or base64.StdEncoding.EncodeToString(buf)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="空切片"><a href="#空切片" class="headerlink" title="空切片"></a>空切片</h2><p>当声明一个空切片时， 使用</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t []<span class="keyword">string</span></span><br></pre></td></tr></tbody></table></figure>

<p>而不是</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t := []<span class="keyword">string</span>{}</span><br></pre></td></tr></tbody></table></figure>

<p>前者声明了一个指向nil的切片，后者声明了一个 non-nil 且 len = 0的切片。虽然他们的功能是等价的：它们的 <code>len</code> 和<code>cap</code> 都是0，但nil切片应当作为首选方案。</p>
<p>请注意在有些情况下， non-nil 切片表现更好，比如当解码JSON对象时，nil切片解码为 <code>null</code>, non-nil 切片解码为 JSON 数组</p>
<p>在设计接口时，应当避免因nil切片和non-nil切片带来的不同表现，因为这可能会导致细微的编码错误。</p>
<p>有关nil的更多讨论，参考 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=ynoY2xz-F8s">Understanding Nil</a>.</p>
<h2 id="Panic"><a href="#Panic" class="headerlink" title="Panic"></a>Panic</h2><p>不要使用<code>panic</code>作为日常错误处理机制（除非你知道你在干什么），请使用<code>error</code>。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go.html#panic">https://golang.org/doc/effective_go.html#panic</a>. </p>
<h2 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h2><h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p>错误信息的字符串不应该大写（除非以专有名词或首字母缩略词开头）或以标点符号结尾，因为它们通常是在其他上下文后打印的。</p>
<p>使用  <code>fmt.Errorf("something bad")</code> 而不是 <code>fmt.Errorf("Something bad")</code> 。</p>
<h3 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h3><p>请不要使用<code>_</code>丢弃错误。如果一个函数返回一个错误，请检查错误，处理错误，必要情况下请panic。</p>
<p>标准库函数通常会向调用者返回某种错误指示，比如os.Open不仅在失败时返回一个nil指针，它还返回一个描述错误的错误值。如果不确保调用函数的成功返回，后续代码的行为将变得不可预测。</p>
<p>错误处理的原则就是不能丢弃任何有返回err的调用，<br>接收到错误，要么返回err，或者使用log记录下来<br>尽早return：一旦有错误发生，马上返回<br>尽量不要使用panic，除非你知道你在做什么<br>错误描述如果是英文必须为小写，不需要标点结尾<br>采用独立的错误流进行处理</p>
<p>参考 <a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go.html#errors">https://golang.org/doc/effective_go.html#errors</a>.</p>
<h3 id="附带返回"><a href="#附带返回" class="headerlink" title="附带返回"></a>附带返回</h3><p>在C语言和类似语言中，函数常常返回 -1 或 null 值表示错误或者结果缺失。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lookup returns the value for key or "" if there is no mapping for key.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Lookup</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">string</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Failing to check a for an in-band error value can lead to bugs:</span></span><br><span class="line">Parse(Lookup(key))  <span class="comment">// returns "parse failure for value" instead of "no value for key"</span></span><br></pre></td></tr></tbody></table></figure>

<p>Go语言对多个返回值的支持提供了更好的解决方案。<br>相比要求客户端特判返回值情况，函数应该在最后返回一个附加值以指示其他返回值是否有效。此返回值可能是一个error，或者在不需要解释时可以是bool。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lookup returns the value for key or ok=false if there is no mapping for key.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Lookup</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="params">(value <span class="keyword">string</span>, ok <span class="keyword">bool</span>)</span></span></span><br></pre></td></tr></tbody></table></figure>
<p>这还可以防止调用者错误地使用结果:</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Parse(Lookup(key))  <span class="comment">// compile-time error</span></span><br></pre></td></tr></tbody></table></figure>

<p>鼓励编写更强大和可读性更强的代码:</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">value, ok := Lookup(key)</span><br><span class="line"><span class="keyword">if</span> !ok  {</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(<span class="string">"no value for %q"</span>, key)</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> Parse(value)</span><br></pre></td></tr></tbody></table></figure>

<p>此规则适用于导出的函数，但对未导出的函数也很有用。<br>如 nil， “”， 0 和 -1 都可以作为函数的无效返回值。<br>一些标准库函数，比如包 “strings” 中的函数，返回值都会附带一个err.这极大地简化了花在字符串上的操作，代价是需要程序员花更多的功夫来处理err。</p>
<p>总而言之，通常情况下，Go代码应额外返回一个error值.</p>
<h3 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h3><p>尽量减少代码缩进，在获取错误后立即处理错误信息。这通常可以提高代码的可阅读性。</p>
<p>例如，不要写成：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="comment">// error handling</span></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// normal code</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>而应该写成：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="comment">// error handling</span></span><br><span class="line">    <span class="keyword">return</span> <span class="comment">// or continue, etc.</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// normal code</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果<code>if</code>语句有初始化语句，比如：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> x, err := f(); err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="comment">// error handling</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// use x</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>那么这可能需要将变量的声明另提一行：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x, err := f()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="comment">// error handling</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// use x</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h2><p>添加新的包时，请包含预期用法的示例。可以是一个可运行的例子或者演示完整调用的简单测试<br>参考 <a target="_blank" rel="noopener" href="https://blog.golang.org/examples">可测试示例函数</a></p>
<h2 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h2><h3 id="重命名、goimports"><a href="#重命名、goimports" class="headerlink" title="重命名、goimports"></a>重命名、goimports</h3><p>尽量避免导入包时的重命名，以避免名称冲突。如果发生名称冲突，尽量重命名本地或项目特定的包。</p>
<p>import在多行的情况下，goimports会自动帮你格式化，但是我们这里还是规范一下import的一些规范，如果你在一个文件里面引入了一个package，还是建议采用如下格式：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>如果你的包引入了三种类型的包，标准库包，程序内部包，第三方包，</p>
<p>导入包按名称分组，用空行隔开。</p>
<p>标准库包应始终位于第一组。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/json"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">​</span><br><span class="line">    <span class="string">"github.com/astaxie/beego"</span></span><br><span class="line">    <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"myproject/models"</span></span><br><span class="line">    <span class="string">"myproject/controller"</span></span><br><span class="line">    <span class="string">"myproject/utils"</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>有顺序的引入包，不同的类型采用空格分离，第一种实标准库，第二是项目包，第三是第三方包。</p>
<p>在项目中不要使用相对路径引入包：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是不好的导入</span></span><br><span class="line"><span class="keyword">import</span> “../net”</span><br><span class="line">​</span><br><span class="line"><span class="comment">// 这是正确的做法</span></span><br><span class="line"><span class="keyword">import</span> “github.com/repo/proj/src/net”</span><br></pre></td></tr></tbody></table></figure>

<p>但是如果是引入本项目中的其他包，最好使用相对路径。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"hash/adler32"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"appengine/foo"</span></span><br><span class="line">    <span class="string">"appengine/user"</span></span><br><span class="line"></span><br><span class="line">        <span class="string">"github.com/foo/bar"</span></span><br><span class="line">    <span class="string">"rsc.io/goversion/version"</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<p>可以使用 <a target="_blank" rel="noopener" href="https://godoc.org/golang.org/x/tools/cmd/goimports">goimports</a> 来规范包的排序。</p>
<h3 id="Import-Dot"><a href="#Import-Dot" class="headerlink" title="Import Dot"></a>Import Dot</h3><p>使用 <code>import .</code> 来导入包在测试中很有用，但由于循环依赖性，它不能成为被测试包的一部分：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> foo_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bar/testutil"</span> <span class="comment">// also imports "foo"</span></span><br><span class="line">    . <span class="string">"foo"</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<p>在这种情况下，测试文件不能在包<code>foo</code>中，因为它使用了同样导入<code>foo</code>的包 <code>bar/testutil</code>，所以我们使用<code>import .</code>格式导入来让测试文件伪装成包foo的一部分，即使它并不是。除了这一情况，不要在你的程序中使用<code>import .</code>来导入包。它将使程序更难阅读，因为不清楚 Quux 这样的名称是在当前包中还是导入包中。</p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>Go语言接口类型通常属于包中的interface类型，而不是实现这些值的包。实现了接口的包应该返回具体的(通常是指针或者结构)类型：这样，新方法可以不需要大量重构就可以添加到实现中。</p>
<p>不要“为了模仿”而在API的实现端定义接口。<br>相反，设计的API应当能够使用公共的API来进行测试。</p>
<p>并且在使用之前不要定义接口：没有真实的例子之前，很难看出接口是否必需，更不要说它应该包含哪些方法。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> consumer  <span class="comment">// consumer.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Thinger <span class="keyword">interface</span> { Thing() <span class="keyword">bool</span> }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Foo</span><span class="params">(t Thinger)</span> <span class="title">string</span></span> { … }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> consumer <span class="comment">// consumer_test.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> fakeThinger <span class="keyword">struct</span>{ … }</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t fakeThinger)</span> <span class="title">Thing</span><span class="params">()</span> <span class="title">bool</span></span> { … }</span><br><span class="line">…</span><br><span class="line"><span class="keyword">if</span> Foo(fakeThinger{…}) == <span class="string">"x"</span> { … }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DO NOT DO IT!!!</span></span><br><span class="line"><span class="keyword">package</span> producer</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Thinger <span class="keyword">interface</span> { Thing() <span class="keyword">bool</span> }</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> defaultThinger <span class="keyword">struct</span>{ … }</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t defaultThinger)</span> <span class="title">Thing</span><span class="params">()</span> <span class="title">bool</span></span> { … }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewThinger</span><span class="params">()</span> <span class="title">Thinger</span></span> { <span class="keyword">return</span> defaultThinger{ … } }</span><br></pre></td></tr></tbody></table></figure>

<p>取而代之的，可以直接使用原先的API接口，返回一个具体类型，让消费者模拟生产者的实现。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> producer</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Thinger <span class="keyword">struct</span>{ … }</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Thinger)</span> <span class="title">Thing</span><span class="params">()</span> <span class="title">bool</span></span> { … }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewThinger</span><span class="params">()</span> <span class="title">Thinger</span></span> { <span class="keyword">return</span> Thinger{ … } }</span><br></pre></td></tr></tbody></table></figure>


<h2 id="单行代码长度"><a href="#单行代码长度" class="headerlink" title="单行代码长度"></a>单行代码长度</h2><p>Go代码中没有严格限制行的长度，但请避免使用不舒服的长行。同样，当一行长代码可读性还行时，不要添加换行符来增加行数。</p>
<p>较长的行似乎与较长的名称有关，所以请尽量避免长的名称。<br>实际上，这与关于函数应该有多长的建议完全相同。没有规则“函数不应该超过N行”，但肯定会有这么长的一个函数，并且这个函数也可以分解为多个小函数来实现相同的功能。</p>
<h2 id="名称"><a href="#名称" class="headerlink" title="名称"></a>名称</h2><p>如果要在其他包使用该名称，请大写首字母。</p>
<p>名称如果是首字母或首字母缩略词（例如 “URL” 或 “NATO”)，应当具有一致的大小写. 例如，”URL” 应写为 “URL” 或”url”，而不是 “Url”。</p>
<p>举个例子： ServerHTTP与ServerHttp，应当使用前者。<br>对于具有多个缩略单词的标识符，使用例如 “xmlHTTPRequest” 或 “XMLHTTPRequest”。<br>当”ID”是标识符的缩写时，此规则也同样适用，因此请写成 “appID” 而不是 “appId”。</p>
<h3 id="变量名"><a href="#变量名" class="headerlink" title="变量名"></a>变量名</h3><p>Go中变量名应尽量短。对于局部变量尤其如此，首选<code>c</code>作为<code>lineCount</code>,<code>i</code>作为<code>sliceIndex</code>。</p>
<p>基本规则：名称使用的地方距其声明的地方越远，则名称必须越具描述性。对一个方法receiver，一个或两个字母就足够了。循环索引或读取之类的常见变量可以使单个字母(<code>i r</code>)，更多不常见的事物和全局变量需要更具描述性的名称。</p>
<h3 id="包名"><a href="#包名" class="headerlink" title="包名"></a>包名</h3><p>包名应当简洁、清晰、意义深刻。按照惯例，包名应该由小写字母组成，不要使用下划线或混合大小写。</p>
<p>包中名称的所有引用都将会使用到包名，所以你可以省略包中名称的标识符。<br>例如，<code>chubby.ChubbyFile</code>，可以精简为<code>chubby.File</code>。</p>
<p>请注意避免使用无意义的包名称，如 util,common,misc,api,types和interfaces。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://golang.org/doc/effective_go.html#package-names">http://golang.org/doc/effective_go.html#package-names</a> </p>
<p><a target="_blank" rel="noopener" href="http://blog.golang.org/package-names">http://blog.golang.org/package-names</a> </p>
<h3 id="组合名"><a href="#组合名" class="headerlink" title="组合名"></a>组合名</h3><p>Go语言决定使用MixedCaps或mixedCaps来命名由多个单词组合的名称，而不是使用下划线来连接多个单词。即使它打破了其他语言的惯例。</p>
<p>例如，未导出的常量名为<code>maxLength</code> 而不是<code>MaxLength</code> 或 <code>MAX_LENGTH</code>。</p>
<h3 id="结果参数命名"><a href="#结果参数命名" class="headerlink" title="结果参数命名"></a>结果参数命名</h3><p>考虑下结果参数命名为下面这种情况时，godoc下的文档会是什么样子</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent1</span><span class="params">()</span> <span class="params">(node *Node)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent2</span><span class="params">()</span> <span class="params">(node *Node, err error)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>文档会念起来更拗口，推荐下面这种：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent1</span><span class="params">()</span> *<span class="title">Node</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent2</span><span class="params">()</span> <span class="params">(*Node, error)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>另一方面，如果函数返回值意义不明，给返回参数添加名称可能会很有用。</p>
<p>总之，尽量提高API可读性，比如：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *Foo)</span> <span class="title">Location</span><span class="params">()</span> <span class="params">(<span class="keyword">float64</span>, <span class="keyword">float64</span>, error)</span></span></span><br></pre></td></tr></tbody></table></figure>
<p>更优的写法：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Location returns f's latitude and longitude.</span></span><br><span class="line"><span class="comment">// Negative values mean south and west, respectively.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *Foo)</span> <span class="title">Location</span><span class="params">()</span> <span class="params">(lat, long <span class="keyword">float64</span>, err error)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>结论： 文档的清晰度比节约一两行代码更加重要。</p>
<p>最后，在某些情况下，如果您需要命名结果参数才能在defer中关闭变量的话，也是可以的。</p>
<h2 id="传值"><a href="#传值" class="headerlink" title="传值"></a>传值</h2><p>不要仅仅为了节省几个字节而传指针给函数。如果函数仅仅将其参数”x”作为<code>*x</code>使用，那么参数就不应该是指针。</p>
<p>常见的传指针的情况有：传递一个string的指针、指向接口值(<code>*io.Reader</code>)的指针;这两种情况下，值本身都是固定的，可以直接传递。</p>
<p>对于大型数据结构，或者是小型的可能增长的结构，请考虑传指针。</p>
<p>更多情况请见 <a href="#receiver-type">Receiver Type</a></p>
<h2 id="Receiver"><a href="#Receiver" class="headerlink" title="Receiver"></a>Receiver</h2><h3 id="名称-1"><a href="#名称-1" class="headerlink" title="名称"></a>名称</h3><p>方法receiver的名称应该反映其身份；通常，其类型的一个或两个字母缩写就足够了(例如”client”的”c”或”cl”)。请不要使用通用名称如”me”, “this” 或 “self”。请始终保持名称不变，如果你在一个地方命名receiver为 “c”，那么请不要在另一处叫其”cl”</p>
<h3 id="指针还是值"><a href="#指针还是值" class="headerlink" title="指针还是值"></a>指针还是值</h3><p>如果您不知道怎么决定，请使用指针。但有时候receiver为值也挺有用，这种通常是出于效率的原因，且值为小的不变结构或基本类型的值。</p>
<p>一些建议：</p>
<ul>
<li>请不要使用指针，如果满足receiver为map，func或者chan，或receiver为切片并且该方法不会重新分配切片</li>
<li>请不要使用指针，如果receiver是较小数组或结构体，没有可变的字段和指针，或者是一个简单的基本类型，int或者string</li>
<li>请使用指针，如果方法需要改变receiver</li>
<li>请使用指针，以避免被拷贝，如果receiver包含了sync.Mutex 或类似同步字段的结构</li>
<li>请使用指针，以提升效率，如果receiver是较大的数组或结构体</li>
<li>请使用指针，如果需要在方法中改变receiver的值</li>
<li>请使用指针，如果receiver是结构体，数组或切片这种成员是一个指向可变内容的指针</li>
<li>请使用指针，如果不清楚该如何选择</li>
</ul>
<h2 id="同步函数"><a href="#同步函数" class="headerlink" title="同步函数"></a>同步函数</h2><p>相比异步函数，应当首选同步函数 —— 直接返回结果或在返回之前完成任何回调或通道操作的函数。</p>
<p>同步函数使得gorountine在调用中本地化，更容易推断其生命周期并避免泄露和数据竞争。它们也更容易测试:调用者可以传递输入并检查输出，而无需轮询或同步。</p>
<p>如果调用者需要更多的并发，他们可以简单地在单独的gorountine中调用函数来实现。但在调用者端删除不必要的并发是非常困难甚至是不可能的。</p>
<h2 id="有效测试信息"><a href="#有效测试信息" class="headerlink" title="有效测试信息"></a>有效测试信息</h2><p>测试失败时应当返回有效的错误信息，说明错误在哪，输入是什么，输出时什么，期望输出是什么。<br>一个典型的测试条件形如：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> got != tt.want {</span><br><span class="line">    t.Errorf(<span class="string">"Foo(%q) = %d; want %d"</span>, tt.in, got, tt.want) <span class="comment">// or Fatalf, if test can't test anything more past this point</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>请注意此处的命令是 <code>实际结果 != 预期结果</code>.一些测试框架鼓励程序员编写： 0 != x, “expected 0, got x”，go并不推荐。</p>
<p>在任何情况下，您有责任提供有用的错误信息，以便将来调试您的代码。</p>
<p>单元测试文件名命名规范为 example_test.go 测试用例的函数名称必须以 Test 开头，例如：TestExample 每个重要的函数都要首先编写测试用例，测试用例和正规代码一起提交方便进行回归测试</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul>
<li>函数采用命名的多值返回，但请考虑 <a href="#%E7%BB%93%E6%9E%9C%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D">结果参数命名</a></li>
<li>传入变量和返回变量以小写字母开头</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nextInt</span><span class="params">(b []<span class="keyword">byte</span>, pos <span class="keyword">int</span>)</span> <span class="params">(value, nextPos <span class="keyword">int</span>)</span></span> {</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>如果需要，请返回错误信息</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
