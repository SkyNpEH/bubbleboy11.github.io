<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/33/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/33/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/33/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">359</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/namespace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/namespace/" class="post-title-link" itemprop="url">命名空间 Namespace</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-16 08:05:09" itemprop="dateModified" datetime="2021-06-16T08:05:09Z">2021-06-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>A namespace is a mapping from names to objects.<br>Most namespaces are currently implemented as Python dictionaries.<br>是从名称到对象的映射，<br>大部分的命名空间都是通过 Python 字典来实现的。</p>
<p>命名空间提供了在项目中避免名字冲突的一种方法。<br>各个命名空间是独立的，没有任何关系的，<br>所以一个命名空间中不能有重名，<br>但不同的命名空间是可以重名而没有任何影响。</p>
<p>变量是拥有匹配对象的名字（标识符）。<br>命名空间是一个包含了变量名称们（键）和它们各自相应的对象们（值）的字典。<br>一个 Python 表达式可以访问局部命名空间和全局命名空间里的变量。<br>如果一个局部变量和一个全局变量重名，则局部变量会覆盖全局变量。<br>每个函数都有自己的命名空间。<br>类的方法的作用域规则和通常函数的一样。<br>Python 会智能地猜测一个变量是局部的还是全局的，它假设任何在函数内赋值的变量都是局部的。</p>
<p>举一个计算机系统中的例子，一个文件夹(目录)中可以包含多个文件夹，<br>每个文件夹中不能有相同的文件名，<br>但不同文件夹中的文件可以重名。</p>
<p>三种命名空间</p>
<ul>
<li>内置名称（built-in names）， Python 语言内置的名称，比如函数名 <code>abs</code>、<code>char</code> 和异常名称 <code>BaseException</code>、<code>Exception</code> 等等。</li>
<li>全局名称（global names），模块中定义的名称，记录了模块的变量，包括函数、类、其它导入的模块、模块级的变量和常量。</li>
<li>局部名称（local names），函数中定义的名称，记录了函数的变量，包括函数的参数和局部定义的变量。（类中定义的也是）</li>
</ul>
<p>命名空间查找顺序:</p>
<p>假设我们要使用变量 runoob，则 Python 的查找顺序为：局部的命名空间去 -&gt; 全局命名空间 -&gt; 内置命名空间。</p>
<p>如果找不到变量 runoob，它将放弃查找并引发一个 NameError 异常:<br><code>NameError: name 'runoob' is not defined</code></p>
<p>命名空间的生命周期：<br>取决于对象的作用域，如果对象执行完成，则该命名空间的生命周期就结束。<br>因此，我们无法从外部命名空间访问内部命名空间的对象。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var1 = <span class="number">5</span>  <span class="comment"># var1 是全局名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_func</span>():</span></span><br><span class="line">    var2 = <span class="number">6</span>  <span class="comment"># var2 是局部名称</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">some_inner_func</span>():</span></span><br><span class="line">        var3 = <span class="number">7</span>  <span class="comment"># var3 是</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>A scope is a textual region of a Python program<br>where a namespace is directly accessible.<br>“Directly accessible” here means that<br>an unqualified reference to a name attempts to find the name in the namespace.<br>作用域就是一个 Python 程序可以直接访问命名空间的正文区域。<br>在一个 python 程序中，直接访问一个变量，会从内到外依次访问所有的作用域直到找到，<br>否则会报未定义的错误。</p>
<p>程序的变量并不是在哪个位置都可以访问的，<br>访问权限决定于这个变量是在哪里赋值的。<br>变量的作用域决定了在哪一部分程序可以访问哪个特定的变量名称。<br>Python的作用域一共有4种，分别是：</p>
<ul>
<li><p>L（Local）：最内层，包含局部变量，比如一个函数方法内部在新建一个变量时，默认作用域为当前局部作用域，函数外引用不了，只能在其被声明的函数内部访问，<br>调用函数时，所有在函数内声明的变量名称都将被加入到作用域中</p>
</li>
<li><p>E（Enclosing）：包含了非局部(non-local)也非全局(non-global)的变量。<br>比如两个嵌套函数，一个函数（或类） A 里面又包含了一个函数 B ，<br>那么对于 B 中的名称来说 A 中的作用域就为 nonlocal，<br>将变量声明为外层变量（外层函数的局部变量，而且不能是全局变量）<br>标识该变量是上一级函数中的局部变量，只能用于嵌套函数中</p>
</li>
<li><p>G（Global）：当前脚本的最外层，比如当前模块的全局变量，就不会在局部命名空间里寻找这个变量了，可以被多个函数引用 拥有全局作用域。可以在整个程序范围内访问。</p>
</li>
<li><p>B（Built-in）： 包含了内建的变量/关键字等，最后被搜索</p>
</li>
</ul>
<p>规则顺序： L –&gt; E –&gt; G –&gt;gt; B。<br>在局部找不到，便会去局部外的局部找（例如闭包），再找不到就会去全局找，再者去内置中找。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g_count = <span class="number">0</span>  <span class="comment"># 全局作用域</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    o_count = <span class="number">1</span>  <span class="comment"># 闭包函数外的函数中</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        i_count = <span class="number">2</span>  <span class="comment"># 局部作用域</span></span><br></pre></td></tr></tbody></table></figure>

<p>内置作用域是通过一个名为 builtin 的标准模块来实现的，<br>但是这个变量名自身并没有放入内置作用域内，所以必须导入这个文件才能够使用它。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> builtins</span><br><span class="line">dir(builtins)</span><br><span class="line">[<span class="string">'ArithmeticError'</span>, <span class="string">'AssertionError'</span>, <span class="string">'AttributeError'</span>, <span class="string">'BaseException'</span>, <span class="string">'BlockingIOError'</span>, <span class="string">'BrokenPipeError'</span>, <span class="string">'BufferError'</span>, <span class="string">'BytesWarning'</span>, <span class="string">'ChildProcessError'</span>, <span class="string">'ConnectionAbortedError'</span>, <span class="string">'ConnectionError'</span>, <span class="string">'ConnectionRefusedError'</span>, <span class="string">'ConnectionResetError'</span>, </span><br><span class="line"><span class="string">'DeprecationWarning'</span>, <span class="string">'EOFError'</span>, <span class="string">'Ellipsis'</span>, <span class="string">'EnvironmentError'</span>, <span class="string">'Exception'</span>, <span class="string">'False'</span>, <span class="string">'FileExistsError'</span>, <span class="string">'FileNotFoundError'</span>, <span class="string">'FloatingPointError'</span>, <span class="string">'FutureWarning'</span>, <span class="string">'GeneratorExit'</span>, <span class="string">'IOError'</span>, <span class="string">'ImportError'</span>, <span class="string">'ImportWarning'</span>, <span class="string">'IndentationError'</span>, <span class="string">'IndexError'</span>, <span class="string">'InterruptedError'</span>, <span class="string">'IsADirectoryError'</span>, <span class="string">'KeyError'</span>, <span class="string">'KeyboardInterrupt'</span>, <span class="string">'LookupError'</span>, <span class="string">'MemoryError'</span>, <span class="string">'ModuleNotFoundError'</span>, <span class="string">'NameError'</span>, <span class="string">'None'</span>, <span class="string">'NotADirectoryError'</span>, <span class="string">'NotImplemented'</span>, <span class="string">'NotImplementedError'</span>, <span class="string">'OSError'</span>, <span class="string">'OverflowError'</span>, <span class="string">'PendingDeprecationWarning'</span>, <span class="string">'PermissionError'</span>, <span class="string">'ProcessLookupError'</span>, <span class="string">'RecursionError'</span>, <span class="string">'ReferenceError'</span>, <span class="string">'ResourceWarning'</span>, <span class="string">'RuntimeError'</span>, <span class="string">'RuntimeWarning'</span>, <span class="string">'StopAsyncIteration'</span>, <span class="string">'StopIteration'</span>, <span class="string">'SyntaxError'</span>, <span class="string">'SyntaxWarning'</span>, <span class="string">'SystemError'</span>, <span class="string">'SystemExit'</span>, <span class="string">'TabError'</span>, <span class="string">'TimeoutError'</span>, <span class="string">'True'</span>, <span class="string">'TypeError'</span>, <span class="string">'UnboundLocalError'</span>, <span class="string">'UnicodeDecodeError'</span>, <span class="string">'UnicodeEncodeError'</span>, <span class="string">'UnicodeError'</span>, <span class="string">'UnicodeTranslateError'</span>, <span class="string">'UnicodeWarning'</span>, <span class="string">'UserWarning'</span>, <span class="string">'ValueError'</span>, <span class="string">'Warning'</span>, <span class="string">'WindowsError'</span>, <span class="string">'ZeroDivisionError'</span>, <span class="string">'__build_class__'</span>, <span class="string">'__debug__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__import__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'abs'</span>, <span class="string">'all'</span>, <span class="string">'any'</span>, <span class="string">'ascii'</span>, <span class="string">'bin'</span>, <span class="string">'bool'</span>, <span class="string">'breakpoint'</span>, <span class="string">'bytearray'</span>, <span class="string">'bytes'</span>, <span class="string">'callable'</span>, <span class="string">'chr'</span>, <span class="string">'classmethod'</span>, <span class="string">'compile'</span>, <span class="string">'complex'</span>, <span class="string">'copyright'</span>, <span class="string">'credits'</span>, <span class="string">'delattr'</span>, <span class="string">'dict'</span>, <span class="string">'dir'</span>, <span class="string">'divmod'</span>, <span class="string">'enumerate'</span>, <span class="string">'eval'</span>, <span class="string">'exec'</span>, <span class="string">'exit'</span>, <span class="string">'filter'</span>, <span class="string">'float'</span>, <span class="string">'format'</span>, <span class="string">'frozenset'</span>, <span class="string">'getattr'</span>, <span class="string">'globals'</span>, <span class="string">'hasattr'</span>, <span class="string">'hash'</span>, <span class="string">'help'</span>, <span class="string">'hex'</span>, <span class="string">'id'</span>, <span class="string">'input'</span>, <span class="string">'int'</span>, <span class="string">'isinstance'</span>, <span class="string">'issubclass'</span>, <span class="string">'iter'</span>, <span class="string">'len'</span>, <span class="string">'license'</span>, <span class="string">'list'</span>, <span class="string">'locals'</span>, <span class="string">'map'</span>, <span class="string">'max'</span>, <span class="string">'memoryview'</span>, <span class="string">'min'</span>, <span class="string">'next'</span>, <span class="string">'object'</span>, <span class="string">'oct'</span>, <span class="string">'open'</span>, <span class="string">'ord'</span>, <span class="string">'pow'</span>, <span class="string">'print'</span>, <span class="string">'property'</span>, <span class="string">'quit'</span>, <span class="string">'range'</span>, <span class="string">'repr'</span>, <span class="string">'reversed'</span>, <span class="string">'round'</span>, <span class="string">'set'</span>, <span class="string">'setattr'</span>, <span class="string">'slice'</span>, <span class="string">'sorted'</span>, <span class="string">'staticmethod'</span>, <span class="string">'str'</span>, <span class="string">'sum'</span>, <span class="string">'super'</span>, <span class="string">'tuple'</span>, <span class="string">'type'</span>, <span class="string">'vars'</span>, <span class="string">'zip'</span>] </span><br></pre></td></tr></tbody></table></figure>

<p>Python 中只有模块（module），类（class）以及函数（def、lambda）才会引入新的作用域，<br>其它的代码块（如 if/elif/else/、try/except、for/while等）是不会引入新的作用域的，<br>也就是说这些语句内定义的变量，外部也可以访问，如下代码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span> msg = <span class="string">'I am from Runoob'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg</span><br><span class="line"><span class="string">'I am from Runoob'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></tbody></table></figure>
<p>实例中 msg 变量定义在 if 语句块中，但外部还是可以访问的。</p>
<p>如果将 msg 定义在函数中，则它就是局部变量，外部不能访问：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line"><span class="meta">... </span>    msg_inner = <span class="string">'I am from Runoob'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>msg_inner</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">NameError: name <span class="string">'msg_inner'</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></tbody></table></figure>

<p>从报错的信息上看，说明了 msg_inner 未定义，无法使用，<br>因为它是局部变量，只有在函数内可以使用。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfunc</span>():</span></span><br><span class="line">    sex = <span class="string">"Female"</span></span><br><span class="line">    <span class="comment"># if sex == "Male":</span></span><br><span class="line">    <span class="keyword">if</span> sex == <span class="string">"Female"</span>:</span><br><span class="line">        out_str = <span class="string">"性别: 男"</span></span><br><span class="line">    print(out_str)</span><br><span class="line"></span><br><span class="line">myfunc()  <span class="comment"># 性别: 男</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfunc</span>():</span></span><br><span class="line">    sex = <span class="string">"Female"</span></span><br><span class="line">    <span class="keyword">if</span> sex == <span class="string">"Male"</span>:</span><br><span class="line">        out_str = <span class="string">"性别: 男"</span></span><br><span class="line">    print(out_str)</span><br><span class="line"></span><br><span class="line">myfunc()</span><br><span class="line"><span class="comment"># UnboundLocalError: local variable 'out_str' referenced before assignment</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>


<p>在局部如果不声明全局变量，访问且不修改全局变量。则可以正常使用全局变量</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 这是一个全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg1, arg2</span>):</span>  <span class="comment"># total不是形参</span></span><br><span class="line">    print(total)  <span class="comment"># 在函数内不对全局变量修改，直接访问</span></span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用sum函数</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)  <span class="comment"># 0</span></span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)  <span class="comment"># 函数外是全局变量 :  0</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 这是一个全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg1, arg2</span>):</span>  <span class="comment"># total不是形参</span></span><br><span class="line">    <span class="comment"># 返回2个参数的和.</span></span><br><span class="line">    print(total)</span><br><span class="line">    total = arg1 + arg2</span><br><span class="line">    <span class="comment"># print("函数内是局部变量 : ", total)</span></span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用sum函数</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)</span><br><span class="line"><span class="comment"># UnboundLocalError: local variable 'total' referenced before assignment</span></span><br></pre></td></tr></tbody></table></figure>

<p>若没有上面<code>global total</code>，<br>局部变量 <code>total</code> 在定义之前就引用了。<br>结合第1个例子，只是增加了一行 <code>total = arg1 + arg2</code>，<br>但是却是 <code>print(total)</code> 报错。这说明在 <code>print(total)</code> 之前，<br>python 已经知道了 <code>total</code> 是一个局部变量，只能从局部作用域中查找。<br>从哪里知道的？ 从 <code>total = arg1 + arg2</code> 这一行知道的。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 这是一个全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg1, arg2</span>):</span></span><br><span class="line">    <span class="comment"># 返回2个参数的和.</span></span><br><span class="line">    <span class="comment"># print(total) # 在函数内不对全局变量修改，直接访问</span></span><br><span class="line">    total = arg1 + arg2  <span class="comment"># total在这里是局部变量</span></span><br><span class="line">    print(<span class="string">"函数内是局部变量 : "</span>, total)</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用sum函数</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)  <span class="comment"># 函数内是局部变量 :  30</span></span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)  <span class="comment"># 函数外是全局变量 :  0</span></span><br></pre></td></tr></tbody></table></figure>


<p>另外有一种特殊情况，假设下面这段代码被运行：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 这是一个全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg1, arg2</span>):</span>  <span class="comment"># 没有定义 total 为自变量</span></span><br><span class="line">    <span class="comment"># 返回2个参数的和.</span></span><br><span class="line">    <span class="comment"># print(total)</span></span><br><span class="line">    total = total + <span class="number">1</span>  <span class="comment"># 右边total还没定义</span></span><br><span class="line">    <span class="comment"># total = arg1 + arg2  # total在这里是局部变量.</span></span><br><span class="line">    print(<span class="string">"函数内是局部变量 : "</span>, total)</span><br><span class="line">    <span class="comment"># return total</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用sum函数</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)</span><br><span class="line"><span class="comment"># UnboundLocalError: local variable 'total' referenced before assignment</span></span><br></pre></td></tr></tbody></table></figure>

<p>错误信息为局部变量 total 在使用前未定义。<br>第一行定义了一个全局变量，<br>在 sum 函数中程序会因为“如果内部函数有引用外部函数的同名变量或者全局变量，<br>并且对这个变量有修改。那么python会认为它是一个局部变量，<br>又因为 sum 函数中没有 total 的定义和赋值，无法修改。<br>修改 total 为全局变量，通过函数参数传递，可以正常执行输出结果为：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 这是一个全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def sum(arg1, arg2):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg1, arg2, total</span>):</span>  <span class="comment"># total为形参</span></span><br><span class="line">    <span class="comment"># 返回2个参数的和.</span></span><br><span class="line">    <span class="comment"># print(total)</span></span><br><span class="line">    total = total + <span class="number">1</span>  <span class="comment"># total在这里是局部变量.</span></span><br><span class="line">    <span class="comment"># total = arg1 + arg2  # total在这里是局部变量.</span></span><br><span class="line">    print(<span class="string">"函数内是局部变量 : "</span>, total)</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用sum函数</span></span><br><span class="line"><span class="comment"># sum(10, 20)</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>, <span class="number">8</span>)  <span class="comment"># 通过函数参数传递total=8</span></span><br><span class="line"><span class="comment"># 函数内是局部变量 :  9</span></span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)</span><br><span class="line"><span class="comment"># 函数外是全局变量 :  0</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="global-和-nonlocal关键字"><a href="#global-和-nonlocal关键字" class="headerlink" title="global 和 nonlocal关键字"></a>global 和 nonlocal关键字</h3><p>作用都是可以实现代码块内变量使用外部的同名变量，当内部作用域想修改外部作用域的变量</p>
<p><code>global</code> 声明代码块中的变量使用外部全局的同名变量，即<strong>局部函数方法内执行完之后才能变成全局</strong>，在别的文件里也可以引用到，<br>不销毁 函数内部以<code>global</code>定义的变量</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 这是一个全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg1, arg2</span>):</span>  <span class="comment"># 没有定义 total 为自变量</span></span><br><span class="line">    <span class="comment"># 返回2个参数的和</span></span><br><span class="line">    <span class="comment"># print(total)</span></span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    print(<span class="string">"函数内是局部变量 : "</span>, total)</span><br><span class="line">    total = total + <span class="number">1</span>  <span class="comment"># 右边total已经定义，在局部函数对全局变量重新赋值</span></span><br><span class="line">    <span class="comment"># total = arg1 + arg2  # total在这里是局部变量</span></span><br><span class="line">    print(<span class="string">"函数内是局部变量 : "</span>, total)</span><br><span class="line">    <span class="keyword">global</span> c</span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)  <span class="comment"># 调用sum函数</span></span><br><span class="line"><span class="comment"># 函数内是局部变量 :  0</span></span><br><span class="line"><span class="comment"># 函数内是局部变量 :  1</span></span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)</span><br><span class="line"><span class="comment"># 函数外是全局变量 :  1</span></span><br><span class="line"></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)  <span class="comment"># 再调用sum函数</span></span><br><span class="line"><span class="comment"># 函数内是局部变量 :  1</span></span><br><span class="line"><span class="comment"># 函数内是局部变量 :  2 返回了函数及现场环境变量</span></span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)</span><br><span class="line"><span class="comment"># 函数外是全局变量 :  2</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)  <span class="comment"># 再调用sum函数</span></span><br><span class="line"><span class="comment"># 函数内是局部变量 :  2</span></span><br><span class="line"><span class="comment"># 函数内是局部变量 :  3 返回了函数及现场环境变量</span></span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)</span><br><span class="line"><span class="comment"># 函数外是全局变量 :  3</span></span><br><span class="line">print(c)  <span class="comment"># 0</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 这是一个全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">arg1, arg2</span>):</span>  <span class="comment"># 没有定义 total 为自变量</span></span><br><span class="line">    <span class="comment"># 返回2个参数的和</span></span><br><span class="line">    print(total)</span><br><span class="line">    <span class="keyword">global</span> total</span><br><span class="line">    total = total + <span class="number">1</span>  <span class="comment"># 右边total还没定义</span></span><br><span class="line">    <span class="comment"># total = arg1 + arg2  # total在这里是局部变量</span></span><br><span class="line">    print(<span class="string">"函数内是局部变量 : "</span>, total)</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用sum函数</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">print(<span class="string">"函数外是全局变量 : "</span>, total)</span><br><span class="line"><span class="comment"># SyntaxError: name 'total' is used prior to global declaration</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">int = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun1</span>():</span></span><br><span class="line">    int = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun2</span>():</span></span><br><span class="line">        int = <span class="number">2</span></span><br><span class="line">        print(int)</span><br><span class="line"></span><br><span class="line">    fun2()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fun1()  <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line">int = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun3</span>():</span></span><br><span class="line">    int = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun4</span>():</span></span><br><span class="line">        <span class="comment"># int = 2</span></span><br><span class="line">        print(int)  <span class="comment"># 在函数内部找不到对 int 的定义，则去外层查询。输出1。</span></span><br><span class="line"></span><br><span class="line">    fun4()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fun3()  <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line">int = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun5</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun6</span>():</span></span><br><span class="line">        print(int)</span><br><span class="line"></span><br><span class="line">    fun6()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fun5()  <span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> int</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun5</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun6</span>():</span></span><br><span class="line">        print(int)</span><br><span class="line"></span><br><span class="line">    fun6()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fun5()  <span class="comment"># &lt;class 'int'&gt; local、non-local、global 中都没有 int 的值，便去 built-in 中寻找 int 的值</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果要修改嵌套作用域（enclosing 作用域，外层非全局作用域）中的同名变量<br>则需要 nonlocal 关键字了，如下实例：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">no = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun2</span>():</span></span><br><span class="line">    <span class="keyword">nonlocal</span> no</span><br><span class="line">    print(no)</span><br><span class="line">    no = <span class="number">123</span></span><br><span class="line">    print(no)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fun2()</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 123</span></span><br><span class="line">print(no)</span><br><span class="line"><span class="comment"># Syntax Error: no binding for nonlocal ‘no’ found</span></span><br><span class="line"><span class="comment"># nonlocal 表示外层变量，但是一旦外层变量是全局变量，则只能用 global。</span></span><br><span class="line"><span class="comment"># 在使用 nonlocal no 之前，必须保证外层的确已经定义过 no 了，</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_counter</span>():</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">counter</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> count</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_counter_test</span>():</span></span><br><span class="line">    mc = make_counter()</span><br><span class="line">    print(mc())</span><br><span class="line">    print(mc())</span><br><span class="line">    print(mc())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make_counter_test()</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        <span class="comment"># print(num)</span></span><br><span class="line">        <span class="keyword">nonlocal</span> num  <span class="comment"># nonlocal关键字声明为外层变量</span></span><br><span class="line">        print(num)  <span class="comment"># 10</span></span><br><span class="line">        num = <span class="number">100</span></span><br><span class="line">        print(num)  <span class="comment"># 100</span></span><br><span class="line"></span><br><span class="line">    inner()</span><br><span class="line">    print(num)  <span class="comment"># 100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line"><span class="comment"># 100</span></span><br><span class="line">print(num)</span><br><span class="line"><span class="comment"># NameError: name 'num' is not defined</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        <span class="comment"># print(num)</span></span><br><span class="line">        <span class="keyword">global</span> num  <span class="comment"># global</span></span><br><span class="line">        print(num)</span><br><span class="line">        num = <span class="number">100</span></span><br><span class="line">        print(num)</span><br><span class="line"></span><br><span class="line">    inner()</span><br><span class="line">    print(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="comment"># NameError: name 'num' is not defined</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        <span class="comment"># print(num)</span></span><br><span class="line">        <span class="keyword">global</span> num  <span class="comment"># num为全局变量，与上面等于1的 num 没有关系</span></span><br><span class="line">        num = <span class="number">20</span>  <span class="comment"># 定义全局变量</span></span><br><span class="line">        print(num)  <span class="comment"># 输出20</span></span><br><span class="line">        num = <span class="number">100</span></span><br><span class="line">        print(num)  <span class="comment"># 输出100</span></span><br><span class="line"></span><br><span class="line">    inner()</span><br><span class="line">    print(num)  <span class="comment"># 输出10，局部变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line">print(num)  <span class="comment"># 输出100，全局变量</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在函数 add_b 内 global 定义的变量 b，只能在 函数 do_global 内引用，</span></span><br><span class="line"><span class="comment"># 如果要在 do_global 内修改，</span></span><br><span class="line"><span class="comment"># 必须在 do_global 函数里面声明 global b ，</span></span><br><span class="line"><span class="comment"># 表明是修改外面的 全局变量 b ：</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_b</span>():</span></span><br><span class="line">    <span class="keyword">global</span> b</span><br><span class="line">    b = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_global</span>():</span></span><br><span class="line">        <span class="keyword">global</span> b</span><br><span class="line">        b = b + <span class="number">10</span></span><br><span class="line">        print(b)</span><br><span class="line"></span><br><span class="line">    do_global()</span><br><span class="line">    print(b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_b()</span><br><span class="line"><span class="comment"># 52</span></span><br><span class="line"><span class="comment"># 52</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在函数 add_b 内 global 定义的变量 b，只能在 函数 do_global 内引用，</span></span><br><span class="line"><span class="comment"># 如果要在 do_global 内修改，</span></span><br><span class="line"><span class="comment"># 必须在 do_global 函数里面声明 global b ，</span></span><br><span class="line"><span class="comment"># 表明是修改外面的 全局变量 b ：</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_b</span>():</span></span><br><span class="line">    <span class="keyword">global</span> b</span><br><span class="line">    b = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_global</span>():</span></span><br><span class="line">        <span class="comment"># global b</span></span><br><span class="line">        b = b + <span class="number">10</span></span><br><span class="line">        print(b)</span><br><span class="line"></span><br><span class="line">    do_global()</span><br><span class="line">    print(b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_b()</span><br><span class="line"><span class="comment"># UnboundLocalError: local variable 'b' referenced before assignment</span></span><br><span class="line"><span class="comment"># 如果将do_global()里的global b注释掉,会报错。</span></span><br><span class="line"><span class="comment"># global 定义的 b ，只能引用，不能修改。</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_b</span>():</span></span><br><span class="line">    <span class="comment"># global  b</span></span><br><span class="line">    b = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_global</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> b</span><br><span class="line">        b = <span class="number">10</span></span><br><span class="line">        print(b)</span><br><span class="line"></span><br><span class="line">    do_global()</span><br><span class="line">    print(b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_b()</span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 如果在最后加上print(" b = %s " % b)，则会报错</span></span><br><span class="line"><span class="comment"># NameError: name 'b' is not defined</span></span><br><span class="line"><span class="comment"># 说明： nonlocal  适用于在局部函数 中 的局部函数， 把最内层的局部 变量设置成外层局部可用，但是还不是全局的。</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scope_test</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_local</span>():</span></span><br><span class="line">        spam = <span class="string">"local spam"</span></span><br><span class="line">        <span class="comment"># 此函数定义了另外的一个spam字符串变量，</span></span><br><span class="line">        <span class="comment"># 并且生命周期只在此函数内。</span></span><br><span class="line">        <span class="comment"># 此处的spam和外层的spam是两个变量，</span></span><br><span class="line">        <span class="comment"># 如果写出spam = spam + “local spam” 会报错</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_nonlocal</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> spam  <span class="comment"># 使用外层的spam变量</span></span><br><span class="line">        spam = <span class="string">"nonlocal spam"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_global</span>():</span></span><br><span class="line">        <span class="keyword">global</span> spam</span><br><span class="line">        spam = <span class="string">"global spam"</span></span><br><span class="line"></span><br><span class="line">    spam = <span class="string">"test spam"</span></span><br><span class="line">    do_local()</span><br><span class="line">    print(<span class="string">"After local assignment:"</span>, spam)</span><br><span class="line">    do_nonlocal()</span><br><span class="line">    print(<span class="string">"After nonlocal assignment:"</span>, spam)</span><br><span class="line">    do_global()</span><br><span class="line">    print(<span class="string">"After global assignment:"</span>, spam)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scope_test()</span><br><span class="line"><span class="comment"># After local assignment: test spam</span></span><br><span class="line"><span class="comment"># After nonlocal assignment: nonlocal spam</span></span><br><span class="line"><span class="comment"># After global assignment: nonlocal spam</span></span><br><span class="line">print(<span class="string">'----'</span>)</span><br><span class="line"><span class="comment"># ----</span></span><br><span class="line">print(<span class="string">"In global scope:"</span>, spam)</span><br><span class="line"><span class="comment"># In global scope: global spam</span></span><br></pre></td></tr></tbody></table></figure>

<p>nolocal 的使用场景就比较单一，它是使用在闭包中的，使变量使用外层的同名变量</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">func</span>):</span></span><br><span class="line">        a = <span class="number">1</span></span><br><span class="line">        print(<span class="string">"外层函数a的值"</span>, a)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>():</span></span><br><span class="line">                func()</span><br><span class="line">                <span class="keyword">nonlocal</span> a</span><br><span class="line">                a += <span class="number">1</span></span><br><span class="line">                print(<span class="string">"经过改变后，里外层函数a的值："</span>, a)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@foo</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>():</span></span><br><span class="line">      print(<span class="string">"nolocal的使用"</span>)</span><br><span class="line"></span><br><span class="line">change()</span><br><span class="line"><span class="comment"># 外层函数a的值 1</span></span><br><span class="line"><span class="comment"># nolocal的使用</span></span><br><span class="line"><span class="comment"># 经过改变后，里外层函数a的值： 2</span></span><br></pre></td></tr></tbody></table></figure>

<p>外层函数a的值 1<br>nolocal的使用<br>经过改变后，里外层函数a的值： 2<br>总结global的作用对象是全局变量，nonlocal的作用对象是外层变量（很显然就是闭包这种情况）</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/pycharm-kuai-jie-jian-keymap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/pycharm-kuai-jie-jian-keymap/" class="post-title-link" itemprop="url">pycharm 快捷键 keymap</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-26 11:22:44" itemprop="dateModified" datetime="2021-07-26T11:22:44Z">2021-07-26</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>pycharm </p>
<p>鼠标侧键就可以前进后退</p>
<p>调出快速搜索框：两次Shift<br>全局查找快捷键默认：Ctrl+Shift+F （如果不可以就是与搜狗输入法的冲突了）<br>自动补全代码：Alt+/</p>
<p>上端或下端插入一空行：shift+Alt+方向键<br>快速给代码加上组合语句try/catch等：CTRL+ALT+T<br>多行相同的代码一起修改或者删除：Ctrl+Shift+Alt 或者 按住鼠标的滚轮向下拉 也可！<br>运行编写的py文件：Ctrl+Shift+F10</p>
<p>eclispse快捷键<br>F5 进入函数逐行调试<br>F6 执行完一行代码<br>F8 执行到下一个断点处<br>ALT + 上/下 箭头   代码上下移动<br>ALT + 左/右 箭头    左–返回 - -右前进<br>ctrl + 左键 看源码   -<br>ctrl + /    注释代码<br>ctrl + home /end     一个单词一个单词的左右移动<br>shift + home/end    从头或者尾 选中一行代码<br>shift + tab 选中代码前调<br>ctrl + h   全局搜索<br>ctrl + o   列出当前文件有哪些类</p>
<p>追踪代码回跳到上次光标位置 ctrl+alt+左箭头<br>第三方库源<br>右上角有时候不是当前文件，右键一定是当前文件</p>
<p>断点所在的行一开始还没运行即将执行的语句<br>调试：慢动作播放<br>pycharm 右键debug<br>vscode 左边🐞按钮 或者菜单run-start debugging 在弹出的内容选择python file<br>step over 跳过子函数，单步，不关心函数内部，只看输出<br>step into 进入子函数<br>step into my code 直接跳到断点位置，不执行源码的子函数执行自己的<br>step out 跳出当前函数<br>run into 跳到下一段点<br>计算表达式</p>
<p>一、Ctrl 快捷键<br>Ctrl + F 在当前文件进行文本查找 （必备）</p>
<p>Ctrl + R 在当前文件进行文本替换 （必备）<br>Ctrl + Shift + R 全局替换</p>
<p>Ctrl + Z 撤销 （必备）</p>
<p>Ctrl+Shift+Z 撤销返回</p>
<p>Ctrl+Shitf+E 快速跳转至历史编辑过的代码位置(默认记录十条)</p>
<p>Ctrl + Y 删除光标所在行 或 删除选中的行 （必备）</p>
<p>Ctrl + X 剪切光标所在行 或 剪切选择内容</p>
<p>Ctrl + C 复制光标所在行 或 复制选择内容</p>
<p>Ctrl + D 复制光标所在行 或 复制选择内容，并把复制内容插入光标位置下面 （必备）</p>
<p>Ctrl + W 递进式选择代码块。可选中光标所在的单词或段落，连续按会在原有选中的基础上再扩展选中范围（必备）</p>
<p>Ctrl + E 显示最近打开的文件记录列表 （必备）</p>
<p>Ctrl + N 根据输入的 名/类名 查找类文件 （必备）</p>
<p>Ctrl + G 在当前文件跳转到指定行处</p>
<p>Ctrl + J 插入自定义动态代码模板 （必备）</p>
<p>Ctrl + P 方法参数提示显示 （必备）</p>
<p>Ctrl + Q 光标所在的变量 / 类名 / 方法名等上面（也可以在提示补充的时候按），显示文档内容</p>
<p>Ctrl + U 前往当前光标所在的方法的父类的方法 / 接口定义 （必备）</p>
<p>Ctrl + B 进入光标所在的方法/变量的接口或是定义处，等效于 Ctrl +<br>左键单击 （必备）</p>
<p>Ctrl + K 版本控制提交项目，需要此项目有加入到版本控制才可用</p>
<p>Ctrl + T 版本控制更新项目，需要此项目有加入到版本控制才可用</p>
<p>Ctrl + H 显示当前类的层次结构</p>
<p>Ctrl + O 选择可重写的方法</p>
<p>Ctrl + I 选择可继承的方法</p>
<p>Ctrl + + 展开代码</p>
<p>Ctrl + – 折叠代码</p>
<p>Ctrl + / 释光标所在行代码，会根据当前不同文件类型使用不同的注释符号 （必备）</p>
<p>Ctrl + U 前往当前光标所在的方法的父类的方法 / 接口定义 （必备）</p>
<p>Ctrl + B 进入光标所在的方法/变量的接口或是定义处，等效于 Ctrl + 左键单击 （必备）</p>
<p>Ctrl + K 版本控制提交项目，需要此项目有加入到版本控制才可用</p>
<p>Ctrl + T 版本控制更新项目，需要此项目有加入到版本控制才可用</p>
<p>Ctrl + H 显示当前类的层次结构</p>
<p>Ctrl + O 选择可重写的方法</p>
<p>Ctrl + I 选择可继承的方法</p>
<p>Ctrl + + 展开代码</p>
<p>Ctrl + – 折叠代码</p>
<p>Ctrl + / 释光标所在行代码，会根据当前不同文件类型使用不同的注释符号 （必备）</p>
<p>Ctrl + [ 移动光标到当前所在代码的花括号开始位置</p>
<p>Ctrl + ] 移动光标到当前所在代码的花括号结束位置</p>
<p>Ctrl + F1 在光标所在的错误代码处显示错误信息 （必备）</p>
<p>Ctrl + F3 调转到所选中的词的下一个引用位置 （必备）</p>
<p>Ctrl + F4 关闭当前编辑文件</p>
<p>Ctrl + F8 在 Debug 模式下，设置光标当前行为断点，如果当前已经是断点则去掉断点</p>
<p>Ctrl + F9 执行 Make Project 操作</p>
<p>Ctrl + F11 选中文件 / 文件夹，使用助记符设定 / 取消书签 （必备）</p>
<p>Ctrl + F12 弹出当前文件结构层，可以在弹出的层上直接输入，进行筛选</p>
<p>Ctrl + Tab 编辑窗口切换，如果在切换的过程又加按上 delete，则是关闭对应选中的窗口</p>
<p>Ctrl + End 跳到文件尾</p>
<p>Ctrl + Home 跳到文件头</p>
<p>Ctrl + Space 基础代码补全，默认在 Windows 系统上被输入法占用，需要进行修改，建议<br>修改为 Ctrl +逗号 （必备）</p>
<p>Ctrl + Delete 删除光标后面的单词或是中文句 （必备）</p>
<p>Ctrl +BackSpace 删除光标前面的单词或是中文句 （必备）</p>
<p>Ctrl +1,2,3…9 定位到对应数值的书签位置 （必备）</p>
<p>Ctrl + 左键单击 在打开的文件标题上，弹出该文件路径 （必备）</p>
<p>Ctrl + 光标定位按 Ctrl 不要松开，会显示光标所在的类信息摘要</p>
<p>Ctrl + 左方向键 光标跳转到当前单词 / 中文句的左侧开头位置 （必备）</p>
<p>Ctrl + 右方向键 光标跳转到当前单词 / 中文句的右侧开头位置 （必备）</p>
<p>Ctrl + 前方向键 等效于鼠标滚轮向前效果 （必备）</p>
<p>Ctrl + 后方向键 等效于鼠标滚轮向后效果 （必备）</p>
<p>向上插入一行空格：CTRL+Enter</p>
<p>二、Alt 快捷键<br>Alt + 显示版本控制常用操作菜单弹出层 （必备）</p>
<p>Alt + Q 弹出一个提示，显示当前类的声明 / 上下文信息</p>
<p>Alt + F1 显示当前文件选择目标弹出层，弹出层中有很多目标可以进行选择 （必备）</p>
<p>Alt + F2 对于前面页面，显示各类浏览器打开目标选择弹出层</p>
<p>Alt + F3 选中文本，逐个往下查找相同文本，并高亮显示</p>
<p>Alt + F7 查找光标所在的方法 / 变量 / 类被调用的地方</p>
<p>Alt + F8 在 Debug 的状态下，选中对象，弹出可输入计算表达式调试框，查看该输入内容的调试结果</p>
<p>Alt + Home 定位 / 显示到当前文件的 Navigation Bar</p>
<p>Alt + Enter IntelliJ IDEA 根据光标所在问题，提供快速修复选择，光标放在的位置不同提示<br>的结果也不同 （必备） 导入引用包</p>
<p>Alt + Insert 代码自动生成，如生成对象的 set / get Getter和Setter 方法，构造函数，toString() 等 （必备） </p>
<p>Alt + 左方向键 切换当前已打开的窗口中的子视图，比如 Debug 窗口中有 Output、Debugger 等子视图，用此快捷键就可以在子视图中切换 （必备）</p>
<p>Alt + 右方向键 按切换当前已打开的窗口中的子视图，比如 Debug 窗口中有 Output、Debugger 等子视图，用此快捷键就可以在子视图中切换 （必备）</p>
<p>Alt + 前方向键 当前光标跳转到当前文件的前一个方法名位置 （必备）</p>
<p>Alt + 后方向键 当前光标跳转到当前文件的后一个方法名位置 （必备）</p>
<p>Alt +1,2,3…9 显示对应数值的选项卡，其中 1 是 Project 用得最多 （必备）</p>
<p>三、Shift 快捷键<br>Shift + F1 如果有外部文档可以连接外部文档</p>
<p>Shift + F2 跳转到上一个高亮错误 或 警告位置</p>
<p>Shift + F3 在查找模式下，查找匹配上一个</p>
<p>Shift + F4 对当前打开的文件，使用新 Windows 窗口打开，旧窗口保留</p>
<p>Shift + F6 对文件 / 文件夹 重命名</p>
<p>Shift + F7 在 Debug 模式下，智能步入。断点所在行上有多个方法调用，会弹出进入哪个方法</p>
<p>Shift + F8 在 Debug 模式下，跳出，表现出来的效果跟 F9 一样</p>
<p>Shift + F9 等效于点击工具栏的 Debug 按钮</p>
<p>Shift + F10 等效于点击工具栏的 Run 按钮</p>
<p>Shift + F11 弹出书签显示层 （必备）</p>
<p>Shift + Tab 取消缩进 （必备）</p>
<p>Shift + ESC 隐藏当前 或 最后一个激活的工具窗口</p>
<p>Shift + End 选中光标到当前行尾位置</p>
<p>Shift + Home 选中光标到当前行头位置</p>
<p>Shift + Enter 开始新一行。光标所在行下空出一行，光标定位到新行位置 （必备）向下插入一行空格</p>
<p>Shift + 左键单击 在打开的文件名上按此快捷键，可以关闭当前打开文件 （必备）</p>
<p>Shift + 滚轮前后滚动 当前文件的横向滚动轴滚动 （必备）</p>
<p>四、Ctrl + Alt 快捷键<br>Ctrl + Alt + L 格式化代码，可以对当前文件和整个包目录使用 （必备）</p>
<p>Ctrl + Alt + O 优化导入的类，可以对当前文件和整个包目录使用 （必备）</p>
<p>Ctrl + Alt + I 光标所在行 或 选中部分进行自动代码缩进，有点类似格式化</p>
<p>Ctrl + Alt + T 对选中的代码弹出环绕选项弹出层 （必备）</p>
<p>Ctrl + Alt + J 弹出模板选择窗口，将选定的代码加入动态模板中</p>
<p>Ctrl + Alt + H 调用层次，使用向下或者向上箭头，选择某个调用，然后按下f4即可跳转到源代码。alt+8就可以跳回去了。就又可以继续看下一个调用的地方了。</p>
<p>Ctrl + Alt + B 在某个调用的方法名上使用会跳到具体的实现处，可以跳过接口</p>
<p>Ctrl + Alt + V 快速引进变量</p>
<p>Ctrl + Alt + Y 同步、刷新</p>
<p>Ctrl + Alt + S 打开 IntelliJ IDEA 系统设置 （必备）</p>
<p>Ctrl + Alt + F7 显示使用的地方。寻找被该类或是变量被调用的地方，用弹出框的方式找出来</p>
<p>Ctrl + Alt + F11 切换全屏模式</p>
<p>Ctrl + Alt + Enter 光标所在行上空出一行，光标定位到新行 （必备）</p>
<p>Ctrl + Alt + Home 弹出跟当前文件有关联的文件弹出层</p>
<p>Ctrl + Alt + Space 类名自动完成</p>
<p>Ctrl + Alt + 左方向键 退回到上一个操作的地方 （必备）</p>
<p>Ctrl + Alt + 右方向键 前进到上一个操作的地方 （必备）</p>
<p>Ctrl + Alt + 前方向键 在查找模式下，跳到上个查找的文件</p>
<p>Ctrl + Alt + 后方向键 在查找模式下，跳到下个查找的文件</p>
<p>五、Ctrl + Shift 快捷键<br>Ctrl + Shift + F 根据输入内容查找整个项目 或 指定目录内文件 （必备）</p>
<p>Ctrl + Shift + R 根据输入内容替换对应内容，范围为整个项目 或 指定目录内文件 （必备）</p>
<p>Ctrl + Shift + J 自动将下一行合并到当前行末尾 （必备）</p>
<p>Ctrl + Shift + Z 取消撤销 （必备）</p>
<p>Ctrl + Shift + W 递进式取消选择代码块。可选中光标所在的单词或段落，连续按会在原有选中的基础上再扩展取消选中范围 （必备）</p>
<p>Ctrl + Shift + N 通过文件名定位 / 打开文件 / 目录，打开目录需要在<br>输入的内容后面多加一个正斜杠 （必备）</p>
<p>Ctrl + Shift + U 对选中的代码进行大 / 小写轮流转换 （必备）</p>
<p>Ctrl + Shift + T 对当前类生成单元测试类，如果已经存在的单元测试类则可以进行选择 （必备）</p>
<p>快速展开/折叠全部方法：Ctrl + Shift + “ +/- “</p>
<p>Ctrl + Shift + C 复制当前文件磁盘路径到剪贴板 （必备）</p>
<p>Ctrl + Shift + V 弹出缓存的最近拷贝的内容管理器弹出层</p>
<p>Ctrl + Shift + E 显示最近修改的文件列表的弹出层</p>
<p>Ctrl + Shift + H 显示方法层次结构</p>
<p>Ctrl + Shift + B 跳转到类型声明处 （必备）</p>
<p>Ctrl + Shift + I 在当前类里再弹出一个窗口出来快速查看光标所在的方法 或 类的定义 </p>
<p>Ctrl + Shift + A 查找动作 / 设置</p>
<p>Ctrl + Shift + / 代码块注释 （必备）</p>
<p>Ctrl + Shift + [ 选中从光标所在位置到它的顶部中括号位置 （必备）</p>
<p>Ctrl + Shift + ] 选中从光标所在位置到它的底部中括号位置 （必备）</p>
<p>Ctrl + Shift + + 展开所有代码 （必备）</p>
<p>Ctrl + Shift + – 折叠所有代码 （必备）</p>
<p>Ctrl + Shift + F7 高亮显示所有该选中文本，随着鼠标的移动，这个高亮是不会消失，按 Esc 高亮消失 （必备），使用f3找到下一个使用该变量的地方</p>
<p>Ctrl + Shift + F8 在 Debug 模式下，指定断点进入条件</p>
<p>Ctrl + Shift + F9 编译选中的文件 / 包 / Module</p>
<p>Ctrl + Shift + F12 编辑器最大化 （必备）</p>
<p>Ctrl + Shift + Space 智能代码提示</p>
<p>Ctrl + Shift + Enter 自动结束代码，行末自动添加分号 （必备）</p>
<p>Ctrl + Shift +Backspace 退回到上次修改的地方 （必备）</p>
<p>Ctrl + Shift +1,2,3…9 快速添加指定数值的书签 （必备）</p>
<p>Ctrl + Shift + 左键单击 把光标放在某个类变量上，按此快捷键可以直接定位到该类中<br>（必备）</p>
<p>Ctrl + Shift + 左方向键 在代码文件上，光标跳转到当前单词 / 中文句的左侧开头位置，<br>同时选中该单词 / 中文句（必备）</p>
<p>Ctrl + Shift + 右方向键 在代码文件上，光标跳转到当前单词 / 中文句的右侧开头位置，<br>同时选中该单词 / 中文句（必备）</p>
<p>Ctrl + Shift + 前方向键 光标放在方法名上，将方法移动到上一个方法前面，调整方法排序<br>（必备）</p>
<p>Ctrl + Shift + 后方向键 光标放在方法名上，将方法移动到下一个方法前面，调整方法</p>
<p>Ctrl + Shift + 右方向键 在代码文件上，光标跳转到当前单词 / 中文句的右侧开头位置，<br>同时选中该单词 / 中文句（必备）</p>
<p>Ctrl + Shift + 前方向键 光标放在方法名上，将方法移动到上一个方法前面，调整方法排序<br>（必备）</p>
<p>Ctrl + Shift + 后方向键 光标放在方法名上，将方法移动到下一个方法前面，调整方法<br>排序 （必备）</p>
<p>六、Alt + Shift 快捷键<br>Alt + Shift + N 选择 / 添加 task （必备）</p>
<p>Alt + Shift + F 显示添加到收藏夹弹出层 / 添加到收藏夹</p>
<p>Alt + Shift + C 查看最近操作项目的变化情况列表</p>
<p>Alt + Shift + I 查看项目当前文件</p>
<p>Alt + Shift + F7在 Debug 模式下，下一步，进入当前方法体内，如果方法体还有方法，则会进入该内嵌的方法中，依此循环进入</p>
<p>Alt + Shift + F9 弹出 Debug 的可选择菜单</p>
<p>Alt + Shift + F10 弹出 Run 的可选择菜单</p>
<p>Alt + Shift + 左键双击 选择被双击的单词 / 中文句，按住不放，可以同时选择其他单词 / 中文句 （必备）</p>
<p>Alt + Shift + 前方向键 移动光标所在行向上移动 （必备）</p>
<p>Alt + Shift + 后方向键 移动光标所在行向下移动 （必备）</p>
<p>七、Ctrl + Shift + Alt 快捷键<br>Ctrl + Shift + Alt + V 无格式黏贴 （必备）</p>
<p>Ctrl + Shift + Alt + N 前往指定的变量 / 方法</p>
<p>Ctrl + Shift + Alt + S 打开当前项目设置 （必备）</p>
<p>Ctrl + Shift + Alt + C 复制参考信息</p>
<p>八、其他快捷键<br>F2 跳转到下一个高亮错误 或 警告位置 （必备）</p>
<p>F3 在查找模式下，定位到下一个匹配处</p>
<p>F4 编辑源 （必备）</p>
<p>F7 在 Debug 模式下，进入下一步，如果当前行断点是一个方法，则进入当前方法体内，如果该方法体还有方法，则不会进入该内嵌的方法中</p>
<p>F8 在 Debug 模式下，进入下一步，如果当前行断点是一个方法，则不进入当前方法体内</p>
<p>F9 在 Debug 模式下，恢复程序运行，但是如果该断点下面代码还有断点则停在下一个断点上</p>
<p>F11 添加书签 （必备）</p>
<p>F12 回到前一个工具窗口 （必备）</p>
<p>Tab 缩进 （必备）</p>
<p>ESC 从工具窗口进入代码文件窗口 （必备）<br>连按两次Shift 弹出 Search Everywhere 弹出层</p>
<p>二、IntelliJ IDEA 快捷键大全 Mac<br>Mac键盘符号和修饰键说明<br>⌘ Command</p>
<p>⇧ Shift</p>
<p>⌥ Option</p>
<p>⌃ Control</p>
<p>↩︎ Return/Enter</p>
<p>⌫ Delete</p>
<p>⌦ 向前删除键（Fn+Delete）</p>
<p>↑ 上箭头</p>
<p>↓ 下箭头</p>
<p>← 左箭头</p>
<p>→ 右箭头</p>
<p>⇞ Page Up（Fn+↑）</p>
<p>⇟ Page Down（Fn+↓）</p>
<p>Home Fn + ←</p>
<p>End Fn + →</p>
<p>⇥ 右制表符（Tab键）</p>
<p>⇤ 左制表符（Shift+Tab）</p>
<p>⎋ Escape (Esc)</p>
<p>一、Editing（编辑）<br>⌃Space 基本的代码补全（补全任何类、方法、变量）</p>
<p>⌃⇧Space 智能代码补全（过滤器方法列表和变量的预期类型）</p>
<p>⌘⇧↩ 自动结束代码，行末自动添加分号</p>
<p>⌘P 显示方法的参数信息</p>
<p>⌃J, Mid. button click 快速查看文档</p>
<p>⇧F1 查看外部文档（在某些代码上会触发打开浏览器显示相关文档）</p>
<p>⌘+鼠标放在代码上 显示代码简要信息</p>
<p>⌘F1 在错误或警告处显示具体描述信息</p>
<p>⌘N, ⌃↩, ⌃N 生成代码（getter、setter、构造函数、</p>
<p>hashCode/equals,toString）</p>
<p>⌃O 覆盖方法（重写父类方法）</p>
<p>⌃I 实现方法（实现接口中的方法）</p>
<p>⌘⌥T 包围代码（使用if..else, try..catch, for, synchronized等包围<br>选中的代码）</p>
<p>⌘/ 注释/取消注释与行注释</p>
<p>⌘⌥/ 注释/取消注释与块注释</p>
<p>⌥↑ 连续选中代码块</p>
<p>⌥↓ 减少当前选中的代码块</p>
<p>⌃⇧Q 显示上下文信息</p>
<p>⌥↩ 显示意向动作和快速修复代码</p>
<p>⌘⌥L 格式化代码</p>
<p>⌃⌥O 优化import</p>
<p>⌃⌥I 自动缩进线</p>
<p>⇥ / ⇧⇥ 缩进代码 / 反缩进代码</p>
<p>⌘X 剪切当前行或选定的块到剪贴板</p>
<p>⌘C 复制当前行或选定的块到剪贴板</p>
<p>⌘V 从剪贴板粘贴</p>
<p>⌘⇧V 从最近的缓冲区粘贴</p>
<p>⌘D 复制当前行或选定的块</p>
<p>⌘⌫ 删除当前行或选定的块的行</p>
<p>⌃⇧J 智能的将代码拼接成一行</p>
<p>⌘↩ 智能的拆分拼接的行</p>
<p>⇧↩ 开始新的一行</p>
<p>⌘⇧U 大小写切换</p>
<p>⌘⇧] / ⌘⇧[ 选择直到代码块结束/开始</p>
<p>⌥⌦ 删除到单词的末尾（⌦键为Fn+Delete）</p>
<p>⌥⌫ 删除到单词的开头</p>
<p>⌘+ / ⌘- 展开 / 折叠代码块</p>
<p>⌘⇧+ 展开所以代码块</p>
<p>⌘⇧- 折叠所有代码块</p>
<p>⌘W 关闭活动的编辑器选项卡</p>
<p>二、Search/Replace（查询/替换）<br>Double ⇧ 查询任何东西</p>
<p>⌘F 文件内查找</p>
<p>⌘G 查找模式下，向下查找</p>
<p>⌘⇧G 查找模式下，向上查找</p>
<p>⌘R 文件内替换</p>
<p>⌘⇧F 全局查找（根据路径）</p>
<p>⌘⇧R 全局替换（根据路径）</p>
<p>⌘⇧S 查询结构（Ultimate Edition 版专用，需要在Keymap中设置）</p>
<p>⌘⇧M 替换结构（Ultimate Edition 版专用，需要在Keymap中设置）</p>
<p>三、Usage Search（使用查询）<br>⌥F7 / ⌘F7 在文件中查找用法 / 在类中查找用法</p>
<p>⌘⇧F7 在文件中突出显示的用法</p>
<p>⌘⌥F7 显示用法</p>
<p>四、Compile and Run（编译和运行）<br>⌘F9 编译Project</p>
<p>⌘⇧F9 编译选择的文件、包或模块</p>
<p>⌃⌥R 弹出 Run 的可选择菜单</p>
<p>⌃⌥D 弹出 Debug 的可选择菜单</p>
<p>⌃R 运行</p>
<p>⌃D 调试</p>
<p>⌃⇧R, ⌃⇧D 从编辑器运行上下文环境配置</p>
<p>五、Debugging（调试）<br>F8 进入下一步，如果当前行断点是一个方法，则不进入当前方法体内</p>
<p>F7 进入下一步，如果当前行断点是一个方法，则进入当前方法体内，如果该</p>
<p>方法体还有方法，则不会进入该内嵌的方法中</p>
<p>⇧F7 智能步入，断点所在行上有多个方法调用，会弹出进入哪个方法</p>
<p>⇧F8 跳出</p>
<p>⌥F9 运行到光标处，如果光标前有其他断点会进入到该断点</p>
<p>⌥F8 计算表达式（可以更改变量值使其生效）</p>
<p>⌘⌥R 恢复程序运行，如果该断点下面代码还有断点则停在下一个断点上</p>
<p>⌘F8 切换断点（若光标当前行有断点则取消断点，没有则加上断点）</p>
<p>⌘⇧F8 查看断点信息</p>
<p>六、Navigation（导航）<br>⌘O 查找类文件</p>
<p>⌘⇧O 查找所有类型文件、打开文件、打开目录，打开目录需要在输入的内容前面或后面加一个反斜杠/</p>
<p>⌘⌥O 前往指定的变量 / 方法</p>
<p>⌃← / ⌃→ 左右切换打开的编辑tab页</p>
<p>F12 返回到前一个工具窗口</p>
<p>⎋ 从工具窗口进入代码文件窗口</p>
<p>⇧⎋ 隐藏当前或最后一个活动的窗口，且光标进入代码文件窗口</p>
<p>⌘⇧F4 关闭活动run/messages/find/… tab</p>
<p>⌘L 在当前文件跳转到某一行的指定处</p>
<p>⌘E 显示最近打开的文件记录列表</p>
<p>⌘⌥← / ⌘⌥→ 退回 / 前进到上一个操作的地方</p>
<p>⌘⇧⌫ 跳转到最后一个编辑的地方</p>
<p>⌥F1 显示当前文件选择目标弹出层，弹出层中有很多目标可以进行选择(如在<br>代码编辑窗口可以选择显示该文件的Finder)</p>
<p>⌘B / ⌘ 鼠标点击 进入光标所在的方法/变量的接口或是定义处</p>
<p>⌘⌥B 跳转到实现处，在某个调用的方法名上使用会跳到具体的实现处，可以跳过接口</p>
<p>⌥ Space, ⌘Y 快速打开光标所在方法、类的定义</p>
<p>⌃⇧B 跳转到类型声明处</p>
<p>⌘U 前往当前光标所在方法的父类的方法 / 接口定义</p>
<p>⌃↓ / ⌃↑ 当前光标跳转到当前文件的前一个/后一个方法名位置</p>
<p>⌘] / ⌘[ 移动光标到当前所在代码的花括号开始/结束位置</p>
<p>⌘F12 弹出当前文件结构层，可以在弹出的层上直接输入进行筛选（可用于搜索类中的方法）</p>
<p>⌃H 显示当前类的层次结构</p>
<p>⌘⇧H 显示方法层次结构</p>
<p>⌃⌥H 显示调用层次结构</p>
<p>F2 / ⇧F2 跳转到下一个/上一个突出错误或警告的位置</p>
<p>F4 / ⌘↓ 编辑/查看代码源</p>
<p>⌥ Home 显示到当前文件的导航条</p>
<p>F3选中文件/文件夹/代码行，添加/取消书签</p>
<p>⌥F3 选中文件/文件夹/代码行，使用助记符添加/取消书签</p>
<p>⌃0…⌃9 定位到对应数值的书签位置</p>
<p>⌘F3 显示所有书签</p>
<p>七、Refactoring（重构）<br>F5 复制文件到指定目录</p>
<p>F6 移动文件到指定目录</p>
<p>⌘⌫ 在文件上为安全删除文件，弹出确认框</p>
<p>⇧F6 重命名文件</p>
<p>⌘F6 更改签名</p>
<p>⌘⌥N 一致性</p>
<p>⌘⌥M 将选中的代码提取为方法</p>
<p>⌘⌥V 提取变量</p>
<p>⌘⌥F 提取字段</p>
<p>⌘⌥C 提取常量</p>
<p>⌘⌥P 提取参数</p>
<p>八、VCS/Local History（版本控制/本地历史记录）<br>⌘K 提交代码到版本控制器</p>
<p>⌘T 从版本控制器更新代码</p>
<p>⌥⇧C 查看最近的变更记录</p>
<p>⌃C 快速弹出版本控制器操作面板</p>
<p>九、Live Templates（动态代码模板）<br>⌘⌥J 弹出模板选择窗口，将选定的代码使用动态模板包住</p>
<p>⌘J 插入自定义动态代码模板</p>
<p>十、General（通用）<br>⌘1…⌘9 打开相应编号的工具窗口</p>
<p>⌘S 保存所有</p>
<p>⌘⌥Y 同步、刷新</p>
<p>⌃⌘F 切换全屏模式</p>
<p>⌘⇧F12 切换最大化编辑器</p>
<p>⌥⇧F 添加到收藏夹</p>
<p>⌥⇧I 检查当前文件与当前的配置文件</p>
<p>§⌃, ⌃` 快速切换当前的scheme（切换主题、代码样式等）</p>
<p>⌘, 打开IDEA系统设置</p>
<p>⌘; 打开项目结构对话框</p>
<p>⇧⌘A 查找动作（可设置相关选项）</p>
<p>⌃⇥ 编辑窗口标签和工具窗口之间切换（如果在切换的过程加按上delete，则是关闭对应选中的窗口）</p>
<p>十一、Other（一些官方文档上没有体现的快捷键）<br>⌘⇧8 竖编辑模式</p>
<p>导航<br>⌘O 查找类文件 Ctrl + N</p>
<p>⌘⌥O 前往指定的变量 / 方法 Ctrl + Shift + Alt + N</p>
<p>⌃← / ⌃→ 左右切换打开的编辑tab页 Alt← / Alt→</p>
<p>⎋ 从工具窗口进入代码文件窗口 ESC</p>
<p>⌘L 在当前文件跳转到某一行的指定处 Ctrl + G</p>
<p>⌘E 显示最近打开的文件记录列表 Ctrl + E</p>
<p>⌘⌥← / ⌘⌥→ 退回 / 前进到上一个操作的地方 Ctrl + Alt + ← Ctrl + Alt + →</p>
<p>⌘⇧⌫ 跳转到最后一个编辑的地方</p>
<p>⌃H 显示当前类的层次结构 Ctrl + H</p>
<p>⌘⇧H 显示方法层次结构</p>
<p>⌃⌥H 显示调用层次结构</p>
<p>F4 / ⌘↓ 编辑/查看代码源</p>
<p>⌘⌥U 显示类UML图</p>
<p>⌃J 查看注释</p>
<p>编辑<br>⌥⌦ 删除到单词的末尾（⌦键为Fn+Delete）</p>
<p>⌥⌫ 删除到单词的开头</p>
<p>⌘+ / ⌘- 展开 / 折叠代码块</p>
<p>⌘F1 在错误或警告处显示具体描述信息</p>
<p>⌘⌥L 格式化代码</p>
<p>⌃⌥O 优化import</p>
<p>⇧↩ 开始新的一行</p>
<p>⌘⇧↩ 自动结束代码，行末自动添加分号</p>
<p>⌃I 实现方法（实现接口中的方法）</p>
<p>⇧F6 重命名文件或者变量</p>
<p>⌘N, ⌃↩, ⌃N 生成代码（getter、setter、构造函数、hashCode/equals,toString）</p>
<p>⌘P 显示方法的参数信息</p>
<p>查找<br>Double⇧ 查找任何东西</p>
<p>⌘⇧F 全局查找（根据路径）</p>
<p>⌘F 文件内查找</p>
<p>⌘G 查找模式下，向下查找</p>
<p>⌘⇧G 查找模式下，向上查找</p>
<p>⌘⌥B 跳转到接口的实现</p>
<p>⌘U 查看接口定义</p>
<p>⌘⌥← / ⌘⌥→ 退回 / 前进到上一个操作的地方</p>
<p>⌘B / ⌘ 鼠标点击 进入光标所在的方法/变量的接口或是定义处</p>
<p>⌃⇧B 跳转到类型声明处</p>
<p>⌥ Space, ⌘Y 快速打开光标所在方法、类的定义</p>
<p>⌘O 查找类文件</p>
<p>⌘⇧O 查找所有类型文件、打开文件、打开目录，打开目录需要在输入的内容前面或后面加一个反斜杠/</p>
<p>F12 返回到前一个工具窗口</p>
<p>⎋ 从工具窗口进入代码文件窗口</p>
<p>⇧⎋ 隐藏当前或最后一个活动的窗口，且光标进入代码文件窗口</p>
<p>F3选中文件/文件夹/代码行，添加/取消书签</p>
<p>⌥F3 选中文件/文件夹/代码行，使用助记符添加/取消书签</p>
<p>⌃0…⌃9 定位到对应数值的书签位置</p>
<p>⌘F3 显示所有书签</p>
<p>⌥F1 显示当前文件选择目标弹出层，弹出层中有很多目标可以进行选择(如在代码编辑窗口可以选择显示该文件的Finder)</p>
<p>⌘F12 弹出当前文件结构层，可以在弹出的层上直接输入进行筛选（可用于搜索类中的方法）</p>
<p>通用<br>⌃⌘F 切换全屏模式</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/restful/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/restful/" class="post-title-link" itemprop="url">REST</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-17 07:57:02" itemprop="dateModified" datetime="2021-09-17T07:57:02Z">2021-09-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>http是应用协议而非传输协议</li>
</ul>
<h3 id="REST-Representational-State-Transfer-表示（表述）性状态转换，表现层状态转义，"><a href="#REST-Representational-State-Transfer-表示（表述）性状态转换，表现层状态转义，" class="headerlink" title="REST - Representational State Transfer 表示（表述）性状态转换，表现层状态转义，"></a>REST - Representational State Transfer 表示（表述）性状态转换，表现层状态转义，</h3><ul>
<li>是一种以资源为中心的 万维网web软件系统架构设计风格(它既不是一个标准规范也不是一个强制性约束)，</li>
</ul>
<ul>
<li>一种分布式系统的应用层解决方案，</li>
<li><strong>Representational：数据的表现形式（JSON、XML…..），数据描述简单、可读。</strong></li>
<li><strong>State: 当前状态或者数据</strong></li>
<li><strong>Transfer: 数据传输通信</strong></li>
</ul>
<ul>
<li>目的：用来创建网络服务的，</li>
<li>可以用 Ajax 和RESTful web服务构建应用</li>
<li>可以降低开发的复杂性，提高系统的可伸缩性。<br>RESTful架构就是：<strong>“每一个URI代表一种资源，客户端通过四个HTTP动词，对服务器端资源进行操作，实现资源的表现层状态转移”。</strong></li>
</ul>
<h5 id="RESTful-六大限制"><a href="#RESTful-六大限制" class="headerlink" title="RESTful 六大限制"></a>RESTful 六大限制</h5><ol>
<li><p><strong>客户-服务器（Client-Server）</strong></p>
<ul>
<li>关注点分离</li>
<li>服务端专注数据存储，提高了简单性</li>
<li>前端专注用户界面，提升了可移植性</li>
</ul>
</li>
<li><p><strong>无状态（StateLess）</strong></p>
<ul>
<li>所有会话信息都保存在客户端</li>
<li>每次请求必须包括所有信息，不能依赖上下文信息</li>
<li>服务端不用保存会话信息，提升简单性、可靠性、可见性（软件工程中接口之间透明程度）</li>
</ul>
</li>
<li><p><strong>缓存（Cache）</strong></p>
<ul>
<li>所有服务端响应都要被表示为可缓存（缓存在客户端（浏览器））或不可缓存</li>
<li>减少前后端交互，提升性能</li>
</ul>
</li>
<li><p><strong>统一接口（Uniform Interface）</strong></p>
<ul>
<li>接口设计尽可能统一通用，提升了简单性、可见性</li>
<li>遵循接口规范，接口与实现解耦，使前后端可以独立开发迭代</li>
</ul>
</li>
<li><p><strong>分层系统（Layered System）</strong></p>
<ul>
<li>每层只知道相邻的一层，后面隐藏的就不知道了</li>
<li>客户端不知道是和代理还是真实服务器通信</li>
<li>其它层：安全层、负载均衡、缓存层等</li>
</ul>
</li>
<li><p><strong>按需代码（Code-On-Demand）（可选）</strong></p>
<ul>
<li>客户端可以下载运行服务端传来的数据（比如JS）</li>
<li>通过减少一些功能，简化了客户端</li>
</ul>
</li>
</ol>
<h5 id="统一接口的限制"><a href="#统一接口的限制" class="headerlink" title="统一接口的限制"></a>统一接口的限制</h5><ol>
<li><strong>资源的标识</strong></li>
</ol>
<ul>
<li>Resources(资源)：任意可以命名的事物抽象为资源，在RESTFul设计里一切都是资源。<br>就是网络上的一个实体，或者说是网络上的一个具体信息。它可以是一段文本、一张图片、一首歌曲、一个用户、或者一个订单或一种服务或数据。<br>每个资源可以通过<code>URI</code>（统一资源标识符）被唯一的标识(identifier)和定位和指向资源而不是操作资源。标识符在网站上的表现形式就是URI。<br>每一个URL 指向的一个实体资源，要获取到这个资源，访问它的URI即可，URI就是资源在互联网上的唯一标识。<br><a target="_blank" rel="noopener" href="https://api.z.cn/v1/product/recent?page=3&amp;size=20">https://api.z.cn/v1/product/recent?page=3&amp;size=20</a></li>
</ul>
<ol start="2">
<li><p><strong>通过表述来操作资源</strong></p>
<ul>
<li>通过表述<code>Representation</code> 操作资源，比如<code>JSON</code>、<code>XML</code>等</li>
<li>客户端不能直接操作（比如<code>SQL</code>）服务端资源</li>
<li>客户端应该通过表述（比如<code>JSON</code>）来操作资源</li>
</ul>
</li>
<li><p><strong>自描述消息</strong></p>
<ul>
<li>每个消息（请求或响应）必须提供足够的信息让接受者理解</li>
<li>消息：如媒体类型（<code>application/json、application/xml</code>）</li>
<li>消息：如HTTP方法： <code>GET、POST、DELETE</code></li>
<li>是否缓存： <code>Cache-Control</code></li>
</ul>
</li>
<li><p><strong>超媒体作为应用状态引擎</strong></p>
<ul>
<li>超媒体： 带文字的链接</li>
<li>应用转态：一个网页</li>
<li>引擎：驱动、跳转</li>
<li>合起来就是：点击链接跳转到另一个网页</li>
</ul>
</li>
</ol>
<h3 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h3><p>符合REST架构风格的<strong>API</strong>就是 <strong>RESTful API</strong>，设计概念和准则规范，<br>接口实现 是前后端分离的最佳实践，</p>
<p>我们在设计Web应用时，如果需要向客户端提供资源，就可以使用REST风格的URI，这是实现RESTful架构的第一步。当然，真正的RESTful架构并不只是URI符合REST风格，更为重要的是“无状态”和“幂等性”两个词，我们在后面的课程中会为大家阐述这两点。</p>
<ul>
<li><p>轻量，直接通过http(s)做传输协议，不需要额外的协议</p>
</li>
<li><p>面向资源的接口设计 （不同于 SOAP协议，SOAP 是面向服务的）一目了然，具有解释性</p>
<ul>
<li>Representation(表现层)：资源的“表现层、表现形式。资源可以有多种外在表现形式。我们把资源具体呈现出来的形式，叫做它的“表现层”。比如，文本可以用<code>text/plain</code>格式表现，也可以用<code>text/html</code>格式、<code>text/xml</code>格式、<code>application/json</code>格式表现，甚至可以采用二进制格式；图片可以用<code>image/jpeg</code>格式表现，也可以用<code>image/png</code>格式表现。URI只代表资源的实体，不代表它的表现形式。严格地说，有些网址最后的<code>.html</code>后缀名是不必要的，因为这个后缀名表示格式，属于“表现层”范畴，而URI应该只代表“资源”的位置，它的具体表现形式，应该在HTTP请求的头信息中用<code>Accept</code>和<code>Content-Type</code>字段指定，这两个字段才是对“表现层”的描述。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>通过表述来操作资源</strong><ul>
<li>通过表述<code>Representation</code> 操作资源，比如传输的数据媒体类型<code>JSON</code>、<code>XML</code>等</li>
<li>客户端不能直接操作（比如<code>SQL</code>）服务端资源</li>
<li>客户端应该通过表述（比如<code>JSON</code>）来操作资源</li>
</ul>
</li>
</ol>
<ul>
<li><p>State Transfer(状态转化)： </p>
</li>
<li><p>客户端通过对资源的四种HTTP的GET、POST、PUT（或PATCH）、DELETE动词语义的增删改查操作实现这个url对应的资源状态的改变，<br>(把 HTTP 请求方式和数据库的增删改查CRUD(create/retrieve/update/delete)联系结合到一起)，</p>
</li>
<li><p>资源通过接口进行操作实现状态转移，操作本身是无状态的。因为HTTP协议本身就是一个无状态的协议，它只能通过每次发的cookie值来识别用户，但是每两次http之间的请求它们是没有任何关系的、没有先后顺序。</p>
</li>
<li><p>对资源的操作不会改变资源的标识。因为你一旦改变了资源的标识就会导致链接不可用或者资源查找不到。</p>
<p>访问一个网站，就代表了客户端和服务器的一个互动过程。在这个过程中，势必涉及到数据和状态的变化。Web应用通常使用HTTP作为其通信协议，客户端想要操作服务器，必须通过HTTP请求，让服务器端发生“状态转移”，而这种转移是建立在表现层之上的，所以就是“表现层状态转移”。</p>
</li>
<li><p>在服务器新建或更新资源-用HTTP POST请求、</p>
</li>
<li><p>从服务器获取资源-用HTTP GET请求、</p>
</li>
<li><p>从服务器获取某个资源的头部信息-用HTTP HEAD请求、</p>
</li>
<li><p>在服务器更新资源-用HTTP PUT（或PATCH）请求、</p>
</li>
<li><p>从服务器删除资源-用HTTP DELETE请求</p>
</li>
<li><p>更“精简”的方式处理返回结果设计<br>对于每一个http请求的响应结果都要指明一个状态码，具体产品由具体产品 api 文档给出。<br>比如修改一个数据的时候，只需要得到http状态码的结果，200或201表示修改成功</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"msg"</span>:<span class="string">"uri_not_found"</span>,</span><br><span class="line">    <span class="attr">"code"</span>:<span class="number">1001</span>,</span><br><span class="line">    <span class="attr">"request"</span>: <span class="string">"GET \/v2\/photo\/132"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>下面的例子给出了一些符合REST风格的URI，供大家在设计URI时参考。<br>REST API 接口实例 url用名词<br>| 请求方法（HTTP动词） | URI后缀                        | 动作解释                               |<br>| ——————– | ————————– | ————————————-|<br>| <strong>head</strong>     | <code>/student/</code>               | 获取学生，请求获取URL位置资源的响应消息报告，头部信息元数据 |<br>| <strong>GET</strong>      | <code>/students/</code>               | 获取所有学生信息列表 ，请求获取URL位置的资源  |<br>| <strong>GET</strong>      | <code>/students/ID/</code>            | 获取指定ID的学生信息                   |<br>| <strong>GET</strong>      | <code>/students/ID/friends/</code>    | 列出查看指定ID的学生的所有朋友信息（商品的所有投资者） |<br>| <strong>GET</strong>      | <code>/students/ID/friends/ID/</code>  | 列出查看指定ID的学生的所有朋友信息 商品的指定投资者信息|<br>| <strong>POST</strong>     | <code>/students/</code>               | 新建一个学生，请求向URL位置的资源后附加新的数据 |<br>| <strong>PUT</strong>      | <code>/students/ID/</code>            | 更新指定ID的学生信息（提供该学生的全部字段信息）请求向URL位置存储一个资源，覆盖原URL位置的资源|<br>| <strong>PATCH</strong>    | <code>/students/ID/</code>            | 更新指定ID的学生信息（提供该学生的部分字段信息）请求局部更新URL位置的资源，覆盖原URL位置的资源|<br>| <strong>DELETE</strong>   | <code>/students/ID/</code>            | 删除指定ID的学生信息，请求删除URL位置存储的资源 |<br>| <strong>DELETE</strong>   | <code>/students/ID/friends/ID/</code> | 删除指定ID的学生的指定ID的朋友           </p>
<ul>
<li>一般 web 框架都有相应的插件支持 RESTful API。比如Django有 rest framework，Flask和Tornado分别有flask restful 和 tornado restful。<br>现在主流的web框架都是相关的RESTful API插件。</li>
</ul>
<p>如何设计RESTful API<br>请求规范：</p>
<ul>
<li>协议：API与用户的通信协议，使用 HTTPs 协议，确保交互数据的传输安全。</li>
<li>域名：应该尽量将 API 部署在专用域名之下。i.e (<a href="https://api.example.com)[https://api.example.com]">https://api.example.com)[https://api.example.com]</a></li>
<li>版本控制：将版本号放在 URL 或者 HTTP头 Header 中 (<a target="_blank" rel="noopener" href="https://api.example.com/v1/)[https://api.example.com/v1/]">https://api.example.com/v1/)[https://api.example.com/v1/]</a></li>
<li>路径：只能包含复数名词且与数据库的表名对应，不能包括动词，因为是定位和指向资源。单⼀资源操作 books/1/</li>
<li>URI使用嵌套表示关联关系，(<a target="_blank" rel="noopener" href="https://api.example.com/v1/users/12/repos/5)[https://api.example.com/v1/users/12/repos/5]">https://api.example.com/v1/users/12/repos/5)[https://api.example.com/v1/users/12/repos/5]</a></li>
<li>请求方法，如：GET/POST/PUT/DELETE</li>
<li>不符合CRUD的情况：POST /action/子资源</li>
</ul>
<p>参数的设计允许存在冗余，即允许API路径和URL参数偶尔有重复。比如，GET <code>/zoo/ID/animals</code> 与 GET <code>/animals?zoo_id=ID</code> 的含义是相同的。</p>
<p>前端向后端传递参数的方式</p>
<ul>
<li>路径，路由中正则提取</li>
<li>查询字符串 GET获取</li>
<li>请求头 META获取</li>
<li>请求体<ul>
<li>表单数据 POST</li>
<li>body json</li>
<li>FILES</li>
</ul>
</li>
<li>根据模型类确定传递的字段 保存或更新 json</li>
<li>字段过滤 分页 查询字符串形式传递<ul>
<li><code>?limit=10</code> 指定返回记录的数量</li>
<li><code>?offset=10</code> 指定返回记录的开始位置。</li>
<li><code>?page=2&amp;per_page=100</code>：指定第几页，以及每页的记录数。</li>
<li><code>?sortby=name&amp;order=asc</code>：指定返回结果按照哪个属性排序，以及排序顺序</li>
<li><code>?animal_type_id=1</code>：指定筛选条件</li>
</ul>
</li>
<li></li>
</ul>
<p>响应设计规范<br>查询</p>
<p>状态码</p>
<p>错误处理（Error handling）<br>如果状态码是4xx，就应该向用户返回出错信息。一般来说，返回的信息中将error作为键名，出错信息作为键值即可。<br>错误异常信息，决定API的优劣程度，如果返回的错误异常信息不够标准，客户端很难处理错误。</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    'error': "Invalid API key",</span><br><span class="line">    "msg": "xxx", // 错误异常信息</span><br><span class="line">    "error_code": 1000, // 错误码</span><br><span class="line">    "request": url // 当前的http请求url路径</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>2.4.3 返回信息分类<br>业务数据信息。<br>操作成功提示信息。</p>
<ol start="3">
<li>异常处理</li>
<li>1 已知异常<br>我们可以预知的异常。 解决办法：抛出APIException。</li>
</ol>
<p>3.2 未知异常<br>我们没有意识到的异常，如何统一数据的返回格式？即json格式。</p>
<p>解决办法：在全局的某个地方捕获到所有未知异常，统一处理未知异常——AOP思想。 将未知异常分为两种：HTTPException/Exception。分别代表HTTP错误和服务器代码错误，最后都包装成APIException抛出。</p>
<ul>
<li>Hypermedia API：在返回结果中提供相关资源的url链接，连向其他 API 方法，使得用户不查文档，也知道下一步应该做什么。<br>　　比如，当用户向api.example.com的根目录发出请求，会得到这样一个文档。<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{<span class="attr">"link"</span>: { </span><br><span class="line">  <span class="attr">"rel"</span>:   <span class="string">"collection https://www.example.com/zoos"</span>,</span><br><span class="line">  <span class="attr">"href"</span>:  <span class="string">"https://api.example.com/zoos"</span>,</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"List of zoos"</span>,</span><br><span class="line">  <span class="attr">"type"</span>:  <span class="string">"application/vnd.yourformat+json"</span>}}</span><br></pre></td></tr></tbody></table></figure>
上面代码表示，文档中有一个link属性，用户读取这个属性就知道下一步该调用什么API了。rel表示这个API与当前网址的关系（collection关系，并给出该collection的网址），href表示API的路径，title表示API的标题，type表示返回类型。<br>　　Hypermedia API的设计被称为HATEOAS。Github的API就是这种设计，访问api.github.com会得到一个所有可用API的网址列表。<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"current_user_url"</span>: <span class="string">"https://api.github.com/user"</span>,</span><br><span class="line">  <span class="attr">"authorizations_url"</span>: <span class="string">"https://api.github.com/authorizations"</span>,</span><br><span class="line">  <span class="comment">// ...}</span></span><br></pre></td></tr></tbody></table></figure>
从上面可以看到，如果想获取当前用户的信息，应该去访问api.github.com/user，然后就得到了下面结果。<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"Requires authentication"</span>,</span><br><span class="line">  <span class="attr">"documentation_url"</span>: <span class="string">"https://developer.github.com/v3"</span>}</span><br></pre></td></tr></tbody></table></figure>
上面代码表示，服务器给出了提示信息，以及文档的网址。</li>
</ul>
<p>安全</p>
<ul>
<li>HTTPS</li>
<li>限流 Rate limiting</li>
<li>验证鉴权（Authentication）：确定用户是其申明的身份，比如提供账户的密码。</li>
<li>授权（Authorization）：保证用户有对请求资源特定操作的权限。比如用户的私人信息只能自己能访可，其他人无法看到；有些特殊的操作只能管理员可以操作，其他用户有只读的权限等。</li>
</ul>
<p>开发者友好</p>
<ul>
<li>文档</li>
<li>超媒体</li>
</ul>
<p>DRF通过视图集ViewSet的方式让我们对某一个数据类Model可以进行增删改查，<br>而且不同的操作对应于不同的请求方式，<br>比如查看所有books用get方法，添加一本book用post方法等，让整个后端服务是restful的。</p>
<p>前端的展示和表单，希望达到两个目标，一是能从后端请求到所有的books列表，二是能往后端添加一条book数据。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.route('', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_book</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'get book'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'create book'</span></span><br></pre></td></tr></tbody></table></figure>

<p>REST的使用场景有两个：内部开发API，开放API。</p>
<p>标准的REST 不适合内部开发，适合开放性的API。只负责提供数据，不负责业务逻辑、不关心具体的前端是什么<br>因为标准 REST 有 CURD 四种操作，不一定能够承载业务。<br>缺点</p>
<ol>
<li><p>由于内部的开发，业务逻辑非常复杂，想用简单的四个接口来标示所有的业务逻辑，基本上是不可能的，会在视图函数增加大量的参数适配复杂的逻辑</p>
</li>
<li><p>REST的接口粒度比较粗（返回的资源属性比较多；服务器不会负责处理数据），这样前端的开发是不太方便的<br>比如前端需要用户的年龄，但是 user 类下面有 name、iphone、age、email、password 等，查询返回的就是整个 user 的信息，需要前端而不是服务器再进行筛选！</p>
</li>
<li><p>标准的REST 不考虑业务逻辑，一个接口只返回一个资源，当需要返回多个有关联资源时，无法一次性全部返回，只能发送多个请求依次取得数据，造成 HTTP 请求的数量大幅增加。</p>
</li>
</ol>
<ul>
<li>尽量遵从REST的设计风格规范，同时也不要死板追求 REST 要求，要灵活一些，</li>
<li>如果前端需要接口考虑业务逻辑的话，那么我们的接口就不要完全遵守资源的限制，应该让API具有业务逻辑的性质</li>
<li>如果前端需要几个资源合并在一起的数据，那么我们就为前端定制一个合并数据的接口，一次性把数据全部返回到前端</li>
</ul>
<ol start="4">
<li>Token<br>用户有效身份的凭据。</li>
</ol>
<p>4.1 三个特征<br>有效期，一般为2小时。<br>标识用户的身份，存储用户ID号。<br>Token是加密的。<br>4.2 Token有什么用<br>4.2.1 保护接口（auth拦截器）<br>只有登录的用户，才可访问某些接口，而是否可访问的校验通过Token实现。 访问接口时若令牌没有过期，而且合法，那么可以通过接口进行正确操作。</p>
<p>4.3 Token如何使用<br>可自定义传入账号和密码，但HTTP协议本身就规定了一种传递账号和密码的方法。 将账号和密码放入header中发送：<br>key=Authorization<br>value=basic base64(account:password)<br>将Token当作account发送，password不传任何数据。<br>4.4 验证Token的代码应该写在什么地方？<br>利用装饰器，哪个接口需要Token验证，就在哪个接口上方加入装饰器。</p>
<p>关于用户的思考<br>不管是网站也好，还是API也好，我们都逃脱不了用户这个概念，我们下面就要来讨论用户的相关操作。</p>
<p>对于用户而言，第一件事情，我们就要完成用户注册的操作，说到注册用户，我们想到，可以在视图函数文件中增加一个注册用户的视图函数–create_user，并且我们会在其中接受账号和密码，来完成用户的注册，这个逻辑是通常意义上的用户的概念。</p>
<p>普通用户：使用鱼书的人相对于鱼书来说，就是用户；我们相对于QQ和微信，也是他的用户。</p>
<p>但是我们在做API的时候，不能只考虑这些普通意义的用户，我们还要考虑一些特别的用户。例如：我们开发了一个向外提供数据的API，假如有一天，有一个公司，想使用我们的API开发他们自己的产品（小程序或者APP），这些其他的客户端，都是我们API的用户。</p>
<p>根据以上的分析，我们可以得出几个结论：<br>对于API而言，再叫做用户就不太合适 ，我们更倾向于把人，第三方的产品等同于成为客户端（client）来代替User。</p>
<p>客户端的种类非常多，注册的形式就非常多。如对于普通的用户而言，就是账号和密码，但是账号和密码又可以分成，短信，邮件，社交用户。对于多种的注册形式，也不是所有的都需要密码，如小程序就不需要。<br>API和普通的业务系统是不一样的，他具有开放性和通用性。</p>
<p>因为注册的形式就非常多，所以我们不可能用万能的方式来解决。如果我们不能很好的处理多种多样的形式，我们的代码就会非常的杂乱。</p>
<p>http method 决定了操作，http path 决定了操作对象</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/selenium/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/selenium/" class="post-title-link" itemprop="url">selenium</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-07 13:55:02" itemprop="dateModified" datetime="2021-05-07T13:55:02Z">2021-05-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一个浏览器自动化测试的框架，可以通过 Python 代码来控制浏览器完成相关的测试，同时也能辅助完成数据的爬取。利用它我们可以驱动浏览器执行特定的动作，如点击、下拉等操作。对于一些JavaScript渲染的页面来说，这种抓取方式非常有效。</p>
<ul>
<li>开源免费</li>
<li>使用灵活、简单</li>
<li>后期用例易于维护</li>
<li>支持多种语言</li>
<li>容易与单元测试框架结合</li>
<li>可支持多浏览器同时，支持远程启动其他服务器</li>
<li>高度复用性</li>
<li>代码可自主掌控，对于搭建框架、平台等有不可替代的优势</li>
</ul>
<p>安装chrome浏览器驱动<br>为什么需要浏览器驱动呢？这还得从selenium的原理开始讲：</p>
<p>​    当Selenium提出了WebDriver的概念之后，它提供了利用浏览器原生的接口，封装成一套更加面向对象的Selenium WebDriver API，直接操作浏览器页面里的元素，甚至操作浏览器本身（截屏，窗口大小，启动，关闭，安装插件）。</p>
<p>​     由于使用的是浏览器原生的接口，速度大大提高，而且调用的稳定性交给了浏览器厂商本身，显然是更加科学。然而带来的一些副作用就是，不同的浏览器厂商，对Web元素的操作和呈现多少会有一些差异，这就直接导致了Selenium  WebDriver要分浏览器厂商不同，而提供不同的实现。例如Firefox就有专门的geckoDriver驱动，Chrome就有专门的Chrome驱动等。</p>
<p>这里特别要注意：chrome浏览器驱动必须和安装的chrome浏览器版本对应。那么如何保证对应呢？</p>
<p>1.先检查chrome浏览器的版本：点击chrome浏览器右上角的三个点–&gt;帮助–&gt;关于Google Chrome，如下图所示：</p>
<p><img src="https://img-blog.csdnimg.cn/20200404072628618.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlbmdqaWFuZ2NodW4=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>2.chrome浏览器驱动下载地址：</p>
<p>Chromedriver驱动下载地址：<a target="_blank" rel="noopener" href="http://npm.taobao.org/mirrors/chromedriver/">http://npm.taobao.org/mirrors/chromedriver/</a></p>
<p>找到和上图chrome版本最接近的版本：上图为：78.0.3904.108，所以这里驱动选择：</p>
<p><img src="https://img-blog.csdnimg.cn/20200404073158790.png" alt="img"></p>
<p>下载完成后：把chrome驱动包放入：C:\python37 目录下 （这个是必须的）</p>
<p>Edge驱动 <a target="_blank" rel="noopener" href="https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/">https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/</a></p>
<ul>
<li>火狐 驱动<ul>
<li>下载firefox浏览器驱动 Mozilla GeckoDriver<br> （ 官网 <a target="_blank" rel="noopener" href="https://github.com/mozilla/geckodriver/releases/tag/v0.23.0%EF%BC%89">https://github.com/mozilla/geckodriver/releases/tag/v0.23.0）</a></li>
</ul>
</li>
</ul>
<p><img src="/2020/08/21/selenium/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200814235134327.png" alt="image-20200814235134327"></p>
<p><a target="_blank" rel="noopener" href="https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/">https://developer.microsoft.com/zh-cn/microsoft-edge/tools/webdriver/</a></p>
<p>python只能启动浏览器稳定版本，不能启动canary，除非改edge的软链接？</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># driver = 'C:\\Users\\rose\\Downloads\\Compressed\\chromedriver.exe'</span></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\edgedriver_win64\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver=webdriver.Edge(driver_path)  <span class="comment"># 创建chrome驱动</span></span><br><span class="line">driver.get(<span class="string">"https://www.baidu.com"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>（3）将驱动移动到python安装目录 C:\Users\rose\AppData\Local\Programs\Python\Python38\</p>
<p>（4）重启 IDEA，记得一定要</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># driver = 'C:\\Users\\rose\\Downloads\\Compressed\\chromedriver.exe'</span></span><br><span class="line"><span class="comment"># driver_path = 'C:\\Users\\rose\\Downloads\\edgedriver_win64\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge()  <span class="comment"># 创建Edge浏览器驱动</span></span><br><span class="line">driver = webdriver.Firefox()    <span class="comment"># Firefox浏览器</span></span><br><span class="line">driver = webdriver.Chrome()     <span class="comment"># Chrome浏览器</span></span><br><span class="line">driver = webdriver.Ie()         <span class="comment"># Ie浏览器</span></span><br><span class="line">driver = webdriver.PhantomJS()  <span class="comment"># PhantomJS()</span></span><br><span class="line">driver.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"></span><br><span class="line">deiver.quit()  <span class="comment"># 关闭当前的浏览器窗口，退出webdriver释放资源</span></span><br><span class="line">deiver.close()  <span class="comment"># 关闭当前的浏览器窗口，关闭之后还想开 </span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>deiver.quit()</code> 关闭当前的浏览器窗口，退出webdriver释放资源</li>
<li><code>deiver.close()</code> 关闭当前的浏览器窗口，关闭之后还想开</li>
</ul>
<p><code>EC.title_contains</code>/<code>EC.title_is</code><br>这两个方法都是用来判断title的，区别是：<br><code>EC.title_contains</code>只要包含即可<br><code>EC.title_is</code>必须完全匹配</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># title中包含即可</span></span><br><span class="line">print(EC.title_contains(<span class="string">"百度"</span>)(driver))  <span class="comment"># True</span></span><br><span class="line">print(EC.title_contains(<span class="string">"必应"</span>)(driver))  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># title完全匹配</span></span><br><span class="line">print(EC.title_is(<span class="string">"百度一下"</span>)(driver))  <span class="comment"># False</span></span><br><span class="line">print(EC.title_is(<span class="string">"百度一下，你就知道"</span>)(driver))  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="控制浏览器操作"><a href="#控制浏览器操作" class="headerlink" title="控制浏览器操作"></a>控制浏览器操作</h3><ul>
<li><code>set_window_size()</code> 来设置浏览器窗口的大小 </li>
<li><code>maximize_window()</code> 使打开的浏览器全屏显示。</li>
<li><code>back()</code> 和 <code>forward()</code> 来模拟控制浏览器后退、前进按钮。</li>
<li><code>refresh()</code> 刷新页面 F5</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.get(<span class="string">"https://www.imooc.com"</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.back()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.forward()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">driver.refresh()</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'browser will be closed'</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<p><strong>2.Selenium元素定位</strong><br>HTML浏览器的开发者模式选择元素复制对应元素属性值</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">link</span>=<span class="string">"#0000cc"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"result_logo"</span> <span class="attr">href</span>=<span class="string">"/"</span> <span class="attr">onmousedown</span>=<span class="string">"return c({'fm':'tab','tab':'logo'})"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form"</span> <span class="attr">class</span>=<span class="string">"fm"</span> <span class="attr">name</span>=<span class="string">"f"</span> <span class="attr">action</span>=<span class="string">"/s"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"soutu-btn"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"kw"</span> <span class="attr">class</span>=<span class="string">"s_ipt"</span> <span class="attr">name</span>=<span class="string">"wd"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">maxlength</span>=<span class="string">"255"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p> Message: element not interactable</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 id 定位</span></span><br><span class="line">dr.find_element_by_id(<span class="string">"kw"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过name定位:</span></span><br><span class="line">dr.find_element_by_name(<span class="string">"wd"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 class_name定位:</span></span><br><span class="line">dr.find_element_by_class_name(<span class="string">"s_ipt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 tag_name 标签名定位:</span></span><br><span class="line">dr.find_element_by_tag_name(<span class="string">"input"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 xpath 定位的几种写法</span></span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//*[@id='kw']"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//*[@name='wd']"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//input[@class='s_ipt']"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"/html/body/form/span/input"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//span[@class='soutu-btn']/input"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//form[@id='form']/span/input"</span>)</span><br><span class="line">dr.find_element_by_xpath(<span class="string">"//input[@id='kw' and @name='wd']"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 css 定位的几种写法</span></span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"#kw"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"[name=wd]"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">".s_ipt"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"html &gt; body &gt; form &gt; span &gt; input"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"span.soutu-btn&gt; input#kw"</span>)</span><br><span class="line">dr.find_element_by_css_selector(<span class="string">"form#form &gt; span &gt; input"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 link_text / partial_link_text 定位</span></span><br><span class="line">dr.find_element_by_link_text(<span class="string">"新闻"</span>)</span><br><span class="line">dr.find_element_by_link_text(<span class="string">"hao123"</span>)</span><br><span class="line">dr.find_element_by_partial_link_text(<span class="string">"新"</span>)</span><br><span class="line">dr.find_element_by_partial_link_text(<span class="string">"hao"</span>)</span><br><span class="line">dr.find_element_by_partial_link_text(<span class="string">"123"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是定位一组元素，用下面</span></span><br><span class="line">find_elements_by_id()</span><br><span class="line">find_elements_by_name()</span><br><span class="line">find_elements_by_class_name()</span><br><span class="line">find_elements_by_tag_name()</span><br><span class="line">find_elements_by_link_text()</span><br><span class="line">find_elements_by_partial_link_text()</span><br><span class="line">find_elements_by_xpath()</span><br><span class="line">find_elements_by_css_selector()</span><br></pre></td></tr></tbody></table></figure>

<hr>
<p><code>form.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">title</span>&gt;</span>Form<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">async</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bootstrap-combined.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">h3</span>&gt;</span>simple login form<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputEmail"</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"inputEmail"</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span> <span class="attr">name</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputPassword"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"inputPassword"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> Remember me</span><br><span class="line">           <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(<span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/form.html"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># by id</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'inputEmail'</span>).click()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by name</span></span><br><span class="line">driver.find_element_by_name(<span class="string">'password'</span>).click()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by tagname</span></span><br><span class="line">print(driver.find_element_by_tag_name(<span class="string">'form'</span>).get_attribute(<span class="string">'class'</span>))  <span class="comment"># form-horizontal</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by classname</span></span><br><span class="line">el = driver.find_element_by_class_name(<span class="string">'controls'</span>)</span><br><span class="line">driver.```<span class="string">'$(arguments[0]).fadeOut().fadeIn()'</span>,el)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#by linktext</span></span><br><span class="line">link = driver.find_element_by_link_text(<span class="string">'register'</span>)</span><br><span class="line">driver.```<span class="string">'$(arguments[0]).fadeOut().fadeIn()'</span>,link)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">partial = driver.find_element_by_partial_link_text(<span class="string">'reg'</span>)</span><br><span class="line">driver.```<span class="string">'$(arguments[0]).fadeOut().fadeIn()'</span>,partial)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># by css selector</span></span><br><span class="line"><span class="comment"># div = driver.find_element_by_css_selector('body &gt; form &gt; div:nth-child(1) &gt; div')</span></span><br><span class="line"><span class="comment"># driver.execute_script('$(arguments[0]).fadeOut().fadeIn()',div)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#by xpath</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">'//*[@id="inputEmail"]'</span>).click()</span><br><span class="line">driver.find_element_by_xpath(<span class="string">'//*[name="email"]'</span>).click()</span><br><span class="line"><span class="comment"># driver.find_element_by_xpath("/html/body/form/div[3]/div/button").click()</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">定位一组同类型元素批量操作</span><br><span class="line">```py</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">driver_path = 'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/checkbox.html")</span><br><span class="line"># 所有的checkbox 并勾选</span><br><span class="line"></span><br><span class="line"># css_selector定位</span><br><span class="line"># checkboxes = driver.find_elements_by_css_selector('input[type=checkbox]')</span><br><span class="line"># for chk in checkboxes:</span><br><span class="line">#     chk.click()</span><br><span class="line"></span><br><span class="line"># tag定位</span><br><span class="line">inputs = driver.find_elements_by_tag_name('input')</span><br><span class="line">for input in inputs:</span><br><span class="line">    if input.get_attribute('type') == 'checkbox':</span><br><span class="line">        input.click()</span><br><span class="line">        sleep(1)</span><br><span class="line">sleep(1)</span><br><span class="line"></span><br><span class="line"># 最后一个取消勾选</span><br><span class="line">driver.find_elements_by_css_selector('input[type=checkbox]').pop().click()</span><br><span class="line">sleep(1)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<h4 id="元素简单操作"><a href="#元素简单操作" class="headerlink" title="元素简单操作"></a>元素简单操作</h4><ul>
<li><code>.click()</code> 点击、</li>
<li><code>.clear()</code> 清除</li>
<li><code>el.send_keys('hello')</code> 输入</li>
<li><code>submit()</code> 方法用于提交表单，在搜索框后输入关键字后，可用于“回车”模拟。</li>
<li><code>size</code>： 返回元素的尺寸。</li>
<li><code>text</code>： 获取元素的文本。</li>
<li><code>get_attribute(name)</code>： 获得属性值。</li>
<li><code>is_displayed()</code>： 设置该元素是否用户可见。</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line">browser.get(base_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 其他常用方法</span></span><br><span class="line">size = browser.find_element_by_id(<span class="string">'kw'</span>).size</span><br><span class="line">print(<span class="string">"返回元素的尺寸：%s"</span> % size)</span><br><span class="line"></span><br><span class="line">text = browser.find_element_by_id(<span class="string">'cp'</span>).text</span><br><span class="line">print(<span class="string">"返回元素的文本：%s"</span> % text)</span><br><span class="line"></span><br><span class="line">attribute = browser.find_element_by_id(<span class="string">'kw'</span>).get_attribute(<span class="string">'type'</span>)</span><br><span class="line">print(<span class="string">"返回元素的属性：%s"</span> % attribute)</span><br><span class="line"></span><br><span class="line">result = browser.find_element_by_id(<span class="string">'kw'</span>).is_displayed()</span><br><span class="line">print(<span class="string">"返回元素是否可见：%s"</span> % result)</span><br><span class="line"></span><br><span class="line">browser.quit()</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/form.html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">el = driver.find_element_by_xpath(<span class="string">"//*[@id='inputEmail']"</span>)</span><br><span class="line">el.send_keys(<span class="string">'jackson'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.clear()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='inputPassword']"</span>).send_keys(<span class="string">'123456'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"/html/body/form/div[3]/div/button"</span>).click()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><strong>1.鼠标事件</strong></p>
<p>在webdriver中，鼠标操作的方法封装在 <code>ActionChains</code> 类提供。<code>ActionChains</code> 类提供了鼠标操作的常用方法：</p>
<blockquote>
<p>ActionChains(driver)，将浏览器驱动 driver 作为参数传入。</p>
<p>(1) <code>perform()</code>: 执行所有 ActionChains 中存储的行为，是对整个操作的提交动作；</p>
<p>(2) <code>context_click()</code>: 右击</p>
<p>(3) <code>double_click()</code>: 双击</p>
<p>(4) <code>drag_and_drop()</code>: 拖动</p>
<p>(5) <code>move_to_element()</code>: 鼠标悬停， 在调用时需要指定元素定位</p>
</blockquote>
<p>Action<br>key_down 模拟按键按下<br>key_up<br>click<br>send_keys<br>click_and_hold<br>release<br>move_to</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/sendkeys.html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">double_click_el = driver.find_element_by_id(<span class="string">'A'</span>)</span><br><span class="line">ActionChains(driver).double_click(double_click_el).context_click(</span><br><span class="line">    double_click_el).perform()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p>键盘事件<br> 前面的 send_keys() 方法用来模拟键盘输入；keys() 类提供了键盘上几乎所有按键的方法，组合键也是可以的。</p>
<p>常用的键盘操作如下：</p>
<blockquote>
<p>send_keys(Keys.BACK_SPACE) 删除键（BackSpace）<br>send_keys(Keys.SPACE) 空格键(Space)<br>send_keys(Keys.TAB) 制表键(Tab)<br>send_keys(Keys.ESCAPE) 回退键（Esc）<br>send_keys(Keys.ENTER) 回车键（Enter）<br>send_keys(Keys.CONTROL,’a’) 全选（Ctrl+A）<br>send_keys(Keys.CONTROL,’c’) 复制（Ctrl+C）<br>send_keys(Keys.CONTROL,’x’) 剪切（Ctrl+X）<br>send_keys(Keys.CONTROL,’v’) 粘贴（Ctrl+V）<br>send_keys(Keys.F1) 键盘 F1<br>……<br>send_keys(Keys.F12) 键盘 F12</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line">driver.get(base_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 先输入百度</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(<span class="string">'百度'</span>)</span><br><span class="line"><span class="comment"># 1.删除度</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.BACK_SPACE)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.键入空格</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.SPACE)</span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(<span class="string">'加入空格'</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ctrl+a 全选输入框里的内容</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.CONTROL, <span class="string">'a'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ctrl+x 剪切输入框里的内容</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.CONTROL, <span class="string">'x'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. ctrl+v 粘贴剪切的内容</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(Keys.CONTROL, <span class="string">'v'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 回车</span></span><br><span class="line">driver.find_element_by_id(<span class="string">'su'</span>).send_keys(Keys.ENTER)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/sendkeys.html"</span></span><br><span class="line">)</span><br><span class="line">driver.find_element_by_id(<span class="string">'A'</span>).send_keys((Keys.CONTROL, <span class="string">'a'</span>))</span><br><span class="line">driver.find_element_by_id(<span class="string">'A'</span>).send_keys((Keys.CONTROL, <span class="string">'x'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'B'</span>).send_keys((Keys.CONTROL, <span class="string">'v'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'B'</span>).send_keys((Keys.CONTROL, <span class="string">'a'</span>))</span><br><span class="line">driver.find_element_by_id(<span class="string">'B'</span>).send_keys((Keys.CONTROL, <span class="string">'c'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'A'</span>).send_keys((Keys.CONTROL, <span class="string">'v'</span>))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>






<p><strong>Selenium之-警告框处理</strong></p>
<p>在 webdriver 中处理 JavaScript 所生成的 alert、confirm 以及 prompt 十分简单，<br>具体做法是使用  switch_to.alert 方法定位到 alert/confirm/prompt，然后使用 text/accept/dismiss/  send_keys 等方法进行操作。<br>弹出框处理</p>
<blockquote>
<p><code>text</code>：返回 alert/confirm/prompt 中的文字信息。<br><code>accept()</code>：接受现有警告框。<br><code>dismiss()</code>：无视现有警告框。<br><code>send_keys(keysToSend)</code>：发送文本至prompt警告框。keysToSend：将文本发送至警告框。原生的js，不会在python终端显示</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">driver.get(base_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 鼠标悬停至 “设置” 链接</span></span><br><span class="line">link = driver.find_element_by_link_text(<span class="string">'设置'</span>)</span><br><span class="line">ActionChains(driver).move_to_element(link).perform()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开搜索设置</span></span><br><span class="line">driver.find_element_by_link_text(<span class="string">'搜索设置'</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击 “搜索设置”</span></span><br><span class="line">driver.find_element_by_class_name(<span class="string">'prefpanelgo'</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接受警告框prefpanelgo</span></span><br><span class="line">driver.switch_to.alert.accept()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><code>alert.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>attribute<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">async</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"D:/Besttest/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>alert<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row-fluid"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"span6"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"tooltip"</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">data-toggle</span>=<span class="string">"tooltip"</span> <span class="attr">title</span>=<span class="string">"selenium-webdriver"</span> <span class="attr">onclick</span>=<span class="string">"alert(this.title);"</span>&gt;</span>hover to see tooltip<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(<span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/alert.html"</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'tooltip'</span>).click()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">alert = driver.switch_to.alert</span><br><span class="line">print(alert.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">alert.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<p><code>confirm.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>confirm<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">???????????????</span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"JavaScript"</span>&gt;</span></span><br><span class="line">            </span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(confirm(<span class="string">"are you ready?"</span>)){</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">"Go!"</span>);</span></span><br><span class="line">            }</span><br><span class="line"><span class="javascript">            <span class="keyword">else</span>{</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">"Hold on!"</span>);</span></span><br><span class="line">            }</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/confirm.html"</span></span><br><span class="line">)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">confirm = driver.switch_to.alert</span><br><span class="line">print(confirm.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">confirm.dismiss()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">print(confirm.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">confirm.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 法一</span></span><br><span class="line"><span class="comment"># alert = driver.switch_to.alert</span></span><br><span class="line"><span class="comment"># print(alert.text)</span></span><br><span class="line"><span class="comment"># sleep(2)</span></span><br><span class="line"><span class="comment"># alert.accept()</span></span><br><span class="line"><span class="comment"># sleep(2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line">print(confirm.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">confirm.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<p><code>prompt.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">'JavaScript'</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> aa= prompt(<span class="string">"What's your name?"</span>,<span class="string">"haha"</span>);</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.write(<span class="string">"Welcome to my world, "</span>+aa+<span class="string">"&lt;br&gt;"</span>)</span></span><br><span class="line">/*</span><br><span class="line"><span class="javascript"><span class="keyword">if</span>(confirm(<span class="string">"准备好了吗？？"</span>)){</span></span><br><span class="line"><span class="javascript">  alert(<span class="string">"那就开始吧！！"</span>);</span></span><br><span class="line">}</span><br><span class="line"><span class="javascript"><span class="keyword">else</span>{</span></span><br><span class="line"><span class="javascript">  alert(<span class="string">"再等一下"</span>);</span></span><br><span class="line">}</span><br><span class="line">*/</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)/prompt.html"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">prompt = driver.switch_to.alert</span><br><span class="line">print(prompt.text)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">prompt.send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">prompt.accept()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><br>Selenium 场景警告场景学习<br>在页面操作过程中有时候点击某个链接会弹出新的窗口，这时就需要主机切换到新打开的窗口上进行多页面切换</p>
<blockquote>
<p><code>current_window_handle</code>：获得当前窗口句柄<br><code>window_handles</code>：返回所有窗口的句柄到当前会话<br><code>switch_to.window()</code>：用于切换到相应的窗口</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome(<span class="string">'../tools/chromedriver.exe'</span>)</span><br><span class="line"><span class="comment"># 隐式等待10秒</span></span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">browser.get(base_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得搜索窗口的句柄</span></span><br><span class="line">search_windows = browser.current_window_handle</span><br><span class="line">browser.find_element_by_link_text(<span class="string">'登录'</span>).click()</span><br><span class="line">browser.find_element_by_link_text(<span class="string">'立即注册'</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得当前打开窗口的句柄</span></span><br><span class="line">all_handles = browser.window_handles</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入注册窗口</span></span><br><span class="line"><span class="keyword">for</span> handle <span class="keyword">in</span> all_handles:</span><br><span class="line">    <span class="keyword">if</span> handle != search_windows:</span><br><span class="line">        browser.switch_to.window(handle)</span><br><span class="line">        print(<span class="string">'now register window!'</span>)</span><br><span class="line">        browser.find_element_by_name(<span class="string">'account'</span>).send_keys(<span class="string">'username'</span>)</span><br><span class="line">        browser.find_element_by_name(<span class="string">'password'</span>).send_keys(<span class="string">'password'</span>)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">browser.quit()</span><br></pre></td></tr></tbody></table></figure>


<p><code>multi.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">title</span>&gt;</span>Form<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">async</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"bootstrap-combined.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">h3</span>&gt;</span>simple login form<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputEmail"</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"inputEmail"</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span> <span class="attr">name</span>=<span class="string">"email"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"control-label"</span> <span class="attr">for</span>=<span class="string">"inputPassword"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"inputPassword"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span> Remember me</span><br><span class="line">           <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.baidu.com"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">driver_path = <span class="string">'C:\\Users\\rose\\Downloads\\msedgedriver.exe'</span></span><br><span class="line">driver = webdriver.Edge(driver_path)</span><br><span class="line">driver.maximize_window()</span><br><span class="line">driver.get(</span><br><span class="line">    <span class="string">r"file:/C:\python代码\步骤4 Flask基础及项目实战\第31周 实战测试慕旅游网：Web自动化测试\web自动化\WEBAUTO(测试网页)//multi.html"</span></span><br><span class="line">)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">first_window = driver.current_window_handle  <span class="comment"># 将首页句柄暂存</span></span><br><span class="line">driver.find_element_by_link_text(<span class="string">'register'</span>).click()</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">all_window = driver.window_handles  <span class="comment"># 获取所有句柄</span></span><br><span class="line"><span class="keyword">for</span> handle <span class="keyword">in</span> all_window:</span><br><span class="line">    <span class="keyword">if</span> handle != first_window:  <span class="comment"># 遍历找到不等于首页的</span></span><br><span class="line">        driver.switch_to.window(handle)</span><br><span class="line">        print(<span class="string">'jumping!!'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'kw'</span>).send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">'su'</span>).click()</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">driver.switch_to.window(first_window)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">el = driver.find_element_by_xpath(<span class="string">"//*[@id='inputEmail']"</span>)</span><br><span class="line">el.send_keys(<span class="string">'jackson'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.clear()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">el.send_keys(<span class="string">'fengluo'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='inputPassword']"</span>).send_keys(<span class="string">'123456'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">"/html/body/form/div[3]/div/button"</span>).click()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># driver.quit()</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/unittest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/unittest/" class="post-title-link" itemprop="url">unittest</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 09:21:50" itemprop="dateModified" datetime="2021-05-01T09:21:50Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>unittest基于Java的流行测试框架Junit，<br>unittest特点</p>
<ul>
<li>python自带的单元测试框架，无需安装</li>
<li>用例执行互不干扰 互不影响</li>
<li>丰富的比较方法： 不论是功能测试， 还是单元测试， 在用例执行完成之后都需要将实际结果与进行 预期结果的进行比较（断言） ， 从而断定用例是否执行通过。 所以， 作为单元测试框架一般也会提供丰富的 断言方法。 例如， 判断相等/不等、 包含/不包含、 Trure/False 的断言方法等。</li>
<li> 提供灵活用例组织与执行： 当你的测试用例只有几条时， 可以不必考虑用例的组织， 但是， 当测试用例达到 成百上千条时， 大量的测试用例堆砌在一起， 就产生了扩展性与维护性等问题， 需要考虑用例的规范与组织 问题了。 单元测试框架以结构化的方式编写大型而且周详的测试集就是用来解决这个问题的。</li>
</ul>
<p>- 提供丰富的日志： 当测试用例执行失败时能抛出清晰的失败原因， 当所有用例执行完成后能提供丰富的 执行情况结果信息。 例如， 总执行时间、 失败用例数、 成功用例数等。<br>- 单元测试框架可以帮助我们完成任何级别测试的自动化。<br>- 单元测试： unittest 单元测试框架不单单只适用于程序单元级别的测试。<br>- HTTP 接口自动化测试： unittest + Requests<br>- Web UI 自动化测试： unittest + Selenium<br>- 移动自动化测试： unittest + Appium</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">help(<span class="string">'unittest'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Help <span class="keyword">on</span> <span class="title">package</span> <span class="title">unittest</span>:</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    unittest</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">    Python unit testing framework, based <span class="keyword">on</span> <span class="title">Erich</span> <span class="title">Gamma</span><span class="string">'s JUnit and Kent Beck'</span><span class="title">s</span></span><br><span class="line">    Smalltalk testing framework (used <span class="keyword">with</span> permission).</span><br><span class="line"></span><br><span class="line">    This module <span class="keyword">contains</span> <span class="keyword">the</span> core framework classes that form <span class="keyword">the</span> basis <span class="keyword">of</span>   </span><br><span class="line">    specific test cases <span class="keyword">and</span> suites (TestCase, TestSuite etc.), <span class="keyword">and</span> also <span class="keyword">a</span>    </span><br><span class="line">    <span class="keyword">text</span>-based utility class <span class="keyword">for</span> running <span class="keyword">the</span> tests <span class="keyword">and</span> reporting <span class="keyword">the</span> results </span><br><span class="line">     (TextTestRunner).</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir(unittest)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[‘BaseTestSuite’, ‘FunctionTestCase’, ‘SkipTest’, ‘TestCase’, ‘TestLoader’, ‘TestProgram’, ‘TestResult’, ‘TestSuite’, ‘TextTestResult’, ‘TextTestRunner’, ‘_TextTestResult’, ‘all’, ‘builtins’, ‘doc’, ‘file’, ‘name’, ‘package’, ‘path’, ‘__unittest’, ‘_expectedFailureInRpmBuild’, ‘_skipInRpmBuild’, ‘case’, ‘defaultTestLoader’, ‘expectedFailure’, ‘findTestCases’, ‘getTestCaseNames’, ‘installHandler’, ‘loader’, ‘main’, ‘makeSuite’, ‘registerResult’, ‘removeHandler’, ‘removeResult’, ‘result’, ‘runner’, ‘signals’, ‘skip’, ‘skipIf’, ‘skipUnless’, ‘suite’, ‘util’]</span><br></pre></td></tr></tbody></table></figure>


<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>断言函数需要通过测试类的 <code>self</code> 调用</p>
<p>判断相等</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="number">1</span>, <span class="number">2</span> / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIs(<span class="number">1</span>, <span class="number">2</span> / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight subunit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Failure</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "C:\python代码\牛客网剑指offer66题思路分析\代码\1.py", line 8, in test_equals</span><br><span class="line">    self.assertIs(1, 2 / 2)</span><br><span class="line">AssertionError: 1 is not 1.0</span><br><span class="line"></span><br><span class="line">Failure</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "C:\python代码\牛客网剑指offer66题思路分析\代码\1.py", line 8, in test_equals</span><br><span class="line">    self.assertIs(1, 2 / 2)  # 是否是同一个对象</span><br><span class="line">AssertionError: 1 is not 1.0</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertListEqual([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_equals (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/牛客网剑指offer66题思路分析/代码/1.py", line 10, in test_</span>equals</span><br><span class="line"><span class="code">    self.assertListEqual([1, 2], [2, 1])</span></span><br><span class="line">AssertionError: Lists differ: [1, 2] != [2, 1]</span><br><span class="line"></span><br><span class="line">First differing element 0:</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>[1, 2]</span><br><span class="line">+ [2, 1]</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断相等</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_equals</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertDictEqual({<span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"b"</span>: <span class="number">2</span>}, {<span class="string">"b"</span>: <span class="number">2</span>, <span class="string">"a"</span>: <span class="number">1</span>})</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsNone({})</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_empty (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 15, in test_</span>empty</span><br><span class="line"><span class="code">    self.assertIsNone({})</span></span><br><span class="line">AssertionError: {} is not None</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsNone(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_empty (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 16, in test_</span>empty</span><br><span class="line"><span class="code">    self.assertIsNone("")</span></span><br><span class="line">AssertionError: '' is not None</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsNone(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断真假</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_istrue</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 判断真假</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_istrue</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertFalse(<span class="number">1</span>==<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 是否包含</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isin</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIn(<span class="string">"ha"</span>,<span class="string">"hello"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_isin (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 27, in test_</span>isin</span><br><span class="line"><span class="code">    self.assertIn("ha","hello")</span></span><br><span class="line">AssertionError: <span class="emphasis">'ha'</span> not found in <span class="emphasis">'hello'</span></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 是否包含</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isin</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertNotIn(<span class="string">"ha"</span>,<span class="string">"hello"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>




<p>一个方法只执行第一个断言Fail就停止执行了</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 大小判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_greater</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertGreater(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_greater (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "C:/python代码/步骤4 Flask基础及项目实战/第30周   实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 32, in test_</span>greater</span><br><span class="line"><span class="code">    self.assertGreater(2, 2)</span></span><br><span class="line">AssertionError: 2 not greater than 2</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 大小判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_greater</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertGreaterEqual(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_greater (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 34, in test_</span>greater</span><br><span class="line"><span class="code">    self.assertGreaterEqual(1, 2)</span></span><br><span class="line">AssertionError: 1 not greater than or equal to 2        </span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.000s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 类型判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_type</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIsInstance({<span class="string">"a"</span>: <span class="number">1</span>}, list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test<span class="emphasis">_type (_</span><span class="emphasis">_main_</span><span class="emphasis">_.MyTestCase)</span></span><br><span class="line"><span class="emphasis">----------------------------------------------------------------------</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/python代码/步骤4 Flask基础及项目实战/第30周  </span></span><br><span class="line"><span class="emphasis"> 实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战</span></span><br><span class="line"><span class="emphasis">接口自动化测试/接口测试/apitest/test_</span>verify<span class="emphasis">_demo.py", line 40, in test_</span>type</span><br><span class="line"><span class="code">    self.assertIsInstance({"a": 1}, list)</span></span><br><span class="line">AssertionError: {<span class="emphasis">'a'</span>: 1} is not an instance of &lt;class <span class="emphasis">'list'</span>&gt;</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStringMethods</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_upper</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="string">'foo'</span>.upper(), <span class="string">'FOO'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_isupper</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(<span class="string">'FOO'</span>.isupper())</span><br><span class="line">        self.assertFalse(<span class="string">'Foo'</span>.isupper())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_split</span>(<span class="params">self</span>):</span></span><br><span class="line">        s = <span class="string">'hello world'</span></span><br><span class="line">        self.assertEqual(s.split(), [<span class="string">'hello'</span>, <span class="string">'world'</span>])</span><br><span class="line">        <span class="comment"># check that s.split fails when the separator is not a string</span></span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(TypeError):</span><br><span class="line">            s.split(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 3 tests in 0.001s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></tbody></table></figure>

<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><ul>
<li><p>TestCase 测试用例对象，编写测试用例时所有测试用例类继承的基本类。测试行为的最小单位，通过对一些输入输出值的对比来进行测试检查。放置测试步骤和检查点</p>
</li>
<li><p>Test Fixtures(用例包裹方法): 用来在多个用例之间分享的预置条件操作和清理操作，说白了就是setup和teardown的集合。用例的组织及运行<br>按不同作用划分三种fixture类型</p>
<ul>
<li><p><code>setUp()</code>, <code>tearDown()</code> 分别在测试类的每一个测试用例执行的开始和结束执行。setUp() 方法用于测试用例执行前的初始化工作， 例如初始化变量、 生成数据库测试数据、 打开浏览器等。 用于测试用例执行之后的善后工作， 例如清除数据库测试数据、 关闭文件、 关闭 浏览器等。</p>
</li>
<li><p><code>setUpClass</code>, <code>tearDownClass</code> 每个测试类的第一个用例被执行前和最后一个用例执行后被执行， </p>
</li>
<li><p><code>setUpModule</code>, <code>tearDownModule</code>每个测试模块（python文件）的执行前和执行后被执行</p>
</li>
</ul>
</li>
</ul>
<p>出现异常</p>
<ul>
<li>如果setup和teardown间的用例出现异常或者失败，teardown照样会被执行</li>
<li>如果setUpClass和setUpModule中出现异常，那么他们控制范围内的用例不会被执行，<br>并且对应的tearDownClass和tearDownModule也不会被执行<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setUpModule</span>():</span></span><br><span class="line">    print(<span class="string">"setUpModule &gt;&gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tearDownModule</span>():</span></span><br><span class="line">    print(<span class="string">"tearDownModule &gt;&gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass1</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"setUpClass for TestClass1 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"tearDownClass for TestClass1 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试前需执行的操作</span></span><br><span class="line">        print(<span class="string">"setUp for TestClass1 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例执行完后所需执行的操作</span></span><br><span class="line">        print(<span class="string">"tearDown for TestClass1 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例1 具体的测试脚本</span></span><br><span class="line">        print(<span class="string">"testCase1 for TestClass1"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例2 具体的测试脚本</span></span><br><span class="line">        print(<span class="string">"testCase2 for TestClass1"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass2</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUpClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"setUpClass for TestClass2 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDownClass</span>(<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">"tearDownClass for TestClass2 &gt;&gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"setUp for TestClass2 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"tearDown for TestClass2 &gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"testCase1 for TestClass2"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"testCase2 for TestClass2"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">setUpModule</span> <span class="string">&gt;&gt;&gt;</span></span><br><span class="line"><span class="attr">setUpClass</span> <span class="string">for TestClass1 &gt;&gt;</span></span><br><span class="line"><span class="attr">setUp</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="attr">testCase1</span> <span class="string">for TestClass1</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="meta">.setUp</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="attr">testCase2</span> <span class="string">for TestClass1</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass1 &gt;</span></span><br><span class="line"><span class="meta">.tearDownClass</span> <span class="string">for TestClass1 &gt;&gt;</span></span><br><span class="line"><span class="attr">setUpClass</span> <span class="string">for TestClass2 &gt;&gt;</span></span><br><span class="line"><span class="attr">setUp</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="attr">testCase1</span> <span class="string">for TestClass2</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="meta">.setUp</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="attr">testCase2</span> <span class="string">for TestClass2</span></span><br><span class="line"><span class="attr">tearDown</span> <span class="string">for TestClass2 &gt;</span></span><br><span class="line"><span class="meta">.tearDownClass</span> <span class="string">for TestClass2 &gt;&gt;</span></span><br><span class="line"><span class="attr">tearDownModule</span> <span class="string">&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">----------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">Ran</span> <span class="string">4 tests in 0.002s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">OK</span></span><br></pre></td></tr></tbody></table></figure>


</li>
</ul>
<ul>
<li>TestSuite 测试套件，可以将测试套件理解成运行测试用例的集合。<br>组织测试用例的实例，支持测试用例的添加和删除，<br>一个test suite由许多个TestCase组成，</li>
</ul>
<ol start="2">
<li>想要运行指定的用例需要将这些用例加入测试套件TestSuite中来运行，主要是4步<ul>
<li>创建一个TestSuite的实例，</li>
<li>调用 <code>unittest.TestSuite()</code>类中的 <code>addTest()</code>或者 <code>addTests([])</code> 方法向测试套件TestSuite实例一个一个添加测试用例TestCase实例<br>当所有测试添加之后，<br>用来管理和组织测试用例。</li>
</ul>
</li>
</ol>
<ul>
<li><p>TextTestRunner 用例执行器</p>
<ul>
<li>创建一个 unittest.TextTestRunner()类实例，run()方法运行测试套件TestSuite中的测试用例。<br>可以把TestSuite的实例传递给 TextTestRunner，它会按照添加测试用例的顺序逐个去执行测试用例，<br>会以文本的形式显示结果，在它们运行时会打印测试名字，发生的错误，并且在测试运行结束之后打印结果概要。<br>将测试用例或测试用例集合聚合起来的集合，批量执行，并且向用户提供测试结果 </li>
</ul>
</li>
<li><p>TextTestResult  测试结果<br>由TextTestRunner调用，会显示出格式化的文本。</p>
</li>
</ul>
<h3 id="unittest-模块使用的模式有三种，如下："><a href="#unittest-模块使用的模式有三种，如下：" class="headerlink" title="unittest 模块使用的模式有三种，如下："></a>unittest 模块使用的模式有三种，如下：</h3><p>首先， 通过 import 导入 unittest 单元测试框架。<br>写一个测试类必须继承自 <code>unittest.TestCase</code>，<br>该测试类下面的每一个测试用例方法名称必须以小写 <code>test</code> 开头，例如， test_add、 test_sub 等。</p>
<p>用例模块内的组织，在一个类内规定或者通过unittest的组织方式来决定哪些用例哪些代码执行的次数</p>
<p>通过调用 <code>unittest.main()</code> 来默认运行当前测试模块文件下的所有测试用例 测试集合</p>
<p>默认执行顺序不是书写顺序，而是按照用例名的ASCII码先后顺序执行<br>执行结果可以看到通过一个小点 <code>.</code> 来表示一条运行通过的用例</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行测试的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UCTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试前需执行的操作</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试用例执行完后所需执行的操作</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试用例1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCreateFolder</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 具体的测试脚本</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testDeleteFolder</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 具体的测试脚本</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 构造测试集， 添加测试用例</span></span><br><span class="line">    suite = unittest.TestSuite()</span><br><span class="line">    suite.addTest(UCTestCase(<span class="string">"testCreateFolder"</span>))</span><br><span class="line">    suite.addTest(UCTestCase(<span class="string">"testDeleteFolder"</span>))</span><br><span class="line">    <span class="comment"># 执行测试， 构造runner。</span></span><br><span class="line">    runner = unittest.TextTestRunner()</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>py</span><br><span class="line">import unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span>(<span class="title">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, a, b)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.a = int(a)</span><br><span class="line">        <span class="keyword">self</span>.b = int(b)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.a + <span class="keyword">self</span>.b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCount</span>(<span class="title">unittest</span>.<span class="title">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        print(<span class="string">"Test Start"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        print(<span class="string">"Test End"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add1</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        j = Count(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">self</span>.assertEqual(j.add(), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add2</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        j = Count(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">self</span>.assertEqual(j.add(), <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">"__main__"</span><span class="symbol">:</span></span><br><span class="line">    <span class="comment"># 1. 新建测试套件</span></span><br><span class="line">    suite = unittest.TestSuite()</span><br><span class="line">    <span class="comment"># 2. 将用例加入测试套件</span></span><br><span class="line">    <span class="comment"># suite.addTest(TestCount("test_add1"))</span></span><br><span class="line">    <span class="comment"># suite.addTest(TestCount("test_add2"))</span></span><br><span class="line"></span><br><span class="line">    suite.addTests([TestCount(<span class="string">"test_add1"</span>), TestCount(<span class="string">"test_add2"</span>)])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 新建TestRunner</span></span><br><span class="line">    runner = unittest.TextTestRunner()</span><br><span class="line">    <span class="comment"># 4. 用TestRunner来执行TestSuite</span></span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight subunit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Ran 2 tests in 0.007s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br><span class="line"><span class="keyword">Test </span>Start</span><br><span class="line"><span class="keyword">Test </span>End</span><br><span class="line"><span class="keyword">Test </span>Start</span><br><span class="line"><span class="keyword">Test </span>End</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5 != 6</span><br><span class="line"></span><br><span class="line">Expected :6</span><br><span class="line">Actual   :5</span><br><span class="line">&lt;Click to see difference&gt;</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "C:\1.py", line 26, in test_add2</span><br><span class="line">    self.assertEqual(j.add(), 5)</span><br><span class="line">AssertionError: 6 != 5</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>TestLoader 测试用例加载器<br>负责根据各种各样的规则收集测试用例，并把这些测试用例包装在一个TestSuite中。运行测试集</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCase1</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># def setUp(self):</span></span><br><span class="line">    <span class="comment"># def tearDown(self):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'aaa'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'bbb'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCase2</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># def setUp(self):</span></span><br><span class="line">    <span class="comment"># def tearDown(self):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'aaa1'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">testCase2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'bbb1'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 此用法可以同时测试多个类</span></span><br><span class="line">    suite1 = unittest.TestLoader().loadTestsFromTestCase(TestCase1)</span><br><span class="line">    suite2 = unittest.TestLoader().loadTestsFromTestCase(TestCase2)</span><br><span class="line">    suite = unittest.TestSuite([suite1, suite2])</span><br><span class="line">    unittest.TextTestRunner(verbosity=<span class="number">2</span>).run(suite)</span><br></pre></td></tr></tbody></table></figure>

<ol start="5">
<li>TestCase的用法<br>源文件widget.py，也即我们要进行单元测试的文件。很简单的一个类，该类可以设置长宽，并且能够获取这两个值。<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Widget</span>:</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, size=(<span class="params"><span class="number">40</span>, <span class="number">40</span></span>)</span>):</span></span><br><span class="line">         self._size = size</span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">get_size</span>(<span class="params">self</span>):</span></span><br><span class="line">         <span class="keyword">return</span> self._size</span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">resize</span>(<span class="params">self, width, height</span>):</span></span><br><span class="line">         <span class="keyword">if</span> width &lt; <span class="number">0</span> <span class="keyword">or</span> height &lt; <span class="number">0</span>:</span><br><span class="line">             <span class="keyword">raise</span> ValueError, <span class="string">'illegal size'</span></span><br><span class="line">             self._size = (width, height)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    widget = Widget()</span><br><span class="line">    <span class="keyword">print</span> widget.get_size()</span><br></pre></td></tr></tbody></table></figure>
因此，我们可以撰写的单元测试代码文件 widgettest.py 如下：</li>
</ol>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> widget <span class="keyword">import</span> Widget</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WidgetTestCase</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的初始化工作可以在setUp()方法中完成</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget = Widget()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的资源的释放则可以在tearDown()方法中完成</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget.dispose()</span><br><span class="line">        self.widget = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应widget类中的get_size函数测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_size</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(self.widget.get_size(), (<span class="number">40</span>, <span class="number">40</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应widget类中resize函数的测试</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_Resize</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.widget.resize(<span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">        self.assertEqual(self.widget.get_size(), (<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></tbody></table></figure>

<p>其中有两个测试用例，分别为test_size, test_Resize， 在每个测试用例执行的过程中会首先执行setUp，然后执行测试用例，最后执行tearDown操作。每个测试用例的执行遵循相同的模式。<br>其中要注意的是setUp和tearDown两个，又称为测试装置，setUp完成对象的初始化动作，而tearDown则完成资源的释放之类的操作。</p>
<p>可以在一个独立的文件里提供一个更全面的测试集</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> average</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestStatisticalFunctions</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_average</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(average([<span class="number">20</span>, <span class="number">30</span>, <span class="number">70</span>]), <span class="number">40.0</span>)</span><br><span class="line">        self.assertEqual(round(average([<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>]), <span class="number">1</span>), <span class="number">4.3</span>)</span><br><span class="line">        self.assertRaises(ZeroDivisionError, average, [])</span><br><span class="line">        self.assertRaises(TypeError, average, <span class="number">20</span>, <span class="number">30</span>, <span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unittest.main()  <span class="comment"># Calling from the command line invokes all tests</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">FF</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_equals (__main__.MyTestCase)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:/python代码/步骤4 Flask基础及项目实战/第30周   实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战接口自动化测试/接口测试/apitest/test_verify_demo.py"</span>, line <span class="number">8</span>, <span class="keyword">in</span> test_equals</span><br><span class="line">    self.assertNotEqual(<span class="number">1</span>, <span class="number">2</span> / <span class="number">2</span>)</span><br><span class="line">AssertionError: <span class="number">1</span> == <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_type (__main__.MyTestCase)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:/python代码/步骤4 Flask基础及项目实战/第30周   实战测试慕旅游网：接口自动化测试/第2节 慕旅游网项目实战接口自动化测试/接口测试/apitest/test_verify_demo.py"</span>, line <span class="number">31</span>, <span class="keyword">in</span> test_type</span><br><span class="line">    self.assertIsInstance({<span class="string">"a"</span>: <span class="number">1</span>}, list)</span><br><span class="line">AssertionError: {<span class="string">'a'</span>: <span class="number">1</span>} <span class="keyword">is</span> <span class="keyword">not</span> an instance of &lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">----------------------------------------------------------------------</span></span><br><span class="line"><span class="class"><span class="title">Ran</span> 2 <span class="title">tests</span> <span class="title">in</span> 0.001<span class="title">s</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">FAILED</span> (<span class="params">failures=<span class="number">2</span></span>)</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/zhan-wei-ge-shi-hua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/zhan-wei-ge-shi-hua/" class="post-title-link" itemprop="url">占位格式化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-30 00:25:25" itemprop="dateModified" datetime="2021-06-30T00:25:25Z">2021-06-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>format(value[, format_spec])</code><br>将 value 转换为 format_spec 控制的“格式化”表示。<br>format_spec 的解释取决于 value 实参的类型，但是大多数内置类型使用标准格式化语法：格式规格迷你语言。</p>
<p>默认的 format_spec 是一个空字符串，它通常和调用 str(value) 的结果相同。</p>
<p>调用 format(value, format_spec) 会转换成 type(value).<strong>format</strong>(value, format_spec) ，所以实例字典中的 <strong>format</strong>() 方法将不会调用。如果搜索到 object 有这个方法但 format_spec 不为空，format_spec 或返回值不是字符串，会触发 TypeError 异常。</p>
<p>在 3.4 版更改: 当 format_spec 不是空字符串时， object().<strong>format</strong>(format_spec) 会触发 TypeError。</p>
<p><code>%</code>符号，格式化的输出，当变量是哪种类型，那么%后面接的类型也是哪一种。</p>
<p>占位符，表示这个位置先占着，待会儿要有数据填入到这里。</p>
<h3 id="s和-是一种格式化符号、占位符"><a href="#s和-是一种格式化符号、占位符" class="headerlink" title="%s和 {} 是一种格式化符号、占位符"></a><code>%s</code>和 <code>{}</code> 是一种格式化符号、占位符</h3><p>Python 解释器 看到 <code>%s</code> ，就会调用内置函数 <code>str()</code>，<br>并将对应的 格式化对象 作为 参数传入，返回的结果字符串填入对应占位符。<br>%s 位置填入的结果，就是调用str函数的返回值。<br>对应的格式化对象，不仅仅是字符串，还可以是整数、浮点数、列表、元组 等</p>
<p><code>str()</code>将指定的对象转换成字符串形式，<br>参数 可以是任何类型的对象，字符串、整数、浮点数、列表、元组等。<br>可以指定编码。<br><code>str(123)='123'</code> 表示格化式一个对象为字符</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">'我会唱跳rap'</span></span><br><span class="line">str2 = <span class="string">'打篮球'</span></span><br><span class="line"><span class="comment"># 拼接成一个字符串</span></span><br><span class="line">print(str1 + str2)</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br><span class="line">print(<span class="string">'%s%s'</span> % (str1, str2))</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br><span class="line">print(<span class="string">'{}{}'</span>.format(str1, str2))</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{str1}</span><span class="subst">{str2}</span>'</span>)</span><br><span class="line"><span class="comment"># 我会唱跳rap打篮球</span></span><br></pre></td></tr></tbody></table></figure>

<p>格式化字符串里面占位符的个数 必须 和 后面对应的格式化对象个数相同</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">id = <span class="number">123</span></span><br><span class="line">name = <span class="string">'Xiaoming'</span></span><br><span class="line">hegiht = <span class="number">1.7</span></span><br><span class="line">print(<span class="string">'User[%s]: %s %sm '</span> % (id, name, hegiht))</span><br><span class="line"><span class="comment"># User[123]: Xiaoming 1.7m</span></span><br><span class="line">print(<span class="string">'User[%(id)s]: %(name)s %(height)sm'</span> % {</span><br><span class="line">    <span class="string">'id'</span>: <span class="number">123</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Xiaoming'</span>,</span><br><span class="line">    <span class="string">'height'</span>: <span class="number">1.7</span></span><br><span class="line">})</span><br><span class="line"><span class="comment"># User[123]: Xiaoming 1.7m</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">"hello"</span></span><br><span class="line">print(<span class="string">"string=%s!"</span> % (string, ))  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有一个格式化对象的情况下，可以直接就用格式化对象，不需要放到元组里面</span></span><br><span class="line">print(<span class="string">"string=%s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#%2s意思是字符串长度为2，当原字符串的长度超过2时，按原长度打印</span></span><br><span class="line">print(<span class="string">"string=%2s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %7s意思是字符串长度为7，当原字符串的长度小于7时，在原字符串左侧补空格，右边对齐</span></span><br><span class="line">print(<span class="string">"string=%7s!"</span> % string)  <span class="comment"># string=  hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %-7s意思是字符串长度为7，当原字符串的长度小于7时，在原字符串右侧补空格，左边对齐</span></span><br><span class="line">print(<span class="string">"string=%-7s!"</span> % string)  <span class="comment"># string=hello  !</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.2s意思是截取字符串的前2个字符</span></span><br><span class="line">print(<span class="string">"string=%.2s!"</span> % string)  <span class="comment"># string=he!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.7s意思是截取字符串的前7个字符，当原字符串长度小于7时，即是字符串本身</span></span><br><span class="line"><span class="comment"># 所以%.7s的打印结果是hello</span></span><br><span class="line">print(<span class="string">"string=%.7s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %a.bs这种格式是上面两种格式的综合，首先根据小数点后面的数b截取字符串，</span></span><br><span class="line"><span class="comment"># 当截取的字符串长度小于a时，还需要在其左侧补空格</span></span><br><span class="line">print(<span class="string">"string=%7.2s!"</span> % string)  <span class="comment"># string=     he!</span></span><br><span class="line">print(<span class="string">"string=%2.7s!"</span> % string)  <span class="comment"># string=hello!</span></span><br><span class="line">print(<span class="string">"string=%10.7s!"</span> % string)  <span class="comment"># string=     hello!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用%*.*s来表示精度，两个*的值分别在后面小括号的前两位数值指定</span></span><br><span class="line">print(<span class="string">"string=%*.*s!"</span> % (<span class="number">7</span>, <span class="number">2</span>, string))  <span class="comment"># string=     he!</span></span><br></pre></td></tr></tbody></table></figure>


<p><code>%d</code> dec 十进制 用在 格式化对象 是 整数的情况<br><code>%o</code> —— oct 八进制<br><code>%x</code> —— hex 十六进制</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"num=%om"</span> % num)  <span class="comment"># num=16m</span></span><br><span class="line">print(<span class="string">"num=%xm"</span> % num)  <span class="comment"># num=em</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"num=%dm"</span> % num)  <span class="comment"># num=14m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %1d意思是打印结果为1位整数，当整数的位数超过1位时，按整数原值打印</span></span><br><span class="line">print(<span class="string">"num=%1dm"</span> % num)  <span class="comment"># num=14m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %3d意思是打印结果为3位整数，当整数的位数不够3位时，在整数左侧补空格</span></span><br><span class="line">print(<span class="string">"num=%3dm"</span> % num)  <span class="comment"># num= 14m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %-3d意思是打印结果为3位整数，当整数的位数不够3位时，在整数右侧补空格</span></span><br><span class="line">print(<span class="string">"num=%-3dm"</span> % num)  <span class="comment"># num=14 m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %03d意思是打印结果为3位整数，当整数的位数不够3位时，在整数左侧补0</span></span><br><span class="line">print(<span class="string">"num=%03dm"</span> % num)  <span class="comment"># num=014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.3d小数点后面的3意思是打印结果为3位整数，</span></span><br><span class="line"><span class="comment"># 当整数的位数不够3位时，在整数左侧补0</span></span><br><span class="line">print(<span class="string">"num=%.3dm"</span> % num)  <span class="comment"># num=014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.0003d小数点后面的0003和3一样，都表示3，意思是打印结果为3位整数，</span></span><br><span class="line"><span class="comment"># 当整数的位数不够3位时，在整数左侧补0</span></span><br><span class="line">print(<span class="string">"num=%.0003dm"</span> % num)  <span class="comment"># num=014m</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'---'</span>)</span><br><span class="line"><span class="comment"># %5.3d是两种补齐方式的综合，当整数的位数不够3时，先在左侧补0，</span></span><br><span class="line"><span class="comment"># 还是不够5位时，再在左侧补空格，</span></span><br><span class="line"><span class="comment"># 规则就是补0优先，最终的长度选数值较大的那个，所以%5.3d的打印结果还是  014</span></span><br><span class="line">print(<span class="string">"num=%5.3dm"</span> % num)  <span class="comment"># num=  014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %05.3d是两种补齐方式的综合，当整数的位数不够3时，先在左侧补0，还是不够5位时，</span></span><br><span class="line"><span class="comment"># 由于是05，再在左侧补0，最终的长度选数值较大的那个</span></span><br><span class="line">print(<span class="string">"num=%05.3dm"</span> % num)  <span class="comment"># num=00014m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %*.*d来表示精度，两个*的值分别在后面小括号的前两位数值指定</span></span><br><span class="line"><span class="comment"># 不过这种方式5就失去补0的功能，只能补空格，只有小数点后面的3才能补0</span></span><br><span class="line">print(<span class="string">"num=%*.*dm"</span> % (<span class="number">5</span>, <span class="number">3</span>, num))  <span class="comment"># num=  014m</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>%f</code> 用在 格式化对象 是 浮点数的情况，保留小数点后6位数有效数字<br>指定宽度，而且希望不足宽度补零或者补空格</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># %f时表示原值，保留小数点后6位数有效数字</span></span><br><span class="line">print(<span class="string">"PI=%f"</span> % <span class="number">3.14</span>)  <span class="comment"># PI=3.140000</span></span><br><span class="line">print(<span class="string">"PI=%010f"</span> % <span class="number">3.14</span>)  <span class="comment"># PI=003.140000</span></span><br><span class="line">print(<span class="string">"PI=%f"</span> % math.pi)  <span class="comment"># PI=3.141593</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %a.bf，a表示浮点数的打印长度，b表示浮点数小数点后面的精度</span></span><br><span class="line"><span class="comment"># %9f时，表示打印长度9位数，小数点也占一位，不够左侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%9f"</span> % math.pi)  <span class="comment"># PI= 3.141593</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"PI=%09f"</span> % math.pi)  <span class="comment"># PI=03.141593</span></span><br><span class="line">print(<span class="string">"PI=%010f"</span> % math.pi)  <span class="comment"># PI=003.141593</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"PI=%03f"</span> % math.pi)  <span class="comment"># PI=3.141593</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有.没有后面的数字时，表示去掉小数输出整数，03表示不够3位数左侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%3.f"</span> % math.pi)  <span class="comment"># PI=  3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有.没有后面的数字时，表示去掉小数输出整数，03表示不够3位数左侧补0</span></span><br><span class="line">print(<span class="string">"PI=%03.f"</span> % math.pi)  <span class="comment"># PI=003</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.1f表示一个浮点数，小数点后保留1位有效数字</span></span><br><span class="line">print(<span class="string">"PI=%.1f"</span> % math.pi)  <span class="comment"># PI=3.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %.3f表示一个浮点数，小数点后保留3位有效数字</span></span><br><span class="line">print(<span class="string">"PI=%.3f"</span> % math.pi)  <span class="comment"># PI=3.142</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"%.3f"</span> % <span class="number">123.45678</span>)  <span class="comment"># 123.457</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:.3f}'</span>.format(<span class="number">123.45678</span>))  <span class="comment"># 123.457 最后一个数字之所以是7，是因为format会对数据进行四舍五入</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %6.3f表示小数点后面精确到3位，总长度6位数，包括小数点，不够左侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%6.3f"</span> % math.pi)  <span class="comment"># PI= 3.142</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %-6.3f表示小数点后面精确到3位，总长度6位数，包括小数点，不够右侧补空格</span></span><br><span class="line">print(<span class="string">"PI=%-6.3f"</span> % math.pi)  <span class="comment"># PI=3.142</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %*.*f来表示精度，两个*的值分别在后面小括号的前两位数值指定</span></span><br><span class="line"><span class="comment"># 如下，不过这种方式6就失去补0的功能，只能补空格</span></span><br><span class="line">print(<span class="string">"PI=%*.*f"</span> % (<span class="number">6</span>, <span class="number">3</span>, math.pi))  <span class="comment"># PI= 3.142</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="字符串内容里有花括号"><a href="#字符串内容里有花括号" class="headerlink" title="字符串内容里有花括号"></a>字符串内容里有花括号</h2><p>花括号{}内，限定的顺序不能搞错，<br>第一是元素序号，冒号之前的数字实际上是参数的序号，当format内只有一位元素需要输出时，这个序号可以省略<br>第二是冒号，<br>第三是特定填充符号 当输出的内容不足以占满宽度，没有的话默认填充空格<br>第四对齐方式，<br>第五宽度，<br>第六千分位分隔符号，<br>第七精度。</p>
<p>指定填入的字符串的宽度：在<code>{}</code>里面的变量后面加上 <code>:宽度值</code><br>对齐符号<code>&lt;</code>、<code>^</code>、<code>&gt;</code>来表示左对齐、居中对齐、右对齐。<br><code>=</code> （只用于数字）在小数点后进行补齐</p>
<h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><p>将根据*<em>顺序</em>对前面的花括号进行匹配输出。<br>花括号内也可以写上<strong>序号</strong>，对format中的内容进行匹配</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自然连接</span></span><br><span class="line">print(<span class="string">'We are the {} who say "{}!"'</span>.format(<span class="string">'knights'</span>, <span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定顺序连接</span></span><br><span class="line">print(<span class="string">'We are the {0} who say "{1}~{0}!"'</span>.format(<span class="string">'knights'</span>, <span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni~knights!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过类似字典的方式指定参数映射</span></span><br><span class="line">print(<span class="string">'We are the {people} who say "{hi}!"'</span>.format(people=<span class="string">'knights'</span>, hi=<span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni!"</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'We are the {0} who say "{hi}!"'</span>.format(<span class="string">'knights'</span>, hi=<span class="string">'Ni'</span>))</span><br><span class="line"><span class="comment"># We are the knights who say "Ni!"</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{2}, {1}, {0}'</span>.format(*<span class="string">'abc'</span>))</span><br><span class="line"><span class="comment"># c, b, a</span></span><br><span class="line"></span><br><span class="line">octets = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line">print(<span class="string">'{:02X}{:02X}{:02X}{:02X}'</span>.format(*octets))  <span class="comment"># 位置参数*args?</span></span><br><span class="line"><span class="comment"># 0A0B0C0D</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过下标匹配参数</span></span><br><span class="line">coord = [<span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord))</span><br><span class="line"><span class="comment"># X: 3;  Y: 5</span></span><br><span class="line"></span><br><span class="line">coord = (<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord))</span><br><span class="line"><span class="comment"># X: 3;  Y: 5</span></span><br><span class="line"></span><br><span class="line">coord = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord))</span><br><span class="line"><span class="comment"># X: [1, 2];  Y: [3, 4]</span></span><br><span class="line"></span><br><span class="line">coord1 = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">coord2 = [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">print(<span class="string">'X: {0[0]};  Y: {0[1]}'</span>.format(coord1, coord2))</span><br><span class="line"><span class="comment"># X: 1;  Y: 2</span></span><br><span class="line">print(<span class="string">'X: {1[0]};  Y: {1[1]}'</span>.format(coord1, coord2))</span><br><span class="line"><span class="comment"># X: 3;  Y: 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过key匹配参数</span></span><br><span class="line">person = {<span class="string">'name'</span>: <span class="string">'ashe'</span>, <span class="string">'age'</span>: <span class="number">25</span>}</span><br><span class="line"><span class="comment"># 中括号内的key是不用引号引起来的。如果改成{0[“name”]}就会报错。</span></span><br><span class="line">print(<span class="string">'name：{0[name]}, age：{0[age]}'</span>.format(person))</span><br><span class="line"><span class="comment"># name：ashe, age：25</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'name：{name}, age：{age}'</span>.format(**person))</span><br><span class="line"><span class="comment"># name：ashe, age：25</span></span><br><span class="line"></span><br><span class="line">person1 = {<span class="string">'name'</span>: <span class="string">'ashe'</span>}</span><br><span class="line">person2 = {<span class="string">'age'</span>: <span class="number">25</span>}</span><br><span class="line">print(<span class="string">'name：{0[name]}, age：{1[age]}'</span>.format(person1, person2))</span><br><span class="line"><span class="comment"># name：ashe, age：25</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'name：{:0^8}, age：{:*&gt;4}'</span>.format(<span class="string">'ashe'</span>, <span class="number">25</span>))</span><br><span class="line"><span class="comment"># name：000ashe000, age：**25</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 千位分隔符</span></span><br><span class="line">print(<span class="string">'{:,}'</span>.format(<span class="number">1234567890</span>))  <span class="comment"># 1,234,567,890</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{0:*^20,.3f}  {1:*&gt;20,.3f}   {1:-^15}'</span>.format(<span class="number">12345.6789</span>, <span class="number">5647854.12452</span>,</span><br><span class="line">                                                     <span class="string">'hello'</span>))</span><br><span class="line"><span class="comment"># *****12,345.679*****  *******5,647,854.125   -5647854.12452-</span></span><br></pre></td></tr></tbody></table></figure>

<p>字符串默认左对齐</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var = <span class="string">'34324'</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">'对**字符串**不足指定宽度的时候补空格'</span>)</span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324    # 字符串默认左对齐</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment">#    34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>, <span class="string">"len ="</span>, len(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>))</span><br><span class="line"><span class="comment">#       34324 len = 11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print('对**数字**不足指定宽度的时候补数字0')</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># ValueError: '=' alignment not allowed in string format specifier</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324000</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 00034324</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(f'{var:.1f}')</span></span><br><span class="line"><span class="comment"># ValueError: Unknown format code 'f' for object of type 'str'</span></span><br></pre></td></tr></tbody></table></figure>

<p>数字默认右对齐</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">var = <span class="number">34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">'对**数字**不足指定宽度的时候补空格'</span>)</span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment">#    34324 数字默认右对齐</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">8</span>}</span>'</span>)</span><br><span class="line"><span class="comment">#    34324</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>, <span class="string">"len ="</span>, len(<span class="string">f'<span class="subst">{var:&gt;<span class="number">11</span>}</span>'</span>))</span><br><span class="line"><span class="comment">#       34324 len = 11</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'对**数字**不足指定宽度的时候补数字0'</span>)</span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 00034324 数字指定长度能08</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&lt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324000</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:&gt;<span class="number">08</span>}</span>'</span>)</span><br><span class="line"><span class="comment"># 00034324</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">.1</span>f}</span>'</span>)</span><br><span class="line"><span class="comment"># 34324.0</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'<span class="subst">{var:<span class="number">8.1</span>f}</span>'</span>)</span><br><span class="line"><span class="comment">#  34324.0</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{} is {:.2f}'</span>.format(<span class="number">1.123</span>, <span class="number">1.123</span>))  <span class="comment"># 取2位小数</span></span><br><span class="line"><span class="comment"># 1.123 is 1.12</span></span><br><span class="line">print(<span class="string">'{0} is {0:&gt;10.2f}'</span>.format(<span class="number">1.123</span>))  <span class="comment"># 取2位小数，右对齐，取10位</span></span><br><span class="line"><span class="comment"># 1.123 is       1.12</span></span><br><span class="line">print(<span class="string">'{} is {:&gt;10.2f}'</span>.format(<span class="number">1.123</span>))  <span class="comment"># IndexError: Replacement index 1 out of range for positional args tuple</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:0=30}'</span>.format(<span class="number">11</span>))  <span class="comment"># 还有“=”只能应用于数字，这种方法可用“&gt;”代替</span></span><br><span class="line"><span class="comment"># '000000000000000000000000000011'</span></span><br></pre></td></tr></tbody></table></figure>

<p>进制数输出<br><code>b</code>、<code>d</code>、<code>o</code>、<code>x</code>分别是二进制、十进制、八进制、十六进制</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'{:b}'</span>.format(<span class="number">10</span>))  <span class="comment"># 1010</span></span><br><span class="line">print(<span class="string">'{0:b}'</span>.format(<span class="number">10</span>))  <span class="comment"># 1010</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:d}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 X 表示格式化为16进制，并采用小写格式</span></span><br><span class="line">print(<span class="string">f'数字12的16进制表示为：<span class="subst">{<span class="number">12</span>:x}</span>'</span>)</span><br><span class="line"><span class="comment"># 数字12的16进制表示为：c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 X 表示格式化为16进制，并采用大写格式</span></span><br><span class="line">print(<span class="string">f'数字12的16进制表示为：<span class="subst">{<span class="number">12</span>:X}</span>'</span>)</span><br><span class="line"><span class="comment"># 数字12的16进制表示为：C</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"bin: {0:b}; int: {0:d}; oct: {0:o}; hex: {0:x}; "</span>.format(<span class="number">12</span>))</span><br><span class="line"><span class="comment"># bin: 1100; int: 12;  oct: 14; hex: c;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># with 0x, 0o, or 0b as prefix:</span></span><br><span class="line">print(<span class="string">"bin: {0:#b}; int: {0:d};  oct: {0:#o};  hex: {0:#x}"</span>.format(</span><br><span class="line">    <span class="number">12</span>))  <span class="comment"># 在前面加“#”，则带进制前缀</span></span><br><span class="line"><span class="comment"># bin: 0b1100; int: 12;  oct: 0o14;  hex: 0xc</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="f-quot-string-quot-格式化"><a href="#f-quot-string-quot-格式化" class="headerlink" title="f&quot;string&quot; 格式化"></a><code>f"string"</code> 格式化</h3><p>在字符串模板前面加上f，然后占位符使用{}，里面直接放入对应的数据对象。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">salary = input(<span class="string">'请输入薪资：'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算出缴税额，存入变量tax</span></span><br><span class="line">tax = int(salary) * <span class="number">25</span> / <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算出税后工资，存入变量aftertax</span></span><br><span class="line">aftertax = int(salary) * <span class="number">75</span> / <span class="number">100</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'税前薪资是：<span class="subst">{salary}</span>元， 缴税：<span class="subst">{tax}</span>元， 税后薪资是：<span class="subst">{aftertax}</span>元'</span>)</span><br><span class="line"><span class="comment"># 请输入薪资：10000</span></span><br><span class="line"><span class="comment"># 税前薪资是：10000元， 缴税：2500.0元，</span></span><br><span class="line"><span class="comment"># 税后薪资是：7500.0元</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">salary = <span class="number">10000</span></span><br><span class="line">tax = int(salary) * <span class="number">25</span> / <span class="number">100</span></span><br><span class="line">aftertax = int(salary) * <span class="number">75</span> / <span class="number">100</span></span><br><span class="line">print(<span class="string">f'税前薪资是：<span class="subst">{salary:<span class="number">8</span>}</span>元， 缴税：<span class="subst">{tax:<span class="number">8</span>}</span>元， 税后薪资是：<span class="subst">{aftertax:<span class="number">8</span>}</span>元'</span>)</span><br><span class="line"><span class="comment"># 税前薪资是：   10000元， 缴税：  2500.0元， 税后薪资是：  7500.0元</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcTax</span>(<span class="params">salary</span>):</span></span><br><span class="line">    tax = int(salary) * <span class="number">25</span> / <span class="number">100</span></span><br><span class="line">    aftertax = int(salary) * <span class="number">75</span> / <span class="number">100</span></span><br><span class="line">    print(<span class="string">f'税前薪资是：<span class="subst">{salary:&lt;<span class="number">8</span>}</span>元， 缴税：<span class="subst">{tax:&lt;<span class="number">8</span>}</span>元， 税后薪资是：<span class="subst">{aftertax:&lt;<span class="number">8</span>}</span>元'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">calcTax(<span class="number">10000</span>)</span><br><span class="line"><span class="comment"># 税前薪资是：10000   元， 缴税：2500.0  元， 税后薪资是 ：7500.0  元</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># .3f就表示小数点后面保留1位</span></span><br><span class="line">print(<span class="string">"%.3f"</span> % <span class="number">123.45678</span>)  <span class="comment"># 123.457</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:.3f}'</span>.format(<span class="number">123.45678</span>))  <span class="comment"># 123.457</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'The value of pi is approximately <span class="subst">{math.pi:<span class="number">.3</span>f}</span>.'</span>)</span><br><span class="line"><span class="comment"># The value of pi is approximately 3.142.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'The value of pi is approximately <span class="subst">{math.pi:<span class="number">2.3</span>f}</span>.'</span>)</span><br><span class="line"><span class="comment"># The value of pi is approximately 3.142.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f'The value of pi is approximately <span class="subst">{math.pi:<span class="number">6.3</span>f}</span>.'</span>)</span><br><span class="line"><span class="comment"># The value of pi is approximately  3.142.</span></span><br></pre></td></tr></tbody></table></figure>

<p>采用 f-string 方式格式化的 字符串内容本身就有 <code>{</code> 或者 <code>}</code> 符号，<br>一定要 双写 进行转义，否则会被当成是 格式化占位符。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">times1 = <span class="number">1000</span></span><br><span class="line">times2 = <span class="number">2000</span></span><br><span class="line">print(<span class="string">f'文章中 {{ 符号 出现了 <span class="subst">{times1}</span> 次'</span>)</span><br><span class="line"><span class="comment"># 文章中 { 符号 出现了 1000 次</span></span><br><span class="line">print(<span class="string">f'文章中 }} 符号 出现了 <span class="subst">{times2}</span> 次'</span>)</span><br><span class="line"><span class="comment"># 文章中 } 符号 出现了 2000 次</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replacement_field ::= <span class="string">"{"</span> [field_name] [<span class="string">"!"</span> conversion] [<span class="string">":"</span> format_spec] <span class="string">"}"</span></span><br><span class="line">conversion ::= <span class="string">"r"</span> | <span class="string">"s"</span> | <span class="string">"a"</span></span><br></pre></td></tr></tbody></table></figure>

<p>这里只有三个转换符号，用”!”开头。<br><code>!r</code>对应 <code>repr()</code>；<code>!s</code>对应 <code>str()</code>; <code>!a</code>对应<code>ascii()</code>。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">animals = <span class="string">'eels'</span></span><br><span class="line">print(<span class="string">f'My hovercraft is full of <span class="subst">{animals}</span>.'</span>)</span><br><span class="line"><span class="comment"># My hovercraft is full of eels.</span></span><br><span class="line">print(<span class="string">f'My hovercraft is full of <span class="subst">{animals!r}</span>.'</span>)</span><br><span class="line"><span class="comment"># My hovercraft is full of 'eels'.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"repr() shows quotes: {!r}; str() doesn't: {!s}"</span>.format(<span class="string">'test1'</span>, <span class="string">'test2'</span>))</span><br><span class="line"><span class="comment"># "repr() shows quotes: 'test1'; str() doesn't: test2"  # 输出结果是一个带引号，一个不带</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">salary = <span class="number">10000</span></span><br><span class="line"><span class="comment"># 指定了 宽度为10 个字符， 如果填入的字符串不足10个字符，就在前面加上空格，右边对齐</span></span><br><span class="line">print(<span class="string">f'<span class="subst">{salary:<span class="number">10</span>}</span>'</span>)  <span class="comment">#      10000 </span></span><br><span class="line"></span><br><span class="line">table = {<span class="string">'Sjoerd'</span>: <span class="number">4127</span>, <span class="string">'Jack'</span>: <span class="number">4098</span>, <span class="string">'Dcab'</span>: <span class="number">7678</span>}</span><br><span class="line"><span class="keyword">for</span> name, phone <span class="keyword">in</span> table.items():</span><br><span class="line">    print(<span class="string">f'<span class="subst">{name:<span class="number">10</span>}</span> ==&gt; <span class="subst">{phone:<span class="number">10</span>d}</span>'</span>)</span><br><span class="line"><span class="comment"># Sjoerd     ==&gt;       4127</span></span><br><span class="line"><span class="comment"># Jack       ==&gt;       4098</span></span><br><span class="line"><span class="comment"># Dcab       ==&gt;       7678</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'Jack: {0[Jack]:d}; Sjoerd: {0[Sjoerd]:d}; '</span></span><br><span class="line">      <span class="string">''</span></span><br><span class="line">      <span class="string">'Dcab: {0[Dcab]:d}'</span>.format(table))</span><br><span class="line"><span class="comment"># Jack: 4098; Sjoerd: 4127; Dcab: 8637678</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">info = [[<span class="string">'user1'</span>, <span class="number">345.6</span>, <span class="number">12</span>, <span class="string">'黄金'</span>], [<span class="string">'user2'</span>, <span class="number">2345.6</span>, <span class="number">8</span>, <span class="string">'白银'</span>],</span><br><span class="line">        [<span class="string">'user3555'</span>, <span class="number">55345.6</span>, <span class="number">22</span>, <span class="string">'钻石'</span>]]</span><br><span class="line"></span><br><span class="line">print(</span><br><span class="line">    <span class="string">f'用户：<span class="subst">{info[<span class="number">0</span>][<span class="number">0</span>]:&gt;<span class="number">10</span>}</span>， 积分：<span class="subst">{info[<span class="number">0</span>][<span class="number">1</span>]:<span class="number">7</span>}</span>， 等级：<span class="subst">{info[<span class="number">0</span>][<span class="number">2</span>]:<span class="number">2</span>}</span>， 头衔：<span class="subst">{info[<span class="number">0</span>][<span class="number">3</span>]}</span>'</span></span><br><span class="line">)</span><br><span class="line">print(</span><br><span class="line">    <span class="string">f'用户：<span class="subst">{info[<span class="number">1</span>][<span class="number">0</span>]:&gt;<span class="number">10</span>}</span>， 积分：<span class="subst">{info[<span class="number">1</span>][<span class="number">1</span>]:<span class="number">7</span>}</span>， 等级：<span class="subst">{info[<span class="number">1</span>][<span class="number">2</span>]:<span class="number">2</span>}</span>， 头衔：<span class="subst">{info[<span class="number">1</span>][<span class="number">3</span>]}</span>'</span></span><br><span class="line">)</span><br><span class="line">print(</span><br><span class="line">    <span class="string">f'用户：<span class="subst">{info[<span class="number">2</span>][<span class="number">0</span>]:&gt;<span class="number">10</span>}</span>， 积分：<span class="subst">{info[<span class="number">2</span>][<span class="number">1</span>]:<span class="number">7</span>}</span>， 等级：<span class="subst">{info[<span class="number">2</span>][<span class="number">2</span>]:<span class="number">2</span>}</span>， 头衔：<span class="subst">{info[<span class="number">2</span>][<span class="number">3</span>]}</span>'</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 用户：     user1， 积分：  345.6， 等级：12， 头衔：黄金</span></span><br><span class="line"><span class="comment"># 用户：     user2， 积分： 2345.6， 等级： 8， 头衔：白银</span></span><br><span class="line"><span class="comment"># 用户：  user3555， 积分：55345.6， 等级：22， 头衔：钻石</span></span><br></pre></td></tr></tbody></table></figure>

<p>%e ——保留小数点后面六位有效数字，指数形式输出<br>　　%.3e，保留3位小数位，使用科学计数法<br>%g ——在保证六位有效数字的前提下，使用小数方式，否则使用科学计数法<br>　　%.3g，保留3位有效数字，使用小数或科学计数法</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">print(<span class="string">'%e'</span> % <span class="number">1.11</span>)  <span class="comment"># 默认6位小数，用科学计数法</span></span><br><span class="line"><span class="comment"># 1.110000e+00</span></span><br><span class="line">print(<span class="string">'%.3e'</span> % <span class="number">1.11</span>)  <span class="comment"># 取3位小数，用科学计数法</span></span><br><span class="line"><span class="comment"># 1.110e+00</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'%g'</span> % <span class="number">1111.1111</span>)  <span class="comment"># 默认6位有效数字</span></span><br><span class="line"><span class="comment"># 1111.11</span></span><br><span class="line">print(<span class="string">'%.7g'</span> % <span class="number">1111.1111</span>)  <span class="comment"># 取7位有效数字</span></span><br><span class="line"><span class="comment"># 1111.111</span></span><br><span class="line">print(<span class="string">'%.2g'</span> % <span class="number">1111.1111</span>)  <span class="comment"># 取2位有效数字，自动转换为科学计数法</span></span><br><span class="line"><span class="comment"># 1.1e+03</span></span><br></pre></td></tr></tbody></table></figure>

<p>‘e’ - 幂符号。用科学计数法打印数字。用’e’表示幂。<br>‘g’ - 一般格式。将数值以fixed-point格式输出。当数值特别大的时候，用幂形式打印。<br>‘n’ - 数字。当值为整数时和’d’相同，值为浮点数时和’g’相同。不同的是它会根据区域设置插入数字分隔符。<br>‘%’ - 百分数。将数值乘以100然后以fixed-point(‘f’)格式打印，值后面会有一个百分号。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'{:e}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 2.000000e+01</span></span><br><span class="line">print(<span class="string">'{:g}'</span>.format(<span class="number">20.1</span>))</span><br><span class="line"><span class="comment"># 20.1</span></span><br><span class="line">print(<span class="string">'{:f}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 20.000000</span></span><br><span class="line">print(<span class="string">'{:n}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'{:%}'</span>.format(<span class="number">20</span>))</span><br><span class="line"><span class="comment"># 2000.000000%</span></span><br><span class="line">points = <span class="number">3</span></span><br><span class="line">total = <span class="number">5</span></span><br><span class="line">print(<span class="string">'Correct answers: {:.2%}'</span>.format(points/total))</span><br><span class="line"><span class="comment"># Correct answers: 60.00%</span></span><br></pre></td></tr></tbody></table></figure>

<p>正负符号显示 %+f, %-f, 和 % f的用法</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'{:+f}; {:+f}'</span>.format(<span class="number">3.14</span>, <span class="number">-3.14</span>))  <span class="comment"># 总是显示符号</span></span><br><span class="line"><span class="comment"># +3.140000; -3.140000</span></span><br><span class="line">print(<span class="string">'{: f}; {: f}'</span>.format(<span class="number">3.14</span>, <span class="number">-3.14</span>))  <span class="comment"># 若是+数，则在前面留空格</span></span><br><span class="line"><span class="comment">#  3.140000; -3.140000</span></span><br><span class="line">print(<span class="string">'{:-f}; {:-f}'</span>.format(<span class="number">3.14</span>, <span class="number">-3.14</span>))  <span class="comment"># -数时显示-，与'{:f}; {:f}'一致</span></span><br><span class="line"><span class="comment"># 3.140000; -3.140000</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">width = <span class="number">5</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">5</span>, <span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> base <span class="keyword">in</span> <span class="string">'dXob'</span>:</span><br><span class="line">        print(<span class="string">'{0:{width}{base}}'</span>.format(num, base=base, width=width), end=<span class="string">' '</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"><span class="comment">#     5     5     5   101</span></span><br><span class="line"><span class="comment">#     6     6     6   110</span></span><br><span class="line"><span class="comment">#     7     7     7   111</span></span><br><span class="line"><span class="comment">#     8     8    10  1000</span></span><br><span class="line"><span class="comment">#     9     9    11  1001</span></span><br><span class="line"><span class="comment">#    10     A    12  1010</span></span><br><span class="line"><span class="comment">#    11     B    13  1011</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shi-xian-tong-bu-deng-lu-ji-tui-chu-shi-xian-bu-zou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shi-xian-tong-bu-deng-lu-ji-tui-chu-shi-xian-bu-zou/" class="post-title-link" itemprop="url">实现同步登录及退出实现步骤</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-17 03:14:14" itemprop="dateModified" datetime="2021-06-17T03:14:14Z">2021-06-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="实现同步登录及退出"><a href="#实现同步登录及退出" class="headerlink" title="实现同步登录及退出"></a>实现同步登录及退出</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，准备登录的Django模板、表单<br>新建<code>accounts\templates</code></li>
</ul>
<p><code>accounts\templates\user_info.html</code>新建</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户的基本信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    当前登录的用户是：{{ user.username }}-{{ user.email }}</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  {% if user.is_authenticated %}</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/accounts/user/logout/"</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  {% endif %}</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\templates\user_login.html</code></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.errorlist</span> {</span></span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#f00</span>;</span></span><br><span class="line">    }</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"."</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    {% csrf_token %}</span><br><span class="line">{#    {{ form.as_p }}#}</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 用户名 --&gt;</span></span><br><span class="line">      {{ form.username.label }}</span><br><span class="line">      {{ form.username }}</span><br><span class="line">      {{ form.username.errors.as_text }}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 密码 --&gt;</span></span><br><span class="line">      {{ form.password.label }}</span><br><span class="line">      {{ form.password }}</span><br><span class="line">      {{ form.password.errors.as_text }}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      {{ form.non_field_errors.as_text }}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\forms.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>, max_length=<span class="number">200</span>, min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username, ))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data[<span class="string">'username'</span>]</span><br><span class="line">        password = data[<span class="string">'password'</span>]</span><br><span class="line">        <span class="comment"># username = data.get('username', None)</span></span><br><span class="line">        <span class="comment"># password = data.get('password', None)</span></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">and</span> password:</span><br><span class="line">            <span class="comment"># 查询用户名和密码匹配的用户</span></span><br><span class="line">            user_list = User.objects.filter(username=username)</span><br><span class="line">            err_list = []</span><br><span class="line">            <span class="keyword">if</span> user_list.count() == <span class="number">0</span>:</span><br><span class="line">                err_list.append(forms.ValidationError(<span class="string">'用户名不存在'</span>))</span><br><span class="line">                <span class="comment"># raise forms.ValidationError('用户名不存在')</span></span><br><span class="line">            <span class="comment"># 验证密码是否正确</span></span><br><span class="line">            <span class="comment"># TODO 使用加密算法进行验证</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user_list.filter(password=password).exists():</span><br><span class="line">                <span class="comment"># raise forms.ValidationError('密码不正确')</span></span><br><span class="line">                err_list.append(forms.ValidationError(<span class="string">'密码不正确'</span>))</span><br><span class="line">            <span class="keyword">if</span> err_list:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(err_list)</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\views.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts\urls.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户登录表单</span></span><br><span class="line">    path(<span class="string">'user/login/'</span>, views.user_login, name=<span class="string">'user_login'</span>),</span><br><span class="line">    path(<span class="string">'user/info/'</span>, views.user_info, name=<span class="string">'user_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip\urls.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 用户账户模块</span></span><br><span class="line">    path(<span class="string">'accounts/'</span>, include(<span class="string">'accounts.urls'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第二步，设计用户模型<br><code>accounts\models.py</code></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细信息 """</span></span><br><span class="line">    <span class="comment"># 性别</span></span><br><span class="line">    <span class="comment"># 手机号码</span></span><br><span class="line">    <span class="comment"># 年龄</span></span><br><span class="line">    <span class="comment"># 生日</span></span><br><span class="line">    <span class="comment"># 真实姓名</span></span><br><span class="line">    SEX_CHOICES = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'男'</span>),</span><br><span class="line">        (<span class="number">0</span>, <span class="string">'女'</span>),</span><br><span class="line">    )</span><br><span class="line">    username = models.CharField(<span class="string">'用户名'</span>, max_length=<span class="number">64</span>, unique=<span class="literal">True</span>, editable=<span class="literal">False</span>)</span><br><span class="line">    user = models.OneToOneField(User, related_name=<span class="string">'profile'</span>, on_delete=models.CASCADE)</span><br><span class="line">    real_name = models.CharField(<span class="string">'真实姓名'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    email = models.CharField(<span class="string">'电子邮箱'</span>, max_length=<span class="number">128</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_email_valid = models.BooleanField(<span class="string">'邮箱是否已经验证'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    phone_no = models.CharField(<span class="string">'手机号码'</span>, max_length=<span class="number">20</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_phone_valid = models.BooleanField(<span class="string">'是否已经验证'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    sex = models.SmallIntegerField(<span class="string">'性别'</span>, default=<span class="number">1</span>, choices=SEX_CHOICES)</span><br><span class="line">    age = models.SmallIntegerField(<span class="string">'年龄'</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    source = models.CharField(<span class="string">'登录的来源'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    version = models.CharField(<span class="string">'登录的版本'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated_at = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'accounts_user_profile'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginRecord</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录日志 """</span></span><br><span class="line">    <span class="comment"># 关联用户</span></span><br><span class="line">    <span class="comment"># 登录账号</span></span><br><span class="line">    <span class="comment"># 登录的时间</span></span><br><span class="line">    <span class="comment"># ip</span></span><br><span class="line">    <span class="comment"># 登录的来源</span></span><br><span class="line">    <span class="comment"># 登录的客户端版本号</span></span><br><span class="line">    user = models.ForeignKey(User, related_name=<span class="string">'login_records'</span>, on_delete=models.CASCADE)</span><br><span class="line">    username = models.CharField(<span class="string">'登录的账号'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    ip = models.CharField(<span class="string">'IP'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    address = models.CharField(<span class="string">'地址'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    source = models.CharField(<span class="string">'登录的来源'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line">    version = models.CharField(<span class="string">'登录的版本'</span>, max_length=<span class="number">16</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    created_at = models.DateTimeField(<span class="string">'登录时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'accounts_login_record'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;python manage.py check</span><br><span class="line">&gt;python manage.py makemigrations</span><br><span class="line">&gt;python manage.py migrate</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>第三步，实现用户的同步登录</p>
</li>
<li><p>第四步，添加登录拦截，用户登录了可以看用户信息，没登陆看用户信息先登录</p>
</li>
<li><p>第五步，实现退出登录的功能用户登录</p>
</li>
<li><p>步骤一：认证用户<br><code>user = authenticate(username='john', password='secret')</code><br><code>accounts\forms.py</code></p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>,</span><br><span class="line">                               max_length=<span class="number">200</span>,</span><br><span class="line">                               min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        password = data.get(<span class="string">'password'</span>, <span class="literal">None</span>)</span><br><span class="line">        user = authenticate(username=username, password=password)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'用户名或者是密码不正确'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(<span class="string">'该用户已经被禁用'</span>)</span><br><span class="line">        self.user = user</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>步骤二：判断认证后的用户是否为None<br>用户不为None则表示用户认证通过</p>
</li>
<li><p>步骤三：调用<code>login(request, user, backend=None)</code>函数登录用户<br><code>accounts\forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行用户登录 """</span></span><br><span class="line">        user = self.user</span><br><span class="line">        <span class="comment"># 调用登录</span></span><br><span class="line">        login(request, user)</span><br><span class="line">        <span class="comment"># 修改最后登录的时间</span></span><br><span class="line">        user.last_login = now()</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># TODO 保存登录历史</span></span><br><span class="line">        <span class="keyword">return</span> user</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要登录以后才能访问user_info，</span></span><br><span class="line"><span class="comment"># 否则跳转到登录地址http://127.0.0.1:8000/accounts/user/login/?next=/accounts/user/info/</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="comment"># 方式二  trip/settings.py加上LOGIN_URL = '/accounts/user/login/'</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip/settings.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOGIN_URL = <span class="string">'/accounts/user/login/'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户登录表单</span></span><br><span class="line">    path(<span class="string">'user/login/'</span>, views.user_login, name=<span class="string">'user_login'</span>),</span><br><span class="line">    path(<span class="string">'user/info/'</span>, views.user_info, name=<span class="string">'user_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户退出"><a href="#用户退出" class="headerlink" title="用户退出"></a>用户退出</h3><ul>
<li>使用<code>logout</code>函数退出当前登录的用户<br><code>accounts/views.py</code></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出登录 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户退出登录</span></span><br><span class="line">    path(<span class="string">'user/logout/'</span>, views.user_logout, name=<span class="string">'user_logout'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户登录、退出接口开发"><a href="#用户登录、退出接口开发" class="headerlink" title="用户登录、退出接口开发"></a>用户登录、退出接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 登录和退出的接口</span></span><br><span class="line">    path(<span class="string">'user/api/login/'</span>, views.user_api_login, name=<span class="string">'user_api_login'</span>),</span><br><span class="line">    path(<span class="string">'user/api/logout/'</span>, views.user_api_logout, name=<span class="string">'user_api_logout'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadRequestJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 表单请求验证没有通过，错误显示 """</span></span><br><span class="line">    status_code = <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, err_list=[], *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"400000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"参数格式不正确"</span>,</span><br><span class="line">            <span class="string">"error_list"</span>: err_list</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodNotAllowedJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 请求方式不被允许 """</span></span><br><span class="line">    status_code = <span class="number">405</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"405000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"请求方式不被允许"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 用户的基础信息 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'username'</span>: user.username,</span><br><span class="line">            <span class="string">'nickname'</span>: user.nickname,</span><br><span class="line">            <span class="string">'avatar'</span>: user.avatar.url</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfileSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 用户的详细信息 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        profile = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'real_name'</span>: profile.real_name,</span><br><span class="line">            <span class="string">'sex'</span>: profile.sex,</span><br><span class="line">            <span class="string">'sex_display'</span>: profile.get_sex_display(),</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> UnauthorizedJsonResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录接口-POST """</span></span><br><span class="line">    <span class="comment"># 获取输入的内容</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># 表单验证</span></span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="comment"># 如果通过了验证，执行登录</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            user = form.do_login(request)</span><br><span class="line">            <span class="comment"># 返回内容：用户的信息（用户的基本信息、详细详细）</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果没有通过表单验证，返回表单的错误信息</span></span><br><span class="line">            err = json.loads(form.errors.as_json())</span><br><span class="line">            <span class="keyword">return</span> BadRequestJsonResponse(err)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># GET请求不被允许</span></span><br><span class="line">        <span class="keyword">return</span> MethodNotAllowedJsonResponse()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出接口 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> http.HttpResponse(status=<span class="number">201</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用户详情接口开发"><a href="#用户详情接口开发" class="headerlink" title="用户详情接口开发"></a>用户详情接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
<li>第三步，模拟HTTP请求，测试验证接口<br><code>accounts/urls.py</code></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 用户详细信息接口</span></span><br><span class="line">    path(<span class="string">'user/api/info/'</span>, views.UserDetailView.as_view(), name=<span class="string">'user_api_info'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnauthorizedJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    status_code = <span class="number">401</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"401000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"请登录"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, MethodNotAllowedJsonResponse, UnauthorizedJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetailView</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细接口 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户信息</span></span><br><span class="line">        user = request.user</span><br><span class="line">        <span class="comment"># 用户：是游客吗？数据库中是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated:</span><br><span class="line">            <span class="comment"># 返回401状态码</span></span><br><span class="line">            <span class="keyword">return</span> UnauthorizedJsonResponse()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 返回详细信息</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/wen-jian-cao-zuo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/wen-jian-cao-zuo/" class="post-title-link" itemprop="url">python文件操作和文件编码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-15 06:06:09" itemprop="dateModified" datetime="2021-05-15T06:06:09Z">2021-05-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="文件读写模式"><a href="#文件读写模式" class="headerlink" title="文件读写模式"></a>文件读写模式</h2><p><code>open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)</code><br>打开一个文件，生成并且返回文件对象，在对文件进行处理过程（创建、读写操作）都需要使用到这个函数，如果该文件无法被打开，会抛出 OSError。<br>默认的创建的目录在当前程序所在的目录，文件不存在，则在当前目录创建该文件<br>file：一个包含了你要访问的文件路径的字符串值。</p>
<p>buffering: 设置缓冲<br>buffering:如果buffering的值被设为0，就不会有寄存。<br>如果buffering的值取1，访问文件时会寄存行。<br>如果将buffering的值设为大于1的整数，表明了这就是的寄存区的缓冲大小。<br>如果取负值，寄存区的缓冲大小则为系统默认。</p>
<p>encoding: Windows系统在写入中文时需要设置编码格式，一般使用utf8<br>errors: 报错级别<br>newline: 区分换行符<br>closefd: 传入的file参数类型<br>opener: 设置自定义开启器，开启器的返回值必须是一个打开的文件描述符。</p>
<p>mode 模式是一个可选非强制字符串，指定打开文件的模式。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">```'w'```写入模式，打开一个文件只用于写入。打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被覆盖删除。如果该文件不存在，创建新文件。</span><br><span class="line">指针在开始</span><br><span class="line"></span><br><span class="line">```'a'```追加(Attach)模式，如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</span><br><span class="line">打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。</span><br><span class="line"></span><br><span class="line">```'b'```二进制模式（与其他模式结合使用）binary mode doesn't take an encoding argument，b模式不能再加上encoding</span><br><span class="line"></span><br><span class="line">```'ab'``` 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</span><br><span class="line"></span><br><span class="line">```'rb'```    以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。</span><br><span class="line"></span><br><span class="line">```+```读写模式（与其他模式结合使用），打开一个文件进行更新(可读可写)。</span><br><span class="line"></span><br><span class="line">```'r+'```打开一个文件用于读写。文件指针将会放在文件的开头。</span><br><span class="line">```'W+'```以读写的方式打开文件。打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被覆盖删除。如果该文件不存在，创建新文件。</span><br><span class="line"></span><br><span class="line">```'a+'```如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是读写追加模式。如果该文件不存在，创建新文件用于读写</span><br><span class="line"></span><br><span class="line">```'ab+```以二进制格式打开一个文件用于追加。</span><br><span class="line">如果该文件已存在，文件指针将会放在文件的结尾。</span><br><span class="line">如果该文件不存在，创建新文件用于写入。</span><br><span class="line"></span><br><span class="line">```'rb+'```    以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。</span><br><span class="line"></span><br><span class="line">```'wb'```以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，以二进制格式创建新文件。一般用于非文本文件如图片等。比特类型bytes，字符前缀```b```</span><br><span class="line"></span><br><span class="line">```'wb+'```    以二进制格式打开一个文件用于读写。如果该文件已存在则将其覆盖。如果该文件不存在，创建新文件。</span><br><span class="line"></span><br><span class="line">不使用with语句写法</span><br><span class="line">```py</span><br><span class="line">file=open('文件路径'，访问模式) </span><br><span class="line">data = file.read()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="使用with语法，到达该语句未尾时，将自动close-关闭文件释放资源，即便出现异常亦如此"><a href="#使用with语法，到达该语句未尾时，将自动close-关闭文件释放资源，即便出现异常亦如此" class="headerlink" title="使用with语法，到达该语句未尾时，将自动close()关闭文件释放资源，即便出现异常亦如此"></a>使用<code>with</code>语法，到达该语句未尾时，将自动<code>close()</code>关闭文件释放资源，即便出现异常亦如此</h3><p>中文字体写入默认是GB2312编码。</p>
<ul>
<li><p>不指定编码格式</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open（<span class="string">"file_path"</span>) <span class="keyword">as</span> file：</span><br><span class="line">    do_something(file)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>指定编码格式：<br>指定编码写入，需要打开文件的时候按指定的编码写入，open写encoding编码方式。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 打开</span></span><br><span class="line">file = open(<span class="string">"readme.txt"</span>, <span class="string">"a"</span>, encoding=<span class="string">'utf-8'</span>)  <span class="comment"># a 以追加的方式打开</span></span><br><span class="line"><span class="comment"># 2. 写入文件</span></span><br><span class="line">file.write(<span class="string">"123 hello"</span>)</span><br><span class="line"><span class="comment"># 3. 关闭</span></span><br><span class="line">file.close()</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">当一个文件对象的引用被重新指定给另一个文件时，Python 会关闭之前的文件。</span><br><span class="line">用来关闭文件并立即释放它使用的所有系统资源。如果你没有显式地关闭文件，Python的垃圾回收器最终将销毁该对象并为你关闭打开的文件，但这个文件可能会保持打开状态一段时间。</span><br><span class="line"></span><br><span class="line">一是可能忘记关闭文件句柄；</span><br><span class="line">二是文件读取数据发生异常，没有做异常处理</span><br><span class="line"></span><br><span class="line">一个文件被打开后，你有一个file对象，你可以得到有关该文件对象相关的所有属性的</span><br><span class="line">属性    描述</span><br><span class="line">```file.closed```    返回true如果文件已被关闭，否则返回false。</span><br><span class="line">```file.mode```    返回被打开文件的访问模式。</span><br><span class="line">```file.name```    返回文件的路径。</span><br><span class="line">```py</span><br><span class="line">fo = open("代码\pi_digits.txt", "w")</span><br><span class="line">print("文件路径: ", fo.name)  # 文件路径:  代码\pi_digits.txt</span><br><span class="line">print("是否已关闭 : ", fo.closed)  # 是否已关闭 :  False</span><br><span class="line">print("访问模式 : ", fo.mode)  # 访问模式 :  w</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">如果使用read读了多次，那么后面继续使用read读取的数据是从上次读完后的位置开始的</span><br><span class="line"></span><br><span class="line">```readline([count])```：对文件的数据按行读取，（行的划分是\n）.每次只读取一行。如果有多次读取的话，下面一次读取的偏移量是上面读取后的偏移量。</span><br><span class="line"></span><br><span class="line">```readlines()```：按照行的方式把整个文件中的内容进行一次性读取，读取所有行(直到结束符 EOF)并返回一个列表，其中每一行（按着换行符进行判断一行）的数据为一个元素。</span><br><span class="line"></span><br><span class="line">```write(“string”)```函数向打开的文件对象写入指定字符串，如果文件不存在那么创建，如果存在那么就先清空文件(覆盖)，然后写入数据到文件里。Python字符串可以是二进制数据，而不是仅仅是文字。不会在字符串的结尾添加换行符('\n')</span><br><span class="line"></span><br><span class="line">## 文件编码</span><br><span class="line"></span><br><span class="line">在python 3 中字符是以Unicode的形式存储的，当然这里所说的存储是指存储在计算机内存当中，</span><br><span class="line">如果是存储在硬盘里，Python 3的字符是以bytes形式存储，也就是说如果要将字符写入硬盘，就必须对字符进行encode。</span><br><span class="line">对上面这段话再解释一下，如果要将str写入文件，</span><br><span class="line">如果以`‘w’`模式写入，则要求写入的内容必须是`str`类型；</span><br><span class="line">如果以`‘wb’`形式写入，则要求写入的内容必须是`bytes`类型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python里写入文件出现乱码通常都是因为编码导致的。</span><br><span class="line">很多人说我已经encode设置为utf-8了呀，怎么还会出现乱码呢？</span><br><span class="line">其实这里涉及到2个编码的问题</span><br><span class="line">1、字符串的编码，比如我们爬虫返回的text的编码</span><br><span class="line">2、文件的编码</span><br><span class="line">要想不出现编码，必须保证字符的编码和文件的编码一致。写入模式与写入内容的数据类型</span><br><span class="line">```py</span><br><span class="line">s1 = '你好'</span><br><span class="line"># 如果是以‘w’的方式写入，写入前一定要进行encoding，否则会报错</span><br><span class="line">with open('F:\\1.txt', 'w', encoding='utf-8') as f1:</span><br><span class="line">    f1.write(s1)</span><br><span class="line"></span><br><span class="line">s2 = s1.encode("utf-8")  # 转换为bytes的形式</span><br><span class="line"># 这时候写入方式一定要是‘wb’，且一定不能加encoding参数</span><br><span class="line">with open('F:\\2.txt', 'wb') as f2:</span><br><span class="line">    f2.write(s2)</span><br></pre></td></tr></tbody></table></figure>
<p>有的人会问，我在系统里面用文本编辑器打开以bytes形式写入的2.txt文件，<br>发现里面显示的是‘你好’，而不是‘b’\xe4\xbd\xa0\xe5\xa5\xbd’’，<br>因为文本文档打开2.txt时，又会对它进行decode，然后才给你看到。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">以往后遇加的模式与入文件</span><br><span class="line"></span><br><span class="line">在默认模式下读取文本文件时（二进制文件不可以），文件中的换行符会转换为'\n'形式。</span><br><span class="line"></span><br><span class="line">在默认模式下写入文件时，文本中的'\n'会转换为换行符。</span><br><span class="line"></span><br><span class="line">```tell()```方法告诉你文件内的当前位置, 换句话说，下一次的读写会发生在文件开头这么多字节之后。</span><br><span class="line"></span><br><span class="line">```seek(offset [,from])```方法改变当前文件的位置。Offset变量表示要移动的字节数。From变量指定开始移动字节的参考位置。</span><br><span class="line"></span><br><span class="line">如果from被设为0，这意味着将文件的开头作为移动字节的参考位置。如果设为1，则使用当前的位置作为参考位置。如果它被设为2，那么该文件的末尾将作为参考位置。</span><br><span class="line"></span><br><span class="line">```seek(3)```从文件起始位置偏移3个字符从第4个字符位置开始读取</span><br><span class="line">```seek(0，0)```重新从文件启始位置读取</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">with open(current_path + '/' + 'test1.txt', 'w+',</span><br><span class="line">          encoding='utf-8') as file_object:</span><br><span class="line">    file_object.write('Ashe正在学习Python')</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    #  &lt;class 'str'&gt; 注意前面有一个空格表示content是空字符串</span><br><span class="line">    # 因为此时读取的是最后一个字符，写完内容之后就是空字符串</span><br><span class="line">    file_object.seek(0)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    # Ashe正在学习Python &lt;class 'str'&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line"><span class="keyword">with</span> open(current_path + <span class="string">'/'</span> + <span class="string">'test1.txt'</span>, <span class="string">'ab+'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    string = <span class="string">b'Ashe Python'</span></span><br><span class="line">    file_object.write(string)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    <span class="comment"># b'' &lt;class 'bytes'&gt; 注意前面有一个空格表示content是空字符串</span></span><br><span class="line">    <span class="comment"># 因为此时读取的是最后一个字符，写完内容之后就是空字符串</span></span><br><span class="line">    file_object.seek(<span class="number">0</span>)</span><br><span class="line">    content = file_object.read()</span><br><span class="line">    print(content, type(content))</span><br><span class="line">    <span class="comment"># b'Ashe Python' &lt;class 'bytes'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'代码\generate_text.txt'</span></span><br><span class="line"><span class="comment"># 使用‘w’来提醒python用写入的方式打开 指定编码为</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'I love your name!'</span></span><br><span class="line">                     <span class="string">'\nI love your cloth!'</span></span><br><span class="line">                     <span class="string">'\nI love your shoes!'</span></span><br><span class="line">                     <span class="string">'\nI love your hair!'</span>)</span><br><span class="line"><span class="comment"># 使用‘a’来提醒python用附加模式的方式打开指定编码为'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'\nI an superman.我是超人'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用‘a’来提醒python用附加模式的方式打开不指定编码为'utf-8'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'a'</span>) <span class="keyword">as</span> fileobject:</span><br><span class="line">    fileobject.write(<span class="string">'\nI an superman.我是超人'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.readline()</span><br><span class="line">    print(<span class="string">"第一次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第一次读取:I love your name!</span></span><br><span class="line">    print(<span class="string">"第一次读取:"</span>, content)</span><br><span class="line">    <span class="comment"># 第一次读取:I love your name!</span></span><br><span class="line"></span><br><span class="line">    content = f.readline()</span><br><span class="line">    print(<span class="string">"第二次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第二次读取:I love your cloth!</span></span><br><span class="line"></span><br><span class="line">    content = f.read(<span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"第三次读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 第三次读取:I love</span></span><br><span class="line"></span><br><span class="line">    position = f.tell()</span><br><span class="line">    print(<span class="string">"当前文件位置 : "</span>, position)</span><br><span class="line">    <span class="comment"># 当前文件位置 :  45</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 把指针再次重新定位到文件开头</span></span><br><span class="line">    position = f.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    str = f.read(<span class="number">16</span>)</span><br><span class="line">    print(<span class="string">"读取的字符串是 : "</span>, str)</span><br><span class="line">    <span class="comment"># 读取的字符串是 :  I love your name</span></span><br><span class="line">    position = f.tell()</span><br><span class="line">    print(<span class="string">"当前文件位置 : "</span>, position)</span><br><span class="line">    <span class="comment"># 当前文件位置 :  16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    print(<span class="string">"读取:%s"</span> % content)</span><br><span class="line">    <span class="comment"># 读取:I love your name!</span></span><br><span class="line">    <span class="comment"># I love your cloth!</span></span><br><span class="line">    <span class="comment"># I love your shoes!</span></span><br><span class="line">    <span class="comment"># I love your hair!</span></span><br><span class="line">    <span class="comment"># I an superman.鎴戞槸瓒呬汉</span></span><br><span class="line">    <span class="comment"># I an superman.我是超人</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意如果用read（），读取全部，后面再加read(num),就没有内容可读了。返回空字符串</span></span><br><span class="line">    content = f.read(<span class="number">6</span>)</span><br><span class="line">    print(<span class="string">":%s"</span> % content)</span><br><span class="line">    <span class="comment"># :</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_text.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.readlines()</span><br><span class="line">    print(<span class="string">"读取:%s"</span> % content)</span><br><span class="line"><span class="comment">#     读取:['I love your name!\n', 'I love your cloth!\n', 'I love your </span></span><br><span class="line"><span class="comment"># shoes!\n', 'I love your hair!\n', 'I an superman.鎴戞槸瓒呬汉\n', </span></span><br><span class="line"><span class="comment"># 'I an superman.我是超人']</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 相对文件路径 （优先使用）</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    contents = file_object.read()</span><br><span class="line">    <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">    print(contents.rstrip())</span><br><span class="line">    <span class="comment"># 3.1415926535  </span></span><br><span class="line">    <span class="comment">#   8979323846  </span></span><br><span class="line">    <span class="comment">#   2643383279  </span></span><br><span class="line">    <span class="comment"># 'abc  '     </span></span><br><span class="line">    <span class="comment"># '  abc'     </span></span><br><span class="line">    <span class="comment"># abc</span></span><br><span class="line">    <span class="comment">#   abc  </span></span><br><span class="line">    print(<span class="string">'******'</span>)</span><br><span class="line">    print(contents.lstrip())</span><br><span class="line">    <span class="comment"># 3.1415926535  </span></span><br><span class="line">    <span class="comment">#   8979323846  </span></span><br><span class="line">    <span class="comment">#   2643383279  </span></span><br><span class="line">    <span class="comment"># 'abc  '     </span></span><br><span class="line">    <span class="comment"># '  abc'     </span></span><br><span class="line">    <span class="comment"># abc</span></span><br><span class="line">    <span class="comment">#   abc </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绝对文件路径</span></span><br><span class="line">file_path = <span class="string">'C:\python代码\牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'----'</span>)</span><br><span class="line">    print(file_object.read())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'======'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file_object:</span><br><span class="line">        <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">        print(line.rstrip())  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    print(<span class="string">'^^^^^^^'</span>)</span><br><span class="line">    lines = file_object.readlines()</span><br><span class="line">    print(lines)</span><br><span class="line">    <span class="comment"># ['3.1415926535\n', '  8979323846\n', '  2643383279\n', "'abc  '\n", "'  abc'\n", 'abc\n', '  abc']</span></span><br><span class="line">    <span class="comment"># 遍历列表，将读取的内容显示出来，按照原来文件的行划分。</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="comment"># 多出一个空行的情况下可以使用 rstrip() 来去除字符串后面的空白</span></span><br><span class="line">        print(line.rstrip())串后面的空白</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用文件的内容 读取/拼接</span></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()  <span class="comment"># 读取文件中每行的信息</span></span><br><span class="line">pi_string = <span class="string">''</span>  <span class="comment"># 创建一个字符串</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:  <span class="comment"># 遍历读取到的文件的每行信息 存储到line中</span></span><br><span class="line">    pi_string += line.strip()  <span class="comment"># 读取到的每行信息+创建的字符串  并用strip()去除两端的空格</span></span><br><span class="line">print(pi_string)  <span class="comment"># 输出拼接之后的信息</span></span><br><span class="line"><span class="comment"># 3.141592653589793238462643383279'abc  ''  abc'abcabc</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取一个百万位的大型文件</span></span><br><span class="line"><span class="comment"># 逐行 读取文件的信息 使用readlines()</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\pi_digits.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()  <span class="comment"># 读取文件中每行的信息</span></span><br><span class="line">pi_string = <span class="string">''</span>  <span class="comment"># 创建一个字符串</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:  <span class="comment"># 遍历读取到的文件的每行信息 存储到line中</span></span><br><span class="line">    <span class="comment"># 读取到的每行信息+创建的字符串  并用strip()去除两端的空格</span></span><br><span class="line">    pi_string += line.strip()</span><br><span class="line"><span class="comment"># 输出拼接之后的信息 只输出列表中的前9位 如果输出百万位 把9改为1000000</span></span><br><span class="line">print(pi_string[:<span class="number">9</span>] + <span class="string">'...'</span>)</span><br><span class="line"><span class="comment"># 输出拼接之后的信息的字符串长度</span></span><br><span class="line">print(len(pi_string))</span><br><span class="line"><span class="comment"># 3.1415926...</span></span><br><span class="line"><span class="comment"># 52</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入文件 执行完之后 文件目录中 会生成一个generate_text.txt的文件 </span></span><br><span class="line"><span class="comment"># 内容就是‘正在学习Python’ 在读取写入的文件内容和文件长度</span></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\generate_doc.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python'</span> + <span class="string">'\n'</span>)</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python1'</span> + <span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'a'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">'Ashe正在学习Python'</span> + <span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'r'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    lines = file_object.readlines()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        print(line.strip())</span><br><span class="line">        print(len(line))</span><br><span class="line">        <span class="comment"># Ashe正在学习Python</span></span><br><span class="line">        <span class="comment"># 15</span></span><br><span class="line">        <span class="comment"># Ashe正在学习Python1</span></span><br><span class="line">        <span class="comment"># 16</span></span><br><span class="line">        <span class="comment"># Ashe正在学习Python</span></span><br><span class="line">        <span class="comment"># 15</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提示用户输入自己的姓名 再将用户输入的姓名写入到文件中输出</span></span><br><span class="line"></span><br><span class="line">file_path = <span class="string">'牛客网剑指offer66题思路分析\代码\generate_input.txt'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:  <span class="comment"># w:表示写入(Write)到这个文件中</span></span><br><span class="line">    message = input(<span class="string">'input your name：'</span>)</span><br><span class="line">    file_object.write(message)</span><br><span class="line">    <span class="comment"># input: Ashe</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表数据number存储在number.json 文件中</span></span><br><span class="line">number = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>]</span><br><span class="line">filename = <span class="string">'number.json'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> f_obj:</span><br><span class="line">    <span class="comment"># f_obj:存入到的文件的位置</span></span><br><span class="line">    <span class="comment"># json.dump用来存储。</span></span><br><span class="line">    json.dump(number, f_obj)</span><br><span class="line">    print(<span class="string">'数据存储到'</span> + filename + <span class="string">'完成！'</span>)</span><br><span class="line">    <span class="comment"># 数据存储到number.json完成！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取前面写入到number.json文件的数据内容</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> f_obj:</span><br><span class="line">    <span class="comment"># json.load用来读取。</span></span><br><span class="line">    <span class="comment"># f_obj:读取的数据源的位置</span></span><br><span class="line">    numbers = json.load(f_obj)</span><br><span class="line">    print(numbers)</span><br><span class="line">    <span class="comment"># [2, 3, 4, 5, 7, 11, 13]</span></span><br><span class="line"><span class="comment"># for循环遍历输出读取到的文件中的每条列表中的数据 并 打印输出</span></span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> numbers:</span><br><span class="line">    print(number)</span><br><span class="line">    <span class="comment"># 2</span></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="comment"># 4</span></span><br><span class="line">    <span class="comment"># 5</span></span><br><span class="line">    <span class="comment"># 7</span></span><br><span class="line">    <span class="comment"># 11</span></span><br><span class="line">    <span class="comment"># 13</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data_list = [{</span><br><span class="line">    <span class="string">'href'</span>: <span class="string">'https://bubbleboy11.github.io/'</span>,</span><br><span class="line">    <span class="string">'text'</span>: <span class="string">' 首页'</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'href'</span>: <span class="string">'https://bubbleboy11.github.io/'</span>,</span><br><span class="line">    <span class="string">'text'</span>: <span class="string">' python'</span></span><br><span class="line">}]</span><br><span class="line"><span class="comment"># python按行写入文件</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data_list:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'代码\generate_data.json'</span>, <span class="string">'a+'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        line = json.dumps(item, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">        f.write(line + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按行读取文件的操作方法</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'代码\generate_data.json'</span>, <span class="string">'r'</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 读取所有行 每行会是一个字符串</span></span><br><span class="line">    <span class="keyword">for</span> jsonstr <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="comment"># 将josn字符串转化为dict字典</span></span><br><span class="line">        jsonstr = json.loads(jsonstr)</span><br><span class="line">        print(jsonstr)</span><br><span class="line">        <span class="comment"># {"href": "https://bubbleboy11.github.io/", "text": " 首页"}</span></span><br><span class="line">        <span class="comment"># {"href": "https://bubbleboy11.github.io/", "text": " python"}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">seconds = time.time()</span><br><span class="line">print(seconds)</span><br><span class="line">localtime = time.localtime(seconds)</span><br><span class="line">print(localtime)</span><br><span class="line">print(localtime.tm_year)</span><br><span class="line">print(localtime.tm_mon)</span><br><span class="line">print(localtime.tm_mday)</span><br><span class="line">asctime = time.asctime(localtime)</span><br><span class="line">print(asctime)</span><br><span class="line">strtime = time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>, localtime)</span><br><span class="line">print(strtime)</span><br><span class="line">mydate = time.strptime(<span class="string">'2018-1-1'</span>, <span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">print(mydate)</span><br><span class="line"></span><br><span class="line">shutil.copy(<span class="string">'/Users/Hao/hello.py'</span>, <span class="string">'/Users/Hao/Desktop/first.py'</span>)</span><br><span class="line">os.system(<span class="string">'ls -l'</span>)</span><br><span class="line">os.chdir(<span class="string">'/Users/Hao'</span>)</span><br><span class="line">os.system(<span class="string">'ls -l'</span>)</span><br><span class="line">os.mkdir(<span class="string">'test'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>在项目中需要进行很多重复的操作，如要给代码的源文件添加相同的代码，这个时候一个文件一个文件的操作就很浪费时间了，<br>通过python批处理一秒不到全部添加完成，本代码只是一个抛砖引玉的效果，只要是有特征的文本修改均可由代码完成，解放双手！</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_edit_vhd</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filepath, <span class="string">'r+'</span>) <span class="keyword">as</span> file_head:</span><br><span class="line">        content = file_head.read()</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        file_head.write(<span class="string">"`protect begin \n"</span> + content)</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        file_head.write(<span class="string">"\n`protect end "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_edit_v</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(filepath, <span class="string">'r+'</span>) <span class="keyword">as</span> file_head:</span><br><span class="line">        content = file_head.read()</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        file_head.write(<span class="string">"`protect \n"</span> + content)</span><br><span class="line">        file_head.seek(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        file_head.write(<span class="string">" \n`endprotect "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_text</span>(<span class="params">srcpath</span>):</span>  <span class="comment"># 寻找本文件夹及子文件夹下所以符合要求的文本进行处理</span></span><br><span class="line">    srcdirs = os.listdir(srcpath)</span><br><span class="line">    <span class="keyword">for</span> dir <span class="keyword">in</span> srcdirs:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(os.path.join(srcpath, dir)):  <span class="comment"># 判断dir属性，为文件或者文件夹</span></span><br><span class="line">            add_text(os.path.join(srcpath, dir))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'.vhd'</span> == dir[<span class="number">-4</span>:]:</span><br><span class="line">                print(<span class="string">"正在处理文件中，文件路径为："</span> + os.path.join(srcpath, dir))</span><br><span class="line">                text_edit_vhd(os.path.join(srcpath, dir))</span><br><span class="line">                print(<span class="string">"文件处理完成！"</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">'.v'</span> == dir[<span class="number">-2</span>:]:</span><br><span class="line">                print(<span class="string">"正在处理文件中，文件路径为："</span> + os.path.join(srcpath, dir))</span><br><span class="line">                text_edit_v(os.path.join(srcpath, dir))</span><br><span class="line">                print(<span class="string">"文件处理完成！"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_path = os.getcwd()</span><br><span class="line">print(<span class="string">'当前文件路径为：'</span> + current_path)</span><br><span class="line">os.chdir(<span class="string">'..'</span>)</span><br><span class="line">root_path = os.getcwd()</span><br><span class="line">handle_path = root_path + <span class="string">'\handle'</span></span><br><span class="line">print(<span class="string">'当前文件路径为：'</span> + handle_path)</span><br><span class="line">shutil.copytree(path, handle_path)  <span class="comment"># 备份后进行数据处理</span></span><br><span class="line">add_text(handle_path)</span><br><span class="line">print(<span class="string">"run done\n"</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description   : Checks to see if a directory exists in the users home directory, if not then create it</span></span><br><span class="line"><span class="comment"># 检查主目录中是否存在某文件夹，若不存在则创建</span></span><br><span class="line"><span class="keyword">import</span> os  <span class="comment"># Import the OS module</span></span><br><span class="line"></span><br><span class="line">MESSAGE = <span class="string">'The directory already exists.'</span></span><br><span class="line">TESTDIR = <span class="string">'testdir'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># Set the variable home by expanding the user's set home directory</span></span><br><span class="line">    home = os.path.expanduser(<span class="string">"~"</span>)</span><br><span class="line">    print(home)  <span class="comment"># Print the location</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># os.path.join() for making a full path safely</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.join(home, TESTDIR)):</span><br><span class="line">        <span class="comment"># If not create the directory, inside their home directory</span></span><br><span class="line">        os.makedirs(os.path.join(home, TESTDIR))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(MESSAGE)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_package</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'%s 已经存在不可创建'</span> % path)</span><br><span class="line">    os.makedirs(path)</span><br><span class="line">    init_path = os.path.join(path, <span class="string">'__init__.py'</span>)</span><br><span class="line">    f = open(init_path, <span class="string">'w'</span>)</span><br><span class="line">    f.write(<span class="string">'# coding:utf-8\n'</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, path, mode=<span class="string">'w'</span>, is_return=True</span>):</span></span><br><span class="line">        self.path = path</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.is_return = is_return</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, message</span>):</span></span><br><span class="line">        f = open(self.path, mode=self.mode)</span><br><span class="line">        <span class="keyword">if</span> self.is_return:</span><br><span class="line">            message = <span class="string">'%s\n'</span> % message</span><br><span class="line">        f.write(message)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self, is_strip=True</span>):</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">with</span> open(self.path, mode=self.mode) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">if</span> is_strip == <span class="literal">True</span>:</span><br><span class="line">                temp = line.strip()</span><br><span class="line">                <span class="keyword">if</span> temp != <span class="string">""</span>:</span><br><span class="line">                    result.append(temp)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> line != <span class="string">''</span>:</span><br><span class="line">                    result.append(line)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    current_path = os.getcwd()</span><br><span class="line">    <span class="comment"># path = os.path.join(current_path, 'test1')</span></span><br><span class="line">    <span class="comment"># create_package(path)</span></span><br><span class="line">    <span class="comment"># open_path = os.path.join(current_path, 'b.txt')</span></span><br><span class="line">    o = Open(<span class="string">'package_datetime.py'</span>, mode=<span class="string">'r'</span>)</span><br><span class="line">    <span class="comment"># o.write('你好 小慕')</span></span><br><span class="line">    data = o.read(is_strip=<span class="literal">False</span>)</span><br><span class="line">    print(data)</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-yan-zheng-ma-huo-qu-jie-kou-lian-diao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-yan-zheng-ma-huo-qu-jie-kou-lian-diao/" class="post-title-link" itemprop="url">验证码获取接口联调</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-02 12:32:30" itemprop="dateModified" datetime="2021-05-02T12:32:30Z">2021-05-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="短信验证码接口开发"><a href="#短信验证码接口开发" class="headerlink" title="短信验证码接口开发"></a>短信验证码接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
</ul>
<p><code>utils/response.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerErrorJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    status_code = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"500000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"服务器正忙，请稍后重试"</span>,</span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>


<p>验证码只存取5分钟，之后自动删除，用redis实现验证码缓存<br><code>system/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendSmsCodeForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 发送验证码的表单 """</span></span><br><span class="line">    phone_num = forms.CharField(label=<span class="string">'手机号码'</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_phone_num</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证是否为手机号 """</span></span><br><span class="line">        phone_num = self.cleaned_data[<span class="string">'phone_num'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, phone_num):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(phone_num,))</span><br><span class="line">        <span class="keyword">return</span> phone_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_sms_code</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 生成验证码并发送短信 """</span></span><br><span class="line">        sms_code = random.randint(<span class="number">100000</span>, <span class="number">999999</span>)</span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'phone_num'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># TODO 调用发送验证码的短信接口</span></span><br><span class="line">            <span class="comment"># redis中的key</span></span><br><span class="line">            key = <span class="string">'sms_code_{}'</span>.format(phone_num)</span><br><span class="line">            <span class="comment"># 将验证码存入redis</span></span><br><span class="line">            timeout = <span class="number">5</span> * <span class="number">60</span></span><br><span class="line">            cache.set(key, sms_code, timeout=timeout)</span><br><span class="line">            <span class="keyword">return</span> {</span><br><span class="line">                <span class="string">'phone_num'</span>: phone_num,</span><br><span class="line">                <span class="string">'sms_code'</span>: sms_code,</span><br><span class="line">                <span class="string">'timeout'</span>: timeout</span><br><span class="line">            }</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>system/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> FormView</span><br><span class="line"><span class="keyword">from</span> system.forms <span class="keyword">import</span> SendSmsCodeForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, ServerErrorJsonResponse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_sms</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 1. 拿到手机号，判断是否为真实的手机号码</span></span><br><span class="line">    <span class="comment"># 2. 生成验证码，并存储</span></span><br><span class="line">    <span class="comment"># TODO 3. 调用短信的发送接口</span></span><br><span class="line">    <span class="comment"># 4. 告诉用户验证码发送是否成功（会把验证码直接告诉用户）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmsCodeView</span>(<span class="params">FormView</span>):</span></span><br><span class="line">    form_class = SendSmsCodeForm</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_valid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单已经通过验证 """</span></span><br><span class="line">        data = form.send_sms_code()</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> ServerErrorJsonResponse()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_invalid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单没有通过验证 """</span></span><br><span class="line">        err_list = json.loads(form.errors.as_json())</span><br><span class="line">        <span class="keyword">return</span> BadRequestJsonResponse(err_list)</span><br></pre></td></tr></tbody></table></figure>

<p><code>system/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 发送验证码</span></span><br><span class="line">    path(<span class="string">'send/sms/'</span>, views.SmsCodeView.as_view(), name=<span class="string">"send_sms"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="用户注册接口开发"><a href="#用户注册接口开发" class="headerlink" title="用户注册接口开发"></a>用户注册接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>第一步，设计接口返回内容及字段</li>
<li>第二步，编写接口代码</li>
</ul>
<p><code>utils/constants.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户注册时，发送验证码的redis key</span></span><br><span class="line">REGISTER_MSM_CODE_KEY = <span class="string">'reg_sms_'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>system/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SendSmsCodeForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 发送验证码的表单 """</span></span><br><span class="line">    phone_num = forms.CharField(label=<span class="string">'手机号码'</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_phone_num</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证是否为手机号 """</span></span><br><span class="line">        phone_num = self.cleaned_data[<span class="string">'phone_num'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, phone_num):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(phone_num,))</span><br><span class="line">        <span class="keyword">return</span> phone_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_sms_code</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 生成验证码并发送短信 """</span></span><br><span class="line">        sms_code = random.randint(<span class="number">100000</span>, <span class="number">999999</span>)</span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'phone_num'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># TODO 调用发送验证码的短信接口</span></span><br><span class="line">            <span class="comment"># redis中的key</span></span><br><span class="line">            key = <span class="string">'{}{}'</span>.format(constants.REGISTER_MSM_CODE_KEY, phone_num)</span><br><span class="line">            <span class="comment"># 将验证码存入redis</span></span><br><span class="line">            timeout = <span class="number">5</span> * <span class="number">60</span></span><br><span class="line">            cache.set(key, sms_code, timeout=timeout)</span><br><span class="line">            <span class="keyword">return</span> {</span><br><span class="line">                <span class="string">'phone_num'</span>: phone_num,</span><br><span class="line">                <span class="string">'sms_code'</span>: sms_code,</span><br><span class="line">                <span class="string">'timeout'</span>: timeout</span><br><span class="line">            }</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/forms.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> now</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User, Profile</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 登录表单 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'用户名'</span>,</span><br><span class="line">                               max_length=<span class="number">100</span>,</span><br><span class="line">                               required=<span class="literal">False</span>,</span><br><span class="line">                               help_text=<span class="string">'使用帮助'</span>,</span><br><span class="line">                               initial=<span class="string">'admin'</span>)</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>,</span><br><span class="line">                               max_length=<span class="number">200</span>,</span><br><span class="line">                               min_length=<span class="number">6</span>,</span><br><span class="line">                               widget=forms.PasswordInput)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 当前登录的用户</span></span><br><span class="line">        self.user = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        print(data)</span><br><span class="line">        <span class="comment"># 如果单个字段有错误，直接返回，不执行后面的验证</span></span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        username = data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        password = data.get(<span class="string">'password'</span>, <span class="literal">None</span>)</span><br><span class="line">        user = authenticate(username=username, password=password)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'用户名或者是密码不正确'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user.is_active:</span><br><span class="line">                <span class="keyword">raise</span> forms.ValidationError(<span class="string">'该用户已经被禁用'</span>)</span><br><span class="line">        self.user = user</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_login</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行用户登录 """</span></span><br><span class="line">        user = self.user</span><br><span class="line">        <span class="comment"># 调用登录</span></span><br><span class="line">        login(request, user)</span><br><span class="line">        <span class="comment"># 修改最后登录的时间</span></span><br><span class="line">        user.last_login = now()</span><br><span class="line">        user.save()</span><br><span class="line">        <span class="comment"># TODO 保存登录历史</span></span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterForm</span>(<span class="params">forms.Form</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册 """</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'手机号码'</span>, max_length=<span class="number">16</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入手机号码'</span></span><br><span class="line">    })</span><br><span class="line">    password = forms.CharField(label=<span class="string">'密码'</span>, max_length=<span class="number">128</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入密码'</span></span><br><span class="line">    })</span><br><span class="line">    nickname = forms.CharField(label=<span class="string">'昵称'</span>, max_length=<span class="number">16</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入昵称'</span></span><br><span class="line">    })</span><br><span class="line">    sms_code = forms.CharField(label=<span class="string">'验证码'</span>, max_length=<span class="number">6</span>, required=<span class="literal">True</span>, error_messages={</span><br><span class="line">        <span class="string">'required'</span>: <span class="string">'请输入验证码'</span></span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_username</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 验证用户名 hook 钩子函数 """</span></span><br><span class="line">        username = self.cleaned_data[<span class="string">'username'</span>]</span><br><span class="line">        pattern = <span class="string">r'^1[0-9]{10}$'</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(pattern, username):</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号%s输入不正确'</span>,</span><br><span class="line">                                        code=<span class="string">'invalid_phone'</span>,</span><br><span class="line">                                        params=(username,))</span><br><span class="line">        <span class="keyword">if</span> User.objects.filter(username=username).exists():</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'手机号已经被使用'</span>)</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_nickname</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 昵称验证 """</span></span><br><span class="line">        nickname = self.cleaned_data[<span class="string">'nickname'</span>]</span><br><span class="line">        <span class="keyword">if</span> User.objects.filter(nickname=nickname).exists():</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'昵称已经被使用'</span>)</span><br><span class="line">        <span class="keyword">return</span> nickname</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = super().clean()</span><br><span class="line">        <span class="keyword">if</span> self.errors:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        phone_num = self.cleaned_data.get(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">        sms_code = self.cleaned_data.get(<span class="string">'sms_code'</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># redis 中的验证码key</span></span><br><span class="line">        key = <span class="string">'{}{}'</span>.format(constants.REGISTER_MSM_CODE_KEY, phone_num)</span><br><span class="line">        code = cache.get(key)</span><br><span class="line">        <span class="comment"># code 已失效</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> code:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'验证码已经失效'</span>)</span><br><span class="line">        <span class="keyword">if</span> str(code) != sms_code:</span><br><span class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'验证码输入不正确'</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">    @transaction.atomic</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_register</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="string">""" 执行注册 """</span></span><br><span class="line">        data = self.cleaned_data</span><br><span class="line">        version = request.headers.get(<span class="string">'version'</span>, <span class="string">''</span>)</span><br><span class="line">        source = request.headers.get(<span class="string">'source'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 1. 创建基础信息表</span></span><br><span class="line">            user = User.objects.create_user(</span><br><span class="line">                username=data.get(<span class="string">'username'</span>, <span class="literal">None</span>),</span><br><span class="line">                password=data.get(<span class="string">'password'</span>, <span class="literal">None</span>),</span><br><span class="line">                nickname=data.get(<span class="string">'nickname'</span>, <span class="literal">None</span>)</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># 2. 创建详细表</span></span><br><span class="line">            profile = Profile.objects.create(</span><br><span class="line">                user=user,</span><br><span class="line">                username=user.username,</span><br><span class="line">                version=version,</span><br><span class="line">                source=source</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># 3. 执行登录</span></span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="comment"># 4. 记录登录日志</span></span><br><span class="line">            user.last_login = now()</span><br><span class="line">            user.save()</span><br><span class="line">            ip = request.META.get(<span class="string">'REMOTE_ADDR'</span>, <span class="string">''</span>)</span><br><span class="line">            user.add_login_record(username=user.username, ip=ip, source=source, version=version)</span><br><span class="line">            <span class="keyword">return</span> user, profile</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> FormView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> accounts.forms <span class="keyword">import</span> LoginForm, RegisterForm</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> BadRequestJsonResponse, MethodNotAllowedJsonResponse, UnauthorizedJsonResponse, \</span><br><span class="line">    ServerErrorJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.do_login(request)</span><br><span class="line">            print(<span class="string">'表单验证通过'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(form.errors)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_login.html'</span>, {</span><br><span class="line">        <span class="string">'form'</span>: form</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要登录以后才能访问user_info，</span></span><br><span class="line"><span class="comment"># 否则跳转到登录地址http://127.0.0.1:8000/accounts/user/login/?next=/accounts/user/info/</span></span><br><span class="line"><span class="comment"># 方式一</span></span><br><span class="line"><span class="comment"># @login_required(login_url='/accounts/user/login/')</span></span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_info</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户信息 """</span></span><br><span class="line">    print(request.user)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_info.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出登录 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/accounts/user/info/'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户登录接口-POST """</span></span><br><span class="line">    <span class="comment"># 获取输入的内容</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># 表单验证</span></span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="comment"># 如果通过了验证，执行登录</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            user = form.do_login(request)</span><br><span class="line">            <span class="comment"># 返回内容：用户的信息（用户的基本信息、详细详细）</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果没有通过表单验证，返回表单的错误信息</span></span><br><span class="line">            err = json.loads(form.errors.as_json())</span><br><span class="line">            <span class="keyword">return</span> BadRequestJsonResponse(err)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># GET请求不被允许</span></span><br><span class="line">        <span class="keyword">return</span> MethodNotAllowedJsonResponse()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_logout</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户退出接口 """</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> http.HttpResponse(status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDetailView</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="string">""" 用户详细接口 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 获取用户信息</span></span><br><span class="line">        user = request.user</span><br><span class="line">        <span class="comment"># 用户：是游客吗？数据库中是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated:</span><br><span class="line">            <span class="comment"># 返回401状态码</span></span><br><span class="line">            <span class="keyword">return</span> UnauthorizedJsonResponse()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 返回详细信息</span></span><br><span class="line">            profile = user.profile</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_api_register</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册 """</span></span><br><span class="line">    <span class="comment"># 1. 表单，验证用户输入的信息（用户名、昵称、验证码）</span></span><br><span class="line">    <span class="comment"># 2. 创建用户基础信息表、用户详细信息表</span></span><br><span class="line">    <span class="comment"># 3. 执行登录</span></span><br><span class="line">    <span class="comment"># 4. 保存登录日志</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRegisterView</span>(<span class="params">FormView</span>):</span></span><br><span class="line">    <span class="string">""" 用户注册接口 """</span></span><br><span class="line">    form_class = RegisterForm</span><br><span class="line">    http_method_names = [<span class="string">'post'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_valid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单已经通过验证 """</span></span><br><span class="line">        result = form.do_register(request=self.request)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            user, profile = result</span><br><span class="line">            data = {</span><br><span class="line">                <span class="string">'user'</span>: serializers.UserSerializer(user).to_dict(),</span><br><span class="line">                <span class="string">'profile'</span>: serializers.UserProfileSerializer(profile).to_dict()</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> ServerErrorJsonResponse()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_invalid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单没有通过验证 """</span></span><br><span class="line">        err_list = json.loads(form.errors.as_json())</span><br><span class="line">        <span class="keyword">return</span> BadRequestJsonResponse(err_list)</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">   <span class="comment"># 用户注册</span></span><br><span class="line">    path(<span class="string">'user/api/register/'</span>, views.UserRegisterView.as_view(), name=<span class="string">'user_api_register'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="验证码获取接口联调"><a href="#验证码获取接口联调" class="headerlink" title="验证码获取接口联调"></a>验证码获取接口联调</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，阅读接口文档</li>
<li>第二步，配置接口地址<br><code>src\utils\apis.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统模块的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> SystemApis = {</span><br><span class="line">  <span class="comment">// 发送短信验证码</span></span><br><span class="line">  sendSmsCodeUrl: apiHost + <span class="string">'/system/send/sms/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>src\components\common\SendSmsCode.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 短信验证码发送相关的逻辑 --&gt;</span><br><span class="line">  &lt;van-button</span><br><span class="line">    size="small"</span><br><span class="line">    type="primary"</span><br><span class="line">    @click.prevent="sendSmsCode()"</span><br><span class="line">    :disabled="isSmsSend"</span><br><span class="line">    &gt;{{ sendBtnText }}&lt;/van-button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SystemApis } from '@/utils/apis'</span><br><span class="line">export default {</span><br><span class="line">  props: ['phoneNum'],</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 是否已经发送了验证码，不能再点击发送验证码</span><br><span class="line">      isSmsSend: false,</span><br><span class="line">      sendBtnText: '点击发送验证码',</span><br><span class="line">      timer: null,</span><br><span class="line">      counter: 60</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    reset () {</span><br><span class="line">      this.isSmsSend = false</span><br><span class="line">      this.sendBtnText = '点击发送验证码'</span><br><span class="line">      if (this.timer) {</span><br><span class="line">        clearInterval(this.timer)</span><br><span class="line">        this.counter = 60</span><br><span class="line">        this.timer = null</span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 倒计时</span><br><span class="line">     */</span><br><span class="line">    countDown () {</span><br><span class="line">      this.timer = setInterval(() =&gt; {</span><br><span class="line">        this.sendBtnText = `(${this.counter}秒)后重新发送`</span><br><span class="line">        this.counter--</span><br><span class="line">        if (this.counter &lt; 0) {</span><br><span class="line">          this.reset()</span><br><span class="line">        }</span><br><span class="line">      }, 1000)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 发送验证码</span><br><span class="line">     */</span><br><span class="line">    sendSmsCode () {</span><br><span class="line">      // 判断手机号是否已经输入</span><br><span class="line">      if (!this.phoneNum) {</span><br><span class="line">        this.$notify('请输入手机号')</span><br><span class="line">        return false // 不在执行后面的逻辑</span><br><span class="line">      }</span><br><span class="line">      // TODO 调用接口，发送短信验证码</span><br><span class="line">      ajax.post(SystemApis.sendSmsCodeUrl, {</span><br><span class="line">        phone_num: this.phoneNum</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        // 提示用户验证码已经发送</span><br><span class="line">        this.$notify({</span><br><span class="line">          message: `验证码为：${data.sms_code}，${data.timeout / 60}分钟内有效`,</span><br><span class="line">          duration: 1000 * 10, // 提示持续时间 </span><br><span class="line">          type: 'success'</span><br><span class="line">        })</span><br><span class="line">        this.isSmsSend = true</span><br><span class="line">        // 开启倒计时, 60s之后才能再次点击</span><br><span class="line">        this.countDown()</span><br><span class="line">      }).catch(err =&gt; {</span><br><span class="line">        // 如果产生了异常，提示用户重新操作</span><br><span class="line">        this.isSmsSend = false</span><br><span class="line">        this.sendBtnText = '点击发送验证码'</span><br><span class="line">        console.log(err)</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>第三步，使用axios获取数据</li>
<li>第四步，将数据设置到模型层</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lian-biao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lian-biao/" class="post-title-link" itemprop="url">链表</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-24 17:03:25" itemprop="dateModified" datetime="2021-04-24T17:03:25Z">2021-04-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>python用类来实现链表的数据结构</p>
<p>数组 就是连续的 同一个类型的 元素，而且必须是固定的长度。<br>把数组看做一个内存空间，数组下标就是这个空间的地址，支持根据下标快速访问。<br>但连续存储的缺点也很明显，增加容量，增删元素的成本很高，时间复杂度均为 O(n)。<br>增加数组容量需要先申请一块新的内存，然后复制原有的元素。<br>如果需要的话，可能还要删除原先的内存。</p>
<p>线性表的实际存储方式，分为两种实现模型：<br>1顺序表的构建需要预先知道数据大小来申请连续的存储空间，<br>将元素顺序地存放在一块连续的存储区里<br>而在进行扩充时又需要进行数据的搬迁，<br>元素间的顺序关系由它们的存储顺序自然表示。<br>访问指定元素时无需从头遍历，通过计算便可获得对应地址，其时间复杂度为O(1)。<br>一个顺序表的完整信息包括两部分，<br>一部分是表中的元素集合，<br>另一部分是为实现正确操作而需记录的信息，即有关表的整体情况的信息，<br>这部分信息主要包括元素存储区的容量和当前表中已有的元素个数两项。</p>
<p>2.链表Linked list：知道了它的头就知道了它的全部，所以最后直接返回头节<br>算法题的自变量head都是链表头节点，不是链表<br>将元素存放在通过链接构造起来的一系列存储块中。<br>如果我们想要非固定的长度来存储数据。这个时候就出现了表链。<br>链表是一种物理存储单元上非连续、非顺序的存储结构，<br>链表失去了顺序表随机读取的优点，同时链表由于增加了结点的指针域，<br>空间开销比较大，但对存储空间的使用要相对灵活。<br>充分利用计算机内存空间，实现灵活的内存动态管理。<br>数据元素的逻辑顺序是通过链表中的指针链接次序实现的。</p>
<p>顺序表查找很快，主要耗时的操作是拷贝覆盖。<br>因为除了目标元素在尾部的特殊情况，<br>顺序表进行插入和删除时需要对操作点之后的所有元素进行前后移位操作，<br>只能通过拷贝和覆盖的方法进行。</p>
<p>相比于线性表顺序结构，操作复杂。由于不必须按顺序存储，<br>链表在插入的时候可以达到O(1)的复杂度，<br>但是查找一个节点或者访问特定编号的节点，不能像数组一样随机根据下标访问，<br>你想查找一个元素只能老老实实从头遍历，则需要O(n)的时间，</p>
<p>无法高效获取长度，无法根据偏移快速访问元素，是链表的两个劣势。<br>面试的时候经常碰见诸如获取倒数第k个元素，获取中间位置的元素，<br>判断链表是否存在环，判断环的长度等和长度与位置有关的问题。<br>这些问题都可以通过灵活运用双指针来解决。<br>双指针并不是固定的公式，而是一种思维方式</p>
<p>链表中的基本要素：<br>1.节点类（Node）或元素，单链表每个结点有两个域，<br>左边部份叫值域（数据域），value 属性保存数据元素的值。<br>头结点的内存地址没有存储在其他结点的指针域<br>右边叫指针域(next)，有一个指针保存指向下一个节点地址位置，next存储直接后继存储位置的域<br>用 node.next 访问下一个节点。最后一个结点的next指向为None(空值)</p>
<p>对于单链表结构可以使用 class 的两个属性表示 val , next。<br>由一系列结点（链表中每一个元素称为结点）组成，<br>结点可以在运行时动态生成。</p>
<p>实现一个Node类：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.val = x  <span class="comment"># val: 节点保存的数据元素</span></span><br><span class="line">        self.next = <span class="literal">None</span>  <span class="comment"># next: 保存下一个节点对象的地址</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>此节点类只有一个构建函数，接收一个数据参数，<br>其中next表示指针域的指针，</p>
<p>实例化后得到一个节点对象</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node = Node(<span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>此节点对象数据为4，指针指向None。</p>
<p><img src="/2020/08/21/lian-biao/python代码\牛客网剑指offer66题思路分析\图解说明\节点.jpg" alt="linked_list"><br>2.head结点，head结点永远指向第一个结点<br>3.tail结点，tail结点永远指向最后一个节点<br>4.None，链表中最后一个结点tail指针域的指针next指向None值，</p>
<p><img src="/2020/08/21/lian-biao/%E5%9B%BE%E8%A7%A3%E8%AF%B4%E6%98%8E%5C%E9%93%BE%E8%A1%A8.png" alt="linked_list">  </p>
<p><img src="/2020/08/21/lian-biao/python代码\牛客网剑指offer66题思路分析\图解说明\append1.jpg"><br><img src="/2020/08/21/lian-biao/python代码\牛客网剑指offer66题思路分析\图解说明\链表.png"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span>  <span class="comment"># 传入一个参数</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Node(<span class="number">1</span>)</span><br><span class="line">b = Node(<span class="number">2</span>)</span><br><span class="line">c = Node(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">a.next = b</span><br><span class="line">b.next = c</span><br><span class="line"></span><br><span class="line">head = a</span><br><span class="line"></span><br><span class="line">print(a.next.val)  <span class="comment"># 2</span></span><br><span class="line">print(a.next.next.val)  <span class="comment"># 3</span></span><br><span class="line">print(a.next.next.next.val)</span><br><span class="line"><span class="comment"># AttributeError: 'NoneType' object has no attribute 'val'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 链表的创建</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_linklist_head</span>(<span class="params">li</span>):</span></span><br><span class="line">    <span class="comment"># 头插</span></span><br><span class="line">    head = Node(li[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> li[<span class="number">1</span>:]:</span><br><span class="line">        node = Node(item)  <span class="comment"># Node类实例化得到一个节点对象</span></span><br><span class="line">        node.next = head  <span class="comment"># next指向原来的头部</span></span><br><span class="line">        head = node  <span class="comment"># head 指向在头部插入的节点</span></span><br><span class="line">    <span class="keyword">return</span> head  <span class="comment"># 返回头部</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_linklist_tail</span>(<span class="params">li</span>):</span></span><br><span class="line">    <span class="comment"># 尾插</span></span><br><span class="line">    head = Node(li[<span class="number">0</span>])</span><br><span class="line">    tail = head</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> li[<span class="number">1</span>:]:</span><br><span class="line">        node = Node(item)  <span class="comment"># Node类实例化得到一个节点对象</span></span><br><span class="line">        tail.next = node  <span class="comment"># 把原来尾巴的下一个指针指向当前node</span></span><br><span class="line">        tail = node  <span class="comment"># 尾巴 指向新部插入的节点</span></span><br><span class="line">    <span class="keyword">return</span> head  <span class="comment"># 返回头部</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_linklist</span>(<span class="params">linklist</span>):</span></span><br><span class="line">    <span class="keyword">while</span> linklist:</span><br><span class="line">        print(linklist.val, end=<span class="string">', '</span>)</span><br><span class="line">        linklist = linklist.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lk = create_linklist_head([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print_linklist(lk)  <span class="comment"># 3, 2, 1,</span></span><br><span class="line">lk_tail = create_linklist_tail([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print_linklist(lk_tail)  <span class="comment"># 1, 2, 3,</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedListNode</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, next=None, value=None</span>):</span></span><br><span class="line">        self.next = next</span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个链表</span></span><br><span class="line">lk_head = LinkedListNode()</span><br><span class="line">myList = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(myList)):</span><br><span class="line">    lk_head = LinkedListNode(lk_head, myList[i])</span><br><span class="line">print(lk_head)  <span class="comment"># &lt;__main__.LinkedListNode object at 0x00000271CCFBFDF0&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_linklist</span>(<span class="params">lk</span>):</span>  <span class="comment"># lk任意命名</span></span><br><span class="line">    <span class="keyword">while</span> lk:</span><br><span class="line">        print(lk.value, end=<span class="string">', '</span>)</span><br><span class="line">        lk = lk.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 头插：链表新插入的节点在表头，</span></span><br><span class="line"><span class="comment"># 因此，实际上链表中的顺序，与插入列表的顺序是反过来 逆序</span></span><br><span class="line">print_linklist(lk_head)  <span class="comment"># 5, 4, 3, 2, 1, None,</span></span><br></pre></td></tr></tbody></table></figure>

<p>链表的常用方法：</p>
<figure class="highlight plain"><figcaption><span>创建空链表，不需要参数，返回值是空链表</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```is_empty()``` 测试链表是否为空，不需要参数，只需要检查head节点是否指向None</span><br><span class="line">```python</span><br><span class="line">def is_empty(self):</span><br><span class="line">    return self.head is None</span><br></pre></td></tr></tbody></table></figure>
<p>返回值是布尔值，如果是空列表返回True，否则返回False</p>
<figure class="highlight plain"><figcaption><span>尾插：在尾部增加一个元素作为链表最后一个</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">参数是要追加的元素，无返回值</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">def append(self, data):</span><br><span class="line">        node = Node(data)</span><br><span class="line">        if self.head is None:  # head指向None，链表是一个空链表</span><br><span class="line">            self.head = node  # 把链表的head和tail都指向了node，</span><br><span class="line">            self.tail = node</span><br><span class="line">        else:  # 当链表不是空链表时</span><br><span class="line">            self.tail.next = node  # 将尾节点的next指向新节点</span><br><span class="line">            self.tail = node  # 将尾节点指向新节点</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link_list(append(<span class="number">4</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>增加第二个节点的操作需要分两步完成，<br>第一步：self.tail.next = node，即把上一个节点的next指针指向当前node；<br>第二步：self.tail = node，把tail移动到node，</p>
<p>当if self.head is None:为False时,<br>说明链表已经增加了一个节点了，<br>再增加一个节点时head已经指向了第一个节点，<br>所以不为None，<br>比如增加的第二个节点为：</p>
<p>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append1.jpg<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append2.jpg<br>当增加第三个、第四个等节点时，按照上边的操作依次类推。</p>
<figure class="highlight plain"><figcaption><span>遍历链表，无参数，无返回值，此方法一般是一个生成器</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在遍历链表时也要首先考虑空链表的情况。</span><br><span class="line">遍历链表时从head开始，直到一个节点的next指向None结束</span><br><span class="line">```python</span><br><span class="line">def iter(self):</span><br><span class="line">        if not self.head:</span><br><span class="line">            return</span><br><span class="line">        cur = self.head</span><br><span class="line">        yield cur.data</span><br><span class="line">        while cur.next:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            yield cur.data</span><br></pre></td></tr></tbody></table></figure>
<p>当是遍历一个空链表时，if not self.head:为True，直接返回None；<br>如果不是空链表就让一个局部变量cur指向head,<br>并把head的data属性yield出来，<br>再对cur的next指针指向的对象做while循环，<br>直到next指向None，这样就遍历了链表。</p>
<p>insert(idx,value) 插入一个元素，参数为插入元素的索引和值<br>假如采取append方法又增加了两个节点，增加完成后如下图：<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\append3.jpg</p>
<p>如果想在数据域为6的那节点处插入一个节点，需要做的操作有两步：<br>1.把新节点的next指针指向数据域为6的这个节点，即为数据域为5节点的next指向指向的对象<br>2.把数据域为5节点的next指针指向新加的节点<br>注： 这两个步骤不能颠倒，如果颠倒，数据域为6的节点会被丢失，数据域为7的节点不再是链表的节点。<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\insert.jpg</p>
<p>还要额外考虑两种情况：<br>1.空链表时<br>2.插入位置超出链表节点的长度时<br>3.插入位置是链表的最后一个节点时，需要移动tail<br>当是在链表最后一个节点插入时，示意图如下：<br>[]C:\python代码\牛客网剑指offer66题思路分析\图解说明\insert2.jpg<br>要在指定的索引位置插入一个节点，前提是需要找到这个位置，<br>在链表中只有采用遍历的方式，具有O(n)的速度，<br>最糟糕时会遍历链表的所有节点，<br>而当找到插入点时，我们并不需要当前节点的信息，<br>而是需要前一个节点的信息，<br>所以代码中巧妙的使用了while cur_idx &lt; idx-1:的方式，<br>这样能使用cur这个变量能指向插入点上一个节点对象。<br>实现insert方法的代码如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, idx, value</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="comment"># 在某元素后插入</span></span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx<span class="number">-1</span>:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        node = Node(value)</span><br><span class="line">        node.next = cur.next  <span class="comment"># 新插入的节点指向第一个的原来next的指向</span></span><br><span class="line">        cur.next = node</span><br><span class="line">        <span class="keyword">if</span> node.next <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.tail = node</span><br></pre></td></tr></tbody></table></figure>

<p>remove(idx)移除1个元素，参数为要移除的元素或索引，并修改链表<br>接收一个idx参数，表示要删除节点的索引，此方法要考虑以下几种情况：<br>1.空链表，直接抛出异常<br>2.删除第一个节点时，移动head到删除节点的next指针指向的对象<br>3.链表只有一个节点时，把head与tail都指向None即可<br>4.删除最后一个节点时，需要移动tail到上一个节点<br>5.遍历链表时要判断给定的索引是否大于链表的长度，如果大于则抛出异常信息<br>O(n)</p>
<p>请看下边图例：<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\remove1.jpg<br>C:\python代码\牛客网剑指offer66题思路分析\图解说明\remove2.jpg<br>以下为remove函数的代码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">       cur = self.head</span><br><span class="line">       cur_idx = <span class="number">0</span></span><br><span class="line">       <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 空链表时</span></span><br><span class="line">           <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">       <span class="keyword">while</span> cur_idx &lt; idx<span class="number">-1</span>:</span><br><span class="line">           cur = cur.next</span><br><span class="line">           <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">               <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">           cur_idx += <span class="number">1</span></span><br><span class="line">       <span class="keyword">if</span> idx == <span class="number">0</span>:   <span class="comment"># 当删除第一个节点时</span></span><br><span class="line">           self.head = cur.next</span><br><span class="line">           cur = cur.next</span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       <span class="keyword">if</span> self.head <span class="keyword">is</span> self.tail:   <span class="comment"># 当只有一个节点的链表时</span></span><br><span class="line">           self.head = <span class="literal">None</span></span><br><span class="line">           self.tail = <span class="literal">None</span></span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       cur.next = cur.next.next</span><br><span class="line">       <span class="keyword">if</span> cur.next <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 当删除的节点是链表最后一个节点时</span></span><br><span class="line">           self.tail = cur</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 在某元素后删除节点node = cur.next </span></span><br><span class="line">       <span class="comment"># cur.next = cur.next.next  # 被删的节点指向第一个的原来next的指向</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>size() 返回链表的元素数，不接收参数，返回值是链表中节点的个数，<br>要获得链表的节点个数，必定会遍历链表，<br>直到最后一个节点的next指针指向None时链表遍历完成，<br>遍历时可以用一个累加器来计算节点的个数，如下代码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">size</span>(<span class="params">self</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> current <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'The list is an empty list'</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            current = current.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br></pre></td></tr></tbody></table></figure>

<p>search(item) 查找链表某元素，<br>search函数接收一个item参数，表示查找节点中数据域的值,要查找的元素或索引。<br>search函数遍历链表，每到一个节点把当前节点的data值与item作比较，<br>最糟糕的情况下会全遍历链表。O(n)<br>如果查找到有些数据则返回True，否则返回False，代码如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.data == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current = current.next</span><br><span class="line">        <span class="keyword">return</span> found</span><br></pre></td></tr></tbody></table></figure>

<p>Node类与LinkedList类完整代码整理如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.head = <span class="literal">None</span></span><br><span class="line">        self.tail = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.head <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        node = Node(data)  <span class="comment"># 实列化节点</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.head = node</span><br><span class="line">            self.tail = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.tail.next = node</span><br><span class="line">            self.tail = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">iter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.head:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        <span class="keyword">yield</span> cur.data</span><br><span class="line">        <span class="keyword">while</span> cur.next:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">yield</span> cur.data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, idx, value</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 判断是否是空链表</span></span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx - <span class="number">1</span>:  <span class="comment"># 遍历链表</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 判断是不是最后一个元素</span></span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        node = Node(value)</span><br><span class="line">        node.next = cur.next</span><br><span class="line">        cur.next = node</span><br><span class="line">        <span class="keyword">if</span> node.next <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.tail = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">        cur = self.head</span><br><span class="line">        cur_idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 空链表时</span></span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'The list is an empty list'</span>)</span><br><span class="line">        <span class="keyword">while</span> cur_idx &lt; idx - <span class="number">1</span>:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'list length less than index'</span>)</span><br><span class="line">            cur_idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> idx == <span class="number">0</span>:  <span class="comment"># 当删除第一个节点时</span></span><br><span class="line">            self.head = cur.next</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.head <span class="keyword">is</span> self.tail:  <span class="comment"># 当只有一个节点的链表时</span></span><br><span class="line">            self.head = <span class="literal">None</span></span><br><span class="line">            self.tail = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur.next = cur.next.next</span><br><span class="line">        <span class="keyword">if</span> cur.next <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 当删除的节点是链表最后一个节点时</span></span><br><span class="line">            self.tail = cur</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span>(<span class="params">self</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> current <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'The list is an empty list'</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            current = current.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.data == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current = current.next</span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    link_list = LinkedList()  <span class="comment"># 实列化链表</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        link_list.append(i)</span><br><span class="line">    print(link_list)</span><br><span class="line">    <span class="comment">#    print(link_list.is_empty())</span></span><br><span class="line">    <span class="comment">#    link_list.insert(10, 30)</span></span><br><span class="line">    <span class="comment">#    link_list.remove(0)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> link_list.iter():</span><br><span class="line">        print(<span class="string">'node is {0}'</span>.format(node))</span><br><span class="line">    print(link_list.size())</span><br><span class="line"><span class="comment">#    print(link_list.search(20))</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>单向循环链表<br>单链表的一个变形是单向循环链表，链表中最后一个节点的next域不再为None，而是指向链表的头节点。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""节点"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        self.item = item</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SinCycLinkedlist</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""单向循环链表"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""判断链表是否为空"""</span></span><br><span class="line">        <span class="keyword">return</span> self._head == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">length</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""返回链表的长度"""</span></span><br><span class="line">        <span class="comment"># 如果链表为空，返回长度0</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">travel</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""遍历链表"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        print(cur.item)</span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            print(cur.item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""头部添加节点"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            self._head = node</span><br><span class="line">            node.next = self._head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#添加的节点指向_head</span></span><br><span class="line">            node.next = self._head</span><br><span class="line">            <span class="comment"># 移到链表尾部，将尾部节点的next指向node</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment">#_head指向添加node的</span></span><br><span class="line">            self._head = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""尾部添加节点"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            self._head = node</span><br><span class="line">            node.next = self._head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 移到链表尾部</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将尾节点指向node</span></span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment"># 将node指向头节点_head</span></span><br><span class="line">            node.next = self._head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, pos, item</span>):</span></span><br><span class="line">        <span class="string">"""在指定位置添加节点"""</span></span><br><span class="line">        <span class="keyword">if</span> pos &lt;= <span class="number">0</span>:</span><br><span class="line">            self.add(item)</span><br><span class="line">        <span class="keyword">elif</span> pos &gt; (self.length()<span class="number">-1</span>):</span><br><span class="line">            self.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = Node(item)</span><br><span class="line">            cur = self._head</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 移动到指定位置的前一个位置</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; (pos<span class="number">-1</span>):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                cur = cur.next</span><br><span class="line">            node.next = cur.next</span><br><span class="line">            cur.next = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""删除一个节点"""</span></span><br><span class="line">        <span class="comment"># 若链表为空，则直接返回</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># 将cur指向头节点</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        pre = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 若头节点的元素就是要查找的元素item</span></span><br><span class="line">        <span class="keyword">if</span> cur.item == item:</span><br><span class="line">            <span class="comment"># 如果链表不止一个节点</span></span><br><span class="line">            <span class="keyword">if</span> cur.next != self._head:</span><br><span class="line">                <span class="comment"># 先找到尾节点，将尾节点的next指向第二个节点</span></span><br><span class="line">                <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                    cur = cur.next</span><br><span class="line">                <span class="comment"># cur指向了尾节点</span></span><br><span class="line">                cur.next = self._head.next</span><br><span class="line">                self._head = self._head.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 链表只有一个节点</span></span><br><span class="line">                self._head = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pre = self._head</span><br><span class="line">            <span class="comment"># 第一个节点不是要删除的</span></span><br><span class="line">            <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">                <span class="comment"># 找到了要删除的元素</span></span><br><span class="line">                <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                    <span class="comment"># 删除</span></span><br><span class="line">                    pre.next = cur.next</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pre = cur</span><br><span class="line">                    cur = cur.next</span><br><span class="line">            <span class="comment"># cur 指向尾节点</span></span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="comment"># 尾部删除</span></span><br><span class="line">                pre.next = cur.next</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""查找节点是否存在"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">if</span> cur.item == item:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">while</span> cur.next != self._head:</span><br><span class="line">            cur = cur.next</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    ll = SinCycLinkedlist()</span><br><span class="line">    ll.add(<span class="number">1</span>)</span><br><span class="line">    ll.add(<span class="number">2</span>)</span><br><span class="line">    ll.append(<span class="number">3</span>)</span><br><span class="line">    ll.insert(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">    ll.insert(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    ll.insert(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br><span class="line">    print(ll.search(<span class="number">3</span>))</span><br><span class="line">    print(ll.search(<span class="number">7</span>))</span><br><span class="line">    ll.remove(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br></pre></td></tr></tbody></table></figure>

<p>双链表<br>相比单链表来说，每个节点既保存了指向下一个节点的指针，最后一个结点next指向为None(空)。<br>同时还保存了上一个节点的指针，双链表第一个结点pre指向为None(空)</p>
<p>双链表每个结点包括三个域，<br>pre指针指向上一个结点，val存储数据值，next指针指向下一个结点。</p>
<p>对于双链表可以使用class 的三个属性pre, val, next。</p>
<p>对， 就多了 prev，有啥优势嘛？</p>
<ul>
<li><p>直接删除节点，当然如果给的是一个值，我们还是需要查找这个值在哪个节点？ - 但是如果给了一个节点，我们把它拿掉，直接让它的前后节点互相指过去不就行了？哇欧，删除就是 O(1) 了，两步操作就行啦</p>
</li>
<li><p>看似我们反过来遍历双链表了。反过来从哪里开始呢？我们只要让 root 的 prev 指向 tail 节点，不就串起来了吗？<br>循环双端列表就是在双列表基础上把最后一个结点next指向第一个结点，第一个结点pre指向最后一个结点，这样就形成循环双端链表。</p>
</li>
</ul>
<p>最 </p>
<table>
<thead>
<tr>
<th>循环双端链表操作 CircularDoubleLinkedList 大写字母缩写 cdll</th>
<th>平均时间复杂度</th>
</tr>
</thead>
<tbody><tr>
<td>cdll.append(value)</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.appendleft(value)</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.remove(node)，注意这里参数是 node</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.headnode()</td>
<td>O(1)</td>
</tr>
<tr>
<td>cdll.tailnode()</td>
<td>O(1)</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="comment"># 如果节点很多，我们可以用 __slots__ 来节省内存，把属性保存在一个 tuple 而不是 dict 里</span></span><br><span class="line">    <span class="comment"># 感兴趣可以自行搜索  python  __slots__</span></span><br><span class="line">    __slots__ = (<span class="string">'value'</span>, <span class="string">'prev'</span>, <span class="string">'next'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value=None, prev=None, next=None</span>):</span></span><br><span class="line">        self.value, self.prev, self.next = value, prev, next</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""双向链表节点"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        self.item = item</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line">        self.prev = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DLinkList</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">"""双向链表"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""判断链表是否为空"""</span></span><br><span class="line">        <span class="keyword">return</span> self._head == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">length</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""返回链表的长度"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">travel</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""遍历链表"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            print(cur.item,</span><br><span class="line">            cur = cur.next</span><br><span class="line">        print(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""头部插入元素"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将_head指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 将node的next指向_head的头节点</span></span><br><span class="line">            node.next = self._head</span><br><span class="line">            <span class="comment"># 将_head的头节点的prev指向node</span></span><br><span class="line">            self._head.prev = node</span><br><span class="line">            <span class="comment"># 将_head 指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""尾部插入元素"""</span></span><br><span class="line">        node = Node(item)</span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="comment"># 如果是空链表，将_head指向node</span></span><br><span class="line">            self._head = node</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 移动到链表尾部</span></span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">while</span> cur.next != <span class="literal">None</span>:</span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将尾节点cur的next指向node</span></span><br><span class="line">            cur.next = node</span><br><span class="line">            <span class="comment"># 将node的prev指向cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""查找元素是否存在"""</span></span><br><span class="line">        cur = self._head</span><br><span class="line">        <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            cur = cur.next</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure>


<p>双链表节点的插入<br>中间值插入的情况<br>p.next = cur.next<br>cur.next.prev = p<br>p.prev = cur<br>cur.next = p</p>
<p>指定位置插入节点</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self, pos, item</span>):</span></span><br><span class="line">        <span class="string">"""在指定位置添加节点"""</span></span><br><span class="line">        <span class="keyword">if</span> pos &lt;= <span class="number">0</span>:</span><br><span class="line">            self.add(item)</span><br><span class="line">        <span class="keyword">elif</span> pos &gt; (self.length()<span class="number">-1</span>):</span><br><span class="line">            self.append(item)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = Node(item)</span><br><span class="line">            cur = self._head</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 移动到指定位置的前一个位置</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; (pos<span class="number">-1</span>):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                cur = cur.next</span><br><span class="line">            <span class="comment"># 将node的prev指向cur</span></span><br><span class="line">            node.prev = cur</span><br><span class="line">            <span class="comment"># 将node的next指向cur的下一个节点</span></span><br><span class="line">            node.next = cur.next</span><br><span class="line">            <span class="comment"># 将cur的下一个节点的prev指向node</span></span><br><span class="line">            cur.next.prev = node</span><br><span class="line">            <span class="comment"># 将cur的next指向node</span></span><br><span class="line">            cur.next = node</span><br></pre></td></tr></tbody></table></figure>

<p>双链表节点的删除，<br>当然如果给的是一个值，我们还是需要查找这个值在哪个节点？ </p>
<ul>
<li>但是如果给了一个节点，我们把它拿掉，直接让它的前后节点互相指过去不就行了？<br>删除就是 O(1) 了，两步操作就行啦</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self, item</span>):</span></span><br><span class="line">        <span class="string">"""删除元素"""</span></span><br><span class="line">        <span class="keyword">if</span> self.is_empty():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cur = self._head</span><br><span class="line">            <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                <span class="comment"># 如果首节点的元素即是要删除的元素</span></span><br><span class="line">                <span class="keyword">if</span> cur.next == <span class="literal">None</span>:</span><br><span class="line">                    <span class="comment"># 如果链表只有这一个节点</span></span><br><span class="line">                    self._head = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 将第二个节点的prev设置为None</span></span><br><span class="line">                    cur.next.prev = <span class="literal">None</span></span><br><span class="line">                    <span class="comment"># 将_head指向第二个节点</span></span><br><span class="line">                    self._head = cur.next</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">while</span> cur != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> cur.item == item:</span><br><span class="line">                    <span class="comment"># 将cur的前一个节点的next指向cur的后一个节点</span></span><br><span class="line">                    cur.prev.next = cur.next</span><br><span class="line">                    <span class="comment"># 将cur的后一个节点的prev指向cur的前一个节点</span></span><br><span class="line">                    cur.next.prev = cur.prev</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                cur = cur.next</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    ll = DLinkList()</span><br><span class="line">    ll.add(<span class="number">1</span>)</span><br><span class="line">    ll.add(<span class="number">2</span>)</span><br><span class="line">    ll.append(<span class="number">3</span>)</span><br><span class="line">    ll.insert(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">    ll.insert(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    ll.insert(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br><span class="line">    print(ll.search(<span class="number">3</span>))</span><br><span class="line">    print(ll.search(<span class="number">4</span>))</span><br><span class="line">    ll.remove(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"length:"</span>,ll.length())</span><br><span class="line">    ll.travel()</span><br></pre></td></tr></tbody></table></figure>


<p>中间值p = cur.next删除的情况<br>cur.next = p.next<br>p.next.prev = cur<br>cur.next = p<br>del p</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/32/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><span class="page-number current">33</span><a class="page-number" href="/page/34/">34</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><a class="extend next" rel="next" href="/page/34/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
