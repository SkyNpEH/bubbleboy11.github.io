<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;bubbleboy11.github.io&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/27/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/27/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<script data-pjax src="/js/load-config.js"></script>
  <title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">267</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/property-zhuang-shi-qi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/property-zhuang-shi-qi/" class="post-title-link" itemprop="url">property装饰器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-31 01:04:49" itemprop="dateModified" datetime="2021-05-31T01:04:49Z">2021-05-31</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Python中属性和方法访问权限不建议将属性设置为私有的，<br>但是如果直接将属性暴露给外界也是有问题的，比如我们没有办法检查赋给属性的值是否有效，导致可以把属性随便改，甚至类型错误都可以。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, score</span>):</span></span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Student(<span class="number">100</span>)</span><br><span class="line">    print(s.score)  <span class="comment"># 100</span></span><br><span class="line">    s.score = <span class="number">50</span></span><br><span class="line">    print(s.score)  <span class="comment"># 50</span></span><br><span class="line">    s.score = <span class="string">'abc'</span></span><br><span class="line">    print(s.score)  <span class="comment"># abc</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>为了限制score的范围，<br>可以通过一个set_score()方法来设置成绩，<br>再通过一个get_score()方法来获取成绩，<br>这样，在set_score()方法里就可以检查参数了。<br>对任意的Student实例进行操作，就不能随心所欲的设置score了。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_score</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, int):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must be an integer !'</span>)</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">0</span> <span class="keyword">or</span> value &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must between 0-100 !'</span>)</span><br><span class="line">        self._score = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_score</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Student()</span><br><span class="line">    s.set_score(<span class="number">50</span>)</span><br><span class="line">    print(s.get_score())  <span class="comment"># 50</span></span><br><span class="line">    s.set_score(<span class="string">'abc'</span>)  <span class="comment"># ValueError: score must be an integer !</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面的调用方法虽然已经可以实现相关功能，但是使用起来略显复杂，<br>设置和获取属性都需要通过调用方法来实现，没有直接用属性这么简洁明了。</p>
<p>在写python类的时候，虽然可以通过<code>实例名.变量名</code>的方式对实例中的变量进行读取和赋值。但出于规范性等等原因，<br>我们最好还是写 <code>getter</code> 和 <code>setter</code> ，不过这样的话在读取变量和赋值时代码就显得有些臃肿，也不那么随心所欲了。<br>那么有没有即保证数据规范性能检查参数又可以用类似属性这样简单的方式来访问类的变量?<br>有，使用<code>property()</code> 函数和 @<code>property</code> 修饰符。</p>
<h3 id="property装饰器"><a href="#property装饰器" class="headerlink" title="@property装饰器"></a><code>@property</code>装饰器</h3><p>我们之前的建议是将属性命名以单下划线开头，通过这种方式来暗示属性是受保护的，不建议外界直接访问，<br>那么如果想访问属性可以通过属性的getter（访问器）和setter（修改器）方法进行对应的操作。<br>如果要做到这点，就可以考虑使用@property包装器来包装getter和setter方法，<br><code>@property</code>，<code>@setter</code>，<code>@deleter</code>这三个装饰器提供了更加友好的方式来获取、设置或删除类中的属性。<br>@property装饰器所装饰的函数可以像访问属性一样调用函数，而不再当作函数方法<br><code>@property</code>装饰器 getter 必须先于<code>@setter</code>，<code>@deleter</code>使用，且三者所装饰的函数必须同名，否则会出错。<br>加上@property就可以了，把一个类的getter方法变成属性，<br>创建了另一个装饰器@score.setter，负责把一个setter方法变成属性赋值，拥有属性操作。<br>我们在对实例属性操作的时候，就知道该属性不是直接暴露的，而是通过getter和setter方法来实现的。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, v</span>):</span></span><br><span class="line">        print(<span class="string">'实例化一个A类对象……'</span>)</span><br><span class="line">        self.__value = v</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">value</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 这是getter，getter必须写在setter前面，且函数名变成property修饰符名</span></span><br><span class="line">        print(<span class="string">'取值时被调用'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.__value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @value.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">value</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="comment"># 这是setter，setteer的函数名跟getter一样，必须为property修饰符名</span></span><br><span class="line">        print(<span class="string">'赋值时被调用'</span>)</span><br><span class="line">        self.__value = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @value.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">value</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 这是deleter，函数名同上</span></span><br><span class="line">        print(<span class="string">'删除值时被调用……'</span>)</span><br><span class="line">        <span class="keyword">del</span> self.__value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    a = A(<span class="number">123</span>)</span><br><span class="line">    print(<span class="string">'-------------'</span>)</span><br><span class="line">    print(<span class="string">'__value的值为：{}'</span>.format(a.value))</span><br><span class="line">    print(<span class="string">'-------------'</span>)</span><br><span class="line">    a.value = <span class="number">234</span></span><br><span class="line">    print(<span class="string">'__value的值为：{}'</span>.format(a.value))</span><br><span class="line">    print(<span class="string">'--------------'</span>)</span><br><span class="line">    <span class="keyword">del</span> a.value</span><br><span class="line">    print(<span class="string">'__value的值为：{}'</span>.format(a.value))  <span class="comment"># 访问了已经删除了的元素</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">实例化一个A类对象……</span><br><span class="line">-------------</span><br><span class="line">取值时被调用</span><br><span class="line">_<span class="emphasis">_value的值为：123</span></span><br><span class="line"><span class="emphasis">-------------</span></span><br><span class="line"><span class="emphasis">赋值时被调用</span></span><br><span class="line"><span class="emphasis">取值时被调用</span></span><br><span class="line"><span class="emphasis">_</span><span class="emphasis">_value的值为：234</span></span><br><span class="line"><span class="emphasis">--------------</span></span><br><span class="line"><span class="emphasis">删除值时被调用……</span></span><br><span class="line"><span class="emphasis">取值时被调用</span></span><br><span class="line"><span class="emphasis">Traceback (most recent call last):</span></span><br><span class="line"><span class="emphasis">  File "c:/1.py", line 31, in &lt;module&gt;</span></span><br><span class="line"><span class="emphasis">    print('_</span><span class="emphasis">_value的值为：{}'.format(a.value))</span></span><br><span class="line"><span class="emphasis">  File "c:/python/1.py", line 9, in value</span></span><br><span class="line"><span class="emphasis">    return self._</span><span class="emphasis">_value</span></span><br><span class="line"><span class="emphasis">AttributeError: 'A' object has no attribute '_</span>A_<span class="emphasis">_value'</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.__name = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name_value</span>(<span class="params">self</span>):</span>  <span class="comment"># 这是getter，getter必须写在setter前面，且函数名变成property修饰符名</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @name_value.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name_value</span>(<span class="params">self, name</span>):</span>  <span class="comment"># 这是setter，setteer的函数名跟getter一样，必须为property修饰符名</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @name_value.deleter  # 这是deleter，函数名同上</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name_value</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">del</span> self.__name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person()</span><br><span class="line">p.name_value = <span class="string">'chb'</span></span><br><span class="line">n = p.name_value</span><br><span class="line">print(n)  <span class="comment"># chb</span></span><br><span class="line"><span class="keyword">del</span> p.name_value</span><br><span class="line">print(p.name_value)  <span class="comment"># AttributeError: 'Person' object has no attribute '_Person__name'</span></span><br></pre></td></tr></tbody></table></figure>
<p>有的时候，为了不让修改属性，只定义<code>getter</code>方法、不定义<code>setter</code>方法就是在类中定义一个只读属性，<code>property</code>函数只写第一个参数即可。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">object</span>):</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># birth是可读写属性</span></span><br><span class="line">        <span class="keyword">return</span> self._birth</span><br><span class="line"></span><br><span class="line"><span class="meta">    @birth.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, int):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'birth must be an integer !'</span>)</span><br><span class="line">        self._birth = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># age是一个只读属性，根据birth和当前年份计算出来。</span></span><br><span class="line">        <span class="keyword">return</span> datetime.datetime.now().year - self._birth</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Student()</span><br><span class="line">    s.birth = <span class="number">1997</span></span><br><span class="line">    print(s.age)  <span class="comment"># 25</span></span><br><span class="line">    s.age = <span class="number">26</span>  <span class="comment"># AttributeError: can't set attribute</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">object</span>):</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">score</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._score</span><br><span class="line"></span><br><span class="line"><span class="meta">    @score.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">score</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, int):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must be an integer !'</span>)</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">0</span> <span class="keyword">or</span> value &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must between 0 - 100 !'</span>)</span><br><span class="line">        self._score = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Student()</span><br><span class="line">    s.score = <span class="number">50</span>  <span class="comment"># 实际转化为s.set_score()</span></span><br><span class="line">    print(s.score)  <span class="comment"># 50 实际转化为s.get_score()</span></span><br><span class="line">    s.score = <span class="number">101</span>  <span class="comment"># ValueError: score must between 0 - 100 !</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">object</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self._name = name</span><br><span class="line">        self._age = age</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 访问器 - getter方法</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 访问器 - getter方法</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._age</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改器 - setter方法</span></span><br><span class="line"><span class="meta">    @age.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span>(<span class="params">self, age</span>):</span></span><br><span class="line">        self._age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">play</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self._age &lt;= <span class="number">16</span>:</span><br><span class="line">            print(<span class="string">'%s正在玩飞行棋.'</span> % self._name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'%s正在玩斗地主.'</span> % self._name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    person = Person(<span class="string">'王大锤'</span>, <span class="number">12</span>)</span><br><span class="line">    person.play()</span><br><span class="line">    person.age = <span class="number">22</span></span><br><span class="line">    person.play()</span><br><span class="line">    <span class="comment"># person.name = '白元芳'  # AttributeError: can't set attribute</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h3><p><code>property(fget=None,fset=None,fdel=None,doc=None)</code></p>
<p>在新式类中返回类属性值。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.__name = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是setter方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setName</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是getter方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getName</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line">    name_value = property(getName, setName)  <span class="comment"># 名字可以随便去，这里使用name_value是为了直观，直接用一个n命名更简单</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person()  <span class="comment"># 实例化</span></span><br><span class="line">p.name_value = <span class="string">'chb'</span>  <span class="comment"># 直接赋值，这行代码等同于 p.setName('chb')</span></span><br><span class="line">n = p.name_value  <span class="comment"># 直接读取数据 ，等同于使用 p.getName()</span></span><br><span class="line">print(n)  <span class="comment"># chb</span></span><br></pre></td></tr></tbody></table></figure>
<p>在写好了setteer和getter后，加上一句<code>property</code>函数赋值代码。<br>property可以再一个deleter，上面代码中没有加。如果加上，<code>deleter</code> 写法代码如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这是deleter</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delName</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">del</span> self.__name</span><br></pre></td></tr></tbody></table></figure>


<p>然后 <code>property</code> 赋值语句变为：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name_value=property(getName, setName, delName)</span><br></pre></td></tr></tbody></table></figure>

<p>使用方法为：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> p.name_value</span><br><span class="line">print(p.name_value)  <span class="comment"># 运行会出错</span></span><br></pre></td></tr></tbody></table></figure>

<p>这种方法的好处是你可以按照原来的方法写 <code>getter</code> 和 <code>setter</code>，连 <code>getter</code> 和 <code>setter</code> 的函数名都可以不用改，只需要写完 <code>getter</code> 和 <code>setter</code> 是加一条 <code>property</code> 赋值语句。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">webserver</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,num</span>):</span></span><br><span class="line">        self.num=num</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">stop</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"Stop the server !!"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"Start the server !!"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">restart</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.stop()</span><br><span class="line">        self.start()</span><br><span class="line">        print(<span class="string">"Restart the server"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_test</span>():</span></span><br><span class="line">        print(<span class="string">"Reload the server"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    server=webserver(<span class="number">1</span>)</span><br><span class="line">    server2=webserver(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> hasattr(server,sys.argv[<span class="number">1</span>]):</span><br><span class="line">    <span class="function"><span class="keyword">func</span>=<span class="title">getattr</span><span class="params">(server,sys.argv[1])</span>  # <span class="title">getattr</span>其实是在<span class="title">server</span>这个实例中寻找和<span class="title">sys</span>.<span class="title">argv</span>[1]这个字符串相同的方法，并且返回一个内存地址</span></span><br><span class="line">       <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setattr</span><span class="params">(server,<span class="string">'reload'</span>,run_test)</span></span></span><br><span class="line">server.reload()</span><br></pre></td></tr></tbody></table></figure>


<p>setattr 是这么玩： setattr(x, ‘y’, v) is equivalent to ``x.y = v’’,意思是第一个输入的是实例的名字，第二个是属性的别名，第三个函数名(类里面已有的方法)</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setattr</span><span class="params">(server,<span class="string">'reload'</span>,run_test)</span></span></span><br><span class="line">server.reload()</span><br></pre></td></tr></tbody></table></figure>


<p>delattr 是这么玩 delattr(x, ‘y’) is equivalent to ``del x.y’’ ，x是类名，y是类的方法名</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">delattr</span><span class="params">(webserver,<span class="string">'start'</span>)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>此时我们把类的start方法删除后，对象server就没有start方法了，执行下面句的时候就会报错了</p>
<p>类的继承之广度优先</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"f1 from A"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"f2 from A"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"f1 from B"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"f2 from B"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"f1 from C"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">"f2 from C"</span>)</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>(<span class="params">B,C</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">d=D()</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/base64/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/base64/" class="post-title-link" itemprop="url">base64</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-25 04:43:22" itemprop="dateModified" datetime="2021-05-25T04:43:22Z">2021-05-25</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84python%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构python与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>BASE64<br>编码和解码，根据规则可以转回去不是加密，加解密需要钥匙<br>它是一种编码算法，但是具有不可读性，所以可以说是防君子不防小人</p>
<p>0-9A-Za-z+/<br>1100 0101 1001 0011 0111 0110<br>00110001 00011001 00001101 00110110<br>base64<br>b64encode / b64decode</p>
<p>默认情况，可视字符基于ASCII码显示出来，</p>
<p>Base64是一种用64个可视/可打印字符表示所有二进制数据的编码方式，通过将二进制数据每6位一组的方式重新组织，<br>刚好可以使用在Base64中的可打印字符包括大小写字母A-Z、a-z、数字0-9，这样共有62个字符以及“+”和“/”总共64个字符表示从<code>000000</code>到<code>111111</code>的64种状态。</p>
<h3 id="base64怎么转换"><a href="#base64怎么转换" class="headerlink" title="base64怎么转换"></a>base64怎么转换</h3><p>1,将字符串拆成每三个字符一组,对应3个字节<br>2,计算每一个字符对应的ASCI码二进制,一共24个二进制位<br>3,将8位的二进制码,由于 log{2}64=6，所以按照每6个二进制位一组重新分组为一个单元，不足6位的在低位补0，对应某个可打印字符。对应于4个Base64单元，<br>4,计算对应的十进制编码<br>5,按照base64索引表,查看对应的字符<br>即3个字节可由4个可打印字符来表示，将3个字节编码为4个字符，<br>base64结果的长度一定是4的倍数</p>
<p>如果要编码的字节数不能被3整除，位数不够填满一组，最后会多出1个或2个字节，那么可以使用下面的方法进行处理：<br>先使用0字节值在末尾补足，使其能够被3整除，然后再进行Base64的编码。在编码后的Base64文本后加上一个或两个=号，代表补足的字节数。也就是说，<br>当最后剩余两个八位(待补足)字节（2个byte）时，最后一个6位的Base64字节块有四位是0值，最后附加上两个等号；<br>如果最后剩余一个八位(待补足)字节（1个byte）时，最后一个6位的base字节块有两位是0值，最后附加一个等号。 参考下表：</p>
<p>Base64常用于在通常处理文本数据的场合，表示、传输、存储一些二进制数据，包括MIME的电子邮件及XML的一些复杂数据。</p>
<h2 id="base64-是-Python-内建模块，我们只需要-import-导入模块就可以使用"><a href="#base64-是-Python-内建模块，我们只需要-import-导入模块就可以使用" class="headerlink" title="base64 是 Python 内建模块，我们只需要 import 导入模块就可以使用"></a><code>base64</code> 是 Python 内建模块，我们只需要 import 导入模块就可以使用</h2><p>把超越 ascii 范围的字符用 base64 编码为可见字符，</p>
<p>base64.b64encode(data)) data为byte字节类型数据。a bytes-like object is required, not ‘str’<br>当解码Base64的时候，字节字符串和Unicode文本都可以作为参数。 但是，Unicode字符串只能包含ASCII字符。</p>
<p>urlsafe 形式的编码方式，目的是将<code>+</code>和<code>/</code> 替换成 <code>-</code>和<code>_</code>，<br>因为标准的Base64并不适合直接放在URL里传输，<br>URL编码器会把标准Base64中的“/”和“+”字符变为形如“%XX”的形式，<br>而这些“%”号在存入数据库时还需要再进行转换。</p>
<p><code>urlsafe_b64encode()</code>作用同b64encode(),会将+替换成-，/替换成_编码，不能 <code>b64encode</code>解码，用什么方式转码用同样的方式转回去</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># Some byte data</span></span><br><span class="line">s = <span class="string">b'hello'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Encode as Base64</span></span><br><span class="line">a = base64.b64encode(s)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># b'aGVsbG8='</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Decode from Base64</span></span><br><span class="line">print(base64.b64decode(a))</span><br><span class="line"><span class="comment"># b'hello'</span></span><br><span class="line"></span><br><span class="line">print(base64.b64encode(<span class="string">b'i\xcf\xbf'</span>))</span><br><span class="line"><span class="comment"># b'ac+/'</span></span><br><span class="line"></span><br><span class="line">print(base64.urlsafe_b64encode(<span class="string">b'i\xcf\xbf'</span>))</span><br><span class="line"><span class="comment"># b'ac-_'</span></span><br></pre></td></tr></tbody></table></figure>

<p>用了JSON作为数据传输的格式（通过JSON格式对传输的数据进行了序列化和反序列化的操作），<br>但是JSON并不能携带二进制数据，因此对图片的二进制数据进行了Base64编码的处理。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">读写二进制文件</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'mm.jpg'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">    <span class="comment"># print(type(data))</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    print(<span class="string">'字节数:'</span>, len(data))</span><br><span class="line">    <span class="comment"># 将图片处理成BASE-64编码</span></span><br><span class="line">    print(base64.b64encode(data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'girl.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data)</span><br><span class="line">print(<span class="string">'写入完成!'</span>)</span><br></pre></td></tr></tbody></table></figure>


<p>如果直接使用<code>base64.b64decode()</code>函数将base64解码，是得到的16进制字符串是有问题的．<br>此时要使用<code>base64.b64decode(base64_data).hex()</code>来转换成16进制字符串．</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># base64解码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64_decode</span>(<span class="params">base64_data</span>):</span></span><br><span class="line">    temp = base64.b64decode(base64_data).hex()</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="string">"qgEeAGBFRQAAZEIAAFhCAAAAAAAAE0LFEAVqAAAHZhbn9rs="</span></span><br><span class="line">tem = base64_decode(data)</span><br><span class="line">print(tem)</span><br><span class="line"><span class="comment"># aa011e0060454500006442000058420000000000001342c510056a0000076616e7f6bb</span></span><br></pre></td></tr></tbody></table></figure>


<p>Base64编码仅仅用于面向字节的数据比如字节字符串和字节数组。 此外，编码处理的输出结果总是一个字节字符串。<br>如果你想混合使用Base64编码的数据和Unicode文本，你必须添加一个额外的解码步骤。例如：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = base64.b64encode(s).decode(<span class="string">'ascii'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line"><span class="string">'aGVsbG8='</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth <span class="keyword">as</span> django_auth</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户认证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_auth</span>(<span class="params">request</span>):</span></span><br><span class="line">    get_http_auth = request.META.get(<span class="string">'HTTP_AUTHORIZATION'</span>, <span class="string">b''</span>)</span><br><span class="line">    auth = get_http_auth.split()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        auth_parts = base64.b64decode(auth[<span class="number">1</span>]).decode(<span class="string">'iso-8859-1'</span>).partition(<span class="string">':'</span>)</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"null"</span></span><br><span class="line">    userid, password = auth_parts[<span class="number">0</span>], auth_parts[<span class="number">2</span>]</span><br><span class="line">    user = django_auth.authenticate(username=userid, password=password)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> user.id_active:</span><br><span class="line">        django_auth.login(request, user)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"fail"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会查询接口---增加用户认证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_event_list</span>(<span class="params">request</span>):</span></span><br><span class="line">    auth_result = user_auth(request)  <span class="comment"># 调用认证函数</span></span><br><span class="line">    <span class="keyword">if</span> auth_result == <span class="string">"null"</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse({<span class="string">'status'</span>: <span class="number">10011</span>, <span class="string">'message'</span>: <span class="string">'user auth null'</span>})</span><br><span class="line">    <span class="keyword">if</span> auth_result == <span class="string">"fail"</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse({<span class="string">'status'</span>: <span class="number">10012</span>, <span class="string">'message'</span>: <span class="string">'user auth fail'</span>})</span><br><span class="line">    eid = request.GET.get(<span class="string">"eid"</span>, <span class="string">""</span>)  <span class="comment"># 发布会 id</span></span><br><span class="line">    name = request.GET.get(<span class="string">"name"</span>, <span class="string">""</span>)  <span class="comment"># 发布会名称</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    client = socket()</span><br><span class="line">    client.connect((<span class="string">'192.168.1.2'</span>, <span class="number">5566</span>))</span><br><span class="line">    <span class="comment"># 定义一个保存二进制数据的对象</span></span><br><span class="line">    in_data = bytes()</span><br><span class="line">    <span class="comment"># 由于不知道服务器发送的数据有多大每次接收1024字节</span></span><br><span class="line">    data = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">while</span> data:</span><br><span class="line">        <span class="comment"># 将收到的数据拼接起来</span></span><br><span class="line">        in_data += data</span><br><span class="line">        data = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="comment"># 将收到的二进制数据解码成JSON字符串并转换成字典</span></span><br><span class="line">    <span class="comment"># loads函数的作用就是将JSON字符串转成字典对象</span></span><br><span class="line">    my_dict = loads(in_data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    filename = my_dict[<span class="string">'filename'</span>]</span><br><span class="line">    filedata = my_dict[<span class="string">'filedata'</span>].encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'/Users/Hao/'</span> + filename, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 将base64格式的数据解码成二进制数据并写入文件</span></span><br><span class="line">        f.write(b64decode(filedata))</span><br><span class="line">    print(<span class="string">'图片已保存.'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socket, SOCK_STREAM, AF_INET</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> dumps</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义线程类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FileTransferHandler</span>(<span class="params">Thread</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cclient</span>):</span></span><br><span class="line">            super().__init__()</span><br><span class="line">            self.cclient = cclient</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">            my_dict = {}</span><br><span class="line">            my_dict[<span class="string">'filename'</span>] = <span class="string">'guido.jpg'</span></span><br><span class="line">            <span class="comment"># JSON是纯文本不能携带二进制数据</span></span><br><span class="line">            <span class="comment"># 所以图片的二进制数据要处理成base64编码</span></span><br><span class="line">            my_dict[<span class="string">'filedata'</span>] = data</span><br><span class="line">            <span class="comment"># 通过dumps函数将字典处理成JSON字符串</span></span><br><span class="line">            json_str = dumps(my_dict)</span><br><span class="line">            <span class="comment"># 发送JSON字符串</span></span><br><span class="line">            self.cclient.send(json_str.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">            self.cclient.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.创建套接字对象并指定使用哪种传输服务</span></span><br><span class="line">    server = socket()</span><br><span class="line">    <span class="comment"># 2.绑定IP地址和端口(区分不同的服务)</span></span><br><span class="line">    server.bind((<span class="string">'192.168.1.2'</span>, <span class="number">5566</span>))</span><br><span class="line">    <span class="comment"># 3.开启监听 - 监听客户端连接到服务器</span></span><br><span class="line">    server.listen(<span class="number">512</span>)</span><br><span class="line">    print(<span class="string">'服务器启动开始监听...'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'guido.jpg'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 将二进制数据处理成base64再解码成字符串</span></span><br><span class="line">        data = b64encode(f.read()).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        client, addr = server.accept()</span><br><span class="line">        <span class="comment"># 用一个字典(键值对)来保存要发送的各种数据</span></span><br><span class="line">        <span class="comment"># 待会可以将字典处理成JSON格式在网络上传递</span></span><br><span class="line">        FileTransferHandler(client).start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">序列化 - 将对象变成字节序列(bytes)或者字符序列(str) - 串行化/腌咸菜</span></span><br><span class="line"><span class="string">反序列化 - 把字节序列或者字符序列还原成对象</span></span><br><span class="line"><span class="string">Python标准库对序列化的支持：</span></span><br><span class="line"><span class="string">json - 字符形式的序列化</span></span><br><span class="line"><span class="string">pickle - 字节形式的序列化</span></span><br><span class="line"><span class="string">dumps / loads</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> example02 <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonJsonEncoder</span>(<span class="params">json.JSONEncoder</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">default</span>(<span class="params">self, o</span>):</span></span><br><span class="line">        <span class="keyword">return</span> o.__dict__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    cli = redis.StrictRedis(host=<span class="string">'120.77.222.217'</span>, port=<span class="number">6379</span>, </span><br><span class="line">                            password=<span class="string">'123123'</span>)</span><br><span class="line">    data = base64.b64decode(cli.get(<span class="string">'guido'</span>))</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'guido2.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> file_stream:</span><br><span class="line">        file_stream.write(data)</span><br><span class="line">    <span class="comment"># with open('guido.jpg', 'rb') as file_stream:</span></span><br><span class="line">    <span class="comment">#     result = base64.b64encode(file_stream.read())</span></span><br><span class="line">    <span class="comment"># cli.set('guido', result)</span></span><br><span class="line">    <span class="comment"># persons = [</span></span><br><span class="line">    <span class="comment">#     Person('骆昊', 39), Person('王大锤', 18),</span></span><br><span class="line">    <span class="comment">#     Person('白元芳', 25), Person('狄仁杰', 37)</span></span><br><span class="line">    <span class="comment"># ]</span></span><br><span class="line">    <span class="comment"># persons = json.loads(cli.get('persons'))</span></span><br><span class="line">    <span class="comment"># print(persons)</span></span><br><span class="line">    <span class="comment"># cli.set('persons', json.dumps(persons, cls=PersonJsonEncoder))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight scheme"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">```</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight scheme"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">```</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight scheme"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">```</span><br></pre></td></tr></tbody></table></figure>
<p>```</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django-jing-tai-zi-yuan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django-jing-tai-zi-yuan/" class="post-title-link" itemprop="url">django加载配置静态资源文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-24 13:16:54" itemprop="dateModified" datetime="2021-05-24T13:16:54Z">2021-05-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>如果要在Django项目中使用静态资源，可以先创建一个用于保存静态资源的目录。<br>在<code>vote</code>项目中，我们将静态资源置于名为<code>static</code>的文件夹中，<br>在该文件夹包含了三个子文件夹：css、js和images，<br>分别用来保存外部CSS文件、外部JavaScript文件和图片资源，如下图所示。</p>
<p><img src="/2020/08/21/django-jing-tai-zi-yuan/pycharm-django-static.png"></p>
<p>为了能够找到保存静态资源的文件夹，我们还需要修改Django项目的配置文件<code>settings.py</code>，如下所示：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置静态文件的存储路径</span></span><br><span class="line">STATICFILES_DIRS = [os.path.join(BASE_DIR, <span class="string">'static'</span>), ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># STATIC_ROOT = os.path.join(BASE_DIR, 'static')    # 生产环境</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置静态文件的访问路径(指通过哪个url地址找静态文件) 访问静态文件的路由地址</span></span><br><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br></pre></td></tr></tbody></table></figure>

<p>配置好静态资源之后，大家可以运行项目，然后看看之前我们写的页面上的图片是否能够正常加载出来。需要说明的是，在项目正式部署到线上环境后，我们通常会把静态资源交给专门的静态资源服务器（如Nginx、Apache）来处理，而不是有运行Python代码的服务器来管理静态资源，所以上面的配置并不适用于生产环境，仅供项目开发阶段测试使用。使用静态资源的正确姿势我们会在后续的章节为大家讲解。</p>
<p>项目处于线下时(DEBUG=TRUE)，放了新的静态文件，需要重启服务：manage.py runserver,<br>django才能接管你的静态文件；处于线上时(DEBUG=False),nginx代替django接管</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/javascript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/javascript/" class="post-title-link" itemprop="url">js</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-22 03:23:09" itemprop="dateModified" datetime="2021-05-22T03:23:09Z">2021-05-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>使用var声明的变量，其作用域为该语句所在的函数内，且存在变量提升现象；指变量声明语句位置的改变（提升）<br>使用let声明的变量，其作用域为该语句所在的代码块内，不存在变量提升；<br>使用const声明的是常量，在后面出现的代码中不能再修改该常量的值。对数组下的某个元素或者对象下的某个属性赋值，修改数组的某个元素，或对象的某个属性不会报错，引用类型中变量存储的只是指针，const要求的是指针地址不变而不是指针指向对象内部发生了什么。不能修改的是栈内存在的值和地址。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django-shi-wu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django-shi-wu/" class="post-title-link" itemprop="url">django事务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-30 15:04:44" itemprop="dateModified" datetime="2021-05-30T15:04:44Z">2021-05-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>需要事务控制的情况：<br>对多个ORM模型操作时（比如：用户信息表和用户详细信息表，必须一致）<br>对结果要求严格一致（要么成功，要么失败）</p>
<p>在django中使用事务：<br>    一：加装饰器自动提交</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="meta">@transaction.atomic</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">viewfunc</span>(<span class="params">request</span>):</span></span><br><span class="line"><span class="comment"># 事务内的代码</span></span><br><span class="line">do_stuff()</span><br></pre></td></tr></tbody></table></figure>

<p>atomic自动提交过程解析<br>a. 进入到最外层的atomic代码块时会打开一个事务<br>b. 进入到内层atomic代码块时会创建一个标记<br>c. 退出内部块时会释放或回滚至标记<br>d. 退出外部块时提交或回退事务</p>
<p>手动提交和回滚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="comment"># 放弃自动提交</span></span><br><span class="line">transaction.set_autocommit(<span class="literal">False</span>)</span><br><span class="line">a.save()</span><br><span class="line">b.save()</span><br><span class="line">transaction.commit() <span class="comment"># 提交事务</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">transaction.rollback() <span class="comment"># 回滚</span></span><br></pre></td></tr></tbody></table></figure>

<p>举例：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="meta">@transaction.atomic()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span>(<span class="params">request</span>):</span></span><br><span class="line"><span class="string">""" 事务练习：用户发布微博时候，顺便发布一条评论，只能同时成功，否则发生回滚 """</span></span><br><span class="line"><span class="comment"># 获得一个用户</span></span><br><span class="line">user = WeiboUser.objects.get(pk=<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 发布一条微博和评论</span></span><br><span class="line">weibo = Weibo.objects.create(user=user, content=<span class="string">'事务练习'</span>, source=<span class="string">'other'</span>)</span><br><span class="line">WeiboComment.objects.create(user=user, content=<span class="string">'事务练习'</span>, weibo=<span class="literal">None</span>)</span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">'ojbk'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>上例中会weibo不能为空值，会触发回滚机制，若事务机制不存在，则只会将weibo对象创建成功<br>通过with来完成自动的事务提交：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transaction_with</span>(<span class="params">request</span>):</span></span><br><span class="line"><span class="string">""" 事务练习：用户发布微博时候，顺便发布一条评论，只能同时成功，否则发生回滚 """</span></span><br><span class="line"><span class="comment"># 获得一个用户</span></span><br><span class="line">user = WeiboUser.objects.get(pk=<span class="number">3</span>)</span><br><span class="line"><span class="keyword">with</span> transaction.atomic():</span><br><span class="line"><span class="comment"># 发布一条微博和评论</span></span><br><span class="line">weibo = Weibo.objects.create(user=user, content=<span class="string">'事务练习_with'</span>, source=<span class="string">'other'</span>)</span><br><span class="line">WeiboComment.objects.create(user=user, content=<span class="string">'事务练习_with'</span>, weibo=<span class="literal">None</span>)</span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">'ojbk'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>手动提交事务</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transaction_hand</span>(<span class="params">request</span>):</span></span><br><span class="line"><span class="string">""" 事务练习：用户发布微博时候，顺便发布一条评论，只能同时成功，否则发生回滚 """</span></span><br><span class="line"><span class="comment"># 获得一个用户</span></span><br><span class="line">user = WeiboUser.objects.get(pk=<span class="number">3</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="comment"># 放弃自动提交</span></span><br><span class="line">transaction.set_autocommit(<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 发布一条微博和评论</span></span><br><span class="line">weibo = Weibo.objects.create(user=user, content=<span class="string">'事务练习_hand'</span>, source=<span class="string">'other'</span>)</span><br><span class="line">WeiboComment.objects.create(user=user, content=<span class="string">'事务练习_hand'</span>, weibo=<span class="literal">None</span>)</span><br><span class="line">transaction.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">transaction.rollback()</span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">'ojbk'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>atomic()</code> 在<code>with</code>语句结束时，会自动进行提交，或当数据库代码出错时，自动进行回滚</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="keyword">with</span> transaction.atomic():</span><br><span class="line"><span class="comment"># with 语句下面的代码，凡是涉及到数据库操作的代码，</span></span><br><span class="line"><span class="comment"># 在进行数据库操作时，都会放在同一个事物中。</span></span><br><span class="line">    p1 = transaction.savepoint（）</span><br><span class="line">    <span class="comment"># 在进行数据库操作时，设置事物保存点</span></span><br><span class="line">    ..................</span><br><span class="line">    transaction.savepoint_rollback（p1）</span><br><span class="line">    <span class="comment"># 在进行数据库操作时，回滚到指定的保存点</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="meta">    @transaction.atomic</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django-zhong-jian-jian-zhi-xian-zhi-ip-fang-wen-ci-shu-he-hei-ming-dan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django-zhong-jian-jian-zhi-xian-zhi-ip-fang-wen-ci-shu-he-hei-ming-dan/" class="post-title-link" itemprop="url">Django中间件之限制ip访问次数和黑名单</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-06 11:30:54" itemprop="dateModified" datetime="2021-06-06T11:30:54Z">2021-06-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="限制ip访问频率"><a href="#限制ip访问频率" class="headerlink" title="限制ip访问频率"></a>限制ip访问频率</h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> caches</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 频率限制访问</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IpLimitMiddleware</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        ip = request.META.get(<span class="string">"REMOTE_ADDR"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选择缓存的数据库 redis缓存</span></span><br><span class="line">        cache = caches[<span class="string">'redis_backend'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 首先缓存中，根据ip获取数据，假如没有数据，值为空列表 []</span></span><br><span class="line">        requests = cache.get(ip, [])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果值存在，且当前时间 - 最后一个时间 &gt; 30 则清洗掉这个值  这里我们插入请求的时间为头插</span></span><br><span class="line">        <span class="keyword">while</span> requests <span class="keyword">and</span> time.time() - requests[<span class="number">-1</span>] &gt; <span class="number">30</span>:</span><br><span class="line">            requests.pop()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若没有存在值，则添加，过期时间为30秒，这个过期时间与上面判断的30 保持一致</span></span><br><span class="line">        requests.insert(<span class="number">0</span>, time.time())</span><br><span class="line">        cache.set(ip, requests, timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 限制访问次数为 5 次</span></span><br><span class="line">        print(len(requests))</span><br><span class="line">        <span class="keyword">if</span> len(requests) &gt; <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"请求过于频繁，请稍后重试！"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> caches</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 频率限制访问</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IpLimitMiddleware</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        ip = request.META.get(<span class="string">"REMOTE_ADDR"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选择缓存的数据库 redis缓存</span></span><br><span class="line">        cache = caches[<span class="string">'redis_backend'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取黑名单</span></span><br><span class="line">        black_list = cache.get(<span class="string">'black'</span>, [])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ip <span class="keyword">in</span> black_list:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"黑名单用户！"</span>)</span><br><span class="line"></span><br><span class="line">        requests = cache.get(ip, [])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果值存在，且当前时间 - 最后一个时间 &gt; 30 则清洗掉这个值  这里我们插入请求的时间为头插</span></span><br><span class="line">        <span class="keyword">while</span> requests <span class="keyword">and</span> time.time() - requests[<span class="number">-1</span>] &gt; <span class="number">60</span>:</span><br><span class="line">            requests.pop()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若没有存在值，则添加，过期时间为30秒，这个过期时间与上面判断的30 保持一致</span></span><br><span class="line">        requests.insert(<span class="number">0</span>, time.time())</span><br><span class="line">        cache.set(ip, requests, timeout=<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果访问次数大于30次，假如黑名单，封2分钟</span></span><br><span class="line">        <span class="keyword">if</span> len(requests) &gt; <span class="number">30</span>:</span><br><span class="line">            black_list.append(ip)</span><br><span class="line">            cache.set(<span class="string">'black'</span>, black_list, timeout=<span class="number">60</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 限制访问次数为 5 次</span></span><br><span class="line">        print(len(requests))</span><br><span class="line">        <span class="keyword">if</span> len(requests) &gt; <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"请求过于频繁，请稍后重试！"</span>)</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/04/08/python-cheng-xu-ru-kou-name-main/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/08/python-cheng-xu-ru-kou-name-main/" class="post-title-link" itemprop="url">Python程序入口 __name__ == '__main__'</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-07 16:21:41" itemprop="dateCreated datePublished" datetime="2020-04-07T16:21:41Z">2020-04-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-02 12:11:38" itemprop="dateModified" datetime="2021-05-02T12:11:38Z">2021-05-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Python的文件头：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash/python3  # 在代码被执行时，主动说明该选哪个路径下的编译器</span></span><br></pre></td></tr></tbody></table></figure>

<p>Python程序入口 <strong>name</strong> == ‘<strong>main</strong>‘</p>
<p>既没有写一个被调用的库和多进程的容易错误地认为「程序的入口」没什么用、是编码习惯。<br>事实上程序的入口非常有用，绝非可有可无，例如在Python自带的多线程库要求必须把主进程写在 if入口内部才能正常运行</p>
<p>直接写在Python最左端没有缩进的代码，在这个 <code>*.py</code> 文件被直接运行、或者被调用时会被执行</p>
<p>Python用这个方法来判断当前的模块是<strong>被直接运行</strong>还是<strong>被调用</strong><br>一个模块中有<code>__name__</code> 是当前模块名，</p>
<ul>
<li>当 <code>*.py</code> 文件模块被直接运行时，<code>模块名</code>为 <code>__main__</code>，即<code>__name__</code>置为 <code>__main__</code>，<code>if __name__ == '__main__'</code>之下的代码块将被运行。</li>
<li>当 <code>*.py</code> 文件模块以模块形式被导入调用时，在终端命令行运行时， <code>__name__</code> 为被调用模块的 模块名，<code>if __name__ == '__main__'</code>之下的代码块不被运行。</li>
</ul>
<p>这种if测试可以让一个模块通过命令行运行时执行一些额外的代码，最常见的就是运行测试。</p>
<p>假如你叫小明.py，在朋友眼中，你是小明(<strong>name</strong> == ‘小明’)；<br>在你自己眼中，你是你自己(<strong>name</strong> == ‘<strong>main</strong>‘)。</p>
<p>main文件不能直接用相对路径导入，加个-m</p>
<ul>
<li>把不想在被调用时执行的代码放在程序入口的if内部，比如自检程序。</li>
<li>把多线程的主线程写在程序入口的if内部。只能这么做，避免自己调用自己时重复执行主进程，下面会详细解释。</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python的程序入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">'__main__'</span>: <span class="comment"># 它对多进程非常重要</span></span><br><span class="line">    <span class="comment"># 这里是主程序</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># C语言的程序入口</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="comment">/* 这里是主程序 */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Java的程序入口</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>{</span><br><span class="line">    <span class="comment">// 这里是主程序</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建一个名为【run1.py】的文件，填入下方代码</span></span><br><span class="line"><span class="comment"># 然后在终端输入【python3 run1.py】并运行</span></span><br><span class="line"></span><br><span class="line">print(__name__, <span class="string">'run1-outside'</span>)  <span class="comment"># __main__ run1-outside</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(__name__, <span class="string">'run1-inside'</span>)  <span class="comment"># __main__ run1-inside</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建另一个名为【run2.py】的文件，填入下方代码，并放在与【run1.py】的相同目录下，</span></span><br><span class="line"><span class="comment"># 然后在终端命令行输入【python3 run2.py】并运行。用run2 调用run1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> run1  <span class="comment"># 这一行代码调用了外部的代码 run1，它只会print出：</span></span><br><span class="line"><span class="comment"># run1 run1-outside # 它只print出这一行东西，并且run1.py的【__main__】变成了【run1】</span></span><br><span class="line"><span class="comment"># run1 run1-inside  # 写在run1【if】缩进里的东西都没有被执行</span></span><br><span class="line"></span><br><span class="line">print(__name__, <span class="string">'run2-outside'</span>)  <span class="comment"># __main__ run2-outside</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(__name__, <span class="string">'run2-inside'</span>)  <span class="comment"># __main__ run2-inside</span></span><br></pre></td></tr></tbody></table></figure>


<p>程序入口与自检程序<br>当一个开发者编写一个库时（例如把它命名为 utils.py），如</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个库（模块）被命名为 utils.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span>:</span></span><br><span class="line">   ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>():</span></span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">c1 = C1()  <span class="comment"># 这是错误的做法，应该挪到 程序入口if内部</span></span><br><span class="line">func1()    <span class="comment"># 这是错误的做法，应该挪到 程序入口if内部</span></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">'__main__'</span>:</span><br><span class="line">    c = C1()</span><br><span class="line">    func1()</span><br></pre></td></tr></tbody></table></figure>
<p>当其他人只想调用 <code>C1</code> 或者 <code>func1</code> 时，他在另一个Python文件中，用 <code>import utils</code> 导入 <code>utils</code> 这个库时就不会运行程序入口if内部的任何代码了。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/26/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
