<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/26/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/26/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/26/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">347</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/jie-kou-ce-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/jie-kou-ce-shi/" class="post-title-link" itemprop="url">接口测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-20 14:17:13" itemprop="dateModified" datetime="2021-06-20T14:17:13Z">2021-06-20</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="项目的生命周期"><a href="#项目的生命周期" class="headerlink" title="项目的生命周期"></a>项目的生命周期</h2><h4 id="预测型（瀑布式）生命周期"><a href="#预测型（瀑布式）生命周期" class="headerlink" title="预测型（瀑布式）生命周期"></a>预测型（瀑布式）生命周期</h4><p>适用于在早期能够确定范围、时间和成本的项目</p>
<h4 id="迭代型生命周期"><a href="#迭代型生命周期" class="headerlink" title="迭代型生命周期"></a>迭代型生命周期</h4><ul>
<li>适用于需要通过一系列重复的循环的活动来渐进地增加产品的质量的项目</li>
<li>刚才这个大厨突然觉得自己这道糖醋鲤鱼还需要完善改进，所以</li>
</ul>
<h4 id="增量型生命周期"><a href="#增量型生命周期" class="headerlink" title="增量型生命周期"></a>增量型生命周期</h4><ul>
<li>增量型生命周期适用于需要进行拆分，分步实施，已达到最终项目目标的项目</li>
</ul>
<h4 id="适应型生命周期"><a href="#适应型生命周期" class="headerlink" title="适应型生命周期"></a>适应型生命周期</h4><ul>
<li>现在最火最流行的 <code>测试驱动开发（敏捷测试）</code></li>
<li>更多的是去响应变化，对项目的前途和范围并不十分明确</li>
<li>这时候就需要将项目划分为若干个短小的迭代周期，在每个周期都产出可验证的交付物，以此去获取用户反馈，从而最终产出用户需要的结果<br>三个步骤：</li>
</ul>
<ol>
<li>为未实现的新功能或者改进编写自动化测试。</li>
<li>提供通过所有定义的测试的最小代码量。</li>
<li>重构代码以满足所需的质量标准。</li>
</ol>
<p>测试驱动开发的好处在于可以有效的防止软件回归以及提供更有质量的代码。还有就是验收测试应该由客户来进行，客户通过对使用场景来设计验收测试，对应用程序是否满足他们的要求进行客观、公正的确认。能够通过单元测试、甚至是系统测试的功能未必能够通过客户的验收测试。</p>
<p>软件测试的“定义”</p>
<ul>
<li><code>测试</code>是产品最后一道防线，使用人工操作或者软件自动运行的方式来检验它是否满足规定的需求或弄清预期的结果与实际结果之间的差别的过程</li>
<li><code>软件测试</code>就是为发现软件错误而执行程序的过程</li>
<li><code>测试工程师</code>的本质意义在于：保护用户和业务的利益，使用户不受糟糕的设计、令人困惑的用户体验、功能 BUG、安全和隐私等问题的困扰</li>
<li>将测试看做 “用户” 的 “保护者”，是为客户而存在的</li>
</ul>
<p>软件测试流程</p>
<ul>
<li><p>传统的测试方式也不再适应于当前的环境。</p>
</li>
<li><p>所以，测试工作已经开始融入项目的每一个环节。</p>
</li>
<li><p>需求阶段</p>
<ul>
<li>头脑风暴</li>
<li>需求分析</li>
</ul>
</li>
<li><p>设计阶段</p>
<ul>
<li>测试模块划分</li>
<li>测试计划和用例设计</li>
</ul>
</li>
<li><p>执行阶段</p>
<ul>
<li>冒烟测试</li>
<li>测试执行</li>
<li>测试总结</li>
</ul>
</li>
</ul>
<p>自动化测试<br>“快速回归、自动测试、即时响应、迅速定位” 是当下测试人的十六<br>字方针</p>
<h2 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h2><ul>
<li>测试系统组件间接口的一种测试</li>
<li>用于检测外部系统与系统之间以及内部各个子系统之间的交互点。</li>
<li>测试的重点是要检查数据的交换、传递和控制管理过程，以及系统间的相互逻辑依赖关系等</li>
</ul>
<p>为什么要做接口测试?</p>
<ul>
<li>不同端的工作进度不同</li>
<li>需要对最开始出来的接口进行接口测试</li>
<li>很多系统关联都是基于接口来实现，接口测试可以将复杂的系统关联进行筒化。</li>
<li>接口功能比较单一，能够比较好的进行测试覆盖，也相对容易实现自动化持续集成。</li>
<li>接口相对于界面功能，会更底层一些，测试覆盖会更容易。</li>
</ul>
<p>接口测试可以<br>①节约时间，缩短项目周期<br>②提高工作效率<br>③提高系统健壮性<br> 及早发现问题<br> 降低测试成本<br> 接口一般较UI相对稳定，利于进行自动化<br> 接口是各种系统功能的基础</p>
<p>软件开发生命周期<br>接口测试在软件开发生命周期的位置：接口测试在单元测试之后，UI测试之前；<br>接口测试可以获得较高的投资回报。</p>
<p>接口测试又称为 API 测试</p>
<p>接口测试是测试系统组件间接口的一种测试。重点关注数据传递。</p>
<p>接口测试一般会用于多系统间交互开发，或者拥有多个子系统的应用系统开发的测试。</p>
<p>为什么要设计测试用例</p>
<p>1、理清思路，避免漏测</p>
<p>2、提高测试效率</p>
<p>3、跟进测试进度</p>
<p>4、告诉领导做过</p>
<p>5、跟进重复性工作</p>
<p>用例设计</p>
<p>1、功能</p>
<p>2、逻辑业务</p>
<p>3、异常</p>
<p>4、安全</p>
<p>用例设计-功能用例设计</p>
<p>①功能是否正常</p>
<p>②功能是否按照接口文档实现;代码接口参数名应该和接口文档统一</p>
<p>用例设计-逻辑用例设计<br>①是否依赖业务</p>
<p>用例设计-异常测试用例设计<br>①参数异常：</p>
<p>.关键字参数java,python,mysql这些，可以用键改为关键字进行测试。<br>.参数为空<br>.参数 多一个或少一个<br>.参数错误</p>
<p>用例设计-异常测试用例设计<br>①数据异常：关键字数据，数据为空，长度不一致，错误数据</p>
<p>用例设计-安全测试用例设计<br>①cookie<br>②header，移动端需要特别测试header<br>③唯一识别码</p>
<h3 id="手动测试"><a href="#手动测试" class="headerlink" title="手动测试"></a>手动测试</h3><p>测试方法：</p>
<ul>
<li>借助工具完成</li>
<li>拼接参数执行请求</li>
</ul>
<h3 id="自动化测试"><a href="#自动化测试" class="headerlink" title="自动化测试"></a>自动化测试</h3><p>把人为的测试行为转化为机器执行的一种过程，目标则是节省成本，提高测试效率。<br>通过代码的手段，把部分手动劳动转化为机器操作的方式</p>
<h5 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h5><ul>
<li>编写自动化脚本实现</li>
<li>一劳永逸，加入回归测试集合</li>
<li>需要一定编码经验</li>
</ul>
<h5 id="“可悲”的自动化测试"><a href="#“可悲”的自动化测试" class="headerlink" title="“可悲”的自动化测试"></a>“可悲”的自动化测试</h5><ul>
<li>按照功能测试用例用代码实现</li>
<li>通过eclipse，选好环境</li>
<li>右键Run As TestNG</li>
<li>一个人甚至是两个人一起目不转睛的盯着显示器</li>
<li>步骤执行不成功，回到代码，debug找问题，修改代码</li>
<li>部分脚本执行过程中卡住了，手动辅助点击，继续执行</li>
</ul>
<h5 id="老板心中的“自动化测试”"><a href="#老板心中的“自动化测试”" class="headerlink" title="老板心中的“自动化测试”"></a>老板心中的“自动化测试”</h5><ul>
<li>自动化测试要覆盖100%功能测试，后续不需要再招聘功能测试人员。</li>
<li>自动化测试要稳定，不需要太大的维护，他希望未来测试团队只有两到三<br>名自动化人员。</li>
<li>运行的结果可以自动报BUG，不需要人工介入。</li>
</ul>
<p>自动化测试的意义</p>
<ul>
<li>谨慎来说是把我们的自动化测试应用到项目中去，在保证质量的前提下，<br>让项目的测试成本低于纯手工测试</li>
<li>收益 = 手工测试成本(自动化可覆盖部分)-首次编写自动化脚本成本-自动化脚本维护成本</li>
<li>收益plus = 手工测试成本（自动化可覆盖部分）<em>迭代次数 - 首次编写自动化脚本成本-自动化脚本维护成本</em>迭代次数</li>
</ul>
<h3 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h3><p>测试覆盖：</p>
<ul>
<li>业务流程</li>
<li>边界值，特殊字符</li>
<li>参数类型，必选项，可选项等</li>
</ul>
<h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h3><p>测试覆盖：</p>
<ul>
<li>并发数，同一时间发送请求的用户数量，采用逐步加压的方式来找到系统能够支持的最大</li>
<li>吞吐量，tps</li>
<li>出错率等</li>
</ul>
<h3 id="安全性测试"><a href="#安全性测试" class="headerlink" title="安全性测试"></a>安全性测试</h3><p>测试覆盖：</p>
<ul>
<li>敏感数据加密</li>
<li>恶意攻击等</li>
</ul>
<h3 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h3><p>了解接口格式 –&gt; 编写测试用例 –&gt; 测试用例评审 –&gt; 开始测试 –&gt; 完成测试报告 –&gt; 结束 （在没有达到测试退出之前 ，比如测试报告里 级别高的bug较多，需要让开发修复后，再次进行测试，直到满足退出条件 后 结束）</p>
<h4 id="业务流程-GET"><a href="#业务流程-GET" class="headerlink" title="业务流程 - GET"></a>业务流程 - GET</h4><ul>
<li>正向用例：返回所有对象和返回某一个对象</li>
<li>负向用例：<ul>
<li>一个不存在的 id</li>
<li>URL 输入不正确 </li>
</ul>
</li>
</ul>
<h4 id="业务流程-POST"><a href="#业务流程-POST" class="headerlink" title="业务流程 - POST:"></a>业务流程 - POST:</h4><ul>
<li>正向用例：输入正确参数新加一个对象（特殊字符，中文等）</li>
<li>负向用例：<ul>
<li>参数 name 为空/重复</li>
<li>参数 age 为 0/-1/100/101/字符串/null/空</li>
<li>参数 salary 为整数/带小数/负数/null/</li>
</ul>
</li>
</ul>
<h4 id="业务流程-PUT"><a href="#业务流程-PUT" class="headerlink" title="业务流程 - PUT:"></a>业务流程 - PUT:</h4><ul>
<li>正向用例：输入正确参数修改一个对象（特殊字符，中文等）</li>
<li>负向用例：<ul>
<li>参数 id 为空/无效值</li>
<li>参数 name 为空/重复</li>
<li>参数 age 为 0/-1/100/101/字符串/null 空</li>
<li>参数 salary 为整数/带小数/负数/null 空</li>
</ul>
</li>
</ul>
<h4 id="业务流程-DELETE"><a href="#业务流程-DELETE" class="headerlink" title="业务流程 - DELETE"></a>业务流程 - DELETE</h4><ul>
<li>正向用例：删除所有对象和删除某一个对象</li>
<li>负向用例：<ul>
<li>一个不存在的 id</li>
<li>URL 输入不正确</li>
</ul>
</li>
</ul>
<h3 id="Rest-API实践一个测试实例"><a href="#Rest-API实践一个测试实例" class="headerlink" title="Rest API实践一个测试实例"></a>Rest API实践一个测试实例</h3><h4 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h4><ol>
<li>GET: <a target="_blank" rel="noopener" href="http://localhost:8080/mywebsite/user/">http://localhost:8080/mywebsite/user/</a></li>
</ol>
<ul>
<li>Header: Content-type = application/json</li>
<li>Body: 空</li>
<li>Response: 返回所有 User 对象</li>
<li>Status code: 200</li>
</ul>
<ol start="2">
<li>GET: <a target="_blank" rel="noopener" href="http://localhost:8080/mywebsite/user/%7Bid%7D">http://localhost:8080/mywebsite/user/{id}</a></li>
</ol>
<ul>
<li>Header: Content-type = application/json</li>
<li>Body: 空</li>
<li>Response: 返回指定 id 的 User 对象</li>
<li>Status code: 200</li>
</ul>
<ol start="3">
<li>POST: <a target="_blank" rel="noopener" href="http://localhost:8080/mywebsite/user/">http://localhost:8080/mywebsite/user/</a></li>
</ol>
<ul>
<li>Header: Content-type = application/json</li>
<li>Body: name (String 类型，不为空不可重复）, age (int 类型，在 0 和 100 之间）, salary (double 类型）</li>
<li>Response: 新加 User 对象</li>
<li>Status code: 201</li>
</ul>
<ol start="4">
<li>PUT: <a target="_blank" rel="noopener" href="http://localhost:8080/mywebsite/user/%7Bid%7D">http://localhost:8080/mywebsite/user/{id}</a></li>
</ol>
<ul>
<li>Header: Content-type = application/json</li>
<li>Body: name (String 类型，不为空不可重复）, age (int 类型，在 0 和 100 之间）, salary (double 类型）</li>
<li>Response: 修改 User 对象</li>
<li>Status code: 200</li>
</ul>
<ol start="4">
<li>DELETE: <a target="_blank" rel="noopener" href="http://localhost:8080/mywebsite/user/%7Bid%7D">http://localhost:8080/mywebsite/user/{id}</a></li>
</ol>
<ul>
<li>Header: Content-type = application/json</li>
<li>Body: 空</li>
<li>Response: 删除 id 的 User 对象</li>
<li>Status code: 204</li>
</ul>
<ol start="6">
<li>DELETE: <a target="_blank" rel="noopener" href="http://localhost:8080/mywebsite/user/">http://localhost:8080/mywebsite/user/</a></li>
</ol>
<ul>
<li>Header: Content-type = application/json</li>
<li>Body: 空</li>
<li>Response: 删除所有 User 对象</li>
<li>Status code: 204</li>
</ul>
<ol start="7">
<li>错误返回</li>
</ol>
<ul>
<li>Code: 4 Message：找不到指定 id 对象</li>
<li>Code: 5 Message：对象已经存在</li>
<li>Code: 6 Message：参数不匹配</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/wo-shou-hui-shou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/wo-shou-hui-shou/" class="post-title-link" itemprop="url">握手挥手</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-27 14:21:42" itemprop="dateModified" datetime="2021-07-27T14:21:42Z">2021-07-27</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>所谓的“连接”，其实是客户端和服务器的内存里保存的一份关于对方的信息，如ip地址、端口号</p>
<p>TCP基于字节流的传输层通信协议，它会处理IP层或以下的层的丢包、重复以及错误问题。<br>在连接的建立过程中，双方需要交换一些连接的参数。这些参数可以放在TCP头部。</p>
<p>1.面向连接的单播协议：<br>在发送数据前， 通信双方必须先在彼此间建立好连接才能进行数据的传输，数据传输完成后，双方必须断开此连接，以释放系统资源。</p>
<p>2.可靠传输：</p>
<ul>
<li>TCP 采用发送应答机制</li>
<li>超时重传</li>
<li>错误校验</li>
<li>流量控制和阻塞管理</li>
</ul>
<p>TCP服务模型<br>一个TCP连接由一个4元组构成，分别是两个IP地址和两个端口号。<br>一个TCP连接通常分为三个阶段：启动、数据传输、退出（关闭）。</p>
<p>当TCP接收到另一端的数据时，它会发送一个确认，但这个确认不会立即发送，一般会延迟一会儿。ACK是累积的，一个确认字节号N的ACK表示所有直到N的字节（不包括N）已经成功被接收了。这样的好处是如果一个ACK丢失，很可能后续的ACK就足以确认前面的报文段了。</p>
<p>一个完整的TCP连接是双向和对称的，数据可以在两个方向上平等地流动。给上层应用程序提供一种双工服务。一旦建立了一个连接，这个连接的一个方向上的每个TCP报文段都包含了相反方向上的报文段的一个ACK。</p>
<p>序列号的作用是使得一个TCP接收端可丢弃重复的报文段，记录以杂乱次序到达的报文段。<br>因为TCP使用IP来传输报文段，而IP不提供重复消除或者保证次序正确的功能。<br>另一方面，TCP是一个字节流协议，绝不会以杂乱的次序给上层程序发送数据。<br>因此TCP接收端会被迫先保持大序列号的数据不交给应用程序，直到缺失的小序列号的报文段被填满。</p>
<p>TCP头部<br>源端口和目的端口在TCP层确定双方进程，<br>序列号表示的是报文段数据中的第一个字节号，<br>ACK表示确认号，该确认号的发送方期待接收的下一个序列号，即最后被成功接收的数据字节序列号加1，这个字段只有在ACK位被启用的时候才有效。</p>
<p>当新建一个连接时，从客户端发送到服务端的第一个报文段的SYN位被启用，这称为SYN报文段，这时序列号字段包含了在本次连接的这个方向上要使用的第一个序列号，即初始序列号ISN，之后发送的数据是ISN加1，因此SYN位字段会消耗一个序列号，这意味着使用重传进行可靠传输。而不消耗序列号的ACK则不是。</p>
<p>头部长度（图中的数据偏移）以32位字为单位，也就是以4bytes为单位，它只有4位，最大为15，因此头部最大长度为60字节，而其最小为5，也就是头部最小为20字节（可变选项为空）。</p>
<p>当一个连接被建立或被终止时，交换的报文段只包含TCP头部，而没有数据。</p>
<p>TCP的三次握手建立一个连接和四次挥手来关闭一个连接<br>第一状态转换，第二就是发包的内容。</p>
<p>sequence number Seq序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。</p>
<p>URG Urgent:紧急位,URG=1,表示紧急数据<br>PSH Push:推送位,PSH=1,尽快吧数据交付给应用层</p>
<p>SYN：Synchronizaion Sequence Numbers 同步序列编号标志位，用于初如化一个连接的序列号。 是TCP/IP建立连接时使用的握手信号。SYN=1表示连接请求报文<br>SYN_SENT 同步已发送状态</p>
<p>Acknowledge，是标志位中的ACK确认号标志；<br>Acknowledgment number， ack是确认序列号 ACK=1,确认序号字段才生效 占32位，Ack=Seq+1。</p>
<p>SYN_RECV 同步收到状态，</p>
<p>ESTABLISHED 已建立连接状态<br>CLOSED 关闭状态<br>LISTEH 收听状态<br>RST —— （reset by peer）重置连接位 RST=1,重新建立连接<br>FIN —— 该报文段的发送方已经结束向对方发送数据。终止位,FIN=1表示释放连接,表明此报文的发送方的数据已经发送完毕，并且要求释放；</p>
<p>ISN(Initial Sequence Number),三次握手的一个重要功能是客户端和服务端交换isn 以便让对方知道接下来接收数据的时候如何按序列号组装数据。</p>
<p>如果ISN是固定的，攻击者很容易猜出后续的确认号。<br>ISN = M + F(localhost, localport, remotehost, remoteport)<br>M是一个计时器，每隔4毫秒加1。 F是一个Hash算法，根据源IP、目的IP、源端口、目的端口生成一个随机数值。要保证hash算法不能被外部轻易推算得出。</p>
<p>TCP连接的建立采用客户服务器方式。<br>主动发起连接建立的应用进程叫做客户( client )。<br>被动等待连接建立的应用进程叫做服务器( server )。<br>最初两端的TCP进程都处于 CLOSED(关闭)状态，<br>client 端主动打开链接，<br>而 server 端被动打开链接。</p>
<p>服务器端准备接受连接请求后进入到 LISTEN(收听状态)，等待客户端连接请求。<br>客户端需要建立连接时向服务器端发送请求，请求内容包括同步位 SYN=1 和初始序号 seq =J 即ISN(c)，这时客户端进入SYN_SENT(同步已发送)状态。</p>
<p>服务器接收到请求后作出响应，向客户端发送确认信息，确认信息包括同步位 SYN=1、确认位ACK=1ISN(s)、确认号 ack=J+1 和自己初始序号 seq=K，这时服务端进入 SYN_RECV(同步收到)状态。这样，每发送一个SYN，序列号就会加1. 如果有丢失的情况，则会重传。</p>
<p>客户端收到服务器端发过来的确认信息后，先进行验证确认号 ack=J + 1，此时还需向服务器端发送确认信息，确认信息包括确认位 ACK=1 和 确认号ack=K+1，这时TCP连接已经建立，客户端进入 ESTABLISHED状态。服务器端接收到确认后，也进入到established状态。</p>
<p>客户端和服务端通信前要进行连接，“3次握手”的作用就是双方都能明确自己和对方的收、发能力是正常的。</p>
<h4 id="三次握手的过程"><a href="#三次握手的过程" class="headerlink" title="三次握手的过程"></a>三次握手的过程</h4><p>第一次握手：<br>客户端发送syn请求包(syn=1)到服务器，Seq=x(随机产生的顺序号码)<br>并进入SYN_SEND状态，等待服务器确认；</p>
<p>第二次握手：<br>服务器收到syn请求包，必须确认客户的SYN（确认号ack=x+1），并返回一个ACK应答，同时自己也发送一个SYN请求包 Seq=y(随机产生)，此时服务器进入SYN_RECV状态；<br>客户端发送网络包，服务端收到了。这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的。<br>服务端发包，客户端收到了。这样客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的。 从客户端的视角来看，我接到了服务端发送过来的响应数据包，说明服务端接收到了我在第一次握手时发送的网络包，并且成功发送了响应数据包，这就说明，服务端的接收、发送能力正常。而另一方面，我收到了服务端的响应数据包，说明我第一次发送的网络包成功到达服务端，这样，我自己的发送和接收能力也是正常的。</p>
<p>第三次握手：<br>客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK=1 ack=y+1，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。</p>
<p>握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始建立连接,数据传输。<br>理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。客户端收到服务端的SYN请求和ACK应答，发送ACK应答，客户端进入ESTABLISH状态，服务端收到应答后进入ESTABLISH。<br>如果没有收到应答，数据包都会根据TCP的重传机制进行重传。<br>客户端发包，服务端收到了。这样服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的。 第一、二次握手后，服务端并不知道客户端的接收能力以及自己的发送能力是否正常。而在第三次握手时，服务端收到了客户端对第二次握手作的回应。从服务端的角度，我在第二次握手时的响应数据发送出去了，客户端接收到了。所以，我的发送能力是正常的。而客户端的接收能力也是正常的。</p>
<p>经历了上面的三次握手过程，客户端和服务端都确认了自己的接收、发送能力是正常的。之后就可以正常通信了。</p>
<p>每次都是接收到数据包的一方可以得到一些结论，发送的一方其实没有任何头绪。我虽然有发包的动作，但是我怎么知道我有没有发出去，而对方有没有接收到呢？</p>
<p>而从上面的过程可以看到，最少是需要三次握手过程的。两次达不到让双方都得出自己、对方的接收、发送能力都正常的结论。其实每次收到网络包的一方至少是可以得到：对方的发送、我方的接收是正常的。而每一步都是有关联的，下一次的“响应”是由于第一次的“请求”触发，因此每次握手其实是可以得到额外的结论的。比如第三次握手时，服务端收到数据包，表明看服务端只能得到客户端的发送能力、服务端的接收能力是正常的，但是结合第二次，说明服务端在第二次发送的响应包，客户端接收到了，并且作出了响应，从而得到额外的结论：客户端的接收、服务端的发送是正常的。</p>
<p>3次握手就跟早期打电话时的情况一样：1、听得到吗？2、听得到，你呢？3、我也听到了。然后才开始真正对话 4次挥手是：1、老师，下课了。2、好，我知道了，我说完这点。3、好了，说完了，下课吧。4、谢谢老师，老师再见</p>
<p>三次握手的最主要目的是保证连接是双工的，可靠更多的是通过重传机制来保证的。<br>双工：发送和接收可以同时执行，连接的双方都可以相互发送和接收<br>因为连接是全双工的,双方必须都收到对方的FIN包及确认才可关闭。</p>
<p>但是为什么一定要进行三次握手来保证连接是双工的呢，一次不行么？两次不行么？我们举一个现实生活中两个人进行语言沟通的例子来模拟三次握手。</p>
<p>第一次对话：</p>
<p>   老婆让甲出去打酱油，半路碰到一个朋友乙，甲问了一句：哥们你吃饭了么？</p>
<p>结果乙带着耳机听歌呢，根本没听到，没反应。甲心里想：跟你说话也没个音，不跟你说了，沟通失败。说明乙接受不到甲传过来的信息的情况下沟通肯定是失败的。</p>
<p>如果乙听到了甲说的话，那么第一次对话成功，接下来进行第二次对话。</p>
<p>第二次对话：</p>
<p>   乙听到了甲说的话，但是他是老外，中文不好，不知道甲说的啥意思也不知道怎样回答，于是随便回答了一句学过的中文 ：我去厕所了。甲一听立刻笑喷了，“去厕所吃饭”?道不同不相为谋，离你远点吧，沟通失败。说明乙无法做出正确应答的情况下沟通失败。</p>
<p>如果乙听到了甲的话，做出了正确的应答，并且还进行了反问：我吃饭了，你呢？那么第二次握手成功。</p>
<p>通过前两次对话证明了乙能够听懂甲说的话，并且能做出正确的应答。接下来进行第三次对话。</p>
<p>第三次对话：</p>
<p>甲刚和乙打了个招呼，突然老婆喊他，“你个死鬼，打个酱油咋这么半天，看我回家咋收拾你”，甲是个妻管严，听完吓得二话不说就跑回家了，把乙自己晾那了。乙心想：这什么人啊，得，我也回家吧，沟通失败。说明甲无法做出应答的情况下沟通失败。</p>
<p>如果甲也做出了正确的应答：我也吃了。那么第三次对话成功，两人已经建立起了顺畅的沟通渠道，接下来开始持续的聊天。</p>
<p>通过第二次和第三次的对话证明了甲能够听懂乙说的话，并且能做出正确的应答。</p>
<p>可见，两个人进行有效的语言沟通，这三次对话的过程是必须的。</p>
<p>同理对于TCP为什么需要进行三次握手我们可以一样的理解：</p>
<p>为了保证服务端能收接受到客户端的信息并能做出正确的应答而进行前两次(第一次和第二次)握手，为了保证客户端能够接收到服务端的信息并能做出正确的应答而进行后两次(第二次和第三次)握手。</p>
<p>为了保证服务端能收接受到客户端的信息并能做出正确的应答而进行前两次(第一次和第二次)握手，为了保证客户端能够接收到服务端的信息并能做出正确的应答而进行后两次(第二次和第三次)握手。</p>
<p>为什么要进行三次握手，不是二次握手<br>谢希仁版《计算机网络》中的例子:<br>“已失效的连接请求报文段”的产生在这样一种情况下：<br>client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。<br>本来这是一个早已失效的报文段,但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。<br>于是就向client发出确认报文段，同意建立连接。</p>
<p>假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。<br>由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据,但server却以为新的运输连接已经建立，并一直等待client发来数据。<br>这样，server的很多资源就白白浪费掉了。<br>采用“三次握手”的办法可以防止上述现象发生。<br>例如刚才那种情况，client不会向server的确认发出确认,server由于收不到确认，就知道client并没有要求建立连接。”<br>这个例子很清晰的阐释了“三次握手”对于建立可靠连接的意义。</p>
<h3 id="TCP四次挥手，状态转换"><a href="#TCP四次挥手，状态转换" class="headerlink" title="TCP四次挥手，状态转换"></a>TCP四次挥手，状态转换</h3><p>主动方可以是服务器端也可以是客户端。</p>
<p>FIN(FINbit) 终止标志位   |   FIN_WAIT_1 终止等待1状态    |    FIN_WAIT_2 终止等待2状态</p>
<p>ACK(ACKbit) 确认标志位 |   CLOSE_WAIT 关闭等待状态  |    LAST_ACK 最后确认状态</p>
<p>ESTABLISHED 已建立连接状态    |    TIME_WAIT 时间等待状态    |    CLOSED 关闭状态</p>
<p>数据传输结束后，通信的双方都可以释放连接。最初客户端和服务器端都处于extablished状态。例如：客户端主动发起连接释放。</p>
<p>客户端向服务器端发送连接释放请求，主动关闭TCP连接，请求内容包括终止控制位 FIN=1 和 希望接收者看到的自己当前的序列号 seq=x，这时客户端进入 FIN_WAIT_1(终止等待1)状态，等待服务器端的确认。</p>
<p>服务器端收到连接释放请求后即发出确认信息，确认信息包括 确认位 ACK=1 和 确认号ack(ACKnum) = x+1，表明收到了上一个包，上层的应用程序会被告知另一端发起了关闭操作，通常这将引起应用程序发起自己的关闭操作进入到CLOSE_WAIT(关闭等待)状态，此时客户端已没有数据发送了，但服务器端还可以向客服端发送数据，服务器端到客户端这个方向的连接并未关闭。客户端收到确认请求后，就进入到 FIN_WAIT_2 ( 终止等待2 )状态。</p>
<p>当服务器端已经没有向客户端要发送的数据时候，会向客户端发送连接释放请求，请求内容包括 终止控制位 FIN=1 、序号seq=y 和 上次已经发送过的确认号 ack(ACKnum) = x+1，这时服务器进入 LAST_ACK(最后确认)状态，等待客户端的确认。</p>
<p>客户端收到连接释放请求，必须给服务器端发送确认，确认信息包括 确认位 ACK=1、确认号ack(ACKnum) = y+1，这时客户端进入TIME_WAIT(时间等待)状态，这时TCP连接还没释放掉，必须经过时间等待计时器(TIME-WAIT timer)设置的时间2MSL后，客户端才进入到 CLOSED(关闭)状态。服务器端收到确认后，就进入closed(关闭)状态。</p>
<p>TCP连接是双向传输的对等的模式，就是说双方都可以同时向对方发送或接收数据。<br>当有一方要关闭连接时，会发送指令告知对方，我要关闭连接了。<br>这时对方会回一个ACK，此时一个方向的连接关闭。<br>但是另一个方向仍然可以继续传输数据，等到发送完了所有的数据后，会发送一个FIN段来关闭此方向上的连接。接收方发送ACK确认关闭连接。<br>注意，接收到FIN报文的一方只能回复一个ACK, 它是无法马上返回对方一个FIN报文段的，<br>因为结束数据传输的“指令”是上层应用层给出的，我只是一个“搬运工”，我无法了解“上层的意志”。</p>
<p>“三次握手，四次挥手”怎么完成？<br>其实3次握手的目的并不只是让通信双方都了解到一个连接正在建立，还在于利用数据包的选项来传输特殊的信息，交换初始序列号ISN。</p>
<p>3次握手是指发送了3个报文段，<br>4次挥手是指发送了4个报文段。<br>SYN和FIN段都是会利用重传进行可靠传输的。</p>
<p>HTTP请求过程<br>一、一个完整的HTTP请求，通常有7个步骤：<br>1、建立TCP连接；<br>2、web浏览器向web服务器发送请求命令；<br>3、浏览器发送请求头信息；<br>4、服务器应答；<br>5、服务器发送应答头信息；<br>6、服务器向浏览器发送数据；<br>7、服务器关闭TCP连接。</p>
<p>readyState属性(返回请求的当前状态)：<br>0：请求未初始化，open还没有调用；<br>1：服务器连接已建立，open已经调用；<br>2：请求已接收，即，接收到头部信息了；<br>3：请求处理中，即，接收到响应体了；<br>4：请求已完成，且响应已就绪，即，响应完成了。</p>
<p>（TCP的标志为：SYN/ACK）<br>1、三次握手<br>（1）发送端——-数据包（SYN）————-&gt;接收端<br>（2）接收端————–数据包（SYN/ACK)——&gt;发送端<br>（3）发送端——-数据包（ACK）————-&gt;接收端</p>
<p>2、四次挥手<br>（1）主动关闭方——TIN（关闭数据传送）—————–&gt;被动关闭方；<br>（2）被动关闭方————ACK（确认序号为收到序号+1）————–&gt;主动关闭方；<br>（3）被动关闭方————FIN（关闭数据传送）———————-&gt;主动关闭方；<br>（4）主动关闭方——ACK（确认序号为收到序号+1）———-&gt;被动关闭方。</p>
<ol start="3">
<li>客户端收到FIN的应答后进入FIN_WAIT2状态</li>
<li>服务端发送FIN请求包，进入LAST_ACK状态</li>
<li>客户端收到FIN请求包后，发送应答进入TIME_WAIT状态</li>
<li>服务器收到ACK应答后，进入close状态。</li>
</ol>
<p>与建立连接的“三次握手”类似，断开一个TCP连接则需要“四次握手”。</p>
<p>第一次挥手<br>客户端发送FIN=1，请求断开连接，客户端进入FIN_WAIT1状态 Seq=u<br>用来关闭主动方到被动关闭方的数据传送，也就是主动关闭方告诉被动关闭方：我已经不会再给你发数据了 数据传完了可以关闭了(当然，在fin包之前发送出去的数据，如果没有收到对应的ack确认报文，主动关闭方依然会重发这些数据)，但是，此时主动关闭方还可以接受数据。</p>
<p>第二次挥手<br>服务端被动关闭方收到FIN包后，返回应答发送一个ACK=1给客户端，进入CLOSE_WAIT状态，确认序号为收到序号ack=u+1（与SYN相同，一个FIN占用一个序号）。</p>
<p>第三次挥手<br>被动关闭方发送一个FIN=1, ack=u+1, Seq=w, ACK=1 用来关闭被动关闭方到主动关闭方的数据传送，也就是告诉主动关闭方，我的数据也发送完了，不会再给你发数据了。</p>
<p>第四次挥手<br>主动关闭方收到FIN=1后，发送一个ACK=1给被动关闭方，确认序号为收到序号ack=w+1，Seq=u+1至此，完成四次挥手。连接断开</p>
<h4 id="为什么需要三次握手"><a href="#为什么需要三次握手" class="headerlink" title="为什么需要三次握手"></a>为什么需要三次握手</h4><p>已经失效的连接请求报文传送到对方，引起错误<br>如果不进行第三次握手，就会导致一个现象，发送方发送的连接请求由于网络原因(超时重传)，发送多个连接请求，导致建立多个连接.</p>
<h4 id="为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？"><a href="#为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？" class="headerlink" title="为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？"></a>为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？</h4><p>这是因为服务端的LISTEN状态下的SOCKET当收到SYN报文的建连请求后，它可以把ACK和SYN（ACK起应答作用，而SYN起同步作用）放在一个报文里来发送。<br>但关闭连接时，当收到对方的FIN报文通知时，它仅仅表示对方没有数据发送给你了；但未必你所有的数据都全部发送给对方了，所以你可以未必会马上会关闭SOCKET,也即你可能还需要发送一些数据给对方之后，再发送FIN报文给对方来表示你同意可以关闭连接了，所以它这里的ACK报文和FIN报文多数情况下都是分开发送的。</p>
<p><img src="/2020/08/21/wo-shou-hui-shou/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.jpg" alt="description"><br><img src="/2020/08/21/wo-shou-hui-shou/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.jpg" alt="description"></p>
<h4 id="抓包分析三次握手和四次挥手"><a href="#抓包分析三次握手和四次挥手" class="headerlink" title="抓包分析三次握手和四次挥手"></a>抓包分析三次握手和四次挥手</h4><p><img src="/2020/08/21/wo-shou-hui-shou/4%E6%AC%A1%E6%8C%A5%E6%89%8B.png"></p>
<p>查看正在使用的网卡名：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@VM-0-9-centos</span> <span class="string">~</span>]<span class="comment"># cat /proc/net/dev</span></span><br><span class="line"><span class="string">Inter-|</span>   <span class="string">Receive</span>                                                <span class="string">|</span>  <span class="string">Transmit</span></span><br><span class="line"> <span class="string">face</span> <span class="string">|bytes</span>    <span class="string">packets</span> <span class="string">errs</span> <span class="string">drop</span> <span class="string">fifo</span> <span class="string">frame</span> <span class="string">compressed</span> <span class="string">multicast|bytes</span>    <span class="string">packets</span> <span class="string">errs</span> <span class="string">drop</span> <span class="string">fifo</span> <span class="string">colls</span> <span class="string">carrier</span> <span class="string">compressed</span></span><br><span class="line"><span class="attr">veth91c37ec:</span> <span class="number">4855293</span>   <span class="number">22637</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>          <span class="number">0</span>         <span class="number">0</span>  <span class="number">2435595</span>   <span class="number">26456</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>       <span class="number">0</span>          <span class="number">0</span></span><br><span class="line">  <span class="attr">eth0:</span> <span class="number">15742648569</span> <span class="number">124304860</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>          <span class="number">0</span>         <span class="number">0</span> <span class="number">22557456586</span> <span class="number">124485545</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>       <span class="number">0</span>          <span class="number">0</span></span><br><span class="line"><span class="attr">veth5d20c56:</span> <span class="number">232945872</span> <span class="number">1129290</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>          <span class="number">0</span>         <span class="number">0</span> <span class="number">235971602</span> <span class="number">1408301</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>       <span class="number">0</span>          <span class="number">0</span></span><br><span class="line">    <span class="attr">lo:</span> <span class="number">523617601</span> <span class="number">6698896</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>          <span class="number">0</span>         <span class="number">0</span> <span class="number">523617601</span> <span class="number">6698896</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>       <span class="number">0</span>          <span class="number">0</span></span><br><span class="line"><span class="attr">vethf71aa18:</span> <span class="number">265381972</span> <span class="number">1842358</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>          <span class="number">0</span>         <span class="number">0</span> <span class="number">315445452</span> <span class="number">1476199</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>       <span class="number">0</span>          <span class="number">0</span></span><br><span class="line"><span class="attr">br-6247fbae3754:</span> <span class="number">190506345</span>  <span class="number">901637</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>          <span class="number">0</span>         <span class="number">0</span> <span class="number">158227422</span>  <span class="number">905225</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>       <span class="number">0</span>          <span class="number">0</span></span><br><span class="line"><span class="attr">docker0:</span> <span class="number">9470848</span>   <span class="number">29814</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>          <span class="number">0</span>         <span class="number">0</span>  <span class="number">5014157</span>   <span class="number">34837</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>       <span class="number">0</span>          <span class="number">0</span></span><br><span class="line">[<span class="string">root@VM-0-9-centos</span> <span class="string">~</span>]<span class="comment"># sudo tcpdump -n -S -i eth0 host www.baidu.com and tcp port 80</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="为啥time-wait需要等待2msl"><a href="#为啥time-wait需要等待2msl" class="headerlink" title="为啥time_wait需要等待2msl"></a>为啥time_wait需要等待2msl</h4><ul>
<li>msl maximum segment lifetime: 最大段的生命周期 最长包的传输时间（30秒-1分钟）</li>
<li>保证TCP 协议的全双工连接可以可靠关闭</li>
<li>保证这次连接的重复数据段从网络中消失</li>
</ul>
<h4 id="为啥会出现大量的close-wait"><a href="#为啥会出现大量的close-wait" class="headerlink" title="为啥会出现大量的close_wait?"></a>为啥会出现大量的close_wait?</h4><ul>
<li>首先close_wait一般出现在被动关闭方</li>
<li>并发请求太多导致</li>
<li>被动关闭方未及时释放端口资源导致</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//1、监听端口</span></span><br><span class="line">    listener, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"0.0.0.0:9090"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Printf(<span class="string">"listen fail, err: %v\n"</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//2.建立套接字连接</span></span><br><span class="line">    <span class="keyword">for</span> {</span><br><span class="line">        conn, err := listener.Accept()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Printf(<span class="string">"accept fail, err: %v\n"</span>, err)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//3. 创建处理协程</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(conn net.Conn)</span></span> {</span><br><span class="line">            <span class="comment">//defer conn.Close() //这里不填写，服务端会出现close_wait状态，客户端会有finish_wait状态</span></span><br><span class="line">            <span class="keyword">for</span> {</span><br><span class="line">                <span class="keyword">var</span> buf [<span class="number">128</span>]<span class="keyword">byte</span></span><br><span class="line">                n, err := conn.Read(buf[:])</span><br><span class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">                    fmt.Printf(<span class="string">"read from connect failed, err: %v\n"</span>, err)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                }</span><br><span class="line">                str := <span class="keyword">string</span>(buf[:n])</span><br><span class="line">                fmt.Printf(<span class="string">"receive from client, data: %v\n"</span>, str)</span><br><span class="line">            }</span><br><span class="line">        }(conn)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="UDP为啥不需要流量控制"><a href="#UDP为啥不需要流量控制" class="headerlink" title="UDP为啥不需要流量控制"></a>UDP为啥不需要流量控制</h4><p>非连接不可靠的通信，每一次发送需要绑定ip和端口，发送出去不需要确认，不需要三次握手</p>
<h4 id="TCP为啥需要流量控制"><a href="#TCP为啥需要流量控制" class="headerlink" title="TCP为啥需要流量控制"></a>TCP为啥需要流量控制</h4><ul>
<li>由于通讯双方，网速不同，通讯方任一方发送过快都会导致对方消息处理不过来，所以就需要吧数据放到缓冲区中</li>
<li>如果缓冲区满了，发送方还在疯狂发送，那接收方只能吧数据包丢弃，因此我们需要控制发送速率。</li>
<li>我们缓冲区剩余大小称之为接收窗口，用变量win表示，如果接收方的win=0，则发送方停止发送</li>
</ul>
<p><a href="%E6%8F%A1%E6%89%8B%E6%8C%A5%E6%89%8B/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6.png"></a></p>
<h3 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h3><ul>
<li>流量控制考虑点对点的通信量的控制</li>
<li>拥塞控制考虑整个网络，是全局性的考虑</li>
</ul>
<h4 id="TCP为啥需要拥塞控制"><a href="#TCP为啥需要拥塞控制" class="headerlink" title="TCP为啥需要拥塞控制"></a>TCP为啥需要拥塞控制</h4><ul>
<li>拥塞控制是调节网络的负载</li>
<li>接收方网络资源繁忙，因未及时响应ack导致发送方重传大量数据，这样将导致网络更加拥塞</li>
<li>拥塞控制是动态调整win大小，不只是依赖缓冲区大小确定窗口大小</li>
</ul>
<h4 id="TCP拥塞控制"><a href="#TCP拥塞控制" class="headerlink" title="TCP拥塞控制"></a>TCP拥塞控制</h4><p>tcp 拥塞控制包括2部分</p>
<ul>
<li>慢开始和拥塞避免</li>
<li>快速重传和快速恢复 （如果收到三个重复的ack,执行快速重传，当前窗口值变为原来的一半）<br><img src="/2020/08/21/wo-shou-hui-shou/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6.png"></li>
</ul>
<h3 id="TCP粘包、拆包"><a href="#TCP粘包、拆包" class="headerlink" title="TCP粘包、拆包"></a>TCP粘包、拆包</h3><h4 id="为什么会出现粘包、拆包"><a href="#为什么会出现粘包、拆包" class="headerlink" title="为什么会出现粘包、拆包?"></a>为什么会出现粘包、拆包?</h4><ul>
<li>应用程序写入的数据大于套接字缓冲区大小，这将会发生拆包</li>
<li>应用程序写入数据小于套接字缓冲区大小，网卡将应用多次写入的数据发送到网络上，这将会发生粘包</li>
<li>进行MSS(最大报文长度)大小的TCP分段，当“TCP报文长度-TCP头部长度&gt;MSS”的时候将发生拆包</li>
<li>接收方法不及时读取套接字缓冲区数据，这将发生粘包</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/cao-zuo-xi-tong-de-nei-cun-guan-li-ji-zhi-fen-ye-he-fen-duan-ji-fen-ye-he-fen-duan-de-qu-bie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/cao-zuo-xi-tong-de-nei-cun-guan-li-ji-zhi-fen-ye-he-fen-duan-ji-fen-ye-he-fen-duan-de-qu-bie/" class="post-title-link" itemprop="url">操作系统的内存管理机制--分页和分段 及 分页和分段的区别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-14 07:31:27" itemprop="dateModified" datetime="2021-04-14T07:31:27Z">2021-04-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="操作系统的内存管理机制"><a href="#操作系统的内存管理机制" class="headerlink" title="操作系统的内存管理机制"></a>操作系统的内存管理机制</h2><h3 id="分页机制"><a href="#分页机制" class="headerlink" title="分页机制"></a>分页机制</h3><p>操作系统为了高效管理内存，减少内存碎片，所以采用分页机制<br>逻辑地址和物理地址分离的内存分配管理方案</p>
<ul>
<li>逻辑地址划分为固定大小的页(Page)</li>
<li>物理地址划分为同样大小的帧(Frame)</li>
<li>通过页表对应逻辑地址和物理地址</li>
</ul>
<p>图解：左边是用户程序，对于用户程序关心的是逻辑地址，通过页表来获取物理地址。页表里面映射了逻辑地址和物理地址的对应关系，通过中间和右边图，可以看出逻辑地址对应的物理地址不一定是连续的。</p>
<h3 id="分段机制"><a href="#分段机制" class="headerlink" title="分段机制"></a>分段机制</h3><p>分段是为了满足代码的一些逻辑需求</p>
<ul>
<li>数据共享，数据保护，动态链接等</li>
<li>通过段表实现逻辑地址和物理地址的映射关系</li>
<li>每个段内部是连续内存分配，段和段之间是离散分配的</li>
</ul>
<p>图解：段表里面主要保存的是段号、段长和起始地址(基址)，通过这三个就可以确定每个段，它从那个地方开始并且它的长度是多少，段表可以把段号跟内存空间真实的物理地址对应起来。</p>
<p>3.分页和分段的区别</p>
<ul>
<li>页是出于内存利用率的角度提出的离散分配机制</li>
<li>段是出于用户角度，用于数据保护，数据隔离等用途的管理机制</li>
<li>页的大小是固定的，操作系统决定；段大小不确定，用户程序决定</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shu-ju-ya-suo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shu-ju-ya-suo/" class="post-title-link" itemprop="url">python 数据压缩</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-04 15:30:25" itemprop="dateModified" datetime="2021-05-04T15:30:25Z">2021-05-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line">s = <span class="string">b'witch which has which witches wrist watch'</span></span><br><span class="line">print(len(s))</span><br><span class="line"><span class="comment"># 41</span></span><br><span class="line">t = zlib.compress(s)</span><br><span class="line">print(len(t))</span><br><span class="line"><span class="comment"># 37</span></span><br><span class="line">print(zlib.decompress(t))</span><br><span class="line"><span class="comment"># b'witch which has which witches wrist watch'</span></span><br><span class="line">print(zlib.crc32(s))</span><br><span class="line"><span class="comment"># 226805979</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-xia-dan-zhi-fu-qian-duan-ye-mian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-xia-dan-zhi-fu-qian-duan-ye-mian/" class="post-title-link" itemprop="url">旅游网下单支付前端页面</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h3><ul>
<li>前端页面开发</li>
<li>后端接口开发</li>
<li>接口联调</li>
<li>代码优化</li>
</ul>
<h3 id="提交订单页"><a href="#提交订单页" class="headerlink" title="提交订单页"></a>提交订单页</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，配置路由规则，新建组件<br><code>src\router\index.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> OrderSubmit <span class="keyword">from</span> <span class="string">'../views/order/Submit.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 提交订单</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/order/submit/:id'</span>,</span><br><span class="line">    name: <span class="string">'OrderSubmit'</span>,</span><br><span class="line">    component: OrderSubmit</span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></li>
<li>第二步，查找Vant中可以使用的组件</li>
<li>第三步，实现组件模板部分</li>
</ul>
<p><code>src\views\order\Submit.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 填写订单 --&gt;</span><br><span class="line">  &lt;div class="page-order-submit"&gt;</span><br><span class="line">    &lt;!-- 页面导航 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="填写订单"</span><br><span class="line">      left-text="返回"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"/&gt;</span><br><span class="line">    &lt;!-- 描述信息 --&gt;</span><br><span class="line">    &lt;div class="order-info"&gt;</span><br><span class="line">      &lt;div class="left"&gt;</span><br><span class="line">        &lt;h3&gt;门票标题&lt;/h3&gt;</span><br><span class="line">        &lt;div class="tips"&gt;23:00前可定明日&lt;/div&gt;</span><br><span class="line">        &lt;div class="tags"&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">            &lt;van-icon name="clock-o" /&gt;明日可定</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">            &lt;van-icon name="clock-o" /&gt;条件退</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="right"&gt;</span><br><span class="line">        &lt;div class="text-warning"&gt;￥{{ price }}/张&lt;/div&gt;</span><br><span class="line">        &lt;van-button plain hairline type="info"</span><br><span class="line">          size="mini"</span><br><span class="line">          @click="showPopup=true"&gt;预订须知&lt;/van-button&gt;</span><br><span class="line">        &lt;van-popup</span><br><span class="line">          v-model="showPopup"</span><br><span class="line">          closeable</span><br><span class="line">          position="bottom"</span><br><span class="line">          :style="{ height: '80%' }"</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //描述信息 --&gt;</span><br><span class="line">    &lt;!-- 提交表单 --&gt;</span><br><span class="line">    &lt;van-form @submit="onSubmit" class="form-box"&gt;</span><br><span class="line">      &lt;van-cell-group class="form-group"&gt;</span><br><span class="line">        &lt;van-cell title="选择出行日期"</span><br><span class="line">          :value="form.play_date"</span><br><span class="line">          @click="showCalendar = true" /&gt;</span><br><span class="line">        &lt;van-calendar v-model="showCalendar" @confirm="onConfirm" /&gt;</span><br><span class="line">      &lt;/van-cell-group&gt;</span><br><span class="line">      &lt;van-cell-group class="form-group"&gt;</span><br><span class="line">        &lt;van-cell title="购买数量"&gt;</span><br><span class="line">          &lt;van-stepper v-model="form.buy_count" integer min="1"/&gt;</span><br><span class="line">        &lt;/van-cell&gt;</span><br><span class="line">      &lt;/van-cell-group&gt;</span><br><span class="line">      &lt;van-cell-group class="form-group"&gt;</span><br><span class="line">        &lt;van-field</span><br><span class="line">          v-model="form.to_user"</span><br><span class="line">          type="text"</span><br><span class="line">          label="收件人"</span><br><span class="line">          placeholder="输入收件人"</span><br><span class="line">          :rules="[{ required: true, message: '请输入收件人' }]"</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;van-field</span><br><span class="line">          v-model="form.to_phone"</span><br><span class="line">          type="text"</span><br><span class="line">          label="手机号码"</span><br><span class="line">          placeholder="输入手机号码"</span><br><span class="line">          :rules="[{ required: true, message: '请输入手机号码' }]"</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/van-cell-group&gt;</span><br><span class="line">      &lt;van-submit-bar :price="totalPrice" button-text="提交订单" @submit="onSubmit" /&gt;</span><br><span class="line">    &lt;/van-form&gt;</span><br><span class="line">    &lt;!-- //提交表单 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 预订须知弹框显示</span><br><span class="line">      showPopup: false,</span><br><span class="line">      // 日期选择弹框</span><br><span class="line">      showCalendar: false,</span><br><span class="line">      price: 98,</span><br><span class="line">      form: {</span><br><span class="line">        play_date: '',</span><br><span class="line">        buy_count: 1,</span><br><span class="line">        to_user: '',</span><br><span class="line">        to_phone: ''</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 计算总价</span><br><span class="line">     */</span><br><span class="line">    totalPrice () {</span><br><span class="line">      return this.price * this.form.buy_count * 100</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    onSubmit () {</span><br><span class="line">      console.log('提交表单')</span><br><span class="line">    },</span><br><span class="line">    formatDate (date) {</span><br><span class="line">      return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 选择日期</span><br><span class="line">     */</span><br><span class="line">    onConfirm (date) {</span><br><span class="line">      // 隐藏日历弹框</span><br><span class="line">      this.showCalendar = false</span><br><span class="line">      // 保存数据</span><br><span class="line">      this.form.play_date = this.formatDate(date)</span><br><span class="line">    },</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第四步，模拟数据，实现效果</li>
</ul>
<h3 id="支付页面开发"><a href="#支付页面开发" class="headerlink" title="支付页面开发"></a>支付页面开发</h3><h4 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li><p>第一步，配置路由规则，新建组件<br><code>src\router\index.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> OrderPay <span class="keyword">from</span> <span class="string">'../views/order/Pay.vue'</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 确认订单并支付</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/order/pay/:sn'</span>,</span><br><span class="line">    name: <span class="string">'OrderPay'</span>,</span><br><span class="line">    component: OrderPay</span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第二步，查找Vant中可以使用的组件</p>
</li>
<li><p>第三步，实现组件模板部分<br><code>src\views\order\Pay.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 订单确认及支付 --&gt;</span><br><span class="line">  &lt;div class="page-order-pay"&gt;</span><br><span class="line">    &lt;!-- 顶部导航 --&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      title="订单支付"</span><br><span class="line">      left-text="返回"</span><br><span class="line">      right-text="取消订单"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"</span><br><span class="line">      @click-right="onCancelOrder"</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- 订单号 --&gt;</span><br><span class="line">    &lt;van-cell title="订单号" value="订单号的内容"</span><br><span class="line">      :title-style="{'text-align': 'left'}" /&gt;</span><br><span class="line">    &lt;!-- 描述信息 --&gt;</span><br><span class="line">    &lt;div class="order-info"&gt;</span><br><span class="line">      &lt;div class="left"&gt;</span><br><span class="line">        &lt;h3&gt;门票的信息&lt;/h3&gt;</span><br><span class="line">        &lt;div&gt;&lt;van-icon name="clock-o" /&gt; 2020-9-13&lt;/div&gt;</span><br><span class="line">        &lt;div class="tips"&gt;短信接收&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="right"&gt;</span><br><span class="line">        &lt;van-icon name="arrow" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //描述信息 --&gt;</span><br><span class="line">    &lt;!-- 提交表单 --&gt;</span><br><span class="line">    &lt;van-submit-bar :price="totalPrice" button-text="立即支付" @submit="onSubmit" /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 总价格</span><br><span class="line">      totalPrice: 25000</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 确认支付</span><br><span class="line">     */</span><br><span class="line">    onSubmit () {</span><br><span class="line">      this.$dialog.confirm({</span><br><span class="line">        title: '温馨提示',</span><br><span class="line">        message: `确认支付${this.totalPrice / 100}吗？`</span><br><span class="line">      }).then(() =&gt; {</span><br><span class="line">        // on confirm</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 后退</span><br><span class="line">     */</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$dialog.confirm({</span><br><span class="line">        title: '温馨提示',</span><br><span class="line">        message: '您还没有支付，确认放弃支付吗？'</span><br><span class="line">      }).then(() =&gt; {</span><br><span class="line">        this.$router.go(-1)</span><br><span class="line">        // on confirm</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 取消订单</span><br><span class="line">     */</span><br><span class="line">    onCancelOrder () {</span><br><span class="line">      this.$dialog.confirm({</span><br><span class="line">        title: '温馨提示',</span><br><span class="line">        message: '确认取消该订单？'</span><br><span class="line">      }).then(() =&gt; {</span><br><span class="line">        // TODO 调用接口on confirm</span><br><span class="line">        this.$router.go(-1)</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>第四步，模拟数据，实现效果</p>
</li>
</ul>
<h3 id="我的订单列表页面开发"><a href="#我的订单列表页面开发" class="headerlink" title="我的订单列表页面开发"></a>我的订单列表页面开发</h3><h4 id="实现步骤-2"><a href="#实现步骤-2" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，配置路由规则，新建组件<br><code>src\router\index.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> OrderList <span class="keyword">from</span> <span class="string">'../views/order/List.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 我的订单列表</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/order/list/:status'</span>,</span><br><span class="line">    name: <span class="string">'OrderList'</span>,</span><br><span class="line">    component: OrderList</span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>src\utils\constants.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单状态</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ORDER_STATUS_ALL = <span class="number">0</span></span><br><span class="line"><span class="comment">// 待支付</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ORDER_STATUS_PAY = <span class="number">11</span></span><br><span class="line"><span class="comment">// 已完成</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ORDER_STATUS_DONE = <span class="number">12</span></span><br><span class="line"><span class="comment">// 已取消</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ORDER_STATUS_CANCEL = <span class="number">13</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ORDER_STATUS = {</span><br><span class="line">  [ORDER_STATUS_ALL]: <span class="string">'全部'</span>,</span><br><span class="line">  [ORDER_STATUS_PAY]: <span class="string">'待支付'</span>,</span><br><span class="line">  [ORDER_STATUS_DONE]: <span class="string">'已完成'</span>,</span><br><span class="line">  [ORDER_STATUS_CANCEL]: <span class="string">'已取消'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>第二步，查找Vant中可以使用的组件</p>
</li>
<li><p>第三步，实现组件模板部分<br><code>src\views\order\List.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 我的订单列表页面 --&gt;</span><br><span class="line">  &lt;div class="page-order-list"&gt;</span><br><span class="line">    &lt;!-- 顶部导航 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="我的订单"</span><br><span class="line">      left-text="返回"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"/&gt;</span><br><span class="line">    &lt;!-- 订单按状态切换 --&gt;</span><br><span class="line">    &lt;van-tabs v-model="status"&gt;</span><br><span class="line">      &lt;van-tab</span><br><span class="line">        v-for="(value, key, index) in constants.ORDER_STATUS"</span><br><span class="line">        :title="value"</span><br><span class="line">        :name="key"</span><br><span class="line">        :key="index"&gt;&lt;/van-tab&gt;</span><br><span class="line">    &lt;/van-tabs&gt;</span><br><span class="line">    &lt;!-- 订单记录 --&gt;</span><br><span class="line">    &lt;div class="order-list"&gt;</span><br><span class="line">      &lt;div class="order-item" v-for="index in 5" :key="index"&gt;</span><br><span class="line">        &lt;div class="order-head"&gt;</span><br><span class="line">          &lt;div class="order-num"&gt;订单号：12312312&lt;/div&gt;</span><br><span class="line">          &lt;div class="order-status text-warning"&gt;已取消&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="order-body"&gt;</span><br><span class="line">          &lt;div class="left"&gt;</span><br><span class="line">            &lt;van-image width="100" height="100" src="https://img.yzcdn.cn/vant/cat.jpeg" /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="right"&gt;</span><br><span class="line">            &lt;div class="title"&gt;门票的标题&lt;/div&gt;</span><br><span class="line">            &lt;div class="remark"&gt;相关的描述&lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="order-footer"&gt;</span><br><span class="line">          &lt;div&gt;总共2件商品 合计 ￥198&lt;/div&gt;</span><br><span class="line">          &lt;van-button round size="small" type="warning"&gt;删除订单&lt;/van-button&gt;</span><br><span class="line">          &lt;van-button round size="small" type="info"&gt;订单详情&lt;/van-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import * as constants from '@/utils/constants'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      status: 0,</span><br><span class="line">      constants</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第四步，模拟数据，实现效果</p>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-ge-ren-zhong-xin-ye-mian-kai-fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-ge-ren-zhong-xin-ye-mian-kai-fa/" class="post-title-link" itemprop="url">个人中心页面开发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/vue/" itemprop="url" rel="index"><span itemprop="name">vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="个人中心页面开发"><a href="#个人中心页面开发" class="headerlink" title="个人中心页面开发"></a>个人中心页面开发</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，查找Vant中可以使用的组件</li>
<li>第二步，实现组件模板部分<br><code>src\views\Mine.vue</code><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 个人中心 --&gt;</span><br><span class="line">  &lt;div class="page-mine"&gt;</span><br><span class="line">    &lt;!-- 标题 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="个人中心" fixed/&gt;</span><br><span class="line">    &lt;!-- 用户基本信息：头像、昵称 --&gt;</span><br><span class="line">    &lt;div class="user-header"&gt;</span><br><span class="line">      &lt;div class="avatar"&gt;</span><br><span class="line">        &lt;img src="/static/mine/avatar.png" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;欢迎您，张三&lt;/p&gt;</span><br><span class="line">        &lt;a class="btn-link" href="#"&gt;退出登录&lt;/a&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 订单的菜单列表 --&gt;</span><br><span class="line">    &lt;van-row class="user-links"&gt;</span><br><span class="line">      &lt;van-col span="6"&gt;</span><br><span class="line">        &lt;router-link to="/"&gt;</span><br><span class="line">          &lt;van-icon name="records" /&gt;</span><br><span class="line">          &lt;span&gt;全部订单&lt;/span&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">      &lt;/van-col&gt;</span><br><span class="line">      &lt;van-col span="6"&gt;</span><br><span class="line">        &lt;router-link to="/"&gt;</span><br><span class="line">          &lt;van-icon name="pending-payment" /&gt;</span><br><span class="line">          &lt;span&gt;待支付&lt;/span&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">      &lt;/van-col&gt;</span><br><span class="line">      &lt;van-col span="6"&gt;</span><br><span class="line">        &lt;router-link to="/"&gt;</span><br><span class="line">          &lt;van-icon name="tosend" /&gt;</span><br><span class="line">          &lt;span&gt;已完成&lt;/span&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">      &lt;/van-col&gt;</span><br><span class="line">      &lt;van-col span="6"&gt;</span><br><span class="line">        &lt;router-link to="/"&gt;</span><br><span class="line">          &lt;van-icon name="logistics" /&gt;</span><br><span class="line">          &lt;span&gt;已取消&lt;/span&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">      &lt;/van-col&gt;</span><br><span class="line">    &lt;/van-row&gt;</span><br><span class="line">    &lt;!-- 底部导航 --&gt;</span><br><span class="line">    &lt;TripFooter/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import TripFooter from '@/components/common/Footer'</span><br><span class="line"></span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    TripFooter</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang="less"&gt;</span><br><span class="line">.page-mine {</span><br><span class="line">  .van-nav-bar--fixed {</span><br><span class="line">    background-color: transparent;</span><br><span class="line">  }</span><br><span class="line">  .van-nav-bar__title {</span><br><span class="line">    color: #fff;</span><br><span class="line">  }</span><br><span class="line">  .user-header {</span><br><span class="line">    background: url(/static/mine/bg.jpg) no-repeat center;</span><br><span class="line">    background-size: 100% auto;</span><br><span class="line">    color: #fff;</span><br><span class="line">    height: 200px;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    .avatar img {</span><br><span class="line">      width: 80px;</span><br><span class="line">      height: 80px;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .user-links {</span><br><span class="line">    padding: 15px 0;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    text-align: center;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">    .van-icon {</span><br><span class="line">      display: block;</span><br><span class="line">      font-size: 24px;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  .btn-link {</span><br><span class="line">    color: #fff;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>src\router\index.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Mine <span class="keyword">from</span> <span class="string">'../views/Mine.vue'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 个人中心</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/mine'</span>,</span><br><span class="line">    name: <span class="string">'Mine'</span>,</span><br><span class="line">    component: Mine</span><br><span class="line">  },</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\components\common\Footer.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 底部导航（公共组件） --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;van-tabbar v-model="active" route&gt;</span><br><span class="line">      &lt;van-tabbar-item name="mine" icon="user-o" :to="{name: 'Mine'}"&gt;我的&lt;/van-tabbar-item&gt;</span><br><span class="line">    &lt;/van-tabbar&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>第三步，模型层准备数据</li>
<li>第四步，模拟数据，实现效果</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-shan-chu-ding-dan-jie-kou-kai-fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-shan-chu-ding-dan-jie-kou-kai-fa/" class="post-title-link" itemprop="url">旅游网删除订单接口开发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-02 12:31:16" itemprop="dateModified" datetime="2021-05-02T12:31:16Z">2021-05-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="删除订单接口开发"><a href="#删除订单接口开发" class="headerlink" title="删除订单接口开发"></a>删除订单接口开发</h1><p>开发步骤</p>
<ul>
<li><p>第一步，设计接口返回内容及字段<br><code>order\views.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@method_decorator(login_required, name='dispatch')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderDetail</span>(<span class="params">BaseDetailView</span>):</span></span><br><span class="line">    slug_field = <span class="string">'sn'</span></span><br><span class="line">    slug_url_kwarg = <span class="string">'sn'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.request.user</span><br><span class="line">        <span class="keyword">return</span> Order.objects.filter(user=user, is_valid=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="string">""" GET: 订单详情 """</span></span><br><span class="line">        order_obj = self.get_object()</span><br><span class="line">        data = serializers.OrderDetailSerializer(order_obj).to_dict()</span><br><span class="line">        <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="string">""" DELETE: 订单删除 """</span></span><br><span class="line">        <span class="comment"># 1. 获取订单对象</span></span><br><span class="line">        order_obj = self.get_object()</span><br><span class="line">        <span class="comment"># 2. 验证数据（已支付、已取消才可删除订单）</span></span><br><span class="line">        <span class="keyword">if</span> order_obj.status == OrderStatus.CANCELED <span class="keyword">or</span> order_obj.status == OrderStatus.PAID:</span><br><span class="line">            <span class="comment"># 3. 是否已经删除过了</span></span><br><span class="line">            <span class="keyword">if</span> order_obj.is_valid:</span><br><span class="line">                order_obj.is_valid = <span class="literal">False</span></span><br><span class="line">                order_obj.save()</span><br><span class="line">                <span class="keyword">return</span> http.HttpResponse(<span class="string">''</span>, status=<span class="number">201</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 此处不用写，因为get_object已经触发了404</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> http.HttpResponse(<span class="string">''</span>, status=<span class="number">200</span>)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第二步，编写接口代码</p>
</li>
<li><p>第三步，模拟HTTP请求，测试验证接口</p>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-qu-xiao-ding-dan-jie-kou-kai-fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-qu-xiao-ding-dan-jie-kou-kai-fa/" class="post-title-link" itemprop="url">旅游网取消订单接口开发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="取消订单接口开发"><a href="#取消订单接口开发" class="headerlink" title="取消订单接口开发"></a>取消订单接口开发</h1><p>开发步骤</p>
<ul>
<li><p>第一步，设计接口返回内容及字段<br><code>order\views.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(login_required, name='dispatch')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketOrderSubmitView</span>(<span class="params">FormView</span>):</span></span><br><span class="line">    <span class="string">""" 3.1 门票订单提交接口 """</span></span><br><span class="line">    form_class = SubmitTicketOrderForm</span><br><span class="line">    http_method_names = [<span class="string">'post'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_invalid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        <span class="string">""" 表单未通过验证 """</span></span><br><span class="line">        err = json.loads(form.errors.as_json())</span><br><span class="line">        <span class="keyword">return</span> BadRequestJsonResponse(err)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">form_valid</span>(<span class="params">self, form</span>):</span></span><br><span class="line">        obj = form.save(user=self.request.user)</span><br><span class="line">        <span class="keyword">return</span> http.JsonResponse({<span class="string">'sn'</span>: obj.sn}, status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(login_required, name='dispatch')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderDetail</span>(<span class="params">BaseDetailView</span>):</span></span><br><span class="line">    slug_field = <span class="string">'sn'</span></span><br><span class="line">    slug_url_kwarg = <span class="string">'sn'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" GET: 订单详情 """</span></span><br><span class="line">        user = self.request.user</span><br><span class="line">        <span class="keyword">return</span> Order.objects.filter(user=user, is_valid=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        order_obj = self.get_object()</span><br><span class="line">        data = serializers.OrderDetailSerializer(order_obj).to_dict()</span><br><span class="line">        <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @transaction.atomic</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="string">""" PUT： 取消订单 """</span></span><br><span class="line">        <span class="comment"># 1. 获取订单对象</span></span><br><span class="line">        order_obj = self.get_object()</span><br><span class="line">        <span class="comment"># 2. 数据验证，状态判断</span></span><br><span class="line">        <span class="keyword">if</span> order_obj.status == OrderStatus.SUBMIT:</span><br><span class="line">            <span class="comment"># 3. 改变状态</span></span><br><span class="line">            order_obj.status = OrderStatus.CANCELED</span><br><span class="line">            order_obj.save()</span><br><span class="line">            items = order_obj.order_items.filter(status=OrderStatus.SUBMIT)</span><br><span class="line">            <span class="comment"># 4. 加回已经扣减的库存</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">                obj = item.content_object</span><br><span class="line">                obj.remain_stock = F(<span class="string">'remain_stock'</span>) + item.count</span><br><span class="line">                obj.save()</span><br><span class="line">            items.update(status=OrderStatus.CANCELED)</span><br><span class="line">            <span class="keyword">return</span> http.HttpResponse(<span class="string">''</span>, status=<span class="number">201</span>)</span><br><span class="line">        <span class="keyword">return</span> http.HttpResponse(<span class="string">''</span>, status=<span class="number">200</span>)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第二步，编写接口代码</p>
</li>
<li><p>第三步，模拟HTTP请求，测试验证接口</p>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-wo-de-ding-dan-lie-biao-jie-kou-kai-fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-wo-de-ding-dan-lie-biao-jie-kou-kai-fa/" class="post-title-link" itemprop="url">旅游网我的订单列表接口开发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-02 12:31:32" itemprop="dateModified" datetime="2021-05-02T12:31:32Z">2021-05-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我的订单列表接口开发</p>
<ul>
<li>第一步，设计接口返回内容及字段<br><code>order\urls.py</code><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> order <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 3.3 我的订单列表</span></span><br><span class="line">    path(<span class="string">'order/list/'</span>, views.OrderListView.as_view(), name=<span class="string">"order_list"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>order\serializers.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer, BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderItemSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 订单明细 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        obj = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'pk'</span>: obj.pk,</span><br><span class="line">            <span class="string">'flash_name'</span>: obj.flash_name,</span><br><span class="line">            <span class="string">'flash_img'</span>: obj.flash_img.url,</span><br><span class="line">            <span class="string">'flash_price'</span>: obj.flash_price,</span><br><span class="line">            <span class="string">'flash_origin_price'</span>: obj.flash_origin_price,</span><br><span class="line">            <span class="string">'flash_discount'</span>: obj.flash_discount,</span><br><span class="line">            <span class="string">'count'</span>: obj.count,</span><br><span class="line">            <span class="string">'amount'</span>: obj.amount,</span><br><span class="line">            <span class="string">'remark'</span>: obj.remark,</span><br><span class="line">            <span class="string">'object_id'</span>: obj.object_id,</span><br><span class="line">            <span class="string">'app_label'</span>: obj.content_type.app_label,</span><br><span class="line">            <span class="string">'model'</span>: obj.content_type.model,</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 订单列表 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        item_first_obj = obj.order_items.first()</span><br><span class="line">        item_first = OrderItemSerializer(item_first_obj).to_dict()</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'sn'</span>: obj.sn,</span><br><span class="line">            <span class="string">'buy_amount'</span>: obj.buy_amount,</span><br><span class="line">            <span class="string">'buy_count'</span>: obj.buy_count,</span><br><span class="line">            <span class="string">'types'</span>: obj.types,</span><br><span class="line">            <span class="string">'status'</span>: obj.status,</span><br><span class="line">            <span class="string">'remark'</span>: obj.remark,</span><br><span class="line">            <span class="string">'created_at'</span>: obj.created_at,</span><br><span class="line">            <span class="string">'item_first'</span>: item_first</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p><code>order\views.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView</span><br><span class="line"><span class="keyword">from</span> django.views.generic.detail <span class="keyword">import</span> BaseDetailView</span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(login_required, name='dispatch')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 3.3 我的订单列表 """</span></span><br><span class="line">    paginate_by = <span class="number">10</span>  <span class="comment"># 每页放10条数据</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.request.user</span><br><span class="line">        query = Q(is_valid=<span class="literal">True</span>, user=user)</span><br><span class="line">        <span class="comment"># 按状态查询</span></span><br><span class="line">        status = self.request.GET.get(<span class="string">'status'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> status <span class="keyword">and</span> status != <span class="string">'0'</span>:</span><br><span class="line">            query = query &amp; Q(status=status)</span><br><span class="line">        <span class="keyword">return</span> Order.objects.filter(query)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        <span class="string">""" 重写响应的返回，返回json """</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]</span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            data = serializers.OrderListSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_paginate_by</span>(<span class="params">self, queryset</span>):</span></span><br><span class="line">        <span class="string">""" 根据接口参数limit来控制分页的大小 """</span></span><br><span class="line">        page_size = self.request.GET.get(<span class="string">'limit'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> page_size <span class="keyword">or</span> self.paginate_by</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第二步，编写接口代码</li>
<li>第三步，模拟HTTP请求，测试验证接口</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-yong-hu-zhu-ce-jie-kou-lian-diao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/lu-you-wang-yong-hu-zhu-ce-jie-kou-lian-diao/" class="post-title-link" itemprop="url">旅游网用户注册接口联调</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-22 03:32:54" itemprop="dateModified" datetime="2021-05-22T03:32:54Z">2021-05-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="用户注册接口联调"><a href="#用户注册接口联调" class="headerlink" title="用户注册接口联调"></a>用户注册接口联调</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>第一步，阅读接口文档</li>
<li>第二步，配置接口地址</li>
</ul>
<p><code>src\utils\ajax.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ajax = axios.create({</span><br><span class="line">  headers: {</span><br><span class="line">    source: <span class="string">'h5'</span>,</span><br><span class="line">    icode: <span class="string">'acbd'</span>,</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span></span><br><span class="line">  },</span><br><span class="line">  <span class="comment">/***</span></span><br><span class="line"><span class="comment">   * 对请求的参数进行格式化处理</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  transformRequest: <span class="function"><span class="keyword">function</span> (<span class="params">data, headers</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> qs.stringify(data)</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 携带cookie</span></span><br><span class="line">  withCredentials: <span class="literal">true</span></span><br><span class="line">})</span><br><span class="line">ajax.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>{</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'请求拦截到了'</span>)</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.loading({</span><br><span class="line">    message: <span class="string">'加载中...'</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span>,</span><br><span class="line">    loadingType: <span class="string">'spinner'</span></span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">ajax.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line">  <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'响应拦截到了'</span>)</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> response</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">  <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">  <span class="keyword">if</span> (error.response) {</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) {</span><br><span class="line">      <span class="built_in">window</span>.app.$notify({</span><br><span class="line">        message: <span class="string">'未登录，即将跳转到登录页面'</span>,</span><br><span class="line">        type: <span class="string">'danger'</span></span><br><span class="line">      })</span><br><span class="line">      <span class="built_in">window</span>.app.$router.replace({<span class="attr">name</span>: <span class="string">'AccountLogin'</span>})</span><br><span class="line">      <span class="comment">// window.alert('未登录，即将跳转到登录页面')</span></span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (error.response.status === <span class="number">500</span>) {</span><br><span class="line">      <span class="built_in">window</span>.app.$notify({</span><br><span class="line">        message: <span class="string">'服务器正忙，请稍后重试'</span>,</span><br><span class="line">        type: <span class="string">'danger'</span></span><br><span class="line">      })</span><br><span class="line">      <span class="comment">// window.alert('服务器正忙，请稍后重试')</span></span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (error.response.status === <span class="number">400</span>) {</span><br><span class="line">      <span class="comment">// data</span></span><br><span class="line">      <span class="keyword">const</span> data = error.response.data</span><br><span class="line">      <span class="keyword">let</span> msg = data.error_msg ? data.error_msg : <span class="string">'参数错误'</span></span><br><span class="line">      <span class="keyword">if</span> (data.error_list) {</span><br><span class="line">        <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(data.error_list)</span><br><span class="line">        <span class="keyword">const</span> errObj = data.error_list[keys[<span class="number">0</span>]][<span class="number">0</span>]</span><br><span class="line">        msg = <span class="string">`<span class="subst">${errObj.message}</span>, <span class="subst">${errObj.code}</span>`</span></span><br><span class="line">        <span class="built_in">window</span>.app.$notify(msg)</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\utils\apis.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存放项目中所有的接口地址，当是```/api```开头，nginx把它转发给wsgi对应的内容进行处理，就会处理django的内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> apiHost = <span class="string">'http://localhost:8080/api'</span> <span class="comment">// 本地调试的localhost</span></span><br><span class="line"><span class="comment">// const apiHost = '/api' // linux服务器上用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户账户相关的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> AccountsApis = {</span><br><span class="line">  <span class="comment">// 用户注册</span></span><br><span class="line">  registerUrl: apiHost + <span class="string">'/accounts/user/api/register/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\store\mutation-types.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_USER_INFO = <span class="string">'updateUserInfo'</span></span><br><span class="line"><span class="comment">// 删除用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DELETE_USER_INFO = <span class="string">'deleteUserInfo'</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>第三步，使用axios获取数据<br><code>src\views\accounts\Register.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { AccountsApis } from '@/utils/apis'</span><br><span class="line">import * as types from '@/store/mutation-types'</span><br><span class="line">import Copyright from '@/components/common/Copyright'</span><br><span class="line">import SendSmsCode from '@/components/common/SendSmsCode'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    Copyright,</span><br><span class="line">    SendSmsCode</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 用户名的验证规则</span><br><span class="line">      ruleName: [{</span><br><span class="line">        required: true,</span><br><span class="line">        message: '请填写用户名'</span><br><span class="line">      }, {</span><br><span class="line">        pattern: /1\d{10}/,</span><br><span class="line">        message: '请填写正确的手机号'</span><br><span class="line">      }],</span><br><span class="line">      // 重复密码验证</span><br><span class="line">      rulePassword: [</span><br><span class="line">        {</span><br><span class="line">          required: true,</span><br><span class="line">          message: '请重复一次密码'</span><br><span class="line">        }, {</span><br><span class="line">          validator: () =&gt; this.form.password === this.form.passwordRepeat,</span><br><span class="line">          message: '两次密码输入不一致'</span><br><span class="line">        }],</span><br><span class="line">      form: {</span><br><span class="line">        username: '',</span><br><span class="line">        nickname: '',</span><br><span class="line">        sms_code: '',</span><br><span class="line">        password: '',</span><br><span class="line">        passwordRepeat: ''</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 手机号变化时，重置验证码组件状态</span><br><span class="line">     */</span><br><span class="line">    onPhoneChange () {</span><br><span class="line">      this.$refs.refSms.reset()</span><br><span class="line">    },</span><br><span class="line">    onSubmit () {</span><br><span class="line">      // 提交表单</span><br><span class="line">      // 1. 调用接口</span><br><span class="line">      ajax.post(AccountsApis.registerUrl, {</span><br><span class="line">        username: this.form.username,</span><br><span class="line">        password: this.form.passwordRepeat,</span><br><span class="line">        sms_code: this.form.sms_code,</span><br><span class="line">        nickname: this.form.nickname</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        // 2. 成功返回结果, 用户信息写入vuex</span><br><span class="line">        this.$store.commit(types.UPDATE_USER_INFO, data)</span><br><span class="line">        // 3. 提示用户</span><br><span class="line">        this.$notify({</span><br><span class="line">          message: '注册成功',</span><br><span class="line">          type: 'success'</span><br><span class="line">        })</span><br><span class="line">        // 4. 跳转到个人中心页面</span><br><span class="line">        this.$router.replace({ name: 'Mine' })</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第四步，将数据设置到模型</p>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/25/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/27/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
