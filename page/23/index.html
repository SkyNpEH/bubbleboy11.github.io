<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/23/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/23/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/23/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">347</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/socket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/socket/" class="post-title-link" itemprop="url">socket</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-10 02:48:35" itemprop="dateModified" datetime="2021-05-10T02:48:35Z">2021-05-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>socket 模拟 文件下载器</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_file_2_client</span>(<span class="params">conn, addr</span>):</span></span><br><span class="line">    <span class="comment"># 1.读取客户端请求</span></span><br><span class="line">    file_name = conn.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    print(<span class="string">'客户端[%s]要下载的文件名：%s'</span> % (str(addr[<span class="number">0</span>]), file_name))</span><br><span class="line">    file_content = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># 2.打开文件读取数据</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = open(file_name, <span class="string">'rb'</span>)</span><br><span class="line">        file_content = f.read()</span><br><span class="line">        f.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'文件不存在'</span>)</span><br><span class="line">    <span class="comment"># 3.发送文件给客户端</span></span><br><span class="line">    <span class="keyword">if</span> file_content:</span><br><span class="line">        conn.send(file_content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1.创建套接字</span></span><br><span class="line">    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    <span class="comment"># 2.绑定监听</span></span><br><span class="line">    server.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">    server.listen(<span class="number">128</span>)</span><br><span class="line">    print(<span class="string">'------服务器连接成功------'</span>)</span><br><span class="line">    <span class="comment"># 3.接收数据，生成新的套接字</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr = server.accept()</span><br><span class="line">        print(addr)</span><br><span class="line">        <span class="comment"># 4.调用发送文件函数</span></span><br><span class="line">        send_file_2_client(conn, addr)</span><br><span class="line">        <span class="comment"># 5.关闭套接字</span></span><br><span class="line">        conn.close()</span><br><span class="line">    server.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>
<p>客户端代码</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1.创建套接字</span></span><br><span class="line">    client = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    <span class="comment"># 2.获取服务器ip port 并连接</span></span><br><span class="line">    client.connect((<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>))</span><br><span class="line">    print(<span class="string">'-------连接成功-------'</span>)</span><br><span class="line">    <span class="comment"># 3.获取下载文件的名字并发送给服务器</span></span><br><span class="line">    file_name = input(<span class="string">'请输入要下载的文件名：'</span>)</span><br><span class="line">    client.send(file_name.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="comment"># 4.接收文件中的数据</span></span><br><span class="line">    recv_data = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="comment"># 5.保存接收到的数据并保存到文件中</span></span><br><span class="line">    <span class="keyword">if</span> recv_data:</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'new'</span>+file_name,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(recv_data)</span><br><span class="line">    <span class="comment"># 6.关闭套接字</span></span><br><span class="line">    client.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>
<p>同级目录下先准备好一个文件当作服务端文件，下载本地后拼接新的名字，如果要下载的文件不存在会提示报错！</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/sort-sorted/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/sort-sorted/" class="post-title-link" itemprop="url">sort sorted</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-09 04:08:15" itemprop="dateModified" datetime="2021-07-09T04:08:15Z">2021-07-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="list-sort"><a href="#list-sort" class="headerlink" title="list.sort()"></a><code>list.sort()</code></h1><p>只是为列表定义的，返回的是对已经存在的列表进行操作，没有新建列表</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line">a.sort()  <span class="comment"># sort返回的是对已经存在的列表进行操作</span></span><br><span class="line">print(a)  <span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line">print([<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>].sort())  <span class="comment"># None sort返回的是对已经存在的列表进行操作，没有新建列表</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>sorted(iterable, key=None, reverse=False)</code><br>返回的是一个新的对所有可迭代的对象进行排序操作的列表，而不是在原来的基础上进行的操作。<br>iterable – 可迭代对象。<br>key – 用来进行比较的元素，只有一个参数，具体的函数的参数就是取自于可迭代对象中，<br>指定可迭代对象中的一个元素来进行排序。<br>Key参数/键函数<br>从python2.4开始，list.sort()和sorted()函数增加了key参数来指定在进行比较前要在每个列表元素上调用的函数（或其他可调用对象）。<br>key 形参的值应该是个函数（或其他可调用对象），它接受一个参数并返回一个用于排序的键。 这种机制速度很快，因为对于每个输入记录只会调用一次键函数。</p>
<p>reverse – 排序规则，reverse = True 降序 ，reverse = False 升序（默认）。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">example_list = [<span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">result_list = sorted(example_list)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [0, 1, 2, 3, 4, 5, 6, 7]默认升序</span></span><br><span class="line">result_list = sorted(example_list, reverse=<span class="literal">True</span>)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [7, 6, 5, 4, 3, 2, 1, 0] 反转降序</span></span><br><span class="line">result_list = sorted(example_list, key=<span class="keyword">lambda</span> x: x * <span class="number">-1</span>)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [7, 6, 5, 4, 3, 2, 1, 0]</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="将列表-1-2-3-4-5-6-7-8-9-按照元素与5距离从小到大进行排序"><a href="#将列表-1-2-3-4-5-6-7-8-9-按照元素与5距离从小到大进行排序" class="headerlink" title="将列表[1, 2, 3, 4, 5, 6, 7, 8, 9]按照元素与5距离从小到大进行排序"></a>将列表[1, 2, 3, 4, 5, 6, 7, 8, 9]按照元素与5距离从小到大进行排序</h2><p>法一</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(sorted([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], key=<span class="keyword">lambda</span> x: abs(<span class="number">5</span> - x)))  </span><br><span class="line"><span class="comment"># [5, 4, 6, 3, 7, 2, 8, 1, 9]</span></span><br></pre></td></tr></tbody></table></figure>

<p>法二</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> abs(<span class="number">5</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(sorted(list, key=run))  <span class="comment"># [5, 4, 6, 3, 7, 2, 8, 1, 9]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(sorted({<span class="number">1</span>: <span class="string">'D'</span>, <span class="number">2</span>: <span class="string">'B'</span>, <span class="number">3</span>: <span class="string">'B'</span>, <span class="number">4</span>: <span class="string">'E'</span>, <span class="number">5</span>: <span class="string">'A'</span>}))</span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line">print(sorted({<span class="number">1</span>: <span class="string">'D'</span>, <span class="number">2</span>: <span class="string">'B'</span>, <span class="number">3</span>: <span class="string">'B'</span>, <span class="number">4</span>: <span class="string">'E'</span>, <span class="number">5</span>: <span class="string">'A'</span>}, key=<span class="keyword">lambda</span> x: x * <span class="number">-1</span>))</span><br><span class="line"><span class="comment"># [5, 4, 3, 2, 1]</span></span><br></pre></td></tr></tbody></table></figure>

<p>通过key指定的内置函数来</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照小写字母排序</span></span><br><span class="line">print(sorted(<span class="string">"This is a test string from Andrew"</span>.split(), key=str.lower))</span><br><span class="line"><span class="comment"># ['a', 'Andrew', 'from', 'is', 'string', 'test', 'This']</span></span><br><span class="line"></span><br><span class="line">print(sorted([<span class="string">"adf"</span>, <span class="string">"Adfdg"</span>, <span class="string">"aDfgbdfafg"</span>, <span class="string">"Gahgfh"</span>], key = str.lower)) <span class="comment">#输出 ['adf', 'Adfdg', 'aDfgbdfafg', 'Gahgfh']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把数组按照长度大小进行排序，只需设置key等于一个函数即可</span></span><br><span class="line">sorted([<span class="string">"adf"</span>, <span class="string">"Adfdg"</span>, <span class="string">"aDfgbdfafg"</span>, <span class="string">"Gahgfh"</span>], key = len) </span><br><span class="line"><span class="comment">#输出 ['adf', 'adfdg', 'gahgfh', 'adfgbdfafg']</span></span><br></pre></td></tr></tbody></table></figure>

<p>一种常见的模式是使用对象的一些索引作为键对复杂对象进行排序。例如：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>student_tuples = [</span><br><span class="line">        (<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>),</span><br><span class="line">        (<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>),</span><br><span class="line">        (<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>),</span><br><span class="line">]</span><br><span class="line"><span class="comment"># sort by age</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(student_tuples, key=<span class="keyword">lambda</span> student: student[<span class="number">2</span>])</span><br><span class="line">[(<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>), (<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>), (<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>)]</span><br></pre></td></tr></tbody></table></figure>

<p>同样的技术也适用拥有命名属性的对象，例如：</p>
<p>在排序时, 可以用lambda表达式将对象map成keys<br>亦可以使用operator包中的attrgetter和itemgetter函数以提高效率</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, grade, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.grade = grade</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> repr((self.name, self.grade, self.age))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"{}-{}-{}"</span>.format(self.name, self.grade, self.age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立一组Student对象</span></span><br><span class="line">students = [</span><br><span class="line">    Student(<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>),</span><br><span class="line">    Student(<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>),</span><br><span class="line">    Student(<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">print(sorted(students, key=<span class="keyword">lambda</span> o: o.age))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line">students.sort(key=<span class="keyword">lambda</span> x: x.age)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> students:</span><br><span class="line">    print(item)</span><br><span class="line"><span class="comment"># dave-B-10</span></span><br><span class="line"><span class="comment"># jane-B-12</span></span><br><span class="line"><span class="comment"># john-A-15</span></span><br><span class="line"></span><br><span class="line">students.sort(key=<span class="keyword">lambda</span> x: x.grade)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> students:</span><br><span class="line">    print(item)</span><br><span class="line"><span class="comment"># john-A-15</span></span><br><span class="line"><span class="comment"># dave-B-10</span></span><br><span class="line"><span class="comment"># jane-B-12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter</span><br><span class="line"></span><br><span class="line">print(sorted(students, key=itemgetter(<span class="number">2</span>)))</span><br><span class="line"><span class="comment"># TypeError: 'Student' object is not subscriptable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对students按照年龄排序</span></span><br><span class="line">print(sorted(students, key=attrgetter(<span class="string">'age'</span>)))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Operator 模块功能允许多级排序。 先按age再按grade排序</span></span><br><span class="line">print(sorted(students, key=attrgetter(<span class="string">'age'</span>, <span class="string">'grade'</span>)))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例如，要按 grade 降序然后 age 升序对学生数据进行排序，请先 age 排序，然后再使用 grade 排序：</span></span><br><span class="line"><span class="comment"># sort on secondary key</span></span><br><span class="line">s = sorted(students, key=attrgetter(<span class="string">'age'</span>))</span><br><span class="line"><span class="comment"># now sort on primary key, descending</span></span><br><span class="line">print(sorted(s, key=attrgetter(<span class="string">'grade'</span>), reverse=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象为一个包装函数，该函数能接受一个列表以及字段和顺序的元组，以对它们进行多重排序。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multisort</span>(<span class="params">xs, specs</span>):</span></span><br><span class="line">    <span class="keyword">for</span> key, reverse <span class="keyword">in</span> reversed(specs):</span><br><span class="line">        xs.sort(key=attrgetter(key), reverse=reverse)</span><br><span class="line">    <span class="keyword">return</span> xs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(multisort(list(students), ((<span class="string">'grade'</span>, <span class="literal">True</span>), (<span class="string">'age'</span>, <span class="literal">False</span>))))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'blackmatrix'</span></span><br><span class="line"></span><br><span class="line">get_name = <span class="keyword">lambda</span> user: user[<span class="string">'name'</span>]</span><br><span class="line"></span><br><span class="line">get_address = <span class="keyword">lambda</span> user: getattr(user, <span class="string">'address'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, address</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.address = address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">laowang = {<span class="string">'name'</span>: <span class="string">'老王'</span>, <span class="string">'address'</span>: <span class="string">'隔壁'</span>}</span><br><span class="line">laoli = User(<span class="string">'老李'</span>, <span class="string">'楼下'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># itemgetter('name') 和 get_name 作用是相同的</span></span><br><span class="line">    <span class="comment"># 都是接受一个对象，获取对象key为name的值</span></span><br><span class="line">    <span class="comment"># 主要用来替代只是为了获取value的lambda函数</span></span><br><span class="line">    print(itemgetter(<span class="string">'name'</span>)(laowang))  <span class="comment"># 老王</span></span><br><span class="line">    print(itemgetter(<span class="string">'address'</span>)(laowang))  <span class="comment"># 隔壁</span></span><br><span class="line">    print(get_name(laowang))  <span class="comment"># 老王</span></span><br><span class="line">    <span class="comment"># print(get_address(laowang))  # 'dict' object has no attribute 'address'  </span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 同样的，attrgetter('address')也是等同于get_address</span></span><br><span class="line">    <span class="comment"># 用来替代只为了获取attr的lambda函数</span></span><br><span class="line">    print(attrgetter(<span class="string">'address'</span>)(laoli))  <span class="comment"># 楼下</span></span><br><span class="line">    print(get_address(laoli))  <span class="comment"># 楼下</span></span><br></pre></td></tr></tbody></table></figure>


<p>多字段排序<br>按照第一个数从小到大排序，如果第一个数相同，就按第二个数从大到小。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [[<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">1</span>],(<span class="number">2</span>,<span class="number">8</span>),(<span class="number">2</span>,<span class="number">1</span>),(<span class="number">3</span>,<span class="number">4</span>)]</span><br><span class="line">sorted(a, key = <span class="keyword">lambda</span> x: (x[<span class="number">0</span>], -x[<span class="number">1</span>]))</span><br><span class="line"><span class="comment"># [(2, 8), [2, 3], (2, 1), (3, 4), [4, 1]]</span></span><br></pre></td></tr></tbody></table></figure>
<p>其实掌握自定义规则排序，多字段排序也就会了，因为它是自定义排序的子集！</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">array = [{</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"a"</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"b"</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"c"</span></span><br><span class="line">}]</span><br><span class="line"><span class="comment"># 法一</span></span><br><span class="line">array = sorted(array, key=<span class="keyword">lambda</span> x: x[<span class="string">"age"</span>])</span><br><span class="line">print(array)</span><br><span class="line"><span class="comment"># [{'age': 10, 'name': 'c'}, {'age': 20, 'name': 'a'}, {'age': 25, 'name': 'b'}]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line"><span class="comment"># def by_age(info):</span></span><br><span class="line"><span class="comment">#     array = [{"age": 20, "name": "a"}, {"age": 25, "name": "b"}, {"age": 10, "name": "c"}]</span></span><br><span class="line"><span class="comment">#     return array.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># l1 = sorted(array, key=by_age)</span></span><br><span class="line"><span class="comment"># print('***')</span></span><br><span class="line"><span class="comment"># print(l1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多列排序</span></span><br><span class="line"><span class="comment"># 先按照成绩降序排序，相同成绩的按照名字升序排序：</span></span><br><span class="line">d1 = [{</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'alice'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">38</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'bob'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">18</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'darl'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">28</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'christ'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">28</span></span><br><span class="line">}]</span><br><span class="line">l = sorted(d1, key=<span class="keyword">lambda</span> x: (-x[<span class="string">'score'</span>], x[<span class="string">'name'</span>]))</span><br><span class="line">print(l)</span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line"><span class="comment"># [{'name': 'alice', 'score': 38}, {'name': 'christ', 'score': 28}, {'name': 'darl', 'score': 28}, {'name': 'bob', 'score': 18}]</span></span><br><span class="line"></span><br><span class="line">dictionary = {<span class="string">'name'</span>: <span class="string">'Ashe'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'city'</span>: <span class="string">'Guilin'</span>, <span class="string">'tel'</span>: <span class="string">'110'</span>}</span><br><span class="line">print(<span class="string">'---------'</span>)</span><br><span class="line"><span class="comment"># dict.items()结果是键值对元组</span></span><br><span class="line">print(dictionary.items())</span><br><span class="line"><span class="comment"># dict_items([('name', 'Ashe'), ('age', 18), ('city', 'Guilin'), ('tel', '110')])</span></span><br><span class="line"><span class="comment"># i[0]表示key i[1]表示value</span></span><br><span class="line">list = sorted(dictionary.items(), key=<span class="keyword">lambda</span> i: i[<span class="number">0</span>], reverse=<span class="literal">False</span>)  <span class="comment"># 不反转，即升序</span></span><br><span class="line">print(<span class="string">'sorted根据字典key排序'</span>, list)</span><br><span class="line">print(<span class="string">'-----'</span>)</span><br><span class="line">new_dict = {}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> list:</span><br><span class="line">    new_dict[i[<span class="number">0</span>]] = i[<span class="number">1</span>]</span><br><span class="line">print(<span class="string">'new dict'</span>, new_dict)</span><br><span class="line">print(<span class="string">'***'</span>)</span><br><span class="line"><span class="comment"># list = sorted(dictionary.items(), key=lambda i: i[1], reverse=False)</span></span><br><span class="line"><span class="comment"># print('sorted根据字典value排序', list)</span></span><br><span class="line"><span class="comment"># new_dict = {}</span></span><br><span class="line"><span class="comment"># for i in list:</span></span><br><span class="line"><span class="comment">#     new_dict[i[0]] = i[1]</span></span><br><span class="line"><span class="comment"># print('***')</span></span><br><span class="line"><span class="comment"># print('new dict', new_dict)</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">L = [(<span class="string">'Bob'</span>, <span class="number">75</span>), (<span class="string">'Adam'</span>, <span class="number">92</span>), (<span class="string">'Bart'</span>, <span class="number">66</span>), (<span class="string">'Lisa'</span>, <span class="number">88</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_name</span>(<span class="params">info</span>):</span>  <span class="comment"># 名字排序</span></span><br><span class="line">    <span class="comment"># print(info[0])</span></span><br><span class="line">    <span class="keyword">return</span> info[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_grade</span>(<span class="params">info</span>):</span>  <span class="comment"># 成绩排序</span></span><br><span class="line">    <span class="keyword">return</span> info[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L1 = sorted(L, key=by_name)</span><br><span class="line">L2 = sorted(L, key=by_name, reverse=<span class="literal">True</span>)</span><br><span class="line">L3 = sorted(L, key=by_grade)</span><br><span class="line">L4 = sorted(L, key=by_grade, reverse=<span class="literal">True</span>)</span><br><span class="line">print(L1)</span><br><span class="line">print(L2)</span><br><span class="line">print(L3)</span><br><span class="line">print(L4)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight scheme"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="symbol">'Adam</span>', <span class="number">92</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>)]</span><br><span class="line">[(<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Adam</span>', <span class="number">92</span>)]</span><br><span class="line">[(<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Adam</span>', <span class="number">92</span>)]</span><br><span class="line">[(<span class="symbol">'Adam</span>', <span class="number">92</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>)]</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/turtle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/turtle/" class="post-title-link" itemprop="url">turtle</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>turtle在屏幕上绘制图形<br>1.画布(canvas)<br>画布就是turtle为我们展开用于绘图区域默认大小(400, 300)，我们可以设置它的大小和初始位置。</p>
<p>2.画笔（pen）<br>2.1画笔的状态<br>在画布上，默认有一个坐标原点为画布中心的坐标轴，坐标原点上有一只面朝x轴正方向小乌龟。这里我们描述小乌龟时使用了两个词语：坐标原点(位置)，面朝x轴正方向(方向)， turtle绘图中，就是使用位置方向描述小乌龟(画笔)的状态。</p>
<p>2.2 画笔的属性<br>画笔(画笔的属性，颜色、画线的宽度等)</p>
<p>turtle.pensize()：设置画笔的宽度；<br>turtle.pencolor()：没有参数传入，返回当前画笔颜色，传入参数设置画笔颜色，可以是字符串如”green”,&nbsp;“red”,也可以是RGB&nbsp;3元组。<br>turtle.speed(speed)：设置画笔移动速度，画笔绘制的速度范围[0,10]整数，数字越大越快。<br>2.3 绘图命令<br>操纵海龟绘图有着许多的命令，这些命令可以划分为3种：一种为运动命令，一种为画笔控制命令，还有一种是全局控制命令。</p>
<p>2.3.1 画笔运动命令:</p>
<p>命令    说明<br>turtle.home()    将turtle移动到起点（0,0）和向东<br>turtle.speed(speed)    画笔绘制的速度范围[0,10]整数<br>turtle.forward(distance)    向当前画笔方向移动distance像素长<br>turtle.backward(distance)    向当前画笔相反方向移动distance像素长度<br>turtle.right(degree)    顺时针移动degree°<br>turtle.left(degree)    逆时针移动degree°<br>turtle.pendown()    移动时绘制图形放下笔,,默认绘制<br>turtle.penup()    移动时不绘制图形,提起笔，用于另起一个地方绘制时用<br>turtle.circle(r,extent,step)    绘制一个指定半径、弧度范围、阶数(正多边形)的圆<br>turtle.dot(diameter,color)    绘制一个指定直径和颜色的圆</p>
<p>绘制长方形</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line"></span><br><span class="line">turtle.pensize(<span class="number">4</span>)</span><br><span class="line">turtle.pencolor(<span class="string">'red'</span>)</span><br><span class="line"></span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">turtle.mainloop()</span><br></pre></td></tr></tbody></table></figure>

<p>绘制奥运五环</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line">turtle.width(<span class="number">10</span>)</span><br><span class="line">turtle.color(<span class="string">"blue"</span>)</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"black"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">120</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"red"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">240</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"yellow"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">60</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"green"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">180</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle <span class="comment">#导入 turtle 模块</span></span><br><span class="line">turtle.showturtle() <span class="comment">#显示箭头</span></span><br><span class="line">turtle.write(<span class="string">"xy"</span>) <span class="comment">#写字符串</span></span><br><span class="line">turtle.forward(<span class="number">300</span>) <span class="comment">#前进 300 像素</span></span><br><span class="line">turtle.color(<span class="string">"red"</span>) <span class="comment">#画笔颜色改为 red</span></span><br><span class="line">turtle.left(<span class="number">90</span>) <span class="comment">#箭头左转 90 度</span></span><br><span class="line">turtle.forward(<span class="number">300</span>)</span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">50</span>) <span class="comment">#去坐标（0,50）</span></span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">turtle.penup() <span class="comment">#抬笔。这样，路径就不会画出来</span></span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">300</span>)</span><br><span class="line">turtle.pendown() <span class="comment">#下笔。这样，路径就会画出来</span></span><br><span class="line">turtle.circle(<span class="number">100</span>) <span class="comment">#画圆</span></span><br></pre></td></tr></tbody></table></figure>

<p>pentagram</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">turtle</span></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">time</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.pensize</span>(<span class="number">5</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.pencolor</span>(<span class="string">"yellow"</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.fillcolor</span>(<span class="string">"red"</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.begin_fill</span>()</span><br><span class="line"><span class="selector-tag">for</span> <span class="selector-tag">_</span> <span class="selector-tag">in</span> <span class="selector-tag">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="selector-tag">turtle</span><span class="selector-class">.forward</span>(<span class="number">200</span>)</span><br><span class="line">    <span class="selector-tag">turtle</span><span class="selector-class">.right</span>(<span class="number">144</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.end_fill</span>()</span><br><span class="line"><span class="selector-tag">time</span><span class="selector-class">.sleep</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.penup</span>()</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.goto</span>(-<span class="number">150</span>, -<span class="number">120</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.color</span>(<span class="string">"violet"</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.write</span>(<span class="string">"Done"</span>, font=(<span class="string">'Arial'</span>, <span class="number">40</span>, <span class="string">'normal'</span>))</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.mainloop</span>()</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/web-zi-dong-hua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/web-zi-dong-hua/" class="post-title-link" itemprop="url">Web自动化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-31 04:35:56" itemprop="dateModified" datetime="2021-07-31T04:35:56Z">2021-07-31</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Web自动化"><a href="#Web自动化" class="headerlink" title="Web自动化"></a>Web自动化</h2><ul>
<li>WEB自动化测试就是把在网页上的人工测试操作转化成用机<br>器、软件、程序来测试产品的过程</li>
<li>换言之，就是把“点点点”通过编程实现的测试手段</li>
</ul>
<p>为什么要学习Web自动化</p>
<ul>
<li>面向用户的“自动化”</li>
<li>弥补单元测试、接口测试的不足</li>
<li>取代部分重复枯燥的操作</li>
<li>测试岗位进阶的趋势</li>
</ul>
<p>完美WEB自动化的项目</p>
<ol>
<li>任务测试明确，不会频繁变动</li>
<li>每日构建后的测试验证</li>
<li>比较频繁的回归测试</li>
<li>软件系统界面稳定，变动少</li>
<li>软件维护周期长</li>
<li>被测软件系统开发比较规范，能够保证系统的可测试性</li>
<li>测试人员具备较强的编程能力</li>
<li>项目进度压力不太大</li>
</ol>
<p>WEB自动化面临的问题</p>
<ul>
<li>不稳定</li>
<li>难维护</li>
</ul>
<p>WEB自动化的改进</p>
<ul>
<li>更优秀的框架设计</li>
<li>更合理的维护方式</li>
<li>更稳健的测试环境</li>
</ul>
<p>DEFAULT_THROTTLE_RATES 可以使用second , minute , hour或day来指明周期，也可以在具体视图中通过throttle_classes属性来配置,如</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/yaml/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/yaml/" class="post-title-link" itemprop="url">yaml</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-27 05:13:24" itemprop="dateModified" datetime="2021-05-27T05:13:24Z">2021-05-27</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="yaml-YAML-Ain’t-Markup-Language"><a href="#yaml-YAML-Ain’t-Markup-Language" class="headerlink" title="yaml YAML Ain’t Markup Language"></a>yaml YAML Ain’t Markup Language</h1><p>YAML 不是标记语言 文本文件  它是一种数据格式语言，并且是JSON的超集。<br>与 JSON 不同，它可以存储更复杂的对象并引用其自己的元素，还可以编写注释，使其特别适合编写一些定义好不常修改的内容配置文件，</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyyaml</span><br></pre></td></tr></tbody></table></figure>
<p>不规定某一种文件或者key它对应的数据类型，从python的角度来说是字符串，但不需要加引号，当我们进行load的时候，python会对它进行额外的数据类型分析<br>yaml文件在读取后得到的是字典类型的数据</p>
<p>注意格式<code>muke.yaml</code></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># key-value</span></span><br><span class="line"><span class="attr">url:</span></span><br><span class="line">  <span class="string">https://www.imooc.com/</span></span><br><span class="line"><span class="comment"># 列表</span></span><br><span class="line"><span class="attr">types:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前沿</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">后端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">移动端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">云计算</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">运维</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ui</span></span><br><span class="line"><span class="comment"># 字典</span></span><br><span class="line"><span class="attr">python:</span></span><br><span class="line">  <span class="attr">web:</span> <span class="string">django</span></span><br><span class="line">  <span class="attr">spader:</span> <span class="string">bs5</span></span><br><span class="line"><span class="attr">a:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">b:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">c:</span> [<span class="string">a</span>, <span class="string">b</span>, <span class="string">c</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    result = yaml.load(data, Loader=yaml.FullLoader)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    result = read(<span class="string">'muke.yaml'</span>)  <span class="comment"># 传递相对路径</span></span><br><span class="line">    print(result)</span><br><span class="line">    <span class="comment"># {'url': 'https://www.imooc.com/', 'types': ['前沿', '前端', '后端', '移动端', '云计算', '运维', 'ui'], 'python': {'web': 'django', 'spader': 'bs5'}, 'a': 1, 'b': 2, 'c': ['a', 'b', 'c']} </span></span><br><span class="line">    print(type(result))</span><br><span class="line">    <span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">document = <span class="string">"""</span></span><br><span class="line"><span class="string">    a: 1</span></span><br><span class="line"><span class="string">    b:</span></span><br><span class="line"><span class="string">    c: 3</span></span><br><span class="line"><span class="string">    d: 4</span></span><br><span class="line"><span class="string">    ...: </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">print(yaml.load(document, Loader=yaml.FullLoader))</span><br><span class="line"><span class="comment"># {'a': 1, 'b': None, 'c': 3, 'd': 4, '...': None}</span></span><br><span class="line">print(type(yaml.load(document, Loader=yaml.FullLoader)))</span><br><span class="line"><span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(dir(yaml))</span><br><span class="line"><span class="comment"># ['AliasEvent', 'AliasToken', 'AnchorToken', 'BaseDumper', 'BaseLoader', 'BlockEndToken', 'BlockEntryToken', 'BlockMappingStartToken', 'BlockSequenceStartToken', 'CBaseDumper', 'CBaseLoader', 'CDumper', 'CFullLoader', 'CLoader', 'CSafeDumper', 'CSafeLoader', 'CUnsafeLoader', 'CollectionEndEvent', 'CollectionNode', 'CollectionStartEvent', 'DirectiveToken', 'DocumentEndEvent', 'DocumentEndToken', 'DocumentStartEvent', 'DocumentStartToken', 'Dumper', 'Event', 'FlowEntryToken', 'FlowMappingEndToken', 'FlowMappingStartToken', 'FlowSequenceEndToken', 'FlowSequenceStartToken', 'FullLoader', 'KeyToken', 'Loader', 'MappingEndEvent', 'MappingNode', 'MappingStartEvent', 'Mark', 'MarkedYAMLError', 'Node', 'NodeEvent', 'SafeDumper', 'SafeLoader', 'ScalarEvent', 'ScalarNode', 'ScalarToken', 'SequenceEndEvent', 'SequenceNode', 'SequenceStartEvent', 'StreamEndEvent', 'StreamEndToken', 'StreamStartEvent', 'StreamStartToken', 'TagToken', 'Token', 'UnsafeLoader', 'ValueToken', 'YAMLError', 'YAMLLoadWarning', 'YAMLObject', 'YAMLObjectMetaclass', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__', '__version__', '__with_libyaml__', '_warnings_enabled', 'add_constructor', 'add_implicit_resolver', 'add_multi_constructor', 'add_multi_representer', 'add_path_resolver', 'add_representer', 'compose', 'compose_all', 'composer', 'constructor', 'cyaml', 'dump', 'dump_all', 'dumper', 'emit', 'emitter', 'error', 'events', 'full_load', 'full_load_all', 'io', 'load', 'load_all', 'load_warning', 'loader', 'nodes', 'parse', 'parser', 'reader', 'representer', 'resolver', 'safe_dump', 'safe_dump_all', 'safe_load', 'safe_load_all', 'scan', 'scanner', 'serialize', 'serialize_all', 'serializer', 'tokens', 'unsafe_load', 'unsafe_load_all', 'warnings']</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/san-yuan-biao-da-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/san-yuan-biao-da-shi/" class="post-title-link" itemprop="url">python 三元表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 03:01:51" itemprop="dateModified" datetime="2021-05-01T03:01:51Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>用简单的一行快速判断，而不是使用复杂的多行if语句。<br><code>condition_is_true if condition else condition_is_false</code><br>如果a&gt;b的结果为真，h=”变量1”,<br>如果为假，h=”变量2”</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">print(<span class="string">"变量1"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"变量2"</span>)  <span class="comment"># 变量2</span></span><br><span class="line">print(<span class="string">"True"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"False"</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="literal">True</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="literal">False</span>)  <span class="comment"># False</span></span><br><span class="line">print(a &gt; b)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">h = a - b <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> a + b</span><br><span class="line">print(h)  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">is_fat = <span class="literal">True</span></span><br><span class="line">state = <span class="string">"fat"</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">"not fat"</span></span><br><span class="line">print(state)  <span class="comment"># fat</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shi-wu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shi-wu/" class="post-title-link" itemprop="url">事务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 03:00:23" itemprop="dateModified" datetime="2021-05-01T03:00:23Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Relational Database Management System 关系数据库管理系统<br>RDBMS=SQL语句+事务(ACID)</p>
<p>事务transaction：</p>
<ul>
<li>是数据库并发控制的基本单位</li>
<li>是一个或者多个sql语句、数据库逻辑操作组成的集合</li>
</ul>
<p>默认，mysql执行每条sql语句都会自动开启和提交事务<br>为了让多条sql语句纳入到一个事务之下，可以手动管理事务<br>START TRANSACTION;</p>
<p>例子转账了。假如小明要给小红转账1000元，这个转账会涉及到两个关键操作就是：将小明的余额减少1000元，将小红的余额增加1000元。万一在这两个操作之间突然出现错误比如银行系统崩溃，导致小明余额减少而小红的余额没有增加，这样就不对了。事务就是保证这两个关键操作要么都成功，要么都要失败。</p>
<ol>
<li>原子性(Atomicity)事务是最小的执行单位，不允许分割。一个事务中所有操作要么全部完成，要么全部失败。事务执行后，不允许停留在中间某个状态， </li>
<li>一致性(consistency)：事务开始和结束之后数据完整性没有被破坏，执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是相同的；</li>
<li>隔离性(Isolation)：允许多个事务同时对数据库修改和读写，事务不受其他并发事务的影响，如同在给定的时间内，该事务时数据库唯一运行的事务，各并发事务之间数据库是独立的；</li>
<li>持久性(Durability):事务一旦提交，它对数据库中数据的改变是持久的。即便发生宕机数据库发生故障也不应该对其有任何影响，仍然可以依靠事务日志完成数据的持久化</li>
</ol>
<p>事务与回滚：<br>COMMIT； 让redo日志与数据文件同步，事务的所有操作都会被持久化到数据库里面，提交了就会把事务操作下的结果同步<br>ROLLBACK;把该事务所有的数据都打上标记，这些数据全都不会同步到数据文件里面，不存在中间状态的数据<br>回滚：多个逻辑中某个操作出错，回到初始状态，一旦执行失败需要回滚操作来保持之前数据库的完整性）<br>rollback就是数据库里做修改后&nbsp;（update，insert，delete）未commit&nbsp;之前，使用rollback可以恢复数据到修改之前</p>
<p>事务处理<br>MySQL提供事务处理的表引擎, InnoDB<br>服务器层不管理事务，由下层的引擎实现，所以同一个事务中，使用多种存储引擎不靠谱。比如在操纵两张表时候做一个事务，不能是一张表InnoDB另一张表MyISAM，这样事务是做不成功的。需要两张表都是InnoDB。</p>
<p>在非事务的表上执行事务操作 MySQL不会发出提醒，也不会报错，如：在MyISAM表上做事务处理。</p>
<p>举例说明数据库事务的使用场景以及注意事项<br>在操纵(增删改)重要数据时，如：钱款等。需要开启事务。<br>注意事项：事务的隔离级别越高安全性就越高，但并发就越低，这就需要选择合适的隔离级别。</p>
<p>事务的并发控制可能产生哪些问题<br>在典型的应用程序中，多个事务并发运行，经常会操作相同的数据来完成各自的任务（多个用户对统一数据进行操作）。并发虽然是必须的，如果不对事务进行并发控制,可能会产生四种异常情况</p>
<ul>
<li><p>幻读(phantom read):在同一个事务第二次查出现第一次没有的结果，说明别的事务已经插入一些数据<br>幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，</p>
</li>
<li><p>非重复读( nonrepeatable read):一个事务重复读两次得到不同结果，说明读取操作结果是不可重复的。<br>指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</p>
</li>
<li><p>脏读(dirty read):一个事务读取到另一个事务没有提交的修改，就是当另一个事务它还没有提交修改一个事务就读取到了修改。当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。</p>
</li>
<li><p>丢失修改(lost update)：并发写入造成其中一些修改丢失。<br>指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。</p>
</li>
</ul>
<p>Transaction 示例：Python的ORM框架SQLALchemy代码</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">session.begin()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    item1 =session.query(Item).get(<span class="number">1</span>)</span><br><span class="line">    item2 =session.query(Item).get(<span class="number">2</span>)</span><br><span class="line">    item1.foo = <span class="string">'bar'</span></span><br><span class="line">    item2.bar = <span class="string">'foo'</span></span><br><span class="line">    session.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    session.rollback()</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></tbody></table></figure>

<p>把10部门中manager员工调往20部门，其他岗位的员工调往30部门，然后删除10部门 </p>
<p>为了解决并发控制可能产生的异常问题，数据库定义了<br>四种事务的隔离级别</p>
<ul>
<li><p>读未提交(read uncommitted)：别的事务可以读取到未提交改变</p>
</li>
<li><p>读已提交(read committed)：只能读取已经提交的数据</p>
</li>
<li><p>可重复读(repeatable read)：同一个事务先后查询结果一样，Mysql InnoDB默认实现可重复读级别。</p>
</li>
<li><p>可串行化(Serializable)：事务完全串行化的执行，隔离级别最高，执行效率最低。相当于把数据库在一个事务执行的时候完全锁住，等它执行完才能执行下一个。</p>
<p>  ① 读取未提交( Read Uncommitted )</p>
<pre><code>   读未提交是隔离级别最低的一种事务级别。在这种隔离级别下，一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据，这就是脏读（Dirty Read）。
</code></pre>
<p> ② 读取已提交( Read Committed )</p>
<pre><code>  在 Read Committed 隔离级别下，一个事务可能会遇到不可重复读（Non Repeatable Read）的问题。不可重复读是指，在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致。
</code></pre>
<p>③ 可重复读取( Repeatable Read )</p>
<pre><code>  在Repeatable Read隔离级别下，一个事务可能会遇到幻读（Phantom Read）的问题。幻读是指，在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。幻读就是没有读到的记录，以为不存在，但其实是可以更新成功的，并且，更新成功后，再次读取，就出现了。
</code></pre>
<p>④ 可串行化、序列化( Serializable )</p>
<pre><code>  Serializable 是最严格的隔离级别。在Serializable隔离级别下，所有事务按照次序依次执行，因此，脏读、不可重复读、幻读都不会出现。

 虽然 Serializable 隔离级别下的事务具有最高的安全性，但是，由于事务是串行执行，所以效率会大大下降，应用程序的性能会急剧降低。如果没有特别重要的情景，一般都不会使用Serializable隔离级别。

  默认隔离级别：如果没有指定隔离级别，数据库就会使用默认的隔离级别。在MySQL中，如果使用 InnoDB，默认的隔离级别是Repeatable Read。
</code></pre>
</li>
</ul>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;<br>读取其他事务未提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;<br>只能读取其他事务提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>事务在执行中反复读取数据，得到的结果是一致的，不会受其他事务影响</p>
<p>START TRANSACTION;<br>UPDATE t_emp set sal=1;<br>COMMIT;<br>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>START TRANSACTION;<br>SELECT empno, ename, sal FROM t_emp;<br>COMMIT;<br>ROLLBACK;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL live SERIALIZABLE;<br>由于事务并发执行所带来的各种问题，前三种隔离级别只适用在某些业务场景中，但是序列化的隔离性，让事务逐一执行，就不会产生上述问题了。</p>
<p>如何解决高并发场景下的插入重复<br>高并发场景下，写入数据库会有数据重复问题</p>
<ol>
<li><p>使用数据库的唯一索引，就是不允许某些字段重复，如果重复数据库就会抛出一个异常出来，这样就知道那些数据重复了，直接把这个异常忽略掉就可以，这样就可以实现非重复插入。虽然好用但有些场景没有办法实现，如已经做了分库分表，这个时候就要使用队列去执行一个异步写入。</p>
</li>
<li><p>使用队列异步写入，其实很多高并发问题都可以通过缓存和队列去解决。</p>
</li>
<li><p>使用 redis 等实现分布式锁，这样就可以在插入的时候持有这个锁，插入完成之后再去释放这个锁。</p>
</li>
</ol>
<p>并发控制也是通过行锁或者表锁实现的。通过事务再读取或者写入的时候加入一些表锁或者行锁就可以实现不同并发控制的等级。</p>
<p>悲观锁是先获取锁再进行操作。一锁二查三更新 select for update</p>
<p>乐观锁是先修改，更新的时候发现数据已经变了就回滚(check and set)，乐观锁一般通过版本号或者时间戳实现</p>
<p>使需要根据响应速度、冲突频率、重试代价来判断使用哪一种</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/wei-yun-suan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/wei-yun-suan/" class="post-title-link" itemprop="url">位运算</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-29 02:35:30" itemprop="dateModified" datetime="2021-06-29T02:35:30Z">2021-06-29</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>位运算符是把数字看作二进制来进行计算的<br>对整数在内存中的二进制位进行操作</p>
<p><code>&amp;</code> 按位与运算符：双目运算符。 其功能是参与运算的两数各对应的二进位相与，如果两个相应位都为1，则该位的结果为1，否则为0</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">0b110</span> &amp; <span class="number">0b011</span>)   <span class="comment"># 2，即0b010</span></span><br><span class="line">print(<span class="number">1</span> &amp; <span class="number">2</span>)  <span class="comment"># 0</span></span><br><span class="line"><span class="comment"># 2在二进制中是10，1在二进制中是01，那么10与运算01得到的就是0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以此类推：</span></span><br><span class="line">print(<span class="number">4</span> &amp; <span class="number">2</span> &amp; <span class="number">1</span>) <span class="comment"># 0</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>|</code> 按位或运算符：是双目运算符。 其功能是参与运算的两数各对应的二进位相或，只要对应的二个二进位有一个为1时，结果位就为1。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">0b110</span> | <span class="number">0b101</span>)  <span class="comment"># 7,即0b111</span></span><br><span class="line">print(<span class="number">-0</span>b001 | <span class="number">0b101</span>)  <span class="comment"># -1</span></span><br><span class="line">print(<span class="number">1</span> | <span class="number">2</span>)  <span class="comment"># 3</span></span><br><span class="line"><span class="comment">#1|2，同理01或运算10得到的二进制数是11，换算为十进制就是 3</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>~</code> 按位取反运算符：对数据的每个二进制位取反，即把1变为0，把0变为1，包括符号位</p>
<ul>
<li>正数各位取反变为负数，显示时转化为其补码</li>
<li>负数本身需要先转换为补码（符号位不变，各位取反再加 1），再对其补码进行各位取反</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(~<span class="number">0b101</span>)  <span class="comment"># 2，即0b010</span></span><br><span class="line">print(~<span class="number">5</span>)  <span class="comment"># -6</span></span><br></pre></td></tr></tbody></table></figure>

<p>5 的二进制为 0101，<br>~5 正数取反</p>
<ul>
<li><p>（1）各位取反，1010，最高位为1是负数</p>
</li>
<li><p>（2）负数转化为其补码<br>符号位保持不变，各位取反 1101，再加1，1110，也即 -6</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(~<span class="number">-3</span>)  <span class="comment"># 2</span></span><br><span class="line">print(~(<span class="number">-3</span>))  <span class="comment"># 2</span></span><br><span class="line">print(~(<span class="number">-5</span>))  <span class="comment"># 4</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>-3 10…011，负数存储的是其补码：</p>
<ul>
<li>-3 的补码是：11…101</li>
<li>~(-5)将其各位取反（包括符号位），也即 00…010（2）</li>
<li>5的原码是    10…011</li>
<li>5的反码是    11…100<pre><code>      + 00...001
</code></pre>
</li>
<li>5的补码    = 11…101<br>对其补码取反 = 00…010（2）</li>
</ul>
<p>-5 10…101，负数存储的是其补码：</p>
<ul>
<li>-5 的补码是：1011</li>
<li>~(-5)将其各位取反（包括符号位），也即 00…100（4）</li>
<li>5的原码是    10…101</li>
<li>5的反码是    11…010<pre><code>      + 00...001 
</code></pre>
</li>
<li>5的补码    = 11…011<br>对其补码取反 = 00…100（4）</li>
</ul>
<p><code>^</code> 按位异或运算符：是双目运算符。 其功能是参与运算的两数各对应的二进位相异或，当两对应的二进位相异时，结果为1</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">0b111</span> ^ <span class="number">0b111</span>)  <span class="comment"># 0</span></span><br><span class="line">print(<span class="number">0b100</span> ^ <span class="number">0b111</span>)  <span class="comment"># 3</span></span><br><span class="line">print(<span class="number">0b1010</span> ^ <span class="number">0b1111</span>)  <span class="comment"># 5，即0b0101</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>&lt;&lt;</code>    左移运算符：是双目运算符。左移n位就是乘以2的n次方。 其功能把”&lt;&lt;”左边的运算数的各二进位全部左移若干位，由”&lt;&lt;”右边的数指定移动的位数，高位丢弃，低位补0。</p>
<p>负数的左移</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">0b11</span> &lt;&lt; <span class="number">2</span>)  <span class="comment"># 12, 即0b1100</span></span><br><span class="line">print(<span class="number">-2</span> &lt;&lt; <span class="number">2</span>)  <span class="comment"># -8</span></span><br></pre></td></tr></tbody></table></figure>

<p>-2的原码是  10000000000000000000000000000010（32位系统），<br>-2的反码是  11111111111111111111111111111101，<br>其补码为    11111111111111111111111111111110，<br>左移2位变为 11111111111111111111111111111000，<br>再转化为原码 10000000000000000000000000001000，<br>也就是-8，也就是-2*(2**2)=-8</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">5</span> &lt;&lt; <span class="number">3</span>)  <span class="comment"># 40</span></span><br></pre></td></tr></tbody></table></figure>

<p>相当于5(2*3)=40。</p>
<p><code>&gt;&gt;</code> 右移运算符：是双目运算符。右移n位就是除以2的n次方。 其功能是把”&gt;&gt;”左边的运算数的各二进位全部右移若干位，”&gt;&gt;”右边的数指定移动的位数。<br>如果符号位为0，则右移后高位补0，如果符号位为1，则高位补1；</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">0b11</span> &gt;&gt; <span class="number">1</span>)  <span class="comment"># 1, 即0b1</span></span><br><span class="line">print(<span class="number">5</span> &gt;&gt; <span class="number">1</span>)  <span class="comment"># 2，即0b10</span></span><br><span class="line">print(<span class="number">-8</span> &gt;&gt; <span class="number">3</span>)  <span class="comment"># -1</span></span><br></pre></td></tr></tbody></table></figure>

<p>先转化为补码再进行计算，<br>以-8 &gt;&gt; 3为例，<br>-8的原码为10…01000,<br>-8的反码为11…10111,<br>-8的补码为11…11000,<br>右移3位变为11…11111,<br>相应的原码为10…01，即-1。<br>8/(2**3)=1</p>
<p>-1的源码10…01<br>-1的反码11…10<br>-1的补码11…11</p>
<p>假如n=10转换二进制为0000 1010，<br>1的二进制为0000 0001<br>把n转换成二进制，然后看n二进制的最后一位，<br>如果最后一位为1的话，结果就是1，如果最后一位是0的话，那就是0。<br>&amp; 相当于AND<br>因为2的倍数的二进制最后一位都是0，</p>
<blockquote>
<p>所以n &amp; 0x1表达式跟n%2都能判断n是为奇数还是偶数</p>
</blockquote>
<p>变换符号位 ~n + 1</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">60</span>  <span class="comment"># 60 = 0011 1100</span></span><br><span class="line">b = <span class="number">13</span>  <span class="comment"># 13 = 0000 1101</span></span><br><span class="line"></span><br><span class="line">print(a &amp; b)  <span class="comment"># 12 = 0000 1100</span></span><br><span class="line">print(a | b)  <span class="comment"># 61 = 0011 1101</span></span><br><span class="line">print(a ^ b)  <span class="comment"># 49 = 0011 0001</span></span><br><span class="line">print(~a)  <span class="comment"># -61 = 1100 0011</span></span><br><span class="line">print(a &lt;&lt; <span class="number">2</span>)  <span class="comment"># 240 = 1111 0000  向左移动两位</span></span><br><span class="line">print(a &gt;&gt; <span class="number">2</span>)  <span class="comment"># 15 = 0000 1111</span></span><br><span class="line">print(b &lt;&lt; <span class="number">2</span>)  <span class="comment"># 52 = 0011 0100  向左移动两位</span></span><br><span class="line">print(b &gt;&gt; <span class="number">2</span>)  <span class="comment"># 3 = 0000 0011</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> a <span class="keyword">uint</span> = <span class="number">60</span>      <span class="comment">/* 60 = 0011 1100 */</span>  </span><br><span class="line">   <span class="keyword">var</span> b <span class="keyword">uint</span> = <span class="number">13</span>      <span class="comment">/* 13 = 0000 1101 */</span></span><br><span class="line">   <span class="keyword">var</span> c <span class="keyword">uint</span> = <span class="number">0</span>          </span><br><span class="line"></span><br><span class="line">   c = a &amp; b       <span class="comment">/* 12 = 0000 1100 */</span></span><br><span class="line">   fmt.Printf(<span class="string">"第一行 - c 的值为 %d\n"</span>, c )</span><br><span class="line"></span><br><span class="line">   c = a | b       <span class="comment">/* 61 = 0011 1101 */</span></span><br><span class="line">   fmt.Printf(<span class="string">"第二行 - c 的值为 %d\n"</span>, c )</span><br><span class="line"></span><br><span class="line">   c = a ^ b       <span class="comment">/* 49 = 0011 0001 */</span></span><br><span class="line">   fmt.Printf(<span class="string">"第三行 - c 的值为 %d\n"</span>, c )</span><br><span class="line"></span><br><span class="line">   c = a &lt;&lt; <span class="number">2</span>     <span class="comment">/* 240 = 1111 0000 */</span></span><br><span class="line">   fmt.Printf(<span class="string">"第四行 - c 的值为 %d\n"</span>, c )</span><br><span class="line"></span><br><span class="line">   c = a &gt;&gt; <span class="number">2</span>     <span class="comment">/* 15 = 0000 1111 */</span></span><br><span class="line">   fmt.Printf(<span class="string">"第五行 - c 的值为 %d\n"</span>, c )</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/yuan-lei-he-shi-yong-chang-jing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/yuan-lei-he-shi-yong-chang-jing/" class="post-title-link" itemprop="url">元类和使用场景</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-03 15:28:54" itemprop="dateModified" datetime="2021-05-03T15:28:54Z">2021-05-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="元类-Meta-Class-是创建类的类。元类创建类，然后类再去创建实例。"><a href="#元类-Meta-Class-是创建类的类。元类创建类，然后类再去创建实例。" class="headerlink" title="元类 (Meta Class)是创建类的类。元类创建类，然后类再去创建实例。"></a>元类 (Meta Class)是创建类的类。元类创建类，然后类再去创建实例。</h3><ul>
<li>元类允许我们控制类的生成，比如修改类的属性等</li>
<li>使用 type 来定义一个元类</li>
<li>元类最常见的一个使用场景就是 ORM 框架。</li>
</ul>
<ol>
<li>type的等价使用</li>
</ol>
<p>（1）没有方法时type等价使用</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">x</span>:</span></span><br><span class="line">    a = <span class="number">1</span>    </span><br></pre></td></tr></tbody></table></figure>
<p>等价于<br>类的名字x, 类的基类object，类的属性dict</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = type(<span class="string">'x'</span>, (object,), dict(a=<span class="number">1</span>))  <span class="comment"># 类的属性保存在字典里面因此这里用dict</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span>(<span class="params">Base</span>):</span>  <span class="comment"># 继承Base</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 等价定义，注意Base后加上逗号，否则就不是tuple了</span></span><br><span class="line">SameChild == type(<span class="string">'Child'</span>, (Base,), {})</span><br></pre></td></tr></tbody></table></figure>

<p>（2）有方法的type等价使用</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 加上方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildWithMethod</span>(<span class="params">Base</span>):</span></span><br><span class="line">    bar = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span> </span><br><span class="line">    print(<span class="string">'hello'</span>)</span><br><span class="line">``` </span><br><span class="line">```python </span><br><span class="line"><span class="comment"># 等价定义，方法用的类外面hello方法</span></span><br><span class="line">ChildWithMethod = type(      </span><br><span class="line">    <span class="string">'ChildWithMethod'</span>, (Base,), {<span class="string">'bar'</span>:<span class="literal">True</span>, <span class="string">'hello'</span>:hello}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>元类 作用 控制类生成实例之前就把里面的属性变成小写,<br>   Python中 <strong>new</strong> 生成实例，<strong>init</strong> 初始化实例<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 元类继承自 type</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LowercaseMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="string">''' 修改类的属性名称为小写的元类 '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">mcs, name, bases, attrs</span>):</span>    <span class="comment"># 生成实例</span></span><br><span class="line">        lower_attrs = {}    <span class="comment"># 定义字典</span></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():   <span class="comment"># 遍历类所有属性，把非内置方法(魔术方法)都改成小写</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> k.startswith(<span class="string">'__'</span>):   <span class="comment"># 排除magic method魔术方法</span></span><br><span class="line">                lower_attrs[k.lower()] = v  <span class="comment"># 方法名变成小写</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lower_attrs[k] = v</span><br><span class="line">            <span class="comment"># 当前类mcs,名称name,基类bases,当前属性lower_attrs</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(mcs, name, bases, lower_attrs)</span><br><span class="line">            </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LowercaseClass</span>(<span class="params">metaclass=LowercaseMeta</span>):</span> <span class="comment"># py3</span></span><br><span class="line">    BAR = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">HELLO</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">    </span><br><span class="line">print(dir(LowercaseClass))  <span class="comment"># 你会发现“BAR”和“HELLO”都变小了</span></span><br><span class="line"><span class="comment"># 用一个类的实例调用hello方法，修改了类定义时候的属性名称！！！</span></span><br><span class="line">LowercaseClass().hello()</span><br></pre></td></tr></tbody></table></figure>

</li>
</ol>
<p>输出结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__',</span></span><br><span class="line"><span class="comment"># '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__',</span></span><br><span class="line"><span class="comment"># '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__',</span></span><br><span class="line"><span class="comment"># '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__',</span></span><br><span class="line"><span class="comment"># 'bar', 'hello']</span></span><br><span class="line"><span class="comment"># hello</span></span><br></pre></td></tr></tbody></table></figure>
<p>metaclass一般翻译成“元类”，但也有人认为应该更关注元类“超越变形”的能力，应该翻译成超越类之类的。但是个人觉得“元类”比较顺口，其“本元”的含义也是实打实存在的，故本文用元类作为metaclass的中文翻译。</p>
<p>metaclass(元类)可以理解成是类的抽象、本元。类元编程即使用自定义metaclass获取极强灵活性的一种编程方式。</p>
<p>不过，在多处都有提到的需要注意的是：如果不是开发框架，不要使用元类，除非只是为了寻找乐趣：）。</p>
<p>什么是本元？<br>首先还是要搞清楚什么是本元？这个概念很抽象，必须弄清楚。</p>
<p>本元可以理解成一种更高程度的抽象。首先，类（class）是对象（object）的抽象，对象是类的实例。因此可以说类是对象的本元。而在python中，所有类都是type类的实例，也就是说type是所有类的抽象，所以你可以理解type就是那个元类。</p>
<p>type<br>一般我们会常用type(obj)来获取obj对象的类型。但type也可以用来创建新类型。这时需要传入三个参数：类名、父类tuple、属性字典。</p>
<p>class MyClass: … 等价于MyClass = type(classname, superclasses, attributedict)</p>
<p>class SuperCls:<br>    def <strong>init</strong>(self):<br>        print(“<strong>init</strong> in super class.”)</p>
<p>class A(SuperCls):<br>    pass</p>
<p>B = type(“B”, (SuperCls, ), {})</p>
<p>a = A()</p>
<h1 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>init</strong> in super class.<br>“””</p>
<p>b = B()</p>
<h1 id="输出-1"><a href="#输出-1" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>init</strong> in super class.<br>“””</p>
<p>print(A.mro())</p>
<h1 id="输出-2"><a href="#输出-2" class="headerlink" title="输出"></a>输出</h1><p>“””<br>[&lt;class ‘__main__.A’&gt;, &lt;class ‘__main__.SuperCls’&gt;, &lt;class ‘object’&gt;]<br>“””</p>
<p>print(B.mro())</p>
<h1 id="输出-3"><a href="#输出-3" class="headerlink" title="输出"></a>输出</h1><p>“””<br>[&lt;class ‘__main__.B’&gt;, &lt;class ‘__main__.SuperCls’&gt;, &lt;class ‘object’&gt;]<br>“””<br>上面类对象的mro()方法代表Method Resolution Order，即方法解析顺序，可以看到这个类的继承顺序。</p>
<p>通过上面的代码可以看出，使用type来动态创建类和你自己写代码创建一个类是完全一样的。</p>
<p>还有个问题，当我们使用type的时候，它自己是个type类还是type对象？如果你直接在解释器中输入print(type)会得到返回&lt;class ‘type’&gt;，因此可以认为你使用的就是type类。</p>
<p>MetaClass<br>OK，搞清楚了什么是“本元”和type，我们再来看metaclass。</p>
<h1 id="自定义metaclass"><a href="#自定义metaclass" class="headerlink" title="自定义metaclass"></a>自定义metaclass</h1><p>class MyMeta(type):<br>    def <strong>call</strong>(self, <em>args, **kwargs):<br>        print(“<strong>call</strong> in MyMeta”)<br>        return super().<strong>call</strong>(*args, *</em>kwargs)</p>
<pre><code>def __init__(cls, what, bases=None, dict=None):
    print("__init__ in MyMeta")
    super().__init__(what, bases, dict)

def __new__(*args, **kwargs):
    print("__new__ in MyMeta")
    return type.__new__(*args, **kwargs)
</code></pre>
<p>class SuperCls:<br>    pass</p>
<h1 id="使用metaclass方法1：类定义代码中指定"><a href="#使用metaclass方法1：类定义代码中指定" class="headerlink" title="使用metaclass方法1：类定义代码中指定"></a>使用metaclass方法1：类定义代码中指定</h1><p>class MyClass(SuperCls, metaclass=MyMeta):<br>    pass</p>
<h1 id="输出-4"><a href="#输出-4" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>new</strong> in MyMeta<br><strong>init</strong> in MyMeta<br>“””</p>
<h1 id="使用metaclass方法2：直接像调用type那样调用MyMeta"><a href="#使用metaclass方法2：直接像调用type那样调用MyMeta" class="headerlink" title="使用metaclass方法2：直接像调用type那样调用MyMeta"></a>使用metaclass方法2：直接像调用type那样调用MyMeta</h1><p>MyClass = MyMeta(“MyClass”, (SuperCls, ), {})</p>
<h1 id="输出-5"><a href="#输出-5" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>new</strong> in MyMeta<br><strong>init</strong> in MyMeta<br>“””</p>
<h1 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h1><p>my_obj = MyClass()</p>
<h1 id="输出-6"><a href="#输出-6" class="headerlink" title="输出"></a>输出</h1><p>“””<br><strong>call</strong> in MyMeta<br>“””<br>看，我们的元类继承自type类。你在使用这个元类去定义一个新的类时，会调用元类的__new__和__init__；当你用这个新类去实例化一个新对象时又会调用元类的__new__。</p>
<p>因此，你可以可以重载type的这三个方法来修改type的行为，但要理清这几个方法被调用的时机：</p>
<p><strong>init</strong>(cls, what, bases=None, dict=None)<br><strong>new</strong>(<em>args, **kwargs)<br><strong>call</strong>(self, *args, *</em>kwargs)<br>典型案例<br>来看几个类元编程的典型案例。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Singleton单例模式</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls.instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls.instance = super(SingletonMeta, cls).__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CurrentUser</span>(<span class="params">object, metaclass=SingletonMeta</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name=None</span>):</span></span><br><span class="line">        super(CurrentUser, self).__init__()</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> repr(self) + <span class="string">":"</span> + repr(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    u = CurrentUser(<span class="string">"liu"</span>)</span><br><span class="line">    print(u)</span><br><span class="line">    u2 = CurrentUser()</span><br><span class="line">    u2.name = <span class="string">"xin"</span></span><br><span class="line">    print(u2)</span><br><span class="line">    print(u)</span><br><span class="line">    <span class="keyword">assert</span> u <span class="keyword">is</span> u2</span><br></pre></td></tr></tbody></table></figure>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://github.com/Meteorix/python-design-patterns">https://github.com/Meteorix/python-design-patterns</a> 。</p>
<p>这里重载的是type的__call__方法。改变了用户类实例化的行为，使其只能得到唯一的实例。</p>
<p>简易ORM框架</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Field</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, column_type</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.column_type = column_type</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;%s:%s&gt;'</span> % (self.__class__.__name__, self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        super().__init__(name, <span class="string">'varchar(100)'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntegerField</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        super().__init__(name, <span class="string">'bigint'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelMetaclass</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, name, bases, attrs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'Model'</span>:</span><br><span class="line">            <span class="keyword">return</span> type.__new__(cls, name, bases, attrs)</span><br><span class="line">        print(<span class="string">'Found model: %s'</span> % name)</span><br><span class="line">        mappings = dict()</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():</span><br><span class="line">            <span class="keyword">if</span> isinstance(v, Field):</span><br><span class="line">                print(<span class="string">'Found mapping: %s ==&gt; %s'</span> % (k, v))</span><br><span class="line">                mappings[k] = v</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> mappings.keys():</span><br><span class="line">            attrs.pop(k)</span><br><span class="line">        attrs[<span class="string">'__mappings__'</span>] = mappings  <span class="comment"># 保存属性和列的映射关系</span></span><br><span class="line">        attrs[<span class="string">'__table__'</span>] = name  <span class="comment"># 假设表名和类名一致</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(cls, name, bases, attrs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>(<span class="params">dict, metaclass=ModelMetaclass</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, **kw</span>):</span></span><br><span class="line">        super(Model, self).__init__(**kw)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">r"'Model' object has no attribute '%s'"</span> % key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span>(<span class="params">self, key, value</span>):</span></span><br><span class="line">        self[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">self</span>):</span></span><br><span class="line">        fields = []</span><br><span class="line">        params = []</span><br><span class="line">        args = []</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.__mappings__.items():</span><br><span class="line">            fields.append(v.name)</span><br><span class="line">            params.append(<span class="string">'?'</span>)</span><br><span class="line">            args.append(getattr(self, k, <span class="literal">None</span>))</span><br><span class="line">        sql = <span class="string">'insert into %s (%s) values (%s)'</span> % (self.__table__, <span class="string">','</span>.join(fields), <span class="string">','</span>.join(params))</span><br><span class="line">        print(<span class="string">'SQL: %s'</span> % sql)</span><br><span class="line">        print(<span class="string">'ARGS: %s'</span> % str(args))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">Model</span>):</span></span><br><span class="line">    <span class="comment"># 定义类的属性到列的映射：</span></span><br><span class="line">    id = IntegerField(<span class="string">'id'</span>)</span><br><span class="line">    name = StringField(<span class="string">'username'</span>)</span><br><span class="line">    email = StringField(<span class="string">'email'</span>)</span><br><span class="line">    password = StringField(<span class="string">'password'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个实例：</span></span><br><span class="line">u = User(id=<span class="number">12345</span>, name=<span class="string">'Michael'</span>, email=<span class="string">'test@orm.org'</span>, password=<span class="string">'my-pwd'</span>)</span><br><span class="line"><span class="comment"># 保存到数据库：</span></span><br><span class="line">u.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Found model: User</span></span><br><span class="line"><span class="string">Found mapping: id ==&gt; &lt;IntegerField:id&gt;</span></span><br><span class="line"><span class="string">Found mapping: name ==&gt; &lt;StringField:username&gt;</span></span><br><span class="line"><span class="string">Found mapping: email ==&gt; &lt;StringField:email&gt;</span></span><br><span class="line"><span class="string">Found mapping: password ==&gt; &lt;StringField:password&gt;</span></span><br><span class="line"><span class="string">SQL: insert into User (id,username,email,password) values (?,?,?,?)</span></span><br><span class="line"><span class="string">ARGS: [12345, 'Michael', 'test@orm.org', 'my-pwd']</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></tbody></table></figure>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072">https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072</a></p>
<p>这里重载的是type的__new__方法，因此改变的是用户类在定义时的行为。这里用户类是一个数据模型，元类编程做的是在用户定义一个数据模型类的时候，把所有是Field类型的属性收集起来，统一放到mapping属性中。这样基类的方法save可以直接通过mapping属性来保存需要保存的Field属性们。</p>
<p>YAMLObject</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YAMLObjectMetaclass</span>(<span class="params">type</span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">cls, name, bases, kwds</span>):</span></span><br><span class="line">    super(YAMLObjectMetaclass, cls).__init__(name, bases, kwds)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'yaml_tag'</span> <span class="keyword">in</span> kwds <span class="keyword">and</span> kwds[<span class="string">'yaml_tag'</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">      cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)</span><br><span class="line">  <span class="comment"># 省略其余定义</span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YAMLObject</span>(<span class="params">metaclass=YAMLObjectMetaclass</span>):</span></span><br><span class="line">    yaml_loader = Loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span>(<span class="params">yaml.YAMLObject</span>):</span></span><br><span class="line">  yaml_tag = <span class="string">u'!Monster'</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, hp, ac, attacks</span>):</span></span><br><span class="line">    self.name = name</span><br><span class="line">    self.hp = hp</span><br><span class="line">    self.ac = ac</span><br><span class="line">    self.attacks = attacks</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"%s(name=%r, hp=%r, ac=%r, attacks=%r)"</span> % (</span><br><span class="line">       self.__class__.__name__, self.name, self.hp, self.ac,      </span><br><span class="line">       self.attacks)</span><br><span class="line"></span><br><span class="line">yaml.load(<span class="string">"""</span></span><br><span class="line"><span class="string">--- !Monster</span></span><br><span class="line"><span class="string">name: Cave spider</span></span><br><span class="line"><span class="string">hp: [2,6]    # 2d6</span></span><br><span class="line"><span class="string">ac: 16</span></span><br><span class="line"><span class="string">attacks: [BITE, HURT]</span></span><br><span class="line"><span class="string">"""</span>)</span><br><span class="line"></span><br><span class="line">Monster(name=<span class="string">'Cave spider'</span>, hp=[<span class="number">2</span>, <span class="number">6</span>], ac=<span class="number">16</span>, attacks=[<span class="string">'BITE'</span>, <span class="string">'HURT'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> yaml.dump(Monster(</span><br><span class="line">    name=<span class="string">'Cave lizard'</span>, hp=[<span class="number">3</span>,<span class="number">6</span>], ac=<span class="number">16</span>, attacks=[<span class="string">'BITE'</span>,<span class="string">'HURT'</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">!Monster</span></span><br><span class="line"><span class="string">ac: 16</span></span><br><span class="line"><span class="string">attacks: [BITE, HURT]</span></span><br><span class="line"><span class="string">hp: [3, 6]</span></span><br><span class="line"><span class="string">name: Cave lizard</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></tbody></table></figure>
<p>这里重载的是type的__init__方法，因此改变的是用户类在定义时的行为。在定义了用户类Monster时，便通过cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)将Monster类注册到系统。</p>
<p>PyText</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComponentMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">metacls, typename, bases, namespace</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Config"</span> <span class="keyword">not</span> <span class="keyword">in</span> namespace:</span><br><span class="line">            <span class="comment"># We need to dynamically create a new Config class per</span></span><br><span class="line">            <span class="comment"># instance rather than inheriting a single empty config class</span></span><br><span class="line">            <span class="comment"># because components are registered uniquely by config class.</span></span><br><span class="line">            <span class="comment"># If a parent class specifies a config class, inherit from it.</span></span><br><span class="line">            parent_config = next(</span><br><span class="line">                (base.Config <span class="keyword">for</span> base <span class="keyword">in</span> bases <span class="keyword">if</span> hasattr(base, <span class="string">"Config"</span>)), <span class="literal">None</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> parent_config <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line"></span><br><span class="line">                <span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params">parent_config</span>):</span></span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">                <span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params">ConfigBase</span>):</span></span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">            namespace[<span class="string">"Config"</span>] = Config</span><br><span class="line"></span><br><span class="line">        component_type = next(</span><br><span class="line">            (</span><br><span class="line">                base.__COMPONENT_TYPE__</span><br><span class="line">                <span class="keyword">for</span> base <span class="keyword">in</span> bases</span><br><span class="line">                <span class="keyword">if</span> hasattr(base, <span class="string">"__COMPONENT_TYPE__"</span>)</span><br><span class="line">            ),</span><br><span class="line">            namespace.get(<span class="string">"__COMPONENT_TYPE__"</span>),</span><br><span class="line">        )</span><br><span class="line">        new_cls = super().__new__(metacls, typename, bases, namespace)</span><br><span class="line"></span><br><span class="line">        new_cls.Config.__COMPONENT_TYPE__ = component_type</span><br><span class="line">        new_cls.Config.__name__ = <span class="string">f"<span class="subst">{typename}</span>.Config"</span></span><br><span class="line">        new_cls.Config.__COMPONENT__ = new_cls</span><br><span class="line">        new_cls.Config.__EXPANSIBLE__ = namespace.get(<span class="string">"__EXPANSIBLE__"</span>)</span><br><span class="line">        <span class="keyword">if</span> component_type:</span><br><span class="line">            Registry.add(component_type, new_cls, new_cls.Config)</span><br><span class="line">        <span class="keyword">return</span> new_cls</span><br></pre></td></tr></tbody></table></figure>
<p>注：代码来自 <a target="_blank" rel="noopener" href="https://github.com/facebookresearch/pytext/blob/351a060b479cbfe1db46b74f1fc975a5b6523122/pytext/config/component.py#L87">https://github.com/facebookresearch/pytext/blob/351a060b479cbfe1db46b74f1fc975a5b6523122/pytext/config/component.py#L87</a></p>
<p>这里重载的是type的__new__方法，因此改变的是用户类在定义时的行为。在定义了用户组件类时，便通过Registry.add(component_type, new_cls, new_cls.Config)将该组件类注册到系统。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span>(<span class="params">yaml.YAMLObject</span>):</span></span><br><span class="line">    yaml_tag = <span class="string">"Monster"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, hp, ac, attacks</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.hp = hp</span><br><span class="line">        self.ac = ac</span><br><span class="line">        self.attacks = attacks</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"{}(name = {}, hp = {}, ac = {}, attacks = {}"</span>.format(self.__class__.__name__, self.name, self.hp, self.ac, self.attacks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    Monster(name = <span class="string">"zym"</span>, hp = [<span class="number">2</span>, <span class="number">6</span>], ac = <span class="number">16</span>, attacks = [<span class="string">"BITE"</span>, <span class="string">"HURT"</span>])</span><br><span class="line">    print(yaml.dump(Monster(name = <span class="string">"zym2"</span>, hp = [<span class="number">3</span>, <span class="number">6</span>], ac = <span class="number">18</span>, attacks = [<span class="string">"BITE"</span>, <span class="string">"HURT"</span>])))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 所有用户自定义类，是type的实例</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    instance = MyClass()</span><br><span class="line">    print(type(instance))</span><br><span class="line">    print(type(MyClass))</span><br><span class="line">    <span class="comment"># 用户自定义类，是type类的__call__运算符重载</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass2</span>:</span></span><br><span class="line">        data = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    instance = MyClass2()</span><br><span class="line">    print(MyClass2, instance, instance.data)</span><br><span class="line"></span><br><span class="line">    MyClass = type(<span class="string">"MyClass"</span>, (), {<span class="string">"data"</span>:<span class="number">1</span>})</span><br><span class="line">    instance = MyClass()</span><br><span class="line">    print(MyClass, instance, instance.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 网友的例子</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyMeta</span>(<span class="params">type</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, bases, dic</span>):</span></span><br><span class="line">            super().__init__(name, bases, dic)</span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__init__"</span>)</span><br><span class="line">            print(self.__name__)</span><br><span class="line">            print(dic)</span><br><span class="line">            print(self.yaml_tag)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__new__"</span>)</span><br><span class="line">            print(cls.__name__)</span><br><span class="line">            <span class="keyword">return</span> type.__new__(cls, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"===&gt;MyMeta.__call__"</span>)</span><br><span class="line">            obj = cls.__new__(cls)</span><br><span class="line">            cls.__init__(cls, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Foo</span>(<span class="params">metaclass=MyMeta</span>):</span></span><br><span class="line">        yaml_tag = <span class="string">"!Foo"</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">            print(<span class="string">"Foo.__init__"</span>)</span><br><span class="line">            self.name = name</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">            print(<span class="string">"Foo.__new__"</span>)</span><br><span class="line">            <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line"></span><br><span class="line">    foo = Foo(<span class="string">"foo"</span>)</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/han-shu-shi-bian-cheng-filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/han-shu-shi-bian-cheng-filter/" class="post-title-link" itemprop="url">函数式编程 filter</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-14 07:32:18" itemprop="dateModified" datetime="2021-04-14T07:32:18Z">2021-04-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="filter-函数应用"><a href="#filter-函数应用" class="headerlink" title="filter()函数应用"></a>filter()函数应用</h3><p>filter(function or None, iterable) –&gt; filter object</p>
<p>function or None：函数或者为None。<br>iterable：可迭代对象。</p>
<p>filter就是把每个function应用到可迭代对象上，如果为True就返回。<br>功能：过滤序列<br>注意：参数函数返回值必须为真值或假值<br>返回值：迭代器对象</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f = filter(<span class="keyword">lambda</span> x: <span class="literal">True</span> <span class="keyword">if</span> x!=<span class="number">0</span> <span class="keyword">else</span> <span class="literal">False</span> , [<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">print(list(f))  <span class="comment"># [1, 2, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回所有的偶数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(filter(<span class="keyword">lambda</span> x: x%<span class="number">2</span>==<span class="number">0</span>, range(<span class="number">10</span>)))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用列表推导式实现</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i % <span class="number">2</span>==<span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  计算200内所有奇数的平分根是整数，需要使用filter函数</span></span><br><span class="line"><span class="comment"># filter 函数传入两个参数，第一个参入的是lambda函数，第二个参数是一到两百的列表</span></span><br><span class="line">f2 = filter(<span class="keyword">lambda</span> x: <span class="keyword">not</span> x &amp; <span class="number">1</span> <span class="keyword">and</span> pow(int(x**<span class="number">0.5</span>), <span class="number">2</span>) == x, range(<span class="number">1</span>, <span class="number">201</span>))</span><br><span class="line"><span class="comment"># not x&amp;1 计算出一到两百所有奇数</span></span><br><span class="line"><span class="comment"># x**0.5计算平分根</span></span><br><span class="line"><span class="comment"># print(pow(3, 2) == 3**2 == 9)  # True</span></span><br><span class="line"><span class="comment"># pow(int(x**0.5), 2) 计算平分根的正整数的平方</span></span><br><span class="line"><span class="comment"># pow(int(x**0.5), 2) == x  平分根的正整数的平方是否等于自己x,x&gt;0,平方根不是整数平方后都变小</span></span><br><span class="line">x = <span class="number">2</span></span><br><span class="line">print(pow(int(x**<span class="number">0.5</span>), <span class="number">2</span>) == x)  <span class="comment"># False 平分根的正整数的平方是否等于自己x</span></span><br><span class="line">print(f2)  <span class="comment"># &lt;filter object at 0x000001C27B350B80&gt;</span></span><br><span class="line">print(list(f2))  <span class="comment"># [4, 16, 36, 64, 100, 144, 196]</span></span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/22/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/24/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
