<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/23/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/23/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/23/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">351</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/redis/" class="post-title-link" itemprop="url">redis</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-21 03:22:16" itemprop="dateModified" datetime="2021-06-21T03:22:16Z">2021-06-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Redis是一种Key-Value存储结构的NoSQL非关系数据库存储服务系统</p>
<h2 id="Redis特性"><a href="#Redis特性" class="headerlink" title="Redis特性"></a>Redis特性</h2><h4 id="速度快"><a href="#速度快" class="headerlink" title="速度快"></a>速度快</h4><ul>
<li>数据存储在<strong>内存</strong>中 （主要原因）</li>
<li>C语言编写（50000行）</li>
<li>单线程模型</li>
</ul>
<h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><p>Redis所有数据存储在内存，对数据的更新将异步保存到磁盘上，重启可再加载</p>
<h4 id="多种数据结构"><a href="#多种数据结构" class="headerlink" title="多种数据结构"></a>多种数据结构</h4><ul>
<li>字符串（string）</li>
<li>哈希表（hash tables）</li>
<li>列表（lists）</li>
<li>集合（sets）</li>
<li>有序集合（sorted sets/ zset）</li>
<li>位图（BitMaps） 实现过滤器</li>
<li>超小内存唯一值计数（HyperLogLog）</li>
<li>地理信息定位（GEO）</li>
</ul>
<h4 id="支持多种编辑语言"><a href="#支持多种编辑语言" class="headerlink" title="支持多种编辑语言"></a>支持多种编辑语言</h4><h4 id="功能丰富"><a href="#功能丰富" class="headerlink" title="功能丰富"></a>功能丰富</h4><ul>
<li>发布订阅</li>
<li>Lua脚本</li>
<li>事务</li>
<li>pipeline</li>
</ul>
<h4 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h4><ul>
<li>不依赖外部库</li>
<li>单线程模型</li>
</ul>
<h4 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h4><p>主服务器数据复制到从服务器上，哨兵和集群</p>
<h4 id="高可用，分布式"><a href="#高可用，分布式" class="headerlink" title="高可用，分布式"></a>高可用，分布式</h4><p>高可用（Redis-Sentinel(v2.8支持高可用)）<br>分布式（Redis-Cluster(v3.0支持分布式)）</p>
<h3 id="redis的使用场景"><a href="#redis的使用场景" class="headerlink" title="redis的使用场景"></a>redis的使用场景</h3><ul>
<li><p>高速缓存cache</p>
<ul>
<li>10万+的QPS（查询次数/秒），集群可达百万级以上</li>
<li>首页内容缓存优化（门户、新闻等）</li>
<li>秒杀业务、抢购业务、库存控制等</li>
</ul>
</li>
<li><p>计数器<br>实现评论计数、播放量计算等</p>
</li>
<li><p>消息队列系统</p>
</li>
<li><p>排行榜</p>
</li>
<li><p>社交网络<br>粉丝数量、关注数、共同关注、</p>
</li>
<li><p>实时系统</p>
</li>
</ul>
<h3 id="Redis可执行文件说明"><a href="#Redis可执行文件说明" class="headerlink" title="Redis可执行文件说明"></a>Redis可执行文件说明</h3><p>redis-server （redis服务器）<br>redis-cli （redis命令行客户端）<br>redis-benchmark （性能检测工具）<br>redis-check-aof （AOF文件修复工具）<br>redis-check-dump （RDB文件修复工具）<br>redis-sentinel （Sentinel服务器2.8以后）</p>
<h3 id="启动redis"><a href="#启动redis" class="headerlink" title="启动redis"></a>启动redis</h3><ul>
<li>最简启动</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>动态参数启动</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server --port 6379</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>配置文件启动（生产环境选择）<br>单机多实例使用端口区分，一台机器会有多个redis，配置文件用端口来区分</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos redis-6.0.12]<span class="comment"># cd src</span></span><br><span class="line">[root@VM-0-9-centos redis-6.0.12]<span class="comment"># ./src/redis-server redis.conf</span></span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos redis-6.0.12]<span class="comment"># mv /src/redis-server/redis.conf redis-6380.conf </span></span><br><span class="line">[root@VM-0-9-centos redis-6.0.12]<span class="comment"># redis-server redis-6380.conf </span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; redis-server redis.windows.conf</span><br></pre></td></tr></tbody></table></figure>


<p>可以做一个包含此命令的bat文件，每次双击启动</p>
<p>Redis 命令<br>Redis 命令用于在 redis 服务上执行操作。<br>要在 redis 服务上执行命令需要一个 redis 客户端。Redis 客户端在我们之前下载的的 redis 的安装包中。</p>
<p>Redis 客户端的基本语法为：</p>
<ul>
<li>启动 redis 服务器，连接本地的 redis 服务。连接到<strong>本地</strong>的 redis 服务并执行 PING 命令，<br>加上 –raw避免中文乱码了<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># redis-cli --raw</span></span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exit</span></span><br></pre></td></tr></tbody></table></figure>
<code>auth "password"</code>登录才有权限，不能漏掉双引号</li>
</ul>
<p>在远程 redis 服务上执行命令</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h host -p port -a password</span><br><span class="line">$ redis-cli -h 127.0.0.1 -p 6379 -a <span class="string">"mypass"</span></span><br><span class="line">redis 127.0.0.1:6379&gt; PING</span><br><span class="line">PONG</span><br></pre></td></tr></tbody></table></figure>


<p>验证是否成功启动</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># ps -ef | grep redis</span></span><br><span class="line">root      4092  3940  0 11:52 pts/5    00:00:00 grep --color=auto redis</span><br><span class="line">root     21009     1  0 Apr24 ?        00:26:12 ./src/redis-server 127.0.0.1:6379</span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># ps -ef | grep redis | grep -v grep</span></span><br></pre></td></tr></tbody></table></figure>
<p>netstat antpl | grep redis 查看端口是否是listen<br>redis-cli ping<br>redis-cli -h ip -p port ping</p>
<h3 id="Redis常用配置"><a href="#Redis常用配置" class="headerlink" title="Redis常用配置"></a>Redis常用配置</h3><p>后台进程</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos redis-6.0.12]<span class="comment"># vim redis.conf</span></span><br></pre></td></tr></tbody></table></figure>
<p>yy复制一行，p粘贴，</p>
<figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># daemonize no 默认</span></span><br><span class="line"><span class="attribute">daemonize</span> <span class="literal">yes</span>  <span class="comment"># 启动的日志</span></span><br></pre></td></tr></tbody></table></figure>
<p>Esc + :wq</p>
<p>port （对外端口号 默认为6379）<br>logfile （系统日志）工作表现、异常<br>dir （工作目录）</p>
<p>redis 没有表 缓存经常被读取的热数据的平台<br>redis里面取出来的数据都是bytes类型的，所以要用decode方法转成字符串</p>
<p>flushdb 清空逻辑表格<br>flushall  清空逻辑库数据</p>
<h4 id="字符串（String）相关操作"><a href="#字符串（String）相关操作" class="headerlink" title="字符串（String）相关操作"></a>字符串（String）相关操作</h4><ul>
<li><p><code>set</code> – 设置值</p>
</li>
<li><p><code>get</code> – 获取值</p>
</li>
<li><p><code>mset</code> – 设置多个键值对key-value</p>
</li>
<li><p><code>mget</code> – 获取多个键值对key-value</p>
</li>
<li><p><code>append</code> – 在字符串结尾添加字符串内容</p>
</li>
<li><p><code>del</code> – 删除key</p>
</li>
<li><p><code>ttl</code> – 查看剩余时间，秒单位</p>
</li>
<li><p><code>type</code> – 判断类型</p>
</li>
<li><p><code>incr</code>/<code>decr</code> – 增加/减少 1<br>incr num 数字自增加1<br>incrby num 25 数字加上指定的整数值<br>incrbyfloat num 2.5 数字加上指定的整数值<br>decr num 数字自增减1<br>decrby num 25 数字减去指定的整数值</p>
</li>
</ul>
<pre class=" language-redis"><code class="language-redis">>set email scott@163.com
>get email

>mset a 10 b 20 c 30
>mget a b c email

mset username scott sex male 
mget username sex  

append username 123 在字符串结尾追加内容
</code></pre>
<pre class=" language-redis"><code class="language-redis">> incr count
(integer) 1
> incr count
(integer) 2
> incr count
(integer) 3
> get count
"3"
> incr count
(integer) 4
> incr count
(integer) 5
`


缓存
- 内容变化不频繁
 - 几个小时、几天才变化一次
- 重复性工作
 - 查询数据库
 - 生成响应数据
- 优化一下：不查数据库，缓存内容


getrange email 0 3 获得截取字符串内容
strlen emai 获得字符串长度

setex 设置带有过期时间（秒）的 key-value
setex city 5 Beijing


数据类型
String(字符串)：用来实现
简单的 KV 键值对存储，比如计数器

哈希表 存储彼此相关信息的键值对，用HSET key filed value 来去设置一组相关信息，
例如设置用户ID和名字相关联 
HSET name { id: user_name}
hset 8000 ename Tom
hset  8000 job salesman
hmset 9000 ename Scott job salesman deptno 10

hget 8000 ename
hmget 8000 ename job deptno
HGETALL 8000  必须大写

hkeys 8000 获得所有哈希表字段名,key

hlen 8000 获得所有哈希表key数量
hexists 8000 job 判断哈希表是否存在某个key字段名

hvals 9000 获得哈希表素有字段值
hdel 9000 job deptno 删除哈希表的字段

hdel 9000 key1 key2 

HINCRBY 8000 deptno 10让哈希表某个字段加上指定的整数值，自增
HINCRBYfloat 8000 sal 6.6

列表类型：向value 保存序列化的数据，可重复
List(链表)：实现双向链表，比如用户的关注，粉丝列表
rpush list 1 2 3 # 创建并且依次向右边添加
lrange list 0 -1 获取指定范围内的元素


lpush list2 1 2 3 创建并且依次向左边添加
lrange list2 0 -1 


lpush dname 秘书处   # 在已存在的字段向左边

lset dname 2 销售部 # 第二个位置
lrange dname 0 -1 打印列表第一个元素到最后一个元素
秘书处
技术部
销售部
售后部

llen dname 获得列表长度
lindex 数字 通过索引获得列表某个元素
linsert dname before 秘书处 董事会 在某个位置插入元素之前
lpop dname 删除列表最左边的元素
rpop dname 删除列表最右边的元素

rpush employee Scott
rpush employee Jack
rpush employee Scott
lrem employee 1 Scott 删除列表第一个元素
lrem employee 2 Scott 删除列表2个元素

集合类型set 列表中的元素不可以重复 存储不重复元素，比如用户的关注者，没有顺序
SADD EMPNO 8000 向集合添加成员
SADD EMPNO 8001 8002
SMEMBERS EMPNO  获得集合所有元素，按照哈希值排序

SCARD EMPNO 获得集合长度、成员数量
sismember EMPNO 8000 判断是否含有某个元素
srem EMPNO 8001 删除指定元素

spop empno 随机删除并返回集合的某个元素
srandmember empno 33 随机返回集合中的3个元素

有序集合Sorted Set 带排序功能的集合，按照元素分数值排序
zadd keyword 0 'JACK' 0 'Miko' 0 'Ashe' 定义有序集合 先写分数值
zincrby keyword 1 'JACK' 指定成员分数加上增量
zincrby keyword 5 'Ashe' 
zincrby keyword 3 'Miko' 
zincrby keyword 2 'Mikko'  mikko不存在则新建
zrange keyword 0 -1 通过索引获得有序集合区间内的元素（升序）
zrevrange keyword 0 -1 通过索引获得有序集合区间内的元素（降序）
zrevrange keyword 0 0 分数值最高的元素
zrangebyscore 获得分数值区间内容的集合内容（升序）
zrangebyscore keyword 0 2
zrangebyscore keyword 0 (2  不包括2
zrangebyscore keyword 2 +inf 正无穷
zrerangebyscore 获得分数值区间内容的集合内容（降序）
zrevrangebyscore keyword 3 0
zrevrangebyscore keyword (3 0   不包括3

zcard keyword 获得有序集合长度、元素数量
zcount keyword 2 4 查询某个分数值区间的元素数量
zscore keyword 'Ashe' 返回元素的分数值

zrank keyword 'Ashe' 获得元素的升序排名（从0开始）
zrevrank keyword 'Ashe' 获得元素的降序排名（从0开始）
zrevrank keyword 'Ashe'

zrem keyword  'Miko'  'Ashe'  删除有序集合中的元素
zremrangebyrank keyword 0 2  删除排名区间内的元素
zremrangebyscore keyword -inf 2  删除排名区间内的元素

exists employee 判断是否存在某个key
expire employee 5设置过期时间
expireat employee 12设置记录的过期时间(UNIX时间戳)
move keyword 1 记录迁移到其他逻辑库,1号逻辑库
select 1 切换到1号逻辑库
rename employee emp
presistkeyword 移除过期时间 
type keyword 判断value数据类型

为什么要一如线程池
如果程序中经常需要用到线程，频繁的创建和销毁线程会浪费很多硬件资源，所以需要把线程和任务分离开。线程可以反复利用，省去了重复创建的麻烦。
</code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/replace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/replace/" class="post-title-link" itemprop="url">replace</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>主串.replace(‘旧子串’,’新子串’,匹配次数)<br>多种异常字段替换成一种字段</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原数据</span></span><br><span class="line">data = [<span class="number">123</span>, <span class="number">234</span>, <span class="string">'零'</span>, <span class="string">'None'</span>, <span class="number">8975</span>]</span><br><span class="line"><span class="comment"># 需要替换字段</span></span><br><span class="line">replace = [<span class="string">'零'</span>, <span class="string">'None'</span>]</span><br><span class="line">result = [<span class="number">0</span> <span class="keyword">if</span> i <span class="keyword">in</span> replace <span class="keyword">else</span> i <span class="keyword">for</span> i <span class="keyword">in</span> data]</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># [123, 234, 0, 0, 8975]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多字段替换</span></span><br><span class="line"><span class="comment"># 原数据</span></span><br><span class="line">data = [<span class="number">123</span>, <span class="number">234</span>, <span class="string">'零'</span>, <span class="string">'None'</span>, <span class="number">8975</span>]</span><br><span class="line"><span class="comment"># 需要替换字段</span></span><br><span class="line">replace = {<span class="string">'零'</span>: <span class="number">0</span>, <span class="number">123</span>: <span class="string">'一二三'</span>}</span><br><span class="line">result = [replace[i] <span class="keyword">if</span> i <span class="keyword">in</span> replace <span class="keyword">else</span> i <span class="keyword">for</span> i <span class="keyword">in</span> data]</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># ['一二三', 234, 0, 'None', 8975]</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'tea for too'</span>.replace(<span class="string">'too'</span>, <span class="string">'two'</span>))</span><br><span class="line"><span class="comment"># 'tea for two'</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/request-mo-kuai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/request-mo-kuai/" class="post-title-link" itemprop="url">request模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-31 08:45:38" itemprop="dateModified" datetime="2021-07-31T08:45:38Z">2021-07-31</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>urllib 是 Python 标准库中用于网络请求的库。该库有四个模块，分别是urllib.request，urllib.error，urllib.parse，urllib.robotparser。其中urllib.request，urllib.error两个库在爬虫程序中应用比较频繁。urllib一般要先构建get或者post请求，然后再发起请求。</p>
<p>requests模块 基于HTTP请求的模块第三方的Python库，<br>小规模，数据量小，速度不敏感、爬取网页<br>支持HTTP连接保持和连接池，支持使用cookie保持会话，<br>支持文件上传，支持自动确定响应内容的编码，<br>支持国际化的 URL 和 POST 数据自动编码。</p>
<p>requests可以直接构建常用的get和post请求并发起，<br>使用了urllib3，多次请求重复使用一个socket，<br>“connection”:”keep-alive”，说明多次请求使用一个连接，消耗更少的资源</p>
<p>作用：模拟浏览器发送HTTP请求。用于爬虫或接口的测试<br>如何使用：</p>
<ul>
<li><p>指定url</p>
</li>
<li><p>发起请求</p>
</li>
<li><p>获取响应数据</p>
</li>
<li><p>持久化存储</p>
</li>
<li><p><code>requests.request()</code>    构造一个请求，支撑以下各方法的基础方法</p>
</li>
<li><p><code>requests.head()</code>    获取HTML网页头信息的方法，对应于HTTP的HEAD</p>
</li>
<li><p><code>requests.put()</code>    向HTML网页提交PUT请求的方法，对应于HTTP的PUT</p>
</li>
<li><p><code>requests.patch()</code>    向HTML网页提交局部修改请求，对应于HTTP的PATCH</p>
</li>
<li><p><code>requests.delete()</code>    向HTML网页提交删除请求，对应于HTTP的DELETE</p>
</li>
<li><p><code>requests.post()</code>    向HTML网页提交POST请求的方法，对应于HTTP的POST</p>
</li>
<li><p><code>requests.get(url, params=None, **kwarge)</code> 构造一个向服务器请求资源的requests对象，返回一个包含服务器资源的requests对象，获取HTML网页的主要方法，对应于HTTP的GET</p>
</li>
</ul>
<p>Requests方法的13个访问控制参数<br>参数名    说明<br><code>url</code>:获取页面的url链接<br><code>params</code>字典或字节序列，作为参数增加到url中<br><code>body</code>字典或字节序列<br><code>s</code>：12个控制访问的参数<br><code>data</code>    字典、字节序列或文件对象，作为Request的内容<br><code>json</code>    JSON格式的数据，作为Request的内容<br><code>headers</code>字典、HTTP定制头<br><code>cookies</code>字典或CookieJar，Request中的cookie<br><code>auth</code>    元组，支持HTTP认证功能<br><code>files</code>    字典类型，传输文件<br><code>timeout</code>    设定超时时间，秒为单位<br><code>proxies</code>    字典类型，设定访问代理服务器，可以增加登录认证<br><code>allow_redirects</code>    True/False,默认为True，重定向开关<br><code>stream</code>默认为True，获取内容立即下载开关<br><code>verify</code>默认为True，认证SSL证书开关<br><code>cert</code>    本地SSL证书路径</p>
<p>Request:构造一个向服务器请求资源的Request对象<br>Response：返回一个包含服务器资源的Response对象</p>
<h3 id="Response对象的属性"><a href="#Response对象的属性" class="headerlink" title="Response对象的属性"></a>Response对象的属性</h3><p><code>r.status_code</code>    HTTP请求的返回状态码<br><code>r.text</code>    HTTP响应内容的字符串形式，即 url对应的页面内容<br><code>r.encoding</code>    从HTTP header中猜测的响应内容编码方式，如果header中不存在charset字段，则认为编码为 ISO-8859-1<br><code>r.apparent_encoding</code>    从内容中分析出的响应内容编码方式（备选编码方式）<br><code>r.content</code>    HTTP响应内容的 byte 类型  二进制形式<br><code>r.content.decode()</code>    </p>
<h3 id="Requests库的异常"><a href="#Requests库的异常" class="headerlink" title="Requests库的异常"></a>Requests库的异常</h3><p><code>requests.ConnectionError</code>    网络连接异常，如DNS查询失败、拒绝连接等<br><code>requests.HTTPError</code>    HTTP错误异常<br><code>requests.URLRequired</code>    URL缺失异常<br><code>requests.TooManyRedirects</code>    超过最大重定向次数，产生重定向异常<br><code>requests.ConnectTimeout</code>    连接远程服务器超时异常<br><code>requests.Timeout</code>    请求URL超时，产生异常</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 . 组装请求</span></span><br><span class="line">url1 = <span class="string">"http://api.tianapi.com/txapi/aqi/index?key=4dce7e012c6391364928602666813641&amp;area=上海"</span></span><br><span class="line">url2 = <span class="string">"http://api.tianapi.com/txapi/aqi/index"</span></span><br><span class="line">url3 = <span class="string">"http://api.tianapi.com/txapi/aqi/index"</span></span><br><span class="line">params = {<span class="string">"key"</span>: <span class="string">"4dce7e012c6391364928602666813641"</span>, <span class="string">"area"</span>: <span class="string">"上海"</span>}</span><br><span class="line">data = {<span class="string">"key"</span>: <span class="string">"4dce7e012c6391364928602666813641"</span>, <span class="string">"area"</span>: <span class="string">"上海"</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 发送请求，获取响应</span></span><br><span class="line">res1 = requests.get(url=url1)</span><br><span class="line">res2 = requests.get(url=url2, params=params)</span><br><span class="line">res3 = requests.post(url=url3, data=data)</span><br><span class="line"><span class="comment"># 3. 解析响应</span></span><br><span class="line">print(res1.text)</span><br><span class="line">print(res2.text)</span><br><span class="line">print(res3.text)</span><br><span class="line">---</span><br><span class="line">{<span class="string">"code"</span>:<span class="number">200</span>,<span class="string">"msg"</span>:<span class="string">"success"</span>,<span class="string">"newslist"</span>:[{<span class="string">"area"</span>:<span class="string">"上海"</span>,<span class="string">"area_code"</span>:<span class="string">"shanghai"</span>,<span class="string">"so2"</span>:<span class="string">"5"</span>,<span class="string">"o3"</span>:<span class="string">"36"</span>,<span class="string">"pm2_5"</span>:<span class="string">"49"</span>,<span class="string">"primary_pollutant"</span>:<span class="string">"颗粒物(PM2.5)"</span>,<span class="string">"co"</span>:<span class="string">"0.7"</span>,<span class="string">"num"</span>:<span class="string">"231"</span>,<span class="string">"no2"</span>:<span class="string">"71"</span>,<span class="string">"quality"</span>:<span class="string">"良好"</span>,<span class="string">"aqi"</span>:<span class="string">"68"</span>,<span class="string">"pm10"</span>:<span class="string">"57"</span>,<span class="string">"o3_8h"</span>:<span class="string">"52"</span>,<span class="string">"time"</span>:<span class="string">"2021-04-27 20:40:10.642"</span>}]}</span><br><span class="line">{<span class="string">"code"</span>:<span class="number">200</span>,<span class="string">"msg"</span>:<span class="string">"success"</span>,<span class="string">"newslist"</span>:[{<span class="string">"area"</span>:<span class="string">"上海"</span>,<span class="string">"area_code"</span>:<span class="string">"shanghai"</span>,<span class="string">"so2"</span>:<span class="string">"5"</span>,<span class="string">"o3"</span>:<span class="string">"36"</span>,<span class="string">"pm2_5"</span>:<span class="string">"49"</span>,<span class="string">"primary_pollutant"</span>:<span class="string">"颗粒物(PM2.5)"</span>,<span class="string">"co"</span>:<span class="string">"0.7"</span>,<span class="string">"num"</span>:<span class="string">"231"</span>,<span class="string">"no2"</span>:<span class="string">"71"</span>,<span class="string">"quality"</span>:<span class="string">"良好"</span>,<span class="string">"aqi"</span>:<span class="string">"68"</span>,<span class="string">"pm10"</span>:<span class="string">"57"</span>,<span class="string">"o3_8h"</span>:<span class="string">"52"</span>,<span class="string">"time"</span>:<span class="string">"2021-04-27 20:40:10.642"</span>}]}</span><br><span class="line">{<span class="string">"code"</span>:<span class="number">200</span>,<span class="string">"msg"</span>:<span class="string">"success"</span>,<span class="string">"newslist"</span>:[{<span class="string">"area"</span>:<span class="string">"上海"</span>,<span class="string">"area_code"</span>:<span class="string">"shanghai"</span>,<span class="string">"so2"</span>:<span class="string">"5"</span>,<span class="string">"o3"</span>:<span class="string">"36"</span>,<span class="string">"pm2_5"</span>:<span class="string">"49"</span>,<span class="string">"primary_pollutant"</span>:<span class="string">"颗粒物(PM2.5)"</span>,<span class="string">"co"</span>:<span class="string">"0.7"</span>,<span class="string">"num"</span>:<span class="string">"231"</span>,<span class="string">"no2"</span>:<span class="string">"71"</span>,<span class="string">"quality"</span>:<span class="string">"良好"</span>,<span class="string">"aqi"</span>:<span class="string">"68"</span>,<span class="string">"pm10"</span>:<span class="string">"57"</span>,<span class="string">"o3_8h"</span>:<span class="string">"52"</span>,<span class="string">"time"</span>:<span class="string">"2021-04-27 20:40:10.642"</span>}]}</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">print(r.status_code)  <span class="comment"># 检测请求网页的状态码</span></span><br><span class="line"><span class="comment"># 输出200</span></span><br><span class="line">r.encoding = <span class="string">'utf-8'</span></span><br><span class="line">print(r.text)</span><br><span class="line"><span class="comment"># 输出网页内容</span></span><br></pre></td></tr></tbody></table></figure>

<p>通用框架</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHTMLText</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(url, timeout=<span class="number">30</span>)</span><br><span class="line">        r.raise_for_status()  <span class="comment"># 如果状态不是200，引发HTTPError异常</span></span><br><span class="line">        r.encoding = r.apparent_encoding  <span class="comment"># 使得返回内容的解码是正确的</span></span><br><span class="line">        <span class="keyword">return</span> r.text</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"产生异常"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    url = <span class="string">"http://www.baidu.com"</span></span><br><span class="line">    print(getHTMLText(url))</span><br></pre></td></tr></tbody></table></figure>

<p>request使用代理<br>很多网站如果发现同一个IP发出的大量请求，就会封禁这样的IP<br>爬虫为了避免被封IP，必须不断地更换IP地址发出请求，这个时候就需要使用代理</p>
<p>requests库有一个代理参数proxies可以指定通过代理服务器发起请求<br>proxies参数是一个字典，里面包含了http和https的代理URL</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用代理</span></span><br><span class="line">resp = requests.get(<span class="string">'http://httpbin.org/ip'</span>)</span><br><span class="line">print(resp.text)</span><br><span class="line"><span class="comment"># {"origin": "114.93.163.248"}</span></span><br><span class="line"></span><br><span class="line">proxies = {</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://139.227.252.141:8118'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://139.227.252.141:8118'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用代理</span></span><br><span class="line">resp = requests.get(<span class="string">'http://httpbin.org/ip'</span>, proxies=proxies)</span><br><span class="line">print(resp.text)</span><br><span class="line"><span class="comment"># {"origin": "139.227.252.141"}</span></span><br></pre></td></tr></tbody></table></figure>

<p>需求1：爬取搜狗首页的页面数据</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 第一步：指定url</span></span><br><span class="line">    url = <span class="string">'https://www.sogou.com/'</span></span><br><span class="line">    <span class="comment"># 第二步：发起请求</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="comment"># 第三步：获取响应数据</span></span><br><span class="line">    page_text = response.text</span><br><span class="line">    <span class="comment"># print(page_text)</span></span><br><span class="line">    <span class="comment"># 第四步：持久化存储</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'./搜狗首页.html'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)<span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text)</span><br><span class="line">    print(<span class="string">'爬取结束'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求2：实现一个简易的网页采集器（爬取搜狗指定词条对应的搜索结果页面）<br>UA伪装：门户网站的服务器会检测载体身份标识，如果检测到是爬虫发起就会拒绝访问，所以需要伪装成正常的浏览器访问身份。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'https://www.sogou.com/web'</span></span><br><span class="line">    <span class="comment"># 处理url携带的参数：封装到字典中</span></span><br><span class="line">    keyWord = input(<span class="string">'请输入关键字：'</span>)</span><br><span class="line">    param = {</span><br><span class="line">        <span class="string">'query'</span>: keyWord</span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.get(url=url, params=param, headers=headers)</span><br><span class="line">    page_text = response.text</span><br><span class="line">    filename = <span class="string">'./简易网页采集/'</span> + keyWord + <span class="string">'.html'</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text)</span><br><span class="line">    print(keyWord + <span class="string">'  保存成功！'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求3：破解百度翻译<br>注意：响应数据为json类型；请求方式为POST</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'https://fanyi.baidu.com/sug'</span></span><br><span class="line">    keyWord = input(<span class="string">'请输入关键字：'</span>)</span><br><span class="line">    data = {</span><br><span class="line">        <span class="string">'kw'</span>: keyWord</span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.post(url=url, data=data, headers=headers)</span><br><span class="line">    page_json = response.json()</span><br><span class="line">    <span class="comment"># print(page_json)</span></span><br><span class="line">    fp = open(<span class="string">'./百度翻译/'</span> + keyWord + <span class="string">".json"</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    json.dump(page_json, fp=fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    print(<span class="string">'翻译结束！已保存'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求4：爬取豆瓣电影分类排行榜</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'https://movie.douban.com/j/chart/top_list'</span></span><br><span class="line">    num = input(<span class="string">'请输入前多少名数据:'</span>)</span><br><span class="line">    param = {</span><br><span class="line">        <span class="string">'type'</span>: <span class="string">'11'</span>,</span><br><span class="line">        <span class="string">'interval_id'</span>: <span class="string">'100:90'</span>,</span><br><span class="line">        <span class="string">'action'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'start'</span>: <span class="string">'0'</span>,</span><br><span class="line">        <span class="string">'limit'</span>: num</span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.get(url=url, params=param, headers=headers)</span><br><span class="line">    list_data = response.json()</span><br><span class="line">    fp = open(<span class="string">'./豆瓣排行/豆瓣排行.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    json.dump(list_data, fp=fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    print(<span class="string">'保存完成'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>需求5：肯德基餐厅查询（<a target="_blank" rel="noopener" href="http://www.kfc.com.cn/kfccda/storelist/index.aspx%EF%BC%89">http://www.kfc.com.cn/kfccda/storelist/index.aspx）</a></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">'http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx'</span></span><br><span class="line">    cname = input(<span class="string">'请输入城市：'</span>)</span><br><span class="line">    keyword = input(<span class="string">'请输入关键字：'</span>)</span><br><span class="line">    op = <span class="string">'keyword'</span></span><br><span class="line">    param = {</span><br><span class="line">        <span class="string">'op'</span>: op</span><br><span class="line">    }</span><br><span class="line">    data = {</span><br><span class="line">        <span class="string">'cname'</span>: cname,</span><br><span class="line">        <span class="string">'pid'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'keyword'</span>: keyword,</span><br><span class="line">        <span class="string">'pageIndex'</span>: <span class="string">'1'</span>,</span><br><span class="line">        <span class="string">'pageSize'</span>: <span class="string">'10'</span></span><br><span class="line">    }</span><br><span class="line">    headers = {</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56'</span></span><br><span class="line">    }</span><br><span class="line">    response = requests.post(url=url, data=data, headers=headers, params=param)</span><br><span class="line">    print(response.json())</span><br><span class="line">    table_data = response.json()</span><br><span class="line">    fp = open(<span class="string">'./肯德基餐厅/'</span>+cname+<span class="string">'_'</span>+keyword+<span class="string">'.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    json.dump(table_data, fp=fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    print(<span class="string">'保存完成'</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL_GET = <span class="string">"https://api.douban.com/v2/event/list"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_params_requests</span>():</span></span><br><span class="line">    <span class="comment"># 构建请求参数</span></span><br><span class="line">    params = {<span class="string">'loc'</span>: <span class="string">'108288'</span>, <span class="string">'day_type'</span>: <span class="string">'weekend'</span>, <span class="string">'type'</span>: <span class="string">'exhibition'</span>}</span><br><span class="line">    <span class="comment"># 发送请求</span></span><br><span class="line">    response = requests.get(URL_GET, params=params)</span><br><span class="line">    <span class="comment"># 处理响应</span></span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;Response Headers:'</span>)</span><br><span class="line">    print(response.headers)</span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;Status Code:'</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;Response Body:'</span>)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Use params requests:'</span>)</span><br><span class="line">    use_params_requests()</span><br></pre></td></tr></tbody></table></figure>

<p>网络图片爬取及存储</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''r.content  #表示返回内容的二进制格式'''</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">new_folder = <span class="string">'./Picture/'</span>  <span class="comment"># 相对路径</span></span><br><span class="line">url = <span class="string">'http://img0.dili360.com/ga/M00/02/AB/wKgBzFQ26i2AWujSAA_-xvEYLbU441.jpg@!rw9'</span></span><br><span class="line">path = new_folder + url.split(<span class="string">'/'</span>)[<span class="number">-1</span>].split(<span class="string">'@'</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(new_folder):</span><br><span class="line">        os.mkdir(new_folder)  <span class="comment"># 创建新目录</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line"></span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        <span class="comment"># 如何将二进制转化为图片保存</span></span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment"># 新建wKgBzFQ26i2AWujSAA_-xvEYLbU441.jpg</span></span><br><span class="line">            f.write(r.content)</span><br><span class="line">            f.close()</span><br><span class="line">            print(<span class="string">'图片保存成功'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'文件已存在'</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"爬取失败"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>百度/360搜索关键字</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#实例3：爬取搜索页面</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    kw = {<span class="string">'wd'</span>: <span class="string">'python'</span>}</span><br><span class="line">    r = requests.get(<span class="string">'https://www.baidu.com/s'</span>, params=kw)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    print(len(r.text))  <span class="comment"># 227</span></span><br><span class="line">    <span class="comment"># r.request.url  返回的是百度安全验证的链接？</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"爬取失败"</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    kw = {<span class="string">'q'</span>: <span class="string">'python'</span>}  <span class="comment"># 360搜索的关键字的键为q</span></span><br><span class="line">    r = requests.get(<span class="string">'https://www.so.com/s'</span>, params=kw)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    print(len(r.text))  <span class="comment">#257468</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"爬取失败"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>添加headers和查询参数</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">kw = {<span class="string">'wd'</span>:<span class="string">'python'</span>}</span><br><span class="line">headers = {<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36'</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment"># params 接收一个字典或者字符串的查询参数，字典类型自动转换为url编码，不需要urlencode()</span></span><br><span class="line">response = requests.get(<span class="string">"http://www.baidu.com/s?"</span>, params = kw, headers = headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看响应内容，response.text 返回的是Unicode格式的数据</span></span><br><span class="line"><span class="keyword">print</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看响应内容，response.content返回的字节流数据</span></span><br><span class="line"><span class="keyword">print</span> response.content</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看完整url地址</span></span><br><span class="line"><span class="keyword">print</span> response.url</span><br><span class="line"></span><br><span class="line"><span class="comment"># # 查看响应头部字符编码</span></span><br><span class="line"><span class="keyword">print</span> response.encoding</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看响应码</span></span><br><span class="line"><span class="keyword">print</span> response.status_code</span><br></pre></td></tr></tbody></table></figure>

<p>使用代理</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = {<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36'</span>}</span><br><span class="line"><span class="comment"># 根据协议类型，选择不同的代理</span></span><br><span class="line">proxies = {</span><br><span class="line">  <span class="string">"http"</span>: <span class="string">"http://119.28.152.208:80"</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">"http://www.baidu.com/"</span>, proxies = proxies,headers=headers)</span><br><span class="line"><span class="keyword">print</span> response.text</span><br></pre></td></tr></tbody></table></figure>

<p>私密代理验证</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = {<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36'</span>}</span><br><span class="line"></span><br><span class="line">proxy = { <span class="string">"http"</span>: <span class="string">"name:pwd@ip:port"</span> }</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">"http://www.baidu.com/"</span>, proxies = proxy,headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> response.text</span><br></pre></td></tr></tbody></table></figure>

<p>web客户端验证</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">auth=(<span class="string">'test'</span>, <span class="string">'123456'</span>)</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://192.168.xxx.xx'</span>, auth = auth)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> response.text</span><br></pre></td></tr></tbody></table></figure>

<p>session</p>
<p>在 requests 里，session对象是一个非常常用的对象，这个对象代表一次用户会话：从客户端浏览器连接服务器开始，到客户端浏览器与服务器断开。</p>
<p>会话能让我们在跨请求时候保持某些参数，比如在同一个 Session 实例发出的所有请求之间保持 cookie 。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建session对象，可以保存Cookie值</span></span><br><span class="line">ssion = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 处理 headers</span></span><br><span class="line">headers = {<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36'</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 需要登录的用户名和密码</span></span><br><span class="line">data = {<span class="string">"email"</span>:<span class="string">"158xxxxxxxx"</span>, <span class="string">"password"</span>:<span class="string">"pythonxxxxxxx"</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 发送附带用户名和密码的请求，并获取登录后的Cookie值，保存在ssion里</span></span><br><span class="line">ssion.post(<span class="string">"http://www.renren.com/PLogin.do"</span>, data = data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. ssion包含用户登录后的Cookie值，可以直接访问那些登录后才可以访问的页面</span></span><br><span class="line">response = ssion.get(<span class="string">"http://zhibo.renren.com/news/108"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 打印响应内容</span></span><br><span class="line"><span class="keyword">print</span> response.text</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/socket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/socket/" class="post-title-link" itemprop="url">socket</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-10 02:48:35" itemprop="dateModified" datetime="2021-05-10T02:48:35Z">2021-05-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>socket 模拟 文件下载器</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_file_2_client</span>(<span class="params">conn, addr</span>):</span></span><br><span class="line">    <span class="comment"># 1.读取客户端请求</span></span><br><span class="line">    file_name = conn.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    print(<span class="string">'客户端[%s]要下载的文件名：%s'</span> % (str(addr[<span class="number">0</span>]), file_name))</span><br><span class="line">    file_content = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># 2.打开文件读取数据</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = open(file_name, <span class="string">'rb'</span>)</span><br><span class="line">        file_content = f.read()</span><br><span class="line">        f.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'文件不存在'</span>)</span><br><span class="line">    <span class="comment"># 3.发送文件给客户端</span></span><br><span class="line">    <span class="keyword">if</span> file_content:</span><br><span class="line">        conn.send(file_content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1.创建套接字</span></span><br><span class="line">    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    <span class="comment"># 2.绑定监听</span></span><br><span class="line">    server.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">    server.listen(<span class="number">128</span>)</span><br><span class="line">    print(<span class="string">'------服务器连接成功------'</span>)</span><br><span class="line">    <span class="comment"># 3.接收数据，生成新的套接字</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr = server.accept()</span><br><span class="line">        print(addr)</span><br><span class="line">        <span class="comment"># 4.调用发送文件函数</span></span><br><span class="line">        send_file_2_client(conn, addr)</span><br><span class="line">        <span class="comment"># 5.关闭套接字</span></span><br><span class="line">        conn.close()</span><br><span class="line">    server.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>
<p>客户端代码</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1.创建套接字</span></span><br><span class="line">    client = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    <span class="comment"># 2.获取服务器ip port 并连接</span></span><br><span class="line">    client.connect((<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>))</span><br><span class="line">    print(<span class="string">'-------连接成功-------'</span>)</span><br><span class="line">    <span class="comment"># 3.获取下载文件的名字并发送给服务器</span></span><br><span class="line">    file_name = input(<span class="string">'请输入要下载的文件名：'</span>)</span><br><span class="line">    client.send(file_name.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="comment"># 4.接收文件中的数据</span></span><br><span class="line">    recv_data = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="comment"># 5.保存接收到的数据并保存到文件中</span></span><br><span class="line">    <span class="keyword">if</span> recv_data:</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'new'</span>+file_name,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(recv_data)</span><br><span class="line">    <span class="comment"># 6.关闭套接字</span></span><br><span class="line">    client.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>
<p>同级目录下先准备好一个文件当作服务端文件，下载本地后拼接新的名字，如果要下载的文件不存在会提示报错！</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/sort-sorted/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/sort-sorted/" class="post-title-link" itemprop="url">sort sorted</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-09 04:08:15" itemprop="dateModified" datetime="2021-07-09T04:08:15Z">2021-07-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="list-sort"><a href="#list-sort" class="headerlink" title="list.sort()"></a><code>list.sort()</code></h1><p>只是为列表定义的，返回的是对已经存在的列表进行操作，没有新建列表</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>]</span><br><span class="line">a.sort()  <span class="comment"># sort返回的是对已经存在的列表进行操作</span></span><br><span class="line">print(a)  <span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line">print([<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>].sort())  <span class="comment"># None sort返回的是对已经存在的列表进行操作，没有新建列表</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>sorted(iterable, key=None, reverse=False)</code><br>返回的是一个新的对所有可迭代的对象进行排序操作的列表，而不是在原来的基础上进行的操作。<br>iterable – 可迭代对象。<br>key – 用来进行比较的元素，只有一个参数，具体的函数的参数就是取自于可迭代对象中，<br>指定可迭代对象中的一个元素来进行排序。<br>Key参数/键函数<br>从python2.4开始，list.sort()和sorted()函数增加了key参数来指定在进行比较前要在每个列表元素上调用的函数（或其他可调用对象）。<br>key 形参的值应该是个函数（或其他可调用对象），它接受一个参数并返回一个用于排序的键。 这种机制速度很快，因为对于每个输入记录只会调用一次键函数。</p>
<p>reverse – 排序规则，reverse = True 降序 ，reverse = False 升序（默认）。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">example_list = [<span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">result_list = sorted(example_list)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [0, 1, 2, 3, 4, 5, 6, 7]默认升序</span></span><br><span class="line">result_list = sorted(example_list, reverse=<span class="literal">True</span>)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [7, 6, 5, 4, 3, 2, 1, 0] 反转降序</span></span><br><span class="line">result_list = sorted(example_list, key=<span class="keyword">lambda</span> x: x * <span class="number">-1</span>)</span><br><span class="line">print(result_list)</span><br><span class="line"><span class="comment"># [7, 6, 5, 4, 3, 2, 1, 0]</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="将列表-1-2-3-4-5-6-7-8-9-按照元素与5距离从小到大进行排序"><a href="#将列表-1-2-3-4-5-6-7-8-9-按照元素与5距离从小到大进行排序" class="headerlink" title="将列表[1, 2, 3, 4, 5, 6, 7, 8, 9]按照元素与5距离从小到大进行排序"></a>将列表[1, 2, 3, 4, 5, 6, 7, 8, 9]按照元素与5距离从小到大进行排序</h2><p>法一</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(sorted([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], key=<span class="keyword">lambda</span> x: abs(<span class="number">5</span> - x)))  </span><br><span class="line"><span class="comment"># [5, 4, 6, 3, 7, 2, 8, 1, 9]</span></span><br></pre></td></tr></tbody></table></figure>

<p>法二</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> abs(<span class="number">5</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(sorted(list, key=run))  <span class="comment"># [5, 4, 6, 3, 7, 2, 8, 1, 9]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(sorted({<span class="number">1</span>: <span class="string">'D'</span>, <span class="number">2</span>: <span class="string">'B'</span>, <span class="number">3</span>: <span class="string">'B'</span>, <span class="number">4</span>: <span class="string">'E'</span>, <span class="number">5</span>: <span class="string">'A'</span>}))</span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line">print(sorted({<span class="number">1</span>: <span class="string">'D'</span>, <span class="number">2</span>: <span class="string">'B'</span>, <span class="number">3</span>: <span class="string">'B'</span>, <span class="number">4</span>: <span class="string">'E'</span>, <span class="number">5</span>: <span class="string">'A'</span>}, key=<span class="keyword">lambda</span> x: x * <span class="number">-1</span>))</span><br><span class="line"><span class="comment"># [5, 4, 3, 2, 1]</span></span><br></pre></td></tr></tbody></table></figure>

<p>通过key指定的内置函数来</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照小写字母排序</span></span><br><span class="line">print(sorted(<span class="string">"This is a test string from Andrew"</span>.split(), key=str.lower))</span><br><span class="line"><span class="comment"># ['a', 'Andrew', 'from', 'is', 'string', 'test', 'This']</span></span><br><span class="line"></span><br><span class="line">print(sorted([<span class="string">"adf"</span>, <span class="string">"Adfdg"</span>, <span class="string">"aDfgbdfafg"</span>, <span class="string">"Gahgfh"</span>], key = str.lower)) <span class="comment">#输出 ['adf', 'Adfdg', 'aDfgbdfafg', 'Gahgfh']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把数组按照长度大小进行排序，只需设置key等于一个函数即可</span></span><br><span class="line">sorted([<span class="string">"adf"</span>, <span class="string">"Adfdg"</span>, <span class="string">"aDfgbdfafg"</span>, <span class="string">"Gahgfh"</span>], key = len) </span><br><span class="line"><span class="comment">#输出 ['adf', 'adfdg', 'gahgfh', 'adfgbdfafg']</span></span><br></pre></td></tr></tbody></table></figure>

<p>一种常见的模式是使用对象的一些索引作为键对复杂对象进行排序。例如：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>student_tuples = [</span><br><span class="line">        (<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>),</span><br><span class="line">        (<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>),</span><br><span class="line">        (<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>),</span><br><span class="line">]</span><br><span class="line"><span class="comment"># sort by age</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(student_tuples, key=<span class="keyword">lambda</span> student: student[<span class="number">2</span>])</span><br><span class="line">[(<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>), (<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>), (<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>)]</span><br></pre></td></tr></tbody></table></figure>

<p>同样的技术也适用拥有命名属性的对象，例如：</p>
<p>在排序时, 可以用lambda表达式将对象map成keys<br>亦可以使用operator包中的attrgetter和itemgetter函数以提高效率</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, grade, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.grade = grade</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> repr((self.name, self.grade, self.age))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"{}-{}-{}"</span>.format(self.name, self.grade, self.age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立一组Student对象</span></span><br><span class="line">students = [</span><br><span class="line">    Student(<span class="string">'jane'</span>, <span class="string">'B'</span>, <span class="number">12</span>),</span><br><span class="line">    Student(<span class="string">'john'</span>, <span class="string">'A'</span>, <span class="number">15</span>),</span><br><span class="line">    Student(<span class="string">'dave'</span>, <span class="string">'B'</span>, <span class="number">10</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">print(sorted(students, key=<span class="keyword">lambda</span> o: o.age))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line">students.sort(key=<span class="keyword">lambda</span> x: x.age)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> students:</span><br><span class="line">    print(item)</span><br><span class="line"><span class="comment"># dave-B-10</span></span><br><span class="line"><span class="comment"># jane-B-12</span></span><br><span class="line"><span class="comment"># john-A-15</span></span><br><span class="line"></span><br><span class="line">students.sort(key=<span class="keyword">lambda</span> x: x.grade)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> students:</span><br><span class="line">    print(item)</span><br><span class="line"><span class="comment"># john-A-15</span></span><br><span class="line"><span class="comment"># dave-B-10</span></span><br><span class="line"><span class="comment"># jane-B-12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter</span><br><span class="line"></span><br><span class="line">print(sorted(students, key=itemgetter(<span class="number">2</span>)))</span><br><span class="line"><span class="comment"># TypeError: 'Student' object is not subscriptable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对students按照年龄排序</span></span><br><span class="line">print(sorted(students, key=attrgetter(<span class="string">'age'</span>)))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Operator 模块功能允许多级排序。 先按age再按grade排序</span></span><br><span class="line">print(sorted(students, key=attrgetter(<span class="string">'age'</span>, <span class="string">'grade'</span>)))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例如，要按 grade 降序然后 age 升序对学生数据进行排序，请先 age 排序，然后再使用 grade 排序：</span></span><br><span class="line"><span class="comment"># sort on secondary key</span></span><br><span class="line">s = sorted(students, key=attrgetter(<span class="string">'age'</span>))</span><br><span class="line"><span class="comment"># now sort on primary key, descending</span></span><br><span class="line">print(sorted(s, key=attrgetter(<span class="string">'grade'</span>), reverse=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象为一个包装函数，该函数能接受一个列表以及字段和顺序的元组，以对它们进行多重排序。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multisort</span>(<span class="params">xs, specs</span>):</span></span><br><span class="line">    <span class="keyword">for</span> key, reverse <span class="keyword">in</span> reversed(specs):</span><br><span class="line">        xs.sort(key=attrgetter(key), reverse=reverse)</span><br><span class="line">    <span class="keyword">return</span> xs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(multisort(list(students), ((<span class="string">'grade'</span>, <span class="literal">True</span>), (<span class="string">'age'</span>, <span class="literal">False</span>))))</span><br><span class="line"><span class="comment"># [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter, attrgetter</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'blackmatrix'</span></span><br><span class="line"></span><br><span class="line">get_name = <span class="keyword">lambda</span> user: user[<span class="string">'name'</span>]</span><br><span class="line"></span><br><span class="line">get_address = <span class="keyword">lambda</span> user: getattr(user, <span class="string">'address'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, address</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.address = address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">laowang = {<span class="string">'name'</span>: <span class="string">'老王'</span>, <span class="string">'address'</span>: <span class="string">'隔壁'</span>}</span><br><span class="line">laoli = User(<span class="string">'老李'</span>, <span class="string">'楼下'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># itemgetter('name') 和 get_name 作用是相同的</span></span><br><span class="line">    <span class="comment"># 都是接受一个对象，获取对象key为name的值</span></span><br><span class="line">    <span class="comment"># 主要用来替代只是为了获取value的lambda函数</span></span><br><span class="line">    print(itemgetter(<span class="string">'name'</span>)(laowang))  <span class="comment"># 老王</span></span><br><span class="line">    print(itemgetter(<span class="string">'address'</span>)(laowang))  <span class="comment"># 隔壁</span></span><br><span class="line">    print(get_name(laowang))  <span class="comment"># 老王</span></span><br><span class="line">    <span class="comment"># print(get_address(laowang))  # 'dict' object has no attribute 'address'  </span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 同样的，attrgetter('address')也是等同于get_address</span></span><br><span class="line">    <span class="comment"># 用来替代只为了获取attr的lambda函数</span></span><br><span class="line">    print(attrgetter(<span class="string">'address'</span>)(laoli))  <span class="comment"># 楼下</span></span><br><span class="line">    print(get_address(laoli))  <span class="comment"># 楼下</span></span><br></pre></td></tr></tbody></table></figure>


<p>多字段排序<br>按照第一个数从小到大排序，如果第一个数相同，就按第二个数从大到小。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [[<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">1</span>],(<span class="number">2</span>,<span class="number">8</span>),(<span class="number">2</span>,<span class="number">1</span>),(<span class="number">3</span>,<span class="number">4</span>)]</span><br><span class="line">sorted(a, key = <span class="keyword">lambda</span> x: (x[<span class="number">0</span>], -x[<span class="number">1</span>]))</span><br><span class="line"><span class="comment"># [(2, 8), [2, 3], (2, 1), (3, 4), [4, 1]]</span></span><br></pre></td></tr></tbody></table></figure>
<p>其实掌握自定义规则排序，多字段排序也就会了，因为它是自定义排序的子集！</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">array = [{</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"a"</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"b"</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"c"</span></span><br><span class="line">}]</span><br><span class="line"><span class="comment"># 法一</span></span><br><span class="line">array = sorted(array, key=<span class="keyword">lambda</span> x: x[<span class="string">"age"</span>])</span><br><span class="line">print(array)</span><br><span class="line"><span class="comment"># [{'age': 10, 'name': 'c'}, {'age': 20, 'name': 'a'}, {'age': 25, 'name': 'b'}]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line"><span class="comment"># def by_age(info):</span></span><br><span class="line"><span class="comment">#     array = [{"age": 20, "name": "a"}, {"age": 25, "name": "b"}, {"age": 10, "name": "c"}]</span></span><br><span class="line"><span class="comment">#     return array.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># l1 = sorted(array, key=by_age)</span></span><br><span class="line"><span class="comment"># print('***')</span></span><br><span class="line"><span class="comment"># print(l1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多列排序</span></span><br><span class="line"><span class="comment"># 先按照成绩降序排序，相同成绩的按照名字升序排序：</span></span><br><span class="line">d1 = [{</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'alice'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">38</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'bob'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">18</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'darl'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">28</span></span><br><span class="line">}, {</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'christ'</span>,</span><br><span class="line">    <span class="string">'score'</span>: <span class="number">28</span></span><br><span class="line">}]</span><br><span class="line">l = sorted(d1, key=<span class="keyword">lambda</span> x: (-x[<span class="string">'score'</span>], x[<span class="string">'name'</span>]))</span><br><span class="line">print(l)</span><br><span class="line"><span class="comment"># 输出结果：</span></span><br><span class="line"><span class="comment"># [{'name': 'alice', 'score': 38}, {'name': 'christ', 'score': 28}, {'name': 'darl', 'score': 28}, {'name': 'bob', 'score': 18}]</span></span><br><span class="line"></span><br><span class="line">dictionary = {<span class="string">'name'</span>: <span class="string">'Ashe'</span>, <span class="string">'age'</span>: <span class="number">18</span>, <span class="string">'city'</span>: <span class="string">'Guilin'</span>, <span class="string">'tel'</span>: <span class="string">'110'</span>}</span><br><span class="line">print(<span class="string">'---------'</span>)</span><br><span class="line"><span class="comment"># dict.items()结果是键值对元组</span></span><br><span class="line">print(dictionary.items())</span><br><span class="line"><span class="comment"># dict_items([('name', 'Ashe'), ('age', 18), ('city', 'Guilin'), ('tel', '110')])</span></span><br><span class="line"><span class="comment"># i[0]表示key i[1]表示value</span></span><br><span class="line">list = sorted(dictionary.items(), key=<span class="keyword">lambda</span> i: i[<span class="number">0</span>], reverse=<span class="literal">False</span>)  <span class="comment"># 不反转，即升序</span></span><br><span class="line">print(<span class="string">'sorted根据字典key排序'</span>, list)</span><br><span class="line">print(<span class="string">'-----'</span>)</span><br><span class="line">new_dict = {}</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> list:</span><br><span class="line">    new_dict[i[<span class="number">0</span>]] = i[<span class="number">1</span>]</span><br><span class="line">print(<span class="string">'new dict'</span>, new_dict)</span><br><span class="line">print(<span class="string">'***'</span>)</span><br><span class="line"><span class="comment"># list = sorted(dictionary.items(), key=lambda i: i[1], reverse=False)</span></span><br><span class="line"><span class="comment"># print('sorted根据字典value排序', list)</span></span><br><span class="line"><span class="comment"># new_dict = {}</span></span><br><span class="line"><span class="comment"># for i in list:</span></span><br><span class="line"><span class="comment">#     new_dict[i[0]] = i[1]</span></span><br><span class="line"><span class="comment"># print('***')</span></span><br><span class="line"><span class="comment"># print('new dict', new_dict)</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">L = [(<span class="string">'Bob'</span>, <span class="number">75</span>), (<span class="string">'Adam'</span>, <span class="number">92</span>), (<span class="string">'Bart'</span>, <span class="number">66</span>), (<span class="string">'Lisa'</span>, <span class="number">88</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_name</span>(<span class="params">info</span>):</span>  <span class="comment"># 名字排序</span></span><br><span class="line">    <span class="comment"># print(info[0])</span></span><br><span class="line">    <span class="keyword">return</span> info[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_grade</span>(<span class="params">info</span>):</span>  <span class="comment"># 成绩排序</span></span><br><span class="line">    <span class="keyword">return</span> info[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L1 = sorted(L, key=by_name)</span><br><span class="line">L2 = sorted(L, key=by_name, reverse=<span class="literal">True</span>)</span><br><span class="line">L3 = sorted(L, key=by_grade)</span><br><span class="line">L4 = sorted(L, key=by_grade, reverse=<span class="literal">True</span>)</span><br><span class="line">print(L1)</span><br><span class="line">print(L2)</span><br><span class="line">print(L3)</span><br><span class="line">print(L4)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight scheme"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="symbol">'Adam</span>', <span class="number">92</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>)]</span><br><span class="line">[(<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Adam</span>', <span class="number">92</span>)]</span><br><span class="line">[(<span class="symbol">'Bart</span>', <span class="number">66</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Adam</span>', <span class="number">92</span>)]</span><br><span class="line">[(<span class="symbol">'Adam</span>', <span class="number">92</span>), (<span class="symbol">'Lisa</span>', <span class="number">88</span>), (<span class="symbol">'Bob</span>', <span class="number">75</span>), (<span class="symbol">'Bart</span>', <span class="number">66</span>)]</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/turtle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/turtle/" class="post-title-link" itemprop="url">turtle</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:45" itemprop="dateModified" datetime="2021-04-02T12:24:45Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>turtle在屏幕上绘制图形<br>1.画布(canvas)<br>画布就是turtle为我们展开用于绘图区域默认大小(400, 300)，我们可以设置它的大小和初始位置。</p>
<p>2.画笔（pen）<br>2.1画笔的状态<br>在画布上，默认有一个坐标原点为画布中心的坐标轴，坐标原点上有一只面朝x轴正方向小乌龟。这里我们描述小乌龟时使用了两个词语：坐标原点(位置)，面朝x轴正方向(方向)， turtle绘图中，就是使用位置方向描述小乌龟(画笔)的状态。</p>
<p>2.2 画笔的属性<br>画笔(画笔的属性，颜色、画线的宽度等)</p>
<p>turtle.pensize()：设置画笔的宽度；<br>turtle.pencolor()：没有参数传入，返回当前画笔颜色，传入参数设置画笔颜色，可以是字符串如”green”,&nbsp;“red”,也可以是RGB&nbsp;3元组。<br>turtle.speed(speed)：设置画笔移动速度，画笔绘制的速度范围[0,10]整数，数字越大越快。<br>2.3 绘图命令<br>操纵海龟绘图有着许多的命令，这些命令可以划分为3种：一种为运动命令，一种为画笔控制命令，还有一种是全局控制命令。</p>
<p>2.3.1 画笔运动命令:</p>
<p>命令    说明<br>turtle.home()    将turtle移动到起点（0,0）和向东<br>turtle.speed(speed)    画笔绘制的速度范围[0,10]整数<br>turtle.forward(distance)    向当前画笔方向移动distance像素长<br>turtle.backward(distance)    向当前画笔相反方向移动distance像素长度<br>turtle.right(degree)    顺时针移动degree°<br>turtle.left(degree)    逆时针移动degree°<br>turtle.pendown()    移动时绘制图形放下笔,,默认绘制<br>turtle.penup()    移动时不绘制图形,提起笔，用于另起一个地方绘制时用<br>turtle.circle(r,extent,step)    绘制一个指定半径、弧度范围、阶数(正多边形)的圆<br>turtle.dot(diameter,color)    绘制一个指定直径和颜色的圆</p>
<p>绘制长方形</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line"></span><br><span class="line">turtle.pensize(<span class="number">4</span>)</span><br><span class="line">turtle.pencolor(<span class="string">'red'</span>)</span><br><span class="line"></span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.forward(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">turtle.mainloop()</span><br></pre></td></tr></tbody></table></figure>

<p>绘制奥运五环</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line">turtle.width(<span class="number">10</span>)</span><br><span class="line">turtle.color(<span class="string">"blue"</span>)</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"black"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">120</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"red"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">240</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"yellow"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">60</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line">turtle.color(<span class="string">"green"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">180</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle <span class="comment">#导入 turtle 模块</span></span><br><span class="line">turtle.showturtle() <span class="comment">#显示箭头</span></span><br><span class="line">turtle.write(<span class="string">"xy"</span>) <span class="comment">#写字符串</span></span><br><span class="line">turtle.forward(<span class="number">300</span>) <span class="comment">#前进 300 像素</span></span><br><span class="line">turtle.color(<span class="string">"red"</span>) <span class="comment">#画笔颜色改为 red</span></span><br><span class="line">turtle.left(<span class="number">90</span>) <span class="comment">#箭头左转 90 度</span></span><br><span class="line">turtle.forward(<span class="number">300</span>)</span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">50</span>) <span class="comment">#去坐标（0,50）</span></span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">turtle.penup() <span class="comment">#抬笔。这样，路径就不会画出来</span></span><br><span class="line">turtle.goto(<span class="number">0</span>,<span class="number">300</span>)</span><br><span class="line">turtle.pendown() <span class="comment">#下笔。这样，路径就会画出来</span></span><br><span class="line">turtle.circle(<span class="number">100</span>) <span class="comment">#画圆</span></span><br></pre></td></tr></tbody></table></figure>

<p>pentagram</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">turtle</span></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">time</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.pensize</span>(<span class="number">5</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.pencolor</span>(<span class="string">"yellow"</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.fillcolor</span>(<span class="string">"red"</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.begin_fill</span>()</span><br><span class="line"><span class="selector-tag">for</span> <span class="selector-tag">_</span> <span class="selector-tag">in</span> <span class="selector-tag">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="selector-tag">turtle</span><span class="selector-class">.forward</span>(<span class="number">200</span>)</span><br><span class="line">    <span class="selector-tag">turtle</span><span class="selector-class">.right</span>(<span class="number">144</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.end_fill</span>()</span><br><span class="line"><span class="selector-tag">time</span><span class="selector-class">.sleep</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.penup</span>()</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.goto</span>(-<span class="number">150</span>, -<span class="number">120</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.color</span>(<span class="string">"violet"</span>)</span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.write</span>(<span class="string">"Done"</span>, font=(<span class="string">'Arial'</span>, <span class="number">40</span>, <span class="string">'normal'</span>))</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">turtle</span><span class="selector-class">.mainloop</span>()</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/web-zi-dong-hua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/web-zi-dong-hua/" class="post-title-link" itemprop="url">Web自动化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-31 04:35:56" itemprop="dateModified" datetime="2021-07-31T04:35:56Z">2021-07-31</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Web自动化"><a href="#Web自动化" class="headerlink" title="Web自动化"></a>Web自动化</h2><ul>
<li>WEB自动化测试就是把在网页上的人工测试操作转化成用机<br>器、软件、程序来测试产品的过程</li>
<li>换言之，就是把“点点点”通过编程实现的测试手段</li>
</ul>
<p>为什么要学习Web自动化</p>
<ul>
<li>面向用户的“自动化”</li>
<li>弥补单元测试、接口测试的不足</li>
<li>取代部分重复枯燥的操作</li>
<li>测试岗位进阶的趋势</li>
</ul>
<p>完美WEB自动化的项目</p>
<ol>
<li>任务测试明确，不会频繁变动</li>
<li>每日构建后的测试验证</li>
<li>比较频繁的回归测试</li>
<li>软件系统界面稳定，变动少</li>
<li>软件维护周期长</li>
<li>被测软件系统开发比较规范，能够保证系统的可测试性</li>
<li>测试人员具备较强的编程能力</li>
<li>项目进度压力不太大</li>
</ol>
<p>WEB自动化面临的问题</p>
<ul>
<li>不稳定</li>
<li>难维护</li>
</ul>
<p>WEB自动化的改进</p>
<ul>
<li>更优秀的框架设计</li>
<li>更合理的维护方式</li>
<li>更稳健的测试环境</li>
</ul>
<p>DEFAULT_THROTTLE_RATES 可以使用second , minute , hour或day来指明周期，也可以在具体视图中通过throttle_classes属性来配置,如</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/yaml/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/yaml/" class="post-title-link" itemprop="url">yaml</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-27 05:13:24" itemprop="dateModified" datetime="2021-05-27T05:13:24Z">2021-05-27</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="yaml-YAML-Ain’t-Markup-Language"><a href="#yaml-YAML-Ain’t-Markup-Language" class="headerlink" title="yaml YAML Ain’t Markup Language"></a>yaml YAML Ain’t Markup Language</h1><p>YAML 不是标记语言 文本文件  它是一种数据格式语言，并且是JSON的超集。<br>与 JSON 不同，它可以存储更复杂的对象并引用其自己的元素，还可以编写注释，使其特别适合编写一些定义好不常修改的内容配置文件，</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyyaml</span><br></pre></td></tr></tbody></table></figure>
<p>不规定某一种文件或者key它对应的数据类型，从python的角度来说是字符串，但不需要加引号，当我们进行load的时候，python会对它进行额外的数据类型分析<br>yaml文件在读取后得到的是字典类型的数据</p>
<p>注意格式<code>muke.yaml</code></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># key-value</span></span><br><span class="line"><span class="attr">url:</span></span><br><span class="line">  <span class="string">https://www.imooc.com/</span></span><br><span class="line"><span class="comment"># 列表</span></span><br><span class="line"><span class="attr">types:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前沿</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">后端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">移动端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">云计算</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">运维</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ui</span></span><br><span class="line"><span class="comment"># 字典</span></span><br><span class="line"><span class="attr">python:</span></span><br><span class="line">  <span class="attr">web:</span> <span class="string">django</span></span><br><span class="line">  <span class="attr">spader:</span> <span class="string">bs5</span></span><br><span class="line"><span class="attr">a:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">b:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">c:</span> [<span class="string">a</span>, <span class="string">b</span>, <span class="string">c</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    result = yaml.load(data, Loader=yaml.FullLoader)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    result = read(<span class="string">'muke.yaml'</span>)  <span class="comment"># 传递相对路径</span></span><br><span class="line">    print(result)</span><br><span class="line">    <span class="comment"># {'url': 'https://www.imooc.com/', 'types': ['前沿', '前端', '后端', '移动端', '云计算', '运维', 'ui'], 'python': {'web': 'django', 'spader': 'bs5'}, 'a': 1, 'b': 2, 'c': ['a', 'b', 'c']} </span></span><br><span class="line">    print(type(result))</span><br><span class="line">    <span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">document = <span class="string">"""</span></span><br><span class="line"><span class="string">    a: 1</span></span><br><span class="line"><span class="string">    b:</span></span><br><span class="line"><span class="string">    c: 3</span></span><br><span class="line"><span class="string">    d: 4</span></span><br><span class="line"><span class="string">    ...: </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">print(yaml.load(document, Loader=yaml.FullLoader))</span><br><span class="line"><span class="comment"># {'a': 1, 'b': None, 'c': 3, 'd': 4, '...': None}</span></span><br><span class="line">print(type(yaml.load(document, Loader=yaml.FullLoader)))</span><br><span class="line"><span class="comment"># &lt;class 'dict'&gt;</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(dir(yaml))</span><br><span class="line"><span class="comment"># ['AliasEvent', 'AliasToken', 'AnchorToken', 'BaseDumper', 'BaseLoader', 'BlockEndToken', 'BlockEntryToken', 'BlockMappingStartToken', 'BlockSequenceStartToken', 'CBaseDumper', 'CBaseLoader', 'CDumper', 'CFullLoader', 'CLoader', 'CSafeDumper', 'CSafeLoader', 'CUnsafeLoader', 'CollectionEndEvent', 'CollectionNode', 'CollectionStartEvent', 'DirectiveToken', 'DocumentEndEvent', 'DocumentEndToken', 'DocumentStartEvent', 'DocumentStartToken', 'Dumper', 'Event', 'FlowEntryToken', 'FlowMappingEndToken', 'FlowMappingStartToken', 'FlowSequenceEndToken', 'FlowSequenceStartToken', 'FullLoader', 'KeyToken', 'Loader', 'MappingEndEvent', 'MappingNode', 'MappingStartEvent', 'Mark', 'MarkedYAMLError', 'Node', 'NodeEvent', 'SafeDumper', 'SafeLoader', 'ScalarEvent', 'ScalarNode', 'ScalarToken', 'SequenceEndEvent', 'SequenceNode', 'SequenceStartEvent', 'StreamEndEvent', 'StreamEndToken', 'StreamStartEvent', 'StreamStartToken', 'TagToken', 'Token', 'UnsafeLoader', 'ValueToken', 'YAMLError', 'YAMLLoadWarning', 'YAMLObject', 'YAMLObjectMetaclass', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__', '__version__', '__with_libyaml__', '_warnings_enabled', 'add_constructor', 'add_implicit_resolver', 'add_multi_constructor', 'add_multi_representer', 'add_path_resolver', 'add_representer', 'compose', 'compose_all', 'composer', 'constructor', 'cyaml', 'dump', 'dump_all', 'dumper', 'emit', 'emitter', 'error', 'events', 'full_load', 'full_load_all', 'io', 'load', 'load_all', 'load_warning', 'loader', 'nodes', 'parse', 'parser', 'reader', 'representer', 'resolver', 'safe_dump', 'safe_dump_all', 'safe_load', 'safe_load_all', 'scan', 'scanner', 'serialize', 'serialize_all', 'serializer', 'tokens', 'unsafe_load', 'unsafe_load_all', 'warnings']</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/san-yuan-biao-da-shi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/san-yuan-biao-da-shi/" class="post-title-link" itemprop="url">python 三元表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 03:01:51" itemprop="dateModified" datetime="2021-05-01T03:01:51Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>用简单的一行快速判断，而不是使用复杂的多行if语句。<br><code>condition_is_true if condition else condition_is_false</code><br>如果a&gt;b的结果为真，h=”变量1”,<br>如果为假，h=”变量2”</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">print(<span class="string">"变量1"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"变量2"</span>)  <span class="comment"># 变量2</span></span><br><span class="line">print(<span class="string">"True"</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="string">"False"</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="literal">True</span> <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> <span class="literal">False</span>)  <span class="comment"># False</span></span><br><span class="line">print(a &gt; b)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">h = <span class="string">""</span></span><br><span class="line">h = a - b <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> a + b</span><br><span class="line">print(h)  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">is_fat = <span class="literal">True</span></span><br><span class="line">state = <span class="string">"fat"</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">"not fat"</span></span><br><span class="line">print(state)  <span class="comment"># fat</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/shi-wu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/shi-wu/" class="post-title-link" itemprop="url">事务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 03:00:23" itemprop="dateModified" datetime="2021-05-01T03:00:23Z">2021-05-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Relational Database Management System 关系数据库管理系统<br>RDBMS=SQL语句+事务(ACID)</p>
<p>事务transaction：</p>
<ul>
<li>是数据库并发控制的基本单位</li>
<li>是一个或者多个sql语句、数据库逻辑操作组成的集合</li>
</ul>
<p>默认，mysql执行每条sql语句都会自动开启和提交事务<br>为了让多条sql语句纳入到一个事务之下，可以手动管理事务<br>START TRANSACTION;</p>
<p>例子转账了。假如小明要给小红转账1000元，这个转账会涉及到两个关键操作就是：将小明的余额减少1000元，将小红的余额增加1000元。万一在这两个操作之间突然出现错误比如银行系统崩溃，导致小明余额减少而小红的余额没有增加，这样就不对了。事务就是保证这两个关键操作要么都成功，要么都要失败。</p>
<ol>
<li>原子性(Atomicity)事务是最小的执行单位，不允许分割。一个事务中所有操作要么全部完成，要么全部失败。事务执行后，不允许停留在中间某个状态， </li>
<li>一致性(consistency)：事务开始和结束之后数据完整性没有被破坏，执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是相同的；</li>
<li>隔离性(Isolation)：允许多个事务同时对数据库修改和读写，事务不受其他并发事务的影响，如同在给定的时间内，该事务时数据库唯一运行的事务，各并发事务之间数据库是独立的；</li>
<li>持久性(Durability):事务一旦提交，它对数据库中数据的改变是持久的。即便发生宕机数据库发生故障也不应该对其有任何影响，仍然可以依靠事务日志完成数据的持久化</li>
</ol>
<p>事务与回滚：<br>COMMIT； 让redo日志与数据文件同步，事务的所有操作都会被持久化到数据库里面，提交了就会把事务操作下的结果同步<br>ROLLBACK;把该事务所有的数据都打上标记，这些数据全都不会同步到数据文件里面，不存在中间状态的数据<br>回滚：多个逻辑中某个操作出错，回到初始状态，一旦执行失败需要回滚操作来保持之前数据库的完整性）<br>rollback就是数据库里做修改后&nbsp;（update，insert，delete）未commit&nbsp;之前，使用rollback可以恢复数据到修改之前</p>
<p>事务处理<br>MySQL提供事务处理的表引擎, InnoDB<br>服务器层不管理事务，由下层的引擎实现，所以同一个事务中，使用多种存储引擎不靠谱。比如在操纵两张表时候做一个事务，不能是一张表InnoDB另一张表MyISAM，这样事务是做不成功的。需要两张表都是InnoDB。</p>
<p>在非事务的表上执行事务操作 MySQL不会发出提醒，也不会报错，如：在MyISAM表上做事务处理。</p>
<p>举例说明数据库事务的使用场景以及注意事项<br>在操纵(增删改)重要数据时，如：钱款等。需要开启事务。<br>注意事项：事务的隔离级别越高安全性就越高，但并发就越低，这就需要选择合适的隔离级别。</p>
<p>事务的并发控制可能产生哪些问题<br>在典型的应用程序中，多个事务并发运行，经常会操作相同的数据来完成各自的任务（多个用户对统一数据进行操作）。并发虽然是必须的，如果不对事务进行并发控制,可能会产生四种异常情况</p>
<ul>
<li><p>幻读(phantom read):在同一个事务第二次查出现第一次没有的结果，说明别的事务已经插入一些数据<br>幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，</p>
</li>
<li><p>非重复读( nonrepeatable read):一个事务重复读两次得到不同结果，说明读取操作结果是不可重复的。<br>指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</p>
</li>
<li><p>脏读(dirty read):一个事务读取到另一个事务没有提交的修改，就是当另一个事务它还没有提交修改一个事务就读取到了修改。当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。</p>
</li>
<li><p>丢失修改(lost update)：并发写入造成其中一些修改丢失。<br>指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。</p>
</li>
</ul>
<p>Transaction 示例：Python的ORM框架SQLALchemy代码</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">session.begin()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    item1 =session.query(Item).get(<span class="number">1</span>)</span><br><span class="line">    item2 =session.query(Item).get(<span class="number">2</span>)</span><br><span class="line">    item1.foo = <span class="string">'bar'</span></span><br><span class="line">    item2.bar = <span class="string">'foo'</span></span><br><span class="line">    session.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    session.rollback()</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></tbody></table></figure>

<p>把10部门中manager员工调往20部门，其他岗位的员工调往30部门，然后删除10部门 </p>
<p>为了解决并发控制可能产生的异常问题，数据库定义了<br>四种事务的隔离级别</p>
<ul>
<li><p>读未提交(read uncommitted)：别的事务可以读取到未提交改变</p>
</li>
<li><p>读已提交(read committed)：只能读取已经提交的数据</p>
</li>
<li><p>可重复读(repeatable read)：同一个事务先后查询结果一样，Mysql InnoDB默认实现可重复读级别。</p>
</li>
<li><p>可串行化(Serializable)：事务完全串行化的执行，隔离级别最高，执行效率最低。相当于把数据库在一个事务执行的时候完全锁住，等它执行完才能执行下一个。</p>
<p>  ① 读取未提交( Read Uncommitted )</p>
<pre><code>   读未提交是隔离级别最低的一种事务级别。在这种隔离级别下，一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据，这就是脏读（Dirty Read）。
</code></pre>
<p> ② 读取已提交( Read Committed )</p>
<pre><code>  在 Read Committed 隔离级别下，一个事务可能会遇到不可重复读（Non Repeatable Read）的问题。不可重复读是指，在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致。
</code></pre>
<p>③ 可重复读取( Repeatable Read )</p>
<pre><code>  在Repeatable Read隔离级别下，一个事务可能会遇到幻读（Phantom Read）的问题。幻读是指，在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。幻读就是没有读到的记录，以为不存在，但其实是可以更新成功的，并且，更新成功后，再次读取，就出现了。
</code></pre>
<p>④ 可串行化、序列化( Serializable )</p>
<pre><code>  Serializable 是最严格的隔离级别。在Serializable隔离级别下，所有事务按照次序依次执行，因此，脏读、不可重复读、幻读都不会出现。

 虽然 Serializable 隔离级别下的事务具有最高的安全性，但是，由于事务是串行执行，所以效率会大大下降，应用程序的性能会急剧降低。如果没有特别重要的情景，一般都不会使用Serializable隔离级别。

  默认隔离级别：如果没有指定隔离级别，数据库就会使用默认的隔离级别。在MySQL中，如果使用 InnoDB，默认的隔离级别是Repeatable Read。
</code></pre>
</li>
</ul>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;<br>读取其他事务未提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;<br>只能读取其他事务提交的数据</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>事务在执行中反复读取数据，得到的结果是一致的，不会受其他事务影响</p>
<p>START TRANSACTION;<br>UPDATE t_emp set sal=1;<br>COMMIT;<br>set SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ;<br>START TRANSACTION;<br>SELECT empno, ename, sal FROM t_emp;<br>COMMIT;<br>ROLLBACK;</p>
<p>set SESSION TRANSACTION ISOLATION LEVEL live SERIALIZABLE;<br>由于事务并发执行所带来的各种问题，前三种隔离级别只适用在某些业务场景中，但是序列化的隔离性，让事务逐一执行，就不会产生上述问题了。</p>
<p>如何解决高并发场景下的插入重复<br>高并发场景下，写入数据库会有数据重复问题</p>
<ol>
<li><p>使用数据库的唯一索引，就是不允许某些字段重复，如果重复数据库就会抛出一个异常出来，这样就知道那些数据重复了，直接把这个异常忽略掉就可以，这样就可以实现非重复插入。虽然好用但有些场景没有办法实现，如已经做了分库分表，这个时候就要使用队列去执行一个异步写入。</p>
</li>
<li><p>使用队列异步写入，其实很多高并发问题都可以通过缓存和队列去解决。</p>
</li>
<li><p>使用 redis 等实现分布式锁，这样就可以在插入的时候持有这个锁，插入完成之后再去释放这个锁。</p>
</li>
</ol>
<p>并发控制也是通过行锁或者表锁实现的。通过事务再读取或者写入的时候加入一些表锁或者行锁就可以实现不同并发控制的等级。</p>
<p>悲观锁是先获取锁再进行操作。一锁二查三更新 select for update</p>
<p>乐观锁是先修改，更新的时候发现数据已经变了就回滚(check and set)，乐观锁一般通过版本号或者时间戳实现</p>
<p>使需要根据响应速度、冲突频率、重试代价来判断使用哪一种</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/22/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><a class="extend next" rel="next" href="/page/24/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
