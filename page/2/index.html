<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/2/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">336</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/07/go-jie-gou-ti-de-can-shu-chuan-di-he-fang-fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/07/go-jie-gou-ti-de-can-shu-chuan-di-he-fang-fa/" class="post-title-link" itemprop="url">go结构体的参数传递和方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-06 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-06T16:21:41Z">2021-07-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-09 13:06:16" itemprop="dateModified" datetime="2021-07-09T13:06:16Z">2021-07-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>变量赋值本质上是一次内存浅拷贝，<br>切片的赋值是拷贝了切片头，<br>字符串的赋值是拷贝了字符串的头部，<br>数组的赋值呢是直接拷贝整个数组。</p>
<h2 id="结构体的参数传递"><a href="#结构体的参数传递" class="headerlink" title="结构体的参数传递"></a>结构体的参数传递</h2><p>函数调用时参数传递结构体变量，Go 语言支持值传递，也支持指针传递。<br>值传递涉及到结构体字段的浅拷贝，指针传递会共享结构体内容，只会拷贝指针地址，规则上和赋值是等价的。</p>
<p>结构体的接收者有两种形式 1. 值传递 2. 指针传递 如果你想改结构体的值 如果结构体的数据很大</p>
<p>通过值传递，在函数里面修改结构体的状态不会影响到原有结构体的状态，函数内部的逻辑并没有产生任何效果。通过指针传递就不一样。</p>
<p>结构体的值类型和指针类型访问内部字段和方法在形式上是一样的。这点不同于 C++ 语言，在 C++ 语言里，值访问使用句点 . 操作符，而指针访问需要使用箭头 -&gt; 操作符。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数的接收者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Course)</span> <span class="title">printCourseInfo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"课程名:%s, 课程价格: %d, 课程的地址:%s\n"</span>, c.Name, c.Price, c.Url)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Course)</span> <span class="title">setPrice</span><span class="params">(price <span class="keyword">int</span>)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = price</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setPrice1</span><span class="params">(c Course)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = <span class="number">800</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Course)</span> <span class="title">setPricePoint</span><span class="params">(price <span class="keyword">int</span>)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = price <span class="comment">// 等同于(*c).Price = price</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setPricePoint1</span><span class="params">(c *Course)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = <span class="number">800</span> <span class="comment">// 等同于(*c).Price = 800</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//结构体方法， 达到了封装数据和封装方法的效果</span></span><br><span class="line">    c11 := Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line">    c11.printCourseInfo()       <span class="comment">// 课程名:scrapy, 课程价格: 200, 课程的地址:https://www.imooc.com</span></span><br><span class="line">    Course.printCourseInfo(c11) <span class="comment">// 课程名:scrapy, 课程价格: 200, 课程的地址:https://www.imooc.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结构体是值传递，不改变原来的值</span></span><br><span class="line">    c11.setPrice(<span class="number">200</span>)</span><br><span class="line">    <span class="comment">//Course.setPrice(c11, 200)</span></span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 110</span></span><br><span class="line">    fmt.Println(c11)       <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line"></span><br><span class="line">    setPrice1(c11)</span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 110</span></span><br><span class="line">    fmt.Println(c11)       <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line"></span><br><span class="line">    (&amp;c11).setPrice(<span class="number">300</span>)   <span class="comment">//修改c10的price? 为什么呢？ 语法糖 函数参数的传递是怎么传递的？</span></span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 110</span></span><br><span class="line"></span><br><span class="line">    c11.setPricePoint(<span class="number">200</span>)</span><br><span class="line">    <span class="comment">//Course.setPricePoint(c11, 200)</span></span><br><span class="line">    fmt.Println(c11.Price)    <span class="comment">// 200</span></span><br><span class="line">    (&amp;c11).setPricePoint(<span class="number">300</span>) <span class="comment">//修改c10的price? 为什么呢？ 语法糖 函数参数的传递是怎么传递的？</span></span><br><span class="line">    fmt.Println(c11.Price)    <span class="comment">// 300</span></span><br><span class="line"></span><br><span class="line">    (&amp;c11).setPricePoint(<span class="number">400</span>) <span class="comment">//修改c10的price? 为什么呢？ 语法糖 函数参数的传递是怎么传递的？</span></span><br><span class="line">    <span class="comment">// 结构体是值传递</span></span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 400</span></span><br><span class="line"></span><br><span class="line">    setPricePoint1(&amp;c11)</span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 800</span></span><br><span class="line">    fmt.Println(c11)       <span class="comment">// {scrapy 800 https://www.imooc.com}</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="结构体方法"><a href="#结构体方法" class="headerlink" title="结构体方法"></a>结构体方法</h2><p>Go 语言不是面向对象的语言，它里面不存在类的概念，结构体正是类的替代品。<br>类可以附加很多成员方法，结构体也可以。<br>结构体的方法只能和结构体在同一个包中</p>
<p>Go 语言不喜欢类型的隐式转换，所以需要将整形显示转换成浮点型，不是很好看，不过这就是 Go 语言的基本规则，显式的代码可能不够简洁，但是易于理解。<br>Go 语言的结构体方法里面没有 self 和 this 这样的关键字来指代当前的对象，它是用户自己定义的变量名称，通常我们都使用单个字母来表示。</p>
<p>Go 语言的方法名称也分首字母大小写，它的权限规则和字段一样，</p>
<ul>
<li>首字母大写就是公开方法，</li>
<li>首字母小写就是内部方法，只能归属于同一个包的代码才可以访问内部方法。</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"math"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> {</span><br><span class="line">    x <span class="keyword">int</span></span><br><span class="line">    y <span class="keyword">int</span></span><br><span class="line">    Radius <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 面积</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">Area</span><span class="params">()</span> <span class="title">float64</span></span> {</span><br><span class="line">    <span class="keyword">return</span> math.Pi * <span class="keyword">float64</span>(c.Radius) * <span class="keyword">float64</span>(c.Radius)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 周长</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">Circumference</span><span class="params">()</span> <span class="title">float64</span></span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * math.Pi * <span class="keyword">float64</span>(c.Radius)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> c = Circle {Radius: <span class="number">50</span>}</span><br><span class="line">    fmt.Println(c.Area(), c.Circumference())</span><br><span class="line">    <span class="comment">// 7853.981633974483 314.1592653589793</span></span><br><span class="line">    <span class="comment">// 指针变量调用方法形式上是一样的</span></span><br><span class="line">    <span class="keyword">var</span> pc = &amp;c</span><br><span class="line">    fmt.Println(pc.Area(), pc.Circumference())</span><br><span class="line">    <span class="comment">// 7853.981633974483 314.1592653589793</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="结构体指针方法"><a href="#结构体指针方法" class="headerlink" title="结构体指针方法"></a>结构体指针方法</h3><p>结构体指针方法和值方法在调用时形式上是没有区别的，只不过一个可以改变结构体内部状态，而另一个不会。指针方法使用结构体值变量可以调用，值方法使用结构体指针变量也可以调用。<br>通过指针访问内部的字段需要 2 次内存读取操作，第一步是取得指针地址，第二部是读取地址的内容，它比值访问要慢。但是在方法调用时，指针传递可以避免结构体的拷贝操作，结构体比较大时，这种性能的差距就会比较明显。</p>
<p>如果使用上面的方法形式给 Circle 增加一个扩大半径的方法，你会发现半径扩大不了。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">expand</span><span class="params">()</span></span> {</span><br><span class="line">  c.Radius *= <span class="number">2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这是因为上面的方法和前面的 expandByValue 函数是等价的，只不过是把函数的第一个参数挪了位置而已，参数传递时会复制了一份结构体内容，起不到扩大半径的效果。这时候就必须要使用结构体的指针方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Circle)</span> <span class="title">expand</span><span class="params">()</span></span> {</span><br><span class="line">  c.Radius *= <span class="number">2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>还有一些特殊的结构体它不允许被复制，比如结构体内部包含有锁时，这时就必须使用它的指针形式来定义方法，否则会发生一些莫名其妙的问题。</p>
<p>内置的int类型不能加方法，可以添加别名 type myInt</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m myInt)</span> <span class="title">toString</span><span class="params">()</span></span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/07/go-jie-gou-ti-de-shi-li-hua-he-new-han-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/07/go-jie-gou-ti-de-shi-li-hua-he-new-han-shu/" class="post-title-link" itemprop="url">go结构体的实例化和new函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-06 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-06T16:21:41Z">2021-07-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 02:34:54" itemprop="dateModified" datetime="2021-07-11T02:34:54Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>面向对象的三个基本特征： 1. 封装 2. 继承 3. 多态 4. 方法重载 4. 抽象基类<br>定义struct go语言没有class这个概念 所以说对于很多人来说会少理解很多面向对象抽象的概念<br>go语言不支持面向对象，如果要想达到这个封装的效果 那么就一定要解决 1. 变量的封装 2. 方法的封装</p>
<p>结构体和其它高级语言里的「类」比较类似。</p>
<p>如果说 Go 语言的基础类型是原子，那么结构体就是分子。分子是原子的组合，让形式有限的基础类型变化出丰富多样的形态结构。结构体里面装的是基础类型、切片、字典、数组以及其它类型的结构体等等。因为结构体的存在，Go 语言的变量才有了更加丰富多彩的形式，Go 语言程序的高楼大厦正是通过结构体一层层组装起来的。</p>
<p>go语言的struct更像是namedtuple, 尽量配置简单的语法尽量猜测你的意图，<br>只能存放数据的集合，有成员变量属性的名称，不能定义函数</p>
<p>结构体命名<br>采用驼峰命名法，首字母根据访问控制大写或者小写<br>struct 申明和初始化格式采用多行</p>
<h2 id="结构体类型的定义"><a href="#结构体类型的定义" class="headerlink" title="结构体类型的定义"></a>结构体类型的定义</h2><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多行申明</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span>{</span><br><span class="line">    Username  <span class="keyword">string</span></span><br><span class="line">    Email     <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line">​</span><br><span class="line"><span class="comment">// 多行初始化</span></span><br><span class="line">u := User{</span><br><span class="line">    Username: <span class="string">"astaxie"</span>,</span><br><span class="line">    Email:    <span class="string">"astaxie@gmail.com"</span>,</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Course结构体内部有三个变量，分别是价格、课程名、url。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Course <span class="keyword">struct</span> {</span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Price <span class="keyword">int</span></span><br><span class="line">    Url   <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="结构体变量的实例化创建"><a href="#结构体变量的实例化创建" class="headerlink" title="结构体变量的实例化创建"></a>结构体变量的实例化创建</h2><p>创建一个结构体变量有多种形式，</p>
<p>我们先看结构体变量最常见的创建形式</p>
<p>通过显示指定结构体内部字段的名称和初始值来初始化结构体，可以只指定部分字段的初值，甚至可以一个字段都不指定，那些没有指定初值的字段会自动初始化为相应类型的「零值」。这种形式我们称之为 「KV 形式」。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> c Course = Course{</span><br><span class="line">        Name:  <span class="string">"django"</span>,</span><br><span class="line">        Price: <span class="number">100</span>,</span><br><span class="line">        Url:   <span class="string">"https://www.imooc.com"</span>,  <span class="comment">// 注意这里的逗号不能少</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c) <span class="comment">// {Name:django Price:100 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c.Name, c.Price, c.Url) <span class="comment">//django 100 https://www.imooc.com</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> c1 Course = Course{</span><br><span class="line">        Name: <span class="string">"django"</span>,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c1)                <span class="comment">// {Name:django Price:0 Url:}</span></span><br><span class="line">    fmt.Println(c1.Name, c1.Price, c1.Url) <span class="comment">// django 0</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>结构体的第二种创建形式是不指定字段名称来顺序字段初始化，需要显示提供所有字段的初值，一个都不能少。这种形式称之为「顺序形式」。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// var c2 Course = Course{"scrapy", 110, "https://www.imooc.com"}</span></span><br><span class="line">    c2 := Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c2) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c2.Name, c2.Price, c2.Url) <span class="comment">// scrapy 110 https://www.imooc.com</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>结构体变量和普通变量都有指针形式，一个指向结构体的指针<br>使用取地址符就可以得到结构体的指针类型<br>通过结构体指针获取对象的值</p>
<p>go语言实际上在借鉴动态语言的特性 - 很多地方不管如何写都是正确的<br>另一个根本的原因 - go语言的指针是受限的</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var c3 *Course = &amp;Course{"tornado", 100, "https://www.imooc.com"}</span></span><br><span class="line">c3 := &amp;Course{<span class="string">"tornado"</span>, <span class="number">100</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line">fmt.Printf(<span class="string">"%T\n"</span>, c3) <span class="comment">// *main.Course</span></span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, c3) <span class="comment">// &amp;{Name:tornado Price:100 Url:https://www.imooc.com}</span></span><br><span class="line">fmt.Println((*c3).Name, (*c3).Price, (*c3).Url) <span class="comment">// tornado 100 https://www.imooc.com</span></span><br><span class="line">fmt.Println(c3.Name, c3.Price, c3.Url)          <span class="comment">// tornado 100 https://www.imooc.com</span></span><br><span class="line"><span class="comment">// 这里其实是go语言的一个语法糖 go语言内部会将指向结构体的指针，c3.Name转换成 (*c3).Name，直接当对象来使用而不是当成指针使用</span></span><br></pre></td></tr></tbody></table></figure>

<p>注意上面的输出，指针形式多了一个地址符 <code>&amp;</code>，表示打印的对象是一个指针类型</p>
<h2 id="使用new-函数来创建一个「零值」结构体"><a href="#使用new-函数来创建一个「零值」结构体" class="headerlink" title="使用new() 函数来创建一个「零值」结构体"></a>使用new() 函数来创建一个「零值」结构体</h2><p>new() 函数返回的是指针类型。<br>所有的字段都被初始化为相应类型的零值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c12 *Course = <span class="built_in">new</span>(Course)</span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, c12) <span class="comment">// &amp;{Name: Price:0 Url:}</span></span><br></pre></td></tr></tbody></table></figure>

<p>下面再引入结构体变量的第四种创建形式，这种形式也是零值初始化，如果不给结构体赋值，go语言会默认给每个字段采用默认值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c Course</span><br><span class="line">    <span class="keyword">var</span> c13 Course</span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c13) <span class="comment">// {Name: Price:0 Url:}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c4 := Course{}</span><br><span class="line">fmt.Println(c4.Price) <span class="comment">// 0</span></span><br><span class="line">fmt.Println(c4.Name)  <span class="comment">//  空字符串</span></span><br></pre></td></tr></tbody></table></figure>

<p>最后我们再将三种零值初始化结构体形式放到一起对比观察一下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c5 Course = Course{}</span><br><span class="line"><span class="keyword">var</span> c6 Course              <span class="comment">// c6不是指针 是结构体的类型</span></span><br><span class="line"><span class="keyword">var</span> c7 *Course = &amp;Course{} <span class="comment">// 分配一块内存并初始化</span></span><br><span class="line"><span class="keyword">var</span> c8 *Course             <span class="comment">// 指针如果只申明不赋值 默认值是nil</span></span><br><span class="line">fmt.Println(c8)            <span class="comment">// &lt;nil&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c12 *Course = <span class="built_in">new</span>(Course)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(c5.Price) <span class="comment">// 0</span></span><br><span class="line">fmt.Println(c6.Price) <span class="comment">// 0</span></span><br><span class="line">fmt.Println(c7.Price) <span class="comment">// 0</span></span><br><span class="line"><span class="comment">//fmt.Println(c8.Price) // panic: runtime error: invalid memory address or nil pointer dereference</span></span><br><span class="line"></span><br><span class="line">fmt.Println(c12.Price) <span class="comment">// 0</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="零值结构体和-nil-结构体"><a href="#零值结构体和-nil-结构体" class="headerlink" title="零值结构体和 nil 结构体"></a>零值结构体和 nil 结构体</h2><p>nil 结构体是指结构体指针变量没有指向一个实际存在的内存。这样的指针变量只会占用 1 个指针的存储空间，也就是一个机器字的内存大小。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c *Course = <span class="literal">nil</span></span><br></pre></td></tr></tbody></table></figure>

<p>而零值结构体是会实实在在占用内存空间的，只不过每个字段都是零值。如果结构体里面字段非常多，那么这个内存空间占用肯定也会很大。</p>
<h2 id="结构体的大小"><a href="#结构体的大小" class="headerlink" title="结构体的大小"></a>结构体的大小</h2><p>Go 语言的 unsafe 包提供了获取结构体内存占用字节的函数 <code>Sizeof()</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(unsafe.Sizeof(c9))              <span class="comment">// 40 16+8+16</span></span><br></pre></td></tr></tbody></table></figure>

<p>Circle 结构体在我的 64位机器上占用了 40 个字节，因为每个 int 类型都是 8 字节。<br>字符串头的结构体占用 16 个字节</p>
<p>在 32 位机器上，Circle 结构体只会占用 20 个字节。</p>
<h2 id="结构体的拷贝"><a href="#结构体的拷贝" class="headerlink" title="结构体的拷贝"></a>结构体的拷贝</h2><p>结构体之间可以相互赋值，它在本质上是一次浅拷贝操作，拷贝了结构体内部的所有字段。<br>结构体指针之间也可以相互赋值，它在本质上也是一次浅拷贝操作，不过它拷贝的仅仅是指针地址值，结构体的内容是共享的。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//var c9 Course = Course{"scrapy", 110, "https://www.imooc.com"}</span></span><br><span class="line">    c9 := Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line"></span><br><span class="line">    <span class="comment">//var c10 Course = c9</span></span><br><span class="line">    c10 := c9</span><br><span class="line">    fmt.Println(c9)  <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10) <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    c9.Price = <span class="number">200</span></span><br><span class="line">    fmt.Println(c9)  <span class="comment">// {scrapy 200 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10) <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9) <span class="comment">// {Name:scrapy Price:200 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//var c9 *Course = &amp;Course{"scrapy", 110, "https://www.imooc.com"}</span></span><br><span class="line">    c9 := &amp;Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line"></span><br><span class="line">    <span class="comment">//var c10 *Course = c9</span></span><br><span class="line">    c10 := c9</span><br><span class="line">    fmt.Println(c9)          <span class="comment">// &amp;{scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10)         <span class="comment">// &amp;{scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9)  <span class="comment">// &amp;{Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// &amp;{Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    c9.Price = <span class="number">200</span></span><br><span class="line">    fmt.Println(c9)          <span class="comment">// &amp;{scrapy 200 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10)         <span class="comment">// &amp;{scrapy 200 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9)  <span class="comment">// &amp;{Name:scrapy Price:200 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// &amp;{Name:scrapy Price:200 Url:https://www.imooc.com}</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="slice的结构体"><a href="#slice的结构体" class="headerlink" title="slice的结构体"></a>slice的结构体</h2><p>通过观察 Go 语言的底层源码，可以发现所有的 Go 语言内置的高级数据结构都是由结构体来完成的。<br>slice的函数传递本质上也是值传递</p>
<p>切片头的结构体形式如下，它在 64 位机器上将会占用 24 个字节</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> {</span><br><span class="line">    array unsafe.Pointer <span class="comment">// 底层数组的地址</span></span><br><span class="line">    <span class="built_in">len</span>   <span class="keyword">int</span>            <span class="comment">// 长度</span></span><br><span class="line">    <span class="built_in">cap</span>   <span class="keyword">int</span>            <span class="comment">// 容量</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="字符串头的结构体"><a href="#字符串头的结构体" class="headerlink" title="字符串头的结构体"></a>字符串头的结构体</h2><p>它在 64 位机器上将会占用 16 个字节</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="keyword">string</span> <span class="keyword">struct</span> {</span><br><span class="line">    array unsafe.Pointer <span class="comment">// 底层数组的地址</span></span><br><span class="line">    Data <span class="keyword">uintptr</span> <span class="comment">// 指针占8个长度</span></span><br><span class="line">    Len  <span class="keyword">int</span>     <span class="comment">// 长度64位系统占8个长度</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="字典头的结构体"><a href="#字典头的结构体" class="headerlink" title="字典头的结构体"></a>字典头的结构体</h2><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> {</span><br><span class="line">  count <span class="keyword">int</span></span><br><span class="line">  ...</span><br><span class="line">  buckets unsafe.Pointer  <span class="comment">// hash桶地址</span></span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="数组与切片在内存形式上的区别"><a href="#数组与切片在内存形式上的区别" class="headerlink" title="数组与切片在内存形式上的区别"></a>数组与切片在内存形式上的区别</h2><p>数组只有「体」，切片除了「体」之外，还有「头」部。切片的头部和内容体是分离的，使用指针关联起来。请读者尝试解释一下下面代码的输出结果</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"unsafe"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ArrayStruct <span class="keyword">struct</span> {</span><br><span class="line">    value [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SliceStruct <span class="keyword">struct</span> {</span><br><span class="line">    value []<span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 数组初始化使用了 […] 语法糖，表示让编译器自动推导数组的长度。</span></span><br><span class="line">    <span class="keyword">var</span> as = ArrayStruct{[...]<span class="keyword">int</span>{<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>}}</span><br><span class="line">    <span class="keyword">var</span> ss = SliceStruct{[]<span class="keyword">int</span>{<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>}}</span><br><span class="line">    fmt.Println(unsafe.Sizeof(as), unsafe.Sizeof(ss)) <span class="comment">// 80 24</span></span><br><span class="line"></span><br><span class="line">    s1 := []<span class="keyword">string</span>{<span class="string">"django"</span>, <span class="string">"tornado"</span>, <span class="string">"scrapy"</span>, <span class="string">"celery"</span>, <span class="string">"snaic"</span>, <span class="string">"flask"</span>}</span><br><span class="line">    fmt.Println(<span class="string">"切片占用的内存:"</span>, unsafe.Sizeof(s1)) <span class="comment">// 切片占用的内存: 24 无论字符串多长多短</span></span><br><span class="line"></span><br><span class="line">    m1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{</span><br><span class="line">        <span class="string">"bobby1"</span>: <span class="string">"django"</span>,</span><br><span class="line">        <span class="string">"bobby2"</span>: <span class="string">"tornado"</span>,</span><br><span class="line">        <span class="string">"bobby3"</span>: <span class="string">"scrapy"</span>,</span><br><span class="line">        <span class="string">"bobby4"</span>: <span class="string">"celery"</span>,</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(<span class="string">"字典占用的内存:"</span>, unsafe.Sizeof(m1)) <span class="comment">// 字典占用的内存: 8</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(unsafe.Sizeof(<span class="number">1</span>)) <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//go语言string的本质 其实string是一个结构体</span></span><br><span class="line">    fmt.Println(<span class="string">"字符串占用的内存:"</span>, unsafe.Sizeof(<span class="string">""</span>)) <span class="comment">// 字符串占用的内存: 16 无论字符串多长多短</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/06/go-de-defer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/06/go-de-defer/" class="post-title-link" itemprop="url">go的defer</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-05 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-05T16:21:41Z">2021-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-06 01:07:23" itemprop="dateModified" datetime="2021-07-06T01:07:23Z">2021-07-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>defer本质上是注册了一个延迟函数，defer函数的执行顺序已经确定<br>defer 没有嵌套 defer的机制是要取代try except finally</p>
<ol>
<li>大量的嵌套try finally</li>
<li>打开和关系逻辑离的太远</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhangboyu/p/7911190.html">https://www.cnblogs.com/zhangboyu/p/7911190.html</a><br><a target="_blank" rel="noopener" href="https://studygolang.com/articles/24044?fr=sidebar">https://studygolang.com/articles/24044?fr=sidebar</a></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   fmt.Println(<span class="string">"test1"</span>)</span><br><span class="line">   <span class="comment">//defer之后只能是函数调用 不能是表达式 比如 a++</span></span><br><span class="line">   <span class="comment">//     //1. 如果有多个defer会出现什么情况 多个defer是按照类似栈结构先入后出的顺序执行</span></span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"defer test1"</span>)</span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"defer test2"</span>)</span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"defer test3"</span>)</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">       defer 语句是go体用的一种用于注册延迟调用的机制， 它可以让当前函数执行完毕之后执行</span></span><br><span class="line"><span class="comment">       对于python的with语句来说，</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="comment">//此处有大量的逻辑需要读取文件</span></span><br><span class="line">}</span><br><span class="line">   fmt.Println(<span class="string">"test2"</span>)</span><br><span class="line">   <span class="comment">//test1</span></span><br><span class="line">   <span class="comment">//test2</span></span><br><span class="line">   <span class="comment">//defer test3</span></span><br><span class="line">   <span class="comment">//defer test2</span></span><br><span class="line">   <span class="comment">//defer test1</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">//defer语句执行时的拷贝机制</span></span><br><span class="line">   test := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       fmt.Println(<span class="string">"test1"</span>)</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">defer</span> test()</span><br><span class="line">   test = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       fmt.Println(<span class="string">"test2"</span>)</span><br><span class="line">   }</span><br><span class="line">   fmt.Println(<span class="string">"test3"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">//test3</span></span><br><span class="line"><span class="comment">//test1 因为test1的值已经入栈不能再修改了，所以不再是test2</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">// defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span></span> {</span><br><span class="line">       fmt.Println(a)</span><br><span class="line">   }(x) <span class="comment">// 后面的括号表示调用匿名函数</span></span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 10</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">// defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(a *<span class="keyword">int</span>)</span></span> { <span class="comment">// 指针</span></span><br><span class="line">       fmt.Println(*a) <span class="comment">// 指向内存的值</span></span><br><span class="line">   }(&amp;x) <span class="comment">// 后面的括号表示调用匿名函数</span></span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">//11</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">//defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       <span class="comment">//此处的defer函数并没有参数，函数内部使用的值是全局的值，闭包</span></span><br><span class="line">       fmt.Println(x)</span><br><span class="line">   }()</span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">//11</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   <span class="comment">//defer语句执行时的拷贝机制</span></span><br><span class="line">   x := <span class="number">10</span></span><br><span class="line">   <span class="comment">//此处的defer函数有参数，函数内部使用的值是全局的值</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span></span> {</span><br><span class="line">       fmt.Println(x)</span><br><span class="line">   }(x)</span><br><span class="line">   x++</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 11</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span> <span class="title">int</span></span> {</span><br><span class="line">    x := <span class="number">10</span></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        x++</span><br><span class="line">    }()</span><br><span class="line">    tmp := x <span class="comment">// x是int类型 值传递</span></span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">()</span> *<span class="title">int</span></span> { <span class="comment">// 指针</span></span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    b := &amp;a</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        *b++</span><br><span class="line">    }()</span><br><span class="line">    temp_data := b <span class="comment">// b是指针类型，修改指针指向的内存对应的变量的值</span></span><br><span class="line">    <span class="keyword">return</span> temp_data</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(f1()) <span class="comment">// 10 说明defer中的x++并没有影响return的值</span></span><br><span class="line">    fmt.Println(*f2()) <span class="comment">// 11</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/06/go-cuo-wu-he-yi-chang-panic-he-recove/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/06/go-cuo-wu-he-yi-chang-panic-he-recove/" class="post-title-link" itemprop="url">go错误和异常panic和recove</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-05 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-05T16:21:41Z">2021-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-09 12:46:08" itemprop="dateModified" datetime="2021-07-09T12:46:08Z">2021-07-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>错误和异常是两个不同的概念，非常容易混淆。很多程序员习惯将一切非正常情况都看做错误，而不区分错误和异常，即使程序中可能有异常抛出，也将异常及时捕获并转换成错误。从表面上看，一切皆错误的思路更简单，而异常的引入仅仅增加了额外的复杂度。<br>但事实并非如此。众所周知，Golang遵循“少即是多”的设计哲学，追求简洁优雅，就是说如果异常价值不大，就不会将异常加入到语言特性中。</p>
<p>错误和异常处理是程序的重要组成部分，我们先看看下面几个问题：<br>错误和异常如何区分？<br>错误处理的方式有哪几种？<br>什么时候需要使用异常终止程序？<br>什么时候需要捕获异常？</p>
<p>Golang中引入error接口类型作为错误处理的标准模式，如果函数要返回错误，则返回值类型列表中肯定包含error。<br>error处理过程类似于C语言中的错误码，可逐层返回，直到被处理。</p>
<p>Golang中引入两个内置函数panic和recover来触发**和终止异常处理流程，同时引入关键字defer来延迟执行defer后面的函数。<br>一直等到包含defer语句的函数执行完毕时，延迟函数（defer后的函数）才会被执行，而不管包含defer语句的函数是通过return的正常结束，还是由于panic导致的异常结束。</p>
<p>你可以在一个函数中执行多条defer语句，它们的执行顺序与声明顺序相反。</p>
<p>当程序运行时，如果遇到引用空指针、下标越界或显式调用panic函数等情况，则先触发panic函数的执行，然后调用延迟函数。调用者继续传递panic，因此该过程一直在调用栈中重复发生：函数停止执行，调用延迟执行函数等。如果一路在延迟函数中没有recover函数的调用，则会到达该携程的起点，该携程结束，然后终止其他所有携程，包括主携程（类似于C语言中的主线程，该携程ID为1）。<br>错误和异常从Golang机制上讲，就是error和panic的区别。很多其他语言也一样，比如C++/Java，没有error但有errno，没有panic但有throw。</p>
<p>Golang错误和异常是可以互相转换的：</p>
<ol>
<li>错误转异常，比如程序逻辑上尝试请求某个URL，最多尝试三次，尝试三次的过程中请求失败是错误，尝试完第三次还不成功的话，失败就被提升为异常了。</li>
<li>异常转错误，比如panic触发的异常被recover恢复后，将返回值中error类型的变量进行赋值，以便上层函数继续走错误处理流程。</li>
</ol>
<p>什么情况下用错误表达，什么情况下用异常表达，就得有一套规则，否则很容易出现一切皆错误或一切皆异常的情况。</p>
<p>在这个启示下，我们给出异常处理的作用域（场景）：</p>
<ul>
<li>空指针引用</li>
<li>下标越界</li>
<li>除数为0</li>
<li>不应该出现的分支，比如default</li>
<li>输入不应该引起函数错误</li>
</ul>
<p>其他场景我们使用错误处理，这使得我们的函数接口很精炼。</p>
<p>对于异常，我们可以选择在一个合适的上游去recover，并打印堆栈信息，使得部署后的程序不会终止。</p>
<p>说明： Golang错误处理方式一直是很多人诟病的地方，有些人吐槽说一半的代码都是<code>"if err != nil { / 打印 &amp;&amp; 错误处理 / }"</code>，严重影响正常的处理逻辑。当我们区分错误和异常，根据规则设计函数，就会大大提高可读性和可维护性。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The error built-in interface type is the conventional interface for</span></span><br><span class="line"><span class="comment">// representing an error condition, with the nil value representing no error.</span></span><br><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> { <span class="comment">// error是一个接口，不能实例化</span></span><br><span class="line">    Error() <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// New returns an error that formats as the given text.</span></span><br><span class="line"><span class="comment">// Each call to New returns a distinct error value even if the text is identical.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">return</span> &amp;errorString{text}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Errorf formats according to a format specifier and returns the string as a</span></span><br><span class="line"><span class="comment">// value that satisfies error.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// If the format specifier includes a %w verb with an error operand,</span></span><br><span class="line"><span class="comment">// the returned error will implement an Unwrap method returning the operand. It is</span></span><br><span class="line"><span class="comment">// invalid to include more than one %w verb or to supply it with an operand</span></span><br><span class="line"><span class="comment">// that does not implement the error interface. The %w verb is otherwise</span></span><br><span class="line"><span class="comment">// a synonym for %v.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Errorf</span><span class="params">(format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>{})</span> <span class="title">error</span></span> {</span><br><span class="line">    p := newPrinter()</span><br><span class="line">    p.wrapErrs = <span class="literal">true</span></span><br><span class="line">    p.doPrintf(format, a)</span><br><span class="line">    s := <span class="keyword">string</span>(p.buf)</span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line">    <span class="keyword">if</span> p.wrappedErr == <span class="literal">nil</span> {</span><br><span class="line">        err = errors.New(s)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        err = &amp;wrapError{s, p.wrappedErr}</span><br><span class="line">    }</span><br><span class="line">    p.free()</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">var</span> err error = errors.New(<span class="string">"错误"</span>)</span><br><span class="line">    fmt.Println(err) <span class="comment">// 错误</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> err1 error = errors.New(fmt.Sprintf(<span class="string">""</span>)) <span class="comment">// 格式化字符串</span></span><br><span class="line">    fmt.Println(err1)</span><br><span class="line"></span><br><span class="line">    s := <span class="string">"文件不存在"</span></span><br><span class="line">    <span class="keyword">var</span> err2 error = fmt.Errorf(<span class="string">"错误:%s"</span>, s) <span class="comment">// 格式化字符串</span></span><br><span class="line">    fmt.Println(err2) <span class="comment">// 错误:文件不存在</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="对待异常的态度"><a href="#对待异常的态度" class="headerlink" title="对待异常的态度"></a>对待异常的态度</h2><h2 id="1-在程序开发阶段，坚持速错"><a href="#1-在程序开发阶段，坚持速错" class="headerlink" title="1. 在程序开发阶段，坚持速错"></a>1. 在程序开发阶段，坚持速错</h2><p>去年学习Erlang的时候，建立了速错的理念，简单来讲就是“让它挂”，只有挂了你才会第一时间知道错误。在早期开发以及任何发布阶段之前，最简单的同时也可能是最好的方法是调用panic函数来中断程序的执行以强制发生错误，使得该错误不会被忽略，因而能够被尽快修复。</p>
<h3 id="2-在程序部署后，应恢复异常避免程序终止"><a href="#2-在程序部署后，应恢复异常避免程序终止" class="headerlink" title="2. 在程序部署后，应恢复异常避免程序终止"></a>2. 在程序部署后，应恢复异常避免程序终止</h3><p>我们在调用recover的延迟函数中以最合理的方式响应该异常：</p>
<ol>
<li>打印堆栈的异常调用信息和关键的业务信息，以便这些问题保留可见；</li>
<li>将异常转换为错误，以便调用者让程序恢复到健康状态并继续安全运行。</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcA</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Printf(<span class="string">"panic recover! p: %v"</span>, p)</span><br><span class="line">            debug.PrintStack()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    <span class="keyword">return</span> funcB()</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcB</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="comment">// simulation</span></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"foo"</span>)</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"success"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> {</span><br><span class="line">    err := funcA()</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> {</span><br><span class="line">        fmt.Printf(<span class="string">"err is nil\\n"</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Printf(<span class="string">"err is %v\\n"</span>, err)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>我们期望test函数的输出是：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err is foo</span><br></pre></td></tr></tbody></table></figure>

<p>实际上test函数的输出是：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err is nil</span><br></pre></td></tr></tbody></table></figure>

<p>原因是panic异常处理机制不会自动将错误信息传递给error，所以要在funcA函数中进行显式的传递，代码如下所示：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcA</span><span class="params">()</span> <span class="params">(err error)</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"panic recover! p:"</span>, p)</span><br><span class="line">            str, ok := p.(<span class="keyword">string</span>)</span><br><span class="line">            <span class="keyword">if</span> ok {</span><br><span class="line">                err = errors.New(str)</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                err = errors.New(<span class="string">"panic"</span>)</span><br><span class="line">            }</span><br><span class="line">            debug.PrintStack()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    <span class="keyword">return</span> funcB()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="3-对于不应该出现的分支，使用异常处理"><a href="#3-对于不应该出现的分支，使用异常处理" class="headerlink" title="3. 对于不应该出现的分支，使用异常处理"></a>3. 对于不应该出现的分支，使用异常处理</h3><p>当某些不应该发生的场景发生时，我们就应该调用panic函数来触发异常。比如，当程序到达了某条逻辑上不可能到达的路径：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> s := suit(drawCard()); s {</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Spades"</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Hearts"</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Diamonds"</span>:</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Clubs"</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"invalid suit %v"</span>, s))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="4-针对入参不应该有问题的函数，使用panic设计"><a href="#4-针对入参不应该有问题的函数，使用panic设计" class="headerlink" title="4. 针对入参不应该有问题的函数，使用panic设计"></a>4. 针对入参不应该有问题的函数，使用panic设计</h3><p>入参不应该有问题一般指的是硬编码，我们先看“一个启示”一节中提到的两个函数（Compile和MustCompile），其中MustCompile函数是对Compile函数的包装：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MustCompile</span><span class="params">(str <span class="keyword">string</span>)</span> *<span class="title">Regexp</span></span> {</span><br><span class="line">    regexp, error := Compile(str)</span><br><span class="line">    <span class="keyword">if</span> error != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">`regexp: Compile(`</span> + quote(str) + <span class="string">`): `</span> + error.Error())</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> regexp</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>所以，对于同时支持用户输入场景和硬编码场景的情况，一般支持硬编码场景的函数是对支持用户输入场景函数的包装。<br>对于只支持硬编码单一场景的情况，函数设计时直接使用panic，即返回值类型列表中不会有error，这使得函数的调用处理非常方便（没有了乏味的”if err != nil {/ 打印 &amp;&amp; 错误处理 /}”代码块）。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//错误就是能遇到可能出现的情况，这些情况会导致你的代码出问题， 参数检查， 数据库访问不了</span></span><br><span class="line">    a := <span class="number">12</span></span><br><span class="line">    b := <span class="number">0</span></span><br><span class="line">    fmt.Println(div(a, b)) <span class="comment">// panic: runtime error: integer divide by zero</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div1</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//错误就是能遇到可能出现的情况，这些情况会导致你的代码出问题， 参数检查， 数据库访问不了</span></span><br><span class="line">    a := <span class="number">12</span></span><br><span class="line">    b := <span class="number">0</span></span><br><span class="line">    fmt.Println(div1(a, b)) <span class="comment">// panic: 被除数不能为0</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div1</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//错误就是能遇到可能出现的情况，这些情况会导致你的代码出问题， 参数检查， 数据库访问不了</span></span><br><span class="line">    a := <span class="number">12</span></span><br><span class="line">    b := <span class="number">0</span></span><br><span class="line">    <span class="comment">// 出现错误函数不会终止，捕获异常</span></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">       err := <span class="built_in">recover</span>()</span><br><span class="line">       <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">           fmt.Println(<span class="string">"异常被捕获到"</span>)</span><br><span class="line">       }</span><br><span class="line">       fmt.Println(<span class="string">"bobby"</span>)</span><br><span class="line">    }()</span><br><span class="line">    fmt.Println(div1(a, b)) </span><br><span class="line">    <span class="comment">// 异常被捕获到</span></span><br><span class="line">    <span class="comment">// bobby</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">panic的坑</span></span><br><span class="line"><span class="string">异常 go语言中如何抛出异常和如何捕捉异常</span></span><br><span class="line"><span class="string">go语言认为错误就要自己处理， 就个人而言，go语言的这种想法是正确的。但是实际的使用中确实人有点烦人</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br><span class="line">    strconv.Itoa(data)             <span class="comment">//go 认为这个Itoa的函数不可能出错， 没有必要返回error 内部代码出错这个时候应该抛出异常 panic</span></span><br><span class="line">    _, err := strconv.Atoi(<span class="string">"abcd"</span>) <span class="comment">//Atoi这个函数认为我的函数内部会出现一些预知错误情况</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="comment">//错误</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="./go%E7%9A%84http/1.png" alt="description"></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        a := <span class="number">12</span></span><br><span class="line">        b := <span class="number">0</span></span><br><span class="line">        fmt.Println(div(a, b)) <span class="comment">// 浏览器刷新 http: panic serving 127.0.0.1:53676: runtime error: integer divide by zero</span></span><br><span class="line">        <span class="comment">// 出现异常这个程序没有挂掉，一个协程挂掉不会影响整体服务的运行</span></span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"error"</span>)</span><br><span class="line">        <span class="comment">// http: panic serving 127.0.0.1:59184: error</span></span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>panic会引起主线程的挂掉， 同时会导致其他的协程都挂掉<br>在父协程中无法捕获子协程中出现的异常</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">// 开启一个协程</span></span><br><span class="line">           <span class="built_in">panic</span>(<span class="string">"error"</span>) <span class="comment">// panic: error</span></span><br><span class="line">        }()</span><br><span class="line">        <span class="comment">//操作redis的，有人觉得这段代码可以放到协程中去运行。有一个非常大的隐患了</span></span><br><span class="line">        w.Write([]<span class="keyword">byte</span>(<span class="string">"hello world!"</span>))</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    http.ListenAndServe(<span class="string">"127.0.0.1:8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        err := <span class="built_in">recover</span>()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"捕获到了"</span>)</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"出错了"</span>) <span class="comment">// 主协程</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    f1() <span class="comment">// 捕获到了</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        err := <span class="built_in">recover</span>()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"捕获到了"</span>)</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">// 开启一个协程</span></span><br><span class="line">        <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">            err := <span class="built_in">recover</span>() <span class="comment">// 处理异常，否则会导致其他的整个服务挂掉</span></span><br><span class="line">            <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">                fmt.Println(<span class="string">"捕获到了2"</span>)</span><br><span class="line">            }</span><br><span class="line">        }()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"出错了"</span>)</span><br><span class="line">    }()</span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second) <span class="comment">// 主协程执行完不释放清除，防止主协程退出</span></span><br><span class="line">    <span class="comment">//panic("出错了")</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    f1() <span class="comment">// 捕获到了2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>






<h2 id="错误处理的正确姿势"><a href="#错误处理的正确姿势" class="headerlink" title="错误处理的正确姿势"></a>错误处理的正确姿势</h2><h3 id="1-失败的原因只有一个时，不使用error"><a href="#1-失败的原因只有一个时，不使用error" class="headerlink" title="1. 失败的原因只有一个时，不使用error"></a>1. 失败的原因只有一个时，不使用error</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(self *AgentContext)</span> <span class="title">CheckHostType</span><span class="params">(host_type <span class="keyword">string</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">switch</span> host_type {</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"virtual_machine"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"bare_metal"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"CheckHostType ERROR:"</span> + host_type)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以看出，该函数失败的原因只有一个，所以返回值的类型应该为bool，而不是error，重构一下代码：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(self *AgentContext)</span> <span class="title">IsValidHostType</span><span class="params">(hostType <span class="keyword">string</span>)</span> <span class="title">bool</span></span> {</span><br><span class="line">    <span class="keyword">return</span> hostType == <span class="string">"virtual_machine"</span> || hostType == <span class="string">"bare_metal"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>说明：大多数情况，导致失败的原因不止一种，尤其是对I/O操作而言，用户需要了解更多的错误信息，这时的返回值类型不再是简单的bool，而是error。</p>
<h3 id="2-没有失败时，不使用error"><a href="#2-没有失败时，不使用error" class="headerlink" title="2. 没有失败时，不使用error"></a>2. 没有失败时，不使用error</h3><h3 id="3-error应放在返回值类型列表的最后"><a href="#3-error应放在返回值类型列表的最后" class="headerlink" title="3. error应放在返回值类型列表的最后"></a>3. error应放在返回值类型列表的最后</h3><h3 id="4-错误值统一定义，而不是跟着感觉走"><a href="#4-错误值统一定义，而不是跟着感觉走" class="headerlink" title="4. 错误值统一定义，而不是跟着感觉走"></a>4. 错误值统一定义，而不是跟着感觉走</h3><p>很多人写代码时，到处<code>return errors.New(value)</code>，而错误value在表达同一个含义时也可能形式不同，比如“记录不存在”的错误value可能为：</p>
<ol>
<li><code>"record is not existed."</code></li>
<li><code>"record is not exist!"</code></li>
<li><code>"###record is not existed！！！"</code></li>
<li>…<br>这使得相同的错误value撒在一大片代码里，当上层函数要对特定错误value进行统一处理时，需要漫游所有下层代码，以保证错误value统一，不幸的是有时会有漏网之鱼，而且这种方式严重阻碍了错误value的重构。<br>于是，我们可以参考C/C++的错误码定义文件，在Golang的每个包中增加一个错误对象定义文件，如下所示</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ERR_EOF = errors.New(<span class="string">"EOF"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_CLOSED_PIPE = errors.New(<span class="string">"io: read/write on closed pipe"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_NO_PROGRESS = errors.New(<span class="string">"multiple Read calls return no data or error"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_SHORT_BUFFER = errors.New(<span class="string">"short buffer"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_SHORT_WRITE = errors.New(<span class="string">"short write"</span>)</span><br><span class="line"><span class="keyword">var</span> ERR_UNEXPECTED_EOF = errors.New(<span class="string">"unexpected EOF"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="5-错误逐层传递时，层层都加日志"><a href="#5-错误逐层传递时，层层都加日志" class="headerlink" title="5. 错误逐层传递时，层层都加日志"></a>5. 错误逐层传递时，层层都加日志</h3><p>根据笔者经验，层层都加日志非常方便故障定位。<br>说明：至于通过测试来发现故障，而不是日志，目前很多团队还很难做到。如果你或你的团队能做到，那么请忽略这个姿势:)</p>
<h3 id="6-错误处理使用defer"><a href="#6-错误处理使用defer" class="headerlink" title="6. 错误处理使用defer"></a>6. 错误处理使用defer</h3><p>我们一般通过判断error的值来处理错误，如果当前操作失败，需要将本函数中已经create的资源destroy掉，示例代码如下：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferDemo</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    err := createResource1()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE1_FAILED</span><br><span class="line">    }</span><br><span class="line">    err = createResource2()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        destroyResource1()</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE2_FAILED</span><br><span class="line">    }</span><br><span class="line">    err = createResource3()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        destroyResource1()</span><br><span class="line">        destroyResource2()</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE3_FAILED</span><br><span class="line">    }</span><br><span class="line">    err = createResource4()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        destroyResource1()</span><br><span class="line">        destroyResource2()</span><br><span class="line">        destroyResource3()</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE4_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>当Golang的代码执行时，如果遇到defer的闭包调用，则压入堆栈。当函数返回时，会按照后进先出的顺序调用闭包。<br>对于闭包的参数是值传递，而对于外部变量却是引用传递，所以闭包中的外部变量err的值就变成外部函数返回时最新的err值。<br>根据这个结论，我们重构上面的示例代码：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferDemo</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    err := createResource1()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE1_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            destroyResource1()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    err = createResource2()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE2_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            destroyResource2()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    err = createResource3()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE3_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            destroyResource3()</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">    err = createResource4()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> ERR_CREATE_RESOURCE4_FAILED</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="7-当发生错误时，不忽略有用的返回值"><a href="#7-当发生错误时，不忽略有用的返回值" class="headerlink" title="7. 当发生错误时，不忽略有用的返回值"></a>7. 当发生错误时，不忽略有用的返回值</h3><p>通常，当函数返回non-nil的error时，其他的返回值是未定义的(undefined)，这些未定义的返回值应该被忽略。然而，有少部分函数在发生错误时，仍然会返回一些有用的返回值。比如，当读取文件发生错误时，Read函数会返回可以读取的字节数以及错误信息。对于这种情况，应该将读取到的字符串和错误信息一起打印出来。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/05/go-han-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/05/go-han-shu/" class="post-title-link" itemprop="url">go函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-04 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-04T16:21:41Z">2021-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 02:58:39" itemprop="dateModified" datetime="2021-07-11T02:58:39Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"errors"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//相比较其他静态语言，go语言的函数有很多两点</span></span><br><span class="line"><span class="comment">//函数的几个要素： 1. 函数名 2. 参数 3. 返回值</span></span><br><span class="line"><span class="comment">//函数第一种定义方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">var</span> sum <span class="keyword">int</span></span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的第二种定义方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add2</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的第三种定义方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add3</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的第4种定义方法</span></span><br><span class="line"><span class="comment">// 被除数等于0 ，要返回多个值 -一个非常有用的特性</span></span><br><span class="line"><span class="comment">//go语言的返回设置花样很多</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> {</span><br><span class="line">    <span class="keyword">var</span> result <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        err = errors.New(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        result = a / b</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result, err</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div2</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(result <span class="keyword">int</span>, err error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> {</span><br><span class="line">        err = errors.New(<span class="string">"被除数不能为0"</span>)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        result = a / b</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    result, err := div(<span class="number">12</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result) <span class="comment">// 4</span></span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line">    result1, err := div(<span class="number">12</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err) <span class="comment">// 被除数不能为0</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result1)</span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    result2, err := div2(<span class="number">12</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result2) <span class="comment">// 4</span></span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line">    result3, err := div2(<span class="number">12</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(err) <span class="comment">// 被除数不能为0</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(result3)</span><br><span class="line">        <span class="comment">//fmt.Println(a1)</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(params ...<span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="comment">// 通过省略号去动态设置多个参数值 解决可能有不定个int值传递进来</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> params {</span><br><span class="line">        sum += v</span><br><span class="line">    }</span><br><span class="line">    params[<span class="number">0</span>] = <span class="number">9</span> <span class="comment">// 值传递不影响</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add1</span><span class="params">(params []<span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="comment">// 切片 解决可能有不定个int值传递进来</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> params {</span><br><span class="line">        sum += v</span><br><span class="line">    }</span><br><span class="line">    params[<span class="number">0</span>] = <span class="number">9</span> <span class="comment">// 引用传递影响</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> sub <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span> // <span class="title">sub</span>就等同于<span class="title">int</span> <span class="title">map</span>是一种类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subImpl</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(score []<span class="keyword">int</span>, f <span class="keyword">func</span>(<span class="keyword">int</span>)</span> <span class="title">bool</span>) []<span class="title">int</span></span> {</span><br><span class="line">    returnSlice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> score {</span><br><span class="line">        <span class="keyword">if</span> f(v) {</span><br><span class="line">            returnSlice = <span class="built_in">append</span>(returnSlice, v)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> returnSlice</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 通过省略号去动态设置多个参数值</span></span><br><span class="line">    fmt.Println(add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)) <span class="comment">// 15</span></span><br><span class="line"></span><br><span class="line">    slice := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">    fmt.Println(add(slice...)) <span class="comment">// 15</span></span><br><span class="line">    fmt.Println(slice)         <span class="comment">// [9 2 3 4 5]</span></span><br><span class="line"></span><br><span class="line">    slice1 := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">    fmt.Println(add1(slice1)) <span class="comment">// 15</span></span><br><span class="line">    fmt.Println(slice1)       <span class="comment">// [9 2 3 4 5]</span></span><br><span class="line">    <span class="comment">//这种效果slice</span></span><br><span class="line">    <span class="comment">//区别，slice是一种类型， 还是引用传递， 我们要慎重</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//省略号的用途 1. 函数参数不定长 2. 将slice打散 3.</span></span><br><span class="line">    arr := [...]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, arr) <span class="comment">// [3]int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 函数 一些trick 一些语法糖 函数的一等公民特性 - 可以作为参数 返回值 复制给另一个变量</span></span><br><span class="line">    <span class="comment">//匿名函数</span></span><br><span class="line">    myFunc := <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    }</span><br><span class="line">    myFunc(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"%T"</span>, myFunc) <span class="comment">// func(int, int) int</span></span><br><span class="line"></span><br><span class="line">    result := <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    }(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(result)      <span class="comment">// 3</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T"</span>, myFunc) <span class="comment">// func(int, int) int</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    }(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//myFunc := add</span></span><br><span class="line">    <span class="comment">//fmt.Printf("%T", myFunc) // func(...int) int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//函数也可以当做参数传递给一个函数</span></span><br><span class="line">    <span class="keyword">var</span> mySub sub = <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">        <span class="keyword">return</span> a - b</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(mySub(<span class="number">1</span>, <span class="number">2</span>)) <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将函数作为另一个函数的参数</span></span><br><span class="line">    <span class="comment">//写一个函数用于过滤一部分数据</span></span><br><span class="line">    score := []<span class="keyword">int</span>{<span class="number">10</span>, <span class="number">50</span>, <span class="number">80</span>, <span class="number">90</span>, <span class="number">85</span>}</span><br><span class="line">    <span class="comment">//写一个函数过滤掉不合格的成绩</span></span><br><span class="line">    fmt.Println(filter(score, <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span> <span class="title">bool</span></span> {</span><br><span class="line">        <span class="keyword">if</span> a &gt;= <span class="number">90</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        }</span><br><span class="line">    })) <span class="comment">// [90]</span></span><br><span class="line">    <span class="comment">//gin, python的装饰器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//go语言并没有提供try except finally</span></span><br><span class="line">    <span class="comment">//1. 大量的嵌套try finally 2. 打开和关系逻辑离的太远</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="函数（方法）注释"><a href="#函数（方法）注释" class="headerlink" title="函数（方法）注释"></a>函数（方法）注释</h3><p>每个函数，或者方法（结构体或者接口下的函数称为方法）都应该有注释说明，函数的注释应该包括三个方面（严格按照此顺序撰写）：</p>
<ul>
<li>简要说明，格式说明：以函数名开头，“，”分隔说明部分</li>
<li>参数列表：每行一个参数，参数名开头，“，”分隔说明部分</li>
<li>返回值： 每行一个返回值</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewtAttrModel ， 属性数据层操作类的工厂方法</span></span><br><span class="line"><span class="comment">// 参数：</span></span><br><span class="line"><span class="comment">//      ctx ： 上下文信息</span></span><br><span class="line"><span class="comment">// 返回值：</span></span><br><span class="line"><span class="comment">//      属性操作类指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewAttrModel</span><span class="params">(ctx *common.Context)</span> *<span class="title">AttrModel</span></span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/05/python-han-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/05/python-han-shu/" class="post-title-link" itemprop="url">python函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-04 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-04T16:21:41Z">2021-07-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-05 08:51:03" itemprop="dateModified" datetime="2021-07-05T08:51:03Z">2021-07-05</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一个简单的计算器</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">a = int(input(<span class="string">"请输入第一个数："</span>))</span><br><span class="line">op = input(<span class="string">"操作符："</span>)</span><br><span class="line">b = int(input(<span class="string">"请输入第二个数："</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "+":</span></span><br><span class="line"><span class="comment">#     print(a+b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "-":</span></span><br><span class="line"><span class="comment">#     print(a-b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "z*":</span></span><br><span class="line"><span class="comment">#     print(a*b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if op == "/":</span></span><br><span class="line"><span class="comment">#     print(a/b)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典映射代替简单的if语句</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> add()</span><br><span class="line">    <span class="comment"># return add(a, b)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">div</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">op_dict = {</span><br><span class="line">    <span class="string">"+"</span>: add,</span><br><span class="line">    <span class="string">"++"</span>: add1,</span><br><span class="line">    <span class="string">"-"</span>: sub,</span><br><span class="line">    <span class="string">"/"</span>: div,</span><br><span class="line">    <span class="string">"*"</span>: mul,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">func = op_dict[op]</span><br><span class="line"><span class="comment"># print(func(a, b)(a, b))</span></span><br><span class="line">print(func(a, b))</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把函数当做普通的变量使用， 还可以当做一个返回值 这个特性就是一等公民的特性</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    first = kwargs[<span class="string">"first"</span>]</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> args:</span><br><span class="line">        sum += int(v)</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printInfo</span>(<span class="params">name=<span class="string">""</span>, age=<span class="number">18</span></span>):</span></span><br><span class="line">    print(<span class="string">"姓名:{}, 年龄:{}"</span>.format(name, age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">datas = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="string">"6"</span>]</span><br><span class="line">print(add(first=<span class="number">12</span>, last=<span class="number">9</span>))  <span class="comment"># 0</span></span><br><span class="line">printInfo(age=<span class="number">18</span>, name=<span class="string">"bobby"</span>)  <span class="comment"># 姓名:bobby, 年龄:18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有一些情况是需要两种操作都出现 1. 文件 （打开，close） 2. 数据库的连接 （开启连接， 关闭连接） 3. 锁(获取、释放)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">file_name</span>):</span></span><br><span class="line">    f = open(file_name)</span><br><span class="line">    <span class="keyword">with</span> open(file_name) <span class="keyword">as</span> f:</span><br><span class="line">        sum = <span class="number">0</span></span><br><span class="line">        data = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            sum += int(line)  <span class="comment">#这一行代码可能有异常  很多容易出现异常</span></span><br><span class="line">        <span class="comment"># f.close()</span></span><br><span class="line">        print(<span class="string">"before return"</span>)</span><br><span class="line">        re_data = data  <span class="comment"># data是list类型 引用传递  re_data中有一个拷贝=3</span></span><br><span class="line">        lock = threading.Lock()</span><br><span class="line">        lock.acquire()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 此处是多行处理逻辑 这些就可能抛出异常</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            lock.release()  <span class="comment"># 此处可能抛出异常</span></span><br><span class="line">        <span class="comment"># 此处跳往finally执行</span></span><br><span class="line">        <span class="keyword">return</span> re_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 代码出现异常导致f.close执行不到</span></span><br><span class="line"><span class="comment"># 2. 我们忘记close了吧</span></span><br><span class="line"><span class="comment"># 无论是否正常运行到吗都能够执行到指定的逻辑</span></span><br><span class="line"><span class="comment"># print(read_file("xxx.txt"))</span></span><br><span class="line"><span class="comment"># 代码很丑陋，一旦逻辑复制 这种代码大量的充斥了我们的代码中， java</span></span><br><span class="line"><span class="comment"># finally有一些细节我们需要知道 就有了第一个印象：finally会在return之后运行</span></span><br><span class="line"><span class="comment"># 事实上真的是这样吗？</span></span><br><span class="line"><span class="comment"># 原因： 实际上finally是在return之前调用的</span></span><br><span class="line"><span class="comment"># finally中是可以return的 而且这个地方一旦有了return就会覆盖原本的return</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/04/go-zhi-zhen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/04/go-zhi-zhen/" class="post-title-link" itemprop="url">go指针</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-03 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-03T16:21:41Z">2021-07-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 13:23:09" itemprop="dateModified" datetime="2021-07-11T13:23:09Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>像python和java这种语言都是极力的屏蔽指针， c/c++ 都提供了指针 指针本身是很强大<br>c和c++中指针的功能很强大 指针的转换 指针的偏移 指针的运算</p>
<p>程序在内存中存储它的值，每个内存块都 有一个地址，每一个字节其实都是有地址<br>而存储的是另一个变量的内存地址的变量被称为指针变量，实际的值是这个地址指向的空间</p>
<p>通常用0x开头的十六进制数表示，如：0x6b0820 或 0xf84001d7f0</p>
<p>一个指针变量可以指向任何一个值的内存地址 它指向那个值的内存地址，在 32 位机器上占用 4 个字节，在 64 位机器上占用 8 个字节，并且与它所指向的值的大小无关。<br>指针可以指向任何类型的值的内存地址，但是使用时指定指针的类型在实际编码中具有重要意义；<br>指针可以指向另一个指针，并且可以进行任意深度的嵌套，导致你可以有多级的间接引用，但在大多数情况这会使你的代码结构不清晰</p>
<p>在指针类型前面加上 &amp; 号来获取地址。<br>在指针类型前面加上 * 号来根据地址获取该地址指向空间的值，使用一个指针引用一个值被称为间接引用。<br>引用类型 修改指针指向变量的值,但是不会修改地址，通过指针改掉了指向变量对应的值</p>
<p>取变量值的方式<br>1.直接通过变量名,variables<br>2.通过指针间接访问(指针名),</p>
<p>go语言没有屏蔽指针，但是go语言在指针上做了大量的限制，安全性高很多，相比较 c和c++灵活性就降低了<br>不像c有<code>pointer ++</code> <code>pointer +2</code> 当前指针从当前位置向前或向后移动一定的位置的指针运算<br>go语言的指针没有指针运算，因为指针的乱引用会导致的内存泄漏，以及引发一连串程序的崩溃</p>
<p>很多时候都是函数参数的时候指明的类型</p>
<p>go中数组是值传递 数组中有100万个值， 对于这种一般我们都采用切片来传递<br>在python中list和dict这种传递都是引用传递</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先定义变量</span></span><br><span class="line"><span class="keyword">var</span> intVariables <span class="keyword">int</span> = <span class="number">100</span></span><br><span class="line">fmt.Printf(<span class="string">"intVariables的值=%d, 地址=%v\n"</span>, intVariables, &amp;intVariables)</span><br><span class="line"><span class="comment">//intVariables的值=100, 地址=0xc000128058</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个指针类型的变量去指向变量 intVariables 的地址</span></span><br><span class="line"><span class="keyword">var</span> pointerVariables *<span class="keyword">int</span> = &amp;intVariables</span><br><span class="line">fmt.Printf(<span class="string">"pointerVariables的值=%v, 地址=%v\n"</span>, pointerVariables, &amp;pointerVariables)</span><br><span class="line"><span class="comment">//pointerVariables的值=0xc000128058, 地址=0xc000154020</span></span><br></pre></td></tr></tbody></table></figure>

<p>变量名               变量值               地址<br>intVariables        100                 0xc000128058<br>pointerVariables    0xc000128058        0xc000154020</p>
<p>指针的作用及应用场景<br>作用 应用场景</p>
<p>管理节省内存空间，提高执行效率（当操作的数据量较大规模时）<br>访问变量的值<br>修改变量的值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(intVariables) <span class="comment">// 100</span></span><br><span class="line">*pointerVariables = <span class="number">200</span></span><br><span class="line">fmt.Println(intVariables) <span class="comment">// 200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> variables2 <span class="keyword">int</span> = <span class="number">123</span></span><br><span class="line"><span class="keyword">var</span> pointerVariables2 *<span class="keyword">int</span> = &amp;variables2</span><br><span class="line"></span><br><span class="line">fmt.Println(*pointerVariables2, variables2) <span class="comment">// 123 123</span></span><br><span class="line">pointerVariables2 = variables2 <span class="comment">// cannot use variables2 (type int) as type *int in assignment</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(a *<span class="keyword">int</span>, b *<span class="keyword">int</span>)</span></span> { <span class="comment">// 参数是指向int的指针</span></span><br><span class="line">    <span class="comment">// 用于交换a和b</span></span><br><span class="line">    c := *a</span><br><span class="line">    *a = *b</span><br><span class="line">    *b = c</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap1</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="comment">// 用于交换a和b</span></span><br><span class="line">    c := a</span><br><span class="line">    a = b</span><br><span class="line">    b = c</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 什么指针，我们提一个问题</span></span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    b := <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//a, b = b, a</span></span><br><span class="line">    <span class="comment">//fmt.Println(a, b) // 20 10</span></span><br><span class="line"></span><br><span class="line">    swap1(a, b)</span><br><span class="line">    fmt.Println(a, b) <span class="comment">// 10 20</span></span><br><span class="line">    <span class="comment">// 为什么交换不成功， 这个函数运行完成以后 我想要把a和b的值变掉，int基本类型是值传递</span></span><br><span class="line">    fmt.Printf(<span class="string">"%p\n"</span>, &amp;a) <span class="comment">// 0xc00000a0a8 变量有地址</span></span><br><span class="line">    <span class="comment">//现在有一种特殊的变量类型，这个变量只能保存地址值</span></span><br><span class="line">    <span class="keyword">var</span> ip *<span class="keyword">int</span> <span class="comment">//这个变量里面就只能保存地址类型这种值</span></span><br><span class="line">    ip = &amp;a</span><br><span class="line">    <span class="comment">// 如果要修改指针指向的内存对应的变量的值，用法也比较特殊</span></span><br><span class="line">    *ip = <span class="number">30</span></span><br><span class="line">    fmt.Println(a) <span class="comment">// 30</span></span><br><span class="line">    <span class="comment">//如何定义指针变量 如果修改指针变量指向的内存中的值。 通过指针去取值的时候不知道应该取多大的连续内存空间</span></span><br><span class="line">    fmt.Printf(<span class="string">"ip所指向的内存空间地址是：%p, 内存中的值是: %d\n"</span>, ip, *ip)</span><br><span class="line">    <span class="comment">//ip所指向的内存空间地址是：0xc00000a0a8, 内存中的值是: 30</span></span><br><span class="line"></span><br><span class="line">    swap(&amp;a, &amp;b)</span><br><span class="line">    fmt.Println(a, b) <span class="comment">// 20 30</span></span><br><span class="line">    <span class="comment">//if a != nil { // Cannot convert 'nil' to type 'int'</span></span><br><span class="line">    <span class="comment">//}</span></span><br></pre></td></tr></tbody></table></figure>

<p>指针还可以指向数组 指向数组的指针 数组是值类型</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arr := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"><span class="keyword">var</span> ip *[<span class="number">3</span>]<span class="keyword">int</span> = &amp;arr</span><br><span class="line"><span class="comment">//指针数组</span></span><br><span class="line"><span class="keyword">var</span> ptrs [<span class="number">3</span>]*<span class="keyword">int</span> <span class="comment">//创建能够存放三个指针变量的数组，注意*的位置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ip != <span class="literal">nil</span> {</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="comment">//if ptrs != nil { // Cannot convert 'nil' to type '[3]*int'</span></span><br><span class="line"><span class="comment">//}</span></span><br></pre></td></tr></tbody></table></figure>


<p>当一个指针只被申明定义后没不赋值分配到任何变量时，它的值为 nil。对一个空指针的反向引用是不合法的，并且会使程序崩溃</p>
<p>申明了一个只能放地址的变量 pointer1 但是变量没有初始值 没有占用内存分配，保留了占位符，占空间（是nil），不指向内存</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> pointer1 *<span class="keyword">int</span></span><br><span class="line">    *pointer1 = <span class="number">10</span>    <span class="comment">// panic: runtime error: invalid memory address or nil pointer dereference</span></span><br><span class="line">    <span class="comment">//[signal 0xc0000005 code=0x1 addr=0x0 pc=0xee2722]</span></span><br><span class="line">    <span class="comment">// nil的地址设为10，但是nil的空间地址都没有</span></span><br></pre></td></tr></tbody></table></figure>

<p>使用指针会增加额外空间<br>默认值 int byte rune float bool string 这些类型都有默认值，占用内存分配<br>指针， 切片 map， 接口这些默认值是nil 理解为none，不能直接赋值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span></span><br><span class="line">a = <span class="number">10</span></span><br><span class="line">fmt.Println(a) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对于指针来说或者说其他的默认值是0的情况来说 如何一开始申明的时候就分配内存</span></span><br><span class="line"><span class="comment">//go的编译器就知道先申请调用操作系统的分配内存空间接口，操作系统预留一个可用的空间把地址给go，go会把操作系统给的地址设置到p变量</span></span><br><span class="line"><span class="keyword">var</span> p *<span class="keyword">int</span> = <span class="built_in">new</span>(<span class="keyword">int</span>) <span class="comment">// 这里的内存中的值全部设置为0</span></span><br><span class="line">*p = <span class="number">10</span></span><br><span class="line">fmt.Println(p) <span class="comment">// 0xc00000a0d0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//int使用make就不行</span></span><br><span class="line"><span class="comment">//除了new函数可以申请内存以外 还有一个函数就是make,更加常用的是make函数， make函数一般用于切片 map</span></span><br><span class="line"><span class="comment">//var info map[string]string</span></span><br><span class="line"><span class="comment">//info["c"] = "bobby" // panic: assignment to entry in nil map</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> info1 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">info1[<span class="string">"c"</span>] = <span class="string">"bobby"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//new函数返回的是这个值的地址 指针 make函数返回的是指定类型的实例</span></span><br><span class="line"><span class="comment">//nil的一些细节</span></span><br><span class="line"><span class="keyword">var</span> info2 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"><span class="keyword">if</span> info2 == <span class="literal">nil</span> {</span><br><span class="line">    fmt.Println(<span class="string">"map的默认值是 nil"</span>) <span class="comment">// map的默认值是 nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//var x int = nil // Cannot use 'nil' as the type int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> slice []<span class="keyword">string</span></span><br><span class="line"><span class="keyword">if</span> slice == <span class="literal">nil</span> {</span><br><span class="line">    fmt.Println(<span class="string">"slice的默认值是 nil"</span>) <span class="comment">// slice的默认值是 nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> {</span><br><span class="line">    fmt.Println(<span class="string">"error的默认值是 nil"</span>) <span class="comment">// error的默认值是 nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>python中的None和go语言中的nil类型不一样，None是全局唯一的<br>go语言中 nil是唯一可以用来表示部分类型的零值的标识符，不是实际的对象，它可以代表许多不同内存布局的值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(unsafe.Sizeof(slice), unsafe.Sizeof(info2)) <span class="comment">// 24 8</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/04/go-de-map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/04/go-de-map/" class="post-title-link" itemprop="url">go的map</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-03 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-03T16:21:41Z">2021-07-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-13 04:40:36" itemprop="dateModified" datetime="2021-07-13T04:40:36Z">2021-07-13</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="map创建"><a href="#map创建" class="headerlink" title="map创建"></a>map创建</h3><p>Map 是一种无序的key-value键值对组成的集合。<br>通过 key 可以快速检索到我们需要的数据，这里的key 类似于索引，指向对应的数据值。</p>
<p>Map 是一种集合，所以我们可以像迭代数组和切片那样迭代它。不过，Map 是无序的，我们无法决定它的返回顺序，这是因为 Map 是使用 hash 表来实现的。每次循环出来的数据的顺序是不一致的，又称为集合</p>
<p>map无序是有原因的：主要是通过散列函数对key计算一个唯一值与值进行映射</p>
<p>通过散列函数对我们的map<br>0xc0001<br>0xc0002<br>0xc0003</p>
<p>2.引用类型<br>3.类似perl当中的hash,python当中dict的字典，go当中被称为map<br>4.通过key可快速找到value</p>
<h3 id="map的定义"><a href="#map的定义" class="headerlink" title="map的定义"></a>map的定义</h3><p>要求所有的key的数据类型相同，所有value数据类型相同(注：key与value可以有不同的数据类型)<br>map的key和value类型申明的就要指明</p>
<p>map中的键是唯一的，不可以重复，值可以重复</p>
<h4 id="在申明同同时赋值"><a href="#在申明同同时赋值" class="headerlink" title="在申明同同时赋值"></a>在申明同同时赋值</h4><p>map的初始长度会根据初始化时指定的键值对的数量来确定。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 字面值</span></span><br><span class="line">m1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{ <span class="comment">// 定义map类型变量m1，key的类型为string支持 == 比较操作，value的类型string</span></span><br><span class="line">    <span class="string">"m1"</span>: <span class="string">"v1"</span>, <span class="comment">// 定义时指定的初始key/value, 后面可以继续添加</span></span><br><span class="line">}</span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m1) <span class="comment">// map[m1:v1]</span></span><br><span class="line"></span><br><span class="line">m3 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{} <span class="comment">//创建定义一个空的map</span></span><br><span class="line">fmt.Println(m3)           <span class="comment">// map[]</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m3)    <span class="comment">// map[]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mapVariables2 = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>{</span><br><span class="line">    <span class="string">"Monday"</span>: <span class="number">1</span>, <span class="string">"Tuesday"</span>: <span class="number">2</span>, <span class="string">"Wednesday"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"Thursday"</span>: <span class="number">4</span>,</span><br><span class="line">}</span><br><span class="line">fmt.Println(mapVariables2) <span class="comment">// map[Monday:1 Thursday:4 Tuesday:2 Wednesday:3]</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="var-map-key的类型-value的类型"><a href="#var-map-key的类型-value的类型" class="headerlink" title="var map[key的类型]value的类型"></a><code>var map[key的类型]value的类型</code></h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.申明</span></span><br><span class="line"><span class="keyword">var</span> mapVariables1 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"><span class="comment">//2.在使用map前，需要先make , make的作用就是给map分配数据空间，之后才可以进行引用</span></span><br><span class="line">mapVariables1 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">mapVariables1[<span class="string">"Monday"</span>] = <span class="string">"周一"</span></span><br><span class="line">mapVariables1[<span class="string">"Tuesday"</span>] = <span class="string">"周二"</span></span><br><span class="line">fmt.Println(mapVariables1) <span class="comment">// map[Monday:周一 Tuesday:周二]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//map这里的key是唯一的，不能重复，会覆盖以前的</span></span><br><span class="line">mapVariables1[<span class="string">"Monday"</span>] = <span class="string">"大周一"</span></span><br><span class="line">fmt.Println(mapVariables1) <span class="comment">// map[Monday:大周一 Tuesday:周二]</span></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(mapVariables1)) <span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="通过短冒号（简短声明）直接make，当只需要声明一个-map-的时候，使用-make-的形式"><a href="#通过短冒号（简短声明）直接make，当只需要声明一个-map-的时候，使用-make-的形式" class="headerlink" title="通过短冒号（简短声明）直接make，当只需要声明一个 map 的时候，使用 := + make 的形式"></a>通过短冒号（简短声明）直接make，当只需要声明一个 map 的时候，使用 := + make 的形式</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mapVariables3 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">mapVariables3[<span class="string">"Monday"</span>] = <span class="number">1</span></span><br><span class="line">mapVariables3[<span class="string">"Tuesday"</span>] = <span class="number">2</span></span><br><span class="line">mapVariables3[<span class="string">"Wednesday"</span>] = <span class="number">3</span></span><br><span class="line">fmt.Println(mapVariables3) <span class="comment">// map[Monday:1 Tuesday:2 Wednesday:3]</span></span><br><span class="line"></span><br><span class="line">mapVariables2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">mapVariables2[<span class="string">"Monday"</span>] = <span class="string">"周一"</span></span><br><span class="line">mapVariables2[<span class="string">"Tuesday"</span>] = <span class="string">"周二"</span></span><br><span class="line">mapVariables2[<span class="string">"Wednesday"</span>] = <span class="string">"周三"</span></span><br><span class="line"></span><br><span class="line">m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>) <span class="comment">// 创建空的map，里面不含元素，元素都需要后续添加</span></span><br><span class="line">fmt.Println(m2)               <span class="comment">// map[]</span></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(m2))          <span class="comment">// 0</span></span><br><span class="line">m2[<span class="string">"m2"</span>] = <span class="string">"v2"</span>               <span class="comment">// 添加元素</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m2)        <span class="comment">// map[m2:v2]</span></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(m2))          <span class="comment">// 1</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="map中key的类型"><a href="#map中key的类型" class="headerlink" title="map中key的类型"></a>map中key的类型</h3><p>map中的每个key在keys的集合中是唯一的，而且需要支持 == or != 操作<br>key的常用类型：int, rune, string, 结构体(每个元素需要支持 == or != 操作), 指针, 基于这些类型自定义的类型，map中的key 不是所有的类型都支持</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// m0 可以, key类型为string, 支持 == 比较操作</span></span><br><span class="line"><span class="keyword">var</span> m0 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> <span class="comment">// 定义map类型变量m0，key的类型为string，value的类型string</span></span><br><span class="line">fmt.Println(m0)</span><br><span class="line"></span><br><span class="line">a := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">b := []<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment">// m1 不可以，[]byte是slice，不支持 == != 操作，不可以作为map key的数据类型</span></span><br><span class="line"><span class="keyword">var</span> m1 <span class="keyword">map</span>[[]<span class="keyword">int</span>]<span class="keyword">string</span> <span class="comment">// Invalid map key type []byte: comparison operators == and != must be fully defined for the key type</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//两个切片不能比较</span></span><br><span class="line"><span class="keyword">if</span> a == b { <span class="comment">// Invalid operation: a == b (the operator == is not defined on []int)</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个切片slice类型只能与nil比较，其他的都不可以</span></span><br><span class="line"><span class="keyword">if</span> a == <span class="literal">nil</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// m2 可以, interface{}类型可以作为key，但是需要加入的key的类型是可以比较的</span></span><br><span class="line"><span class="keyword">var</span> m2 <span class="keyword">map</span>[<span class="keyword">interface</span>{}]<span class="keyword">string</span></span><br><span class="line">m2 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>{}]<span class="keyword">string</span>)</span><br><span class="line"><span class="comment">//m2[[]byte("k2")]="v2" // panic: runtime error: hash of unhashable type []uint8</span></span><br><span class="line">m2[<span class="number">123</span>] = <span class="string">"123"</span></span><br><span class="line">m2[<span class="number">12.3</span>] = <span class="string">"123"</span></span><br><span class="line">fmt.Println(m2)</span><br><span class="line"></span><br><span class="line">c := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">d := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment">//两个数组可以比较</span></span><br><span class="line"><span class="keyword">if</span> c == d {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">a3 := [<span class="number">3</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line"><span class="keyword">var</span> m3 <span class="keyword">map</span>[[<span class="number">3</span>]<span class="keyword">int</span>]<span class="keyword">string</span></span><br><span class="line">m3 = <span class="built_in">make</span>(<span class="keyword">map</span>[[<span class="number">3</span>]<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line">m3[a3] = <span class="string">"m3"</span></span><br><span class="line">fmt.Println(m3)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="结构体做为map的值"><a href="#结构体做为map的值" class="headerlink" title="结构体做为map的值"></a>结构体做为map的值</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// m4 可以，book1里面的元素都是支持== !=</span></span><br><span class="line"><span class="keyword">type</span> book1 <span class="keyword">struct</span> {</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> m4 <span class="keyword">map</span>[book1]<span class="keyword">string</span></span><br><span class="line">fmt.Println(m4) <span class="comment">// map[]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> book2 <span class="keyword">struct</span> {</span><br><span class="line"> name <span class="keyword">string</span></span><br><span class="line"> text []<span class="keyword">byte</span> <span class="comment">// text元素类型为[]byte, 不满足key的要求</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> m5 <span class="keyword">map</span>[book2]<span class="keyword">string</span> <span class="comment">// invalid map key type book2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> course <span class="keyword">struct</span> {</span><br><span class="line">    courseName    <span class="keyword">string</span>  <span class="comment">// 课程名称</span></span><br><span class="line">    courseTime    <span class="keyword">float32</span> <span class="comment">// 课程时长 单位分钟</span></span><br><span class="line">    courseTeacher <span class="keyword">string</span>  <span class="comment">// 课程讲师</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">couser1 := course{ <span class="comment">// 省略字段名，按顺序</span></span><br><span class="line">    <span class="string">"go语言体系课"</span>, <span class="number">300.3</span>, <span class="string">"波哥"</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">courser2 := course{ <span class="comment">// 指明字段名</span></span><br><span class="line">    courseTeacher: <span class="string">"胡哥"</span>,</span><br><span class="line">    courseTime:    <span class="number">100.2</span>,</span><br><span class="line">    courseName:    <span class="string">"如何变帅"</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">courser := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]course)</span><br><span class="line">courser[<span class="string">"go"</span>] = couser1</span><br><span class="line">courser[<span class="string">"美容"</span>] = courser2</span><br><span class="line">fmt.Println(courser)</span><br><span class="line"><span class="comment">//map[go:{go语言体系课 300.3 波哥} 美容:{如何变帅 100.2 胡哥}]</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="map的增删改"><a href="#map的增删改" class="headerlink" title="map的增删改"></a>map的增删改</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{</span><br><span class="line">    <span class="string">"a"</span>: <span class="string">"va"</span>,</span><br><span class="line">    <span class="string">"b"</span>: <span class="string">"vb"</span>,</span><br><span class="line">    <span class="string">"d"</span>: <span class="string">""</span>,</span><br><span class="line">}</span><br><span class="line">fmt.Println(<span class="built_in">len</span>(m)) <span class="comment">// len(m) 获得m中key/value对的个数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1. k不存在为增加，k存在为修改</span></span><br><span class="line">m[<span class="string">"c"</span>] = <span class="string">""</span></span><br><span class="line">m[<span class="string">"c"</span>] = <span class="string">"vc"</span> <span class="comment">// 重复增加(key相同)，使用新的值覆盖</span></span><br><span class="line">m[<span class="string">"b"</span>] = <span class="string">"vb1"</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m)              <span class="comment">// map[a:va b:vb1 c:vc d:]</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v\n"</span>, m, <span class="built_in">len</span>(m)) <span class="comment">// map[string]string{"a":"va", "b":"vb1", "c":"vc", "d":""} 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询，你返回空的字符串到底是没有获取到还是值本身就是这样空字符串呢</span></span><br><span class="line"><span class="comment">// 从m中取键k对应的值给v，如果k在m中不存在，则将value类型的零值赋值给v</span></span><br><span class="line"><span class="comment">// 从m中取键k对应的值给v，如果k存在，ok=true,如果k不存在，将value类型的零值赋值给v同时ok=false</span></span><br><span class="line"><span class="comment">// 查1 - 元素存在</span></span><br><span class="line">v := m[<span class="string">"d"</span>]</span><br><span class="line">v1, ok := m[<span class="string">"d"</span>]</span><br><span class="line"><span class="keyword">if</span> ok {</span><br><span class="line">    fmt.Println(<span class="string">"找到了"</span>, v1)</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    fmt.Println(<span class="string">"没找到"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 找到了</span></span><br><span class="line">fmt.Println(v, ok)                     <span class="comment">//  true</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v %#v\n"</span>, v, v1, ok) <span class="comment">// "" "" true 空字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查2 - 元素不存在</span></span><br><span class="line">u1 := m[<span class="string">"e"</span>]</span><br><span class="line">u2, ok2 := m[<span class="string">"e"</span>]</span><br><span class="line"><span class="keyword">if</span> ok2 {</span><br><span class="line">    fmt.Println(<span class="string">"找到了"</span>, u2)</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    fmt.Println(<span class="string">"没找到"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 没找到</span></span><br><span class="line">fmt.Println(u2, ok2)                     <span class="comment">//  false</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v %#v\n"</span>, u1, u2, ok2) <span class="comment">// "" "" false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除，使用内置函数删除k/v对</span></span><br><span class="line"><span class="comment">// delete(m, k) 将k以及k对应的v从m中删掉；如果k不在m中，不执行任何操作</span></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"a"</span>)        <span class="comment">// 删除存在的key</span></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"e"</span>)        <span class="comment">// 删除不存在的key，原m不影响，不会抛出异常</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m) <span class="comment">// map[b:vb1 c:vc d:]</span></span><br><span class="line"><span class="comment">//map[b:vb1 c:vc d:]</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v\n"</span>, m, <span class="built_in">len</span>(m)) <span class="comment">//map[string]string{"b":"vb1", "c":"vc", "d":""} 3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"a"</span>)                     <span class="comment">// 重复删除已经删除后不存在的不会抛出异常,m无影响</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, m)              <span class="comment">// map[b:vb1 c:vc d:]</span></span><br><span class="line">fmt.Printf(<span class="string">"%#v %#v\n"</span>, m, <span class="built_in">len</span>(m)) <span class="comment">//map[string]string{"b":"vb1", "c":"vc", "d":""} 3</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="map的遍历"><a href="#map的遍历" class="headerlink" title="map的遍历"></a>map的遍历</h3><ul>
<li>遍历的顺序是随机的</li>
<li>使用for range遍历的时候，k,v使用的同一块内存，这也是容易出现错误的地方</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m {</span><br><span class="line">    fmt.Println(k, v)</span><br><span class="line">}</span><br><span class="line"><span class="comment">//b vb1</span></span><br><span class="line"><span class="comment">//d</span></span><br><span class="line"><span class="comment">//c vc</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m {</span><br><span class="line">    fmt.Printf(<span class="string">"k:[%v].v:[%v]\n"</span>, k, v) <span class="comment">// 输出k,v值</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="map遍历易错点举例"><a href="#map遍历易错点举例" class="headerlink" title="map遍历易错点举例"></a>map遍历易错点举例</h3><p>由于遍历的时候，遍历v使用的同一块地址，同时这块地址是临时分配的。虽然v的地址没有变化，但v的内容在一直变化，当遍历完成后，v的内容是map遍历时最后遍历的元素的值(map遍历无序，每次不确定哪个元素是最后一个元素)。当程序将v的地址放入到slice中的时候，slice在不断地v的地址插入，由于v一直是那块地址，因此slice中的每个元素记录的都是v的地址。因此当打印slice中的内容的时候，都是同一个值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>{</span><br><span class="line">    <span class="string">"a"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"b"</span>: <span class="number">2</span>,</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> bs []*<span class="keyword">int</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m {</span><br><span class="line">    fmt.Printf(<span class="string">"k:[%p].v:[%p]\n"</span>, &amp;k, &amp;v) <span class="comment">// 这里的输出可以看到，k一直使用同一块内存，v也是这个状况</span></span><br><span class="line">    bs = <span class="built_in">append</span>(bs, &amp;v) <span class="comment">// 对v取了地址</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="keyword">for</span> _, b := <span class="keyword">range</span> bs {</span><br><span class="line">    fmt.Println(*b) <span class="comment">// 输出都是1或者都是2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>go语言中也有一个list 就是数据结构中提到的链表，不需要连续的内存<br>指针 //为什么指针在java python等很多语言中不存在</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/04/kong/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/04/kong/" class="post-title-link" itemprop="url">空</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-03 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-03T16:21:41Z">2021-07-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 11:54:15" itemprop="dateModified" datetime="2021-07-11T11:54:15Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/03/go-kong/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/03/go-kong/" class="post-title-link" itemprop="url">go</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-02 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-02T16:21:41Z">2021-07-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-12 09:58:54" itemprop="dateModified" datetime="2021-07-12T09:58:54Z">2021-07-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
