<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/2/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">343</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/14/go-di-gui-han-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/14/go-di-gui-han-shu/" class="post-title-link" itemprop="url">go递归函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-13 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-13T16:21:41Z">2021-07-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-14 01:11:12" itemprop="dateModified" datetime="2021-08-14T01:11:12Z">2021-08-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>递归函数指的是在运行的过程中函数内部调用函数自身的函数，<br>从数学解题思路来说，递归就是把一个大问题拆分成多个小问题，再各个击破，在实际开发过程中，递归函数可以解决许多数学问题，</p>
<p>递归函数 在一个循环体当中执行，必须有一个条件可以在满足某个条件时终止当前的循环，否则为死循环</p>
<p>构成递归需要具备以下条件：</p>
<ul>
<li>一个问题可以被拆分成多个子问题；</li>
<li>拆分前的原问题与拆分后的子问题除了数据规模不同，但处理问题的思路是一样的；</li>
<li>不能无限制的调用本身，子问题需要有退出递归状态的条件。<br>注意：编写递归函数时，一定要有终止条件，否则就会无限调用下去，直到内存溢出。</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recursion</span><span class="params">()</span></span> {</span><br><span class="line">   recursion() <span class="comment">/* 函数调用自身 */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">   recursion()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h3><p>位置     值<br>1        1<br>2        1<br>3        2<br>4        3<br>..    ..<br>n    func(n-1) + func(n-2)</p>
<p>传递一个位置，返回当前位置的值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    result := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {</span><br><span class="line">        result = fibonacci(i)</span><br><span class="line">        fmt.Printf(<span class="string">"fibonacci(%d) is: %d\n"</span>, i, result)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">(res <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">2</span> {</span><br><span class="line">        res = <span class="number">1</span> <span class="comment">// res = n</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res = fibonacci(n<span class="number">-1</span>) + fibonacci(n<span class="number">-2</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> {</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n<span class="number">-2</span>) + fibonacci(n<span class="number">-1</span>)</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line">fibonacci(<span class="number">1</span>) is: <span class="number">1</span></span><br><span class="line">fibonacci(<span class="number">2</span>) is: <span class="number">1</span></span><br><span class="line">fibonacci(<span class="number">3</span>) is: <span class="number">2</span></span><br><span class="line">fibonacci(<span class="number">4</span>) is: <span class="number">3</span></span><br><span class="line">fibonacci(<span class="number">5</span>) is: <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fibonacci</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> {</span><br><span class="line">    a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> { <span class="comment">// 闭包</span></span><br><span class="line">        a, b = b, a+b</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    f := fibonacci()</span><br><span class="line">    <span class="built_in">println</span>(f()) <span class="comment">// 1</span></span><br><span class="line">    <span class="built_in">println</span>(f()) <span class="comment">// 1</span></span><br><span class="line">    <span class="built_in">println</span>(f()) <span class="comment">// 2</span></span><br><span class="line">    <span class="built_in">println</span>(f()) <span class="comment">// 3</span></span><br><span class="line">    <span class="built_in">println</span>(f()) <span class="comment">// 5</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"bufio"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fibonacci</span><span class="params">()</span> <span class="title">intGen</span></span> {</span><br><span class="line">    a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> {</span><br><span class="line">        a, b = b, a+b</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> intGen <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数作为接收者类型也就是作为参数实现Read接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g intGen)</span> <span class="title">Read</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> {</span><br><span class="line">    next := g()</span><br><span class="line">    <span class="keyword">if</span> next &gt; <span class="number">200</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, io.EOF</span><br><span class="line">    }</span><br><span class="line">    s := fmt.Sprintf(<span class="string">"%d\n"</span>, next)</span><br><span class="line">    <span class="keyword">return</span> strings.NewReader(s).Read(p) <span class="comment">// 找个代理帮助我们读取</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printFileContents</span><span class="params">(reader io.Reader)</span></span> {</span><br><span class="line">    scanner := bufio.NewScanner(reader)</span><br><span class="line">    <span class="keyword">for</span> scanner.Scan() {</span><br><span class="line">        fmt.Println(scanner.Text())</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> f intGen = Fibonacci()</span><br><span class="line">    printFileContents(f)</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="number">34</span></span><br><span class="line"><span class="number">55</span></span><br><span class="line"><span class="number">89</span></span><br><span class="line"><span class="number">144</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="数字阶乘"><a href="#数字阶乘" class="headerlink" title="数字阶乘"></a>数字阶乘</h3><p>一个正整数的阶乘（factorial）是所有小于及等于该数的正整数的积，并且 0 的阶乘为 1，自然数 n 的阶乘写作n!</p>
<p>例如，n!=1×2×3×…×n，阶乘亦可以递归方式定义：0!=1，n!=(n-1)!×n。</p>
<p>使用递归函数计算给定数的阶乘，示例代码如下所示：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Factorial</span><span class="params">(n <span class="keyword">uint64</span>)</span> <span class="params">(result <span class="keyword">uint64</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> n &gt; <span class="number">0</span> {</span><br><span class="line">        result = n * Factorial(n<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">    fmt.Printf(<span class="string">"%d 的阶乘是 %d\n"</span>, i, Factorial(<span class="keyword">uint64</span>(i)))</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line"><span class="number">10</span> 的阶乘是 <span class="number">3628800</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="多个函数组成递归"><a href="#多个函数组成递归" class="headerlink" title="多个函数组成递归"></a>多个函数组成递归</h3><p>Go语言中也可以使用相互调用的递归函数，多个函数之间相互调用形成闭环，因为Go语言编译器的特殊性，这些函数的声明顺序可以是任意的，下面这个简单的例子展示了函数 odd 和 even 之间的相互调用：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"%d is even: is %t\n"</span>, <span class="number">16</span>, even(<span class="number">16</span>)) <span class="comment">// 16 is even: is true</span></span><br><span class="line">    fmt.Printf(<span class="string">"%d is odd: is %t\n"</span>, <span class="number">17</span>, odd(<span class="number">17</span>))</span><br><span class="line">    <span class="comment">// 17 is odd: is true</span></span><br><span class="line">    fmt.Printf(<span class="string">"%d is odd: is %t\n"</span>, <span class="number">18</span>, odd(<span class="number">18</span>))</span><br><span class="line">    <span class="comment">// 18 is odd: is false</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">even</span><span class="params">(nr <span class="keyword">int</span>)</span> <span class="title">bool</span></span> {</span><br><span class="line">    <span class="keyword">if</span> nr == <span class="number">0</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> odd(RevSign(nr) - <span class="number">1</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">odd</span><span class="params">(nr <span class="keyword">int</span>)</span> <span class="title">bool</span></span> {</span><br><span class="line">    <span class="keyword">if</span> nr == <span class="number">0</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> even(RevSign(nr) - <span class="number">1</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RevSign</span><span class="params">(nr <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">if</span> nr &lt; <span class="number">0</span> {</span><br><span class="line">        <span class="keyword">return</span> -nr</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nr</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line"><span class="number">16</span> is even: is <span class="literal">true</span></span><br><span class="line"><span class="number">17</span> is odd: is <span class="literal">true</span></span><br><span class="line"><span class="number">18</span> is odd: is <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/12/grpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/12/grpc/" class="post-title-link" itemprop="url">grpc</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-11 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-11T16:21:41Z">2021-07-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-09 13:17:33" itemprop="dateModified" datetime="2021-07-09T13:17:33Z">2021-07-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>go语言的包以及编码规范 </p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/08/go-jie-kou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/08/go-jie-kou/" class="post-title-link" itemprop="url">go接口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-07 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-07T16:21:41Z">2021-07-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-14 12:16:59" itemprop="dateModified" datetime="2021-08-14T12:16:59Z">2021-08-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Go 语言的接口类型非常特别，它的作用和 Java 语言的接口一样，但是在形式上有很大的差别。概念的地位和java中接口的地位是不一样<br>Java 语言需要在类的定义上显式实现了某些接口，才可以说这个类具备了接口定义的能力。</p>
<p>接口的实现是隐式的，没有具体表明是怎么实现了接口</p>
<p>go接口是由调用者定义，而不是有实现者定义，实现者可以实现他想要的任何方法，<br>然后调用者根据<br>一个类型上定义的方法在形式上（名称、参数和返回值）和接口里面定义的所有方法一样，<br>那么这个类型就实现了这个接口，类型不仅仅结构体，也可以是内置类型，就可以使用这个接口变量来指向这个结构体对象变量，这个类型的实例可以赋给它所实现的任意接口类型的变量</p>
<p>go语言的接口实际上就是python中的协议 - 鸭子类型</p>
<ul>
<li><p>同时具有 Python, C++的 duck typing 的灵活性</p>
</li>
<li><p>又具有 Java 的类型检查<br>java的缺点就是如果我以后还需要在某个接口里面增加某个方法，那我所有的实现这个接口的代码都要改，go就不需要<br>假如我写了一个类：<br><code>public class AB implements A,B</code><br>我这样写很可能是因为你的C是后来才定义的。然而我已经写了implements A,B<br>你想把我这个<code>class AB</code>的<code>instance</code>直接传给<code>downloader</code>，是不行的。要想传进去要么你改（增加一个adapter)要么我改（改成implements C)<br>Go语言在这种类似下就不需要改动，可以直接传。</p>
</li>
<li><p>是一种抽象类型，不能实例化</p>
</li>
<li><p>struct是具象，具象能实例化</p>
</li>
</ul>
<p>python语言本身设计上是采用了完全的基于鸭子类型 - 协议 影响了python语法的，例如 for len()</p>
<p>单个函数的结构名以 “er” 作为后缀，例如 Reader , Writer 。<br>接口有一个默认的规范  接口的名称一般以 er 结尾</p>
<p>鸭子类型是多态的一种形式，在这种形式中，不管对象属于哪个，也不管声明的具体接口是什么，<br>只要对象实现了相应的方法，函数就可以在对象执行操作，<br>即忽略了真正的类型，转而关注对象有没有实现所需的方法，签名和语义。<br>duck typing 是动态绑定的，go语言是编译时绑定，严格来说go不是duck typing，但是从行为上属于duck typing，属于结构化类型系统</p>
<h2 id="用接口来模拟多态"><a href="#用接口来模拟多态" class="headerlink" title="用接口来模拟多态"></a>用接口来模拟多态</h2><p>方法不能实现</p>
<p>多态 声明类型的时候你申明的类型是一种兼容类型， 但是实际赋值的时候是另一种类型</p>
<p>接口是一种特殊的容器，它可以容纳多种不同的对象，只要这些对象都同样实现了接口定义的方法。如果我们将容纳的对象替换成另一个对象，</p>
<p>使用这种方式模拟多态本质上是<br>结构体组合 属性变量（Name）和 接口变量（Fruitable）来做到的，<br>属性变量是对象的数据，<br>而接口变量是对象的功能，<br>将它们组合到一块就形成了一个完整的多态性的结构体。</p>
<p>自定义类型可以实现多个接口</p>
<p>对已有的类型添加功能，扩充系统类型或别人已有类型</p>
<ul>
<li>组合</li>
<li>定义别名</li>
<li>内嵌</li>
</ul>
<p>类型和接口是松耦合的，</p>
<p>python中不需要多态 python是动态语言</p>
<h3 id="定义接口与类型，让类型去实现接口中的方法"><a href="#定义接口与类型，让类型去实现接口中的方法" class="headerlink" title="定义接口与类型，让类型去实现接口中的方法"></a>定义接口与类型，让类型去实现接口中的方法</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> 接口名 <span class="keyword">interface</span> {</span><br><span class="line">    方法名<span class="number">1</span>（参数列表）（返回值）</span><br><span class="line">    方法名<span class="number">2</span>（参数列表）（返回值）</span><br><span class="line">    方法名<span class="number">3</span>（参数列表）（返回值）</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 通过自定义类型来实现接口中的所有方法</span></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> {</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> TT <span class="keyword">string</span></span><br><span class="line"><span class="comment">//方法接收者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span>方法名1<span class="params">()</span>（返回值）</span>{}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span>方法名2<span class="params">()</span>（返回值）</span>{}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span>方法名3<span class="params">()</span>（返回值）</span>{}</span><br></pre></td></tr></tbody></table></figure>

<p>在main.go中定义一个接口pay，增加两个方法topay()，info()</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> pay <span class="keyword">interface</span> {</span><br><span class="line">    topay()</span><br><span class="line">    info()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>定义一个结构体payment</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> payment <span class="keyword">struct</span> {</span><br><span class="line">    paymentmethod <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>让这个结构体去实现接口pay中的所有方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *payment)</span> <span class="title">topay</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"topay:"</span>, p.paymentmethod)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *payment)</span> <span class="title">info</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"info:"</span>, p.paymentmethod)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>定义结构体 payment 类型的变量 _payment，可以通过这个变量去调用接口中的方法了，因为结构体payment实现了接口 pay 中所有的方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_payment := &amp;payment{paymentmethod: <span class="string">"alipay"</span>}</span><br><span class="line">_payment.info() <span class="comment">// info: alipay</span></span><br><span class="line">_payment.topay() <span class="comment">// topay: alipay</span></span><br></pre></td></tr></tbody></table></figure>

<p>一个变量实现了接口当中所有方法，接口变量就可以指向这个变量</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _pay pay</span><br><span class="line">_pay = _payment</span><br><span class="line">_pay.info() <span class="comment">// info: alipay</span></span><br><span class="line">_pay.topay() <span class="comment">// topay: alipay</span></span><br></pre></td></tr></tbody></table></figure>

<p>我们一般不这样使用，后面我们会讲解他的使用场景</p>
<h3 id="自定义类型（非结构体）也可以实现接口"><a href="#自定义类型（非结构体）也可以实现接口" class="headerlink" title="自定义类型（非结构体）也可以实现接口"></a>自定义类型（非结构体）也可以实现接口</h3><p>在main.go文件中，定义两个接口</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> write <span class="keyword">interface</span> {</span><br><span class="line">    echo()</span><br><span class="line">    out()</span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> read <span class="keyword">interface</span> {</span><br><span class="line">    scan()</span><br><span class="line">    input()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>基于内置类型创建自定义类型</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> readwrite <span class="keyword">string</span></span><br></pre></td></tr></tbody></table></figure>

<p>自定义的类型readwrite实现上面定义的两个接口中的所有方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *readwrite)</span> <span class="title">echo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"readwrite:echo()"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *readwrite)</span> <span class="title">out</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"readwrite:out()"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *readwrite)</span> <span class="title">scan</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"readwrite:scan()"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *readwrite)</span> <span class="title">input</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"readwrite:input()"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在main.go文件中调用</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _readwrite readwrite</span><br><span class="line">_readwrite.echo() <span class="comment">// readwrite:echo()</span></span><br></pre></td></tr></tbody></table></figure>

<p>多重继承可以通过实现多个接口实现，所有的方法都要实现</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多重继承格式</span></span><br><span class="line"><span class="keyword">type</span> InterfaceAA <span class="keyword">interface</span> {</span><br><span class="line">    InterfaceA</span><br><span class="line">    InterfaceB</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>综合案例</p>
<p>企业项目中经常涉及到与日志存储的业务，比如针对web项目的日志存储</p>
<p>比如磁盘IO操作的日志：磁盘进行数据拷贝读取一般会有读写日志，记录读取到的位置，即当前数据在磁盘的哪个碰头哪个扇区上</p>
<p>比如网络请求的日志：去访问某个网站一般会有请求日志的记录，用于分析来访客户，刻画出用户的区域，访问兴趣爱好（网购时的一个典型例子，用户浏览记录写cookie）</p>
<p>这里我们模拟一个网络读写日志与磁盘读写日志的例子</p>
<p>定义公共日志结构体Log，做为父类，并为其增加方法writeLog()，传递一个write接口类型的变量</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Log <span class="keyword">struct</span> {</span><br><span class="line">    name    <span class="keyword">string</span></span><br><span class="line">    content <span class="keyword">string</span></span><br><span class="line">    addtime <span class="keyword">int64</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *Log)</span> <span class="title">writeLog</span><span class="params">(_write write)</span></span> {</span><br><span class="line">    fmt.Println(l.name + <span class="string">"---"</span> + l.content)</span><br><span class="line">    _write.echo()</span><br><span class="line">    _write.out()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>定义网络读写结构体与磁盘读写结构体，继承自父类Log</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NetLog <span class="keyword">struct</span> {</span><br><span class="line">    Log</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IOLog <span class="keyword">struct</span> {</span><br><span class="line">    Log</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>定义自定义类型，iowrite与netwrite，分别实现write接口中的所有方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> iowrite <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *iowrite)</span> <span class="title">echo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"iowrite:echo()"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *iowrite)</span> <span class="title">out</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"iowrite:out()"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> netwrite <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *netwrite)</span> <span class="title">echo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"netwrite:echo()"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *netwrite)</span> <span class="title">out</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"netwrite:out()"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>父类引用指向子类对象<br>main.go文件中</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">log := &amp;Log{</span><br><span class="line">    name:    <span class="string">"微信小程序支付日志"</span>,</span><br><span class="line">    content: <span class="string">"微信小程序支付日志内容"</span>,</span><br><span class="line">    addtime: <span class="number">0</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _iowrite *iowrite</span><br><span class="line"><span class="keyword">var</span> _netwrite *netwrite</span><br><span class="line"><span class="comment">// writeLog的参数是一个write类型，我们这里的iowrite实现了write接口中的所有方法，所以可以传递iowrite</span></span><br><span class="line"><span class="comment">// 相当于write（指向）-&gt; iowrite</span></span><br><span class="line">log.writeLog(_iowrite)</span><br><span class="line"><span class="comment">// 微信小程序支付日志---微信小程序支付日志内容</span></span><br><span class="line"><span class="comment">// iowrite:echo()</span></span><br><span class="line"><span class="comment">// iowrite:out()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// writeLog的参数是一个write类型，我们这里的netwrite实现了write接口中的所有方法，所以可以传递netwrite</span></span><br><span class="line"><span class="comment">// 相当于write（指向）-&gt; netwrite</span></span><br><span class="line">log.writeLog(_netwrite)</span><br><span class="line"><span class="comment">// 微信小程序支付日志---微信小程序支付日志内容</span></span><br><span class="line"><span class="comment">// netwrite:echo()</span></span><br><span class="line"><span class="comment">// netwrite:out()</span></span><br></pre></td></tr></tbody></table></figure>

<p>调用者多态的一面</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">netlog := &amp;NetLog{Log{</span><br><span class="line">    name:    <span class="string">"微信小程序网络支付日志"</span>,</span><br><span class="line">    content: <span class="string">"微信小程序网络支付日志内容"</span>,</span><br><span class="line">    addtime: <span class="number">0</span>,</span><br><span class="line">}}</span><br><span class="line"><span class="comment">// writeLog的调用者是Log,我们的NetLog继承自Log，所以可直接调用</span></span><br><span class="line">netlog.writeLog(_netwrite)</span><br><span class="line"><span class="comment">// 微信小程序网络支付日志---微信小程序网络支付日志内容</span></span><br><span class="line"><span class="comment">// netwrite:echo()</span></span><br><span class="line"><span class="comment">// netwrite:out()</span></span><br><span class="line"></span><br><span class="line">filelog := &amp;IOLog{Log{</span><br><span class="line">    name:    <span class="string">"微信小程序文件支付日志"</span>,</span><br><span class="line">    content: <span class="string">"微信小程序文件支付日志内容"</span>,</span><br><span class="line">    addtime: <span class="number">0</span>,</span><br><span class="line">}}</span><br><span class="line"><span class="comment">// writeLog的调用者是Log,我们的IOLog继承自Log，所以可直接调用</span></span><br><span class="line">filelog.writeLog(_iowrite)</span><br><span class="line"><span class="comment">// 微信小程序文件支付日志---微信小程序文件支付日志内容</span></span><br><span class="line"><span class="comment">// iowrite:echo()</span></span><br><span class="line"><span class="comment">// iowrite:out()</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="处理类型断言失败"><a href="#处理类型断言失败" class="headerlink" title="处理类型断言失败"></a>处理类型断言失败</h4><p><a target="_blank" rel="noopener" href="https://golang.org/ref/spec#Type_assertions">类型断言</a>的单个返回值形式针对不正确的类型将产生 panic。因此，请始终使用“comma ok”的惯用法</p>
<p>类型断言的本质，跟类型转换类似，都是类型之间进行转换，<br>不同之处在于，类型断言是在接口之间进行，相当于在Java中，对于一个对象，把一种接口的引用转换成另一种。</p>
<h4 id="反例"><a href="#反例" class="headerlink" title="反例"></a>反例</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;目标类型的值&gt; := &lt;表达式&gt;.( 目标类型 )  <span class="comment">// 非安全类型断言</span></span><br><span class="line">t := i.(<span class="keyword">string</span>)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="正例"><a href="#正例" class="headerlink" title="正例"></a>正例</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;目标类型的值&gt;，&lt;布尔参数&gt; := &lt;表达式&gt;.( 目标类型 ) <span class="comment">// 安全类型断言</span></span><br><span class="line">t, ok := i.(<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">if</span> !ok {</span><br><span class="line">  <span class="comment">// 优雅地处理错误</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test6</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">interface</span>{} = <span class="string">"kk"</span></span><br><span class="line">    j := i.(<span class="keyword">int</span>) <span class="comment">// 把i转换成int类型 系统内部检测到不匹配 会调用panic 抛出异常</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T-&gt;%d\n"</span>, j, j)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test7</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">interface</span>{} = <span class="string">"TT"</span></span><br><span class="line">    j, ok := i.(<span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">if</span> ok { <span class="comment">// 安全类型的断言</span></span><br><span class="line">        fmt.Printf(<span class="string">"%T-&gt;%d\n"</span>, j, j)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(<span class="string">"类型不匹配"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


<h3 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h3><p>任意结构体都隐式地实现了空接口。</p>
<p>Go 语言为了避免用户重复定义很多空接口，它自己内置了一个，这个空接口的名字特别奇怪，叫 interface{} 。之所以这个类型名带上了大括号，那是在告诉用户括号里什么也没有。</p>
<p>空接口里面没有定义任何方法，所以它也不具有任何能力，其作用相当于 Java和python中 的 Object 类型，可以容纳任意对象，它是一个万能容器。<br>可以把任何类型都赋值给空接口变量<br>比如一个字典的 key 是字符串，但是希望 value 可以容纳任意类型的对象，这时候就可以使用空接口类型 interface{}。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Course <span class="keyword">struct</span> {</span><br><span class="line">    name  <span class="keyword">string</span></span><br><span class="line">    price <span class="keyword">int</span></span><br><span class="line">    url   <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> Printer <span class="keyword">interface</span> {</span><br><span class="line">    printInfo() <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Course)</span> <span class="title">printInfo</span><span class="params">()</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"课程信息"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">print</span><span class="params">(x <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">    <span class="comment">// 判断是不是int类型，是返回ture，否则返回false</span></span><br><span class="line">    <span class="keyword">if</span> v, ok := x.(<span class="keyword">int</span>); ok {</span><br><span class="line">        fmt.Printf(<span class="string">"%d(整数)\n"</span>, v)</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 判断是不是string类型</span></span><br><span class="line">    <span class="keyword">if</span> s, ok := x.(<span class="keyword">string</span>); ok {</span><br><span class="line">        fmt.Printf(<span class="string">"%s(字符串)\n"</span>, s)</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//fmt.Printf("%v\n", i)</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">print1</span><span class="params">(x <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">    <span class="keyword">switch</span> v := x.(<span class="keyword">type</span>) {</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">        fmt.Printf(<span class="string">"%s(字符串)\n"</span>, v)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">        fmt.Printf(<span class="string">"%d(整数)\n"</span>, v)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Printf(<span class="string">"%v(本来值)\n"</span>, v)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">interface</span>{} <span class="comment">// 空接口</span></span><br><span class="line">    <span class="comment">// 参数传递</span></span><br><span class="line">    i = Course{}</span><br><span class="line">    fmt.Println(i) <span class="comment">// { 0 }</span></span><br><span class="line">    i = <span class="number">10</span></span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// 10(整数)</span></span><br><span class="line">    i = <span class="string">"bobby"</span></span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// bobby(字符串)</span></span><br><span class="line">    i = []<span class="keyword">string</span>{<span class="string">"django"</span>, <span class="string">"scrapy"</span>}</span><br><span class="line">    <span class="built_in">print</span>(i) <span class="comment">// [django scrapy](本来值)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 空接口可以作为map的 value 值，可以是任何类型，而不是固定的指定类型</span></span><br><span class="line">    <span class="keyword">var</span> teacherInfo = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{})</span><br><span class="line">    teacherInfo[<span class="string">"name"</span>] = <span class="string">"bobby"</span></span><br><span class="line">    teacherInfo[<span class="string">"age"</span>] = <span class="number">18</span></span><br><span class="line">    teacherInfo[<span class="string">"weight"</span>] = <span class="number">75.2</span></span><br><span class="line">    teacherInfo[<span class="string">"courses"</span>] = []<span class="keyword">string</span>{<span class="string">"django"</span>, <span class="string">"scrapy"</span>, <span class="string">"sanic"</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"%v"</span>, teacherInfo) <span class="comment">// map[age:18 courses:[django scrapy sanic] name:bobby weight:75.2]</span></span><br><span class="line">    <span class="comment">//类型断言0-, 接口引入了</span></span><br><span class="line">    c := &amp;Course{}</span><br><span class="line">    c.printInfo()</span><br><span class="line">    c1 := Course{}</span><br><span class="line">    c1.printInfo()</span><br><span class="line">    <span class="comment">//var c Printer = Course{}  // 实现了方法可以实例化</span></span><br><span class="line">    <span class="comment">//c.printInfo()</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{</span><br><span class="line">    <span class="string">"age"</span>:     <span class="number">30</span>,</span><br><span class="line">    <span class="string">"address"</span>: <span class="string">"Beijing Tongzhou"</span>,</span><br><span class="line">    <span class="string">"married"</span>: <span class="literal">true</span>,</span><br><span class="line">}</span><br><span class="line">fmt.Println(user)        <span class="comment">// map[age:30 address:Beijing Tongzhou married:true]</span></span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, user) <span class="comment">// map[string]interface {}</span></span><br><span class="line">fmt.Printf(<span class="string">"%T\n"</span>, user) <span class="comment">// map[age:30 address:Beijing Tongzhou married:true]</span></span><br><span class="line"></span><br><span class="line">fmt.Println(user[<span class="string">"age"</span>], user[<span class="string">"address"</span>], user[<span class="string">"married"</span>]) <span class="comment">// 30 Beijing Tongzhou true</span></span><br><span class="line">fmt.Printf(<span class="string">"%T %T %T\n"</span>, user[<span class="string">"age"</span>], user[<span class="string">"address"</span>], user[<span class="string">"married"</span>]) <span class="comment">// int string bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型转换语法</span></span><br><span class="line"><span class="keyword">var</span> age = user[<span class="string">"age"</span>].(<span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">var</span> address = user[<span class="string">"address"</span>].(<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">var</span> married = user[<span class="string">"married"</span>].(<span class="keyword">bool</span>)</span><br><span class="line">fmt.Println(age, address, married)              <span class="comment">// 30 Beijing Tongzhou true</span></span><br><span class="line">fmt.Printf(<span class="string">"%T %T %T\n"</span>, age, address, married) <span class="comment">// int string bool</span></span><br></pre></td></tr></tbody></table></figure>

<p>从这个字典中直接读取得到的 value 类型是 interface{}，需要通过类型转换才能得到期望的变量？</p>
<h2 id="接口变量的本质"><a href="#接口变量的本质" class="headerlink" title="接口变量的本质"></a>接口变量的本质</h2><p>在使用接口时，我们要将接口看成一个特殊的容器，这个容器只能容纳一个对象，只有实现了这个接口类型的对象才可以放进去。</p>
<p>接口变量作为变量来说它也是需要占据内存空间的，通过翻阅 Go 语言的源码可以发现，接口变量也是由结构体来定义的，<br>这个结构体包含两个指针字段，一个字段指向被容纳的对象内存，<br>另一个字段指向一个特殊的结构体 itab，这个特殊的结构体包含了接口的类型信息和被容纳对象的数据类型信息。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// interface structure</span></span><br><span class="line"><span class="keyword">type</span> iface <span class="keyword">struct</span> {</span><br><span class="line">  tab *itab  <span class="comment">// 类型指针</span></span><br><span class="line">  data unsafe.Pointer  <span class="comment">// 数据指针</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> {</span><br><span class="line">  inter *interfacetype <span class="comment">// 接口类型信息</span></span><br><span class="line">  _type *_type <span class="comment">// 数据类型信息</span></span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>既然接口变量只包含两个指针字段，那么它的内存占用应该是 2 个机器字，下面我们来编写代码验证一下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"unsafe"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> s <span class="keyword">interface</span>{}</span><br><span class="line">    fmt.Println(unsafe.Sizeof(s)) <span class="comment">// 16</span></span><br><span class="line">    <span class="keyword">var</span> arr = [<span class="number">10</span>]<span class="keyword">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>}</span><br><span class="line">    fmt.Println(unsafe.Sizeof(arr)) <span class="comment">// 80</span></span><br><span class="line">    s = arr</span><br><span class="line">    fmt.Println(unsafe.Sizeof(s)) <span class="comment">// 16</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>数组的内存占用是 10 个机器字，但是这丝毫不会影响到接口变量的内存占用。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口是一个协议</span></span><br><span class="line"><span class="comment">// 程序员 - 只要你能够 1. 写代码 2. 解决bug 其实就是一组方法的集合</span></span><br><span class="line"><span class="keyword">type</span> Programmer <span class="keyword">interface</span> {</span><br><span class="line">    Coding() <span class="keyword">string</span> <span class="comment">//方法只是申明</span></span><br><span class="line">    Debug() <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设计师 - 只要你能够 1. 设计</span></span><br><span class="line"><span class="keyword">type</span> Designer <span class="keyword">interface</span> {</span><br><span class="line">    Design() <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Manger <span class="keyword">interface</span> {</span><br><span class="line">    Programmer <span class="comment">// 接口继承</span></span><br><span class="line">    Designer   <span class="comment">// 接口继承</span></span><br><span class="line">    Manage() <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// java里面一种类型只要继承一个接口 才行 如果你继承了这个接口的话 那么这个接口里面的所有方法你必须要全部实现</span></span><br><span class="line"><span class="keyword">type</span> UIDesigner <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d UIDesigner)</span> <span class="title">Design</span><span class="params">()</span> <span class="title">string</span></span> { <span class="comment">// 外结构体会自动继承匿名内嵌变量的方法</span></span><br><span class="line">    fmt.Println(<span class="string">"我会ui设计"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"我会ui设计"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于Pythoner这个结构体来说 你实现任何方法都可以，但是你只要不全部实现Coding Debug的话 那你Pythoner就不是一个Programmer类型</span></span><br><span class="line"><span class="comment">// Pythoner本身自己就是一个类型 那我何必在意我是不是Programmer</span></span><br><span class="line"><span class="keyword">type</span> Pythoner <span class="keyword">struct</span> {</span><br><span class="line">    UIDesigner          <span class="comment">// 匿名内嵌接口变量，会python也会设计</span></span><br><span class="line">    lib        []<span class="keyword">string</span> <span class="comment">// 属性变量</span></span><br><span class="line">    framework  []<span class="keyword">string</span></span><br><span class="line">    years      <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Gopher <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// go开发者既能开发又能调式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g Gopher)</span> <span class="title">Coding</span><span class="params">()</span> <span class="title">string</span></span> { <span class="comment">// 外结构体会自动继承匿名内嵌变量的方法</span></span><br><span class="line">    fmt.Println(<span class="string">"go开发者"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"go开发者"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g Gopher)</span> <span class="title">Debug</span><span class="params">()</span> <span class="title">string</span></span> { <span class="comment">// 外结构体会自动继承匿名内嵌变量的方法</span></span><br><span class="line">    fmt.Println(<span class="string">"我会go的debug"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"我会go的debug"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// python开发者既能开发又能调式还会管理</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Pythoner)</span> <span class="title">Coding</span><span class="params">()</span> <span class="title">string</span></span> { <span class="comment">// 外结构体会自动继承匿名内嵌变量的方法</span></span><br><span class="line">    fmt.Println(<span class="string">"python开发者"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"python开发者"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Pythoner)</span> <span class="title">Debug</span><span class="params">()</span> <span class="title">string</span></span> { <span class="comment">// 外结构体会自动继承匿名内嵌变量的方法</span></span><br><span class="line">    fmt.Println(<span class="string">"我会python的debug"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"我会python的debug"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Pythoner)</span> <span class="title">Manage</span><span class="params">()</span> <span class="title">string</span></span> { <span class="comment">// 外结构体会自动继承匿名内嵌变量的方法</span></span><br><span class="line">    fmt.Println(<span class="string">"不好意思，管理我也懂"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"不好意思，管理我也懂"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//func (p Pythoner) Design() string {</span></span><br><span class="line"><span class="comment">//    fmt.Println("我是一个python开发者，但是我会ui设计")</span></span><br><span class="line"><span class="comment">//    return "我是一个python开发者，但是我会ui设计"</span></span><br><span class="line"><span class="comment">//}</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 新的语言出来了, 接口帮我们完成了go语言的多态</span></span><br><span class="line">    <span class="keyword">var</span> pro Programmer = Pythoner{}</span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, pro) <span class="comment">// main.Pythoner</span></span><br><span class="line">    pro.Coding()            <span class="comment">// python开发者</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pro3 Programmer</span><br><span class="line">    <span class="keyword">var</span> py3 = Pythoner{}</span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, py3) <span class="comment">// main.Pythoner</span></span><br><span class="line"></span><br><span class="line">    pro3 = py3</span><br><span class="line">    pro3.Coding() <span class="comment">// python开发者</span></span><br><span class="line">    pro3.Debug()  <span class="comment">// 我会python的debug</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pros []Programmer</span><br><span class="line">    pros = <span class="built_in">append</span>(pros, Pythoner{})</span><br><span class="line">    pros = <span class="built_in">append</span>(pros, Gopher{})</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> m Manger = Pythoner{}</span><br><span class="line">    m.Design() <span class="comment">// 我会ui设计</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Fruitable <span class="keyword">interface</span> {</span><br><span class="line">    eat()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Fruit <span class="keyword">struct</span> {</span><br><span class="line">    Name <span class="keyword">string</span>  <span class="comment">// 属性变量</span></span><br><span class="line">    Fruitable  <span class="comment">// 匿名内嵌接口变量</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f Fruit)</span> <span class="title">want</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"I like "</span>)</span><br><span class="line">    f.eat() <span class="comment">// 外结构体会自动继承匿名内嵌的方法</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Apple <span class="keyword">struct</span> {}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a Apple)</span> <span class="title">eat</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"eating apple"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Banana <span class="keyword">struct</span> {}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b Banana)</span> <span class="title">eat</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"eating banana"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> f1 = Fruit{<span class="string">"Apple"</span>, Apple{}}</span><br><span class="line">    <span class="keyword">var</span> f2 = Fruit{<span class="string">"Banana"</span>, Banana{}}</span><br><span class="line">    f1.want() <span class="comment">// I like eating apple</span></span><br><span class="line">    f2.want()<span class="comment">// I like eating banana</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>使用这种方式模拟多态本质上是通过组合属性变量（Name）和接口变量（Fruitable）来做到的，属性变量是对象的数据，而接口变量是对象的功能，将它们组合到一块就形成了一个完整的多态性的结构体。</p>
<h2 id="接口的组合继承"><a href="#接口的组合继承" class="headerlink" title="接口的组合继承"></a>接口的组合继承</h2><p>go语言中并不支持继承<br>接口的定义支持组合继承，比如我们可以将两个接口定义合并为一个接口如下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Smellable <span class="keyword">interface</span> {</span><br><span class="line">    smell()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Eatable <span class="keyword">interface</span> {</span><br><span class="line">    eat()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Fruitable <span class="keyword">interface</span> {</span><br><span class="line">    Smellable</span><br><span class="line">    Eatable</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这时 Fruitable 接口就自动包含了 smell() 和 eat() 两个方法，它和下面的定义是等价的。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Fruitable <span class="keyword">interface</span> {</span><br><span class="line">    smell()</span><br><span class="line">    eat()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="接口变量的赋值"><a href="#接口变量的赋值" class="headerlink" title="接口变量的赋值"></a>接口变量的赋值</h2><ul>
<li>接口类型变量的赋值浅拷贝值传递，</li>
<li>接口变量自带实现者的指针，所以一般用接口类型的值类型就够用了，不用使用接口的指针类型</li>
<li>指针接收者实现只能以指针方式使用，值接受者实现能以指针方式或值使用</li>
<li>接口里面包含的东西是：实现者的类型，实现者的值或指针</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Rect <span class="keyword">struct</span> {</span><br><span class="line">    Width  <span class="keyword">int</span></span><br><span class="line">    Height <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> a <span class="keyword">interface</span>{}</span><br><span class="line">    fmt.Printf(<span class="string">"%T %v %p\n"</span>, a, a, &amp;a) <span class="comment">// &lt;nil&gt; &lt;nil&gt; 0xc000088220</span></span><br><span class="line">    <span class="keyword">var</span> r = Rect{<span class="number">50</span>, <span class="number">50</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"%T %v %p\n"</span>, r, r, &amp;r) <span class="comment">// main.Rect {50 50} 0xc00000a0f0</span></span><br><span class="line"></span><br><span class="line">    a = r</span><br><span class="line">    fmt.Printf(<span class="string">"%T %v %p\n"</span>, a, a, &amp;a) <span class="comment">// main.Rect {50 50} 0xc000088220</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rx = a.(Rect)</span><br><span class="line">    fmt.Printf(<span class="string">"%T %v %p\n"</span>, rx, rx, &amp;rx) <span class="comment">// main.Rect {50 50}} 0xc0000aa0a0</span></span><br><span class="line"></span><br><span class="line">    r.Width = <span class="number">100</span></span><br><span class="line">    r.Height = <span class="number">100</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T %v %p\n"</span>, rx, rx, &amp;rx) <span class="comment">// main.Rect {50 50}} 0xc0000aa0a0</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>从上面的输出结果中可以推断出结构体的内存发生了复制，这个复制可能是因为赋值（a = r）也可能是因为类型转换（rx = a.(Rect)），也可能是两者都进行了内存复制。那能不能判断出究竟在接口变量赋值时有没有发生内存复制呢？不好意思，就目前来说我们学到的知识点还办不到。到后面的高级阶段我们将会使用 unsafe 包来洞悉其中的更多细节。不过我可以提前告诉你们答案是什么，那就是两者都会发生数据内存的复制 —— 浅拷贝。</p>
<h2 id="指向指针的接口变量"><a href="#指向指针的接口变量" class="headerlink" title="指向指针的接口变量"></a>指向指针的接口变量</h2><p>如果将上面的例子改成指针，将接口变量指向结构体指针，那结果就不一样了</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Rect <span class="keyword">struct</span> {</span><br><span class="line">    Width <span class="keyword">int</span></span><br><span class="line">    Height <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> a <span class="keyword">interface</span> {}</span><br><span class="line">    <span class="keyword">var</span> r = Rect{<span class="number">50</span>, <span class="number">50</span>}</span><br><span class="line"></span><br><span class="line">    a = &amp;r <span class="comment">// 指向了结构体指针</span></span><br><span class="line"></span><br><span class="line">    rx1 := a.(*Rect)                         <span class="comment">// 转换成指针类型</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T %v %p\n"</span>, rx1, rx1, &amp;rx1) <span class="comment">// *main.Rect &amp;{100 100} 0xc000006030</span></span><br><span class="line"></span><br><span class="line">    r.Width = <span class="number">100</span></span><br><span class="line">    r.Height = <span class="number">100</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T %v %p\n"</span>, rx1, rx1, &amp;rx1) <span class="comment">// *main.Rect &amp;{100 100} 0xc000006030</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>从输出结果中可以看出指针变量 rx 指向的内存和变量 r 的内存是同一份。因为在类型转换的过程中只发生了指针变量的内存复制，而指针变量指向的内存是共享的。</p>
<h2 id="接口断言"><a href="#接口断言" class="headerlink" title="接口断言"></a>接口断言</h2><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AliOss <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LocalFile <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">store</span><span class="params">(x <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">    <span class="keyword">switch</span> v := x.(<span class="keyword">type</span>) {</span><br><span class="line">    <span class="keyword">case</span> AliOss:</span><br><span class="line">        <span class="comment">// 此处要做一些特殊的处理，我设置阿里云的权限问题</span></span><br><span class="line">        fmt.Println(v)</span><br><span class="line">    <span class="keyword">case</span> LocalFile:</span><br><span class="line">        <span class="comment">// 检查路径的权限</span></span><br><span class="line">        fmt.Println(v)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<hr>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stringer is implemented by any value that has a String method,</span></span><br><span class="line"><span class="comment">// which defines the ``native'' format for that value.</span></span><br><span class="line"><span class="comment">// The String method is used to print values passed as an operand</span></span><br><span class="line"><span class="comment">// to any format that accepts a string or to an unformatted printer</span></span><br><span class="line"><span class="comment">// such as Print.</span></span><br><span class="line"><span class="keyword">type</span> Stringer <span class="keyword">interface</span> {</span><br><span class="line">    String() <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stringer</span><span class="params">(s fmt.Stringer)</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> s.String()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>fmt.Println</code> 和 <code>fmt.Printf</code> 底层都会继承 <code>String()</code></p>
<hr>
<p>以下两个方法都实现了Get方法，所以都实现了这个接口</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test</span></span><br><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Retriever <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Retriever)</span> <span class="title">Get</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"test"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">    test <span class="string">"imooc.com/ccmouse/learngo/lang/basic/branch/b"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回接口类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getRetriever</span><span class="params">()</span> <span class="title">retriever</span></span> {</span><br><span class="line">    <span class="keyword">return</span> test.Retriever{} <span class="comment">//由使用者来定义这个结构体是不是实现了retriever接口，而test.Retriever{}本身并没有和retriever有任何的关系</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口 接口的作用就是</span></span><br><span class="line"><span class="comment">// something can Get</span></span><br><span class="line"><span class="keyword">type</span> retriever <span class="keyword">interface</span> {</span><br><span class="line">    Get(url <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    retriever := getRetriever()                         <span class="comment">// 在这里我不用每次换一个具体的实现就要改很多的代码，getRetriever返回的是一个接口类型，只要有Get的方法，下面的代码就可以运行下去</span></span><br><span class="line">    fmt.Println(retriever.Get(<span class="string">"https://www.imooc.com"</span>)) <span class="comment">// test</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<hr>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//infra</span></span><br><span class="line"><span class="keyword">package</span> infra</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"io/ioutil"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Retriever <span class="keyword">struct</span>{}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Retriever)</span> <span class="title">Get</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">string</span></span> {</span><br><span class="line">    resp, err := http.Get(url)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"error"</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">    bytes, _ := ioutil.ReadAll(resp.Body)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(bytes)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">    infra <span class="string">"imooc.com/ccmouse/learngo/lang/basic/branch/c"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回接口类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getRetriever</span><span class="params">()</span> <span class="title">retriever</span></span> {</span><br><span class="line">    <span class="keyword">return</span> infra.Retriever{} <span class="comment">//由使用者来定义这个结构体是不是实现了retriever接口，而test.Retriever{}本身并没有和retriever有任何的关系</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口 接口的作用就是</span></span><br><span class="line"><span class="comment">// something can Get</span></span><br><span class="line"><span class="keyword">type</span> retriever <span class="keyword">interface</span> {</span><br><span class="line">    Get(url <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    retriever := getRetriever()                         <span class="comment">//在这里我不用每次换一个具体的实现就要改很多的代码，getRetriever返回的是一个接口类型，只要有Get的方法，下面的代码就可以运行下去</span></span><br><span class="line">    fmt.Println(retriever.Get(<span class="string">"https://www.imooc.com"</span>)) <span class="comment">// 输出为下面的html</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>慕课网-程序员的梦工厂<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<hr>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="built_in">real</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">    <span class="string">"net/http/httputil"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Retriever <span class="keyword">struct</span> {</span><br><span class="line">    UserAgent <span class="keyword">string</span></span><br><span class="line">    TimeOut   time.Duration</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Retriever)</span> <span class="title">Get</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">string</span></span> {</span><br><span class="line">    resp, err := http.Get(url)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    result, err := httputil.DumpResponse(</span><br><span class="line">        resp, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(result)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Retriever <span class="keyword">struct</span> {</span><br><span class="line">    Contents <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Retriever)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"Retriever: {Contents=%s}"</span>, r.Contents)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//func (r Retriever) Post(url string, // 值接收者不改变原值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Retriever)</span> <span class="title">Post</span><span class="params">(url <span class="keyword">string</span>, form <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span> <span class="title">string</span></span> {</span><br><span class="line">    r.Contents = form[<span class="string">"contents"</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"ok"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//func (r *Retriever) Get(url string) string {</span></span><br><span class="line"><span class="comment">//    return r.Contents</span></span><br><span class="line"><span class="comment">//}</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Retriever)</span> <span class="title">Get</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> r.Contents</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"imooc.com/ccmouse/learngo/lang/retriever/mock"</span></span><br><span class="line">    <span class="string">"imooc.com/ccmouse/learngo/lang/retriever/real"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Retriever <span class="keyword">interface</span> {</span><br><span class="line">    Get(url <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Poster <span class="keyword">interface</span> {</span><br><span class="line">    Post(url <span class="keyword">string</span>, form <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口组合，只要有一个struct类型实现了 Get Post 他就实现了这个接口</span></span><br><span class="line"><span class="keyword">type</span> RetrieverPoster <span class="keyword">interface</span> {</span><br><span class="line">    Retriever <span class="comment">// 没有其他包的前缀，则就是本包的接口而不是另外一个包同名的结构体</span></span><br><span class="line">    Poster</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">"https://www.imooc.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入一个接口类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(s RetrieverPoster)</span> <span class="title">string</span></span> {</span><br><span class="line">    s.Post(url, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{</span><br><span class="line">        <span class="string">"contents"</span>: <span class="string">"another faked imooc.com"</span>,</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> s.Get(url)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> r Retriever  <span class="comment">// 让调用者来决定用哪个类型</span></span><br><span class="line"></span><br><span class="line">    mockRetriever := mock.Retriever{ <span class="comment">// 有其他包的前缀，则就不是本包的接口而是另外一个包同名的结构体</span></span><br><span class="line">        Contents: <span class="string">"this is a fake imooc.com"</span>}</span><br><span class="line"></span><br><span class="line">    inspect(mockRetriever)</span><br><span class="line">    <span class="comment">//Inspecting {this is a fake imooc.com}</span></span><br><span class="line">    <span class="comment">//&gt; Type:mock.Retriever Value:{this is a fake imooc.com}</span></span><br><span class="line">    <span class="comment">//&gt; Type switch: Contents: this is a fake imooc.com</span></span><br><span class="line"></span><br><span class="line">    inspect(&amp;mockRetriever)</span><br><span class="line">    <span class="comment">// 没有用到自定义的 func (r *Retriever) String() string</span></span><br><span class="line">    <span class="comment">//Inspecting &amp;{this is a fake imooc.com}</span></span><br><span class="line">    <span class="comment">//&gt; Type:*mock.Retriever Value:&amp;{this is a fake imooc.com}</span></span><br><span class="line">    <span class="comment">//&gt; Type switch: Contents: this is a fake imooc.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用到自定义的 func (r *Retriever) String() string {return fmt.Sprintf("Retriever: {Contents=%s}", r.Contents)}</span></span><br><span class="line">    <span class="comment">//Inspecting Retriever: {Contents=this is a fake imooc.com}</span></span><br><span class="line">    <span class="comment">//&gt; Type:*mock.Retriever Value:Retriever: {Contents=this is a fake imooc.com}</span></span><br><span class="line">    <span class="comment">//&gt; Type switch: Contents: this is a fake imooc.com</span></span><br><span class="line"></span><br><span class="line">    r = &amp;<span class="built_in">real</span>.Retriever{</span><br><span class="line">        UserAgent: <span class="string">"Mozilla/5.0"</span>,</span><br><span class="line">        TimeOut:   time.Minute,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    inspect(r)</span><br><span class="line">    <span class="comment">//Inspecting &amp;{Mozilla/5.0 1m0s}</span></span><br><span class="line">    <span class="comment">//&gt; Type:*real.Retriever Value:&amp;{Mozilla/5.0 1m0s}</span></span><br><span class="line">    <span class="comment">//&gt; Type switch: UserAgent: Mozilla/5.0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Type assertion 查看接口类型</span></span><br><span class="line">    <span class="comment">//mockRetriever = r.(mock.Retriever)</span></span><br><span class="line">    <span class="comment">//fmt.Println(mockRetriever.Contents)</span></span><br><span class="line">    <span class="comment">//panic: interface conversion: main.Retriever is *real.Retriever, not mock.Retriever</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mockRetriever, ok := r.(mock.Retriever); ok {</span><br><span class="line">        fmt.Println(mockRetriever.Contents)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(<span class="string">"r is not a mock retriever"</span>) <span class="comment">// r is not a mock retriever 因为r被赋值成&amp;real.Retriever{}</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mockRetriever, ok := r.(*mock.Retriever); ok {</span><br><span class="line">        fmt.Println(mockRetriever.Contents)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(<span class="string">"r is not a mock retriever"</span>) <span class="comment">// r is not a mock retriever 因为r被赋值成&amp;real.Retriever{}</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> realRetriever, ok := r.(*<span class="built_in">real</span>.Retriever); ok {</span><br><span class="line">        fmt.Println(realRetriever.UserAgent, realRetriever.TimeOut) <span class="comment">// Mozilla/5.0 1m0s</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        fmt.Println(<span class="string">"r is not a real retriever"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    fmt.Println(</span><br><span class="line">        <span class="string">"Try a session with mockRetriever"</span>) <span class="comment">// Try a session with mockRetriever</span></span><br><span class="line">    fmt.Println(session(&amp;mockRetriever)) <span class="comment">// another faked imooc.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// fmt.Println(session(mockRetriever))</span></span><br><span class="line">    <span class="comment">// cannot use mockRetriever (type mock.Retriever) as type RetrieverPoster in argument to session:</span></span><br><span class="line">    <span class="comment">// mock.Retriever does not implement RetrieverPoster (Post method has pointer receiver)</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Type switch 查看接口类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inspect</span><span class="params">(r Retriever)</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"Inspecting"</span>, r)              <span class="comment">// 用到自定义的 func (r *Retriever) String() string</span></span><br><span class="line">    fmt.Printf(<span class="string">" &gt; Type:%T Value:%v\n"</span>, r, r) <span class="comment">// 用到自定义的 func (r *Retriever) String() string</span></span><br><span class="line">    fmt.Print(<span class="string">" &gt; Type switch: "</span>)</span><br><span class="line">    <span class="keyword">switch</span> v := r.(<span class="keyword">type</span>) {</span><br><span class="line">    <span class="keyword">case</span> mock.Retriever:</span><br><span class="line">        fmt.Println(<span class="string">"Contents:"</span>, v.Contents)</span><br><span class="line">    <span class="keyword">case</span> *mock.Retriever:</span><br><span class="line">        fmt.Println(<span class="string">"Contents:"</span>, v.Contents)</span><br><span class="line">    <span class="keyword">case</span> *<span class="built_in">real</span>.Retriever:</span><br><span class="line">        fmt.Println(<span class="string">"UserAgent:"</span>, v.UserAgent)</span><br><span class="line">    }</span><br><span class="line">    fmt.Println()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<hr>
<p>常用接口类型<br>Stringer ==&gt; String():定义打印格式<br>Reader ==&gt; Read<br>Writer ==&gt; Write<br>ReaderWriter</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/08/go-jie-gou-ti-biao-qian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/08/go-jie-gou-ti-biao-qian/" class="post-title-link" itemprop="url">go结构体标签</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-07 16:21:41 / 修改时间：14:41:13" itemprop="dateCreated datePublished" datetime="2021-07-07T16:21:41Z">2021-07-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>结构体的字段除了名字和类型外，还可以有一个可选的标签（tag）：<br>它是一个附属于字段的字符串，可以是文档或其他的重要标记。<br>比如在我们解析json或生成json文件时，常用到encoding/json包，它提供一些默认标签，例如：</p>
<ul>
<li><code>omitempty</code>标签可以在序列化的时候忽略0值或者空值。</li>
<li><code>-</code>标签的作用是不进行序列化，其效果和和直接将结构体中的字段写成小写的效果一样。</li>
</ul>
<p>能表述的信息是有限的<br>string是映射成mysql中char类型还是varchar类型还是text类型， 即使能够说明 但是额外的信息 max_length<br>没有标签会采用默认字段的名称作为key</p>
<p>在序列化和反序列化的时候，也支持类型转化等操作。如</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Info <span class="keyword">struct</span> {</span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">    Age  <span class="keyword">int</span>   <span class="string">`json:"age,string"`</span></span><br><span class="line">    <span class="comment">// 这样生成的json对象中，age就为字符串</span></span><br><span class="line">    Sex  <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/json"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Info <span class="keyword">struct</span> {</span><br><span class="line">    Name   <span class="keyword">string</span></span><br><span class="line">    Age    <span class="keyword">int</span> <span class="string">`json:"age,omitempty"`</span></span><br><span class="line">    Weight <span class="keyword">int</span></span><br><span class="line">    height <span class="keyword">int</span></span><br><span class="line">    Gender <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    info := Info{</span><br><span class="line">       Name:   <span class="string">"bobby"</span>,</span><br><span class="line">       Gender: <span class="string">"男"</span>,</span><br><span class="line">    }</span><br><span class="line">    re, _ := json.Marshal(info)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(re)) <span class="comment">// {"Name":"bobby","Weight":0,"Gender":"男"}</span></span><br><span class="line">    <span class="comment">// 小写的height和有标签的age都没有打印，因为没有序列化</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Info1 <span class="keyword">struct</span> {</span><br><span class="line">    Name   <span class="keyword">string</span> <span class="string">`json:"name"`</span> <span class="comment">// 字段转换成指定的name ，也就是转换成小写</span></span><br><span class="line">    Age    <span class="keyword">int</span>    <span class="string">`json:"age,omitempty"`</span></span><br><span class="line">    Gender <span class="keyword">string</span> <span class="string">`json:"-"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    info1 := Info1{</span><br><span class="line">        Name:   <span class="string">"bobby"</span>,</span><br><span class="line">        Gender: <span class="string">"男"</span>,</span><br><span class="line">    }</span><br><span class="line">    re1, _ := json.Marshal(info1)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(re1)) <span class="comment">// {"name":"bobby"} N变n</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>设置自定义的标签，以及如何像官方包一样，可以通过标签，对字段进行自定义处理。<br>要实现这些，我们要用到reflect包。通过反射包去识别这些tag 把结构体的关键信息提取到变量中，java的 spring 底层都是反射<br>具体的应用绝大部分情况之下我们是不需要使用到反射的 实际开发的项目中会用到的</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Info2 <span class="keyword">struct</span> { <span class="comment">// 能表述的信息是有限的</span></span><br><span class="line">    Name   <span class="keyword">string</span> <span class="string">`orm:"name, max_length=17, min_length=5"`</span></span><br><span class="line">    Age    <span class="keyword">int</span>    <span class="string">`orm:"age, min=18, max=70"`</span></span><br><span class="line">    Gender <span class="keyword">string</span> <span class="string">`orm:"gender, required"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    info2 := Info2{</span><br><span class="line">        Name:   <span class="string">"bobby"</span>,</span><br><span class="line">        Gender: <span class="string">"男"</span>,</span><br><span class="line">    }</span><br><span class="line">    re2, _ := json.Marshal(info2)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(re2)) <span class="comment">// {"Name":"bobby","Age":0,"Gender":"男"}</span></span><br><span class="line">    <span class="comment">// 通过反射包去识别这些tag 把结构体的关键信息提取到变量中，获取变量的动态类型</span></span><br><span class="line">    t := reflect.TypeOf(info2)</span><br><span class="line">    fmt.Println(<span class="string">"Type:"</span>, t.Name()) <span class="comment">// Type: Info2 是struct的类型而不是Name类型</span></span><br><span class="line">    fmt.Println(<span class="string">"Kind:"</span>, t.Kind()) <span class="comment">// Kind: struct</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ {</span><br><span class="line">        field := t.Field(i) <span class="comment">//获取结构体的每一个字段</span></span><br><span class="line">        tag := field.Tag.Get(<span class="string">"orm"</span>)</span><br><span class="line">        fmt.Printf(<span class="string">"%d. %v (%v), tag: '%v'\n"</span>, i+<span class="number">1</span>, field.Name, field.Type.Name(), tag)</span><br><span class="line">        <span class="comment">//1. Name (string), tag: 'name, max_length=17, min_length=5'</span></span><br><span class="line">        <span class="comment">//2. Age (int), tag: 'age, min=18, max=70'</span></span><br><span class="line">        <span class="comment">//3. Gender (string), tag: 'gender, required'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/08/go-jie-gou-ti-tong-guo-nei-qian-jie-gou-ti-shi-xian-ji-cheng-de-xiao-guo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/08/go-jie-gou-ti-tong-guo-nei-qian-jie-gou-ti-shi-xian-ji-cheng-de-xiao-guo/" class="post-title-link" itemprop="url">go结构体通过内嵌结构体实现继承的效果</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-07 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-07T16:21:41Z">2021-07-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-09 02:32:19" itemprop="dateModified" datetime="2021-08-09T02:32:19Z">2021-08-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>结构体作为一种变量它可以放进另外一个结构体作为另一个结构体字段的类型<br>这种内嵌结构体的形式在 Go 语言里称之为「组合」。</p>
<p>go语言当中继承：主要是通过类型组合的方式来实现：<br>内嵌一个（或多个）包含想要的行为（字段和方法）的类型；<br>多重继承可以通过内嵌多个类型实现</p>
<p>一个结构体中嵌套另一个结构体，那外面的结构体将直接继承内嵌结构体类型所有字段和方法，这种做法其实就是 语法糖</p>
<h2 id="内嵌有名结构体"><a href="#内嵌有名结构体" class="headerlink" title="内嵌有名结构体"></a>内嵌有名结构体</h2><p>在嵌套结构体时有指定结构体变量名</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Teacher <span class="keyword">struct</span> {</span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Age   <span class="keyword">int</span></span><br><span class="line">    Title <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Teacher)</span> <span class="title">teacherInfo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"姓名:%s, 年龄:%d, 职称:%s\n"</span>, t.Name, t.Age, t.Title)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Course <span class="keyword">struct</span> {</span><br><span class="line">    Teacher Teacher <span class="comment">// 如果讲师的信息比较多怎么办 将另一个结构体的变量放进来</span></span><br><span class="line">    Name    <span class="keyword">string</span></span><br><span class="line">    Price   <span class="keyword">int</span></span><br><span class="line">    Url     <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Course)</span> <span class="title">courseInfo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"课程名:%s, 价格:%d, 讲师信息：%s %d %s\n"</span>, c.Name, c.Price, c.Teacher.Name, c.Teacher.Age, c.Teacher.Title)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">courseInfo1</span><span class="params">(c Course)</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"课程名:%s, 价格:%d, 讲师信息：%s %d %s\n"</span>, c.Name, c.Price, c.Teacher.Name, c.Teacher.Age, c.Teacher.Title)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Teacher)</span> <span class="title">show</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(t.Name, t.Age, t.Title)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    t := Teacher{</span><br><span class="line">        Name:  <span class="string">"bobby"</span>,</span><br><span class="line">        Age:   <span class="number">18</span>,</span><br><span class="line">        Title: <span class="string">"程序员"</span>,</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// var c Course = Course {</span></span><br><span class="line">    c := Course{</span><br><span class="line">        Teacher: t,</span><br><span class="line">        Price:   <span class="number">100</span>,</span><br><span class="line">        Url:     <span class="string">""</span>,</span><br><span class="line">        Name:    <span class="string">"django"</span>,</span><br><span class="line">    }</span><br><span class="line">    c.courseInfo() <span class="comment">// 课程名:django, 价格:100, 讲师信息：bobby 18 程序员</span></span><br><span class="line">    courseInfo1(c) <span class="comment">// 课程名:django, 价格:100, 讲师信息：bobby 18 程序员</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c)                                                   <span class="comment">// {Teacher:{Name:bobby Age:18 Title:程序员} Name:django Price:100 Url:}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c.Teacher)                                           <span class="comment">// {Name:bobby Age:18 Title:程序员}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%s %d %s\n"</span>, c.Teacher.Name, c.Teacher.Age, c.Teacher.Title) <span class="comment">// bobby 18 程序员</span></span><br><span class="line"></span><br><span class="line">    c.Teacher.show() <span class="comment">// bobby 18 程序员</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> userinfo <span class="keyword">struct</span> {</span><br><span class="line">    name      <span class="keyword">string</span></span><br><span class="line">    age       <span class="keyword">int</span></span><br><span class="line">    height    <span class="keyword">float32</span></span><br><span class="line">    eduschool <span class="keyword">string</span></span><br><span class="line">    hobby     []<span class="keyword">string</span></span><br><span class="line">    moreinfo  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Integer <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 后台管理系统中，权限问题，这里涉及了角色，超级管理员，管理员，普通用户</span></span><br><span class="line"><span class="keyword">type</span> role <span class="keyword">struct</span> {</span><br><span class="line">    user          userinfo</span><br><span class="line">    authorization Integer <span class="comment">// 1=超级管理员，2=管理员，3=普通用户</span></span><br><span class="line">}</span><br><span class="line">    superadmin := role{</span><br><span class="line">        user: userinfo{</span><br><span class="line">            name:      <span class="string">"超级管理员"</span>,</span><br><span class="line">            age:       <span class="number">0</span>,</span><br><span class="line">            height:    <span class="number">0</span>,</span><br><span class="line">            eduschool: <span class="string">""</span>,</span><br><span class="line">            hobby:     <span class="literal">nil</span>,</span><br><span class="line">            moreinfo:  <span class="literal">nil</span>,</span><br><span class="line">        },</span><br><span class="line">        authorization: <span class="number">1</span>,</span><br><span class="line">    }</span><br><span class="line">    admin := role{</span><br><span class="line">        user: userinfo{</span><br><span class="line">            name:      <span class="string">"管理员"</span>,</span><br><span class="line">            age:       <span class="number">0</span>,</span><br><span class="line">            height:    <span class="number">0</span>,</span><br><span class="line">            eduschool: <span class="string">""</span>,</span><br><span class="line">            hobby:     <span class="literal">nil</span>,</span><br><span class="line">            moreinfo:  <span class="literal">nil</span>,</span><br><span class="line">        },</span><br><span class="line">        authorization: <span class="number">2</span>,</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(superadmin, admin)</span><br><span class="line">    <span class="comment">//{{超级管理员 0 0  [] map[]} 1} {{管理员 0 0  [] map[]} 2}</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="匿名内嵌结构体"><a href="#匿名内嵌结构体" class="headerlink" title="匿名内嵌结构体"></a>匿名内嵌结构体</h2><p>在嵌套结构体时没有指定结构体变量名</p>
<p>结构体继承访问流程<br>1.先判断字段是否属于子结构体，如果有就访问<br>2.如果没有，继续去找他继承的父结构体，如果有就访问<br>3.如果没有继续去找这个结构体的所继承的结构体，如果有就访问，没有就报错</p>
<p>如果嵌入结构的字段和外部结构或一个结构中继承了多个结构体的字段相同，<br>想要访问或修改嵌入结构的字段值需要必须指定加上外部结构中声明的嵌入结构体变量名或者匿名结构体名</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Course1 <span class="keyword">struct</span> {</span><br><span class="line">    Teacher <span class="comment">// 匿名内嵌结构体：不写参数名称</span></span><br><span class="line">    Name    <span class="keyword">string</span>  <span class="comment">// 属性变量</span></span><br><span class="line">    Price   <span class="keyword">int</span></span><br><span class="line">    Url     <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Course1)</span> <span class="title">courseInfo2</span><span class="params">()</span></span> { <span class="comment">// 外结构体会自动继承匿名内嵌变量的方法</span></span><br><span class="line">    <span class="comment">// c.Teacher.Name的Teacher可以省略，但是Course struct也有Name，重名的字段会取外嵌的字段，所以不省略Teacher</span></span><br><span class="line">    <span class="comment">// c.Teacher.Age, c.Teacher.Title的Teacher都可以省略</span></span><br><span class="line">    fmt.Printf(<span class="string">"课程名:%s, 价格:%d, 讲师信息：%s %d %s\n"</span>, c.Name, c.Price, c.Teacher.Name, c.Age, c.Title)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">courseInfo3</span><span class="params">(c Course1)</span></span> {</span><br><span class="line">    <span class="comment">// c.Teacher.Name的Teacher可以省略，但是Course struct也有Name，重名的字段会取外嵌的字段，所以不省略Teacher</span></span><br><span class="line">    <span class="comment">// c.Teacher.Age, c.Teacher.Title的Teacher都可以省略</span></span><br><span class="line">    fmt.Printf(<span class="string">"课程名:%s, 价格:%d, 讲师信息：%s %d %s\n"</span>, c.Name, c.Price, c.Teacher.Name, c.Age, c.Title)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    c1 := Course1{</span><br><span class="line">        Teacher: t,</span><br><span class="line">        Price:   <span class="number">100</span>,</span><br><span class="line">        Url:     <span class="string">""</span>,</span><br><span class="line">        Name:    <span class="string">"django"</span>,</span><br><span class="line">    }</span><br><span class="line">    c1.courseInfo2() <span class="comment">// 课程名:django, 价格:100, 讲师信息：bobby 18 程序员</span></span><br><span class="line">    courseInfo3(c1)  <span class="comment">// 课程名:django, 价格:100, 讲师信息：bobby 18 程序员</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c1)                                                     <span class="comment">// {Teacher:{Name:bobby Age:18 Title:程序员} Name:django Price:100 Url:}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c1.Teacher)                                             <span class="comment">// {Name:bobby Age:18 Title:程序员}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%s %d %s\n"</span>, c1.Teacher.Name, c1.Teacher.Age, c1.Teacher.Title) <span class="comment">// bobby 18 程序员</span></span><br><span class="line">    <span class="comment">// 继承了字段</span></span><br><span class="line">    fmt.Printf(<span class="string">"%s %d %s\n"</span>, c1.Teacher.Name, c1.Age, c1.Title)                 <span class="comment">// bobby 18 程序员</span></span><br><span class="line"></span><br><span class="line">    c1.Teacher.show() <span class="comment">// bobby 18 程序员</span></span><br><span class="line">    <span class="comment">// 继承了方法</span></span><br><span class="line">    c1.show()         <span class="comment">// bobby 18 程序员</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>继承仅仅是形式上的语法糖，<code>c.show()</code> 被转换成二进制代码后和 <code>c.Teacher.show()</code> 是等价的，<code>c.Age</code> 和 <code>c.Teacher.Age</code> 也是等价的。</p>
<p>支付是一个企业项目变现的重要手段，做为企业应用必不可少的功能，支付系统包括微信支付，支付宝，银联，银行卡京东等等，在开发中如何避免重复代码来实现类似的支付功能？由此引出继承<br>你的系统支持各种类型的支付 每一种支付类型都有统一的接口<br>我们通过封装一个公共的支付结构体，把它做为父类，同时实现4个不同支付平台的结构体，把这4个不同支付平台的结构体做为子类，来实现继承的功能</p>
<p>定一个协议 1. 创建订单 2. 支付 3. 查询支付状态 4. 退款<br>支付发起了<br>你现在有一个缓存 - 这个地方你一开始使用的缓存是redis 但是后期你考虑到可能使用其他的缓存技术 - 本地 memcache<br>如果后期接入一种新的支付 或者取消已有的支付</p>
<p>定义一个model包，新建payment.go文件</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信支付</span></span><br><span class="line"><span class="comment">// 支付宝</span></span><br><span class="line"><span class="comment">// 银联</span></span><br><span class="line"><span class="comment">// 银行卡</span></span><br><span class="line"><span class="keyword">type</span> PaymentArgs <span class="keyword">struct</span> {</span><br><span class="line">    AppID       <span class="keyword">string</span></span><br><span class="line">    MchID       <span class="keyword">string</span></span><br><span class="line">    Key         <span class="keyword">string</span></span><br><span class="line">    CallbackUrl <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在model包，新建Alipay.go文件，这里我们让结构体Alipay 继承 PaymentArgs<br>同一个结构体继承了多个不同的结构体</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Alipay <span class="keyword">struct</span> {</span><br><span class="line">    PaymentArgs               <span class="comment">//匿名结构体，自动拥有PaymentArgs的信息</span></span><br><span class="line">    PaymentOther PaymentOther <span class="comment">//有名结构体</span></span><br><span class="line">    AlipayOpenID <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>main.go文件中这样来实现结构体变量</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">alipay := &amp;model.Alipay{</span><br><span class="line">    PaymentArgs: model.PaymentArgs{</span><br><span class="line">        AppID:       <span class="string">"alipay123"</span>,</span><br><span class="line">        MchID:       <span class="string">"alipaymchid"</span>,</span><br><span class="line">        Key:         <span class="string">"alipayfjkadsfjkasfjas"</span>,</span><br><span class="line">        CallbackUrl: <span class="string">"https://api.imooc.com/alipay"</span>,</span><br><span class="line">    },</span><br><span class="line">    AlipayOpenID: <span class="string">"alipayopenid"</span>,</span><br><span class="line">}</span><br><span class="line">wechatpay := &amp;model.WechatPay{</span><br><span class="line">    PaymentArgs: model.PaymentArgs{</span><br><span class="line">        AppID:       <span class="string">"wechatpay123"</span>,</span><br><span class="line">        MchID:       <span class="string">"wechatpaymchid"</span>,</span><br><span class="line">        Key:         <span class="string">"wechatpayfjkadsfjkasfjas"</span>,</span><br><span class="line">        CallbackUrl: <span class="string">"https://api.imooc.com/wechatpay"</span>,</span><br><span class="line">    },</span><br><span class="line">    WechatOpenID: <span class="string">"wechatpayopenid"</span>,</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在main.go中，如下的访问</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(alipay.PaymentArgs.AppID) <span class="comment">// alipay123</span></span><br><span class="line">fmt.Println(wechatpay.WechatOpenID)   <span class="comment">// wechatpayopenid</span></span><br><span class="line"></span><br><span class="line">alipay.PaymentOther.AppID = <span class="string">"ailpay_paymentother"</span></span><br><span class="line">fmt.Println(alipay.PaymentOther.AppID) <span class="comment">// ailpay_paymentother</span></span><br><span class="line">fmt.Println(alipay.AppID)              <span class="comment">// alipay123 默认继承第一个结构体的字段</span></span><br><span class="line">fmt.Println(alipay.PaymentArgs.AppID)  <span class="comment">// alipay123</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="方法的继承与重载"><a href="#方法的继承与重载" class="headerlink" title="方法的继承与重载"></a>方法的继承与重载</h4><p>为payment.go文件中PaymentArgs结构体增加方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *PaymentArgs)</span> <span class="title">Info</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"Info = %v\n"</span>, p)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这样我们定义的Alipay结构体与WechatPay结构体自动就继承了PaymentArgs的方法<br>我们在main.go中调用</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">paymentArgs := model.PaymentArgs{</span><br><span class="line">    AppID:       <span class="string">"superAppid"</span>,</span><br><span class="line">    MchID:       <span class="string">"superMchid"</span>,</span><br><span class="line">    Key:         <span class="string">"superKey"</span>,</span><br><span class="line">    CallbackUrl: <span class="string">"https://api.imooc.com/super"</span>,</span><br><span class="line">}</span><br><span class="line">paymentArgs.Info()</span><br><span class="line"><span class="comment">//Info = &amp;{superAppid superMchid superKey https://api.imooc.com/super}</span></span><br></pre></td></tr></tbody></table></figure>

<p>同样的我们可以对继承的方法进行重定义<br>在我们的Alipay.go中为Alipay结构体增加重写了Info()方法，</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Alipay)</span> <span class="title">Info</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"alipay = %v\n"</span>, a)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在main.go中调用</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">alipay := &amp;model.Alipay{</span><br><span class="line">    PaymentArgs: model.PaymentArgs{</span><br><span class="line">        AppID:       <span class="string">"alipay123"</span>,</span><br><span class="line">        MchID:       <span class="string">"alipaymchid"</span>,</span><br><span class="line">        Key:         <span class="string">"alipayfjkadsfjkasfjas"</span>,</span><br><span class="line">        CallbackUrl: <span class="string">"https://api.imooc.com/alipay"</span>,</span><br><span class="line">    },</span><br><span class="line">    AlipayOpenID: <span class="string">"alipayopenid"</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//重载info方法</span></span><br><span class="line">alipay.Info()</span><br><span class="line"><span class="comment">//alipay = &amp;{{alipay123 alipaymchid alipayfjkadsfjkasfjas</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> WeChatPay <span class="keyword">struct</span> {</span><br><span class="line">    PaymentArgs</span><br><span class="line">    WeChatOpenID <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Bank <span class="keyword">struct</span> {</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b Bank</span><br><span class="line"><span class="keyword">var</span> a AliPay</span><br><span class="line"><span class="keyword">var</span> w WeChat</span><br></pre></td></tr></tbody></table></figure>

<h4 id="一个内置类型可以做为结构体的匿名字段，这种方式只能在本包访问"><a href="#一个内置类型可以做为结构体的匿名字段，这种方式只能在本包访问" class="headerlink" title="一个内置类型可以做为结构体的匿名字段，这种方式只能在本包访问"></a>一个内置类型可以做为结构体的匿名字段，这种方式只能在本包访问</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StringStruct <span class="keyword">struct</span> {</span><br><span class="line">    <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line">    ss := StringStruct{<span class="string">"hello"</span>}</span><br><span class="line">    fmt.Println(ss.<span class="keyword">string</span>) <span class="comment">// hello</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="Go-语言的结构体没有多态性"><a href="#Go-语言的结构体没有多态性" class="headerlink" title="Go 语言的结构体没有多态性"></a>Go 语言的结构体没有多态性</h2><p>Go 语言不是面向对象语言在于它的结构体不支持多态，它不能算是一个严格的面向对象语言。</p>
<p>下面的例子呈现了 Java 类的多态性。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>{</span><br><span class="line">    System.out.println(<span class="string">"eat fruit"</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enjoy</span><span class="params">()</span> </span>{</span><br><span class="line">    System.out.println(<span class="string">"smell first"</span>);</span><br><span class="line">    eat();</span><br><span class="line">    System.out.println(<span class="string">"clean finally"</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>{</span><br><span class="line">    System.out.println(<span class="string">"eat apple"</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Banana</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>{</span><br><span class="line">    System.out.println(<span class="string">"eat banana"</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    Apple apple = <span class="keyword">new</span> Apple();</span><br><span class="line">    Banana banana = <span class="keyword">new</span> Banana();</span><br><span class="line">    apple.enjoy();</span><br><span class="line">    banana.enjoy();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">----------------</span><br><span class="line">smell first</span><br><span class="line">eat apple</span><br><span class="line">clean <span class="keyword">finally</span></span><br><span class="line">smell first</span><br><span class="line">eat banana</span><br><span class="line">clean <span class="keyword">finally</span></span><br></pre></td></tr></tbody></table></figure>

<p>父类 Fruit 定义的 enjoy 方法调用了子类实现的 eat 方法，子类的方法可以对父类定义的方法进行覆盖，父类的 eat 方法被隐藏起来了。</p>
<p>多态的定义格式与实现方式<br>结构体与自定义类型都可以实现接口中的方法<br>接口的多重继承实现方式</p>
<p>Go 语言的结构体明确不支持这种形式的多态，外结构体的方法不能覆盖内部结构体的方法。</p>
<p>比如我们用 Go 语言来改写上面的水果例子观察一下输出结果。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Fruit <span class="keyword">struct</span> {}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f Fruit)</span> <span class="title">eat</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"eat fruit"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f Fruit)</span> <span class="title">enjoy</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"smell first"</span>)</span><br><span class="line">    f.eat()</span><br><span class="line">    fmt.Println(<span class="string">"clean finally"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Apple <span class="keyword">struct</span> {</span><br><span class="line">    Fruit</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a Apple)</span> <span class="title">eat</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"eat apple"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Banana <span class="keyword">struct</span> {</span><br><span class="line">    Fruit</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b Banana)</span> <span class="title">eat</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"eat banana"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> apple = Apple {}</span><br><span class="line">    <span class="keyword">var</span> banana = Banana {}</span><br><span class="line">    apple.enjoy()</span><br><span class="line">    banana.enjoy()</span><br><span class="line">}</span><br><span class="line">----------</span><br><span class="line">smell first</span><br><span class="line">eat fruit</span><br><span class="line">clean finally</span><br><span class="line">smell first</span><br><span class="line">eat fruit</span><br><span class="line">clean finally</span><br></pre></td></tr></tbody></table></figure>

<p>enjoy 方法调用的 eat 方法还是 Fruit 自己的 eat 方法，它没能被外面的结构体方法覆盖掉。这意味着面向对象的代码习惯不能直接用到 Go 语言里了，我们需要转变思维。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/08/go-tong-guo-jie-kou-xie-yi-qu-li-jie-sort-de-ben-zhi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/08/go-tong-guo-jie-kou-xie-yi-qu-li-jie-sort-de-ben-zhi/" class="post-title-link" itemprop="url">go通过接口协议去理解sort的本质</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-07 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-07T16:21:41Z">2021-07-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-09 07:09:55" itemprop="dateModified" datetime="2021-07-09T07:09:55Z">2021-07-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sort sorts data.</span></span><br><span class="line"><span class="comment">// It makes one call to data.Len to determine n and O(n*log(n)) calls to</span></span><br><span class="line"><span class="comment">// data.Less and data.Swap. The sort is not guaranteed to be stable.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sort</span><span class="params">(data Interface)</span></span> {</span><br><span class="line">    n := data.Len()</span><br><span class="line">    quickSort(data, <span class="number">0</span>, n, maxDepth(n))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// An implementation of Interface can be sorted by the routines in this package.</span></span><br><span class="line"><span class="comment">// The methods refer to elements of the underlying collection by integer index.</span></span><br><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> {</span><br><span class="line">    <span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">    Len() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Less reports whether the element with index i</span></span><br><span class="line">    <span class="comment">// must sort before the element with index j.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// If both Less(i, j) and Less(j, i) are false,</span></span><br><span class="line">    <span class="comment">// then the elements at index i and j are considered equal.</span></span><br><span class="line">    <span class="comment">// Sort may place equal elements in any order in the final result,</span></span><br><span class="line">    <span class="comment">// while Stable preserves the original input order of equal elements.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Less must describe a transitive ordering:</span></span><br><span class="line">    <span class="comment">//  - if both Less(i, j) and Less(j, k) are true, then Less(i, k) must be true as well.</span></span><br><span class="line">    <span class="comment">//  - if both Less(i, j) and Less(j, k) are false, then Less(i, k) must be false as well.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Note that floating-point comparison (the &lt; operator on float32 or float64 values)</span></span><br><span class="line">    <span class="comment">// is not a transitive ordering when not-a-number (NaN) values are involved.</span></span><br><span class="line">    <span class="comment">// See Float64Slice.Less for a correct implementation for floating-point values.</span></span><br><span class="line">    Less(i, j <span class="keyword">int</span>) <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">    Swap(i, j <span class="keyword">int</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Course <span class="keyword">struct</span> {</span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Price <span class="keyword">int</span></span><br><span class="line">    Url   <span class="keyword">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Courses []Course <span class="comment">// 基于slice创建新的类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Courses)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(c)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Courses)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> {</span><br><span class="line">    <span class="keyword">return</span> c[i].Price &lt; c[j].Price</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Courses)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    c[i], c[j] = c[j], c[i]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//通过sort来排序</span></span><br><span class="line">    <span class="comment">//让你写一个排序算法， 冒泡 插入 快速 归并 桶排序 算法本质是一样 比较 计数排序</span></span><br><span class="line">    <span class="comment">//你的排序算法是否能应付各种类型的排序</span></span><br><span class="line">    courses := Courses{ <span class="comment">// 切片</span></span><br><span class="line">        Course{<span class="string">"django"</span>, <span class="number">300</span>, <span class="string">""</span>},</span><br><span class="line">        Course{<span class="string">"scrapy"</span>, <span class="number">100</span>, <span class="string">""</span>},</span><br><span class="line">        Course{<span class="string">"go"</span>, <span class="number">400</span>, <span class="string">""</span>},</span><br><span class="line">        Course{<span class="string">"torando"</span>, <span class="number">200</span>, <span class="string">""</span>},</span><br><span class="line">    }</span><br><span class="line">    sort.Sort(courses) <span class="comment">//协议 你的目的不是要告诉别人具体的类型，重要的是你的类型必要提供具体的方法</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> courses {</span><br><span class="line">        fmt.Println(v)</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//{scrapy 100 }</span></span><br><span class="line">    <span class="comment">//{torando 200 }</span></span><br><span class="line">    <span class="comment">//{django 300 }</span></span><br><span class="line">    <span class="comment">//{go 400 }</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/08/rpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/08/rpc/" class="post-title-link" itemprop="url">RPC</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-07 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-07T16:21:41Z">2021-07-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 02:51:39" itemprop="dateModified" datetime="2021-07-11T02:51:39Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/07/go-de-type/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/07/go-de-type/" class="post-title-link" itemprop="url">go的type</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-06 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-06T16:21:41Z">2021-07-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-07 11:32:46" itemprop="dateModified" datetime="2021-08-07T11:32:46Z">2021-08-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li>给一个类型定义别名，实际上为什么会有byte，就是我为了强调我们现在处理的对象是字节类型</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//这种别名实际上还是为了代码的可读性， 这个实际上本质上仍然是uint8 无非就是在代码编码阶段可读性强而已</span></span><br><span class="line">    <span class="keyword">type</span> myByte = <span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">var</span> a myByte</span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, a) <span class="comment">// uint8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b <span class="keyword">uint8</span></span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, b) <span class="comment">// uint8</span></span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>第二种 就是基于一个已有的类型定义一个新的类型</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> intVariables <span class="keyword">int</span></span><br><span class="line">fmt.Printf(<span class="string">"%T\n"</span>, intVariables) <span class="comment">// int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myIntVariables myInt</span><br><span class="line">fmt.Printf(<span class="string">"%T\n"</span>, myIntVariables) <span class="comment">// main.myInt</span></span><br><span class="line"></span><br><span class="line">fmt.Println(intVariables, myIntVariables) <span class="comment">// 0 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于一种类型去创建另一种类型，被认为是两种不同的类型</span></span><br><span class="line"><span class="comment">//intVariables = myIntVariables // cannot use myIntVariables (type myInt) as type int in assignment</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如何赋值？类型转换</span></span><br><span class="line">intVariables = <span class="keyword">int</span>(myIntVariables)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> integer <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> intVariables <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> integerVariables integer</span><br><span class="line">fmt.Println(intVariables, integerVariables) <span class="comment">// 0 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于一种类型去创建另一种类型，被认为是两种不同的类型</span></span><br><span class="line"><span class="comment">//intVariables = integerVariables // cannot use integerVariables (type integer) as type int in assignment</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如何赋值？类型转换</span></span><br><span class="line">intVariables = <span class="keyword">int</span>(integerVariables)</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>定义结构体</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Course <span class="keyword">struct</span> {</span><br><span class="line">    name  <span class="keyword">string</span></span><br><span class="line">    price <span class="keyword">int</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol start="4">
<li>定义接口</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Callable <span class="keyword">interface</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol start="5">
<li>定义函数别名</li>
</ol>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> handle <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span></span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/07/go-jie-gou-ti-de-can-shu-chuan-di-he-fang-fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/07/go-jie-gou-ti-de-can-shu-chuan-di-he-fang-fa/" class="post-title-link" itemprop="url">go结构体的参数传递和方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-06 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-06T16:21:41Z">2021-07-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-14 01:16:46" itemprop="dateModified" datetime="2021-08-14T01:16:46Z">2021-08-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>变量赋值本质上是一次内存浅拷贝，<br>切片的赋值是拷贝了切片头，<br>字符串的赋值是拷贝了字符串的头部，<br>数组的赋值呢是直接拷贝整个数组。</p>
<h2 id="结构体的拷贝-值类型"><a href="#结构体的拷贝-值类型" class="headerlink" title="结构体的拷贝 值类型"></a>结构体的拷贝 值类型</h2><p>结构体之间可以相互赋值，它在本质上是一次浅拷贝操作，拷贝了结构体内部的所有字段。<br>结构体指针之间也可以相互赋值，它在本质上也是一次浅拷贝操作，不过它拷贝的仅仅是指针地址值，结构体的内容是共享的。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//var c9 Course = Course{"scrapy", 110, "https://www.imooc.com"}</span></span><br><span class="line">    c9 := Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line"></span><br><span class="line">    <span class="comment">//var c10 Course = c9</span></span><br><span class="line">    c10 := c9</span><br><span class="line">    fmt.Println(c9)  <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10) <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"c9 = %p,c10 = %p\n"</span>, &amp;c9, &amp;c10)</span><br><span class="line">    <span class="comment">//c9 = 0xc000100280,c10 = 0xc0001002d0</span></span><br><span class="line"></span><br><span class="line">    c9.Price = <span class="number">200</span></span><br><span class="line">    fmt.Println(c9)  <span class="comment">// {scrapy 200 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10) <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9) <span class="comment">// {Name:scrapy Price:200 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//var c9 *Course = &amp;Course{"scrapy", 110, "https://www.imooc.com"}</span></span><br><span class="line">    c9 := &amp;Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line"></span><br><span class="line">    <span class="comment">//var c10 *Course = c9</span></span><br><span class="line">    c10 := c9</span><br><span class="line">    fmt.Println(c9)          <span class="comment">// &amp;{scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10)         <span class="comment">// &amp;{scrapy 110 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9)  <span class="comment">// &amp;{Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// &amp;{Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    c9.Price = <span class="number">200</span></span><br><span class="line">    fmt.Println(c9)          <span class="comment">// &amp;{scrapy 200 https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c10)         <span class="comment">// &amp;{scrapy 200 https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c9)  <span class="comment">// &amp;{Name:scrapy Price:200 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c10) <span class="comment">// &amp;{Name:scrapy Price:200 Url:https://www.imooc.com}</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>Go 语言中同时有函数和方法。<br>方法有哪些作用呢 给用户定义的类型添加新的行为</p>
<p>结构体就像是类的一种简化形式，那么面向对象程序员可能会问：类的方法在哪里呢？在 Go 中有一个概念，它和方法有着同样的名字，并且大体上意思相同：<br>声明时，在关键字func 和函数名之间增加了一个参数，这个参数被称作接收者，将函数与接收者的类型绑在一起。<br>如果一个函数有接收者，这个作用在接收者（receiver）上的一个函数就被称为方法。</p>
<p>接收者是某种类型的变量<br>接受者可以是命名类型或者结构体类型的一个值或者是一个任何其他允许类型的指针。<br>但是接收者不能是一个指针类型</p>
<p>指针方法和值方法都可以在指针或非指针上被调用，<br>Go 语言里有两种类型的接收者：值接收者，指针接收者<br>接收者是值类型的时候，调用者可以是值类型，也可以是引用类型<br>接收者是一个指针类型，调用者可以是值类型，也可以指针类型<br>接收者类型可以是（几乎）任何类型，结构体类型、函数类型、int、bool、string 或数组的别名类型。</p>
<p>接收者不能是一个接口类型的变量，因为接口是一类事物的抽象定义，而方法是某个具体事物的实现，如果这样做会引发一个编译错误：invalid receiver type…。</p>
<p>一个类型加上它的方法等价于面向对象中的一个类。一个重要的区别是：在 Go 中，类型的代码和绑定在它上面的方法的代码可以不放置在一起，它们可以存在在不同的源文件，唯一的要求是：它们必须是同一个包的。</p>
<p>所有给定类型 T（或 *T）上的所有方法的集合叫做该类型 T（或 *T）的方法集。</p>
<p>因为方法是函数，所以同样的，不允许方法重载，即对于一个类型只能有一个给定名称的方法。但是如果基于接收者类型，是有重载的：具有同样名字的方法可以在 2 个或多个不同的接收者类型上存在，比如在同一个包里这么做是允许的：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *denseMatrix)</span> <span class="title">Add</span><span class="params">(b Matrix)</span> <span class="title">Matrix</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *sparseMatrix)</span> <span class="title">Add</span><span class="params">(b Matrix)</span> <span class="title">Matrix</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>别名类型不能有它原始类型上已经定义过的方法。</p>
<p>定义方法的一般格式如下：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(recv receiver_type)</span> <span class="title">methodName</span><span class="params">(parameter_list)</span> <span class="params">(return_value_list)</span></span> {</span><br><span class="line">    ... <span class="comment">/* 方法体*/</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在方法名之前，<code>func</code> 关键字之后的括号中指定 receiver。</p>
<p>如果 <code>recv</code> 是 receiver 的实例，<code>recv</code> 方法的接收者对应的变量名，就像是面向对象语言中的 <code>this</code> 或 <code>self</code> <code>me</code>，但是 Go 中并没有 self 和 this 这样的关键字来指代当前的对象。<br>通常我们都使用单个字母来表示。</p>
<p>GO推荐的标准命名<a target="_blank" rel="noopener" href="https://github.com/golang/go/wiki/CodeReviewComments#receiver-names">https://github.com/golang/go/wiki/CodeReviewComments#receiver-names</a></p>
<blockquote>
<p>The name of a method’s receiver should be a reflection of its identity; often a one or two letter abbreviation of its type suffices (such as “c” or “cl” for “Client”). Don’t use generic names such as “me”, “this” or “self”, identifiers typical of object-oriented languages that gives the method a special meaning. In Go, the receiver of a method is just another parameter and therefore, should be named accordingly. The name need not be as descriptive as that of a method argument, as its role is obvious and serves no documentary purpose. It can be very short as it will appear on almost every line of every method of the type; familiarity admits brevity. Be consistent, too: if you call the receiver “c” in one method, don’t call it “cl” in another.</p>
</blockquote>
<p>方法接受者名称应反映其身份， 并且不要使用me, this, self这些面向对象语言的典型标志符。在JetBrains系类的开发工具中（IntelliJ、Goland）如果方法接收者名字是self me this类似的词，IDE会提示Receiver has generic name信息</p>
<p>在go中方法接受者其实就是方法的另一个参数。</p>
<p>Method1 是它的方法名，那么方法调用遵循传统的 <code>object.name</code> 选择器符号：recv.Method1()。</p>
<p>如果 <code>recv</code> 一个指针，Go 会自动解引用。方法可以改变接收者的值（或状态），这点函数也可以做到（当参数作为指针传递，即通过引用调用时，函数也可以改变参数的状态）。</p>
<p>如果方法不需要使用 <code>recv</code> 的值，可以用 <code>_</code> 替换它，比如：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(_ receiver_type)</span> <span class="title">methodName</span><span class="params">(parameter_list)</span> <span class="params">(return_value_list)</span></span> {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>receiver_type</code> 叫做 （接收者）基本类型，这个类型必须在和方法同样的包中被声明。</p>
<h3 id="函数和方法的区别"><a href="#函数和方法的区别" class="headerlink" title="函数和方法的区别"></a>函数和方法的区别</h3><p>无论是方法还是函数都可以把他作为一个普通的函数来调用<br>函数将变量作为参数：<code>Function1(recv)</code>  <code>函数名（参数列表）</code><br>方法在变量上被调用：<code>recv.Method1()</code> <code>调用者.方法名（参数）</code></p>
<p>不要忘记 <code>Method1</code> 后边的括号 <code>()</code>，否则会引发编译器错误：<code>method recv.Method1 is not an expression, must be called</code></p>
<p>接收者必须有一个显式的名字，这个名字必须在方法中被使用。</p>
<p>在 Go 中，（接收者）类型关联的方法不写在类型结构里面，就像类那样；耦合更加宽松；类型和方法之间的关联由接收者来建立。</p>
<p>方法没有和数据定义（结构体）混在一起：它们是正交的类型；表示（数据）和行为（方法）是独立的。</p>
<p>Go的方法只是语法糖而已，本质还是第一个参数是接收者receiver普通函数<br>在 Go 中为实体增加方法，理解成前面的参是第一个形参，然后用这个参在给这个 func 增加限定作用域会更好理解。</p>
<p>比如给对象加方法，其他语言都是在 class 的 block 内写func，而 Go 是在 struct 的 block 块外加 func，是没有 this 或者 self 的语境的，更像是给一个实体额外挂上一个 func。</p>
<p>值接受者vs指针接受者</p>
<ul>
<li>要改变内容必须使用指针接受者</li>
<li>结构过大考虑指针接受者</li>
<li>一致性：如有指针接收者，最好都是指针接收者</li>
<li>值接收者是 go语言特有</li>
<li>值/指针接收者均可接收值/指针</li>
</ul>
<h3 id="结构体方法"><a href="#结构体方法" class="headerlink" title="结构体方法"></a>结构体方法</h3><p>定义一个结构体类型和该类型的一个方法</p>
<p>Go 语言不是面向对象的语言，它里面不存在类的概念，结构体正是类的替代品。<br>类可以附加很多成员方法，结构体也可以。</p>
<p>Go 语言不喜欢类型的隐式转换，所以需要将整形显示转换成浮点型，不是很好看，不过这就是 Go 语言的基本规则，显式的代码可能不够简洁，但是易于理解。</p>
<p>Go 语言的方法名称也分首字母大小写，它的权限规则和字段一样，</p>
<ul>
<li>首字母大写就是公开方法，</li>
<li>首字母小写就是内部方法，只能归属于同一个包的代码才可以访问内部方法。</li>
</ul>
<p>结构体的参数传递</p>
<p>函数调用时参数传递结构体变量<br>值传递涉及到结构体字段的浅拷贝，<br>指针传递会共享结构体内容，只会拷贝指针地址，规则上和赋值是等价的。</p>
<p>接收者有两种形式 1. 值传递 2. 指针传递 如果你想改结构体的值 如果结构体的数据很大</p>
<p>通过值传递，在函数里面修改结构体的状态不会影响到原有结构体的状态，函数内部的逻辑并没有产生任何效果。通过指针传递就不一样。</p>
<p>结构体的值类型和指针类型访问内部字段和方法在形式上是一样的。这点不同于 C++ 语言，在 C++ 语言里，值访问使用句点 . 操作符，而指针访问需要使用箭头 -&gt; 操作符。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TwoInts <span class="keyword">struct</span> {</span><br><span class="line">    a <span class="keyword">int</span></span><br><span class="line">    b <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    two1 := <span class="built_in">new</span>(TwoInts)</span><br><span class="line">    two1.a = <span class="number">12</span></span><br><span class="line">    two1.b = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">"The sum is: %d\n"</span>, two1.AddThem()) <span class="comment">// The sum is: 22</span></span><br><span class="line">    fmt.Printf(<span class="string">"Add them to the param: %d\n"</span>, two1.AddToParam(<span class="number">20</span>)) <span class="comment">// Add them to the param: 42</span></span><br><span class="line"></span><br><span class="line">    two2 := TwoInts{<span class="number">3</span>, <span class="number">4</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"The sum is: %d\n"</span>, two2.AddThem()) <span class="comment">// The sum is: 7</span></span><br><span class="line">    fmt.Printf(<span class="string">"The sum is: %d\n"</span>, (&amp;two2).AddThem()) <span class="comment">// The sum is: 7</span></span><br><span class="line">    <span class="comment">// fmt.Printf("The sum is: %d\n", (*two2).AddThem()) // invalid indirect of two2 (type TwoInts)</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tn *TwoInts)</span> <span class="title">AddThem</span><span class="params">()</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">return</span> tn.a + tn.b</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tn *TwoInts)</span> <span class="title">AddToParam</span><span class="params">(param <span class="keyword">int</span>)</span> <span class="title">int</span></span> {</span><br><span class="line">    <span class="keyword">return</span> tn.a + tn.b + param</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>接收者类型是 *TwoInts 的方法 AddThem()，它能在类型 TwoInts 的值上被调用，这是自动间接发生的。</p>
<p>因此 <code>two2.AddThem</code> 可以替代 <code>(&amp;two2).AddThem()</code>。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数的接收者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Course)</span> <span class="title">printCourseInfo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"课程名:%s, 课程价格: %d, 课程的地址:%s\n"</span>, c.Name, c.Price, c.Url)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Course)</span> <span class="title">setPrice</span><span class="params">(price <span class="keyword">int</span>)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = price</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setPrice1</span><span class="params">(c Course)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = <span class="number">800</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Course)</span> <span class="title">setPricePoint</span><span class="params">(price <span class="keyword">int</span>)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = price <span class="comment">// 等同于(*c).Price = price</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setPricePoint1</span><span class="params">(c *Course)</span></span> { <span class="comment">// c相当于python的self，也可以写成self</span></span><br><span class="line">    c.Price = <span class="number">800</span> <span class="comment">// 等同于(*c).Price = 800</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//结构体方法， 达到了封装数据和封装方法的效果</span></span><br><span class="line">    c11 := Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line">    c11.printCourseInfo()       <span class="comment">// 课程名:scrapy, 课程价格: 200, 课程的地址:https://www.imooc.com</span></span><br><span class="line">    Course.printCourseInfo(c11) <span class="comment">// 课程名:scrapy, 课程价格: 200, 课程的地址:https://www.imooc.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结构体是值传递，不改变原来的值</span></span><br><span class="line">    c11.setPrice(<span class="number">200</span>)</span><br><span class="line">    <span class="comment">//Course.setPrice(c11, 200)</span></span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 110</span></span><br><span class="line">    fmt.Println(c11)       <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line"></span><br><span class="line">    setPrice1(c11)</span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 110</span></span><br><span class="line">    fmt.Println(c11)       <span class="comment">// {scrapy 110 https://www.imooc.com}</span></span><br><span class="line"></span><br><span class="line">    (&amp;c11).setPrice(<span class="number">300</span>)   <span class="comment">//修改c10的price? 为什么呢？ 语法糖 函数参数的传递是怎么传递的？</span></span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 110</span></span><br><span class="line"></span><br><span class="line">    c11.setPricePoint(<span class="number">200</span>)</span><br><span class="line">    <span class="comment">//Course.setPricePoint(c11, 200)</span></span><br><span class="line">    fmt.Println(c11.Price)    <span class="comment">// 200</span></span><br><span class="line">    (&amp;c11).setPricePoint(<span class="number">300</span>) <span class="comment">//修改c10的price? 为什么呢？ 语法糖 函数参数的传递是怎么传递的？</span></span><br><span class="line">    fmt.Println(c11.Price)    <span class="comment">// 300</span></span><br><span class="line"></span><br><span class="line">    (&amp;c11).setPricePoint(<span class="number">400</span>) <span class="comment">//修改c10的price? 为什么呢？ 语法糖 函数参数的传递是怎么传递的？</span></span><br><span class="line">    <span class="comment">// 结构体是值传递</span></span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 400</span></span><br><span class="line"></span><br><span class="line">    setPricePoint1(&amp;c11)</span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">// 800</span></span><br><span class="line">    fmt.Println(c11)       <span class="comment">// {scrapy 800 https://www.imooc.com}</span></span><br><span class="line"></span><br><span class="line">    setPricePoint1(*c11)</span><br><span class="line">    fmt.Println(c11.Price) <span class="comment">//</span></span><br><span class="line">    fmt.Println(c11)       <span class="comment">//</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> {</span><br><span class="line">    Radius <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该 method 属于 Circle 类型对象中的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">Area</span><span class="params">()</span> <span class="title">float64</span></span> { <span class="comment">// 面积</span></span><br><span class="line">    <span class="comment">// c.Radius 即为 Circle 类型对象中的属性</span></span><br><span class="line">    <span class="keyword">return</span> math.Pi * <span class="keyword">float64</span>(c.Radius) * <span class="keyword">float64</span>(c.Radius)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该 method 属于 Circle 类型对象中的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">Circumference</span><span class="params">()</span> <span class="title">float64</span></span> { <span class="comment">// 周长</span></span><br><span class="line">    <span class="comment">// c.Radius 即为 Circle 类型对象中的属性</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * math.Pi * <span class="keyword">float64</span>(c.Radius)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// var c1 Circle</span></span><br><span class="line">    <span class="comment">// c1.Radius = 10.00</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> c = Circle {Radius: <span class="number">50</span>}</span><br><span class="line">    fmt.Println(c.Area(), c.Circumference())</span><br><span class="line">    <span class="comment">// 7853.981633974483 314.1592653589793</span></span><br><span class="line">    <span class="comment">// 指针变量调用方法形式上是一样的</span></span><br><span class="line">    <span class="keyword">var</span> pc = &amp;c</span><br><span class="line">    fmt.Println(pc.Area(), pc.Circumference())</span><br><span class="line">    <span class="comment">// 7853.981633974483 314.1592653589793</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="结构体指针方法"><a href="#结构体指针方法" class="headerlink" title="结构体指针方法"></a>结构体指针方法</h3><p>鉴于性能的原因，<code>recv</code> 最常见的是一个指向 receiver_type 的指针（因为我们不想要一个实例的拷贝，如果按值调用的话就会是这样），特别是在 receiver 类型是结构体时，就更是如此了。</p>
<p>如果想要方法改变接收者的数据，就在接收者的指针类型上定义该方法。否则，就在普通的值类型上定义方法。</p>
<p>结构体指针方法和值方法在调用时形式上是没有区别的，只不过一个可以改变结构体内部状态、类型的属性，而另一个不会。指针方法使用结构体值变量可以调用，值方法使用结构体指针变量也可以调用。<br>通过指针访问内部的字段需要 2 次内存读取操作，第一步是取得指针地址，第二部是读取地址的内容，它比值访问要慢。但是在方法调用时，指针传递可以避免结构体的拷贝操作，结构体比较大时，这种性能的差距就会比较明显。</p>
<p>如果使用上面的方法形式给 Circle 增加一个扩大半径的方法，你会发现半径扩大不了。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">expand</span><span class="params">()</span></span> {</span><br><span class="line">  c.Radius *= <span class="number">2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这是因为上面的方法和前面的 expandByValue 函数是等价的，只不过是把函数的第一个参数挪了位置而已，参数传递时会复制了一份结构体内容，起不到扩大半径的效果。这时候就必须要使用结构体的指针方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Circle)</span> <span class="title">expand</span><span class="params">()</span></span> {</span><br><span class="line">  c.Radius *= <span class="number">2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>还有一些特殊的结构体它不允许被复制，比如结构体内部包含有锁时，这时就必须使用它的指针形式来定义方法，否则会发生一些莫名其妙的问题。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  {</span><br><span class="line">   <span class="keyword">var</span> c Circle</span><br><span class="line">   fmt.Println(c.radius)</span><br><span class="line">   c.radius = <span class="number">10.00</span></span><br><span class="line">   fmt.Println(c.getArea())</span><br><span class="line">   c.changeRadius(<span class="number">20</span>)</span><br><span class="line">   fmt.Println(c.radius)</span><br><span class="line">   change(&amp;c, <span class="number">30</span>)</span><br><span class="line">   fmt.Println(c.radius)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">getArea</span><span class="params">()</span> <span class="title">float64</span></span>  {</span><br><span class="line">   <span class="keyword">return</span> c.radius * c.radius</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 注意如果想要更改成功c的值，这里需要传指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Circle)</span> <span class="title">changeRadius</span><span class="params">(radius <span class="keyword">float64</span>)</span></span>  {</span><br><span class="line">   c.radius = radius</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下操作将不生效</span></span><br><span class="line"><span class="comment">//func (c Circle) changeRadius(radius float64)  {</span></span><br><span class="line"><span class="comment">//   c.radius = radius</span></span><br><span class="line"><span class="comment">//}</span></span><br><span class="line"><span class="comment">// 引用类型要想改变值需要传指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">change</span><span class="params">(c *Circle, radius <span class="keyword">float64</span>)</span></span>  {</span><br><span class="line">   c.radius = radius</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">type</span> miniaction <span class="keyword">struct</span> {</span><br><span class="line">    name   <span class="keyword">string</span> <span class="comment">// 接口名称 热销商品，某一个分类下的商品列表</span></span><br><span class="line">    router <span class="keyword">string</span> <span class="comment">// 路由地址 https://api.imooc.com/hotproduct</span></span><br><span class="line">    action <span class="keyword">string</span> <span class="comment">// 路由对应的方法名 func hotproduct() {}</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为结构体增加方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mini miniaction)</span> <span class="title">getMiniInfo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"mini.name=%s,mini.router=%s,mini.action=%s\n"</span>, mini.name, mini.router, mini.action)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为结构体增加方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *miniaction)</span> <span class="title">miniInfo</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"mini.name=%s,mini.router=%s,mini.action=%s\n"</span>, this.name, this.router, this.action)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    mini1 := miniaction{</span><br><span class="line">        name:   <span class="string">"获取商品列表"</span>,</span><br><span class="line">        router: <span class="string">"productList"</span>,</span><br><span class="line">        action: <span class="string">"productList()"</span>,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    mini2 := &amp;miniaction{</span><br><span class="line">        name:   <span class="string">"获取分类下的商品列表"</span>,</span><br><span class="line">        router: <span class="string">"productListByCategory"</span>,</span><br><span class="line">        action: <span class="string">"productListByCategory()"</span>,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收者有两种，一种是值类型，一种是指针类型</span></span><br><span class="line">    <span class="comment">//接收者是值类型的时候，调用者可以是值类型，也可以是引用类型</span></span><br><span class="line">    mini1.getMiniInfo()</span><br><span class="line">    <span class="comment">//mini.name=获取商品列表,mini.router=productList,mini.action=productList()</span></span><br><span class="line"></span><br><span class="line">    mini2.getMiniInfo()</span><br><span class="line">    <span class="comment">//mini.name=获取分类下的商品列表,mini.router=productListByCategory,mini.action=productListByCategory()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收者是一个指针类型，调用者可以是值类型，也可以指针类型</span></span><br><span class="line">    mini2.miniInfo()</span><br><span class="line">    <span class="comment">//mini.name=获取分类下的商品列表,mini.router=productListByCategory,mini.action=productListByCategory()</span></span><br><span class="line">    (*mini2).miniInfo()</span><br><span class="line">    <span class="comment">//mini.name=获取分类下的商品列表,mini.router=productListByCategory,mini.action=productListByCategory()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//(&amp;mini2).miniInfo() // calling method miniInfo with receiver &amp;mini2 (type **miniaction) requires explicit dereference</span></span><br><span class="line"></span><br><span class="line">    mini1.miniInfo()</span><br><span class="line">    <span class="comment">//mini.name=获取商品列表,mini.router=productList,mini.action=productList()</span></span><br></pre></td></tr></tbody></table></figure>

<p>接收者类型是 *miniaction 的方法 miniInfo()，它能在类型 miniaction 的值上被调用，这是自动间接发生的。</p>
<p>定义的方法只能通过指定的类型来调用，不能像函数一样来调用</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">miniInfo() <span class="comment">// undefined: miniInfo</span></span><br></pre></td></tr></tbody></table></figure>

<p>自定义类型也可以做为方法的接收者</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> float <span class="keyword">float32</span> <span class="comment">// 自定义类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为自定义类型定义方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(radius float)</span> <span class="title">getCircleAround</span><span class="params">()</span> <span class="title">float</span></span> {</span><br><span class="line">    <span class="keyword">return</span> radius * <span class="number">3.14</span> * <span class="number">2</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个自定义的类型并调用方法</span></span><br><span class="line">    <span class="keyword">var</span> radius float = <span class="number">2</span></span><br><span class="line">    fmt.Println(radius.getCircleAround()) <span class="comment">// 12.56</span></span><br></pre></td></tr></tbody></table></figure>

<p>下面的例子：<br><code>change()</code> 接受一个指向 B 的指针，并改变它内部的成员；<br><code>write()</code> 接受通过拷贝接受 B 的值并只输出 B 的内容。<br>注意 Go 为我们做了探测工作，我们自己并没有指出是否在指针上调用方法，Go 替我们做了这些事情。b1 是值而 b2 是指针，方法都支持运行了。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> {</span><br><span class="line">    thing <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">change</span><span class="params">()</span></span> { b.thing = <span class="number">1</span> }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b B)</span> <span class="title">write</span><span class="params">()</span> <span class="title">string</span></span> { <span class="keyword">return</span> fmt.Sprint(b) }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> b1 B <span class="comment">// b1是值</span></span><br><span class="line">    b1.change()</span><br><span class="line">    fmt.Println(b1.write()) <span class="comment">// {1}</span></span><br><span class="line"></span><br><span class="line">    b2 := <span class="built_in">new</span>(B) <span class="comment">// b2是指针</span></span><br><span class="line">    b2.change()</span><br><span class="line">    fmt.Println(b2.write()) <span class="comment">// {1}</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>试着在 <code>write()</code> 中改变接收者 b 的值：将会看到它可以正常编译，但是开始的 b 没有被改变。</p>
<p>我们知道方法将指针作为接收者不是必须的，如下面的例子，我们只是需要 <code>Point3</code> 的值来做计算：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Point3 <span class="keyword">struct</span> { x, y, z <span class="keyword">float64</span> }</span><br><span class="line"><span class="comment">// A method on Point3</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Point3)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> {</span><br><span class="line">    <span class="keyword">return</span> math.Sqrt(p.x*p.x + p.y*p.y + p.z*p.z)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这样做稍微有点昂贵，因为 Point3 是作为值传递给方法的，因此传递的是它的拷贝，这在 Go 中合法的。也可以在指向这个类型的指针上调用此方法（会自动解引用）。</p>
<p>假设 p3 定义为一个指针：p3 := &amp;Point{ 3, 4, 5}。</p>
<p>可以使用 p3.Abs() 来替代 (*p3).Abs()。</p>
<p>在值和指针上调用方法：</p>
<p>可以有连接到类型的方法，也可以有连接到类型指针的方法。</p>
<p>但是这没关系：对于类型 T，如果在 *T 上存在方法 Meth()，并且 t 是这个类型的变量，那么 <code>t.Meth()</code> 会被自动转换为 <code>(&amp;t).Meth()</code>。</p>
<p>如下面程序所示，类型 List 在值上有一个方法 Len()，在指针上有一个方法 Append()，但是可以看到两个方法都可以在两种类型的变量上被调用。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> List []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l List)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span>        { <span class="keyword">return</span> <span class="built_in">len</span>(l) }</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Append</span><span class="params">(val <span class="keyword">int</span>)</span></span> { *l = <span class="built_in">append</span>(*l, val) }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 值</span></span><br><span class="line">    <span class="keyword">var</span> lst List</span><br><span class="line">    lst.Append(<span class="number">1</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"%v (len: %d)"</span>, lst, lst.Len()) <span class="comment">// [1] (len: 1)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指针</span></span><br><span class="line">    plst := <span class="built_in">new</span>(List)</span><br><span class="line">    plst.Append(<span class="number">2</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"%v (len: %d)"</span>, plst, plst.Len()) <span class="comment">// &amp;[2] (len: 1)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="非结构体类型上方法"><a href="#非结构体类型上方法" class="headerlink" title="非结构体类型上方法"></a>非结构体类型上方法</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切片类型</span></span><br><span class="line"><span class="keyword">type</span> intArr []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arr intArr)</span> <span class="title">swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    arr[i], arr[j] = arr[j], arr[i]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    list := intArr{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">    fmt.Println(<span class="string">"原始数据："</span>, list)</span><br><span class="line">    list.swap(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">    fmt.Println(<span class="string">"处理后的数据:"</span>, list)</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line">原始数据： [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>]</span><br><span class="line">处理后的数据: [<span class="number">5</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组类型</span></span><br><span class="line"><span class="keyword">type</span> intArr [<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(arr intArr)</span> <span class="title">swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    arr[i], arr[j] = arr[j], arr[i]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    list := intArr{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">    fmt.Println(<span class="string">"原始数据："</span>, list)</span><br><span class="line">    list.swap(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">    fmt.Println(<span class="string">"处理后的数据:"</span>, list)</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line">原始数据： [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>]</span><br><span class="line">处理后的数据: [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>为类型绑定方法的时候，所有的接收者 (receiver) 都是采用的值类型的方式。<br>切片是引用数组的内存地址，所以改变后值也改变，而数组这种值类型会拷贝一个新的数组，所以不会影响原数组。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IntVector []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v IntVector)</span> <span class="title">Sum</span><span class="params">()</span> <span class="params">(s <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="keyword">for</span> _, x := <span class="keyword">range</span> v {</span><br><span class="line">        s += x</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(IntVector{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}.Sum()) <span class="comment">// 输出是6</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"container/list"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *list.List)</span> <span class="title">Iter</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    lst := <span class="built_in">new</span>(list.List)</span><br><span class="line">    <span class="keyword">for</span> _= <span class="keyword">range</span> lst.Iter() {</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// lst.Iter undefined (type *list.List has no field or method Iter)</span></span><br></pre></td></tr></tbody></table></figure>

<p>类型和作用在它上面定义的方法必须在同一个包里定义，这就是为什么不能在 int、float 或类似这些的类型上定义方法。<br>试图在 int 类型上定义方法会得到一个编译错误：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m <span class="keyword">int</span>)</span> <span class="title">toString</span><span class="params">()</span></span> {</span><br><span class="line">}</span><br><span class="line"><span class="comment">// cannot define new methods on non-local type int</span></span><br></pre></td></tr></tbody></table></figure>

<p>内置的int类型不能加方法，</p>
<p>类型在其他的，或是非本地的包里定义，在它上面定义方法都会得到和上面同样的错误。</p>
<p>但是有一个间接的方式：可以先定义该类型（比如：int 或 float）的别名类型，然后再为别名类型定义方法。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m myInt)</span> <span class="title">toString</span><span class="params">()</span></span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// T ...</span></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Println ...</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span> <span class="title">Println</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"value: %v"</span>, t)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    t := T(<span class="number">1</span>) <span class="comment">// 除了{}还可以()</span></span><br><span class="line">    t.Println()</span><br><span class="line">    T.Println(t) <span class="comment">// receiver作为函数的第一个参数，这个时候发生值拷贝，</span></span><br><span class="line">    <span class="comment">// 所以方法内部的t变量只是真实t变量的一个拷贝，这和this的含义是不相符的</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line">value: <span class="number">1</span></span><br><span class="line">value: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>比如想在 time.Time 上定义如下方法：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t time.Time)</span> <span class="title">first3Chars</span><span class="params">()</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> time.LocalTime().String()[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>或者像下面这样将它作为匿名类型嵌入在一个新的结构体中。当然方法只在这个别名类型上有效。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> myTime <span class="keyword">struct</span> {</span><br><span class="line">    time.Time <span class="comment">//anonymous field</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t myTime)</span> <span class="title">first3Chars</span><span class="params">()</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> t.Time.String()[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    m := myTime{time.Now()}</span><br><span class="line">    <span class="comment">// 调用匿名Time上的String方法</span></span><br><span class="line">    fmt.Println(<span class="string">"Full time now:"</span>, m.String())</span><br><span class="line">    <span class="comment">// 调用myTime.first3Chars</span></span><br><span class="line">    fmt.Println(<span class="string">"First 3 chars:"</span>, m.first3Chars())</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line">Full time now: Mon Oct <span class="number">24</span> <span class="number">15</span>:<span class="number">34</span>:<span class="number">54</span> Romance Daylight Time <span class="number">2011</span></span><br><span class="line">First <span class="number">3</span> chars: Mon</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Test ...</span></span><br><span class="line"><span class="keyword">type</span> Test <span class="keyword">struct</span> {</span><br><span class="line">    A <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetA ...</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Test)</span> <span class="title">SetA</span><span class="params">(a <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    t.A = a</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetA1 ...</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Test)</span> <span class="title">SetA1</span><span class="params">(a <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    t.A = a</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    t := Test{</span><br><span class="line">        A: <span class="number">3</span>,</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(<span class="string">"demo1:"</span>)</span><br><span class="line">    fmt.Println(t.A)</span><br><span class="line">    t.SetA(<span class="number">5</span>)</span><br><span class="line">    fmt.Println(t.A)</span><br><span class="line">    t1 := Test{</span><br><span class="line">        A: <span class="number">4</span>,</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(<span class="string">"demo2:"</span>)</span><br><span class="line">    fmt.Println(t1.A)</span><br><span class="line">    (&amp;t1).SetA1(<span class="number">6</span>)</span><br><span class="line">    fmt.Println(t1.A)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line">demo1:</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">demo2:</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></tbody></table></figure>

<p>当receiver不是指针时调用SetA其值根本没有改变。</p>
<p>因为Go中都是值传递，所以你如果对SetA的receiver的名称命名为this, self等，它就已经失去了本身的意义——“调用一个对象的方法就是向该对象传递一条消息”。而且对象本身的属性也并不一定会发生改变。</p>
<h3 id="封装的使用"><a href="#封装的使用" class="headerlink" title="封装的使用"></a>封装的使用</h3><h4 id="外部包中的结构体首字母小写"><a href="#外部包中的结构体首字母小写" class="headerlink" title="外部包中的结构体首字母小写"></a>外部包中的结构体首字母小写</h4><p>通过引入外部包小写字母开头的私有的结构体来实现封装，引入了工厂方法来实现</p>
<p>定义一个model包，新建userinfo.go文件，这里我们将结构体userInfo首字母小写</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> userInfo <span class="keyword">struct</span> {</span><br><span class="line">    Name      <span class="keyword">string</span></span><br><span class="line">    Age       <span class="keyword">int</span></span><br><span class="line">    Height    <span class="keyword">float32</span></span><br><span class="line">    Eduschool <span class="keyword">string</span></span><br><span class="line">    Hobby     []<span class="keyword">string</span></span><br><span class="line">    MoreInfo  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>main.go文件中执行如下代码即会报错</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="comment">//"../model"</span></span><br><span class="line">    <span class="string">"learninggo/model"</span></span><br><span class="line">)</span><br><span class="line">    boge := model.userInfo{</span><br><span class="line">        Name:      <span class="string">"波哥"</span>,</span><br><span class="line">        Age:       <span class="number">18</span>,</span><br><span class="line">        Height:    <span class="number">181</span>,</span><br><span class="line">        Eduschool: <span class="string">"北京邮电大学"</span>,</span><br><span class="line">        Hobby:     []<span class="keyword">string</span>{<span class="string">"coding"</span>, <span class="string">"运动"</span>},</span><br><span class="line">        MoreInfo:  <span class="literal">nil</span>,</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//cannot refer to unexported name model.userInfo</span></span><br></pre></td></tr></tbody></table></figure>

<p>那如果外部包想访问这个结构体，如何来操作，这里就需要引入软件编程设计模式中的工厂模式了，工厂就如同现实中的工厂用于生产产品，在软件工程当中，工厂模式就是用于生成对象。这里建立工厂函数NewUserInfo，习惯以New开头</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工厂模式：生成对象</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUserInfo</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>, height <span class="keyword">float32</span>, eduschool <span class="keyword">string</span>, hobby []<span class="keyword">string</span>, moreinfo <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{})</span> *<span class="title">userInfo</span></span> {</span><br><span class="line">    <span class="keyword">return</span> &amp;userInfo{</span><br><span class="line">        Name:      name,</span><br><span class="line">        Age:       age,</span><br><span class="line">        Height:    height,</span><br><span class="line">        Eduschool: eduschool,</span><br><span class="line">        Hobby:     hobby,</span><br><span class="line">        MoreInfo:  moreinfo,</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>main.go文件中执行如下代码正确</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boge := model.NewUserInfo(<span class="string">"波哥"</span>, <span class="number">18</span>, <span class="number">181</span>, <span class="string">"北京邮电大学"</span>, []<span class="keyword">string</span>{<span class="string">"coding"</span>, <span class="string">"运动"</span>}, <span class="literal">nil</span>)</span><br><span class="line">fmt.Printf(<span class="string">"boge的信息=%v\n"</span>, boge)</span><br><span class="line"><span class="comment">//boge的信息=&amp;{波哥 18 181 北京邮电大学 [coding 运动] map[]}</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="外部包中的结构体字段首字母小写"><a href="#外部包中的结构体字段首字母小写" class="headerlink" title="外部包中的结构体字段首字母小写"></a>外部包中的结构体字段首字母小写</h4><p>字段首字母小写它是非导出的，即外部的包方法无法访问调用。<br>如果包中的结构体中某些变量，我们不希望外部实体直接访问，也就是说对外部的包来说他是一个私有的， 可是我们又想获取或者设置对应的数据，如何操作？<br>前面我们讲解方法接收者时有讲解过，我们可以从面向对象语言特性中得到启发，也就是面向对象中提供的 getter 和 setter 方法。<br>对于 setter 方法使用 Set 前缀，对于 getter 方法只使用成员名，这样就形成了对我们数据的保护，称为对数据的封装。</p>
<p>通过引入外部包结构体中小写字母开头的私有字段来实现封装，我们引入gettter和setter 方法。</p>
<p>工作中的应用<br>比如产品的价格，我们不希望外部数据直接进行修改，因为这些数据很重要，但是我们可以提供一个接口告知使用者，你想修改我商品的价格，可以，但是必须按我的规定来，比如商品的价格必须在某个范围之内，这些是在接口中事先封装好的，不在这个范围，则拒绝修改。</p>
<p>go语言不支持面向对象，没有构造函数的说法，如果要想达到这个封装的效果 那么就一定要解决 1. 变量的封装 2. 方法的封装</p>
<p>引入前面包的知识，定义一个 model包，新建product.go文件，<br>类型 Product 被明确的导出了，结构体Product中的两个字段首字母小写的字段没有被导出。<br>例如在 main.go 中 p.productName 就是错误的。<br>该如何在另一个程序中修改或者只是读取一个 Product 的名字呢？</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Product <span class="keyword">struct</span> {</span><br><span class="line">    productName  <span class="keyword">string</span></span><br><span class="line">    productPrice <span class="keyword">float32</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//getter setter</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Product)</span> <span class="title">SetProductName</span><span class="params">(newProductName <span class="keyword">string</span>)</span></span> {</span><br><span class="line">    p.productName = newProductName</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Product)</span> <span class="title">GetProductName</span><span class="params">()</span> <span class="title">string</span></span> {</span><br><span class="line">    <span class="keyword">return</span> p.productName</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>main.go文件中执行如下代码正确</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"../model"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    product := &amp;model.Product{}</span><br><span class="line">    product.SetProductName(<span class="string">"波哥go语言体系课"</span>)</span><br><span class="line">    fmt.Println(product.GetProductName()) <span class="comment">// 波哥go语言体系课</span></span><br><span class="line"></span><br><span class="line">    p := <span class="built_in">new</span>(model.Product)</span><br><span class="line">    <span class="comment">// p.productName = "Go入门"  // undefined (cannot refer to unexported field or method productName)</span></span><br><span class="line">    p.SetProductName(<span class="string">"Go入门"</span>)</span><br><span class="line">    fmt.Println(p.GetProductName()) <span class="comment">// Go入门</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Receiver是可以为nil的"><a href="#Receiver是可以为nil的" class="headerlink" title="Receiver是可以为nil的"></a>Receiver是可以为nil的</h3><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> {</span><br><span class="line">    v <span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *A)</span> <span class="title">test</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(a == <span class="literal">nil</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *A)</span> <span class="title">testV</span><span class="params">()</span></span> {</span><br><span class="line">    fmt.Println(a.v)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> a *A</span><br><span class="line">    a.test()</span><br><span class="line">    a.testV()</span><br><span class="line">}</span><br><span class="line">---</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="built_in">panic</span>: runtime error: invalid memory address or <span class="literal">nil</span> pointer dereference</span><br><span class="line">[signal <span class="number">0xc0000005</span> code=<span class="number">0x0</span> addr=<span class="number">0x0</span> pc=<span class="number">0xf7a6f</span>]</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">main.(*A).testV(...)</span><br></pre></td></tr></tbody></table></figure>

<p>a.test()能够正常输出，只有在处理变量结构体内部变量v才报出panic！！！Receiver是方法的第一个参数，所以仅仅作为参数传递时即使是nil也能够正常调用函数，而在真正使用的地方报出panic。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> {</span><br><span class="line">    Value       <span class="keyword">int</span></span><br><span class="line">    Left, Right *Node</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintFunc</span><span class="params">(node Node)</span></span> {</span><br><span class="line">    <span class="comment">//fmt.Print(node.Value, " ")</span></span><br><span class="line">    fmt.Println(node.Value)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给结构定义方法</span></span><br><span class="line"><span class="comment">// (node treeNode):接受者 这个参数也是传值</span></span><br><span class="line"><span class="comment">// 和普通函数没有区别</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(node Node)</span> <span class="title">PrintMethod</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//fmt.Print(node.Value, " ")</span></span><br><span class="line">    fmt.Println(node.Value)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// node是传值，所以修改是没有作用的</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(node Node)</span> <span class="title">SetValue</span><span class="params">(value <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    node.Value = value</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指针才可以改变结构内容</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(node *Node)</span> <span class="title">SetValuePtr</span><span class="params">(value <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> {</span><br><span class="line">        fmt.Println(<span class="string">"Setting Value to nil "</span> +</span><br><span class="line">            <span class="string">"node. Ignored."</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    node.Value = value <span class="comment">// 等同于(*node).Value = value</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义工厂函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateNode</span><span class="params">(value <span class="keyword">int</span>)</span> *<span class="title">Node</span></span> {</span><br><span class="line">    <span class="keyword">return</span> &amp;Node{Value: value} <span class="comment">// 返回函数体里面建立一个局部变量的地址</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中序</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(node *Node)</span> <span class="title">traverse</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    node.Left.traverse()</span><br><span class="line">    node.PrintMethod()</span><br><span class="line">    node.Right.traverse()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> root Node</span><br><span class="line">    fmt.Println(root) <span class="comment">// {0 &lt;nil&gt; &lt;nil&gt;}</span></span><br><span class="line">    root = Node{Value: <span class="number">3</span>}</span><br><span class="line">    root.Left = &amp;Node{}</span><br><span class="line">    root.Right = &amp;Node{<span class="number">5</span>, <span class="literal">nil</span>, <span class="literal">nil</span>}</span><br><span class="line">    root.Right.Left = <span class="built_in">new</span>(Node)</span><br><span class="line"></span><br><span class="line">    nodes := []Node{</span><br><span class="line">        {Value: <span class="number">3</span>},</span><br><span class="line">        {},</span><br><span class="line">        {<span class="number">6</span>, <span class="literal">nil</span>, &amp;root},</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(nodes) <span class="comment">// [{3 &lt;nil&gt; &lt;nil&gt;} {0 &lt;nil&gt; &lt;nil&gt;} {6 &lt;nil&gt; 0xc00000c080}]</span></span><br><span class="line"></span><br><span class="line">    PrintFunc(root)    <span class="comment">// 3</span></span><br><span class="line">    root.PrintMethod() <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    root.Left.Right = CreateNode(<span class="number">2</span>)</span><br><span class="line">    root.SetValue(<span class="number">5</span>)</span><br><span class="line">    fmt.Println(root) <span class="comment">// {3 0xc0000040a8 0xc0000040c0}</span></span><br><span class="line"></span><br><span class="line">    root.SetValuePtr(<span class="number">6</span>)</span><br><span class="line">    fmt.Println(root) <span class="comment">// {6 0xc0000040a8 0xc0000040c0}</span></span><br><span class="line"></span><br><span class="line">    root.PrintMethod() <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line">    Ptr := &amp;root</span><br><span class="line">    Ptr.PrintMethod() <span class="comment">// 6</span></span><br><span class="line">    Ptr.SetValuePtr(<span class="number">8</span>)</span><br><span class="line">    Ptr.PrintMethod() <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(root) <span class="comment">// {8 0xc0000040a8 0xc0000040c0}</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// nil指针可以调用方法 但是会报错，</span></span><br><span class="line">    <span class="keyword">var</span> pRoot *Node</span><br><span class="line">    pRoot.SetValuePtr(<span class="number">1</span>) <span class="comment">// Setting Value to nil node. Ignored.</span></span><br><span class="line">    pRoot = &amp;root</span><br><span class="line">    pRoot.SetValuePtr(<span class="number">2</span>)</span><br><span class="line">    pRoot.PrintMethod() <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//      2</span></span><br><span class="line"><span class="comment">//   /   \</span></span><br><span class="line"><span class="comment">// 0      5</span></span><br><span class="line"><span class="comment">//  \    /</span></span><br><span class="line"><span class="comment">//   2  0</span></span><br><span class="line"></span><br><span class="line">    root.traverse()</span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 5</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(node *Node)</span> <span class="title">Traverse</span><span class="params">()</span></span> {</span><br><span class="line">    node.TraverseFunc(<span class="function"><span class="keyword">func</span><span class="params">(n *Node)</span></span> {</span><br><span class="line">        n.PrintMethod()</span><br><span class="line">    })</span><br><span class="line">    fmt.Println()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入一个函数 这样就可以对遍历过程中的节点做任意的事情</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(node *Node)</span> <span class="title">TraverseFunc</span><span class="params">(f <span class="keyword">func</span>(*Node)</span>)</span> {</span><br><span class="line">    <span class="keyword">if</span> node == <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    node.Left.TraverseFunc(f)</span><br><span class="line">    f(node)</span><br><span class="line">    node.Right.TraverseFunc(f)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"imooc.com/ccmouse/learngo/lang/tree"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用组合扩展类型</span></span><br><span class="line"><span class="keyword">type</span> myTreeNode <span class="keyword">struct</span> {</span><br><span class="line">    node *tree.Node <span class="comment">// 包含原有要扩展的类型，然后在他的基础上，扩展自己想要的功能</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(myNode *myTreeNode)</span> <span class="title">postOrder</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">if</span> myNode == <span class="literal">nil</span> || myNode.node == <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// myTreeNode{myNode.node.Left}.postOrder() // Cannot call a pointer method on 'myTreeNode{myNode.node.Left}'</span></span><br><span class="line"></span><br><span class="line">    left := myTreeNode{myNode.node.Left}</span><br><span class="line">    right := myTreeNode{myNode.node.Right}</span><br><span class="line"></span><br><span class="line">    left.postOrder()</span><br><span class="line">    right.postOrder()</span><br><span class="line">    myNode.node.PrintMethod()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> root tree.Node</span><br><span class="line"></span><br><span class="line">    root = tree.Node{Value: <span class="number">3</span>}</span><br><span class="line">    root.Left = &amp;tree.Node{}</span><br><span class="line">    root.Right = &amp;tree.Node{<span class="number">5</span>, <span class="literal">nil</span>, <span class="literal">nil</span>}</span><br><span class="line">    root.Right.Left = <span class="built_in">new</span>(tree.Node)</span><br><span class="line">    root.Left.Right = tree.CreateNode(<span class="number">2</span>)</span><br><span class="line">    root.Right.Left.SetValuePtr(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Print(<span class="string">"In-order traversal: "</span>)</span><br><span class="line">    root.Traverse()</span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    <span class="comment">// 4</span></span><br><span class="line">    <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">    fmt.Print(<span class="string">"My own post-order traversal: "</span>)</span><br><span class="line">    myRoot := myTreeNode{&amp;root}</span><br><span class="line">    myRoot.postOrder()</span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 4</span></span><br><span class="line">    <span class="comment">// 5</span></span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    nodeCount := <span class="number">0</span></span><br><span class="line">    root.TraverseFunc(<span class="function"><span class="keyword">func</span><span class="params">(node *tree.Node)</span></span> {</span><br><span class="line">        nodeCount++</span><br><span class="line">    })</span><br><span class="line">    fmt.Println(<span class="string">"Node count:"</span>, nodeCount) <span class="comment">// Node count: 5</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(node *Node)</span> <span class="title">TraverseWithChannel</span><span class="params">()</span> <span class="title">chan</span> *<span class="title">Node</span></span> {</span><br><span class="line">    out := <span class="built_in">make</span>(<span class="keyword">chan</span> *Node)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        node.TraverseFunc(<span class="function"><span class="keyword">func</span><span class="params">(node *Node)</span></span> {</span><br><span class="line">            out &lt;- node</span><br><span class="line">        })</span><br><span class="line">        <span class="built_in">close</span>(out)</span><br><span class="line">    }()</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    c := root.TraverseWithChannel()</span><br><span class="line">    maxNodeValue := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> node := <span class="keyword">range</span> c {</span><br><span class="line">        <span class="keyword">if</span> node.Value &gt; maxNodeValue {</span><br><span class="line">            maxNodeValue = node.Value</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(<span class="string">"Max node value:"</span>, maxNodeValue) <span class="comment">// Max node value: 5</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"imooc.com/ccmouse/learngo/lang/tree"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用内嵌 实质上是省略成员名 将成员变量从包中带过来(包括方法和成员变量)</span></span><br><span class="line"><span class="keyword">type</span> myTreeNode <span class="keyword">struct</span> {</span><br><span class="line">    *tree.Node <span class="comment">// Embedding</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(myNode *myTreeNode)</span> <span class="title">postOrder</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">if</span> myNode == <span class="literal">nil</span> || myNode.Node == <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// left := myTreeNode{myNode.Node.Left} 类型的最后一个点的后面是他的名字</span></span><br><span class="line">    left := myTreeNode{myNode.Left} <span class="comment">// 也可以直接省略.Node</span></span><br><span class="line">    right := myTreeNode{myNode.Right}</span><br><span class="line"></span><br><span class="line">    left.postOrder()</span><br><span class="line">    right.postOrder()</span><br><span class="line">    myNode.PrintMethod()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">//var root tree.Node</span></span><br><span class="line">    <span class="comment">//root = tree.Node{Value: 3}</span></span><br><span class="line"></span><br><span class="line">    root := myTreeNode{&amp;tree.Node{Value: <span class="number">3</span>}}</span><br><span class="line">    root.Left = &amp;tree.Node{}</span><br><span class="line">    root.Right = &amp;tree.Node{<span class="number">5</span>, <span class="literal">nil</span>, <span class="literal">nil</span>}</span><br><span class="line">    root.Right.Left = <span class="built_in">new</span>(tree.Node)</span><br><span class="line">    root.Left.Right = tree.CreateNode(<span class="number">2</span>)</span><br><span class="line">    root.Right.Left.SetValue(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Print(<span class="string">"In-order traversal: "</span>)</span><br><span class="line">    root.Traverse()</span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    <span class="comment">// 4</span></span><br><span class="line">    <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">    fmt.Print(<span class="string">"My own post-order traversal: "</span>)</span><br><span class="line">    <span class="comment">//myRoot := myTreeNode{&amp;root}</span></span><br><span class="line">    <span class="comment">//myRoot.postOrder()</span></span><br><span class="line">    root.postOrder()</span><br><span class="line">    <span class="comment">// 2</span></span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 5</span></span><br><span class="line">    <span class="comment">// 3</span></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//var baseRoot *tree.Node</span></span><br><span class="line">    <span class="comment">// 把子类的指针赋值给一个基类父类的指针，java可以go不可以，go语言要通过接口而不是类的继承实现</span></span><br><span class="line">    <span class="comment">//baseRoot := &amp;root // cannot use &amp;root (type *myTreeNode) as type *tree.Node in assignment</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> queue</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用别名扩展类型</span></span><br><span class="line"><span class="comment">// A FIFO queue.</span></span><br><span class="line"><span class="keyword">type</span> Queue []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Pushes the element into the queue.</span></span><br><span class="line"><span class="comment">//         e.g. q.Push(123)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">Push</span><span class="params">(v <span class="keyword">int</span>)</span></span> {</span><br><span class="line">    *q = <span class="built_in">append</span>(*q, v)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pops element from head.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">int</span></span> {</span><br><span class="line">    head := (*q)[<span class="number">0</span>]</span><br><span class="line">    *q = (*q)[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Returns if the queue is empty or not.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(*q) == <span class="number">0</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"imooc.com/ccmouse/learngo/lang/queue"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    q := queue.Queue{<span class="number">1</span>}</span><br><span class="line"></span><br><span class="line">    q.Push(<span class="number">2</span>)</span><br><span class="line">    q.Push(<span class="number">3</span>)</span><br><span class="line">    fmt.Println(q.Pop())     <span class="comment">// 1</span></span><br><span class="line">    fmt.Println(q.Pop())     <span class="comment">// 2</span></span><br><span class="line">    fmt.Println(q.IsEmpty()) <span class="comment">// false</span></span><br><span class="line">    fmt.Println(q.Pop())     <span class="comment">// 3</span></span><br><span class="line">    fmt.Println(q.IsEmpty()) <span class="comment">// true</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/07/07/go-jie-gou-ti-de-shi-li-hua-he-new-han-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/07/go-jie-gou-ti-de-shi-li-hua-he-new-han-shu/" class="post-title-link" itemprop="url">go结构体的实例化和new函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-06 16:21:41" itemprop="dateCreated datePublished" datetime="2021-07-06T16:21:41Z">2021-07-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-07 11:08:12" itemprop="dateModified" datetime="2021-08-07T11:08:12Z">2021-08-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>结构体和其它高级语言里的「类」比较类似。<br>go语言没有class这个概念，所以说对于很多人来说会少理解很多面向对象抽象的概念</p>
<p>如果说 Go 语言的基础类型是原子，那么结构体就是分子。分子是原子的组合，让形式有限的基础类型变化出丰富多样的形态结构。</p>
<p>结构体字段可以是任何类型，以及结构体本身，函数，接口、切片、字典、数组以及其它类型的结构体等等。<br>因为结构体的存在，Go 语言的变量才有了更加丰富多彩的形式，Go 语言程序的高楼大厦正是通过结构体一层层组装起来的。</p>
<p>go语言的struct更像是namedtuple, 尽量配置简单的语法尽量猜测你的意图，<br>只能存放数据的集合，有成员变量属性的名称，不能定义函数<br>结构体是值类型，通过组合一定数据的字段来完成<br>用于自定义数据类型与实现面向对象</p>
<p>结构体类型是某一类具体事物的抽象<br>以中秋节的月饼举例，月饼的模板，做出月饼</p>
<p>结构创建在堆上还是栈上？ 不需要知道</p>
<p>结构体命名<br>采用驼峰命名法，首字母根据访问控制大写或者小写</p>
<h2 id="结构体类型的定义"><a href="#结构体类型的定义" class="headerlink" title="结构体类型的定义"></a>结构体类型的定义</h2><p>struct 申明格式采用多行</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多行申明</span></span><br><span class="line"><span class="keyword">type</span> userinfo <span class="keyword">struct</span> {</span><br><span class="line">    name      <span class="keyword">string</span></span><br><span class="line">    age       <span class="keyword">int</span></span><br><span class="line">    height    <span class="keyword">float32</span></span><br><span class="line">    eduschool <span class="keyword">string</span></span><br><span class="line">    hobby     []<span class="keyword">string</span></span><br><span class="line">    moreinfo  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Course结构体内部有三个变量，分别是价格、课程名、url。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Course <span class="keyword">struct</span> {</span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Price <span class="keyword">int</span></span><br><span class="line">    Url   <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 结构体变量的实例化创建</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">创建一个结构体变量有多种形式，</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我们先看结构体变量最常见的创建形式</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### KV 形式</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">通过显示指定结构体内部字段的名称和初始值来初始化结构体，可以只指定部分字段的初值，甚至可以一个字段都不指定，那些没有指定初值的字段会自动初始化为相应类型的「零值」。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">不论地址还是结构本身，一律使用 `</span>.<span class="string">` 来访问成员</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br><span class="line">    <span class="keyword">var</span> c Course = Course{</span><br><span class="line">        Name:  <span class="string">"django"</span>,</span><br><span class="line">        Price: <span class="number">100</span>,</span><br><span class="line">        Url:   <span class="string">"https://www.imooc.com"</span>,  <span class="comment">// 注意这里的逗号不能少</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 访问</span></span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c) <span class="comment">// {Name:django Price:100 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c.Name, c.Price, c.Url) <span class="comment">//django 100 https://www.imooc.com</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 Course = Course{</span><br><span class="line">    Name: <span class="string">"django"</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问</span></span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, c1)                <span class="comment">// {Name:django Price:0 Url:}</span></span><br><span class="line">fmt.Println(c1.Name, c1.Price, c1.Url) <span class="comment">// django 0</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bobo userinfo</span><br><span class="line">bobo.name = <span class="string">"波哥"</span></span><br><span class="line">bobo.age = <span class="number">18</span></span><br><span class="line">bobo.height = <span class="number">181</span></span><br><span class="line">bobo.eduschool = <span class="string">"北京邮电大学"</span></span><br><span class="line">bobo.hobby = []<span class="keyword">string</span>{<span class="string">"coding"</span>, <span class="string">"运动"</span>, <span class="string">"旅行"</span>}</span><br><span class="line">bobo.moreinfo = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{</span><br><span class="line">    <span class="string">"work"</span>: <span class="string">"百度"</span>,</span><br><span class="line">    <span class="string">"duty"</span>: <span class="string">"产品狗"</span>,</span><br><span class="line">}</span><br><span class="line">fmt.Printf(<span class="string">"%v\n"</span>, bobo) <span class="comment">// {波哥 18 181 北京邮电大学 [coding 运动 旅行] map[duty:产品狗 work:百度]}</span></span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, bobo) <span class="comment">// {name:波哥 age:18 height:181 eduschool:北京邮电大学 hobby:[coding 运动 旅行] moreinfo:map[duty:产品狗 work:百度]}</span></span><br><span class="line">fmt.Printf(<span class="string">"name=%s,hobby=%v\n"</span>, bobo.name, bobo.hobby)</span><br><span class="line"><span class="comment">//name=波哥,hobby=[coding 运动 旅行]</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="顺序形式"><a href="#顺序形式" class="headerlink" title="顺序形式"></a>顺序形式</h3><p>简短声明来实现一个结构变量初始化<br>不指定结构体字段名称的时候，按照定义声明结构体的字段顺序初始化赋值，显示提供所有字段的初值，结构体当中的所有字段必须全部赋值。</p>
<p>指定字段名的时候，可以不按定义结构体时候的顺序赋值<br>对结构体赋值时，如果各个字段不在一行，最后一个字段必须添加逗号<br>对结构体赋值时，如果各个字段在同一行，则最后的一个字段可以不添加逗 号</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 定义结构体变量，赋值放在同一行，最后可以省略逗号</span></span><br><span class="line">    <span class="comment">// var c2 Course = Course{"scrapy", 110, "https://www.imooc.com"}</span></span><br><span class="line">    c2 := Course{<span class="string">"scrapy"</span>, <span class="number">110</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"%+v\n"</span>, c2) <span class="comment">// {Name:scrapy Price:110 Url:https://www.imooc.com}</span></span><br><span class="line">    fmt.Println(c2.Name, c2.Price, c2.Url) <span class="comment">// scrapy 110 https://www.imooc.com</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多行初始化</span></span><br><span class="line"><span class="keyword">var</span> liuge = userinfo{</span><br><span class="line">   name:      <span class="string">""</span>,</span><br><span class="line">   age:       <span class="number">0</span>,</span><br><span class="line">   height:    <span class="number">0</span>,</span><br><span class="line">   eduschool: <span class="string">""</span>,</span><br><span class="line">   hobby:     <span class="literal">nil</span>,</span><br><span class="line">   moreinfo:  <span class="literal">nil</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">huge := userinfo{</span><br><span class="line">    eduschool: <span class="string">"北京电影学院"</span>,</span><br><span class="line">    hobby:     []<span class="keyword">string</span>{<span class="string">"拍电影"</span>, <span class="string">"唱歌"</span>, <span class="string">"旅行"</span>},</span><br><span class="line">    moreinfo: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{</span><br><span class="line">        <span class="string">"role"</span>:      <span class="string">"演员"</span>,</span><br><span class="line">        <span class="string">"earnmoney"</span>: <span class="number">300000</span>,</span><br><span class="line">    },</span><br><span class="line">    name:   <span class="string">"胡哥"</span>,</span><br><span class="line">    age:    <span class="number">28</span>,</span><br><span class="line">    height: <span class="number">188</span>,</span><br><span class="line">}</span><br><span class="line">fmt.Printf(<span class="string">"huge=%v\n"</span>, huge)</span><br><span class="line"><span class="comment">//huge={胡哥 28 188 北京电影学院 [拍电影 唱歌 旅行] map[earnmoney:300000 role:演员]}</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体变量，赋值放在同一行，最后可以省略逗号</span></span><br><span class="line">xiaoge := userinfo{<span class="string">"小哥"</span>, <span class="number">12</span>, <span class="number">120</span>, <span class="string">"小学"</span>, []<span class="keyword">string</span>{<span class="string">"学习"</span>, <span class="string">"玩"</span>, <span class="string">"打游戏"</span>}, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{<span class="string">"年级"</span>: <span class="string">"六年级"</span>}}</span><br><span class="line">fmt.Printf(<span class="string">"xiaoge=%v\n"</span>, xiaoge)</span><br><span class="line"><span class="comment">//xiaoge={小哥 12 120 小学 [学习 玩 打游戏] map[年级:六年级]}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="地址符，同样是返回的结构体指针"><a href="#地址符，同样是返回的结构体指针" class="headerlink" title="地址符，同样是返回的结构体指针"></a>地址符，同样是返回的结构体指针</h3><p>结构体变量和普通变量都有指针形式，一个指向结构体的指针<br>使用取地址符就可以得到结构体的指针类型<br>通过结构体指针获取对象的值</p>
<p>go语言实际上在借鉴动态语言的特性，在调用的时候，要值还是指针，编译器会帮我们转换<br>另一个根本的原因 - go语言的指针是受限的</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var c3 *Course = &amp;Course{"tornado", 100, "https://www.imooc.com"}</span></span><br><span class="line">c3 := &amp;Course{<span class="string">"tornado"</span>, <span class="number">100</span>, <span class="string">"https://www.imooc.com"</span>}</span><br><span class="line">fmt.Printf(<span class="string">"%T\n"</span>, c3) <span class="comment">// *main.Course</span></span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, c3) <span class="comment">// &amp;{Name:tornado Price:100 Url:https://www.imooc.com}</span></span><br><span class="line">fmt.Println((*c3).Name, (*c3).Price, (*c3).Url) <span class="comment">// tornado 100 https://www.imooc.com</span></span><br><span class="line">fmt.Println(c3.Name, c3.Price, c3.Url)          <span class="comment">// tornado 100 https://www.imooc.com</span></span><br><span class="line"><span class="comment">// 这里其实是go语言的一个语法糖 go语言内部会将指向结构体的指针，c3.Name转换成 (*c3).Name，直接当对象来使用而不是当成指针使用</span></span><br></pre></td></tr></tbody></table></figure>

<p>注意上面的输出，指针形式多了一个地址符 <code>&amp;</code>，表示打印的对象是一个指针类型</p>
<h3 id="使用new-函数来创建一个「零值」结构体"><a href="#使用new-函数来创建一个「零值」结构体" class="headerlink" title="使用new() 函数来创建一个「零值」结构体"></a>使用new() 函数来创建一个「零值」结构体</h3><p>new() 函数返回的是指针类型。<br>所有的字段都被初始化为相应类型的零值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c12 *Course = <span class="built_in">new</span>(Course)</span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, c12) <span class="comment">// &amp;{Name: Price:0 Url:}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xiaoming *userinfo = <span class="built_in">new</span>(userinfo)</span><br><span class="line">(*xiaoming).name = <span class="string">"小明"</span></span><br><span class="line">(*xiaoming).age = <span class="number">12</span></span><br><span class="line">(*xiaoming).eduschool = <span class="string">"北京小学"</span></span><br><span class="line"><span class="comment">//xiaoming-&gt;(*xiaoming) go语言编译器自动转换</span></span><br><span class="line">xiaoming.hobby = []<span class="keyword">string</span>{<span class="string">"学习"</span>, <span class="string">"玩"</span>, <span class="string">"打游戏"</span>}</span><br><span class="line">fmt.Println(xiaoming) <span class="comment">// &amp;{小明 12 0 北京小学 [学习 玩 打游戏] map[]}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="零值初始化"><a href="#零值初始化" class="headerlink" title="零值初始化"></a>零值初始化</h3><p>第五种创建形式，如果不给结构体赋值，go语言会默认给每个字段采用默认值</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c13 Course</span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, c13) <span class="comment">// {Name: Price:0 Url:}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c4 := Course{}</span><br><span class="line">fmt.Println(c4.Price) <span class="comment">// 0</span></span><br><span class="line">fmt.Println(c4.Name)  <span class="comment">//  空字符串</span></span><br></pre></td></tr></tbody></table></figure>

<p>最后我们再将三种零值初始化结构体形式放到一起对比观察一下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c5 Course = Course{}</span><br><span class="line"><span class="keyword">var</span> c6 Course              <span class="comment">// c6不是指针 是结构体的类型</span></span><br><span class="line"><span class="keyword">var</span> c7 *Course = &amp;Course{} <span class="comment">// 分配一块内存并初始化</span></span><br><span class="line"><span class="keyword">var</span> c8 *Course             <span class="comment">// 指针如果只申明不赋值 默认值是nil</span></span><br><span class="line">fmt.Println(c8)            <span class="comment">// &lt;nil&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c12 *Course = <span class="built_in">new</span>(Course)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(c5.Price) <span class="comment">// 0</span></span><br><span class="line">fmt.Println(c6.Price) <span class="comment">// 0</span></span><br><span class="line">fmt.Println(c7.Price) <span class="comment">// 0</span></span><br><span class="line"><span class="comment">//fmt.Println(c8.Price) // panic: runtime error: invalid memory address or nil pointer dereference</span></span><br><span class="line"></span><br><span class="line">fmt.Println(c12.Price) <span class="comment">// 0</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="零值结构体和-nil-结构体"><a href="#零值结构体和-nil-结构体" class="headerlink" title="零值结构体和 nil 结构体"></a>零值结构体和 nil 结构体</h2><p>nil 结构体是指结构体指针变量没有指向一个实际存在的内存。这样的指针变量只会占用 1 个指针的存储空间，也就是一个机器字的内存大小。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c *Course = <span class="literal">nil</span></span><br></pre></td></tr></tbody></table></figure>

<p>而零值结构体是会实实在在占用内存空间的，只不过每个字段都是零值。如果结构体里面字段非常多，那么这个内存空间占用肯定也会很大。</p>
<h2 id="结构体的大小"><a href="#结构体的大小" class="headerlink" title="结构体的大小"></a>结构体的大小</h2><p>Go 语言的 unsafe 包提供了获取结构体内存占用字节的函数 <code>Sizeof()</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(unsafe.Sizeof(c9))              <span class="comment">// 40 16+8+16</span></span><br></pre></td></tr></tbody></table></figure>

<p>Circle 结构体在我的 64位机器上占用了 40 个字节，<br>因为每个 int 类型都是 8 字节。<br>字符串头的结构体占用 16 个字节</p>
<p>在 32 位机器上，Circle 结构体只会占用 20 个字节。</p>
<h2 id="slice的结构体"><a href="#slice的结构体" class="headerlink" title="slice的结构体"></a>slice的结构体</h2><p>通过观察 Go 语言的底层源码，可以发现所有的 Go 语言内置的高级数据结构都是由结构体来完成的。<br>slice的函数传递本质上也是值传递</p>
<p>切片头的结构体形式如下，它在 64 位机器上将会占用 24 个字节</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> {</span><br><span class="line">    array unsafe.Pointer <span class="comment">// 底层数组的地址</span></span><br><span class="line">    <span class="built_in">len</span>   <span class="keyword">int</span>            <span class="comment">// 长度</span></span><br><span class="line">    <span class="built_in">cap</span>   <span class="keyword">int</span>            <span class="comment">// 容量</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="字符串头的结构体"><a href="#字符串头的结构体" class="headerlink" title="字符串头的结构体"></a>字符串头的结构体</h2><p>它在 64 位机器上将会占用 16 个字节</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="keyword">string</span> <span class="keyword">struct</span> {</span><br><span class="line">    array unsafe.Pointer <span class="comment">// 底层数组的地址</span></span><br><span class="line">    Data <span class="keyword">uintptr</span> <span class="comment">// 指针占8个长度</span></span><br><span class="line">    Len  <span class="keyword">int</span>     <span class="comment">// 长度64位系统占8个长度</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="字典头的结构体"><a href="#字典头的结构体" class="headerlink" title="字典头的结构体"></a>字典头的结构体</h2><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> {</span><br><span class="line">  count <span class="keyword">int</span></span><br><span class="line">  ...</span><br><span class="line">  buckets unsafe.Pointer  <span class="comment">// hash桶地址</span></span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="数组与切片在内存形式上的区别"><a href="#数组与切片在内存形式上的区别" class="headerlink" title="数组与切片在内存形式上的区别"></a>数组与切片在内存形式上的区别</h2><p>数组只有「体」，切片除了「体」之外，还有「头」部。切片的头部和内容体是分离的，使用指针关联起来。请读者尝试解释一下下面代码的输出结果</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"unsafe"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ArrayStruct <span class="keyword">struct</span> {</span><br><span class="line">    value [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SliceStruct <span class="keyword">struct</span> {</span><br><span class="line">    value []<span class="keyword">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="comment">// 数组初始化使用了 […] 语法糖，表示让编译器自动推导数组的长度。</span></span><br><span class="line">    <span class="keyword">var</span> as = ArrayStruct{[...]<span class="keyword">int</span>{<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>}}</span><br><span class="line">    <span class="keyword">var</span> ss = SliceStruct{[]<span class="keyword">int</span>{<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>}}</span><br><span class="line">    fmt.Println(unsafe.Sizeof(as), unsafe.Sizeof(ss)) <span class="comment">// 80 24</span></span><br><span class="line"></span><br><span class="line">    s1 := []<span class="keyword">string</span>{<span class="string">"django"</span>, <span class="string">"tornado"</span>, <span class="string">"scrapy"</span>, <span class="string">"celery"</span>, <span class="string">"snaic"</span>, <span class="string">"flask"</span>}</span><br><span class="line">    fmt.Println(<span class="string">"切片占用的内存:"</span>, unsafe.Sizeof(s1)) <span class="comment">// 切片占用的内存: 24 无论字符串多长多短</span></span><br><span class="line"></span><br><span class="line">    m1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>{</span><br><span class="line">        <span class="string">"bobby1"</span>: <span class="string">"django"</span>,</span><br><span class="line">        <span class="string">"bobby2"</span>: <span class="string">"tornado"</span>,</span><br><span class="line">        <span class="string">"bobby3"</span>: <span class="string">"scrapy"</span>,</span><br><span class="line">        <span class="string">"bobby4"</span>: <span class="string">"celery"</span>,</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(<span class="string">"字典占用的内存:"</span>, unsafe.Sizeof(m1)) <span class="comment">// 字典占用的内存: 8</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(unsafe.Sizeof(<span class="number">1</span>)) <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//go语言string的本质 其实string是一个结构体</span></span><br><span class="line">    fmt.Println(<span class="string">"字符串占用的内存:"</span>, unsafe.Sizeof(<span class="string">""</span>)) <span class="comment">// 字符串占用的内存: 16 无论字符串多长多短</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>结构体在内存中的布局是连续的存储空间</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xiaohong *userinfo = &amp;userinfo{</span><br><span class="line">    <span class="string">"小红"</span>, <span class="number">12</span>, <span class="number">120</span>, <span class="string">"小学"</span>, []<span class="keyword">string</span>{<span class="string">"学习"</span>, <span class="string">"玩"</span>, <span class="string">"打游戏"</span>}, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{<span class="string">"年级"</span>: <span class="string">"五年级"</span>},</span><br><span class="line">}</span><br><span class="line">fmt.Println(xiaohong, *xiaohong)</span><br><span class="line"><span class="comment">//&amp;{小红 12 120 小学 [学习 玩 打游戏] map[年级:五年级]} {小红 12 120 小学 [学习 玩 打游戏] map[年级:五年级]}</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"name=%p,age=%p,height=%p,eduschool=%p,hobby=%p,moreinfo=%p\n"</span>, &amp;xiaohong.name, &amp;xiaohong.age, &amp;xiaohong.height, &amp;xiaohong.eduschool, &amp;xiaohong.hobby, &amp;xiaohong.moreinfo)</span><br><span class="line"><span class="comment">//name=0xc0000e2140,age=0xc0000e2150,height=0xc0000e2158,eduschool=0xc0000e2160,hobby=0xc0000e2170,moreinfo=0xc0000e2188</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"name=%d,age=%d,height=%d,eduschool=%d,hobby=%d,moreinfo=%d\n"</span>, unsafe.Sizeof(xiaohong.name), unsafe.Sizeof(xiaohong.age), unsafe.Sizeof(xiaohong.height), unsafe.Sizeof(xiaohong.eduschool), unsafe.Sizeof(xiaohong.hobby), unsafe.Sizeof(xiaohong.moreinfo))</span><br><span class="line"><span class="comment">// name=16,age=8,height=4,eduschool=16,hobby=24,moreinfo=8</span></span><br></pre></td></tr></tbody></table></figure>

<p>结构体之间是否可以相互转换？可以转换，前提条件：具有相同的字段（个数，类型，名称)</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> userinfo <span class="keyword">struct</span> {</span><br><span class="line">    name      <span class="keyword">string</span></span><br><span class="line">    age       <span class="keyword">int</span></span><br><span class="line">    height    <span class="keyword">float32</span></span><br><span class="line">    eduschool <span class="keyword">string</span></span><br><span class="line">    hobby     []<span class="keyword">string</span></span><br><span class="line">    moreinfo  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> peopleinfo <span class="keyword">struct</span> {</span><br><span class="line">    name      <span class="keyword">string</span></span><br><span class="line">    age       <span class="keyword">int</span></span><br><span class="line">    height    <span class="keyword">float32</span></span><br><span class="line">    eduschool <span class="keyword">string</span></span><br><span class="line">    hobby     []<span class="keyword">string</span></span><br><span class="line">    moreinfo  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">    user3 := userinfo{</span><br><span class="line">        name:      <span class="string">"user3"</span>,</span><br><span class="line">        age:       <span class="number">0</span>,</span><br><span class="line">        height:    <span class="number">0</span>,</span><br><span class="line">        eduschool: <span class="string">""</span>,</span><br><span class="line">        hobby:     <span class="literal">nil</span>,</span><br><span class="line">        moreinfo:  <span class="literal">nil</span>,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    user4 := peopleinfo{</span><br><span class="line">        name:      <span class="string">"user4"</span>,</span><br><span class="line">        age:       <span class="number">0</span>,</span><br><span class="line">        height:    <span class="number">0</span>,</span><br><span class="line">        eduschool: <span class="string">""</span>,</span><br><span class="line">        hobby:     <span class="literal">nil</span>,</span><br><span class="line">        moreinfo:  <span class="literal">nil</span>,</span><br><span class="line">        <span class="comment">//pmoreinfo:nil,</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//user3 = user4 // cannot use user4 (type peopleinfo) as type userinfo in assignment</span></span><br><span class="line"></span><br><span class="line">    user3 = userinfo(user4)</span><br><span class="line">    fmt.Println(user3) <span class="comment">// {user4 0 0  [] map[]}</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
