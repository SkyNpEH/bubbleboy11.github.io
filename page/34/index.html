<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:type" content="website">
<meta property="og:title" content="外心人D的博客">
<meta property="og:url" content="https://bubbleboy11.github.io/page/34/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="本博客大多内容为慕课和网上博客，并非原创">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/page/34/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/34/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">341</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django-zhong-jian-jian-zhi-xian-zhi-ip-fang-wen-ci-shu-he-hei-ming-dan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django-zhong-jian-jian-zhi-xian-zhi-ip-fang-wen-ci-shu-he-hei-ming-dan/" class="post-title-link" itemprop="url">Django中间件之限制ip访问次数和黑名单</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-06 11:30:54" itemprop="dateModified" datetime="2021-06-06T11:30:54Z">2021-06-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="限制ip访问频率"><a href="#限制ip访问频率" class="headerlink" title="限制ip访问频率"></a>限制ip访问频率</h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> caches</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 频率限制访问</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IpLimitMiddleware</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        ip = request.META.get(<span class="string">"REMOTE_ADDR"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选择缓存的数据库 redis缓存</span></span><br><span class="line">        cache = caches[<span class="string">'redis_backend'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 首先缓存中，根据ip获取数据，假如没有数据，值为空列表 []</span></span><br><span class="line">        requests = cache.get(ip, [])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果值存在，且当前时间 - 最后一个时间 &gt; 30 则清洗掉这个值  这里我们插入请求的时间为头插</span></span><br><span class="line">        <span class="keyword">while</span> requests <span class="keyword">and</span> time.time() - requests[<span class="number">-1</span>] &gt; <span class="number">30</span>:</span><br><span class="line">            requests.pop()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若没有存在值，则添加，过期时间为30秒，这个过期时间与上面判断的30 保持一致</span></span><br><span class="line">        requests.insert(<span class="number">0</span>, time.time())</span><br><span class="line">        cache.set(ip, requests, timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 限制访问次数为 5 次</span></span><br><span class="line">        print(len(requests))</span><br><span class="line">        <span class="keyword">if</span> len(requests) &gt; <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"请求过于频繁，请稍后重试！"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> caches</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 频率限制访问</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IpLimitMiddleware</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        ip = request.META.get(<span class="string">"REMOTE_ADDR"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选择缓存的数据库 redis缓存</span></span><br><span class="line">        cache = caches[<span class="string">'redis_backend'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取黑名单</span></span><br><span class="line">        black_list = cache.get(<span class="string">'black'</span>, [])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ip <span class="keyword">in</span> black_list:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"黑名单用户！"</span>)</span><br><span class="line"></span><br><span class="line">        requests = cache.get(ip, [])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果值存在，且当前时间 - 最后一个时间 &gt; 30 则清洗掉这个值  这里我们插入请求的时间为头插</span></span><br><span class="line">        <span class="keyword">while</span> requests <span class="keyword">and</span> time.time() - requests[<span class="number">-1</span>] &gt; <span class="number">60</span>:</span><br><span class="line">            requests.pop()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若没有存在值，则添加，过期时间为30秒，这个过期时间与上面判断的30 保持一致</span></span><br><span class="line">        requests.insert(<span class="number">0</span>, time.time())</span><br><span class="line">        cache.set(ip, requests, timeout=<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果访问次数大于30次，假如黑名单，封2分钟</span></span><br><span class="line">        <span class="keyword">if</span> len(requests) &gt; <span class="number">30</span>:</span><br><span class="line">            black_list.append(ip)</span><br><span class="line">            cache.set(<span class="string">'black'</span>, black_list, timeout=<span class="number">60</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 限制访问次数为 5 次</span></span><br><span class="line">        print(len(requests))</span><br><span class="line">        <span class="keyword">if</span> len(requests) &gt; <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"请求过于频繁，请稍后重试！"</span>)</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/django-zi-ding-yi-cha-xun/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/django-zi-ding-yi-cha-xun/" class="post-title-link" itemprop="url">django自定义查询</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-12 03:09:10" itemprop="dateModified" datetime="2021-06-12T03:09:10Z">2021-06-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>自定义查询函数Q(条件判断)<br>Q对象：用于条件之间的逻辑关系（&amp; | <del>）<br>多个可选的查询条件：<br>    实现复杂的查询<br>    优先级从高到低：</del> &amp; | 非  或 与，对应SQL中的AND和OR<br>    可以混合使用 Q 对象和关键字参数，<br>    Q 对象和关键字参数是用”and”拼在一起的（即将逗号看成 and ），<br>    但是 Q 对象必须位于所有关键字参数的前面。</p>
<p>自定义查询函数F(“字段名称”)<br>之前构造的过滤器都只是将字段值与某个常量做比较，<br>如果想要对两个字段的值做比较，就需要用到 F()。<br>F() 的实例可以在查询中引用字段，<br>来比较同一个 model 实例中两个不同字段的值。</p>
<p>F()函数从数据库操作层面修改数据<br>F()函数可避免同时操作时竞态条件</p>
<p>F对象：用于类属性之间的比较。</p>
<p>使用前要先从 django.db.models 引入 F:<br>from django.db.models import F<br>F 动态获取对象字段的值，可以进行运算。<br>Django 支持 F() 对象之间以及 F() 对象和常数之间的加减乘除和取余的操作。<br>修改操作（update）也可以使用 F() 函数。</p>
<p>使用SQL查询<br>关联多张表的时候需要使用sql查询</p>
<p>在视图中获取表单值<br>◆GET请求<br>request.GET.get( name, None)<br>◆POST请求<br>request.POST.get( name, None)</p>
<p>管理器raw(sql)查询<br>Python<br>1    raw(raw_query,params=None,translations=None)<br>2    # 返回django.db.models.query.RawQuerySet实例<br>def raw_sql(request):</p>
<h1 id="通过url传入指定参数，在视图中获取表单值"><a href="#通过url传入指定参数，在视图中获取表单值" class="headerlink" title="通过url传入指定参数，在视图中获取表单值"></a>通过url传入指定参数，在视图中获取表单值</h1><p>username = request.GET.get(‘name’, None)<br>sql = (<br>‘SELECT id FROM weibo_user ‘<br>‘WHERE username=%s’<br>)<br>user_list = WeiboUser.objects.raw(sql, (username,))</p>
<h1 id="user-list对象是一个RawQuerySet"><a href="#user-list对象是一个RawQuerySet" class="headerlink" title="user_list对象是一个RawQuerySet"></a>user_list对象是一个RawQuerySet</h1><p>for user in user_list:</p>
<h1 id="user也只是单个Query-可指定其字段"><a href="#user也只是单个Query-可指定其字段" class="headerlink" title="user也只是单个Query,可指定其字段"></a>user也只是单个Query,可指定其字段</h1><p>print(user.nickname)<br>return HttpResponse(‘ok’)</p>
<p>获取数据库连接、游标、直接执行sql<br>类似于python操作数据库，举例：</p>
<p>def sql(request):<br>    # 获取数据库的连接<br>    from django.db import connection<br>    # 根据连接获取游标<br>    cursor = connection.cursor()<br>    sql = (<br>        ‘SELECT id,username,nickname FROM weibo_user ‘<br>        ‘WHERE id=%s’<br>    )<br>    # 执行sql<br>    cursor.execute(sql, (3,))<br>    # 查询结果<br>    user_list = cursor.fetchall()<br>    # user_list对象是一个元组<br>    for user in user_list:<br>        print(user)<br>    return HttpResponse(‘ok’)</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/drf-huan-cun/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/drf-huan-cun/" class="post-title-link" itemprop="url">drf缓存</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-01 07:06:54" itemprop="dateModified" datetime="2021-08-01T07:06:54Z">2021-08-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>为了加速网站的访问速度，将一些经常访问的公开变化少数据放入缓存中，<br>可以加快网页响应的速度。<br>对于变化小的数据，将其保存到缓存中请求时直接获取的成本要源于每次请求再重新计算获取的成本，所以使用缓存是很有必要的。<br>Django支持的缓存包括Memcached、数据库高速缓存、文件系统缓存、本地内存缓存、虚拟缓存等，DRF的缓存机制建立在Django的基础上，并进行了一些优化，这里采用的是已经封装好的drf-extensions（DRF扩展），对DRF进行了很多方面的功能扩展，其中就包括缓存功能</p>
<p>取数据的时候首先去缓存中去，然后再去数据库中取<br>缓存使用的是内存，每次重启之后就会失效</p>
<p>而需要验证才能访问的私有数据则尽量不要使用缓存，可以根据自己的需要对不同的数据进行缓存配置。</p>
<ul>
<li>第一步，安装</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; pip install drf-extensions</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第二步，配置缓存过期时间<br><code>settings.py</code></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK_EXTENSIONS = {</span><br><span class="line">    <span class="string">'DEFAULT_CACHE_RESPONSE_TIMEOUT'</span>: <span class="number">5</span>   <span class="comment">#5s过期，时间自己可以随便设定</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>第三步，</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://chibisov.github.io/drf-extensions/docs/#cacheresponsemixin">http://chibisov.github.io/drf-extensions/docs/#cacheresponsemixin</a></p>
<h4 id="CacheResponseMixin"><a href="#CacheResponseMixin" class="headerlink" title="CacheResponseMixin"></a>CacheResponseMixin</h4><p>It is common to cache standard viewset <code>retrieve</code> and <code>list</code> methods. That is why <code>CacheResponseMixin</code> exists. Just mix it into viewset implementation and those methods will use functions, defined in <code>REST_FRAMEWORK_EXTENSIONS</code> settings:<br>缓存标准viewset的<code>retrieve</code>和<code>list</code>方法很常见。 这就是<code>CacheResponseMixin</code>存在的原因。 只需将其混合到viewset实现中，这些方法将使用<code>REST_FRAMEWORK_EXTENSIONS</code>设置中定义的函数：</p>
<p>“DEFAULT_OBJECT_CACHE_KEY_FUNC” for <code>retrieve</code> method<br>“DEFAULT_LIST_CACHE_KEY_FUNC” for <code>list</code> method<br>By default those functions are using DefaultKeyConstructor and extends it:</p>
<p>With <code>RetrieveSqlQueryKeyBit</code> for “DEFAULT_OBJECT_CACHE_KEY_FUNC”<br>With <code>ListSqlQueryKeyBit</code> and <code>PaginationKeyBit</code> for “DEFAULT_LIST_CACHE_KEY_FUNC”<br>You can change those settings for custom cache key generation:</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> myapps.serializers <span class="keyword">import</span> UserSerializer</span><br><span class="line"><span class="keyword">from</span> rest_framework_extensions.cache.mixins <span class="keyword">import</span> CacheResponseMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span>(<span class="params">CacheResponseMixin, viewsets.ModelViewSet</span>):</span></span><br><span class="line">    serializer_class = UserSerializer</span><br></pre></td></tr></tbody></table></figure>

<p>我们使用的主要是<code>CacheResponseMixin</code>，主要适用于<code>retrieve</code>和<code>list</code>方法，这主要是查询操作，对于新建、修改等操作一般是不能使用缓存的。</p>
<h3 id="商品列表增加缓存"><a href="#商品列表增加缓存" class="headerlink" title="商品列表增加缓存"></a>商品列表增加缓存</h3><p><code>apps/goods/views.py</code>中的<code>GoodsListViewSet</code>，使之第一个继承自<code>CacheResponseMixin</code>，即可实现缓存，如下：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework_extensions.cache.mixins <span class="keyword">import</span> CacheResponseMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsListViewSet</span>(<span class="params">CacheResponseMixin, mixins.ListModelMixin, mixins.RetrieveModelMixin, viewsets.GenericViewSet</span>):</span></span><br></pre></td></tr></tbody></table></figure>

<p>现在重启服务器，使浏览器缓存失效（因为我们第一次进入该页面，已经将数据放入缓存了，重启服务器，内存中就没了，需要重新到后台获取），然后访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/goods/">http://127.0.0.1:8000/goods/</a> 按F12点击Network查看加载时间。可以看到首次访问需要437ms.再次刷新该页面，第二次以及后面多次访问基本就是13ms</p>
<p>在视图中配置CacheResponseMixin缓存后，可以使用redis作为缓存后端来存储数据。且针对不同的url以不同的参数，都会生成不同的键值，不同的键缓存不同的内存。如果没有配置CacheResponseMixin缓存，访问这些URL，是不会生成redis键值的。</p>
<h3 id="限流-DRF的throttle设置API的访问速率"><a href="#限流-DRF的throttle设置API的访问速率" class="headerlink" title="限流 DRF的throttle设置API的访问速率"></a>限流 DRF的throttle设置API的访问速率</h3><p>接口访问速率过快，会导致其它业务受影响，网站打不开，</p>
<p>因为爬虫的存在，如果爬虫的速率过快、不考虑网站的承受能力，会对服务器造成很大的压力，甚至影响正常用户的访问，因此对关键数据、对性能要求高的数据接口进行限速。</p>
<p>DRF自带了限速功能，直接使用throttling进行限速即可实现，throttling与权限类似，它决定是否应授权请求。节流指示临时状态，并用于控制客户端可以向API发出的请求的速率，一般对未经身份验证的请求进行限制，而对于经过身份验证的请求则进行限制较少。</p>
<p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/throttling/#setting-the-throttling-policy">https://www.django-rest-framework.org/api-guide/throttling/#setting-the-throttling-policy</a></p>
<h4 id="设置全局限制策略"><a href="#设置全局限制策略" class="headerlink" title="设置全局限制策略"></a>设置全局限制策略</h4><p>The default throttling policy may be set globally, using the <code>DEFAULT_THROTTLE_CLASSES</code> and <code>DEFAULT_THROTTLE_RATES</code> settings.<br>可以使用<code>DEFAULT_THROTTLE_CLASSES</code>和<code>DEFAULT_THROTTLE_RATES</code>设置全局设置默认限制策略。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleRateThrottle</span>(<span class="params">BaseThrottle</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A simple cache implementation, that only requires `.get_cache_key()`</span></span><br><span class="line"><span class="string">    to be overridden.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The rate (requests / seconds) is set by a `rate` attribute on the View</span></span><br><span class="line"><span class="string">    class.  The attribute is a string of the form 'number_of_requests/period'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Period should be one of: ('s', 'sec', 'm', 'min', 'h', 'hour', 'd', 'day')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Previous request information used for throttling is stored in the cache.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    cache = default_cache</span><br><span class="line">    timer = time.time</span><br><span class="line">    cache_format = <span class="string">'throttle_%(scope)s_%(ident)s'</span></span><br><span class="line">    scope = <span class="literal">None</span></span><br><span class="line">    THROTTLE_RATES = api_settings.DEFAULT_THROTTLE_RATES</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(self, <span class="string">'rate'</span>, <span class="literal">None</span>):</span><br><span class="line">            self.rate = self.get_rate()</span><br><span class="line">        self.num_requests, self.duration = self.parse_rate(self.rate)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Should return a unique cache-key which can be used for throttling.</span></span><br><span class="line"><span class="string">        Must be overridden.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        May return `None` if the request should not be throttled.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">'.get_cache_key() must be overridden'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_rate</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Determine the string representation of the allowed request rate.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(self, <span class="string">'scope'</span>, <span class="literal">None</span>):</span><br><span class="line">            msg = (<span class="string">"You must set either `.scope` or `.rate` for '%s' throttle"</span> %</span><br><span class="line">                   self.__class__.__name__)</span><br><span class="line">            <span class="keyword">raise</span> ImproperlyConfigured(msg)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.THROTTLE_RATES[self.scope]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            msg = <span class="string">"No default throttle rate set for '%s' scope"</span> % self.scope</span><br><span class="line">            <span class="keyword">raise</span> ImproperlyConfigured(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_rate</span>(<span class="params">self, rate</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Given the request rate string, return a two tuple of:</span></span><br><span class="line"><span class="string">        &lt;allowed number of requests&gt;, &lt;period of time in seconds&gt;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> rate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">        num, period = rate.split(<span class="string">'/'</span>)</span><br><span class="line">        num_requests = int(num)</span><br><span class="line">        duration = {<span class="string">'s'</span>: <span class="number">1</span>, <span class="string">'m'</span>: <span class="number">60</span>, <span class="string">'h'</span>: <span class="number">3600</span>, <span class="string">'d'</span>: <span class="number">86400</span>}[period[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> (num_requests, duration)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Implement the check to see if the request should be throttled.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        On success calls `throttle_success`.</span></span><br><span class="line"><span class="string">        On failure calls `throttle_failure`.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.rate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        self.key = self.get_cache_key(request, view)</span><br><span class="line">        <span class="keyword">if</span> self.key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        self.history = self.cache.get(self.key, [])</span><br><span class="line">        self.now = self.timer()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Drop any requests from the history which have now passed the</span></span><br><span class="line">        <span class="comment"># throttle duration</span></span><br><span class="line">        <span class="keyword">while</span> self.history <span class="keyword">and</span> self.history[<span class="number">-1</span>] &lt;= self.now - self.duration:</span><br><span class="line">            self.history.pop()</span><br><span class="line">        <span class="keyword">if</span> len(self.history) &gt;= self.num_requests:</span><br><span class="line">            <span class="keyword">return</span> self.throttle_failure()</span><br><span class="line">        <span class="keyword">return</span> self.throttle_success()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">throttle_success</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Inserts the current request's timestamp along with the key</span></span><br><span class="line"><span class="string">        into the cache.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.history.insert(<span class="number">0</span>, self.now)</span><br><span class="line">        self.cache.set(self.key, self.history, self.duration)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">throttle_failure</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Called when a request to the API has failed due to throttling.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Returns the recommended next request time in seconds.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.history:</span><br><span class="line">            remaining_duration = self.duration - (self.now - self.history[<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            remaining_duration = self.duration</span><br><span class="line"></span><br><span class="line">        available_requests = self.num_requests - len(self.history) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> available_requests &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> remaining_duration / float(available_requests)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnonRateThrottle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Limits the rate of API calls that may be made by a anonymous users.</span></span><br><span class="line"><span class="string">    匿名未认证登用户录请求限速</span></span><br><span class="line"><span class="string">    The IP address of the request will be used as the unique cache key.</span></span><br><span class="line"><span class="string">    通过请求的IP地址判断区分用户。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    scope = <span class="string">'anon'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># Only throttle unauthenticated requests.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.cache_format % {</span><br><span class="line">            <span class="string">'scope'</span>: self.scope,</span><br><span class="line">            <span class="string">'ident'</span>: self.get_ident(request)</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRateThrottle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Limits the rate of API calls that may be made by a given user.</span></span><br><span class="line"><span class="string">    用户登录后请求限速，通过token或Session判断</span></span><br><span class="line"><span class="string">    The user id will be used as a unique cache key if the user is</span></span><br><span class="line"><span class="string">    authenticated. 使用User id 来区分。</span></span><br><span class="line"><span class="string">    For anonymous requests, the IP address of the request will be used.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    scope = <span class="string">'user'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">            ident = request.user.pk</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ident = self.get_ident(request)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.cache_format % {</span><br><span class="line">            <span class="string">'scope'</span>: self.scope,</span><br><span class="line">            <span class="string">'ident'</span>: ident</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p>修改 DjangoOnlineFreshSupermarket/settings.py 在<code>REST_FRAMEWORK</code>添加配置</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局配置</span></span><br><span class="line">REST_FRAMEWORK = {</span><br><span class="line">    <span class="comment"># throttle对接口访问限速</span></span><br><span class="line">    <span class="string">'DEFAULT_THROTTLE_CLASSES'</span>: [</span><br><span class="line">        <span class="string">'rest_framework.throttling.AnonRateThrottle'</span>,</span><br><span class="line">        <span class="string">'rest_framework.throttling.UserRateThrottle'</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'DEFAULT_THROTTLE_RATES'</span>: {</span><br><span class="line">        <span class="string">'anon'</span>: <span class="string">'5/minute'</span>,  <span class="comment"># 使用DEFAULT_THROTTLE_RATES['anon'] 来设置频次</span></span><br><span class="line">        <span class="string">'user'</span>: <span class="string">'10/minute'</span>  <span class="comment"># 使用DEFAULT_THROTTLE_RATES['user'] 来设置频次</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在具体视图中通过 <code>throttle_classes</code> 属性来配置局部</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> AnonRateThrottle, UserRateThrottle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsListViewSet</span>(<span class="params">CacheResponseMixin, mixins.ListModelMixin, mixins.RetrieveModelMixin, viewsets.GenericViewSet</span>):</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    商品列表页，并实现分页、搜索、过滤、排序</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    throttle_classes = [AnonRateThrottle, UserRateThrottle]</span><br></pre></td></tr></tbody></table></figure>

<p>这是所有API调用次数总数计算，并非单个API都有指定的次数。</p>
<p>单个API限速<br>ScopedRateThrottle</p>
<p>The <code>ScopedRateThrottle</code> class can be used to restrict access to specific parts of the API. This throttle will only be applied if the view that is being accessed includes a <code>.throttle_scope</code> property. The unique throttle key will then be formed by concatenating the “scope” of the request with the unique user id or IP address.限制用户对于每个视图的访问频次，使用ip或user id,先找的用户id，没有设置用户id的话就会使用ip地址。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScopedRateThrottle</span>(<span class="params">SimpleRateThrottle</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Limits the rate of API calls by different amounts for various parts of</span></span><br><span class="line"><span class="string">    the API.  Any view that has the `throttle_scope` property set will be</span></span><br><span class="line"><span class="string">    throttled.  The unique cache key will be generated by concatenating the</span></span><br><span class="line"><span class="string">    user id of the request, and the scope of the view being accessed.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    scope_attr = <span class="string">'throttle_scope'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># Override the usual SimpleRateThrottle, because we can't determine</span></span><br><span class="line">        <span class="comment"># the rate until called by the view.</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="comment"># We can only determine the scope once we're called by the view.</span></span><br><span class="line">        self.scope = getattr(view, self.scope_attr, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If a view does not have a `throttle_scope` always allow the request</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.scope:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Determine the allowed request rate as we normally would during</span></span><br><span class="line">        <span class="comment"># the `__init__` call.</span></span><br><span class="line">        self.rate = self.get_rate()</span><br><span class="line">        self.num_requests, self.duration = self.parse_rate(self.rate)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># We can now proceed as normal.</span></span><br><span class="line">        <span class="keyword">return</span> super().allow_request(request, view)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        If `view.throttle_scope` is not set, don't apply this throttle.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Otherwise generate the unique cache key by concatenating the user id</span></span><br><span class="line"><span class="string">        with the '.throttle_scope` property of the view.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">            ident = request.user.pk</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ident = self.get_ident(request)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.cache_format % {</span><br><span class="line">            <span class="string">'scope'</span>: self.scope,</span><br><span class="line">            <span class="string">'ident'</span>: ident</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p>还可以使用基于APIView类的视图在每个视图或每个视图集的基础上设置限制策略。</p>
<p>The allowed request rate is determined by the <code>DEFAULT_THROTTLE_RATES</code> setting using a key from the request “scope”.</p>
<p>For example, given the following views…</p>
<p>首先配置限速范围，修改 <code>settings.py</code> ，注释掉全局限速，增加自定义权限</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DRF配置</span></span><br><span class="line">REST_FRAMEWORK = {</span><br><span class="line">    <span class="comment"># throttle对接口访问限速</span></span><br><span class="line">    <span class="string">'DEFAULT_THROTTLE_CLASSES'</span>: [</span><br><span class="line">        <span class="comment"># 'rest_framework.throttling.AnonRateThrottle',</span></span><br><span class="line">        <span class="comment"># 'rest_framework.throttling.UserRateThrottle'</span></span><br><span class="line">        <span class="string">'rest_framework.throttling.ScopedRateThrottle'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'DEFAULT_THROTTLE_RATES'</span>: {</span><br><span class="line">        <span class="comment"># 'anon': '5/minute',  # 限制所有匿名未认证用户，使用IP区分用户。使用DEFAULT_THROTTLE_RATES['anon'] 来设置频次</span></span><br><span class="line">        <span class="comment"># 'user': '10/minute'  # 限制认证用户，使用User id 来区分。使用DEFAULT_THROTTLE_RATES['user'] 来设置频次</span></span><br><span class="line">        <span class="string">'goods_list'</span>: <span class="string">'3/minute'</span>  <span class="comment"># 单个API限速</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsListViewSet</span>(<span class="params">mixins.ListModelMixin, mixins.RetrieveModelMixin, viewsets.GenericViewSet</span>):</span></span><br><span class="line">    throttle_scope = <span class="string">'goods_list'</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/2020/08/21/drf-huan-cun/1.png" alt="description"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/vue-jing-tai-wen-jian-fang-dao-django-zhong/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/vue-jing-tai-wen-jian-fang-dao-django-zhong/" class="post-title-link" itemprop="url">vue静态文件放到django中</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-13 06:43:58" itemprop="dateModified" datetime="2021-06-13T06:43:58Z">2021-06-13</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>vue有两种开发模式</p>
<p>build    用来生成静态文件<br>dev</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm run build</span><br></pre></td></tr></tbody></table></figure>

<p>生成的静态文件 index.html 、index.entry.js 、static 文件后<br>在dist目录下面的index.html拷贝到Django的templates目录下</p>
<p>django中创建static目录，把 index.entry.js 复制到该文件夹下</p>
<p>把index.entry.js考到django的static目录下面<br>把dist/static下的两个 fonts和images 文件夹拷贝到django static目录下</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 静态资源设置</span></span><br><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line">STATICFILES_DIRS = (str(BASE_DIR / <span class="string">'static'</span>),)</span><br></pre></td></tr></tbody></table></figure>

<p><code>url.py</code>配置首页的url</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> TemplateView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 首页</span></span><br><span class="line">    path(<span class="string">'index/'</span>, TemplateView.as_view(template_name=<span class="string">'index.html'</span>), name=<span class="string">'index'</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>将Vue模板使用Django渲染。</p>
<p>不使用<code>viewsets.ModelViewSet</code>原因是，订单一般不允许修改的，所有要自定义继承</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/python-luo-ji-yun-suan-fu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/python-luo-ji-yun-suan-fu/" class="post-title-link" itemprop="url">python逻辑运算符</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-29 01:42:56" itemprop="dateModified" datetime="2021-06-29T01:42:56Z">2021-06-29</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>逻辑运算优先 not&gt;and&gt;or<br>0被认为是False，非0表示True</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br><span class="line">b = <span class="number">20</span></span><br><span class="line"><span class="comment"># 布尔"与" x and y</span></span><br><span class="line"><span class="comment"># 如果 x 为 False，返回 False，</span></span><br><span class="line"><span class="comment"># x 为 True， 返回 y 的计算值。</span></span><br><span class="line"><span class="comment"># 同真取最后一个真，有假取第一个假。</span></span><br><span class="line"><span class="keyword">if</span> (a <span class="keyword">and</span> b):  <span class="comment"># (a and b) 返回 20</span></span><br><span class="line">    print(<span class="string">"1.变量 a 和 b 都为 true"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"1.变量 a 和 b 有一个不为 true"</span>)</span><br><span class="line"><span class="comment"># 1.变量 a 和 b 都为 true</span></span><br><span class="line"></span><br><span class="line">print(<span class="number">2</span> <span class="keyword">and</span> <span class="number">0</span>) <span class="comment"># 0</span></span><br><span class="line">print(<span class="number">1</span> <span class="keyword">and</span> <span class="number">2</span>) <span class="comment"># 2</span></span><br><span class="line">print(<span class="number">2</span> <span class="keyword">and</span> <span class="number">1</span>) <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔"或" x or y</span></span><br><span class="line"><span class="comment"># 如果x是True，它返回x的值，</span></span><br><span class="line"><span class="comment"># x 为False，它返回y的计算值</span></span><br><span class="line"><span class="comment"># 同假取最后一个假，有真取第一个真。</span></span><br><span class="line"><span class="keyword">if</span> (a <span class="keyword">or</span> b):  <span class="comment"># (a or b) 返回 10</span></span><br><span class="line">    print(<span class="string">"2.变量 a 和 b 都为 true，或其中一个变量为 true"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"2.变量 a 和 b 都不为 true"</span>)</span><br><span class="line"><span class="comment"># 2.变量 a 和 b 都为 true，或其中一个变量为 true</span></span><br><span class="line"></span><br><span class="line">print(<span class="number">2</span> <span class="keyword">or</span> <span class="number">0</span>) <span class="comment"># 2</span></span><br><span class="line">print(<span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span>) <span class="comment"># 2</span></span><br><span class="line">print(<span class="number">0</span> <span class="keyword">or</span> <span class="number">1</span>) <span class="comment"># 0</span></span><br><span class="line">print(<span class="number">1</span> <span class="keyword">or</span> <span class="number">2</span>) <span class="comment"># 1</span></span><br><span class="line">print(<span class="number">4</span> <span class="keyword">or</span> <span class="number">2</span> <span class="keyword">or</span> <span class="number">1</span>) <span class="comment"># 4</span></span><br><span class="line">print(<span class="number">2</span> <span class="keyword">or</span> <span class="number">4</span> <span class="keyword">or</span> <span class="number">1</span>) <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'a'</span> &gt; <span class="string">'b'</span>)</span><br><span class="line"><span class="comment"># False 'a' 的 ASCII 码比 ‘b’ 小</span></span><br><span class="line">print(<span class="string">'a'</span> &gt; <span class="string">'b'</span> <span class="keyword">or</span> <span class="string">'c'</span>)  <span class="comment"># c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改变量 a 的值</span></span><br><span class="line">a = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> (a <span class="keyword">and</span> b):</span><br><span class="line">    print(<span class="string">"3.变量 a 和 b 都为 true"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"3.变量 a 和 b 有一个不为 true"</span>)</span><br><span class="line"><span class="comment"># 3.变量 a 和 b 有一个不为 true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a <span class="keyword">or</span> b):</span><br><span class="line">    print(<span class="string">"4.变量 a 和 b 都为 true，或其中一个变量为 true"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"4.变量 a 和 b 都不为 true"</span>)</span><br><span class="line"><span class="comment"># 4.变量 a 和 b 都为 true，或其中一个变量为 true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔"非" not x ，取反</span></span><br><span class="line"><span class="comment"># 如果 x 为 True，返回 False 。</span></span><br><span class="line"><span class="comment"># 如果 x 为 False，返回 True。</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> (a <span class="keyword">and</span> b):</span><br><span class="line">    print(<span class="string">"5.变量 a 和 b 都为 false，或其中一个变量为 false"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"5.变量 a 和 b 都为 true"</span>)</span><br><span class="line"><span class="comment"># 5.变量 a 和 b 都为 false，或其中一个变量为 false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = <span class="literal">True</span></span><br><span class="line">y = <span class="literal">False</span></span><br><span class="line">z = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x <span class="keyword">or</span> y <span class="keyword">and</span> z:</span><br><span class="line">    print(<span class="string">"yes"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"no"</span>)</span><br><span class="line"><span class="comment"># yes</span></span><br><span class="line">print(<span class="string">'----'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="keyword">not</span> <span class="number">0.1</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="keyword">not</span> <span class="string">''</span>)  <span class="comment"># True</span></span><br><span class="line">print(<span class="keyword">not</span> <span class="string">'0'</span>)  <span class="comment"># False</span></span><br><span class="line">print(<span class="keyword">not</span> [])  <span class="comment"># True</span></span><br><span class="line">print(<span class="keyword">not</span> [<span class="number">1</span>, <span class="number">2</span>])  <span class="comment"># False</span></span><br><span class="line">print(bool(<span class="literal">None</span>))  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line">x = <span class="literal">True</span></span><br><span class="line">y = <span class="literal">False</span></span><br><span class="line">z = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> x <span class="keyword">or</span> y:</span><br><span class="line">    print(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="keyword">not</span> x <span class="keyword">or</span> <span class="keyword">not</span> y <span class="keyword">and</span> z:</span><br><span class="line">    print(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="keyword">not</span> x <span class="keyword">or</span> y <span class="keyword">or</span> <span class="keyword">not</span> y <span class="keyword">and</span> x:</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="number">4</span>)</span><br><span class="line"><span class="comment"># not x or y or not y and x就可以这么理解</span></span><br><span class="line"><span class="comment"># 假 or 假 or 真 and 真</span></span><br><span class="line"><span class="comment"># 假 or 假 or 真</span></span><br><span class="line"><span class="comment"># 假 or 真</span></span><br><span class="line"><span class="comment"># 真</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4. bool类型转换 , 字符串转bool只要字符串不是空字符串 都是true</span></span><br><span class="line">bool_data = bool(<span class="string">"12"</span>)</span><br><span class="line">print(bool_data)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.util <span class="keyword">import</span> strtobool</span><br><span class="line"></span><br><span class="line"><span class="comment"># bool_data = strtobool("2") # raise ValueError("invalid truth value %r" % (val,))</span></span><br><span class="line"><span class="comment"># ValueError: invalid truth value '2'</span></span><br><span class="line"></span><br><span class="line">bool_data = strtobool(<span class="string">"true"</span>)</span><br><span class="line">print(bool_data)  <span class="comment"># 1</span></span><br><span class="line">bool_data = strtobool(<span class="string">"True"</span>)</span><br><span class="line">print(bool_data)  <span class="comment"># 1</span></span><br><span class="line">bool_data = strtobool(<span class="string">"TRUE"</span>)</span><br><span class="line">print(bool_data)  <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bool_data = strtobool("TRUEFalse")  # raise ValueError("invalid truth value %r" % (val,))</span></span><br><span class="line"><span class="comment"># ValueError: invalid truth value 'truefalse'</span></span><br><span class="line"></span><br><span class="line">bool_data = strtobool(<span class="string">"1"</span>)</span><br><span class="line">print(bool_data)  <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line">bool_data = strtobool(<span class="string">"2"</span>)  <span class="comment"># raise ValueError("invalid truth value %r" % (val,))</span></span><br><span class="line"><span class="comment"># ValueError: invalid truth value '2'</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/python-yi-chang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/python-yi-chang/" class="post-title-link" itemprop="url">python异常</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-06 09:13:43" itemprop="dateModified" datetime="2021-07-06T09:13:43Z">2021-07-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="异常是class"><a href="#异常是class" class="headerlink" title="异常是class"></a>异常是class</h3><p>错误是业务过程的一部分，而异常不是 。</p>
<p>错误就是可以预先知道的出错的可能出现的情况，可能出现问题的地方出现了问题，比如打开一个文件时失败、参数检查， 数据库访问不了，这种情况在人们的意料之中 ；<br>即便程序的语法是正确的，在运行它的时候，也有可能发生错误。</p>
<p>异常指的是不应该出现、运行期检测到的错误、不可预知的问题的地方出现了问题，比如引用了空指针，这种情况在人们的意料之外。<br>程序员写的代码不严谨造成的某个地方在某种情况下产生了异常</p>
<p>大多数的异常都不会被程序处理，都以错误信息的形式展现在这里</p>
<p>捕获一个错误就是捕获到该class的一个实例<br>每个异常都是某个类的实例<br>发生了异常如果不捕获，则程序将终止执行</p>
<h3 id="Python内置的异常类-（有些语言使用错误码）"><a href="#Python内置的异常类-（有些语言使用错误码）" class="headerlink" title="Python内置的异常类 （有些语言使用错误码）"></a>Python内置的异常类 （有些语言使用错误码）</h3><ul>
<li>BaseException 所有异常的父类</li>
<li>ExceptionException    常规错误的基类</li>
<li>AttributeError    对象没有这个属性</li>
<li>不过有时报错显示的位置是有问题的，</li>
<li>并列跟系统相关异常：<br>SystemExit 解释器请求退出、KeyboardInterrupt<br>用户中断执行(通常是输入^C)、GeneratorExit<br>生成器(generator)发生异常来通知退出、OSError<br>操作系统错误</li>
</ul>
<p>这种情况通常的原因都是前面某一行的括号或者引号有问题，<br>而导致后面的代码错乱，试着往前看一看。</p>
<h3 id="使用异常的常见场景"><a href="#使用异常的常见场景" class="headerlink" title="使用异常的常见场景"></a>使用异常的常见场景</h3><p>什么时候需要捕获处理异常呢？看Python 内置异常类型</p>
<ul>
<li>网络请求（超时、链接错误等）</li>
<li>资源访问（权限问题、资源不存在）</li>
<li>代码逻辑（越界访问、KeyError等）</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python异常处理几个关键字</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># func  # 可能会抛出异常的代码，如果执行出错，那么 try 子句余下的部分将被忽略不会继续执行</span></span><br><span class="line"><span class="keyword">except</span> (Exception1, Exception2) <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 可以捕获多个异常并处理，如果异常的类型和 except 之后的名称相符</span></span><br><span class="line">    <span class="comment"># 异常处理的代码</span></span><br><span class="line">    <span class="comment"># 如果一个异常在 try 子句里（或者在 except 和 else 子句里）被抛出，而又没有任何的 except 把它捕获，</span></span><br><span class="line">    <span class="comment"># 那么这个异常会在 finally 子句执行后被抛出，那么它会一层一层的往上传递，程序将终止执行</span></span><br><span class="line">    <span class="comment"># 如果不想在异常发生时结束你的程序，只需在try里捕获它，可以跨越多层调用</span></span><br><span class="line">    <span class="comment"># 一个 try 语句可能包含多个except子句，分别来处理、捕获不同的特定的异常。</span></span><br><span class="line">    <span class="comment"># 最多只有一个分支会被执行。</span></span><br><span class="line">    <span class="comment"># 处理程序将只针对对应的 try 子句中的异常进行处理，</span></span><br><span class="line">    <span class="comment"># 而不是其他的 try 的处理程序中的异常。</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># 异常没有发生的时候代码逻辑</span></span><br><span class="line">    <span class="comment"># 使用 else 子句比把所有的语句都放在 try 子句里面要好，</span></span><br><span class="line">    <span class="comment"># 可以避免一些意想不到，而 except 又无法捕获的异常。</span></span><br><span class="line">    <span class="comment"># 异常处理并不仅仅处理那些直接发生在 try 子句中的异常，</span></span><br><span class="line">    <span class="comment"># 而且还能处理子句中调用的函数（甚至间接调用的函数）里抛出的异常。</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># 无论异常有没有发生都会执行的代码，一般处理资源的关闭和释放</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="如何自定义自己的异常？-为什么需要定义自己的异常"><a href="#如何自定义自己的异常？-为什么需要定义自己的异常" class="headerlink" title="如何自定义自己的异常？ 为什么需要定义自己的异常"></a>如何自定义自己的异常？ 为什么需要定义自己的异常</h3><ul>
<li>异常类继承自 Exception 类实现自定义异常，可以直接继承，或者间接继承，<br>( 为什么不是BaseException,如果继承了像KeyboardInterrupt这个异常,那么捕获的时候,Ctrl+c就会被作为异常捕获，就结束不了了）</li>
<li>给异常加上一些附加信息（比如代码业务相关信息等）</li>
<li>创建一个新的异常类来拥有自己的异常。（raise MyException）<br>大多数的异常的名字都以”Error”结尾，就跟标准的异常命名一样。</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyException</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> MyException(<span class="string">'my exception'</span>)  <span class="comment"># raise显示引发异常</span></span><br><span class="line"><span class="comment"># except MyException as e:      # 继承自定义异常</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e: <span class="comment"># 捕获一个父类异常时候，所有的子类异常都在捕获之内。</span></span><br><span class="line">    print(e)</span><br><span class="line"><span class="comment"># 输出结果：my exception</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divide</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = x / y</span><br><span class="line">    <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">        print(<span class="string">"division by zero!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"result is"</span>, result)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">"executing finally clause"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">divide(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment"># result is 2.0</span></span><br><span class="line"><span class="comment"># executing finally clause</span></span><br><span class="line">divide(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment"># division by zero!</span></span><br><span class="line"><span class="comment"># executing finally clause</span></span><br><span class="line">divide(<span class="string">"2"</span>, <span class="string">"1"</span>)</span><br><span class="line"><span class="comment"># executing finally clause</span></span><br><span class="line"><span class="comment"># Traceback(most recent call last):</span></span><br><span class="line"><span class="comment"># File "&lt;stdin&gt;", line 18, in &lt;module&gt; divide("2","1")</span></span><br><span class="line"><span class="comment"># File "&lt;stdin&gt;", line 3, in divide result = x / y</span></span><br><span class="line"><span class="comment"># TypeError: unsupported operand type(s) for /: 'str' and 'str'</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果要抛出错误，首先根据需要，<br>可以定义一个错误的class，选择好继承关系，<br>用raise语句抛出一个指定的异常。<br>raise语句如果不带参数，就会把当前错误原样抛出。<br>raise 唯一的一个参数指定了要被抛出的异常。它必须是一个异常的实例或者是异常的类（也就是 Exception 的子类）。<br>如果你只想知道这是否抛出了一个异常，并不想去处理它，那么一个简单的 raise 语句就可以再次把它抛出。</p>
<p>在except中raise一个Error，还可以把一种类型的错误转化成另一种类型</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">div</span>(<span class="params">num1, num2</span>):</span></span><br><span class="line">    <span class="string">""" 当除数为0时 """</span></span><br><span class="line">    <span class="keyword">return</span> num1 / num2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># rest = test_div(5, 0)</span></span><br><span class="line">        rest = div(<span class="number">5</span>, <span class="string">"s"</span>)</span><br><span class="line">        print(rest)</span><br><span class="line">    <span class="keyword">except</span> (ZeroDivisionError, TypeError) <span class="keyword">as</span> err:</span><br><span class="line">        print(<span class="string">'反正就是报错了'</span>)</span><br><span class="line">        print(err)</span><br><span class="line">    <span class="keyword">except</span> TypeError:</span><br><span class="line">        print(<span class="string">'报错了，请输入数字'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># rest = test_div(5, 's')</span></span><br><span class="line">    <span class="comment"># print(rest)</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">div</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="comment"># 在除法函数中判断我们被除数(b)是否为0</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="string">"被除数不能为0"</span></span><br><span class="line">        <span class="comment"># raise Exception("被除数不能为0") # 异常</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># dict访问了一个不存在的key， 在list中对空的list进行了data[0]</span></span><br><span class="line">    user_info_dict = {</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"bobby"</span>,</span><br><span class="line">        <span class="string">"age"</span>: <span class="number">18</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"weight"</span> <span class="keyword">in</span> user_info_dict:</span><br><span class="line">        user_info_dict[<span class="string">"weight"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果每个地方都这样写那代码中的if就太多了，那就是你的bug，这种问题就一定要早发现</span></span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">None</span></span><br><span class="line"><span class="comment"># 如果你的这个函数-div返回的是None这个时候调用者不会出问题</span></span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/hong-bao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/hong-bao/" class="post-title-link" itemprop="url">红包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-05 14:08:07" itemprop="dateModified" datetime="2021-07-05T14:08:07Z">2021-07-05</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>所谓红包?<br>不过是定量的数量和金额的红包序列</p>
<p>红包是具备虚拟资金特征的特殊商品<br>收/发红包实际上是资金的交易过程<br>资金交易是资金从一个账户转向另一个账户的过程</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/sdk-he-api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/sdk-he-api/" class="post-title-link" itemprop="url">SDK和API</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-09 09:01:28" itemprop="dateModified" datetime="2021-07-09T09:01:28Z">2021-07-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="软件开发工具包-SDK-Software-Development-Kit"><a href="#软件开发工具包-SDK-Software-Development-Kit" class="headerlink" title="软件开发工具包 SDK Software Development Kit"></a>软件开发工具包 SDK Software Development Kit</h3><p>辅助开发某一类软件的相关文档说明书、范例和工具的集合都可以叫做SDK。</p>
<p>SDK被开发出来是为了减少程序员工作量，越容易开发越好</p>
<p>比如——</p>
<p>有公司开发出某种软件的某一功能，把它封装成SDK（比如数据分析SDK就是能够实现数据分析功能的SDK），出售给其他公司做开发用，其他公司如果想要给软件开发出某种功能，但又不想从头开始搞开发，直接付钱省事。</p>
<p>SDK想象成一个虚拟的程序包，在这个程序包中有一份做好的软件功能，这份程序包几乎是全封闭的，只有一个小小接口可以联通外界，这个接口就是API。</p>
<p>这个SDK提供了这么多API<br>SDK 是可以下载的。API 是写在文档里的</p>
<p>你是个男的<br>你要开发一个BABY<br>SDK<br>就是房间、床、你老婆等一系列相关的工具、文档<br>API<br>就是你老婆开放的接口</p>
<p>有一杯密封饮料，它的名字叫做“SDK”。<br>饮料上插着吸管，吸管的名字叫“API”。</p>
<p>把你叫做“XX系统”。<br>如果你想喝到SDK里的饮料（让系统拥有SDK中的功能），你必须通过API这根吸管来实现（通过API连接你的系统和SDK工具包），否则你就喝不到饮料。</p>
<h3 id="API-Application-Programming-Interface-应用程序编程接口"><a href="#API-Application-Programming-Interface-应用程序编程接口" class="headerlink" title="API Application Programming Interface  应用程序编程接口"></a>API Application Programming Interface  应用程序编程接口</h3><p>是一些预先定义的函数，<br>目的是提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力，<br>而又无需访问源码，或理解内部工作机制的细节。</p>
<ul>
<li><p>预先定义好的程序代码</p>
</li>
<li><p>屏蔽实现的细节</p>
</li>
<li><p>被调用来获取信息或实现某些功能</p>
</li>
<li><p>我有一些功能</p>
</li>
<li><p>你们呢不用关心我是怎么实现的</p>
</li>
<li><p>我给你一个访问地址</p>
</li>
<li><p>你通过地址来找我，按照我规定的格式提供我需要的信息</p>
</li>
<li><p>我会给你你需要的信息反馈</p>
</li>
</ul>
<p>连接前端后端及移动端，系统与系统、模块与模块、服务与服务直接相互调用的入口，<br>开发者分工协作封装成接口，其他开发者只要按照对应格式，发送一些必要参数，就能使用功能</p>
<p>接口是一个对象的对外能力的展现，我们使用一个对象时，往往不需要知道一个对象的内部复杂实现，通过它暴露出来的接口，就知道了这个对象具备哪些能力以及如何使用这个能力。</p>
<p>我们常说「佛有千面」，不同的人看到的佛并不一样。一个复杂的复合对象常常也可以是一个多面手，它具备多种能力，在形式上实现了多种接口。「弱水三千，只取一瓢」，使用时我们根据不同的场合来挑选满足需要的接口能力来使用这个对象即可。</p>
<p><img src="/2020/08/21/sdk-he-api/%E6%8E%A5%E5%8F%A3.png" alt="description"></p>
<p>常见接口类型</p>
<ul>
<li>HTTP接口 传输文本表单数据、json类型的对象、xml类似的数据</li>
<li>RPC 远程方法调用，使用分布式系统，调用部署到其他服务器，远程调用希望像本地调用一样方便，让调用者感知不到远程调用的逻辑，不需要搞一串发起http请求的代码</li>
<li>SOAP - Simple Object Access Protocol 简单面向对象访问协议，一种协议规范，是一种轻量的，简单的，基于HTTP协议，使用XML作为默认的存储格式。</li>
</ul>
<p>SOAP与REST区别：</p>
<ul>
<li><p>安全性：SOAP会好于REST</p>
</li>
<li><p>效率和易用性：REST更胜一筹</p>
</li>
<li><p>成熟度：总的来说SOAP在成熟度上优于REST</p>
</li>
<li><p>Web Servicez 是一种跨编程语言 和 跨操作系统平台的远程调用技术。基于SOAP协议的PRC实践方案，可以拿到远程对象并调用其属性和方法，</p>
</li>
<li><p>REST API</p>
</li>
</ul>
<p>ndk Natvie Software Development Kit 原生工具开发包</p>
<p>API 是应用程序编程接口（Application Programming Interface）的缩写。维基百科指出，“总的来说，它是各种组件之间的一组明确定义的通信方法”。它可以是软件框架或库的接口，也可以是操作系统为原生系统软件（如 POSIX）开发人员公开的底层接口。</p>
<p>现如今，当人们谈论 API 时，他们通常指的是通过 HTTP 端点公开的远程接口。</p>
<p>我们通过底层设计范式（如查询、RPC 或 RESTful）或协议（如 SOAP、gRPC 或 GraphQL）进一步对远程 API（或 Web API）进行分类。除此之外，我们还通过目标受众来区分 API，将它们分为公共、合作伙伴或私有 / 内部 API。</p>
<p>API 的两面性</p>
<p>严格来说，API 仅用来描述接口，也就是客户端和服务器、API 消费者和 API 提供者之间用于交换信息的语言。对于 API 消费者来说，API 只不过是对接口和端点 URL 或 URL 集的描述。URL 是 Web 的基本构建块之一，客户端可以在不知道服务器性质或位置的情况下访问信息或服务。只要客户能够收到响应，它根本不管 URL 是指向隐藏在某个地下室的 Raspberry Pi 还是位于某个大陆数据中心的全球交付网络。这也是 API 能够如此令人感到兴奋的一个方面，因为各种开发人员可以利用其他人构建和公开的基础设施来增强其应用程序的附加功能。</p>
<p>但是，API 提供者不仅要设计、实现和文档化 API，还要考虑它背后的基础设施。在云计算时代，可能不需要购买硬件和租用数据中心。相反，API 提供者可以选择各种“XX 即服务”产品——从虚拟机或容器的托管集群到完全无服务器的代码托管环境。无论选择了什么样的基础设施，他们都需要部署 API。</p>
<p>我这里说的部署 API 是指部署暴露 API 所必需的代码和基础设施。从提供者的角度来看，API 并不是一个神奇的大门，而是需要在某个地方运行的有形资产。而且，随着公司转向微服务架构，这种资产就会变成微服务或一组微服务。</p>
<p>什么是微服务？</p>
<p>微服务是系统或应用程序中的自包含独立组件。每个微服务都应该有明确的作用域和责任，理想情况下，一个微服务只做一件事。它应该是无状态的或有状态的，如果它是有状态的，它应该带有自己的持久层（即数据库），不与其他服务共享。软件开发团队基于微服务架构以更分散的方式开发可重用的独立组件。他们可以为每个微服务使用自定义框架、依赖关系集，甚至是完全不同的编程语言。微服务也有助于实现可扩展性，因为它们本质上是分布式的，并且每个微服务都可以独立增长或复制。</p>
<p>容器和微服务</p>
<p>容器是在操作系统中建立隔离上下文的一种方法。实际上，这意味着它们中的每一个都有一个单独的包含了一组已安装的软件和相关配置的虚拟文件系统。由于它们是相互隔离的，因此任何容器都不能直接访问或影响其他容器或底层宿主操作系统。</p>
<p>创建容器的能力已经成为 Linux 操作系统的一部分，这种能力已经存在了很长一段时间，但直到 2013 年 Docker 的推出，容器才成为一种流行的技术。</p>
<p>需要注意的是微服务和容器之前半毛钱关系都没有，但这两个概念经常被放在一起谈论，就像 API 和微服务一样。如果没有容器，要么把服务器配置成可以运行多个微服务，让这些微服务不可避免地相互产生负面干扰，要么每个微服务都需要一个单独的服务器或自己的虚拟机，导致不必要的开销。因此，微服务通常被部署在一组由容器集群软件（如 Kubernetes）管理的一组容器中。可以肯定地说，容器和微服务的崛起其实是相互影响、相互促进的结果。</p>
<p>微服务之间的通信</p>
<p>基于微服务架构构建的应用程序或 API 不仅要把自己完全暴露出来，还需要在内部组件（微服务）之间建立连接。由于每个微服务都可以使用不同的编程语言实现，我们需要依赖标准协议（如 HTTP）来建立微服务之间的连接。这个时候我们就回到了 API 上。</p>
<p>最基本的形式是每个微服务都公开一个 API，让其他服务可以向这个 API 发出请求并获取数据。也可以使用其他不同的方法，比如消息队列。微服务 API 是私有 API，仅限用在单个应用程序中。它通常不提供公共 URL，而是使用组织内部专用网络的私有 IP 或主机名，甚至是单个服务器集群内的 IP 或主机名。不过，这些 API 可以遵循类似公共 API 那样的设计范式或协议。而且，尽管它们的消费者数量有限，也应该遵循开发者体验的基本规则。也就是说，它们应该拥有相关的、一致的、可演化的 API 设计和文档，让其他团队（甚至是你自己）知道如何使用这些微服务。因此，你可以而且应该使用类似的工具来创建你的微服务 API。</p>
<p>当然，与更面向外部的 API 相比，在设计微服务 API 时有不同的侧重点。</p>
<p>微服务和 API 是不同的东西，就像微服务和容器也不是同一种东西一样。不过，这两个概念以两种不同的方式协同工作：首先，微服务可以作为部署内部、合作伙伴或公共 API 后端的一种方法。其次，微服务通常依赖 API 作为与语言无关的通信手段，以便在内部网络中相互通信。开发团队可以使用相似的方法和工具来创建公开 API 和微服务 API。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/python-bao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/21/python-bao/" class="post-title-link" itemprop="url">python包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-11 02:51:51" itemprop="dateModified" datetime="2021-07-11T02:51:51Z">2021-07-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>python没有package说明自己属于什么package 和包名以及文件的名称<br>文件名就是包名，不需要声明包名<br>每多一个文件就多了一个package</p>
<p>import一个包中的函数或变量</p>
<p><code>as</code>别名 可以简化名字，可以避免不同文件重名的函数或变量</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> calc.add <span class="keyword">import</span> add1 <span class="keyword">as</span> add_int</span><br><span class="line"><span class="keyword">from</span> calc <span class="keyword">import</span> add</span><br><span class="line"><span class="keyword">from</span> calc.add_float <span class="keyword">import</span> add1 <span class="keyword">as</span> add_float</span><br><span class="line"></span><br><span class="line">print(add.add1(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">print(add_int(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">print(add_int(<span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__all__ =[<span class="string">'name'</span>,] <span class="comment"># 在from xx import * 的时候只暴露指定的函数或变量</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> calc.add <span class="keyword">import</span> add1</span><br><span class="line"><span class="keyword">from</span> calc <span class="keyword">import</span> add</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">x: int, y:int</span>) -&gt; int :</span></span><br><span class="line">    print(add1(x, y))</span><br><span class="line">    print(add.add1(x, y))</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line"></span><br><span class="line"><span class="comment">#每多一个文件就多了一个package</span></span><br><span class="line"></span><br><span class="line">print(sub(<span class="number">1</span>,<span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/06/30/hai-xiang-yun-suan-fu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/30/hai-xiang-yun-suan-fu/" class="post-title-link" itemprop="url">海象运算符</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-29 16:21:41" itemprop="dateCreated datePublished" datetime="2020-06-29T16:21:41Z">2020-06-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-31 07:56:45" itemprop="dateModified" datetime="2021-07-31T07:56:45Z">2021-07-31</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>python3.8提供了一个新的运算符 - 海象运算符 Assignment Expresions ，<br>即 赋值表达式。</p>
<p>由一个 : 和 一个 = 组成，即：<code>:=</code> 。我们一般称作 walrus operator（海象运算符），因为它看起来就是一个海象旋转 90° 而成。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(variable_name := expression <span class="keyword">or</span> value)</span><br></pre></td></tr></tbody></table></figure>

<p>即一个变量名后跟一个表达式或者一个值，这个和赋值运算符 = 类似，可以看作是一种新的赋值运算符。<br>可以将两行代码变成一行</p>
<h4 id="用于-if-else-条件表达式"><a href="#用于-if-else-条件表达式" class="headerlink" title="用于 if-else 条件表达式"></a>用于 if-else 条件表达式</h4><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">course_list = [<span class="string">"django"</span>, <span class="string">"scrapy"</span>, <span class="string">"tornado"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># len(course_list)要执行两次</span></span><br><span class="line"><span class="keyword">if</span> len(course_list) &gt;= <span class="number">3</span>:</span><br><span class="line">    print(<span class="string">"课程较多， 课程数量： {}"</span>.format(len(course_list)))</span><br><span class="line">    <span class="comment"># 课程较多， 课程数量： 3</span></span><br><span class="line"></span><br><span class="line">course_size = len(course_list)  <span class="comment"># 多了一行</span></span><br><span class="line"><span class="keyword">if</span> course_size &gt;= <span class="number">3</span>:</span><br><span class="line">    print(<span class="string">"课程较多， 课程数量： {}"</span>.format(course_size))</span><br><span class="line">    <span class="comment"># 课程较多， 课程数量： 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> course_size := len(course_list) &gt;= <span class="number">3</span>:</span><br><span class="line">    <span class="comment"># if course_size := (len(course_list) &gt;= 3): 因为&gt;=的优先级高于:=</span></span><br><span class="line">    print(<span class="string">"课程较多， 课程数量： {}"</span>.format(course_size))</span><br><span class="line">    <span class="comment"># 课程较多， 课程数量： True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (course_size := len(course_list)) &gt;= <span class="number">3</span>:</span><br><span class="line">    print(<span class="string">"课程较多， 课程数量： {}"</span>.format(course_size))</span><br><span class="line">    <span class="comment"># 课程较多， 课程数量： 3</span></span><br><span class="line"></span><br><span class="line">course_size = len(course_list)</span><br><span class="line">powers = [course_size, course_size**<span class="number">2</span>, course_size**<span class="number">3</span>]</span><br><span class="line">print(powers)  <span class="comment"># [3, 9, 27]</span></span><br><span class="line"></span><br><span class="line">powers = [course_size := len(course_list), course_size**<span class="number">2</span>, course_size**<span class="number">3</span>]</span><br><span class="line">print(powers)  <span class="comment"># [3, 9, 27]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">desc = <span class="string">"bobby:18"</span></span><br><span class="line"></span><br><span class="line">m = re.match(<span class="string">"bobby:(.*)"</span>, desc)</span><br><span class="line"><span class="keyword">if</span> m:</span><br><span class="line">    age = m.group(<span class="number">1</span>)</span><br><span class="line">    print(age)  <span class="comment"># 18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> m := re.match(<span class="string">"bobby:(.*)"</span>, desc):</span><br><span class="line">    age = m.group(<span class="number">1</span>)</span><br><span class="line">    print(age)  <span class="comment"># 18</span></span><br><span class="line"></span><br><span class="line">age = <span class="number">18</span></span><br><span class="line"><span class="comment"># 海象运算符不能赋值，go可以</span></span><br><span class="line"><span class="comment"># age := 18  # SyntaxError: invalid syntax</span></span><br><span class="line">age += <span class="number">5</span></span><br><span class="line"><span class="comment"># 海象运算符不能加减，go可以</span></span><br><span class="line"><span class="comment"># age :+= 5  # SyntaxError: invalid syntax</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="用于-while-循环"><a href="#用于-while-循环" class="headerlink" title="用于 while 循环"></a>用于 while 循环</h4><p>常规写法：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">6</span></span><br><span class="line"><span class="keyword">while</span> n:</span><br><span class="line">    print(<span class="string">'hello word!'</span>)</span><br><span class="line">    n -= <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>海象运算符：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">6</span></span><br><span class="line"><span class="keyword">while</span> (n := n - <span class="number">1</span>) + <span class="number">1</span>: <span class="comment"># 需要加1是因为执行输出前n就减1了</span></span><br><span class="line">    print(<span class="string">'hello word!'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>读取文件：</p>
<p>常规写法：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fp = open(<span class="string">"test.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = fp.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(line.strip())</span><br><span class="line">fp.close()</span><br></pre></td></tr></tbody></table></figure>

<p>海象运算符：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fp = open(<span class="string">"test.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="keyword">while</span> line := fp.readline():</span><br><span class="line">    print(line.strip())</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/33/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><span class="page-number current">34</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/35/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
