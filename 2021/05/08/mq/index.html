<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="消息队列是一种“先进先出”的数据结构消息传输过程中存放消息的容器 什么时候不使用MQ？上游实时关注执行结果 什么时候使用MQ？1）数据驱动的任务依赖，多个任务需要轮流执行，轮流订阅上一个任务。 2）上游不关心多下游执行结果，上游执行完发送到MQ，多下游订阅MQ。 3）异步返回执行时间长 应用场景 应用解耦系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统">
<meta property="og:type" content="article">
<meta property="og:title" content="mq（message queue）">
<meta property="og:url" content="https://bubbleboy11.github.io/2021/05/08/mq/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="消息队列是一种“先进先出”的数据结构消息传输过程中存放消息的容器 什么时候不使用MQ？上游实时关注执行结果 什么时候使用MQ？1）数据驱动的任务依赖，多个任务需要轮流执行，轮流订阅上一个任务。 2）上游不关心多下游执行结果，上游执行完发送到MQ，多下游订阅MQ。 3）异步返回执行时间长 应用场景 应用解耦系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-05-07T16:21:41.000Z">
<meta property="article:modified_time" content="2021-06-26T12:41:57.207Z">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/2021/05/08/mq/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://bubbleboy11.github.io/2021/05/08/mq/","path":"2021/05/08/mq/","title":"mq（message queue）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>mq（message queue） | 外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MQ%E7%9A%84%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9"><span class="nav-text">MQ的优点和缺点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9rocketmq%EF%BC%8C%E5%9F%BA%E4%BA%8E%E4%B8%A4%E7%82%B9%E8%80%83%E8%99%91"><span class="nav-text">选择rocketmq，基于两点考虑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85rocket-mq"><span class="nav-text">安装rocket mq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD"><span class="nav-text">消息队列的相关术语</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-text">消息队列的工作模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85rabbit-mq"><span class="nav-text">安装rabbit mq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker%E5%AE%89%E8%A3%85rabbitmq"><span class="nav-text">docker安装rabbitmq</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">343</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/05/08/mq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mq（message queue）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-07 16:21:41" itemprop="dateCreated datePublished" datetime="2021-05-07T16:21:41Z">2021-05-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-26 12:41:57" itemprop="dateModified" datetime="2021-06-26T12:41:57Z">2021-06-26</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>消息队列是一种“先进先出”的数据结构<br>消息传输过程中存放消息的容器</p>
<p>什么时候不使用MQ？<br>上游实时关注执行结果</p>
<p>什么时候使用MQ？<br>1）数据驱动的任务依赖，多个任务需要轮流执行，轮流订阅上一个任务。</p>
<p>2）上游不关心多下游执行结果，上游执行完发送到MQ，多下游订阅MQ。</p>
<p>3）异步返回执行时间长</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>应用解耦<br>系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。</li>
</ul>
<p>使用消息队列解耦合，系统的耦合性就会提高了。比如物流系统发生故障，需要几分钟才能来修复，在这段时间内，物流系统要处理的数据被缓存到消息队列中，用户的下单操作正常完成。当物流系统回复后，补充处理存在消息队列中的订单消息即可，终端系统感知不到物流系统发生过几分钟故障。</p>
<ul>
<li>流量削峰</li>
</ul>
<p>应用系统如果遇到系统请求流量的瞬间猛增，有可能会将系统压垮。<br>有了消息队列可以将大量请求缓存起来，分散到很长一段时间处理，这样可以大大提到系统的稳定性和用户体验。<br>性能考虑，一般采用下游队列限速<br>每秒5k个请求MQ用户A系统从MQ中每秒拉取2k个请求A系统MySQL</p>
<p>一般情况，为了保证系统的稳定性，如果系统负载超过阈值，就会阻止用户请求，这会影响用户体验，而如果使用消息队列将请求缓存起来，等待系统处理完毕后通知用户下单完毕，这样总不能下单体验要好。</p>
<p>出于经济考量目的：<br>业务系统正常时段的QPS如果是1000，流量最高峰是10000，为了应对流量高峰配置高性能的服务器显然不划算，这时可以使用消息队列对峰值流量削峰</p>
<ul>
<li>数据分发</li>
</ul>
<p>通过消息队列可以让数据在多个系统更加之间进行流通。数据的产生方不需要关心谁来使用数据，只需要将数据发送到消息队列，数据使用方直接在消息队列中直接获取数据即可。</p>
<ul>
<li>跨系统间的调用(比如：发短信，防止由于第三方平台原因导致我们系统的逻辑问题)</li>
<li>系统内的异步调用，非必要、没有实时性的逻辑 比如发邮件功能</li>
<li>消息驱动的场景 当满足一个条件后，触发一系列的操作</li>
<li>跨语言之间的调用</li>
</ul>
<h3 id="MQ的优点和缺点"><a href="#MQ的优点和缺点" class="headerlink" title="MQ的优点和缺点"></a>MQ的优点和缺点</h3><p>优点</p>
<ul>
<li>跨语言的，支持PHP，GO，JAVA，C# ，Python</li>
<li>解耦、</li>
<li>削峰、</li>
<li>数据分发</li>
<li>异步<br>高可用，扩展性，多语言客户端，管理界面等</li>
</ul>
<p>缺点包含以下几点：</p>
<ul>
<li><p>系统可用性降低<br>系统引入的外部依赖越多，系统稳定性越差。一旦MQ宕机，就会对业务造成影响。<br>如何保证MQ的高可用？</p>
</li>
<li><p>系统复杂度提高<br>MQ的加入大大增加了系统的复杂度，以前系统间是同步的远程调用，现在是通过MQ进行异步调用。<br>如何保证消息没有被重复消费？怎么处理消息丢失情况？那么保证消息传递的顺序性？</p>
</li>
<li><p>一致性问题<br>A系统处理完业务，通过MQ给B、C、D三个系统发消息数据，如果B系统、C系统处理成功，D系统处理失败。<br>如何保证消息数据处理的一致性？</p>
</li>
</ul>
<p>结论:</p>
<p>(1)中小型软件公司，建议选RabbitMQ.一方面，erlang语言天生具备高并发的特性，而且他的管理界面用起来十分方便。正所谓，成也萧何，败也萧何！<br>他的弊端也在这里，虽然RabbitMQ是开源的，然而国内有几个能定制化开发erlang的程序员呢？<br>所幸，RabbitMQ的社区十分活跃，可以解决开发过程中遇到的bug，这点对于中小型公司来说十分重要。<br>不考虑rocketmq和kafka的原因是，一方面中小型软件公司不如互联网公司，数据量没那么大，选消息中间件，应首选功能比较完备的，所以kafka排除。<br>但是rocketmq已经交给apache管理，所以rocketmq的未来发展趋势看好。</p>
<p>(2)大型软件公司，根据具体使用在rocketMq和kafka之间二选一。一方面，大型软件公司，具备足够的资金搭建分布式环境，也具备足够大的数据量。针对rocketMQ,大型软件公司也可以抽出人手对rocketMQ进行定制化开发，毕竟国内有能力改JAVA源码的人，还是相当多的。至于kafka，根据业务场景选择，如果有日志采集功能，肯定是首选kafka了。具体该选哪个，看使用场景。</p>
<p>典型的应用案例<br>1、注册时发送邮件或发送短信<br>2、日志分析使用，多个服务产生的数据发送到中间件发送到分析服务。<br>3、消息复制，用于跨机房数据传输、搜索、离线数据计算等。<br>4、延迟消息发送和暂存，把中间件当成可靠的消息暂存地。接受消息，暂时先不发送</p>
<h3 id="选择rocketmq，基于两点考虑"><a href="#选择rocketmq，基于两点考虑" class="headerlink" title="选择rocketmq，基于两点考虑"></a>选择rocketmq，基于两点考虑</h3><ul>
<li>延迟消息简单高效</li>
<li>死信队列</li>
<li>完善的事务消息功能</li>
</ul>
<h3 id="安装rocket-mq"><a href="#安装rocket-mq" class="headerlink" title="安装rocket mq"></a>安装rocket mq</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># cd /root/project/mxshop_srvs/order_srv/</span></span><br><span class="line">[root@VM-0-9-centos order_srv]<span class="comment"># ls</span></span><br><span class="line">install  install.zip</span><br><span class="line">[root@VM-0-9-centos order_srv]<span class="comment"># cd install/</span></span><br><span class="line">[root@VM-0-9-centos install]<span class="comment"># ls</span></span><br><span class="line">conf  docker-compose.yml  README.md</span><br><span class="line">[root@VM-0-9-centos install]<span class="comment"># cd conf/</span></span><br><span class="line">[root@VM-0-9-centos conf]<span class="comment"># vim broker.conf</span></span><br><span class="line">brokerIP1=81.69.41.250  <span class="comment"># linux的ip</span></span><br><span class="line">[root@VM-0-9-centos conf]<span class="comment"># cd ..</span></span><br><span class="line">[root@VM-0-9-centos install]<span class="comment"># ls</span></span><br><span class="line">conf  docker-compose.yml  logs  README.md  store</span><br><span class="line">[root@VM-0-9-centos install]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS                       PORTS                                                  NAMES</span><br><span class="line">bd592bce48b8   styletang/rocketmq-console-ng   <span class="string">"sh -c 'java <span class="variable">$JAVA_O</span>…"</span>   16 minutes ago   Exited (137) 6 minutes ago                                                          rmqconsole</span><br><span class="line">01a559d554f8   foxiswho/rocketmq:broker        <span class="string">"mqbroker -c /etc/ro…"</span>   16 minutes ago   Exited (137) 6 minutes ago                                                          rmqbroker</span><br><span class="line">bff14878447c   foxiswho/rocketmq:server        <span class="string">"/bin/sh -c 'cd <span class="variable">${RO…"   16 minutes ago   Exited (137) 6 minutes ago                                                          rmqnamesrv</span></span></span><br><span class="line"><span class="string"><span class="variable">a7df53a51485   mysql:5.7                       "docker-entrypoint.s…"   11 hours ago     Up 11 hours                  0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mymysql</span></span></span><br><span class="line"><span class="string"><span class="variable">[root@VM-0-9-centos install]# docker-compose up</span></span></span><br></pre></td></tr></tbody></table></figure>

<p><a target="_blank" rel="noopener" href="http://81.69.41.250:8080/#/">http://81.69.41.250:8080/#/</a></p>
<h3 id="消息队列的相关术语"><a href="#消息队列的相关术语" class="headerlink" title="消息队列的相关术语"></a>消息队列的相关术语</h3><ul>
<li>Publisher生产者 投递消息的一方，生产者将消息投递到交换机。</li>
<li>Producer生产者 发送消息到队列 </li>
<li>Consumer消费者 从队列中取出消息消费掉 接收消息的一方，消费者可以监听一个或多个队列，接收到消息后需要返回应答；多个消费者监听同一队列时，RabbitMQ并不会以广播的形式让每个消费者都接收到全部消息，而是多个消费者以轮询的方式接收并处理消息。</li>
<li>Queue 存储消息的容器 队列 消息的载体，接收消息，每个队列都至少会绑定一个交换机，从交换机接收消息。</li>
<li>连接Connection&amp;信道 消息通道Channel<br>和RabbitMQ建立连接 连接中可以有多个通道<br>连接就是一个普通的TCP连接，信道是建立在连接上的虚拟连接，无论消费者还是生产者都是通过信道发送指令，信道复用了TCP连接，节省资源。</li>
</ul>
<ul>
<li><p>Exchange交换机 决定消息按照什么规则发送到哪个队列中<br>生产者将消息投递到交换机后，交换机根据路由键、绑定键和交换机类型将消息路由到具体的队列中。<br>一共有4中类型：<br>fanout：向所有绑定的队列发送消息。<br>direct：对路由键和绑定键进行精准匹配，完全一致的队列会收到消息。<br>topic：对路由键和绑定键进行模糊匹配，符合匹配规则的队列会收到消息，路由键和绑定键都是由“.”分隔的一个字符串，每一个被“.”分隔开的独立的子字符串称作“单词”，绑定键中有两种通配符：①*，星号表示匹配一个单词；②#，井号表示匹配多个单词(可以是0个)。<br>header：根据绑定队列与交换机时的额外参数进行路由匹配，性能很差，基本不用。</p>
</li>
<li><p>Routing Key 路由键&amp;绑定键 交换机通过它来确定发送到哪个队列中<br>路由键是生产者发送消息给交换机的时候指定的，绑定键是队列与交换机绑定的时候指定的，根据交换机的类型，将会对路由键和绑定键进行精准匹配或模糊匹配，以此确定消息应该发往哪个队列。在direct模式的交换机下，可以将路由键和绑定键看作是一个东西，因为这时执行的是精准匹配。</p>
</li>
</ul>
<ul>
<li><p>消息 包含两部分，分别是标签(Label，用来描述这则消息如交换机名称、路由键、优先权等)以及消息体(payload，消息的具体内容)。</p>
</li>
<li><p>Virtual Host 虚拟主机<br>可以看做一个文件夹，里面装了一组交换机、队列和绑定关系等相关对象，每个Broker可以有多个Virtual Host，在建立连接时必须指定一个Virtual Host，默认是“/”。隔离数据</p>
</li>
<li><p>Broker 消息队列服务器实体。</p>
</li>
</ul>
<h3 id="消息队列的工作模式"><a href="#消息队列的工作模式" class="headerlink" title="消息队列的工作模式"></a>消息队列的工作模式</h3><ul>
<li>简单模式：不需要交换机，场景：一对一聊天</li>
<li>工作模式 高并发时容易造成同一个消息到多个消费者同时消费(可以加唯一键值解决)<br>场景：红包</li>
<li>订阅模式 每个队列收到的消息都是一样的 E代表交换机</li>
<li>路由模式 根据routing key发送到不同的消息队列中，场景：不同等级日志</li>
<li>主题模式 根据<code>*</code>或<code>#</code>和路由模糊匹配，发送到不同的消息队列中，<br><code>#</code>匹配一个或多个单词，<code>*</code>匹配一个单词</li>
</ul>
<ol>
<li>RabbitMQ是面向消息的中间件,用于组件之间的解耦,主要体现在消息的发送者和消费者之间无强依赖关系;</li>
</ol>
<p>比如 a 系统发送消息要 b 系统处理的时候，我们的 a 系统可以将消息发送到 mq, 等待着 b 系统去消费，这就实现了 a 和 b 系统之间的解耦</p>
<h3 id="安装rabbit-mq"><a href="#安装rabbit-mq" class="headerlink" title="安装rabbit mq"></a>安装rabbit mq</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br><span class="line">yum install -y erlang-23.3.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># For Red Hat 7 or CentOS 7, replace "el8" with "el7".</span></span><br><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.17/rabbitmq-server-3.8.17-1.el7.noarch.rpm</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/erlang/bin/erl</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/erlang/bin</span><br><span class="line"></span><br><span class="line">ERLANG_HOME=/home/yutao/programe/erlang</span><br><span class="line">RABITMQ_HOME=/home/yutao/programe/rabbitmq</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ERLANG_HOME</span>/bin:<span class="variable">$RABITMQ_HOME</span>/sbin</span><br><span class="line"><span class="built_in">export</span> ERLANG_HOME</span><br><span class="line"><span class="built_in">export</span> RABITMQ_HOME</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># find / -name erl</span></span><br><span class="line">/usr/<span class="built_in">local</span>/erlang/lib/erlang/erts-12.0/bin/erl</span><br><span class="line">/usr/<span class="built_in">local</span>/erlang/lib/erlang/bin/erl</span><br><span class="line">/usr/<span class="built_in">local</span>/erlang/bin/erl</span><br><span class="line">/usr/bin/erl</span><br><span class="line">/usr/lib64/erlang/erts-11.2.2/bin/erl</span><br><span class="line">/usr/lib64/erlang/bin/erl</span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># erl -version</span></span><br><span class="line">Erlang (SMP,ASYNC_THREADS,HIPE) (BEAM) emulator version 11.2.2</span><br><span class="line">[root@VM-0-9-centos ~]<span class="comment"># erl -v</span></span><br><span class="line">Erlang/OTP 23 [erts-11.2.2] [<span class="built_in">source</span>] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:1] [hipe]</span><br></pre></td></tr></tbody></table></figure>

<p>有几种退出Erlang Shell的方法<br>命令方式1：执行init:stop().<br>命令方式2：执行halt().<br>快捷键方式1：Control+C 然后选a<br>快捷键方式2：Control+G 然后按q</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --zone=public --permanent --add-port=4369/tcp --add-port=25672/tcp --add-port=5671-5672/tcp --add-port=15672/tcp --add-port=61613-61614/tcp --add-port=1883/tcp --add-port=8883/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/rabbitmq_erlang.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在其中添加以下内容</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In /etc/yum.repos.d/rabbitmq.repo</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Zero dependency Erlang RPM</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"></span><br><span class="line">[rabbitmq_erlang]</span><br><span class="line">name=rabbitmq_erlang</span><br><span class="line">baseurl=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/rpm/el/8/$basearch</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Cloudsmith<span class="string">'s repository key and RabbitMQ package signing key</span></span></span><br><span class="line">gpgkey=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/gpg.E495BB49CC4BBE5B.key</span><br><span class="line">       https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc</span><br><span class="line">gpgcheck=1</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br><span class="line">pkg_gpgcheck=1</span><br><span class="line">autorefresh=1</span><br><span class="line">type=rpm-md</span><br><span class="line"></span><br><span class="line">[rabbitmq_erlang-noarch]</span><br><span class="line">name=rabbitmq_erlang-noarch</span><br><span class="line">baseurl=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/rpm/el/8/noarch</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Cloudsmith<span class="string">'s repository key and RabbitMQ package signing key</span></span></span><br><span class="line">gpgkey=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/gpg.E495BB49CC4BBE5B.key</span><br><span class="line">       https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc</span><br><span class="line">gpgcheck=1</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br><span class="line">pkg_gpgcheck=1</span><br><span class="line">autorefresh=1</span><br><span class="line">type=rpm-md</span><br><span class="line"></span><br><span class="line">[rabbitmq_erlang-source]</span><br><span class="line">name=rabbitmq_erlang-source</span><br><span class="line">baseurl=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/rpm/el/8/SRPMS</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/gpg.E495BB49CC4BBE5B.key</span><br><span class="line">gpgcheck=0</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br><span class="line">pkg_gpgcheck=1</span><br><span class="line">autorefresh=1</span><br><span class="line">type=rpm-md</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># RabbitMQ Server</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"></span><br><span class="line">[rabbitmq_server]</span><br><span class="line">name=rabbitmq_server</span><br><span class="line">baseurl=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/rpm/el/8/$basearch</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Cloudsmith<span class="string">'s repository key and RabbitMQ package signing key</span></span></span><br><span class="line">gpgkey=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/gpg.9F4587F226208342.key</span><br><span class="line">       https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc</span><br><span class="line">gpgcheck=1</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br><span class="line">pkg_gpgcheck=1</span><br><span class="line">autorefresh=1</span><br><span class="line">type=rpm-md</span><br><span class="line"></span><br><span class="line">[rabbitmq_server-noarch]</span><br><span class="line">name=rabbitmq_server-noarch</span><br><span class="line">baseurl=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/rpm/el/8/noarch</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Cloudsmith<span class="string">'s repository key and RabbitMQ package signing key</span></span></span><br><span class="line">gpgkey=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/gpg.9F4587F226208342.key</span><br><span class="line">       https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc</span><br><span class="line">gpgcheck=1</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br><span class="line">pkg_gpgcheck=1</span><br><span class="line">autorefresh=1</span><br><span class="line">type=rpm-md</span><br><span class="line"></span><br><span class="line">[rabbitmq_server-source]</span><br><span class="line">name=rabbitmq_server-source</span><br><span class="line">baseurl=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/rpm/el/8/SRPMS</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/gpg.9F4587F226208342.key</span><br><span class="line">gpgcheck=0</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br><span class="line">pkg_gpgcheck=1</span><br><span class="line">autorefresh=1</span><br><span class="line">type=rpm-md</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh rabbitmq-server-3.8.17.rc.1-1.el7.noarch.rpm</span><br><span class="line">rpm -ivh rabbitmq-server-3.8.17-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos sbin]# cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.17/sbin</span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmq-server start</span><br><span class="line"><span class="meta">#</span><span class="bash"> 守护进程的方式启动</span></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmq-server -detached</span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl stop</span><br><span class="line">[root@VM-0-9-centos sbin]# ls</span><br><span class="line">erl_crash.dump  rabbitmqctl  rabbitmq-defaults  rabbitmq-diagnostics  rabbitmq-env  rabbitmq-plugins  rabbitmq-queues  rabbitmq-server  rabbitmq-upgrade</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 management 插件</span></span><br><span class="line">[root@VM-0-9-centos sbin]# rabbitmq-plugins enable rabbitmq_management</span><br><span class="line">Enabling plugins on node rabbit@VM-0-9-centos:</span><br><span class="line">rabbitmq_management</span><br><span class="line">The following plugins have been configured:</span><br><span class="line">  rabbitmq_management</span><br><span class="line">  rabbitmq_management_agent</span><br><span class="line">  rabbitmq_web_dispatch</span><br><span class="line">Applying plugin configuration to rabbit@VM-0-9-centos...</span><br><span class="line">Plugin configuration unchanged.</span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl list_users  # 查看所有用户列表</span><br><span class="line">Listing users ...</span><br><span class="line">user    tags</span><br><span class="line">guest   [administrator]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加新用户，用户名为<span class="string">"root"</span>，密码为<span class="string">"root"</span></span></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl add_user root root</span><br><span class="line">Adding user "root" ...</span><br><span class="line">Done. Don't forget to grant the user permissions to some virtual hosts! See 'rabbitmqctl help set_permissions' to learn more.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为root用户设置所有权限 授权远程访问</span></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl set_permissions -p / root ".*" ".*" ".*"</span><br><span class="line">Setting permissions for user "root" in vhost "/" ...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置用户为管理员角色</span></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl set_user_tags root administrator</span><br><span class="line">Setting tags for user "root" to [administrator] ...</span><br><span class="line"></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl list_permissions -p /</span><br><span class="line">Listing permissions for vhost "/" ...</span><br><span class="line">user    configure       write   read</span><br><span class="line">root    .*      .*      .*</span><br><span class="line">guest   .*      .*      .*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定用户权限</span></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl list_user_permissions root</span><br><span class="line">Listing permissions for user "root" ...</span><br><span class="line">vhost   configure       write   read</span><br><span class="line">/       .*      .*      .*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除用户（安全起见，删除默认用户）</span></span><br><span class="line">./rabbitmqctl delete_user guest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看运行状态</span></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl status</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看集群状态，目前只有一个RabbitMQ服务节点，可以看作单节点集群</span></span><br><span class="line">[root@VM-0-9-centos sbin]# ./rabbitmqctl cluster_status</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>配置好用户之后重新启动 rabbitmq 然后用你新的账号登录即可，这样不仅可以本地登录也可以远程登录了！</p>
<p>netstat -lnp|grep 25672<br>netstat -ntpl |grep</p>
<p>RABBITMQ_DEFAULT_USER：默认的用户名；<br>RABBITMQ_DEFAULT_PASS：默认用户名的密码）</p>
<p>日志</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]<span class="comment"># cd /var/log/rabbitmq</span></span><br><span class="line">[root@VM-0-9-centos rabbitmq]<span class="comment"># ls</span></span><br><span class="line">erl_crash.dump  <span class="built_in">log</span>  rabbit@VM-0-9-centos.log  rabbit@VM-0-9-centos_upgrade.log</span><br><span class="line">[root@VM-0-9-centos rabbitmq]<span class="comment"># vim rabbit@VM-0-9-centos.log</span></span><br></pre></td></tr></tbody></table></figure>

<p>用户角色说明<br>默认情况下，访问RabbitMQ服务的用户名和密码都是”guest”,这个账户有限制，<br>默认只能通过本地网络(如localhost)访问，也就是只能登陆localhost:15672。<br>远程网络访问受限，<br>使用默认的用户 guest / guest （此也为管理员用户）登陆，会发现无法登陆，报错：User can only log in via localhost。<br>所以在实现生产和消费消息之前，需要另外添加一个用户，并设置相应的访问权限</p>
<p>1、 超级管理员(administrator)<br>可登陆管理控制台，可查看所有的信息，并且可以对用户，策略(policy)进行操作。</p>
<p>2、 监控者(monitoring)<br>可登陆管理控制台，同时可以查看rabbitmq节点的相关信息(进程数，内存使用情况，磁盘使用情况等)</p>
<p>3、 策略制定者(policymaker)<br>可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的相关信息(上图红框标识的部分)。</p>
<p>4、 普通管理者(management)<br>仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。</p>
<p>5、 其他<br>无法登陆管理控制台，通常就是普通的生产者和消费者。</p>
<p>死信队列多了一个过期的机制，到期会自动去尝试消费，通过死信交换机做匹配，选择想要的消费失败的消息。<br>消息中间件是在消息传输过程中保存消息的容器。队列的主要目的是提供路由并保证消息的传递。<br>特点：<br>1异步处理模式<br>2多个应用程序调用关系为松耦合关系<br>传递模型：<br>1、点多点模型PTP<br>每个消息只用一个消费者<br>发送者和接收者没有时间依赖<br>接受者确认消息接受和处理成功<br>2、发布-订阅模型Pub/Sub<br>一对多关系，通过订阅主题，发布者建立一个订阅，订阅者保持持续的活动状态以接收消息。<br>每个消息可以有多个订阅者<br>客户端只有订阅后才能接收到消息，有时间依赖。<br>持久订阅 订阅关系建立后，消息不会消失，不管订阅者是否都在线<br>非持久订阅 订阅者为了接受消息，必须一直在线</p>
<h3 id="docker安装rabbitmq"><a href="#docker安装rabbitmq" class="headerlink" title="docker安装rabbitmq"></a>docker安装rabbitmq</h3><p>1、进入docker hub镜像仓库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>2、搜索rabbitMq，进入官方的镜像，可以看到以下几种类型的镜像；我们选择带有“mangement”的版本（包含web管理页面）；<br>‘<br>1.拉取镜像</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker pull rabbitmq:3.8.17-management</span></span><br></pre></td></tr></tbody></table></figure>

<p>2.创建容器，如果没有拉取会自动拉取</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --hostname my-rabbit --name some-rabbit rabbitmq:3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --hostname my-rabbit --name some-rabbit -p 8080:15672 rabbitmq:3-management</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --name rabbitmq3.7.7 -p 5672:5672 -p 15672:15672 -v `<span class="built_in">pwd</span>`/data:/var/lib/rabbitmq --hostname myRabbit -e RABBITMQ_DEFAULT_VHOST=my_vhost  -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin df80af9ca0c9</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run -p 5672:5672 -p 15672:15672 -d --name rabbitmq -v /docker/rabbitmq:/var/lib/rabbitmq --privileged=<span class="literal">true</span> --hostname myRabbitmq -e RABBITMQ_DEFAULT_VHOST=my_vhost -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin rabbitmq</span></span><br></pre></td></tr></tbody></table></figure>

<p>-d 后台运行容器；</p>
<p>–name 指定容器名；</p>
<p>-p 指定服务运行的端口（5672：应用访问端口；15672：控制台Web端口号）；</p>
<p>-v 映射目录或文件；</p>
<p>–hostname  主机名（RabbitMQ的一个重要注意事项是它根据所谓的 “节点名称” 存储数据，默认为主机名）；</p>
<p>-e 指定环境变量；（RABBITMQ_DEFAULT_VHOST：默认虚拟机名；</p>
<p>3.进入容器安装可视化工具</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-9-centos ~]# docker exec -it rabbitmq bash</span><br><span class="line">root@myRabbitmq:/# rabbitmq-plugins list</span><br><span class="line">root@myRabbitmq:/# rabbitmq-plugins enable rabbitmq_management</span><br><span class="line">root@myRabbitmq:/# rabbitmq-plugins disable rabbitmq_management</span><br><span class="line">root@myRabbitmq:/# rabbitmqctl list_users  # 查看当前用户列表</span><br><span class="line">Listing users ...</span><br><span class="line">user    tags</span><br><span class="line">admin   [administrator]</span><br><span class="line">root@myRabbitmq:/# rabbitmqctl  change_password  Username  'Newpassword' </span><br></pre></td></tr></tbody></table></figure>

<p>rabbitmq 是自己的容器中 RabbitMQ 的名称，可通过 docker ps 进行查看，然后替换自己容器中的 名称 即可’</p>
<p>4.浏览器访问<a target="_blank" rel="noopener" href="http://ip:15672/">http://IP:15672/</a> </p>
<p>输入用户名和密码就OK了</p>
<p>wget <a target="_blank" rel="noopener" href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.17/rabbitmq-server-3.8.17-1.el7.noarch.rpm">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.17/rabbitmq-server-3.8.17-1.el7.noarch.rpm</a></p>
<p>make &amp;&amp; make install<br>rpm -ivh rabbitmq-server-<br>yum install rabbitmq-server-3.8.17-1.el8.noarch.rpm</p>
<p>查看SELinux状态：</p>
<p>1、/usr/sbin/sestatus -v &nbsp; &nbsp; &nbsp;##如果SELinux status参数为enabled即为开启状态</p>
<p>SELinux status: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; enabled</p>
<p>2、getenforce &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ##也可以用这个命令检查</p>
<p>关闭SELinux：</p>
<p>1、临时关闭（不用重启机器）：</p>
<p>setenforce 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;##设置SELinux 成为permissive模式</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ##setenforce 1 设置SELinux 成为enforcing模式</p>
<p>2、修改配置文件需要重启机器：</p>
<p>修改/etc/selinux/config 文件</p>
<p>将SELINUX=enforcing改为SELINUX=disabled</p>
<p>重启机器即可</p>
<p>/etc/yum.repos.d/rabbitmq_rabbitmq-server.repo</p>
<p>/var/lib/rabbitmq</p>
<figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-<span class="number">0</span>-<span class="number">9</span>-centos rabbitmq]<span class="comment"># find / -name rabbitmq-defaults</span></span><br><span class="line"><span class="regexp">/var/</span>lib<span class="regexp">/docker/</span>overlay2<span class="regexp">/05538f7e5407845c520f64a09e8dfa0b851aacd62f1fd02c6301d30b1b124206/</span>diff<span class="regexp">/opt/</span>rabbitmq<span class="regexp">/sbin/</span>rabbitmq-defaults</span><br><span class="line"><span class="regexp">/usr/</span>lib<span class="regexp">/rabbitmq/</span>lib<span class="regexp">/rabbitmq_server-3.8.17/</span>sbin/rabbitmq-defaults</span><br><span class="line"><span class="regexp">/usr/</span>lib<span class="regexp">/rabbitmq/</span>bin/rabbitmq-defaults</span><br></pre></td></tr></tbody></table></figure><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/05/08/rocket-mq/" rel="prev" title="rocket mq">
                  <i class="fa fa-chevron-left"></i> rocket mq
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/05/08/drf-de-api-jie-kou-wen-dang/" rel="next" title="DRF的API接口文档">
                  DRF的API接口文档 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
