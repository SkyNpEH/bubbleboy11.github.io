<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="把查询集归为queryset或者模型类生成实例instance的django模型类数据转换成json&#x2F; xml &#x2F; yaml，再传给前端js进行渲染反序列化，前端post请求的body里面带有json数据，使用django的orm转换成新的模型类数据对象更新或保存到数据库里 django自带序列化功能，但是不完善字段序列化定死的，要想重组的话非常麻烦images保存的是一个相对路径，我们还需要补全">
<meta property="og:type" content="article">
<meta property="og:title" content="序列化">
<meta property="og:url" content="https://bubbleboy11.github.io/2021/05/05/xu-lie-hua/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="把查询集归为queryset或者模型类生成实例instance的django模型类数据转换成json&#x2F; xml &#x2F; yaml，再传给前端js进行渲染反序列化，前端post请求的body里面带有json数据，使用django的orm转换成新的模型类数据对象更新或保存到数据库里 django自带序列化功能，但是不完善字段序列化定死的，要想重组的话非常麻烦images保存的是一个相对路径，我们还需要补全">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-05-04T16:21:41.000Z">
<meta property="article:modified_time" content="2021-06-17T12:27:22.054Z">
<meta property="article:author" content="外心人D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/2021/05/05/xu-lie-hua/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://bubbleboy11.github.io/2021/05/05/xu-lie-hua/","path":"2021/05/05/xu-lie-hua/","title":"序列化"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>序列化 | 外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#drf-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E4%BD%9C%E7%94%A8"><span class="nav-text">drf 的序列化作用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E9%A1%B9%E5%8F%82%E6%95%B0-%E4%BD%9C%E7%94%A8"><span class="nav-text">选项参数|作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Serializer-fields-%E9%80%9A%E7%94%A8%E5%8F%82%E6%95%B0"><span class="nav-text">Serializer fields 通用参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BaseSerializer"><span class="nav-text">BaseSerializer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BASerializer%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-text">视图函数创建Serializer对象的构造方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ModelSerializer"><span class="nav-text">ModelSerializer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="nav-text">实现课程信息数据接口</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%BD%BF%E7%94%A8"><span class="nav-text">序列化使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1%E5%B5%8C%E5%A5%97%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">关联对象嵌套序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PrimaryKeyRelatedField"><span class="nav-text">PrimaryKeyRelatedField</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StringRelatedField"><span class="nav-text">StringRelatedField</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SerializerMethodField"><span class="nav-text">SerializerMethodField</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">339</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2021/05/05/xu-lie-hua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          序列化
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-04 16:21:41" itemprop="dateCreated datePublished" datetime="2021-05-04T16:21:41Z">2021-05-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-17 12:27:22" itemprop="dateModified" datetime="2021-06-17T12:27:22Z">2021-06-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>把查询集归为queryset或者模型类生成实例instance的django模型类数据转换成json/ xml / yaml，再传给前端js进行渲染<br>反序列化，前端post请求的body里面带有json数据，使用django的orm转换成新的模型类数据对象更新或保存到数据库里</p>
<p>django自带序列化功能，但是不完善<br>字段序列化定死的，要想重组的话非常麻烦<br>images保存的是一个相对路径，我们还需要补全路径，而这些drf自动补全完整路径</p>
<p><code>Python Console</code>是针对当前项目环境的console或者<code>python manage.py shell</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> course.models <span class="keyword">import</span> Course  <span class="comment"># 引入课程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一个参数想要序列化后的类型</span></span><br><span class="line"><span class="comment"># 第二个参数是序列化模型类已有的所有字段对象</span></span><br><span class="line">serializers.serialize(<span class="string">'json'</span>, Course.objects.all())</span><br><span class="line"><span class="string">'[{"model": "course.course", "pk": 1, "fields": {"name": "django rest framework快速入门", "introduction": "API接口开发无需费时费力，本课程将从零开始引导同学们快速开发自己的RESTful API接口，从Django项目环境搭建、API接口生成数据、Postman接口测试到DRF认证方式的讲解，通过一个典型的课程信息接口（含增删改查），给同学们讲解完DRF中的序列化（serializers）、视图集（viewsets）、路由（routers）、认证（authentication）、权限（permission），为将来前后端分离项目的开发打下基础。", "teacher": 1, "price": "9.99", "created_at": "2021-05-04T22:35:31.439", "updated_at": "2021-05-04T22:35:31.439"}}]'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 序列号特定字段</span></span><br><span class="line">serializers.serialize(<span class="string">'json'</span>, Course.objects.all(), fields=(<span class="string">"name"</span>))</span><br><span class="line"><span class="string">'[{"model": "course.course", "pk": 1, "fields": {"name": "django rest framework快速入门"}}]'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>teacher</code>不是外键所关联的用户名称而是对应Teacher模型的主键id，<br>当然还可以显示teacher的具体信息，此时需要使用嵌套序列化，如下：</p>
<figure class="highlight pgsql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">### 视图实现商品列表</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line"><span class="keyword">import</span> <span class="type">json</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> <span class="keyword">View</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> goods.models <span class="keyword">import</span> Goods</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> GoodsListView(<span class="keyword">View</span>):</span><br><span class="line">    def <span class="keyword">get</span>(self, request):</span><br><span class="line">        # 获取所有商品</span><br><span class="line">        goods = Goods.objects.<span class="keyword">all</span>()</span><br><span class="line"></span><br><span class="line">        # 通过serializers实现商品列表页</span><br><span class="line">        json_data = serializers.serialize(<span class="string">'json'</span>, goods)</span><br><span class="line"></span><br><span class="line">        # <span class="keyword">In</span> <span class="keyword">order</span> <span class="keyword">to</span> allow non-dict objects <span class="keyword">to</span> be serialized <span class="keyword">set</span> the safe parameter <span class="keyword">to</span> <span class="keyword">False</span>.</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(<span class="type">json</span>.loads(json_data), safe=<span class="keyword">False</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> goods.models <span class="keyword">import</span> Goods</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsListView</span>(<span class="params">View</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># 获取所有商品</span></span><br><span class="line">        goods = Goods.objects.all()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 通过serializers实现商品列表页</span></span><br><span class="line">        json_data = serializers.serialize(<span class="string">'json'</span>, goods)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(json_data, content_type=<span class="string">'application/json'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>如何序列化模型类<br>在各个应用下面建一个<code>serializers.py</code></p>
<h3 id="drf-的序列化作用"><a href="#drf-的序列化作用" class="headerlink" title="drf 的序列化作用"></a>drf 的序列化作用</h3><p>自定义序列化器继承<code>Serializer</code>类或<code>ModelSerializer</code>类，<br>用于将对象处理成字典，</p>
<p>继承<code>Serializer</code>，必须指定<code>queryset</code>对象，<br>如果继承<code>ModelSerializer</code>则不需要指定</p>
<ul>
<li>同时序列化多个对象</li>
<li>序列化包含多条数据的查询集加上<code>many=True</code></li>
<li>序列化的过程添加上下文</li>
<li>无限的数据异常处理</li>
</ul>
<p>关系字段的外键字段序列化可以指定遍历的序列化深度<code>depth</code>，如果表结构有子表关联到父表，父表又关联到另外的父表，可以设置深度</p>
<p>serializer不是只能为数据库模型类定义，也可以为非数据库模型类的数据定义。serializer是独立于数据库之外的存在。</p>
<p>字段|字段构造方式<br>BooleanField()<br><code>CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)</code></p>
<h4 id="选项参数-作用"><a href="#选项参数-作用" class="headerlink" title="选项参数|作用"></a>选项参数|作用</h4><p><code>max_length</code> |最大长度<br><code>min_lenght</code> 最小长度<br><code>allow_blank</code>是否允许为空<br><code>trim_whitespace</code>是否截断空白字符<br><code>max_value</code> 最小值<br><code>min_value</code> 最大值</p>
<h4 id="Serializer-fields-通用参数"><a href="#Serializer-fields-通用参数" class="headerlink" title="Serializer fields 通用参数"></a>Serializer fields 通用参数</h4><p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/fields/#core-arguments">https://www.django-rest-framework.org/api-guide/fields/#core-arguments</a></p>
<ul>
<li><code>read_only</code> fields are included in the API output, but should not be included in the input during create or update operations.<br>包含在API输出中，但在创建或更新操作期间不应包含在输入中，<br>Any <code>read_only</code> fields that are incorrectly included in the serializer input will be ignored.</li>
</ul>
<p>Set this to <code>True</code> to ensure that the field is used when serializing a representation, but is not used when creating or updating an instance during deserialization. 设置为<code>True</code>以确保序列化输出表示形式时使用该字段，而在反序列化期间创建或更新实例时不使用该字段。只返回而不提交</p>
<p>Defaults to <code>False</code>默认False</p>
<ul>
<li><code>write_only</code><br>Set this to <code>True</code> to ensure that the field may be used when updating or creating an instance, but is not included when serializing the representation. 以确保在更新或创建实例（反序列化输入）时可以使用该字段，但在序列化表示时不包括该字段<br>Defaults to <code>False</code> 默认False</li>
</ul>
<p><code>required</code><br>Normally an error will be raised if a field is not supplied during deserialization. Set to false if this field is not required to be present during deserialization.</p>
<p>Setting this to <code>False</code> also allows the object attribute or dictionary key to be omitted from output when serializing the instance. If the key is not present it will simply not be included in the output representation.<br>表明该字段在反序列化时必须输入<br>Defaults to <code>True</code>.默认True</p>
<p><code>default</code> 反序列化时使用的默认值<br><code>allow_null</code> 该字段是否允许传入None，默认False</p>
<p><code>validators</code>该字段选项使用的验证，自定义方法验证</p>
<p>We now use single-step object creation, like so:</p>
<ol>
<li>Validating the data makes the cleaned data available as <code>serializer.validated_data</code>.</li>
<li>Calling <code>serializer.save()</code> then saves and returns the new object instance.</li>
</ol>
<p><code>error_messages</code> 包含错误编号与错误信息的字典<br><code>label</code> 用于HTML展示API页面时，显示的字段名称<br><code>help_text</code> 用于HTML展示API页面时，显示的字段帮助提示信息</p>
<h3 id="BaseSerializer"><a href="#BaseSerializer" class="headerlink" title="BaseSerializer"></a>BaseSerializer</h3><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseSerializer</span>(<span class="params">Field</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    The BaseSerializer class provides a minimal class which may be used</span></span><br><span class="line"><span class="string">    for writing custom serializer implementations.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Note that we strongly restrict the ordering of operations/properties</span></span><br><span class="line"><span class="string">    that may be used on the serializer in order to enforce correct usage.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    In particular, if a `data=` argument is passed then:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .is_valid() - Available.</span></span><br><span class="line"><span class="string">    .initial_data - Available.</span></span><br><span class="line"><span class="string">    .validated_data - Only available after calling `is_valid()`</span></span><br><span class="line"><span class="string">    .errors - Only available after calling `is_valid()`</span></span><br><span class="line"><span class="string">    .data - Only available after calling `is_valid()`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If a `data=` argument is not passed then:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .is_valid() - Not available.</span></span><br><span class="line"><span class="string">    .initial_data - Not available.</span></span><br><span class="line"><span class="string">    .validated_data - Not available.</span></span><br><span class="line"><span class="string">    .errors - Not available.</span></span><br><span class="line"><span class="string">    .data - Available.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, instance=None, data=empty, **kwargs</span>):</span></span><br><span class="line">        self.instance = instance</span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">            self.initial_data = data</span><br><span class="line">        self.partial = kwargs.pop(<span class="string">'partial'</span>, <span class="literal">False</span>)</span><br><span class="line">        self._context = kwargs.pop(<span class="string">'context'</span>, {})</span><br><span class="line">        kwargs.pop(<span class="string">'many'</span>, <span class="literal">None</span>)</span><br><span class="line">        super().__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># We override this method in order to automatically create</span></span><br><span class="line">        <span class="comment"># `ListSerializer` classes instead when `many=True` is set.</span></span><br><span class="line">        <span class="keyword">if</span> kwargs.pop(<span class="string">'many'</span>, <span class="literal">False</span>):</span><br><span class="line">            <span class="keyword">return</span> cls.many_init(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> super().__new__(cls, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Allow type checkers to make serializers generic.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__class_getitem__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">many_init</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        This method implements the creation of a `ListSerializer` parent</span></span><br><span class="line"><span class="string">        class when `many=True` is used. You can customize it if you need to</span></span><br><span class="line"><span class="string">        control which keyword arguments are passed to the parent, and</span></span><br><span class="line"><span class="string">        which are passed to the child.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Note that we're over-cautious in passing most arguments to both parent</span></span><br><span class="line"><span class="string">        and child classes in order to try to cover the general case. If you're</span></span><br><span class="line"><span class="string">        overriding this method you'll probably want something much simpler, eg:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @classmethod</span></span><br><span class="line"><span class="string">        def many_init(cls, *args, **kwargs):</span></span><br><span class="line"><span class="string">            kwargs['child'] = cls()</span></span><br><span class="line"><span class="string">            return CustomListSerializer(*args, **kwargs)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        allow_empty = kwargs.pop(<span class="string">'allow_empty'</span>, <span class="literal">None</span>)</span><br><span class="line">        child_serializer = cls(*args, **kwargs)</span><br><span class="line">        list_kwargs = {</span><br><span class="line">            <span class="string">'child'</span>: child_serializer,</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> allow_empty <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            list_kwargs[<span class="string">'allow_empty'</span>] = allow_empty</span><br><span class="line">        list_kwargs.update({</span><br><span class="line">            key: value <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items()</span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> LIST_SERIALIZER_KWARGS</span><br><span class="line">        })</span><br><span class="line">        meta = getattr(cls, <span class="string">'Meta'</span>, <span class="literal">None</span>)</span><br><span class="line">        list_serializer_class = getattr(meta, <span class="string">'list_serializer_class'</span>, ListSerializer)</span><br><span class="line">        <span class="keyword">return</span> list_serializer_class(*args, **list_kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_internal_value</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">'`to_internal_value()` must be implemented.'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_representation</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">'`to_representation()` must be implemented.'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, instance, validated_data</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">'`update()` must be implemented.'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self, validated_data</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">'`create()` must be implemented.'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> hasattr(self, <span class="string">'_errors'</span>), (</span><br><span class="line">            <span class="string">'You must call `.is_valid()` before calling `.save()`.'</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> self.errors, (</span><br><span class="line">            <span class="string">'You cannot call `.save()` on a serializer with invalid data.'</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Guard against incorrect use of `serializer.save(commit=False)`</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="string">'commit'</span> <span class="keyword">not</span> <span class="keyword">in</span> kwargs, (</span><br><span class="line">            <span class="string">"'commit' is not a valid keyword argument to the 'save()' method. "</span></span><br><span class="line">            <span class="string">"If you need to access data before committing to the database then "</span></span><br><span class="line">            <span class="string">"inspect 'serializer.validated_data' instead. "</span></span><br><span class="line">            <span class="string">"You can also pass additional keyword arguments to 'save()' if you "</span></span><br><span class="line">            <span class="string">"need to set extra attributes on the saved model instance. "</span></span><br><span class="line">            <span class="string">"For example: 'serializer.save(owner=request.user)'.'"</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_data'</span>), (</span><br><span class="line">            <span class="string">"You cannot call `.save()` after accessing `serializer.data`."</span></span><br><span class="line">            <span class="string">"If you need to access data before committing to the database then "</span></span><br><span class="line">            <span class="string">"inspect 'serializer.validated_data' instead. "</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        validated_data = {**self.validated_data, **kwargs}</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># instance不为空修改</span></span><br><span class="line">            self.instance = self.update(self.instance, validated_data)</span><br><span class="line">            <span class="keyword">assert</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">                <span class="string">'`update()` did not return an object instance.'</span></span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># instance为空创建</span></span><br><span class="line">            self.instance = self.create(validated_data)</span><br><span class="line">            <span class="keyword">assert</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">                <span class="string">'`create()` did not return an object instance.'</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.instance</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_valid</span>(<span class="params">self, raise_exception=False</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> hasattr(self, <span class="string">'initial_data'</span>), (</span><br><span class="line">            <span class="string">'Cannot call `.is_valid()` as no `data=` keyword argument was '</span></span><br><span class="line">            <span class="string">'passed when instantiating the serializer instance.'</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_validated_data'</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self._validated_data = self.run_validation(self.initial_data)</span><br><span class="line">            <span class="keyword">except</span> ValidationError <span class="keyword">as</span> exc:</span><br><span class="line">                self._validated_data = {}</span><br><span class="line">                self._errors = exc.detail</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._errors = {}</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self._errors <span class="keyword">and</span> raise_exception:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(self.errors)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> bool(self._errors)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'initial_data'</span>) <span class="keyword">and</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_validated_data'</span>):</span><br><span class="line">            msg = (</span><br><span class="line">                <span class="string">'When a serializer is passed a `data` keyword argument you '</span></span><br><span class="line">                <span class="string">'must call `.is_valid()` before attempting to access the '</span></span><br><span class="line">                <span class="string">'serialized `.data` representation.\n'</span></span><br><span class="line">                <span class="string">'You should either call `.is_valid()` first, '</span></span><br><span class="line">                <span class="string">'or access `.initial_data` instead.'</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(msg)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_data'</span>):</span><br><span class="line">            <span class="keyword">if</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> getattr(self, <span class="string">'_errors'</span>, <span class="literal">None</span>):</span><br><span class="line">                self._data = self.to_representation(self.instance)</span><br><span class="line">            <span class="keyword">elif</span> hasattr(self, <span class="string">'_validated_data'</span>) <span class="keyword">and</span> <span class="keyword">not</span> getattr(self, <span class="string">'_errors'</span>, <span class="literal">None</span>):</span><br><span class="line">                self._data = self.to_representation(self.validated_data)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._data = self.get_initial()</span><br><span class="line">        <span class="keyword">return</span> self._data</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">errors</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_errors'</span>):</span><br><span class="line">            msg = <span class="string">'You must call `.is_valid()` before accessing `.errors`.'</span></span><br><span class="line">            <span class="keyword">raise</span> AssertionError(msg)</span><br><span class="line">        <span class="keyword">return</span> self._errors</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validated_data</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_validated_data'</span>):</span><br><span class="line">            msg = <span class="string">'You must call `.is_valid()` before accessing `.validated_data`.'</span></span><br><span class="line">            <span class="keyword">raise</span> AssertionError(msg)</span><br><span class="line">        <span class="keyword">return</span> self._validated_data</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><code>BaseSerializer</code> class that can be used to easily support alternative serialization and deserialization styles.</p>
<p>This class implements the same basic API as the <code>Serializer</code> class:</p>
<ul>
<li><code>.data</code> - Returns the outgoing primitive representation.返回传出的原始表示法 序列化对象返回的dict类型<br>把传递过来的数据对象当中所对应的字段提取出来构建成字段形式<br>源码</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Serializer</span>(<span class="params">BaseSerializer, metaclass=SerializerMetaclass</span>):</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data</span>(<span class="params">self</span>):</span></span><br><span class="line">        ret = super().data</span><br><span class="line">        <span class="keyword">return</span> ReturnDict(ret, serializer=self)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>.is_valid()</code> - Deserializes and validates incoming data. 会调用如果存在的验证器或自定义验证函数<code>def validate</code></li>
</ul>
<p>Using <code>.is_valid(raise_exception=True)</code><br>The <code>.is_valid()</code> method now takes an optional boolean flag, <code>raise_exception</code>.</p>
<p>Calling <code>.is_valid(raise_exception=True)</code> will cause a <code>ValidationError</code> to be raised if the serializer data contains validation errors. This error will be handled by REST framework’s default exception handler, allowing you to remove error response handling from your view code.</p>
<p>The handling and formatting of error responses may be altered globally by using the <code>EXCEPTION_HANDLER</code> settings key.</p>
<p>This change also means it’s now possible to alter the style of error responses used by the built-in generic views, without having to include mixin classes or other overrides.</p>
<ul>
<li><code>.validated_data</code> - Returns the validated incoming data.反序列化对象返回的dict类型</li>
</ul>
<p>Use <code>.validated_data</code> instead of <code>.object</code>.<br>You must now use the <code>.validated_data</code> attribute if you need to inspect the data before saving, rather than using the <code>.object attribute</code>, which no longer exists.</p>
<p>For example the following code is no longer valid:</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">    name = serializer.object.name  <span class="comment"># Inspect validated field data.</span></span><br><span class="line">    logging.info(<span class="string">'Creating ticket "%s"'</span> % name)</span><br><span class="line">    serializer.object.user = request.user  <span class="comment"># Include the user when saving.</span></span><br><span class="line">    serializer.save()</span><br></pre></td></tr></tbody></table></figure>

<p>Instead of using <code>.object</code> to inspect a partially constructed instance,<br>you would now use <code>.validated_data</code> to inspect the cleaned incoming values.<br>Also you can’t set extra attributes on the instance directly,<br>but instead pass them to the <code>.save()</code> method as keyword arguments.</p>
<p>The corresponding code would now look like this:</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">    name = serializer.validated_data[<span class="string">'name'</span>]  <span class="comment"># Inspect validated field data.</span></span><br><span class="line">    logging.info(<span class="string">'Creating ticket "%s"'</span> % name)</span><br><span class="line">    serializer.save(user=request.user)  <span class="comment"># Include the user when saving.</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>.errors</code> - Returns any errors during validation.</li>
<li><code>.save()</code> - Persists the validated data into an object instance.</li>
</ul>
<h4 id="视图函数创建Serializer对象的构造方法"><a href="#视图函数创建Serializer对象的构造方法" class="headerlink" title="视图函数创建Serializer对象的构造方法"></a>视图函数创建Serializer对象的构造方法</h4><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CourseSerializer(instance=course, data=request.data)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>用于序列化时，将模型类对象传入<code>instance</code>，要序列化的查询集实例，要序列化的 <code>course</code> 是查询出来的实例，<br>把<code>data</code>的数据序列化后保存或跟新到 <code>course</code> 这个对象里面，通过<code>data</code>属性可以获取序列化后的数据</li>
<li>用于反序列化时，将要被反序列化的数据传入<code>data</code>， POST BODY来的数据，<code>request.data</code> 是前端传递过来的数据</li>
<li>还可通过context参数额外添加数据，可以通过Serializer对象的context属性获取。</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serializer = AccountSerializer(account, context={<span class="string">'request'</span>: request})</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ModelSerializer"><a href="#ModelSerializer" class="headerlink" title="ModelSerializer"></a><code>ModelSerializer</code></h3><p>相比于 <code>Serializer</code>，提供了：</p>
<ul>
<li>它省去了模型所有字段的添加和处理数据方法的实现</li>
<li>基于模型类自动生成模型中相应字段的映射</li>
<li>基于模型类自动为Serializer添加validators</li>
<li>包含默认的<code>create()</code>和<code>update()</code>的实现</li>
</ul>
<p>可以将字段转换成json，</p>
<p>写法和form表单类的建一个<code>form.py</code>类似，<code>modelform</code> 可以将字段转成html。<br><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/community/3.0-announcement/#differences-between-modelserializer-validation-and-modelform">https://www.django-rest-framework.org/community/3.0-announcement/#differences-between-modelserializer-validation-and-modelform</a></p>
<h4 id="实现课程信息数据接口"><a href="#实现课程信息数据接口" class="headerlink" title="实现课程信息数据接口"></a>实现课程信息数据接口</h4><p><code>course/serializers.py</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Course</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># form类这里用不到，只是对比类似的样子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseForm</span>(<span class="params">forms.ModelForm</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Course</span><br><span class="line">        fields = (<span class="string">'name'</span>, <span class="string">'introduction'</span>, <span class="string">'teacher'</span>, <span class="string">'price'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = User  <span class="comment"># 指定序列化生成字段的用户模型类</span></span><br><span class="line">        fields = <span class="string">'__all__'</span>  <span class="comment"># 指定序列化所有字段</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="comment"># teacher是外键关联到用户表，并不是新建过程中新建的一个用户，</span></span><br><span class="line">    <span class="comment"># 法一：详细显示外键老师信息，想得到对应的名字，可以把用户的名称序列化，和使用ORM查询外键关联查询一样，</span></span><br><span class="line">    teacher = serializers.ReadOnlyField(source=<span class="string">'teacher.username'</span>)  <span class="comment"># 序列化模型类中指定字段，外键字段，指定只读字段</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Course  <span class="comment"># 要序列化的模型课程类</span></span><br><span class="line">        <span class="comment"># exclude = ('id', )  # 排除字段</span></span><br><span class="line">        <span class="comment"># fields = ('id', 'name', 'introduction', 'teacher', 'price', 'created_at', 'updated_at')</span></span><br><span class="line">        fields = <span class="string">'__all__'</span>  <span class="comment"># 要序列化的模型字段，模型类所有字段</span></span><br><span class="line">        depth = <span class="number">2</span>  <span class="comment"># 深度</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面的代码直接继承了<code>ModelSerializer</code>，<br>通过<code>Meta</code>类的<code>model</code>属性指定要序列化的模型以及<code>fields</code>属性指定需要序列化的模型字段，</p>
<p>在视图函数中使用该类来实现对<code>Course</code>模型的序列化。</p>
<p>法二</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TeacherSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Teacher  <span class="comment"># 序列化用户模型类</span></span><br><span class="line">        fields = <span class="string">'__all__'</span> <span class="comment"># 要序列化的模型字段，模型类所有字段</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    teacher = TeacherSerializer()  <span class="comment"># 详细显示一对一外键老师信息，Serialzer还可以嵌套使用，覆盖外键字段</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Course  <span class="comment"># 要序列化的模型课程类</span></span><br><span class="line">        <span class="comment"># exclude = ('id', )  # 排除指定字段</span></span><br><span class="line">        <span class="comment"># fields = ('id', 'name', 'introduction', 'teacher', 'price', 'created_at', 'updated_at')</span></span><br><span class="line">        fields = <span class="string">'__all__'</span>  <span class="comment"># 要序列化的模型字段，模型类所有字段</span></span><br><span class="line">        depth = <span class="number">2</span>  <span class="comment"># 深度</span></span><br><span class="line">        extra_kwargs = {  <span class="comment"># 添加修改字段选项参数</span></span><br><span class="line">            <span class="string">'name'</span>: {<span class="string">'write_only|read_only'</span>: <span class="literal">True</span>}</span><br><span class="line">            }</span><br><span class="line">        read_only_fields = (<span class="string">'name'</span>,)  <span class="comment"># 只读字段，即仅用于序列化输出的字段</span></span><br></pre></td></tr></tbody></table></figure>

<p>在python manage.py shell中查看自动生成的BookInfoSerializer的具体</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> .serializers <span class="keyword">import</span> TeacherSerializer</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>serializer = TeacherSerializer()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>serializer</span><br><span class="line">TeacherSerializer():</span><br><span class="line">    id = IntegerField(label=<span class="string">'ID'</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    btitle = CharField(label=<span class="string">'名称'</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = DateField(allow_null=<span class="literal">True</span>, label=<span class="string">'发布日期'</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bread = IntegerField(label=<span class="string">'阅读量'</span>, max_value=<span class="number">2147483647</span>, min_value=<span class="number">-2147483648</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = IntegerField(label=<span class="string">'评论量'</span>, max_value=<span class="number">2147483647</span>, min_value=<span class="number">-2147483648</span>, required=<span class="literal">False</span>)</span><br><span class="line">    image = ImageField(allow_null=<span class="literal">True</span>, label=<span class="string">'图片'</span>, max_length=<span class="number">100</span>, required=<span class="literal">False</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>实现序列化结果带绝对和相对URL超链接的<code>HyperlinkedModelSerializer</code>的api，在<code>fields</code> 加上 <code>url</code>，不用用于FBV</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Course</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseSerializer</span>(<span class="params">serializers.HyperlinkedModelSerializer</span>):</span></span><br><span class="line">    teacher = serializers.ReadOnlyField(source=<span class="string">'teacher.username'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Course  <span class="comment"># 要序列化的模型课程类</span></span><br><span class="line">        <span class="comment"># url是默认值，可在settings.py中设置URL_FIELD_NAME使全局生效</span></span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'url'</span>, <span class="string">'name'</span>, <span class="string">'introduction'</span>, <span class="string">'teacher'</span>, <span class="string">'price'</span>, <span class="string">'created_at'</span>, <span class="string">'updated_at'</span>)  <span class="comment"># 要序列化的模型字段</span></span><br><span class="line">        exclude = (<span class="string">'subject'</span>, )</span><br></pre></td></tr></tbody></table></figure>

<p>上面的代码直接继承了<code>HyperlinkedModelSerializer</code>，<br>通过<code>Meta</code>类的<code>model</code>属性指定要序列化的模型以及<code>fields</code>属性指定需要序列化的模型字段，<br>稍后我们就可以在视图函数中使用该类来实现对<code>Course</code>模型的序列化。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api_view(('GET', ))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_teachers</span>(<span class="params">request: HttpRequest</span>) -&gt; HttpResponse:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sno = int(request.GET.get(<span class="string">'sno'</span>))</span><br><span class="line">        subject = Subject.objects.only(<span class="string">'name'</span>).get(no=sno)</span><br><span class="line">        teachers = Teacher.objects.filter(subject=subject).defer(<span class="string">'subject'</span>).order_by(<span class="string">'no'</span>)</span><br><span class="line">        subject_seri = SubjectSimpleSerializer(subject)</span><br><span class="line">        teacher_seri = TeacherSerializer(teachers, many=<span class="literal">True</span>)  <span class="comment"># 一对多</span></span><br><span class="line">        <span class="keyword">return</span> Response({<span class="string">'subject'</span>: subject_seri.data, <span class="string">'teachers'</span>: teacher_seri.data})</span><br><span class="line">    <span class="keyword">except</span> (TypeError, ValueError, Subject.DoesNotExist):</span><br><span class="line">        <span class="keyword">return</span> Response(status=<span class="number">404</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="序列化使用"><a href="#序列化使用" class="headerlink" title="序列化使用"></a>序列化使用</h3><p>1 基本使用</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py shell</span><br></pre></td></tr></tbody></table></figure>

<p>1） 先查询出<strong>一个</strong>图书对象</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> booktest.models <span class="keyword">import</span> BookInfo</span><br><span class="line">book = BookInfo.objects.get(id=<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>2） 构造序列化器对象</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> booktest.serializers <span class="keyword">import</span> BookInfoSerializer</span><br><span class="line">serializer = BookInfoSerializer(book)</span><br></pre></td></tr></tbody></table></figure>

<p>3）获取序列化数据<br>通过<code>.data</code>属性可以获取序列化后的数据</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serializer.data</span><br><span class="line"><span class="comment"># {'id': 2, 'btitle': '天龙八部', 'bpub_date': '1986-07-24', 'bread': 36, 'bcomment': 40, 'image': None}</span></span><br></pre></td></tr></tbody></table></figure>

<p>4）如果要被序列化的是包含<strong>多条</strong>数据的查询集QuerySet，可以通过添加<code>many=True</code>参数补充说明</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">book_qs = BookInfo.objects.all()</span><br><span class="line">serializer = BookInfoSerializer(book_qs, many=<span class="literal">True</span>)</span><br><span class="line">serializer.data</span><br><span class="line"><span class="comment"># [OrderedDict([('id', 2), ('btitle', '天龙八部'), ('bpub_date', '1986-07-24'), ('bread', 36), ('bcomment', 40), ('image', N]), OrderedDict([('id', 3), ('btitle', '笑傲江湖'), ('bpub_date', '1995-12-24'), ('bread', 20), ('bcomment', 80), ('image'ne)]), OrderedDict([('id', 4), ('btitle', '雪山飞狐'), ('bpub_date', '1987-11-11'), ('bread', 58), ('bcomment', 24), ('ima None)]), OrderedDict([('id', 5), ('btitle', '西游记'), ('bpub_date', '1988-01-01'), ('bread', 10), ('bcomment', 10), ('im', 'booktest/xiyouji.png')])]</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="关联对象嵌套序列化"><a href="#关联对象嵌套序列化" class="headerlink" title="关联对象嵌套序列化"></a>关联对象嵌套序列化</h3><p>返回当前类数据和关联模型类的数据</p>
<p>如果需要序列化的数据中包含有其他关联对象，则对关联对象数据的序列化需要指明。</p>
<p><a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/relations/#primarykeyrelatedfield">https://www.django-rest-framework.org/api-guide/relations/#primarykeyrelatedfield</a></p>
<h4 id="PrimaryKeyRelatedField"><a href="#PrimaryKeyRelatedField" class="headerlink" title="PrimaryKeyRelatedField"></a><code>PrimaryKeyRelatedField</code></h4><p>may be used to represent the target of the relationship using its primary key. 此字段将被序列化为关联对象的主键，<br>By default this field is read-write, although you can change this behavior using the <code>read_only</code> flag.默认可以读写</p>
<p>Arguments:</p>
<ul>
<li><p><code>queryset</code> - The queryset used for model instance lookups when validating the field input.在验证字段输入（反序列化）时用于模型实例查找的<code>queryset</code>。<br>Relationships must either set a queryset explicitly, or set <code>read_only=True</code>.关系必须显式设置<code>queryset</code>，或者设置<code>read_only=True</code>。</p>
</li>
<li><p><code>many</code> - If applied to a to-many relationship, you should set this argument to <code>True</code>.如果应用于多?对多关系，则应将此参数设置为<code>True</code></p>
</li>
<li><p><code>allow_null</code> - If set to <code>True</code>, the field will accept values of <code>None</code> or the empty string for nullable relationships. Defaults to <code>False</code>.<br>如果设置为<code>True</code>，该字段将接受<code>None</code>值或空字符串，用于可空关系。默认值为<code>False</code>。</p>
</li>
<li><p><code>pk_field</code> - Set to a field to control serialization/deserialization of the primary key’s value.设置为一个字段来控制主键值的序列化/反序列化。<br>For example, <code>pk_field=UUIDField(format='hex')</code> would serialize a UUID primary key into its compact hex representation.<br>例如，<code>pk_field=UUIDField(format='hex')</code>将把UUID主键序列化为紧凑的十六进制表示形式。</p>
</li>
</ul>
<p><code>heroinfo_set = serializers.PrimaryKeyRelatedField(read_only=True, many=True)</code></p>
<p>For example, the following serializer:</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlbumSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="comment"># 每个Album对象关联的多个歌曲tracks对象</span></span><br><span class="line">    tracks = serializers.PrimaryKeyRelatedField(many=<span class="literal">True</span>, read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Album</span><br><span class="line">        fields = [<span class="string">'album_name'</span>, <span class="string">'artist'</span>, <span class="string">'tracks'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>Would serialize to a representation like this:</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// serializer = HeroInfoSerializer(hero)</span></span><br><span class="line"><span class="comment">// serializer.data</span></span><br><span class="line">{</span><br><span class="line">    'album_name': 'Undun',</span><br><span class="line">    'artist': 'The Roots',</span><br><span class="line">    'tracks': [  // 每个Album对象关联的多个歌曲tracks对象</span><br><span class="line">        89,</span><br><span class="line">        90,</span><br><span class="line">        91,</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多类</span></span><br><span class="line">hbook = serializers.PrimaryKeyRelatedField(label=<span class="string">'图书'</span>, read_only=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">hbook = serializers.PrimaryKeyRelatedField(label=<span class="string">'图书'</span>, queryset=BookInfo.objects.all())</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一类</span></span><br><span class="line">heroinfo_set = serializers.PrimaryKeyRelatedField(label=<span class="string">'图书'</span>,read_only=<span class="literal">True</span>, many= <span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="StringRelatedField"><a href="#StringRelatedField" class="headerlink" title="StringRelatedField"></a><code>StringRelatedField</code></h4><p>may be used to represent the target of the relationship using its <code>__str__</code> method.<br>此字段将被序列化为关联对象的字符串表示方式，关联对象模型类的<code>__str__</code>方法值<br>his field is read only.</p>
<p>Arguments:</p>
<ul>
<li><code>many</code> - If applied to a to-many relationship, you should set this argument to True.</li>
</ul>
<p><code>heroinfo_set = serializers.StringRelatedField(read_only=True, many=True)</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多类</span></span><br><span class="line"> hbook = serializers.StringRelatedField(label=<span class="string">'图书'</span>)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一类</span></span><br><span class="line"> heroinfo_set = serializers.StringRelatedField(label=<span class="string">'图书'</span>,read_only=<span class="literal">True</span>, many=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>在当前的序列化类指定实例化其关联对象序列化器类<br><code>heroinfo_set = HeroInfoSerialzier(many=True)</code></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多类</span></span><br><span class="line">hbook = BookInfoSerializer()</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一类</span></span><br><span class="line">heroinfo_set = HeroInfoSerializer(label=<span class="string">'图书'</span>, many=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>使用效果</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> booktest.serializers <span class="keyword">import</span> HeroInfoSerializer</span><br><span class="line"><span class="keyword">from</span> booktest.models <span class="keyword">import</span> HeroInfo</span><br><span class="line">hero = HeroInfo.objects.get(id=<span class="number">6</span>)</span><br><span class="line">serializer = HeroInfoSerializer(hero)</span><br><span class="line">serializer.data</span><br><span class="line"><span class="comment"># {'id': 6, 'hname': '乔峰', 'hgender': 1, 'hcomment': '降龙十八掌', 'hbook': 2}</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsImageSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="string">'''商品图片'''</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = GoodsImage</span><br><span class="line">        fields = [<span class="string">'image'</span>, ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line">    <span class="string">'''商品详情序列化'''</span></span><br><span class="line">    <span class="comment"># 关联对象嵌套序列化，返回当前类数据和关联模型类的数据</span></span><br><span class="line">    category = CategorySerializer()  <span class="comment"># 一对一</span></span><br><span class="line">    <span class="comment"># images是数据库中设置的related_name="images"，把商品图嵌套进来</span></span><br><span class="line">    images = GoodsImageSerializer(many=<span class="literal">True</span>)  <span class="comment"># 一对多</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Goods</span><br><span class="line">        fields = <span class="string">'__all__'</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="SerializerMethodField"><a href="#SerializerMethodField" class="headerlink" title="SerializerMethodField"></a><code>SerializerMethodField</code></h4><p>This is a read-only field. It gets its value by calling a method on the serializer class it is attached to. It can be used to add any sort of data to the serialized representation of your object.<br>这是一个只读字段。它通过在附加的序列化器类上调用一个方法来获取其值。它可以用于将任何类型的数据添加到对象的序列化表示中。<br>Signature: <code>SerializerMethodField(method_name=None)</code></p>
<ul>
<li><code>method_name</code> - The name of the method on the serializer to be called. If not included this defaults to <code>get_&lt;field_name&gt;</code>.<br>是要调用的序列化程序上的方法的名称，如果未包括，则默认为<code>get_&lt;field_name&gt;</code>。</li>
</ul>
<p>The serializer method referred to by the <code>method_name</code> argument should accept a single argument (in addition to <code>self</code>), which is the object being serialized. It should return whatever you want to be included in the serialized representation of the object. For example:<br><code>method_name</code>参数所对应的序列化器方法应接受单个参数（除了<code>self</code>之外），<br>该参数是要被序列化的对象，它应该返回想要包含在对象序列化表示中的任何内容。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/05/05/zhuang-shi-qi/" rel="prev" title="python装饰器Decorator和java注解annotation">
                  <i class="fa fa-chevron-left"></i> python装饰器Decorator和java注解annotation
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/05/06/python-zhi-fu-bao/" rel="next" title="python支付宝">
                  python支付宝 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
