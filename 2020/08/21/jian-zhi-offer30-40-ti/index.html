<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="32.最小的K个数 [^本题考点 时间效率]​输入n个整数，找出其中最小的K个数。例如输入4,5,1,6,2,7,3,8这8个数字，则最小的4个数字是1,2,3,4,。示例1： 12输入：arr &#x3D; [3,2,1], k &#x3D; 2输出：[1,2] 或者 [2,1] 示例2 12输入：arr &#x3D; [0,1,2,1], k &#x3D; 1输出：[0]  方法：快排思想思路和算法快排的划分函数 partition">
<meta property="og:type" content="article">
<meta property="og:title" content="剑指offer30~40题">
<meta property="og:url" content="https://bubbleboy11.github.io/2020/08/21/jian-zhi-offer30-40-ti/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="32.最小的K个数 [^本题考点 时间效率]​输入n个整数，找出其中最小的K个数。例如输入4,5,1,6,2,7,3,8这8个数字，则最小的4个数字是1,2,3,4,。示例1： 12输入：arr &#x3D; [3,2,1], k &#x3D; 2输出：[1,2] 或者 [2,1] 示例2 12输入：arr &#x3D; [0,1,2,1], k &#x3D; 1输出：[0]  方法：快排思想思路和算法快排的划分函数 partition">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-08-20T16:21:41.000Z">
<meta property="article:modified_time" content="2021-04-02T12:24:46.314Z">
<meta property="article:author" content="外心人D">
<meta property="article:tag" content="Leetcode">
<meta property="article:tag" content="剑指offer">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/2020/08/21/jian-zhi-offer30-40-ti/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://bubbleboy11.github.io/2020/08/21/jian-zhi-offer30-40-ti/","path":"2020/08/21/jian-zhi-offer30-40-ti/","title":"剑指offer30~40题"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>剑指offer30~40题 | 外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#32-%E6%9C%80%E5%B0%8F%E7%9A%84K%E4%B8%AA%E6%95%B0-%E6%9C%AC%E9%A2%98%E8%80%83%E7%82%B9-%E6%97%B6%E9%97%B4%E6%95%88%E7%8E%87"><span class="nav-text">32.最小的K个数 [^本题考点 时间效率]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#215-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E7%AC%ACK%E4%B8%AA%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0"><span class="nav-text">215. 数组中的第K个最大元素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#33-%E6%95%B0%E6%8D%AE%E6%B5%81%E4%B8%AD%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0-%E6%9C%AC%E9%A2%98%E8%80%83%E7%82%B9-%E6%A0%91"><span class="nav-text">33.数据流中的中位数 [^本题考点 树]</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">344</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/jian-zhi-offer30-40-ti/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          剑指offer30~40题
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-02 12:24:46" itemprop="dateModified" datetime="2021-04-02T12:24:46Z">2021-04-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h4 id="32-最小的K个数-本题考点-时间效率"><a href="#32-最小的K个数-本题考点-时间效率" class="headerlink" title="32.最小的K个数 [^本题考点 时间效率]"></a>32.最小的K个数 [^本题考点 <em>时间效率</em>]</h4><p>​<strong>输入n个整数，找出其中最小的K个数。例如输入4,5,1,6,2,7,3,8这8个数字，则最小的4个数字是1,2,3,4,。</strong><br>示例1：</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：arr = [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>], k = <span class="number">2</span></span><br><span class="line">输出：[<span class="number">1</span>,<span class="number">2</span>] 或者 [<span class="number">2</span>,<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>示例2</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：arr = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>], k = <span class="number">1</span></span><br><span class="line">输出：[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>方法：快排思想<br>思路和算法<br>快排的划分函数 partition 每次执行完后都能将数组分成两个部分，<br>小于等于分界值 pivot 的元素的都会被放到数组的左边，<br>大于的都会被放到数组的右边，<br>然后返回分界值的下标。<br>与快速排序不同的是，快速排序会根据分界值的下标递归处理划分的两侧，<br>而这里我们只处理划分的一边，不需要完全排完序再处理。</p>
<p>我们定义函数 randomized_selected(arr, l, r, k)<br>表示划分数组 arr 的 [l, r] 部分，使前 k 小的数在数组的左侧，<br>在函数里我们调用快排的划分函数，<br>假设划分函数返回的下标是 pos（表示分界值 pivot 最终在数组中的位置），<br>pviot 左子序列(包括pivot)长度<br>即 pivot 是数组中第 pos - l + 1 小的数，那么一共会有三种情况：</p>
<ul>
<li><p>如果 pos - l + 1 == k，表示 pivot 就是第 k 小的数，<br>则左边的pos个值均为序列中k小的值，后面的值大于 pivot，直接返回即可； </p>
</li>
<li><p>如果 pos - l + 1 &lt; k，表示第 k 小的数在 pivot 的右侧，<br>左边的pos个值为序列中k小的值的一部分，还有 k - pos 个值在右边。<br>因此递归调用 randomized_selected(arr, pos + 1, r, k - (pos - l + 1))；</p>
</li>
<li><p>如果 pos - l + 1 &gt; k，表示第 k 小的数在 pivot 的左侧，<br>左边的k个值为序列中pos小的值的一部分。<br>递归调用 randomized_selected(arr, l, pos - 1, k)。</p>
</li>
</ul>
<p>函数递归入口为 randomized_selected(arr, 0, arr.length - 1, k)<br>在函数返回后，将前 k 个数放入答案数组返回即可。</p>
<p>时间复杂度：期望为 O(n) ，由于证明过程很繁琐，所以不再这里展开讲。<br>具体证明可以参考《算法导论》第 9 章第 2 小节。<br>最坏情况下的时间复杂度为 O(n^2)。<br>情况最差时，每次的划分点都是最大值或最小值，一共需要划分 n - 1 次，<br>而一次划分需要线性的时间复杂度，所以最坏情况下时间复杂度为 O(n^2)</p>
<p>空间复杂度：期望为 O(logn)，递归调用的期望深度为 O(logn)，<br>每层需要的空间为 O(1)，只有常数个变量。</p>
<p>最坏情况下的空间复杂度为 O(n)。最坏情况下需要划分 n 次，<br>即 randomized_selected 函数递归调用最深 n - 1 层，<br>而每层由于需要 O(1) 的空间，所以一共需要 O(n) 的空间复杂度。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">self, nums, l, r</span>):</span></span><br><span class="line">        <span class="comment"># 快排切分，返回下标i + 1，使得比nums[i+1]小的数都在 i + 1 的左边，比nums[i + 1]大的数都在i + 1的右边。</span></span><br><span class="line">        pivot = nums[r]</span><br><span class="line">        i = l - <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">            <span class="keyword">if</span> nums[j] &lt;= pivot:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">        nums[i + <span class="number">1</span>], nums[r] = nums[r], nums[i + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">randomized_partition</span>(<span class="params">self, nums, l, r</span>):</span></span><br><span class="line">        p = random.randint(l, r)</span><br><span class="line">        nums[r], nums[p] = nums[p], nums[r]</span><br><span class="line">        <span class="keyword">return</span> self.partition(nums, l, r)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">randomized_selected</span>(<span class="params">self, arr, l, r, k</span>):</span></span><br><span class="line">        pos = self.randomized_partition(arr, l, r)</span><br><span class="line">        length = pos - l + <span class="number">1</span>  <span class="comment"># pviot 左子序列(包括pivot)长度</span></span><br><span class="line">        <span class="keyword">if</span> k &lt; length:</span><br><span class="line">            <span class="comment"># 则说明 k 个最小值在当前基准左侧子序，继续切分左段</span></span><br><span class="line">            self.randomized_selected(arr, l, pos - <span class="number">1</span>, k)</span><br><span class="line">        <span class="keyword">elif</span> k &gt; length:</span><br><span class="line">            <span class="comment"># 在右子序找 k - length 最小元素，继续切分右段</span></span><br><span class="line">            self.randomized_selected(arr, pos + <span class="number">1</span>, r, k - length)</span><br><span class="line">        <span class="comment"># k = length 则说明已经可以获取 k 个最小值了，找到排序后下标为pos的元素，就返回pos以及pos左边所有的数；</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:  <span class="comment"># 特判</span></span><br><span class="line">            <span class="keyword">return</span> list()</span><br><span class="line">        self.randomized_selected(arr, <span class="number">0</span>, len(arr) - <span class="number">1</span>, k)</span><br><span class="line">        <span class="keyword">return</span> arr[:k]  <span class="comment"># 取前 k 值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    array = [<span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line">    print(solution.getLeastNumbers(array, <span class="number">2</span>))</span><br><span class="line">    <span class="comment"># [2, 1]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line">self.randomized_selected(arr, <span class="number">0</span>, len(arr) - <span class="number">1</span>, k)</span><br><span class="line">self.randomized_selected(arr, <span class="number">0</span>, <span class="number">7</span> - <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">randomized_selected(self, arr, l, r, k):</span><br><span class="line">l = <span class="number">0</span></span><br><span class="line">r = <span class="number">6</span></span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">pos = self.randomized_partition(arr, l, r)</span><br><span class="line">p = random.randint(l, r) = <span class="number">4</span></span><br><span class="line">nums[r] = nums[p] = nums[<span class="number">6</span>] = nums[<span class="number">4</span>] = <span class="number">6</span> </span><br><span class="line">nums[p] = nums[r] = nums[<span class="number">4</span>] = nums[p] = <span class="number">4</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>]</span><br><span class="line"><span class="keyword">return</span> self.partition(nums, l, r)</span><br><span class="line"></span><br><span class="line">pivot = nums[r] = nums[<span class="number">6</span>] = <span class="number">6</span></span><br><span class="line">i = l - <span class="number">1</span> = <span class="number">0</span> - <span class="number">1</span> = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    nums[j] = nums[<span class="number">0</span>] = <span class="number">3</span> &lt; pivot = <span class="number">6</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">0</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    j = <span class="number">1</span></span><br><span class="line">    nums[j] = nums[<span class="number">1</span>] = <span class="number">7</span> &gt; pivot = <span class="number">6</span>:</span><br><span class="line"></span><br><span class="line">    j = <span class="number">2</span></span><br><span class="line">    nums[j] = nums[<span class="number">2</span>] = <span class="number">1</span> &lt; pivot = <span class="number">6</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">0</span>] = nums[<span class="number">1</span>] = <span class="number">7</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">3</span></span><br><span class="line">    nums[j] = nums[<span class="number">3</span>] = <span class="number">5</span> &lt; pivot = <span class="number">6</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">2</span>] = nums[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">3</span>] = nums[<span class="number">2</span>] = <span class="number">7</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">4</span></span><br><span class="line">    nums[j] = nums[<span class="number">4</span>] = <span class="number">4</span> &lt; pivot = <span class="number">6</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">2</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">3</span>] = nums[<span class="number">4</span>] = <span class="number">4</span></span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">4</span>] = nums[<span class="number">3</span>] = <span class="number">7</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">5</span></span><br><span class="line">    nums[j] = nums[<span class="number">5</span>] = <span class="number">2</span> &lt; pivot = <span class="number">6</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">3</span> + <span class="number">1</span> = <span class="number">4</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">4</span>] = nums[<span class="number">5</span>] = <span class="number">2</span></span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">5</span>] = nums[<span class="number">4</span>] = <span class="number">7</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">nums[i + <span class="number">1</span>] = nums[r] = nums[<span class="number">5</span>] = nums[<span class="number">6</span>] = <span class="number">6</span></span><br><span class="line">nums[r] = nums[i + <span class="number">1</span>] = nums[<span class="number">6</span>] = nums[<span class="number">5</span>] = <span class="number">7</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line">切分元素 pivot = nums[p] = <span class="number">6</span> 交换到它排序以后最终确定的位置上 </span><br><span class="line"><span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">pos = i + <span class="number">1</span> = <span class="number">5</span>  返回原来下标为<span class="number">4</span>的元素<span class="number">6</span>的最终位置在下标<span class="number">5</span>，</span><br><span class="line">是第 pos + <span class="number">1</span> = <span class="number">6</span> 大元素，</span><br><span class="line">pviot 左子序列(包括pivot)长度</span><br><span class="line">length = pos - l + <span class="number">1</span> = <span class="number">5</span> - <span class="number">0</span> + <span class="number">1</span> = <span class="number">6</span></span><br><span class="line">pivot 是数组中第 pos - l + <span class="number">1</span> = <span class="number">6</span> 小的数，</span><br><span class="line"></span><br><span class="line">k = <span class="number">2</span> &lt; length = <span class="number">6</span>:</span><br><span class="line">self.randomized_selected(arr, l, pos - <span class="number">1</span>, k)</span><br><span class="line">self.randomized_selected(arr, <span class="number">0</span>, <span class="number">5</span> - <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">self.randomized_selected(arr, <span class="number">0</span>, <span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line">    randomized_selected(self, arr, l, r, k)</span><br><span class="line">    l = <span class="number">0</span></span><br><span class="line">    r = <span class="number">4</span></span><br><span class="line">    k = <span class="number">2</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>]</span><br><span class="line">    pos = self.randomized_partition(arr, l, r)</span><br><span class="line">    p = random.randint(l, r) = <span class="number">3</span></span><br><span class="line">    nums[r] = nums[p] = nums[<span class="number">4</span>] = nums[<span class="number">3</span>] = <span class="number">4</span> </span><br><span class="line">    nums[p] = nums[r] = nums[<span class="number">3</span>] = nums[<span class="number">4</span>] = <span class="number">2</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]  [<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line">    <span class="keyword">return</span> self.partition(nums, l, r)</span><br><span class="line"></span><br><span class="line">    pivot = nums[r] = nums[<span class="number">4</span>] = <span class="number">4</span></span><br><span class="line">    i = l - <span class="number">1</span> = <span class="number">0</span> - <span class="number">1</span> = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        nums[j] = nums[<span class="number">0</span>] = <span class="number">3</span> &lt; pivot = <span class="number">4</span>:</span><br><span class="line">        i = i + <span class="number">1</span> = <span class="number">0</span></span><br><span class="line">        nums[i] = nums[j] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">        nums[j] = nums[i] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        nums[j] = nums[<span class="number">1</span>] = <span class="number">1</span> &lt; pivot = <span class="number">4</span>:</span><br><span class="line">        i = i + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">        nums[i] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">        nums[j] = nums[i] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        j = <span class="number">2</span></span><br><span class="line">        nums[j] = nums[<span class="number">2</span>] = <span class="number">5</span> &gt; pivot = <span class="number">4</span>:</span><br><span class="line"></span><br><span class="line">        j = <span class="number">3</span></span><br><span class="line">        nums[j] = nums[<span class="number">3</span>] = <span class="number">2</span> &lt; pivot = <span class="number">4</span>:</span><br><span class="line">        i = i + <span class="number">1</span> = <span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">        nums[i] = nums[j] = nums[<span class="number">2</span>] = nums[<span class="number">3</span>] = <span class="number">2</span></span><br><span class="line">        nums[j] = nums[i] = nums[<span class="number">3</span>] = nums[<span class="number">2</span>] = <span class="number">5</span></span><br><span class="line">        [<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]   [<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">    nums[i + <span class="number">1</span>] = nums[r] = nums[<span class="number">3</span>] = nums[<span class="number">4</span>] = <span class="number">4</span></span><br><span class="line">    nums[r] = nums[i + <span class="number">1</span>] = nums[<span class="number">4</span>] = nums[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]    [<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    切分元素 nums[p] = <span class="number">4</span> 交换到它排序以后最终确定的位置上 </span><br><span class="line">    <span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    pos = i + <span class="number">1</span> = <span class="number">3</span>  返回原来下标为<span class="number">3</span>的元素<span class="number">4</span>的最终位置在下标<span class="number">3</span></span><br><span class="line">    length = pos - l + <span class="number">1</span> = <span class="number">3</span> - <span class="number">0</span> + <span class="number">1</span> = <span class="number">4</span></span><br><span class="line">    k = <span class="number">2</span> &lt; length = <span class="number">4</span>:</span><br><span class="line">    self.randomized_selected(arr, l, pos - <span class="number">1</span>, k)</span><br><span class="line">    self.randomized_selected(arr, <span class="number">0</span>, <span class="number">3</span> - <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    self.randomized_selected(arr, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        randomized_selected(self, arr, l, r, k)</span><br><span class="line">        l = <span class="number">0</span></span><br><span class="line">        r = <span class="number">2</span></span><br><span class="line">        k = <span class="number">2</span></span><br><span class="line">        [<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">        pos = self.randomized_partition(arr, l, r)</span><br><span class="line"></span><br><span class="line">        p = random.randint(l, r) = <span class="number">0</span></span><br><span class="line">        nums[r] = nums[p] = nums[<span class="number">2</span>] = nums[<span class="number">0</span>] = <span class="number">3</span> </span><br><span class="line">        nums[p] = nums[r] = nums[<span class="number">0</span>] = nums[<span class="number">2</span>] = <span class="number">2</span></span><br><span class="line">        [<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]  [<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line">        <span class="keyword">return</span> self.partition(nums, l, r)</span><br><span class="line"></span><br><span class="line">        pivot = nums[r] = nums[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">        i = l - <span class="number">1</span> = <span class="number">0</span> - <span class="number">1</span> = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">            nums[j] = nums[<span class="number">0</span>] = <span class="number">2</span> &lt; pivot = <span class="number">3</span>:</span><br><span class="line">            i = i + <span class="number">1</span> = <span class="number">0</span></span><br><span class="line">            nums[i] = nums[j] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">2</span></span><br><span class="line">            nums[j] = nums[i] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">            j = <span class="number">1</span></span><br><span class="line">            nums[j] = nums[<span class="number">1</span>] = <span class="number">1</span> &lt; pivot = <span class="number">3</span>:</span><br><span class="line">            i = i + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">            nums[i] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">            nums[j] = nums[i] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        nums[i + <span class="number">1</span>] = nums[r] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">        nums[r] = nums[i + <span class="number">1</span>] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">        切分元素 nums[p] = <span class="number">3</span> 交换到它排序以后最终确定的位置上</span><br><span class="line">        <span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">        pos = i + <span class="number">1</span> = <span class="number">2</span>  返回原来下标为<span class="number">0</span>的元素<span class="number">3</span>的最终位置在下标<span class="number">2</span></span><br><span class="line">        length = pos - l + <span class="number">1</span> = <span class="number">2</span> - <span class="number">0</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">        k = <span class="number">2</span> &lt; length = <span class="number">3</span>:</span><br><span class="line">        self.randomized_selected(arr, l, pos - <span class="number">1</span>, k)</span><br><span class="line">        self.randomized_selected(arr, <span class="number">0</span>, <span class="number">2</span> - <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        self.randomized_selected(arr, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">            randomized_selected(self, arr, l, r, k)</span><br><span class="line">            l = <span class="number">0</span></span><br><span class="line">            r = <span class="number">1</span></span><br><span class="line">            k = <span class="number">2</span></span><br><span class="line">            [<span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">            pos = self.randomized_partition(arr, l, r)</span><br><span class="line"></span><br><span class="line">            p = random.randint(l, r) = <span class="number">1</span></span><br><span class="line">            nums[r] = nums[p] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">1</span> </span><br><span class="line">            nums[p] = nums[r] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">            [<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]  [<span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">return</span> self.partition(nums, l, r)</span><br><span class="line"></span><br><span class="line">            pivot = nums[r] = nums[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">            i = l - <span class="number">1</span> = <span class="number">0</span> - <span class="number">1</span> = <span class="number">-1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">                j = <span class="number">0</span></span><br><span class="line">                nums[j] = nums[<span class="number">0</span>] = <span class="number">2</span> &gt; pivot = <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">            nums[i + <span class="number">1</span>] = nums[r] = nums[<span class="number">0</span>] = nums[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">            nums[r] = nums[i + <span class="number">1</span>] = nums[<span class="number">1</span>] = nums[<span class="number">0</span>] = <span class="number">2</span></span><br><span class="line">            [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]  [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">            切分元素 nums[p] = <span class="number">1</span> 交换到它排序以后最终确定的位置上    </span><br><span class="line">            <span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">            pos = i + <span class="number">1</span> = <span class="number">0</span>  返回原来下标为<span class="number">1</span>的元素<span class="number">1</span>的最终位置在下标<span class="number">0</span></span><br><span class="line">            length = pos - l + <span class="number">1</span> = <span class="number">0</span> - <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">            k = <span class="number">2</span> &gt; length = <span class="number">1</span>:</span><br><span class="line">            self.randomized_selected(arr, pos + <span class="number">1</span>, r, k - num)</span><br><span class="line">            self.randomized_selected(arr, <span class="number">0</span> + <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">            self.randomized_selected(arr, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                randomized_selected(self, arr, l, r, k)</span><br><span class="line">                l = <span class="number">1</span></span><br><span class="line">                r = <span class="number">1</span></span><br><span class="line">                k = <span class="number">1</span></span><br><span class="line">                [<span class="number">2</span>]</span><br><span class="line">                pos = self.randomized_partition(arr, l, r)</span><br><span class="line">                p = random.randint(l, r) = <span class="number">1</span></span><br><span class="line">                nums[r] = nums[p] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span> </span><br><span class="line">                nums[p] = nums[r] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">                [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]  [<span class="number">2</span>]</span><br><span class="line">                <span class="keyword">return</span> self.partition(nums, l, r)</span><br><span class="line"></span><br><span class="line">                pivot = nums[r] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">                i = l - <span class="number">1</span> = <span class="number">1</span> - <span class="number">1</span> = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1</span>): j取不到值</span><br><span class="line"></span><br><span class="line">                nums[i + <span class="number">1</span>] = nums[r] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">                nums[r] = nums[i + <span class="number">1</span>] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">                [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>] [<span class="number">2</span>]</span><br><span class="line">                切分元素 nums[p] = <span class="number">2</span> 交换到它排序以后最终确定的位置上 </span><br><span class="line">                <span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">                pos = i + <span class="number">1</span> = <span class="number">0</span>  返回原来下标为<span class="number">1</span>的元素<span class="number">1</span>的最终位置在下标<span class="number">0</span></span><br><span class="line">                length = pos - l + <span class="number">1</span> = <span class="number">0</span> - <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">                k = <span class="number">1</span> = length </span><br><span class="line">            回到上一层</span><br><span class="line">            l = <span class="number">0</span></span><br><span class="line">            r = <span class="number">1</span></span><br><span class="line">            k = <span class="number">2</span></span><br><span class="line">            length = <span class="number">1</span></span><br><span class="line">        回到上一层</span><br><span class="line">        l = <span class="number">0</span></span><br><span class="line">        r = <span class="number">2</span></span><br><span class="line">        k = <span class="number">2</span></span><br><span class="line">        length = <span class="number">3</span></span><br><span class="line">    回到上一层</span><br><span class="line">    l = <span class="number">0</span></span><br><span class="line">    r = <span class="number">4</span></span><br><span class="line">    k = <span class="number">2</span></span><br><span class="line">    length = <span class="number">4</span>        </span><br><span class="line">回到初始值</span><br><span class="line">l = <span class="number">0</span></span><br><span class="line">r = <span class="number">6</span></span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">length = <span class="number">6</span>    </span><br><span class="line"><span class="keyword">return</span> arr[:k] = arr[<span class="number">1</span>]  </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>


<p>这里的循环 partition 相当于 selection 的复杂度，平均下来是 O(n) 的复杂度。</p>
<p>T(n) = T(n/2) + O(n)</p>
<p>与带 selection 的 partition 有一些不同之处。</p>
<p>突然醒悟其实这就是基于partition 实现的 selection，不同之处只是在于:<br>返回第 k+1 个元素还是前 k 个元素。<br>因为做完 selection 后，这里的 partition 必然也实现了此效果。</p>
<p>基于 selection 的 partition, 可以用 O(n) 时间把 median 当做 pivot.</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">nums, left, right</span>):</span>  <span class="comment"># assume  left &lt; right</span></span><br><span class="line">            pivot = nums[right]  <span class="comment"># 取最后一个</span></span><br><span class="line">            i = left</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(left, right):  <span class="comment"># 不取 right, 只能取到 right - 1 </span></span><br><span class="line">                <span class="keyword">if</span> nums[j] &lt; pivot:</span><br><span class="line">                    nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">            nums[i], nums[right] = nums[right], nums[i]</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:  <span class="comment"># 特殊情况处理</span></span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="comment"># if k == len(arr): # 可不加此，下面代码也能处理</span></span><br><span class="line">        <span class="comment">#     return arr</span></span><br><span class="line">        <span class="comment"># 当找到第 k 小的数字，即划分好了前 k 小的数字</span></span><br><span class="line">        left, right = <span class="number">0</span>, len(arr) - <span class="number">1</span></span><br><span class="line">        target = k - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            <span class="comment"># left == right 说明最后一次，有 target = left = right</span></span><br><span class="line">            ind = partition(arr, left, right)  <span class="comment"># 原地修改了 arr</span></span><br><span class="line">            <span class="keyword">if</span> ind == target:</span><br><span class="line">                <span class="comment"># 当前 ind 恰是 target, 恰有 arr[0,target-1] &lt; arr[target] &lt; arr[target+1, n-1]</span></span><br><span class="line">                <span class="keyword">return</span> arr[:target + <span class="number">1</span>]  <span class="comment"># 可直接返回</span></span><br><span class="line">            <span class="keyword">elif</span> ind &lt; target:</span><br><span class="line">                <span class="comment"># arr划分为 arr[0,ind-1] &lt; arr[ind] &lt; arr[ind+1, n-1], target 需在右半段中找</span></span><br><span class="line">                left = ind + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 当前 arr 划分为 arr[0,ind-1] &lt; arr[ind] &lt; arr[ind+1, n-1], 而 target 需要在左半段中找</span></span><br><span class="line">                right = ind - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> arr[:left + <span class="number">1</span>]  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    array = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    print(solution.getLeastNumbers(array, <span class="number">2</span>))</span><br><span class="line">    <span class="comment"># [1, 2]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">left = <span class="number">0</span></span><br><span class="line">right = <span class="number">2</span></span><br><span class="line">target = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">进入循环</span><br><span class="line">partition(arr, left, right) </span><br><span class="line">pivot = nums[right] = nums[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">nums[j] = nums[<span class="number">0</span>] = <span class="number">3</span> &gt; pivot = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">j = <span class="number">1</span> 只能取到 right - <span class="number">1</span> = <span class="number">2</span> - <span class="number">1</span> = <span class="number">1</span> </span><br><span class="line">nums[j] = nums[<span class="number">1</span>] = <span class="number">2</span> &gt; pivot = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">nums[i] = nums[right] = nums[<span class="number">0</span>] = nums[<span class="number">2</span>] = <span class="number">1</span> </span><br><span class="line">nums[right] = nums[i] = nums[<span class="number">2</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] </span><br><span class="line"><span class="keyword">return</span> i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">ind = i = <span class="number">0</span> &lt; target = <span class="number">1</span></span><br><span class="line">left = ind + <span class="number">1</span> = <span class="number">1</span> &lt; right = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">再循环</span><br><span class="line">ind = partition(arr, left, right)</span><br><span class="line">pivot = nums[right] = nums[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">j = <span class="number">1</span> 只能取到 right - <span class="number">1</span> = <span class="number">2</span> - <span class="number">1</span> = <span class="number">1</span> </span><br><span class="line">nums[j] = nums[<span class="number">1</span>] = <span class="number">2</span> &lt; pivot = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">nums[i] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span> </span><br><span class="line">nums[j] = nums[i] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span> </span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">i = i + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">nums[i] = nums[right] = nums[<span class="number">1</span>] = nums[<span class="number">2</span>] = <span class="number">3</span> </span><br><span class="line">nums[right] = nums[i] = nums[<span class="number">2</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>] </span><br><span class="line"><span class="keyword">return</span> i = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">ind = i = <span class="number">2</span> &gt; target = <span class="number">1</span></span><br><span class="line">right = ind - <span class="number">1</span> = <span class="number">2</span> - <span class="number">1</span> = <span class="number">1</span> = left </span><br><span class="line">跳出循环</span><br><span class="line"><span class="keyword">return</span> arr[:left + <span class="number">1</span>] = arr[:<span class="number">1</span> + <span class="number">1</span>] = arr[<span class="number">0</span>:<span class="number">2</span>] = [<span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># 取数组第一个值，该值进行归位，左边都比该值小，右边都比该值大。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">self, nums, left, right</span>):</span></span><br><span class="line">        pivot = nums[left]</span><br><span class="line">        <span class="comment"># 原地排序</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line">            <span class="keyword">while</span> left &lt; right <span class="keyword">and</span> pivot &lt;= nums[right]:</span><br><span class="line">                right -= <span class="number">1</span></span><br><span class="line">            <span class="comment"># 从right开始，如果比tmp小，则交换。</span></span><br><span class="line">            nums[left] = nums[right]</span><br><span class="line">            <span class="keyword">while</span> left &lt; right <span class="keyword">and</span> nums[left] &lt;= pivot:</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line">            <span class="comment"># 从left开始，如果比tmp大，则交换。</span></span><br><span class="line">            nums[right] = nums[left]</span><br><span class="line">        nums[left] = pivot</span><br><span class="line">        <span class="keyword">return</span> left</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        size = len(arr)</span><br><span class="line">        <span class="keyword">if</span> size == <span class="number">0</span> <span class="keyword">or</span> k &gt; size: <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> size == <span class="number">1</span> <span class="keyword">or</span> size == k:</span><br><span class="line">            <span class="keyword">return</span> arr</span><br><span class="line">        left, right = <span class="number">0</span>, size - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> left &lt;= right:  <span class="comment"># 这里其实也相当于是二分法</span></span><br><span class="line">            pivot = self.partition(arr, left, right)  <span class="comment"># left, right, split_ind 都是原始 index</span></span><br><span class="line">            <span class="keyword">if</span> pivot == k:  <span class="comment"># 在 split_ind 左边有 k 个元素，全部不大于 pivot</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> pivot &gt; k:</span><br><span class="line">                right = pivot - <span class="number">1</span>  <span class="comment"># 不-1 会陷入死循环</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                left = pivot + <span class="number">1</span>  <span class="comment"># 不 +1 会陷入死循环</span></span><br><span class="line">        <span class="keyword">return</span> arr[:k]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        l, r = <span class="number">0</span>, len(arr) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> l &lt; r:</span><br><span class="line">            pivot = self.partition(arr, l, r)</span><br><span class="line">            <span class="keyword">if</span> pivot &gt; k - <span class="number">1</span>:</span><br><span class="line">                r = pivot - <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                l = pivot + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> arr[:k]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">self, nums, l, r</span>):</span></span><br><span class="line">        pivot = r</span><br><span class="line">        right = l</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(l, r):</span><br><span class="line">            <span class="keyword">if</span> nums[i] &lt; nums[pivot]:</span><br><span class="line">                nums[i], nums[right] = nums[right], nums[i]</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">        nums[pivot], nums[right] = nums[right], nums[pivot]</span><br><span class="line">        <span class="keyword">return</span> right</span><br></pre></td></tr></tbody></table></figure>



<p>法二：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        heapq.heapify(arr)</span><br><span class="line">        <span class="keyword">return</span> heapq.nsmallest(k, arr)</span><br></pre></td></tr></tbody></table></figure>

<p>法三<br>通过构造k个元素的大根堆来存储最小的k个元素，实时维护数组的前 k 小值，步骤如下：</p>
<p>将数组中的元素依次入堆，<br>如果堆中元素不足K个，那么就是直接添加；<br>当堆中元素大于等于K个时，<br>首先取数组前k个元素初始化堆，从最后一个非叶结点开始到根结点来构建最大堆<br>随后从第 k+1 个数开始遍历，依次将堆顶元素与遍历到的当前元素比较</p>
<ol>
<li>如果大于大根堆的堆顶元素，则说明这个元素不属于最小的k个数之列，<br>跳过不入堆。</li>
<li>如果当遍历到的数比大根堆的堆顶的数要小，<br>把堆顶元素弹出，再插入当前遍历到的数。<br>那么将堆顶的数换成这个更小的数，再从堆顶重新堆化（heapify）构建最大堆<br>这样下去之后，由于每次从堆顶弹出的数都是堆中最大的，最小的 k 个元素一定会留在堆里，<br>最后将大根堆里的数存入数组返回，取数组的前k个元素即为前k小的数</li>
</ol>
<p>python3标准库中提供了heapq，使用原地算法得到对小顶堆进行操作<br>实现 大顶堆 方法：要对数组中所有的数取其相反数，小顶堆的插入和弹出操作均将元素 取反</p>
<p>在写代码的时候，我们使用的也是库函数中的优先队列数据结构，<br>在面试中，我们不需要实现堆的内部结构，把数据结构使用好，会分析其复杂度即可。</p>
<p>时间复杂度：O(nlogk)，其中 n 是数组 arr 的长度。由于大根堆实时维护前 k 小值，<br>所以插入删除都是 O(logk) 的时间复杂度，<br>最坏情况下数组里 n 个数都会插入，所以一共需要 O(nlogk) 的时间复杂度。</p>
<p>空间复杂度：O(k)，因为大根堆里最多 k 个数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:  <span class="comment"># 排除 0 的情况</span></span><br><span class="line">            <span class="keyword">return</span> list()</span><br><span class="line">        <span class="comment"># python默认是小根堆，把所有的元素都加负号以满足最大二叉堆性质</span></span><br><span class="line">        <span class="comment"># 求最小k个数那就要转化为负值来做</span></span><br><span class="line">        hp = [-x <span class="keyword">for</span> x <span class="keyword">in</span> arr[:k]]</span><br><span class="line">        <span class="comment"># 将列表hp原地改为最大二叉堆列表，具备大顶堆特征</span></span><br><span class="line">        heapq.heapify(hp)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(k, len(arr)):</span><br><span class="line">            <span class="keyword">if</span> -hp[<span class="number">0</span>] &gt; arr[i]:</span><br><span class="line">                <span class="comment"># 堆顶元素下标为0，如果这个元素小，就入堆</span></span><br><span class="line">                <span class="comment"># 将最小二叉堆hp的堆顶元素弹出</span></span><br><span class="line">                heapq.heappop(hp)</span><br><span class="line">                <span class="comment"># 将num压入堆ls中，将 item 的值加入 hp 中，保持堆的不变性。</span></span><br><span class="line">                heapq.heappush(hp, -arr[i])</span><br><span class="line">        <span class="keyword">return</span> [-x <span class="keyword">for</span> x <span class="keyword">in</span> hp]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    array = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">    print(solution.getLeastNumbers(array, <span class="number">2</span>))</span><br><span class="line">    <span class="comment"># [2, 1]</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">arr[:k] = arr[:<span class="number">2</span>] = [<span class="number">3</span>, <span class="number">2</span>]</span><br><span class="line">hp = [<span class="number">-3</span>, <span class="number">-2</span>]</span><br><span class="line">heapq.heapify(hp)  最小堆</span><br><span class="line">hp = [<span class="number">-3</span>, <span class="number">-2</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(k, len(arr))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    -hp[<span class="number">0</span>] = <span class="number">3</span> &gt; arr[i] = arr[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    heapq.heappop(hp)</span><br><span class="line">    hp = [<span class="number">-2</span>]</span><br><span class="line">    heapq.heappush(hp, -arr[i])</span><br><span class="line">    heapq.heappush(hp, <span class="number">-1</span>)</span><br><span class="line">    hp = [<span class="number">-2</span>, <span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    i = <span class="number">3</span></span><br><span class="line">    -hp[<span class="number">0</span>] = <span class="number">2</span> &lt; arr[i] = arr[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">4</span></span><br><span class="line">    -hp[<span class="number">0</span>] = <span class="number">2</span> &lt; arr[i] = arr[<span class="number">4</span>] = <span class="number">6</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">5</span></span><br><span class="line">    -hp[<span class="number">0</span>] = <span class="number">2</span> &lt; arr[i] = arr[<span class="number">3</span>] = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [-x <span class="keyword">for</span> x <span class="keyword">in</span> hp]</span><br><span class="line">    <span class="keyword">return</span> [-x <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">-2</span>, <span class="number">-1</span>]]</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">2</span>, <span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure>

<p>-3 &lt; -2</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">-3</span></span><br><span class="line">   /</span><br><span class="line">  <span class="number">-2</span></span><br><span class="line"></span><br><span class="line">   /</span><br><span class="line">  <span class="number">-2</span></span><br><span class="line">不符合最小堆，调整</span><br><span class="line">   <span class="number">-2</span></span><br><span class="line">   /</span><br><span class="line"></span><br><span class="line">   <span class="number">-2</span></span><br><span class="line">   /</span><br><span class="line">  <span class="number">-1</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> list()</span><br><span class="line">        <span class="comment"># python默认是小根堆，求最小k个数那就要转化为负值来做，变成大根堆</span></span><br><span class="line">        hp = [-x <span class="keyword">for</span> x <span class="keyword">in</span> arr[:k]]</span><br><span class="line">        <span class="comment"># 将列表hp原地改为最大二叉堆列表，具备大顶堆特征</span></span><br><span class="line">        heapq.heapify(hp)  </span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> arr[k:]:</span><br><span class="line">            <span class="keyword">if</span> -hp[<span class="number">0</span>] &gt; item:</span><br><span class="line">                <span class="comment"># 堆顶元素下标为0，如果这个元素小，就入堆</span></span><br><span class="line">                <span class="comment"># 将最小二叉堆hp的堆顶元素弹出</span></span><br><span class="line">                heapq.heappop(hp)  </span><br><span class="line">                <span class="comment"># 将num压入堆ls中</span></span><br><span class="line">                heapq.heappush(hp, -item)</span><br><span class="line">        <span class="keyword">return</span> [-x <span class="keyword">for</span> x <span class="keyword">in</span> hp]</span><br></pre></td></tr></tbody></table></figure>


<p>击败97%</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">        heap = [-a <span class="keyword">for</span> a <span class="keyword">in</span> arr[:k]]</span><br><span class="line">        heapq.heapify(heap)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(k, len(arr)):</span><br><span class="line">            heapq.heappushpop(heap, -arr[i])</span><br><span class="line">        <span class="keyword">return</span> [-a <span class="keyword">for</span> a <span class="keyword">in</span> heap]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span>   </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: List[int], k: int</span>) -&gt; List[int]:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> arr <span class="keyword">or</span> k == <span class="number">0</span>: <span class="keyword">return</span> []</span><br><span class="line">    <span class="keyword">if</span> len(arr) &lt;= k: <span class="keyword">return</span> arr</span><br><span class="line">    heap = arr[:k]  <span class="comment"># 初始化</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildMaxHeap</span>(<span class="params">pos</span>):</span></span><br><span class="line">        <span class="keyword">while</span> pos*<span class="number">2</span>+<span class="number">1</span> &lt; k:</span><br><span class="line">            max_pos = pos*<span class="number">2</span>+<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> pos*<span class="number">2</span>+<span class="number">2</span> &lt; k <span class="keyword">and</span> heap[pos*<span class="number">2</span>+<span class="number">2</span>] &gt; heap[pos*<span class="number">2</span>+<span class="number">1</span>]:  <span class="comment"># 存在右节点，且右节点大于左节点</span></span><br><span class="line">                max_pos += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> heap[pos] &lt; heap[max_pos]:  <span class="comment"># 最大节点大于根节点，上浮/下沉</span></span><br><span class="line">                heap[pos],heap[max_pos] = heap[max_pos],heap[pos]</span><br><span class="line">                pos = max_pos</span><br><span class="line">            <span class="keyword">else</span>: <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k//<span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):  <span class="comment"># k//2 ~ 0: 2i+1为左节点于数组中index</span></span><br><span class="line">        buildMaxHeap(i)  <span class="comment"># 由叶子节点开始上浮</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k, len(arr)):</span><br><span class="line">        <span class="keyword">if</span> arr[i] &lt; heap[<span class="number">0</span>]:</span><br><span class="line">            heap[<span class="number">0</span>] = arr[i]</span><br><span class="line">            buildMaxHeap(<span class="number">0</span>)  <span class="comment"># 由根节点开始下沉</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">return</span> heap</span><br></pre></td></tr></tbody></table></figure>


<p>大根堆 – 最小k个元素<br>求前k个最小用最大堆，求前k个最大用最小堆。<br>步骤如下：<br>1: 取数组前k个元素初始化堆，从最后一个非叶子节点开始到根节点来构建大根堆<br>2: 当某个元素大于堆顶元素时，直接抛弃<br>3: 当某个元素小于堆顶元素时，替换栈顶元素，再从堆顶重新构建大根堆</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swap</span>(<span class="params">heap, i, j</span>):</span></span><br><span class="line">        heap[i], heap[j] = heap[j], heap[i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">heapify</span>(<span class="params">self, heap, i</span>):</span></span><br><span class="line">        left, right = <span class="number">2</span> * i + <span class="number">1</span>, <span class="number">2</span> * i + <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        largest = i</span><br><span class="line">        <span class="keyword">if</span> left &lt; len(heap) <span class="keyword">and</span> heap[left] &gt; heap[largest]:</span><br><span class="line">            largest = left</span><br><span class="line">        <span class="keyword">if</span> right &lt; len(heap) <span class="keyword">and</span> heap[right] &gt; heap[largest]:</span><br><span class="line">            largest = right</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> largest != i:  <span class="comment"># 调整当前子树为大顶堆</span></span><br><span class="line">            self.swap(heap, i, largest)</span><br><span class="line">            self.heapify(heap, largest)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_heap</span>(<span class="params">self, heap: list</span>):</span></span><br><span class="line">        <span class="comment"># 从最后一个非叶子节点开始构建大根堆, len(heap)//2 - 1就是最后一个非叶子节点</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(heap) // <span class="number">2</span> - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            self.heapify(heap, i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLeastNumbers</span>(<span class="params">self, arr: list, k: int</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> arr <span class="keyword">or</span> k &lt;= <span class="number">0</span>: <span class="keyword">return</span> []</span><br><span class="line">        <span class="keyword">if</span> len(arr) &lt;= k: <span class="keyword">return</span> arr</span><br><span class="line"></span><br><span class="line">        heap = arr[:k]</span><br><span class="line">        self.build_heap(heap)  <span class="comment"># 构建大根堆</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(k, len(arr)):</span><br><span class="line">            <span class="keyword">if</span> arr[i] &lt; heap[<span class="number">0</span>]:  <span class="comment"># 当前元素比堆根小，则弹出堆根并插入当前元素</span></span><br><span class="line">                heap[<span class="number">0</span>] = arr[i]</span><br><span class="line">                self.heapify(heap, <span class="number">0</span>)  <span class="comment"># 重新调整堆根</span></span><br><span class="line">        <span class="keyword">return</span> heap</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetLeastNumbers_Solution</span>(<span class="params">self, tinput, k</span>):</span></span><br><span class="line">        <span class="comment"># 第一种</span></span><br><span class="line">        <span class="comment"># if len(tinput) &lt; k:</span></span><br><span class="line">        <span class="comment">#     return []</span></span><br><span class="line">        <span class="comment"># ret = sorted(tinput)</span></span><br><span class="line">        <span class="comment"># return ret[:k]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 第二种,使用最大堆</span></span><br><span class="line">        <span class="comment"># 创建或者是插入最大堆</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">createMaxHeap</span>(<span class="params">num</span>):</span></span><br><span class="line">            maxHeap.append(num)</span><br><span class="line">            currentIndex = len(maxHeap) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> currentIndex != <span class="number">0</span>:</span><br><span class="line">                parentIndex = (currentIndex - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>  <span class="comment"># 任意节点的父节点</span></span><br><span class="line">                <span class="keyword">if</span> maxHeap[parentIndex] &lt; maxHeap[currentIndex]:</span><br><span class="line">                    maxHeap[parentIndex], maxHeap[currentIndex] = maxHeap[currentIndex], maxHeap[parentIndex]</span><br><span class="line">                    currentIndex = parentIndex</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调整最大堆，头节点发生改变</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">adjustMaxHeap</span>(<span class="params">num</span>):</span></span><br><span class="line">            <span class="keyword">if</span> num &lt; maxHeap[<span class="number">0</span>]:</span><br><span class="line">                maxHeap[<span class="number">0</span>] = num</span><br><span class="line"></span><br><span class="line">            maxHeapLen = len(maxHeap)</span><br><span class="line">            index = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> index &lt; maxHeapLen:</span><br><span class="line">                leftIndex = index * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">                rightIndex = index * <span class="number">2</span> + <span class="number">2</span></span><br><span class="line">                <span class="keyword">if</span> rightIndex &lt; maxHeapLen:</span><br><span class="line">                    <span class="keyword">if</span> maxHeap[rightIndex] &lt; maxHeap[leftIndex]:</span><br><span class="line">                        largerIndex = leftIndex</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        largerIndex = rightIndex</span><br><span class="line">                <span class="keyword">elif</span> leftIndex &lt; maxHeapLen:</span><br><span class="line">                    largerIndex = leftIndex</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> maxHeap[index] &lt; maxHeap[largerIndex]:</span><br><span class="line">                    maxHeap[index], maxHeap[largerIndex] = maxHeap[largerIndex], maxHeap[index]</span><br><span class="line">                index = largerIndex</span><br><span class="line"></span><br><span class="line">        maxHeap = []</span><br><span class="line">        tinputLen = len(tinput)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tinputLen &lt; k <span class="keyword">or</span> k &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(tinputLen):</span><br><span class="line">            <span class="keyword">if</span> i &lt; k:</span><br><span class="line">                createMaxHeap(tinput[i])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                adjustMaxHeap(tinput[i])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sorted(maxHeap)</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h4 id="215-数组中的第K个最大元素"><a href="#215-数组中的第K个最大元素" class="headerlink" title="215. 数组中的第K个最大元素"></a>215. 数组中的第K个最大元素</h4><p>​    <strong>在未排序的数组中找到第 k 个最大的元素。请注意，你需要找的是数组排序后的第 k 个最大的元素，而不是第 k 个不同的元素。</strong></p>
<p>示例 1:</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>] 和 k = <span class="number">2</span></span><br><span class="line">输出: <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure>

<p>示例 2:</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: [<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>] 和 k = <span class="number">4</span></span><br><span class="line">输出: <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure>
<p>说明：你可以假设 k 总是有效的，且 1 ≤ k ≤ 数组的长度。</p>
<p>题目要求我们找到“数组排序后的第 k 个最大的元素，而不是第 k 个不同的元素” ，<br>语义是从右边往左边数第 k 个元素（从 1 开始），那么从左向右数是第几个呢，<br>我们列出几个找找规律就好了。<br>一共 6 个元素，找第 2 大，索引是 4；<br>一共 6 个元素，找第 4 大，索引是 2。<br>因此，升序排序以后，目标元素的索引是 len - k。<br>找第 k 大，即找第 len - k 小</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: List[int], k: int</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> heapq.nlargest(k, nums)[<span class="number">-1</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>法二：<br>借助 partition 操作定位到最终排定以后索引为 len - k 的那个元素（特别注意：随机化切分元素）</p>
<p>时间复杂度：O(N)，这里 N 是数组的长度，理由可以参考主定理进行分析。<br>空间复杂度：O(1)，原地排序，没有借助额外的辅助空间。<br>注意：本题必须随机初始化 pivot 元素，否则通过时间会很慢，因为测试用例中有极端测试用例。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: List[int], k: int</span>) -&gt; int:</span></span><br><span class="line">        size = len(nums)</span><br><span class="line">        target = size - k</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = size - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># 死循环</span></span><br><span class="line">            index = self.__partition(nums, left, right)</span><br><span class="line">            <span class="keyword">if</span> index == target:</span><br><span class="line">                <span class="keyword">return</span> nums[index]  <span class="comment"># 结束循环</span></span><br><span class="line">            <span class="keyword">elif</span> index &lt; target:</span><br><span class="line">                <span class="comment"># 下一轮在 [index + 1, right] 里找</span></span><br><span class="line">                left = index + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = index - <span class="number">1</span></span><br><span class="line">    <span class="string">'''parition 的操作</span></span><br><span class="line"><span class="string">         在循环中，保持的循环不变量是：</span></span><br><span class="line"><span class="string">         [left + 1, j] &lt; pivot 与 (j, i) &gt;= pivot</span></span><br><span class="line"><span class="string">         因此，在 partition 的最后，需要将 left 位置与 j 位置交换，交换以后就能得到：</span></span><br><span class="line"><span class="string">         [left, j - 1] &lt; pivot，nums[j] = pivot ，[j + 1, right] &gt;= pivot ，j 位置就是 pivot 在排序以后应该呆的位置。</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__partition</span>(<span class="params">self, nums, left, right</span>):</span></span><br><span class="line"></span><br><span class="line">        pivot = nums[left]</span><br><span class="line">        j = left</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(left + <span class="number">1</span>, right + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[i] &lt; pivot:</span><br><span class="line">                j += <span class="number">1</span>   <span class="comment"># 小于 pivot 的元素都被交换到前面</span></span><br><span class="line">                nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment">#  partition 的作用：把一个数组的子区间按照 pivot 进行分区，分区完成以后，交换 left 和 分区的分界线，把切分元素 pivot 交换到它排序以后最终确定的位置上。</span></span><br><span class="line">        nums[left], nums[j] = nums[j], nums[left]</span><br><span class="line">        <span class="keyword">return</span> j</span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">size = <span class="number">3</span></span><br><span class="line">target = size - k = <span class="number">3</span> - <span class="number">2</span> = <span class="number">1</span> </span><br><span class="line">left = <span class="number">0</span></span><br><span class="line">right = size - <span class="number">1</span> = <span class="number">3</span> - <span class="number">1</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">index = self.__partition(nums, left, right)</span><br><span class="line">    pivot = nums[left] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    j = left = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    nums[i] = nums[<span class="number">1</span>] = <span class="number">2</span> &lt; pivot = <span class="number">3</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span>  </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span>  </span><br><span class="line"></span><br><span class="line">    i = <span class="number">2</span> </span><br><span class="line">    nums[i] = nums[<span class="number">2</span>] = <span class="number">1</span> &lt; pivot = <span class="number">3</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">1</span>  </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">1</span>  </span><br><span class="line"></span><br><span class="line">    i 只取到 right + <span class="number">1</span> - <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">    跳出循环</span><br><span class="line"></span><br><span class="line">    nums[left] = nums[j] = nums[<span class="number">0</span>] = nums[<span class="number">2</span>] = <span class="number">1</span> </span><br><span class="line">    nums[j] = nums[left] = nums[<span class="number">2</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] 切分元素 pivot = <span class="number">3</span> 交换到它排序以后最终确定的位置上。</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">index = j = <span class="number">2</span> &gt; target = <span class="number">1</span></span><br><span class="line">right = index - <span class="number">1</span> = <span class="number">2</span> - <span class="number">1</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">self.__partition(nums, left, right)</span><br><span class="line">    pivot = nums[left] = <span class="number">1</span></span><br><span class="line">    j = left = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    nums[<span class="number">1</span>] = <span class="number">2</span> &gt; pivot = <span class="number">1</span></span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    nums[<span class="number">2</span>] = <span class="number">3</span> &gt; pivot = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    nums[left] = nums[j] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">1</span> </span><br><span class="line">    nums[j] = nums[left] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] 切分元素 pivot = <span class="number">1</span> 交换到它排序以后最终确定的位置上。     </span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">index = j = <span class="number">0</span> &lt; target = <span class="number">1</span></span><br><span class="line">left = index + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">self.__partition(nums, left, right)</span><br><span class="line">    pivot = nums[left] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    j = left = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    nums[<span class="number">2</span>] = <span class="number">3</span> &gt; pivot = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    nums[left] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span> </span><br><span class="line">    nums[j] = nums[left] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] 切分元素 pivot = <span class="number">2</span> 交换到它排序以后最终确定的位置上。</span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">index = j = <span class="number">1</span> = target = <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> nums[index] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>


<p>法三：<br>随机</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: List[int], k: int</span>) -&gt; int:</span></span><br><span class="line">        size = len(nums)</span><br><span class="line"></span><br><span class="line">        target = size - k</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = size - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            index = self.__partition(nums, left, right)</span><br><span class="line">            <span class="keyword">if</span> index == target:</span><br><span class="line">                <span class="keyword">return</span> nums[index]</span><br><span class="line">            <span class="keyword">elif</span> index &lt; target:</span><br><span class="line">                <span class="comment"># 下一轮在 [index + 1, right] 里找</span></span><br><span class="line">                left = index + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = index - <span class="number">1</span></span><br><span class="line">    <span class="string">''' parition 的操作</span></span><br><span class="line"><span class="string">        在循环中，保持的循环不变量是：</span></span><br><span class="line"><span class="string">        [left + 1, j] &lt; pivot 与 (j, i) &gt;= pivot</span></span><br><span class="line"><span class="string">        因此，在 partition 的最后，需要将 left 位置与 j 位置交换，交换以后就能得到：</span></span><br><span class="line"><span class="string">        [left, j - 1] &lt; pivot，nums[j] = pivot ，[j + 1, right] &gt;= pivot ，j 位置就是 pivot 在排序以后应该呆的位置。</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__partition</span>(<span class="params">self, nums, left, right</span>):</span></span><br><span class="line">        <span class="comment"># 随机化切分元素</span></span><br><span class="line">        <span class="comment"># randint 是包括左右区间的</span></span><br><span class="line">        random_index = random.randint(left, right)</span><br><span class="line">        nums[random_index], nums[left] = nums[left], nums[random_index]</span><br><span class="line"></span><br><span class="line">        pivot = nums[left]</span><br><span class="line">        j = left</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(left + <span class="number">1</span>, right + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[i] &lt; pivot:</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">                nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">        <span class="comment">#  partition 的作用：把一个数组的子区间按照 pivot 进行分区，分区完成以后，交换 left 和 分区的分界线，把切分元素 pivot 交换到它排序以后最终确定的位置上。</span></span><br><span class="line">        nums[left], nums[j] = nums[j], nums[left]</span><br><span class="line">        <span class="keyword">return</span> j</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">size = <span class="number">6</span></span><br><span class="line">target = size - k = <span class="number">6</span> - <span class="number">2</span> = <span class="number">4</span></span><br><span class="line">left = <span class="number">0</span></span><br><span class="line">right = size - <span class="number">1</span> = <span class="number">6</span> - <span class="number">1</span> = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">index = self.__partition(nums, left, right)</span><br><span class="line">    random_index = left</span><br><span class="line">    pivot = nums[left] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    j = left = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    nums[i] = nums[<span class="number">1</span>] = <span class="number">2</span> &lt; pivot = <span class="number">3</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span>  </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span>  </span><br><span class="line"></span><br><span class="line">    i = <span class="number">2</span> </span><br><span class="line">    nums[i] = nums[<span class="number">2</span>] = <span class="number">1</span> &lt; pivot = <span class="number">3</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">1</span>  </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">1</span>  </span><br><span class="line"></span><br><span class="line">    i = <span class="number">3</span> </span><br><span class="line">    nums[i] = nums[<span class="number">3</span>] = <span class="number">5</span> &gt; pivot = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">4</span> </span><br><span class="line">    nums[i] = nums[<span class="number">4</span>] = <span class="number">6</span> &gt; pivot = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">5</span> </span><br><span class="line">    nums[i] = nums[<span class="number">5</span>] = <span class="number">4</span> &gt; pivot = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i 只取到 right + <span class="number">1</span> - <span class="number">1</span> = <span class="number">5</span></span><br><span class="line">    跳出循环</span><br><span class="line"></span><br><span class="line">    nums[left] = nums[j] = nums[<span class="number">0</span>] = nums[<span class="number">2</span>] = <span class="number">1</span> </span><br><span class="line">    nums[j] = nums[left] = nums[<span class="number">2</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>] 切分元素 pivot = <span class="number">3</span> 交换到它排序以后最终确定的位置上。</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">index = j = <span class="number">2</span> &lt; target = <span class="number">4</span></span><br><span class="line">left = index + <span class="number">1</span> = <span class="number">2</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">self.__partition(nums, left, right)</span><br><span class="line">self.__partition(nums, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">    random_index = left</span><br><span class="line">    pivot = nums[left] = nums[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    j = left = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">4</span></span><br><span class="line">    nums[<span class="number">4</span>] = <span class="number">6</span> &gt; pivot = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">5</span></span><br><span class="line">    nums[<span class="number">5</span>] = <span class="number">4</span> &lt; pivot = <span class="number">5</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">4</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">5</span>] = nums[<span class="number">4</span>] = <span class="number">6</span> </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">4</span>] = nums[<span class="number">5</span>] = <span class="number">4</span> </span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    nums[left] = nums[j] = nums[<span class="number">3</span>] = nums[<span class="number">4</span>] = <span class="number">6</span> </span><br><span class="line">    nums[j] = nums[left] = nums[<span class="number">4</span>] = nums[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>] 切分元素 pivot = <span class="number">5</span> 交换到它排序以后最终确定的位置上。</span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">index = j = <span class="number">4</span> = target = <span class="number">4</span></span><br><span class="line"><span class="keyword">return</span> nums[index] = nums[<span class="number">4</span>] = <span class="number">5</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">size = <span class="number">6</span></span><br><span class="line">target = size - k = <span class="number">6</span> - <span class="number">2</span> = <span class="number">4</span></span><br><span class="line">left = <span class="number">0</span></span><br><span class="line">right = size - <span class="number">1</span> = <span class="number">6</span> - <span class="number">1</span> = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">index = self.__partition(nums, left, right)</span><br><span class="line">    random_index = right</span><br><span class="line">    pivot = nums[left] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    j = left = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    nums[i] = nums[<span class="number">1</span>] = <span class="number">2</span> &lt; pivot = <span class="number">3</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span>  </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span>  </span><br><span class="line"></span><br><span class="line">    i = <span class="number">2</span> </span><br><span class="line">    nums[i] = nums[<span class="number">2</span>] = <span class="number">1</span> &lt; pivot = <span class="number">3</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">1</span>  </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">2</span>] = nums[<span class="number">2</span>] = <span class="number">1</span>  </span><br><span class="line"></span><br><span class="line">    i = <span class="number">3</span> </span><br><span class="line">    nums[i] = nums[<span class="number">3</span>] = <span class="number">5</span> &gt; pivot = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">4</span> </span><br><span class="line">    nums[i] = nums[<span class="number">4</span>] = <span class="number">6</span> &gt; pivot = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">5</span> </span><br><span class="line">    nums[i] = nums[<span class="number">5</span>] = <span class="number">4</span> &gt; pivot = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i 只取到 right + <span class="number">1</span> - <span class="number">1</span> = <span class="number">5</span></span><br><span class="line">    跳出循环</span><br><span class="line"></span><br><span class="line">    nums[left] = nums[j] = nums[<span class="number">0</span>] = nums[<span class="number">2</span>] = <span class="number">1</span> </span><br><span class="line">    nums[j] = nums[left] = nums[<span class="number">2</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>] 切分元素 pivot = <span class="number">3</span> 交换到它排序以后最终确定的位置上。</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">index = j = <span class="number">2</span> &lt; target = <span class="number">4</span></span><br><span class="line">left = index + <span class="number">1</span> = <span class="number">2</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">self.__partition(nums, left, right)</span><br><span class="line">self.__partition(nums, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">    random_index = left</span><br><span class="line">    pivot = nums[left] = nums[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    j = left = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">4</span></span><br><span class="line">    nums[<span class="number">4</span>] = <span class="number">6</span> &gt; pivot = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">5</span></span><br><span class="line">    nums[<span class="number">5</span>] = <span class="number">4</span> &lt; pivot = <span class="number">5</span></span><br><span class="line">    j = j + <span class="number">1</span> = <span class="number">4</span></span><br><span class="line">    nums[i] = nums[j] = nums[<span class="number">5</span>] = nums[<span class="number">4</span>] = <span class="number">6</span> </span><br><span class="line">    nums[j] = nums[i] = nums[<span class="number">4</span>] = nums[<span class="number">5</span>] = <span class="number">4</span> </span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    nums[left] = nums[j] = nums[<span class="number">3</span>] = nums[<span class="number">4</span>] = <span class="number">6</span> </span><br><span class="line">    nums[j] = nums[left] = nums[<span class="number">4</span>] = nums[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>] 切分元素 pivot = <span class="number">5</span> 交换到它排序以后最终确定的位置上。</span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">index = j = <span class="number">4</span> = target = <span class="number">4</span></span><br><span class="line"><span class="keyword">return</span> nums[index] = nums[<span class="number">4</span>] = <span class="number">5</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>使用双指针，将与 pivot 相等的元素等概论地分到 pivot 最终排定位置的两边。<br>使用双指针的办法找到切分元素的位置。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: List[int], k: int</span>) -&gt; int:</span></span><br><span class="line">        size = len(nums)</span><br><span class="line"></span><br><span class="line">        target = size - k</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = size - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            index = self.__partition(nums, left, right)</span><br><span class="line">            <span class="keyword">if</span> index == target:</span><br><span class="line">                <span class="keyword">return</span> nums[index]</span><br><span class="line">            <span class="keyword">elif</span> index &lt; target:</span><br><span class="line">                <span class="comment"># 下一轮在 [index + 1, right] 里找</span></span><br><span class="line">                left = index + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = index - <span class="number">1</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">parition 的操作 在之前遍历的过程中 将等于 pivot 的元素分散到两边</span></span><br><span class="line"><span class="string">在循环中，保持的循环不变量是：</span></span><br><span class="line"><span class="string">    # [left + 1, lt） &lt;= pivot</span></span><br><span class="line"><span class="string">    # (rt, right] &gt;= pivot</span></span><br><span class="line"><span class="string">因此，在 partition 的最后，需要将 left 位置与 rt 位置交换，交换以后就能得到：</span></span><br><span class="line"><span class="string">[left, rt - 1] &lt; pivot，nums[rt] = pivot ，[rt + 1, right] &gt;= pivot ，rt 位置就是 pivot 在排序以后应该呆的位置。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__partition</span>(<span class="params">self, nums, left, right</span>):</span></span><br><span class="line">        <span class="comment"># randint 是包括左右区间的</span></span><br><span class="line">        random_index = random.randint(left, right)</span><br><span class="line">        nums[random_index], nums[left] = nums[left], nums[random_index]</span><br><span class="line"></span><br><span class="line">        pivot = nums[left]</span><br><span class="line">        lt = left + <span class="number">1</span></span><br><span class="line">        rt = right</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">while</span> lt &lt;= rt <span class="keyword">and</span> nums[lt] &lt; pivot:</span><br><span class="line">                lt += <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> lt &lt;= rt <span class="keyword">and</span> nums[rt] &gt; pivot:</span><br><span class="line">                rt -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> lt &gt; rt:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            nums[lt], nums[rt] = nums[rt], nums[lt]</span><br><span class="line">            lt += <span class="number">1</span></span><br><span class="line">            rt -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        nums[left], nums[rt] = nums[rt], nums[left]</span><br><span class="line">        <span class="keyword">return</span> rt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    array = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    print(solution.findKthLargest(array, <span class="number">2</span>))</span><br><span class="line">    <span class="comment"># [2]</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">size = <span class="number">3</span></span><br><span class="line">target = size - k = <span class="number">3</span> - <span class="number">2</span> = <span class="number">1</span> </span><br><span class="line">left = <span class="number">0</span></span><br><span class="line">right = size - <span class="number">1</span> = <span class="number">3</span> - <span class="number">1</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    self.__partition(nums, left, right)</span><br><span class="line">    random_index = random.randint(left, right) = <span class="number">0</span></span><br><span class="line">    nums[random_index] = nums[left] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    nums[left] = nums[random_index] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    pivot = nums[left] = <span class="number">3</span></span><br><span class="line">    lt = left + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    rt = right = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> lt = <span class="number">1</span> &lt; rt = <span class="number">2</span> <span class="keyword">and</span> nums[lt] = <span class="number">2</span> &lt; pivot = <span class="number">3</span>:</span><br><span class="line">    lt = lt + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> lt = <span class="number">2</span> = rt = <span class="number">2</span> <span class="keyword">and</span> nums[lt] = <span class="number">1</span> &lt; pivot = <span class="number">3</span>:</span><br><span class="line">    lt = lt + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">    <span class="keyword">while</span> lt = <span class="number">3</span> &gt; rt = <span class="number">2</span> <span class="keyword">and</span> </span><br><span class="line">    退出循环</span><br><span class="line">    <span class="keyword">while</span> lt = <span class="number">3</span> &gt; rt = <span class="number">2</span> <span class="keyword">and</span> </span><br><span class="line">    不进入循环</span><br><span class="line">    <span class="keyword">if</span> lt &gt; rt:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">    nums[left] = nums[rt] = nums[<span class="number">0</span>] = nums[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">    nums[rt] = nums[left] = nums[<span class="number">2</span>] = nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> rt</span><br><span class="line">    index = rt = <span class="number">2</span> &gt; target</span><br><span class="line">    right = index - <span class="number">1</span> = <span class="number">2</span> - <span class="number">1</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    self.__partition(nums, left, right)</span><br><span class="line">    random_index = random.randint(left, right) = <span class="number">0</span></span><br><span class="line">    nums[random_index] = nums[left] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    nums[left] = nums[random_index] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    pivot = nums[left] = <span class="number">1</span></span><br><span class="line">    lt = left + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    rt = right = <span class="number">1</span></span><br><span class="line">    lt = rt <span class="keyword">and</span> nums[rt] = nums[<span class="number">1</span>] = <span class="number">2</span> &gt; pivot = <span class="number">1</span>:</span><br><span class="line">    rt = rt - <span class="number">1</span> = <span class="number">0</span></span><br><span class="line">    lt = <span class="number">1</span> &gt; rt  = <span class="number">0</span> <span class="keyword">and</span> </span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">    nums[left] = nums[rt] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    nums[rt] = nums[left] = nums[<span class="number">0</span>] = nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> rt</span><br><span class="line">    index = rt = <span class="number">0</span> &lt; target = <span class="number">1</span></span><br><span class="line">    left = index + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    self.__partition(nums, left, right)</span><br><span class="line">    random_index = random.randint(left, right) = <span class="number">1</span></span><br><span class="line">    nums[random_index] = nums[left] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    nums[left] = nums[random_index] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    pivot = nums[left] = <span class="number">2</span></span><br><span class="line">    lt = left + <span class="number">1</span> = <span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">    rt = right = <span class="number">1</span></span><br><span class="line">    lt &gt; rt <span class="keyword">and</span> </span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">    nums[left] = nums[rt] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    nums[left] = nums[rt] = nums[<span class="number">1</span>] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    切分元素 pivot = <span class="number">3</span> 交换到它排序以后最终确定的位置上</span><br><span class="line">    <span class="keyword">return</span> rt</span><br><span class="line">    index = rt = <span class="number">1</span> = target = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> nums[index] = nums[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>双指针是同向出发的吧，参考代码 2 和参考代码 3 是一样的，这种写法使得 </p>
<figure class="highlight plain"><figcaption><span>+ 1, j] &lt; nums[left] ```，```[j + 1, right] &gt;</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">前后两个指针一边往中间走一边交换的双指针，把等于 nums[left] 的元素平均分到了区间的两边，递归树相对是平衡的。</span><br><span class="line">它们就这点区别。</span><br><span class="line"></span><br><span class="line">我觉得您这种写法会有冗余操作。就拿这 个测试案例[3,2,1,5,6,4] 2来说，您的参考代码2第一次分区需要4次交换操作，而双指针向中间的写法，应该只需要最后一次交换就可以了。</span><br><span class="line">参考代码 2 和参考代码 3 是认识 partition 的第 1 步，并且是不怎么好的写法。至于它多做了一些交换，这个正如您所说，跟输入数据具体的样子有关。对于一类数据是不好的，对于另一类数据又是好的，如果后面遍历到的元素都是 pivot 大，那么一次都不需要交换，具体的评估可能还有点复杂</span><br><span class="line"></span><br><span class="line">然后才是双指针的写法，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">法三</span><br><span class="line">确定数据量的情况下寻找第K大的数，用快速选择的算法，快排中的轴值计算</span><br><span class="line">在分解的过程当中，我们会对子数组进行划分，</span><br><span class="line">  1. 如果某次划分得到的 index 正好就是倒数第 k 个下标的时候，就直接返回 a[index]；</span><br><span class="line">  2. 否则，如果 index 比目标下标小，就递归右子区间，</span><br><span class="line">  3. 否则递归左子区间。</span><br><span class="line">  这样就可以把原来递归两个区间变成只递归一个区间，提高了时间效率。这就是「快速选择」算法。</span><br><span class="line">至于 a[left⋯j−1] 和 a[j+1⋯right] 是否是有序的，我们不关心。</span><br><span class="line"></span><br><span class="line">一开始是n个比对，然后你选的数是第 a 个，然后就缩小了范围(left, index), (index, right)，</span><br><span class="line">接下来如果k 在(index, right)之间就只要再比对(index, right)次，然后递归下去，</span><br><span class="line">可以发现如果是平均分的话差不多就是比对n个然后是n/2 ，n/4，...,n/2^m </span><br><span class="line">加起来不会超过2n，当然了这是要分配比较均匀的情况。</span><br><span class="line">上面用了随机分片就一般不会出现全都是n-1这种情况了</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">from typing import List</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Solution:</span><br><span class="line">    def quickSelect(self, a, l, r, target):</span><br><span class="line">        index = self.randomPartition(a, l, r)</span><br><span class="line">        if index == target:</span><br><span class="line">            return a[index]</span><br><span class="line">        elif index &lt; target:</span><br><span class="line">            return self.quickSelect(a, index + 1, r, target)</span><br><span class="line">        else:</span><br><span class="line">            return self.quickSelect(a, l, index - 1, target)</span><br><span class="line"></span><br><span class="line">    def randomPartition(self, a, l, r):</span><br><span class="line">        i = random.randint(l, r)</span><br><span class="line">        # 将随机数先放在[l,r]最右边a[r]上</span><br><span class="line">        a[i], a[r] = a[r], a[i]</span><br><span class="line">        return self.partition(a, l, r)</span><br><span class="line"></span><br><span class="line">    def partition(self, a, l, r):</span><br><span class="line">        # 在调用当前方法的randomPartition方法中，已经确定了了随机数是nums[r]</span><br><span class="line">        pivot = a[r]</span><br><span class="line">        i = l - 1</span><br><span class="line">        # nums[j] 小于 随机数 pivot 的数都跟[l,r]左边区间交换</span><br><span class="line">        for j in range(l, r):</span><br><span class="line">            if a[j] &lt; pivot:</span><br><span class="line">                i += 1</span><br><span class="line">                a[i], a[j] = a[j], a[i]</span><br><span class="line">        # 这个for循环操作就是将小于 pivot 的数都往[i, j]的左边区间设置，</span><br><span class="line">        # 从而实现存在[l, i]区间,使得对应数值都 小于 pivot</span><br><span class="line">        # 现在将pivot也就是nums[r] 跟nums[i+1]交换，从而分成两个区间[l，i+1]左, [i+2, r]右，左边区间的值都小于pivot</span><br><span class="line">        i += 1</span><br><span class="line">        a[i], a[r] = a[r], a[i]</span><br><span class="line">        return i</span><br><span class="line"></span><br><span class="line">    def findKthLargest(self, nums, k):</span><br><span class="line">        return self.quickSelect(nums, 0, len(nums) - 1, len(nums) - k)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">self.quickSelect(nums, <span class="number">0</span>, len(nums) - <span class="number">1</span>, len(nums) - k)</span><br><span class="line">quickSelect(self, a, l, r, target)</span><br><span class="line">a = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">l = <span class="number">0</span></span><br><span class="line">r = len(nums) - <span class="number">1</span> = <span class="number">6</span> - <span class="number">1</span> = <span class="number">5</span> </span><br><span class="line">target = len(nums) - k = <span class="number">6</span> - <span class="number">2</span> = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">self.randomPartition(a, l, r)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">a[i] = a[r] = a[<span class="number">0</span>] = a[<span class="number">5</span>] = <span class="number">4</span></span><br><span class="line">a[r] = a[i] = a[<span class="number">5</span>] = a[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">[<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">return</span> self.partition(a, l, r)</span><br><span class="line">pivot = a[r] = <span class="number">3</span></span><br><span class="line">i = l - <span class="number">1</span> = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    a[j] = a[<span class="number">0</span>] = <span class="number">4</span> &gt; pivot = <span class="number">3</span>:</span><br><span class="line"></span><br><span class="line">    j = <span class="number">1</span></span><br><span class="line">    a[j] = a[<span class="number">1</span>] = <span class="number">2</span> &lt; pivot = <span class="number">3</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">-1</span> + <span class="number">1</span> = <span class="number">0</span></span><br><span class="line">    a[i] = a[j] = a[<span class="number">0</span>] = a[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    a[j] = a[i] = a[<span class="number">1</span>] = a[<span class="number">0</span>] = <span class="number">4</span></span><br><span class="line">    [<span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">2</span></span><br><span class="line">    a[j] = a[<span class="number">2</span>] = <span class="number">1</span> &lt; pivot = <span class="number">3</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    a[i] = a[j] = a[<span class="number">1</span>] = a[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    a[j] = a[i] = a[<span class="number">2</span>] = a[<span class="number">1</span>] = <span class="number">4</span></span><br><span class="line">    [<span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">3</span></span><br><span class="line">    a[j] = a[<span class="number">3</span>] = <span class="number">5</span> &gt; pivot = <span class="number">3</span>:</span><br><span class="line"></span><br><span class="line">    j = <span class="number">4</span></span><br><span class="line">    a[j] = a[<span class="number">4</span>] = <span class="number">6</span> &gt; pivot = <span class="number">3</span>:</span><br><span class="line"></span><br><span class="line">i = i + <span class="number">1</span> = <span class="number">2</span></span><br><span class="line">a[i] = a[r] = a[<span class="number">2</span>] = a[<span class="number">5</span>] = <span class="number">3</span></span><br><span class="line">a[r] = a[i] = a[<span class="number">5</span>] = a[<span class="number">2</span>] = <span class="number">4</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">切分元素 pivot = <span class="number">3</span> 交换到它排序以后最终确定的位置上</span><br><span class="line"><span class="keyword">return</span> i </span><br><span class="line"></span><br><span class="line">index = i = <span class="number">2</span> &lt; target = <span class="number">4</span></span><br><span class="line"><span class="keyword">return</span> self.quickSelect(a, index + <span class="number">1</span>, r, target)</span><br><span class="line">quickSelect(self, a, l, r, target)</span><br><span class="line">a = [<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">l = <span class="number">3</span></span><br><span class="line">r = <span class="number">5</span></span><br><span class="line">target = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">self.randomPartition(a, l, r)</span><br><span class="line">i = <span class="number">3</span></span><br><span class="line">a[i] = a[r] = a[<span class="number">3</span>] = a[<span class="number">5</span>] = <span class="number">4</span></span><br><span class="line">a[r] = a[i] = a[<span class="number">5</span>] = a[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">return</span> self.partition(a, l, r)</span><br><span class="line">pivot = a[<span class="number">5</span>] = <span class="number">6</span></span><br><span class="line">i = l - <span class="number">1</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(l, r):</span><br><span class="line">    j = <span class="number">3</span></span><br><span class="line">    a[j] = a[<span class="number">3</span>] = <span class="number">4</span> &lt; pivot = <span class="number">5</span>:</span><br><span class="line">    i = i + <span class="number">1</span> = <span class="number">2</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">    a[i] = a[j] = a[<span class="number">3</span>] = a[<span class="number">3</span>] = <span class="number">4</span></span><br><span class="line">    a[j] = a[i] = a[<span class="number">3</span>] = a[<span class="number">3</span>] = <span class="number">4</span></span><br><span class="line">    [<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">    j = <span class="number">4</span></span><br><span class="line">    a[j] = a[<span class="number">4</span>] = <span class="number">6</span> &gt; pivot = <span class="number">5</span>:</span><br><span class="line"></span><br><span class="line">i = i + <span class="number">1</span> = <span class="number">3</span> + <span class="number">1</span> = <span class="number">4</span></span><br><span class="line">a[i] = a[r] = a[<span class="number">4</span>] = a[<span class="number">5</span>] = <span class="number">5</span></span><br><span class="line">a[r] = a[i] = a[<span class="number">5</span>] = a[<span class="number">4</span>] = <span class="number">6</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">切分元素 pivot = <span class="number">3</span> 交换到它排序以后最终确定的位置上</span><br><span class="line"><span class="keyword">return</span> i </span><br><span class="line"></span><br><span class="line">index = i = <span class="number">4</span> = target</span><br><span class="line"><span class="keyword">return</span> a[index] = <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: List[int], k: int</span>) -&gt; int:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">nums, left, right</span>):</span></span><br><span class="line">            pivot = nums[right]</span><br><span class="line">            i = left</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(left, right + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> nums[j] &lt; pivot:</span><br><span class="line">                    nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">            nums[i], nums[right] = nums[right], nums[i]</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">        n = len(nums)</span><br><span class="line">        t = n - k</span><br><span class="line">        <span class="comment">#        if not (0&lt;= t &lt;= n-1):</span></span><br><span class="line">        <span class="comment">#            return</span></span><br><span class="line">        left, right = <span class="number">0</span>, n - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:  <span class="comment"># 若设置成 left &lt; right 如果下面没有语句的话，可能会漏解， 例如 [3]</span></span><br><span class="line">            ind = partition(nums, left, right)</span><br><span class="line">            <span class="keyword">if</span> ind == t:</span><br><span class="line">                <span class="keyword">return</span> nums[ind]</span><br><span class="line">            <span class="keyword">elif</span> ind &lt; t:</span><br><span class="line">                left = ind + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = ind - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> nums[left]  <span class="comment"># 对应前面 left&lt;right, 若前面设置为 left &lt;= right, 则不用此语句</span></span><br></pre></td></tr></tbody></table></figure>


<p>方法二：基于堆排序的选择方法<br>思路和算法<br>我们也可以使用堆排序来解决这个问题——建立一个大根堆，<br>做 k - 1 次删除操作后堆顶元素就是我们要找的答案。<br>在很多语言中，都有优先队列或者堆的的容器可以直接使用，<br>但是在面试中，面试官更倾向于让面试者自己实现一个堆。<br>所以建议读者掌握这里大根堆的实现方法，<br>在这道题中尤其要搞懂「建堆」、「调整」和「删除」的过程。</p>
<p>时间复杂度：O(nlogn)，建堆的时间代价是 O(n)，删除的总代价是 O(klogn)，因为 k &lt; n，故渐进时间复杂为 O(n+klogn)=O(nlogn)。<br>空间复杂度：O(logn)，即递归使用栈空间的空间代价。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxHeapify</span>(<span class="params">self, a, i, heapSize</span>):</span></span><br><span class="line">        l = i * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        r = i * <span class="number">2</span> + <span class="number">2</span></span><br><span class="line">        largest = i</span><br><span class="line">        <span class="keyword">if</span> l &lt; heapSize <span class="keyword">and</span> a[l] &gt; a[largest]:</span><br><span class="line">            largest = l</span><br><span class="line">        <span class="keyword">if</span> r &lt; heapSize <span class="keyword">and</span> a[r] &gt; a[largest]:</span><br><span class="line">            largest = r</span><br><span class="line">        <span class="keyword">if</span> largest != i:</span><br><span class="line">            a[i], a[largest] = a[largest], a[i]</span><br><span class="line">            self.maxHeapify(a, largest, heapSize)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildMaxHeap</span>(<span class="params">self, a, heapSize</span>):</span>  <span class="comment"># 由列表建立大根堆</span></span><br><span class="line">            <span class="string">""""从后往前遍历所有内部节点，其中最后一个内部节点的公式为len(nums_list)//2 - 1"""</span></span><br><span class="line">        <span class="comment"># 从最后一个非叶子节点开始堆化</span></span><br><span class="line">        <span class="comment"># 从最后一个非叶子节点开始构建大根堆, len(heap)//2 - 1就是最后一个非叶子节点</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(heapSize // <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            self.maxHeapify(a, i, heapSize)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums, k</span>):</span></span><br><span class="line">        heapSize = len(nums)</span><br><span class="line">        self.buildMaxHeap(nums, heapSize)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) - <span class="number">1</span>, len(nums) - k, <span class="number">-1</span>):</span><br><span class="line">            nums[<span class="number">0</span>], nums[i] = nums[i], nums[<span class="number">0</span>]</span><br><span class="line">            heapSize -= <span class="number">1</span></span><br><span class="line">            self.maxHeapify(nums, <span class="number">0</span>, heapSize)</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solution = Solution()</span><br><span class="line">    array = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">    print(solution.findKthLargest(array, <span class="number">4</span>))</span><br><span class="line">    <span class="comment"># 5</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">findKthLargest(self, nums, k)</span><br><span class="line">findKthLargest(<span class="built_in">array</span>, <span class="number">2</span>)</span><br><span class="line">nums = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">k = <span class="number">4</span></span><br><span class="line">heapSize = <span class="number">9</span></span><br><span class="line">self.buildMaxHeap(nums, heapSize)</span><br><span class="line">buildMaxHeap(self, a, heapSize):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(heapSize <span class="comment">// 2, -1, -1):</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">    i = <span class="number">4</span></span><br><span class="line">    self.maxHeapify(a, i, heapSize)</span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">9</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">10</span></span><br><span class="line">    largest = i = <span class="number">4</span></span><br><span class="line">    l = <span class="number">9</span> = heapSize </span><br><span class="line"></span><br><span class="line">    i = <span class="number">3</span></span><br><span class="line">    self.maxHeapify(a, i, heapSize)</span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">7</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">8</span></span><br><span class="line">    largest = i = <span class="number">3</span></span><br><span class="line">    l = <span class="number">7</span> &lt; heapSize = <span class="number">9</span></span><br><span class="line">    a[l] = a[<span class="number">7</span>] = <span class="number">5</span> &gt; a[largest] = a[<span class="number">3</span>] = <span class="number">1</span> </span><br><span class="line">    largest = l = <span class="number">7</span></span><br><span class="line">    a[r] = a[<span class="number">8</span>] = <span class="number">6</span> &gt; a[largest] = a[<span class="number">7</span>] = <span class="number">5</span> </span><br><span class="line">    largest = r = <span class="number">8</span> != i = <span class="number">3</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">3</span>] = a[<span class="number">8</span>] = <span class="number">6</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">7</span>] = a[<span class="number">3</span>] = <span class="number">1</span></span><br><span class="line">    a = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize)</span><br><span class="line">    i = largest = <span class="number">8</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">17</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">18</span></span><br><span class="line">    largest = i = <span class="number">8</span></span><br><span class="line">    l = <span class="number">17</span> &gt; heapSize = <span class="number">9</span></span><br><span class="line">    largest = <span class="number">8</span> = i</span><br><span class="line"></span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    self.maxHeapify(a, i, heapSize)</span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">5</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">6</span></span><br><span class="line">    largest = i = <span class="number">2</span></span><br><span class="line">    l = <span class="number">5</span> &lt; heapSize = <span class="number">9</span></span><br><span class="line">    a[l] = a[<span class="number">5</span>] = <span class="number">4</span> &gt; a[largest] = a[<span class="number">2</span>] = <span class="number">3</span> </span><br><span class="line">    largest = l = <span class="number">5</span></span><br><span class="line">    a[r] = a[<span class="number">6</span>] = <span class="number">5</span> &gt; a[largest] = a[<span class="number">5</span>] = <span class="number">4</span> </span><br><span class="line">    largest = r = <span class="number">6</span> != i = <span class="number">2</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">2</span>] = a[<span class="number">6</span>] = <span class="number">5</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">6</span>] = a[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">    a = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">6</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">13</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">14</span></span><br><span class="line">    largest = i = <span class="number">6</span></span><br><span class="line">    l = <span class="number">13</span> &gt; heapSize = <span class="number">9</span></span><br><span class="line">    largest = <span class="number">6</span> = i</span><br><span class="line"></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    self.maxHeapify(a, i, heapSize)</span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">4</span></span><br><span class="line">    largest = i = <span class="number">1</span></span><br><span class="line">    l = <span class="number">3</span> &lt; heapSize = <span class="number">9</span></span><br><span class="line">    a[l] = a[<span class="number">3</span>] = <span class="number">6</span> &gt; a[largest] = a[<span class="number">1</span>] = <span class="number">2</span> </span><br><span class="line">    largest = l = <span class="number">3</span></span><br><span class="line">    a[r] = a[<span class="number">4</span>] = <span class="number">2</span> &lt; a[largest] = a[<span class="number">3</span>] = <span class="number">6</span> </span><br><span class="line">    largest = <span class="number">3</span> != i = <span class="number">1</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">1</span>] = a[<span class="number">3</span>] = <span class="number">6</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">3</span>] = a[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">    a = [<span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">3</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">7</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">8</span></span><br><span class="line">    largest = i = <span class="number">3</span></span><br><span class="line">    l = <span class="number">7</span> &lt; heapSize = <span class="number">9</span></span><br><span class="line">    a[l] = a[<span class="number">7</span>] = <span class="number">5</span> &gt; a[largest] = a[<span class="number">3</span>] = <span class="number">2</span> </span><br><span class="line">    largest = l = <span class="number">7</span></span><br><span class="line">    a[r] = a[<span class="number">8</span>] = <span class="number">1</span> &lt; a[largest] = a[<span class="number">7</span>] = <span class="number">5</span> </span><br><span class="line">    largest = l = <span class="number">7</span> != i = <span class="number">3</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">3</span>] = a[<span class="number">7</span>] = <span class="number">5</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">7</span>] = a[<span class="number">3</span>] = <span class="number">2</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">7</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">15</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">16</span></span><br><span class="line">    largest = i = <span class="number">6</span></span><br><span class="line">    l = <span class="number">15</span> &gt; heapSize = <span class="number">9</span></span><br><span class="line">    largest = <span class="number">7</span> = i</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    self.maxHeapify(a, i, heapSize)</span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">2</span></span><br><span class="line">    largest = i = <span class="number">0</span></span><br><span class="line">    l = <span class="number">1</span> &lt; heapSize = <span class="number">9</span></span><br><span class="line">    a[l] = a[<span class="number">1</span>] = <span class="number">6</span> &gt; a[largest] = a[<span class="number">0</span>] = <span class="number">3</span> </span><br><span class="line">    largest = l = <span class="number">1</span></span><br><span class="line">    a[r] = a[<span class="number">2</span>] = <span class="number">5</span> &lt; a[largest] = a[<span class="number">1</span>] = <span class="number">6</span></span><br><span class="line">    largest = l = <span class="number">1</span> != i = <span class="number">0</span> </span><br><span class="line">    a[i] = a[largest] = a[<span class="number">0</span>] = a[<span class="number">1</span>] = <span class="number">6</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">1</span>] = a[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    a = [<span class="number">6</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">1</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">4</span></span><br><span class="line">    largest = i = <span class="number">1</span></span><br><span class="line">    l = <span class="number">3</span> &lt; heapSize = <span class="number">9</span></span><br><span class="line">    a[l] = a[<span class="number">3</span>] = <span class="number">5</span> &gt; a[largest] = a[<span class="number">1</span>] = <span class="number">3</span> </span><br><span class="line">    largest = l = <span class="number">3</span></span><br><span class="line">    a[r] = a[<span class="number">4</span>] = <span class="number">2</span> &lt; a[largest] = a[<span class="number">3</span>] = <span class="number">5</span> </span><br><span class="line">    largest = <span class="number">3</span> != i = <span class="number">1</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">1</span>] = a[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">3</span>] = a[<span class="number">1</span>] = <span class="number">3</span></span><br><span class="line">    a = [<span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">3</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">7</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">8</span></span><br><span class="line">    largest = i = <span class="number">3</span></span><br><span class="line">    l = <span class="number">7</span> &lt; heapSize = <span class="number">9</span></span><br><span class="line">    a[l] = a[<span class="number">7</span>] = <span class="number">2</span> &lt; a[largest] = a[<span class="number">3</span>] = <span class="number">3</span></span><br><span class="line">    a[r] = a[<span class="number">8</span>] = <span class="number">1</span> &lt; a[largest] = a[<span class="number">3</span>] = <span class="number">3</span> </span><br><span class="line">    largest = <span class="number">3</span> = i </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) - <span class="number">1</span>, len(nums) - k, <span class="number">-1</span>):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span> - <span class="number">1</span>, <span class="number">9</span> - <span class="number">4</span>, <span class="number">-1</span>):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>, <span class="number">5</span>, <span class="number">-1</span>):</span><br><span class="line">    i = <span class="number">8</span> </span><br><span class="line">    nums[<span class="number">0</span>] = nums[i] = a[<span class="number">8</span>] = <span class="number">1</span> </span><br><span class="line">    nums[i] = nums[<span class="number">8</span>] = a[<span class="number">0</span>] = <span class="number">6</span> </span><br><span class="line">    [<span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>]</span><br><span class="line">    heapSize = heapSize - <span class="number">1</span> = <span class="number">8</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>] 去掉a[<span class="number">8</span>]</span><br><span class="line">    self.maxHeapify(nums, <span class="number">0</span>, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">2</span></span><br><span class="line">    largest = i = <span class="number">0</span></span><br><span class="line">    l = <span class="number">1</span> &lt; heapSize = <span class="number">8</span></span><br><span class="line">    a[l] = a[<span class="number">1</span>] = <span class="number">5</span> &gt; a[largest] = a[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    largest = l = <span class="number">1</span></span><br><span class="line">    a[r] = a[<span class="number">2</span>] = <span class="number">5</span> = a[largest] = a[<span class="number">1</span>] = <span class="number">5</span> </span><br><span class="line">    largest = <span class="number">1</span> != i = <span class="number">0</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">0</span>] = a[<span class="number">1</span>] = <span class="number">5</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">1</span>] = a[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    a = [<span class="number">5</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">1</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">4</span></span><br><span class="line">    largest = i = <span class="number">1</span></span><br><span class="line">    l = <span class="number">3</span> &lt; heapSize = <span class="number">8</span></span><br><span class="line">    a[l] = a[<span class="number">3</span>] = <span class="number">3</span> &gt; a[largest] = a[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    largest = l = <span class="number">3</span></span><br><span class="line">    a[r] = a[<span class="number">4</span>] = <span class="number">2</span> &lt; a[largest] = a[<span class="number">3</span>] = <span class="number">3</span> </span><br><span class="line">    largest = <span class="number">3</span> != i = <span class="number">1</span> </span><br><span class="line">    a[i] = a[largest] = a[<span class="number">1</span>] = a[<span class="number">3</span>] = <span class="number">3</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">3</span>] = a[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    a = [<span class="number">5</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">3</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">7</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">8</span></span><br><span class="line">    largest = i = <span class="number">3</span></span><br><span class="line">    l = <span class="number">7</span> &lt; heapSize = <span class="number">8</span></span><br><span class="line">    a[l] = a[<span class="number">7</span>] = <span class="number">2</span> &gt; a[largest] = a[<span class="number">3</span>] = <span class="number">1</span></span><br><span class="line">    largest = l = <span class="number">7</span></span><br><span class="line">    a[r] = a[<span class="number">8</span>]不存在</span><br><span class="line">    largest = <span class="number">7</span> != i = <span class="number">3</span> </span><br><span class="line">    a[i] = a[largest] = a[<span class="number">3</span>] = a[<span class="number">7</span>] = <span class="number">2</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">7</span>] = a[<span class="number">3</span>] = <span class="number">1</span></span><br><span class="line">    a = [<span class="number">5</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">7</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">15</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">16</span></span><br><span class="line">    largest = i = <span class="number">7</span></span><br><span class="line">    l = <span class="number">15</span> &gt; heapSize = <span class="number">8</span> </span><br><span class="line">    largest = <span class="number">7</span> = i </span><br><span class="line"></span><br><span class="line">    i = <span class="number">7</span> </span><br><span class="line">    nums[<span class="number">0</span>] = nums[i] = a[<span class="number">7</span>] = <span class="number">1</span> </span><br><span class="line">    nums[i] = nums[<span class="number">7</span>] = a[<span class="number">0</span>] = <span class="number">5</span> </span><br><span class="line">    [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">    heapSize = heapSize - <span class="number">1</span> = <span class="number">7</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>] 去掉a[<span class="number">7</span>]</span><br><span class="line">    self.maxHeapify(nums, <span class="number">0</span>, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">2</span></span><br><span class="line">    largest = i = <span class="number">0</span></span><br><span class="line">    l = <span class="number">1</span> &lt; heapSize = <span class="number">7</span></span><br><span class="line">    a[l] = a[<span class="number">1</span>] = <span class="number">3</span> &gt; a[largest] = a[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    largest = l = <span class="number">0</span></span><br><span class="line">    a[r] = a[<span class="number">2</span>] = <span class="number">5</span> &gt; a[largest] = a[<span class="number">1</span>] = <span class="number">3</span> </span><br><span class="line">    largest = r = <span class="number">2</span> != i = <span class="number">0</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">0</span>] = a[<span class="number">2</span>] = <span class="number">5</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">2</span>] = a[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    a = [<span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">2</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">5</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">6</span></span><br><span class="line">    largest = i = <span class="number">2</span></span><br><span class="line">    l = <span class="number">5</span> &lt; heapSize = <span class="number">7</span></span><br><span class="line">    a[l] = a[<span class="number">5</span>] = <span class="number">4</span> &gt; a[largest] = a[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    largest = l = <span class="number">5</span></span><br><span class="line">    a[r] = a[<span class="number">6</span>] = <span class="number">3</span> &lt; a[largest] = a[<span class="number">5</span>] = <span class="number">4</span> </span><br><span class="line">    largest = <span class="number">5</span> != i = <span class="number">2</span> </span><br><span class="line">    a[i] = a[largest] = a[<span class="number">2</span>] = a[<span class="number">5</span>] = <span class="number">4</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">5</span>] = a[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    a = [<span class="number">5</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">5</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">11</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">12</span></span><br><span class="line">    largest = i = <span class="number">5</span></span><br><span class="line">    l = <span class="number">11</span> &gt; heapSize = <span class="number">7</span></span><br><span class="line">    largest = <span class="number">5</span> = i</span><br><span class="line"></span><br><span class="line">    i = <span class="number">6</span> </span><br><span class="line">    nums[<span class="number">0</span>] = nums[i] = a[<span class="number">6</span>] = <span class="number">3</span> </span><br><span class="line">    nums[i] = nums[<span class="number">6</span>] = a[<span class="number">0</span>] = <span class="number">5</span> </span><br><span class="line">    [<span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>]</span><br><span class="line">    heapSize = heapSize - <span class="number">1</span> = <span class="number">6</span></span><br><span class="line">    [<span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>] 去掉a[<span class="number">6</span>]</span><br><span class="line">    self.maxHeapify(nums, <span class="number">0</span>, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">2</span></span><br><span class="line">    largest = i = <span class="number">0</span></span><br><span class="line">    l = <span class="number">1</span> &lt; heapSize = <span class="number">6</span></span><br><span class="line">    a[l] = a[<span class="number">1</span>] = <span class="number">3</span> = a[largest] = a[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    a[r] = a[<span class="number">2</span>] = <span class="number">4</span> &gt; a[largest] = a[<span class="number">0</span>] = <span class="number">3</span> </span><br><span class="line">    largest = r = <span class="number">2</span> != i = <span class="number">0</span></span><br><span class="line">    a[i] = a[largest] = a[<span class="number">0</span>] = a[<span class="number">2</span>] = <span class="number">4</span></span><br><span class="line">    a[largest] = a[i] = a[<span class="number">2</span>] = a[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">    a = [<span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    self.maxHeapify(a, largest, heapSize)</span><br><span class="line">    maxHeapify(self, a, i, heapSize):</span><br><span class="line">    i = largest = <span class="number">2</span></span><br><span class="line">    l = i * <span class="number">2</span> + <span class="number">1</span> = <span class="number">5</span></span><br><span class="line">    r = i * <span class="number">2</span> + <span class="number">2</span> = <span class="number">6</span></span><br><span class="line">    largest = i = <span class="number">2</span></span><br><span class="line">    l = <span class="number">5</span> &lt; heapSize = <span class="number">7</span></span><br><span class="line">    a[l] = a[<span class="number">5</span>] = <span class="number">1</span> &lt; a[largest] = a[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line">    a[r] = a[<span class="number">6</span>]不存在</span><br><span class="line">    largest = i</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nums[<span class="number">0</span>] = <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">构建大根堆：存入完全二叉树</span><br><span class="line"></span><br><span class="line">先按照顺序将该数组元素</span><br><span class="line">构建成一棵完全二叉树</span><br><span class="line"></span><br><span class="line">            <span class="number">3</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">1</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">5</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">5</span>   <span class="number">6</span></span><br><span class="line">从第一个非叶子节点为根节点的子树开始，将其调整为大根堆</span><br><span class="line">            <span class="number">3</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">6</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">5</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">5</span>   <span class="number">1</span></span><br><span class="line">调整倒数第二个非叶子节点作为根节点的子树</span><br><span class="line">            <span class="number">3</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">2</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">6</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">5</span>   <span class="number">1</span></span><br><span class="line">调整倒数第三个非叶子节点作为根节点的子树</span><br><span class="line">            <span class="number">3</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">6</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">5</span>   <span class="number">1</span></span><br><span class="line">      </span><br><span class="line">            <span class="number">3</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">6</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">5</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>   <span class="number">1</span></span><br><span class="line">调整倒数第四个非叶子节点作为根节点的子树</span><br><span class="line">            <span class="number">6</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">5</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="number">6</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">5</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">3</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line">第一次删除</span><br><span class="line">k = <span class="number">4</span>，删除<span class="number">3</span>次堆顶元素</span><br><span class="line">            </span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">5</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">3</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line">先将末尾节点<span class="number">1</span>补充到堆顶位置,再进行调整</span><br><span class="line">            <span class="number">1</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">5</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">3</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>   </span><br><span class="line"></span><br><span class="line">            <span class="number">5</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">1</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">3</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>  </span><br><span class="line">开始调整，已删除<span class="number">1</span>次</span><br><span class="line"></span><br><span class="line">            <span class="number">5</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">1</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>  </span><br><span class="line"></span><br><span class="line">            <span class="number">5</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">1</span>  </span><br><span class="line"></span><br><span class="line">调整完成，已删除<span class="number">1</span>次 第<span class="number">2</span>次删除</span><br><span class="line"></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">1</span></span><br><span class="line"></span><br><span class="line">将末尾节点<span class="number">1</span>补充到堆顶位置</span><br><span class="line">            <span class="number">1</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">5</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">再进行调整     </span><br><span class="line">            <span class="number">5</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">1</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">4</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line"></span><br><span class="line">            <span class="number">5</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">4</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">1</span>   <span class="number">3</span></span><br><span class="line">       / \</span><br><span class="line">第<span class="number">3</span>次删除</span><br><span class="line">            </span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">4</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">1</span>   <span class="number">3</span></span><br><span class="line">将末尾节点<span class="number">3</span>补充到堆顶位置,</span><br><span class="line">            <span class="number">3</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">4</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">1</span>   </span><br><span class="line">再进行调整</span><br><span class="line"></span><br><span class="line">            <span class="number">4</span></span><br><span class="line">           /  \</span><br><span class="line">          <span class="number">3</span>    <span class="number">3</span></span><br><span class="line">         / \  / \</span><br><span class="line">        <span class="number">2</span>  <span class="number">2</span> <span class="number">1</span>   </span><br><span class="line"></span><br><span class="line">调整完成,已删除<span class="number">3</span>次</span><br><span class="line">返回堆顶元素 <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure>


<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: List[int], k: int</span>) -&gt; int:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">adju_max_heap</span>(<span class="params">nums_list, in_node</span>):</span>  <span class="comment"># 从当前内部节点处修正大根堆</span></span><br><span class="line">            <span class="string">""""in_node是内部节点的索引"""</span></span><br><span class="line">            l, r, large_idx= <span class="number">2</span>*in_node+<span class="number">1</span>, <span class="number">2</span>*in_node+<span class="number">2</span>, in_node  <span class="comment"># 最大值的索引默认为该内部节点</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> l &lt; len(nums_list) <span class="keyword">and</span> nums_list[large_idx] &lt; nums[l]:  </span><br><span class="line">                <span class="comment"># 如果左孩子值大于该内部节点的值，则最大值索引指向左孩子</span></span><br><span class="line">                large_idx = l</span><br><span class="line">            <span class="keyword">if</span> r &lt; len(nums_list) <span class="keyword">and</span> nums_list[large_idx] &lt; nums[r]:</span><br><span class="line">                <span class="comment"># 如果执行了上一个if语句，此时最大值索引指向左孩子，否则还是指向该内部节点</span></span><br><span class="line">                <span class="comment"># 然后最大值索引指向的值和右孩子的值比较</span></span><br><span class="line">                large_idx = r</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 上述两个if就是得到(内部节点，左孩子，右孩子)中最大值的索引</span></span><br><span class="line">            <span class="keyword">if</span> large_idx != in_node: <span class="comment"># 如果最大值在左孩子和右孩子中，则和内部节点交换</span></span><br><span class="line">                nums_list[large_idx], nums_list[in_node] = nums_list[in_node], nums_list[large_idx]</span><br><span class="line">                <span class="comment"># 如何内部节点是和左孩子交换，那就递归修正它的左子树，否则递归修正它的右子树</span></span><br><span class="line">                adju_max_heap(nums_list, large_idx)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">build_max_heap</span>(<span class="params">nums_list</span>):</span>  <span class="comment"># 由列表建立大根堆</span></span><br><span class="line">            <span class="string">""""从后往前遍历所有内部节点，其中最后一个内部节点的公式为len(nums_list)//2 - 1"""</span></span><br><span class="line">            <span class="comment"># 从最后一个非叶子节点开始堆化</span></span><br><span class="line">            <span class="keyword">for</span> in_node <span class="keyword">in</span> range(len(nums_list)//<span class="number">2</span> - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">                adju_max_heap(nums_list, in_node)</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">find_kth_max</span>(<span class="params">nums_list, k</span>):</span>  <span class="comment"># 从列表中找到第k个最大的</span></span><br><span class="line">            build_max_heap(nums_list)  <span class="comment"># 先建立大根堆</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(k<span class="number">-1</span>):</span><br><span class="line">                nums_list[<span class="number">0</span>], nums_list[<span class="number">-1</span>] = nums_list[<span class="number">-1</span>], nums_list[<span class="number">0</span>]  <span class="comment"># 堆头和堆尾交换</span></span><br><span class="line">                nums_list.pop()  <span class="comment"># 删除堆尾</span></span><br><span class="line">                adju_max_heap(nums_list, <span class="number">0</span>)  <span class="comment"># 从堆头处开始修正大根堆</span></span><br><span class="line">            <span class="keyword">return</span> nums_list[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> find_kth_max(nums, k) </span><br></pre></td></tr></tbody></table></figure>

<p>小根堆最多只需要k个元素在堆里，<br>时间复杂度 O(nlogk)，在k小于n时不是更优，q 里最多就 k 个元素<br>空间复杂度：O(k)</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span>(<span class="params">self, nums: List[int], k: int</span>) -&gt; int:</span></span><br><span class="line">        <span class="string">"""使用小顶堆"""</span></span><br><span class="line">        q = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> nums:</span><br><span class="line">            heapq.heappush(q, c)</span><br><span class="line">            <span class="keyword">while</span> len(q) &gt; k:</span><br><span class="line">                heapq.heappop(q)</span><br><span class="line">        <span class="keyword">return</span> heapq.heappop(q)</span><br></pre></td></tr></tbody></table></figure>


<hr>
<h4 id="33-数据流中的中位数-本题考点-树"><a href="#33-数据流中的中位数-本题考点-树" class="headerlink" title="33.数据流中的中位数 [^本题考点 树]"></a>33.数据流中的中位数 [^本题考点 <em>树</em>]</h4><p>​    <strong>题目：如何得到一个数据流中的中位数？如果从数据流中读出奇数个数值，那么中位数就是所有数值排序之后位于中间的数值。如果从数据流中读出偶数个数值，那么中位数就是所有数值排序之后中间两个数的平均值。</strong></p>
<p>例如，</p>
<p>[2,3,4]&nbsp;的中位数是 3</p>
<p>[2,3] 的中位数是 (2 + 3) / 2 = 2.5</p>
<p>设计一个支持以下两种操作的数据结构：</p>
<ul>
<li>void addNum(int num) - 从数据流中添加一个整数到数据结构中。</li>
<li>double findMedian() - 返回目前所有元素的中位数。<br>示例 1：<figure class="highlight prolog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">[<span class="string">"MedianFinder"</span>,<span class="string">"addNum"</span>,<span class="string">"addNum"</span>,<span class="string">"findMedian"</span>,<span class="string">"addNum"</span>,<span class="string">"findMedian"</span>]</span><br><span class="line">[[],[<span class="number">1</span>],[<span class="number">2</span>],[],[<span class="number">3</span>],[]]</span><br><span class="line">输出：[null,null,null,<span class="number">1.50000</span>,null,<span class="number">2.00000</span>]</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>示例 2：</p>
<figure class="highlight prolog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">[<span class="string">"MedianFinder"</span>,<span class="string">"addNum"</span>,<span class="string">"findMedian"</span>,<span class="string">"addNum"</span>,<span class="string">"findMedian"</span>]</span><br><span class="line">[[],[<span class="number">2</span>],[],[<span class="number">3</span>],[]]</span><br><span class="line">输出：[null,null,<span class="number">2.00000</span>,null,<span class="number">2.50000</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>法一：暴力</p>
<p>解题思路：<br>给定一长度为 N 的无序数组，其中位数的计算方法：<br>数据流新进来一个数，都把它与已经读出来的数进行一次排序，（使用 O(NlogN) 时间），<br>然后返回中间元素即可（使用 O(1) 时间）。</p>
<p>法二<br>当从数据流中读出的数的个数为奇数的时候，中位数是“前有序数组”中的最小值<br>当从数据流中读出的数的个数为偶数的时候，左中位数是“前有序数组”中的最小值，右中位数是“后有序数组”中的最大值<br>前后后序大小堆谁在前面都是可以的</p>
<p>我们只关心在中间的那两个数（或者一个数）这两个“有序数组”中的最值，<br>对除了中位数以外的其它位置的元素没有必要进行 “比较” 和 “交换” 的操作。</p>
<p>“中位数”把它们分为<br>两个部分,一部分是“前有序数组”,另一部分是“后有序数组”</p>
<p>借助 堆就的性质，通过树的形式减少了元素比较的次数。<br>每次都从堆里得到一个 “最值” 而其它元素无需排序，<br>可以将数据流保存在一个列表中，并在添加元素时 保持数组有序 。</p>
<p>建立一个 小顶堆 min_heap (am ..a3 a2 a1)和 大顶堆 B(b1 b2 b3.. bn) ，<br>am &gt; ..a3 &gt; a2 &gt; a1,a1是堆顶<br>b1 &gt; b2 &gt; b3.. &gt; bn,b1是堆顶<br>各保存列表的一半元素，且规定：</p>
<ul>
<li>小顶堆 min_heap 保存 较大 的一半，长度为 N/2（ N 为偶数）或 (N+1)/2（ N 为奇数）；</li>
<li>大顶堆 max_heap 保存 较小 的一半，长度为 N/2（ N 为偶数）或 (N-1)/2（ N 为奇数）；</li>
</ul>
<p>算法流程：<br>设元素总数为 N = m + n ，其中 m 和 n 分别为 min_heap 和 max_heap 中的元素个数。<br>规定添加元素时保证：</p>
<ol>
<li>m = n + 1 = (N + 1) / 2，N 为 奇数</li>
<li>m = n = N / 2，N 为 偶数<br>中位数可仅根据 min_heap, max_heap 的堆顶元素计算得到。<br>中位数 = a1 , m != n<br>中位数 = (a1 + b1)/2 , m = n </li>
</ol>
<p>因为它是一实时插入，也会实时计算所有数的中位数。<br>那么一个大根堆，一个小根堆肯定是一个放一次数字，交替插入。<br>至于先插入哪个队列都是可以的</p>
<p>为什么比较长度就可以判断怎么插入两个堆咧，平衡这两个堆<br>始终保持</p>
<ul>
<li>小根堆的长度-大根堆的长度 = 0 或者 1 </li>
<li>小顶堆 min_heap 保存较大一半、 大顶堆 max_heap 保存较小一半。</li>
</ul>
<p>也可以用以优化成boolean的True False或者count变量统计当前一共有几个数字，<br>若为奇数则先插入min_heap队列（max_heap队列），为偶数则先插入max_heap队列（min_heap队列）。 </p>
<p>addNum(num) 函数： 从数据流中添加一个整数到数据结构中。</p>
<ol>
<li>当 m = n（即总数量 N 为 偶数）：需向 小顶堆 min_heap 添加一个元素。<br>实现方法：将新元素 num 插入至大根堆 max_heap ，再弹出大根堆 max_heap 堆顶元素插入至 min_heap ；<br>因为 num 可能属于 “较小的一半” （即属于 max_heap ），所以不能将 nums 直接插入至 min_heap 。</li>
</ol>
<ol start="2">
<li>当 m !=n（即 N 为 奇数）说明小根堆长度-大根堆长度=1：需向大根堆 max_heap 添加一个元素。<br>实现方法：将新元素 num 插入至小根堆 min_heap ，再弹出 min_heap 堆顶元素插入至 max_heap ；</li>
</ol>
<p>findMedian() 函数：返回目前所有元素的中位数。</p>
<ol>
<li>当 m = n（ N 为 偶数）：则中位数为 ( min_heap 的堆顶元素 + max_heap 的堆顶元素)/2。</li>
<li>当 m !=n（ N 为 奇数）：则中位数为 min_heap 的堆顶元素。</li>
</ol>
<p>时间复杂度：O(5⋅logn)+O(1)≈O(logn).</p>
<ul>
<li>查找中位数 O(1)： 获取堆顶元素使用 O(1) 时间；</li>
<li>添加数字 O(logN)： 每个数据的从堆中取出最值插入和弹出操作，优先队列会自行调整，把“最优值”放入堆顶，这是使用优先队列解决这个问题的原因<br>查找元素插入位置 O(logN) （二分查找）、向数组某位置插入元素 O(N) （插入位置之后的元素都需要向后移动一位）。<br>最坏情况下，从顶部有三个堆插入和两个堆删除。每一个都需要花费 O(logn) 时间。<br>找到平均值需要持续的 O(1) 时间，因为可以直接访问堆的顶部。<br>单独的分析每个操作，addNum 和 findMedian 是只和 N 相关的，题目只是要求我们单独分析每个操作的时间复杂度。addNum 是对数复杂度， findMedian 是 O(1) 。</li>
</ul>
<p>空间复杂度 O(N)：其中 N 为数据流中的元素数量，在容器中保存输入的线性空间<br>小顶堆 min_heap 和大顶堆 max_heap 最多同时保存 N 个元素。两个堆的空间复杂度是 O(N/2)</p>
<p>Python 中 heapq 模块是小顶堆。<br>实现 大顶堆 方法：小顶堆的插入和弹出操作均将元素 取反 即可</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MedianFinder</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        initialize your data structure here.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 初始化大顶堆和小顶堆</span></span><br><span class="line">        self.min_heap = [] <span class="comment"># 小顶堆，保存较大的一半</span></span><br><span class="line">        self.max_heap = [] <span class="comment"># 大顶堆，保存较小的一半</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addNum</span>(<span class="params">self, num: int</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> len(self.min_heap) != len(self.max_heap):</span><br><span class="line">            <span class="comment"># 总数为奇数时，先加到小顶堆，再把小堆顶元素加到大顶堆</span></span><br><span class="line">            heapq.heappush(self.min_heap, num)</span><br><span class="line">            heapq.heappush(self.max_heap, -heapq.heappop(self.min_heap))</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 总数为偶数时，先加到大顶堆，再把大堆顶元素加到小顶堆 </span></span><br><span class="line">            heapq.heappush(self.max_heap, -num)</span><br><span class="line">            heapq.heappush(self.min_heap, -heapq.heappop(self.max_heap))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMedian</span>(<span class="params">self</span>) -&gt; float:</span></span><br><span class="line">        <span class="keyword">if</span> len(self.min_heap) != len(self.max_heap): </span><br><span class="line">            <span class="keyword">return</span> self.min_heap[<span class="number">0</span>] </span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 你存进B的时候，为了实现大顶堆，加了负号</span></span><br><span class="line">            <span class="keyword">return</span> (self.min_heap[<span class="number">0</span>] -self.max_heap[<span class="number">0</span>]) / <span class="number">2.0</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Your MedianFinder object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"># obj = MedianFinder()</span></span><br><span class="line"><span class="comment"># obj.addNum(num)</span></span><br><span class="line"><span class="comment"># param_2 = obj.findMedian()</span></span><br></pre></td></tr></tbody></table></figure>

<p>Push item on the heap, then pop and return the smallest item from the heap. The combined action runs more efficiently than heappush() followed by a separate call to heappop().</p>
<p>根据以上文档说明，可将 Python 代码优化为：</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MedianFinder</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        initialize your data structure here.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 初始化大顶堆和小顶堆</span></span><br><span class="line">        self.min_heap = []  <span class="comment"># 小顶堆，保存较大的一半</span></span><br><span class="line">        self.max_heap = []  <span class="comment"># 大顶堆，保存较小的一半</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addNum</span>(<span class="params">self, num: int</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> len(self.min_heap) != len(self.max_heap):</span><br><span class="line">            <span class="comment"># 先加到小顶堆，再把小堆顶元素加到大顶堆</span></span><br><span class="line">            heapq.heappush(self.max_heap, -heapq.heappushpop(self.min_heap, num))</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 先加到大顶堆，再把大堆顶元素加到小顶堆</span></span><br><span class="line">            heapq.heappush(self.min_heap, -heapq.heappushpop(self.max_heap, -num))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMedian</span>(<span class="params">self</span>) -&gt; float:</span></span><br><span class="line">        <span class="keyword">if</span> len(self.min_heap) != len(self.max_heap):</span><br><span class="line">            <span class="keyword">return</span> self.min_heap[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 你存进B的时候，为了实现大顶堆，加了负号</span></span><br><span class="line">            <span class="keyword">return</span> (self.min_heap[<span class="number">0</span>] - self.max_heap[<span class="number">0</span>]) / <span class="number">2.0</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>]</span><br><span class="line">length = <span class="number">6</span> = N 为偶数</span><br><span class="line"></span><br><span class="line">len(self.A) = <span class="number">0</span> = len(self.B)</span><br><span class="line">插入 <span class="number">5</span>，</span><br><span class="line">    A 小顶          B 大顶(负数的小顶堆)         </span><br><span class="line">                    <span class="number">-5</span>  </span><br><span class="line">    A 小顶          B 大顶(负数的小顶堆)           </span><br><span class="line">     <span class="number">5</span> </span><br><span class="line">findMedian() = A[<span class="number">0</span>] = <span class="number">5</span>    </span><br><span class="line"></span><br><span class="line">len(self.A) = <span class="number">1</span> != len(self.B) = <span class="number">0</span></span><br><span class="line">插入 <span class="number">2</span>，从存储较小 大顶 B</span><br><span class="line">    A 小顶          B 大顶(负数的小顶堆)  </span><br><span class="line">     <span class="number">2</span>               </span><br><span class="line">    /  \            </span><br><span class="line">    <span class="number">5</span>  </span><br><span class="line">    A 小顶          B 大顶(负数的小顶堆)  </span><br><span class="line">     <span class="number">5</span>               <span class="number">-2</span></span><br><span class="line">findMedian() = (<span class="number">5</span> - (<span class="number">-2</span>)) / <span class="number">2</span> = <span class="number">3.5</span></span><br><span class="line"></span><br><span class="line">len(self.A) = <span class="number">1</span> = len(self.B)</span><br><span class="line">插入 <span class="number">4</span>，从存储较大 小顶 A</span><br><span class="line">    A 小顶          B 大顶(负数的小顶堆) </span><br><span class="line">     <span class="number">5</span>               <span class="number">-4</span></span><br><span class="line">                    /  \</span><br><span class="line">                   <span class="number">-2</span></span><br><span class="line">    A 小顶          B 大顶(负数的小顶堆)                 </span><br><span class="line">     <span class="number">4</span>               <span class="number">-2</span></span><br><span class="line">    /  \            </span><br><span class="line">    <span class="number">5</span>              </span><br><span class="line">findMedian() = A[<span class="number">0</span>] = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">len(self.A) = <span class="number">2</span> != len(self.B) = <span class="number">1</span></span><br><span class="line">插入 <span class="number">3</span>，从存储较小 大顶 B</span><br><span class="line">     <span class="number">3</span>               <span class="number">-2</span></span><br><span class="line">    /  \            /  \</span><br><span class="line">    <span class="number">5</span>   <span class="number">4</span>          </span><br><span class="line">     <span class="number">4</span>               <span class="number">-3</span></span><br><span class="line">    /  \            /  \</span><br><span class="line">    <span class="number">5</span>              <span class="number">-2</span></span><br><span class="line">findMedian() (<span class="number">4</span> - (<span class="number">-3</span>)) / <span class="number">2</span> = <span class="number">3.5</span></span><br><span class="line"></span><br><span class="line">len(self.A) = <span class="number">2</span> = len(self.B)</span><br><span class="line">插入 <span class="number">1</span> &gt; <span class="number">3.5</span>，从存储较大 小顶 A</span><br><span class="line">      <span class="number">4</span>              <span class="number">-3</span></span><br><span class="line">    /  \            /  \</span><br><span class="line">    <span class="number">5</span>              <span class="number">-2</span>   <span class="number">-1</span> </span><br><span class="line">     <span class="number">3</span>               <span class="number">-2</span></span><br><span class="line">    /  \            /  \</span><br><span class="line">    <span class="number">5</span>   <span class="number">4</span>          <span class="number">-1</span></span><br><span class="line">findMedian() = A[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">len(self.A) = <span class="number">3</span> != len(self.B) = <span class="number">2</span></span><br><span class="line">插入 <span class="number">6</span> &gt; <span class="number">2.5</span>，从存储较小 大顶 B</span><br><span class="line">     <span class="number">3</span>               <span class="number">-2</span></span><br><span class="line">    /  \            /  \</span><br><span class="line">    <span class="number">5</span>   <span class="number">4</span>          <span class="number">-1</span>                     </span><br><span class="line">   /  \            /  \</span><br><span class="line">  <span class="number">6</span>              </span><br><span class="line">     <span class="number">4</span>               <span class="number">-3</span></span><br><span class="line">    /  \            /  \</span><br><span class="line">    <span class="number">5</span>   <span class="number">6</span>          <span class="number">-1</span>   <span class="number">-2</span>   </span><br><span class="line">findMedian() (<span class="number">4</span> - (<span class="number">-3</span>)) / <span class="number">2</span> = <span class="number">3.5</span> </span><br></pre></td></tr></tbody></table></figure>



<p>使用Insert()方法读取数据流，使用GetMedian()方法获取当前读取数据的中位数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 未封装版本</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.littleValueMaxHeap = []</span><br><span class="line">        self.bigValueMinHeap = []</span><br><span class="line">        self.maxHeapCount = <span class="number">0</span></span><br><span class="line">        self.minHeapCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createMaxHeap</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        self.littleValueMaxHeap.append(num)</span><br><span class="line">        tmpIndex = len(self.littleValueMaxHeap) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> tmpIndex != <span class="number">0</span>:</span><br><span class="line">            parentIndex = (tmpIndex - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>  <span class="comment"># 任意节点的父节点</span></span><br><span class="line">            <span class="keyword">if</span> self.littleValueMaxHeap[parentIndex] &lt; self.littleValueMaxHeap[tmpIndex]:</span><br><span class="line">                self.littleValueMaxHeap[parentIndex], self.littleValueMaxHeap[tmpIndex] = self.littleValueMaxHeap[tmpIndex], self.littleValueMaxHeap[parentIndex]</span><br><span class="line">                tmpIndex = parentIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">adjustMaxHeap</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        <span class="keyword">if</span> num &lt; self.littleValueMaxHeap[<span class="number">0</span>]:</span><br><span class="line">            self.littleValueMaxHeap[<span class="number">0</span>] = num</span><br><span class="line">        maxHeapLen = len(self.littleValueMaxHeap)</span><br><span class="line">        tmpIndex = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> tmpIndex &lt; maxHeapLen:</span><br><span class="line">            leftIndex = tmpIndex * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">            rightIndex = tmpIndex *<span class="number">2</span> + <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> rightIndex &lt; maxHeapLen:</span><br><span class="line">                largerIndex = rightIndex <span class="keyword">if</span> self.littleValueMaxHeap[leftIndex] &lt; self.littleValueMaxHeap[rightIndex] <span class="keyword">else</span> leftIndex</span><br><span class="line">            <span class="keyword">elif</span> leftIndex &lt; maxHeapLen:</span><br><span class="line">                largerIndex = leftIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> self.littleValueMaxHeap[tmpIndex] &lt; self.littleValueMaxHeap[largerIndex]:</span><br><span class="line">                self.littleValueMaxHeap[tmpIndex], self.littleValueMaxHeap[largerIndex] = self.littleValueMaxHeap[largerIndex], self.littleValueMaxHeap[tmpIndex]</span><br><span class="line">                tmpIndex = largerIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createMinHeap</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        self.bigValueMinHeap.append(num)</span><br><span class="line">        tmpIndex = len(self.bigValueMinHeap) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> tmpIndex != <span class="number">0</span>:</span><br><span class="line">            parentIndex = (tmpIndex - <span class="number">1</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.bigValueMinHeap[tmpIndex] &lt; self.bigValueMinHeap[parentIndex]:</span><br><span class="line">                self.bigValueMinHeap[parentIndex], self.bigValueMinHeap[tmpIndex] = self.bigValueMinHeap[tmpIndex], self.bigValueMinHeap[parentIndex]</span><br><span class="line">                tmpIndex = parentIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">adjustMinHeap</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        <span class="keyword">if</span> num &lt; self.bigValueMinHeap[<span class="number">0</span>]:</span><br><span class="line">            self.littleValueMaxHeap[<span class="number">0</span>] = num</span><br><span class="line">        minHeapLen = len(self.bigValueMinHeap)</span><br><span class="line">        tmpIndex = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> tmpIndex &lt; minHeapLen:</span><br><span class="line">            leftIndex = tmpIndex * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">            rightIndex = tmpIndex *<span class="number">2</span> + <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> rightIndex &lt; minHeapLen:</span><br><span class="line">                smallerIndex = rightIndex <span class="keyword">if</span> self.bigValueMinHeap[rightIndex] &lt; self.bigValueMinHeap[leftIndex] <span class="keyword">else</span> leftIndex</span><br><span class="line">            <span class="keyword">elif</span> leftIndex &lt; minHeapLen:</span><br><span class="line">                smallerIndex = leftIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> self.bigValueMinHeap[smallerIndex] &lt; self.bigValueMinHeap[tmpIndex]:</span><br><span class="line">                self.bigValueMinHeap[tmpIndex], self.bigValueMinHeap[smallerIndex] = self.bigValueMinHeap[smallerIndex], self.bigValueMinHeap[tmpIndex]</span><br><span class="line">                tmpIndex = smallerIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Insert</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.minHeapCount &lt; self.maxHeapCount:</span><br><span class="line">            self.minHeapCount += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> num &lt; self.littleValueMaxHeap[<span class="number">0</span>]:</span><br><span class="line">                tmpNum = self.littleValueMaxHeap[<span class="number">0</span>]</span><br><span class="line">                self.adjustMaxHeap(num)</span><br><span class="line">                self.createMinHeap(tmpNum)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.createMinHeap(num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.maxHeapCount += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.littleValueMaxHeap == []:</span><br><span class="line">                self.createMaxHeap(num)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> self.bigValueMinHeap[<span class="number">0</span>] &lt; num:</span><br><span class="line">                    tmpNum = self.bigValueMinHeap[<span class="number">0</span>]</span><br><span class="line">                    self.adjustMinHeap(num)</span><br><span class="line">                    self.createMaxHeap(tmpNum)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.createMaxHeap(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetMedian</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.minHeapCount &lt; self.maxHeapCount:</span><br><span class="line">            <span class="keyword">return</span> self.littleValueMaxHeap[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (self.bigValueMinHeap[<span class="number">0</span>] + self.littleValueMaxHeap[<span class="number">0</span>]) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装版本</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.littleValueMaxHeap = []</span><br><span class="line">        self.bigValueMinHeap = []</span><br><span class="line">        self.maxHeapCount = <span class="number">0</span></span><br><span class="line">        self.minHeapCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createHeap</span>(<span class="params">self, num, heap, cmpFunc</span>):</span></span><br><span class="line">        heap.append(num)</span><br><span class="line">        tmpIndex = len(heap) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> tmpIndex != <span class="number">0</span>:</span><br><span class="line">            parentIndex = (tmpIndex - <span class="number">1</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> cmpFunc(heap[tmpIndex], heap[parentIndex]):</span><br><span class="line">                heap[parentIndex], heap[tmpIndex] = heap[tmpIndex], heap[parentIndex]</span><br><span class="line">                tmpIndex = parentIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">adjustHeap</span>(<span class="params">self, num, heap, cmpFunc</span>):</span></span><br><span class="line">        <span class="keyword">if</span> num &lt; heap[<span class="number">0</span>]:</span><br><span class="line">            heap[<span class="number">0</span>] = num</span><br><span class="line">        heapLen = len(heap)</span><br><span class="line">        tmpIndex = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> tmpIndex &lt; heapLen:</span><br><span class="line">            leftIndex = tmpIndex * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">            rightIndex = tmpIndex *<span class="number">2</span> + <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> rightIndex &lt; heapLen:</span><br><span class="line">                largerIndex = rightIndex <span class="keyword">if</span> cmpFunc(heap[rightIndex], heap[leftIndex]) <span class="keyword">else</span> leftIndex</span><br><span class="line">            <span class="keyword">elif</span> leftIndex &lt; heapLen:</span><br><span class="line">                largerIndex = leftIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> cmpFunc(heap[largerIndex], heap[tmpIndex]):</span><br><span class="line">                heap[tmpIndex], heap[largerIndex] = heap[largerIndex], heap[tmpIndex]</span><br><span class="line">                tmpIndex = largerIndex</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Insert</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">cmpMaxHeap</span>(<span class="params">a, b</span>):</span></span><br><span class="line">            <span class="keyword">return</span> b &lt; a</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">cmpMinHeap</span>(<span class="params">a, b</span>):</span></span><br><span class="line">            <span class="keyword">return</span> a &lt; b</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.minHeapCount &lt; self.maxHeapCount:</span><br><span class="line">            self.minHeapCount += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> num &lt; self.littleValueMaxHeap[<span class="number">0</span>]:</span><br><span class="line">                tmpNum = self.littleValueMaxHeap[<span class="number">0</span>]</span><br><span class="line">                self.adjustHeap(num, self.littleValueMaxHeap, cmpMaxHeap)</span><br><span class="line">                self.createHeap(tmpNum, self.bigValueMinHeap, cmpMinHeap)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.createHeap(num, self.bigValueMinHeap, cmpMinHeap)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.maxHeapCount += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.littleValueMaxHeap == []:</span><br><span class="line">                self.createHeap(num, self.littleValueMaxHeap, cmpMaxHeap)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> self.bigValueMinHeap[<span class="number">0</span>] &lt; num:</span><br><span class="line">                    tmpNum = self.bigValueMinHeap[<span class="number">0</span>]</span><br><span class="line">                    self.adjustHeap(num, self.bigValueMinHeap, cmpMinHeap)</span><br><span class="line">                    self.createHeap(tmpNum, self.littleValueMaxHeap, cmpMaxHeap)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.createHeap(num, self.littleValueMaxHeap, cmpMaxHeap)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetMedian</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.minHeapCount &lt; self.maxHeapCount:</span><br><span class="line">            <span class="keyword">return</span> self.littleValueMaxHeap[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (self.bigValueMinHeap[<span class="number">0</span>] + self.littleValueMaxHeap[<span class="number">0</span>]) / <span class="number">2</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Solution()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">8</span>]:</span><br><span class="line">        s.Insert(i)</span><br><span class="line">        print(s.GetMedian())</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heap_sort</span>(<span class="params">nums</span>):</span></span><br><span class="line">    <span class="comment"># 调整堆</span></span><br><span class="line">    <span class="comment"># 迭代写法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">adjust_heap</span>(<span class="params">nums, startpos, endpos</span>):</span></span><br><span class="line">        newitem = nums[startpos]</span><br><span class="line">        pos = startpos</span><br><span class="line">        childpos = pos * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> childpos &lt; endpos:</span><br><span class="line">            rightpos = childpos + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> rightpos &lt; endpos <span class="keyword">and</span> nums[rightpos] &gt;= nums[childpos]:</span><br><span class="line">                childpos = rightpos</span><br><span class="line">            <span class="keyword">if</span> newitem &lt; nums[childpos]:</span><br><span class="line">                nums[pos] = nums[childpos]</span><br><span class="line">                pos = childpos</span><br><span class="line">                childpos = pos * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        nums[pos] = newitem</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 递归写法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">adjust_heap</span>(<span class="params">nums, startpos, endpos</span>):</span></span><br><span class="line">        pos = startpos</span><br><span class="line">        chilidpos = pos * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> chilidpos &lt; endpos:</span><br><span class="line">            rightpos = chilidpos + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> rightpos &lt; endpos <span class="keyword">and</span> nums[rightpos] &gt; nums[chilidpos]:</span><br><span class="line">                chilidpos = rightpos</span><br><span class="line">            <span class="keyword">if</span> nums[chilidpos] &gt; nums[pos]:</span><br><span class="line">                nums[pos], nums[chilidpos] = nums[chilidpos], nums[pos]</span><br><span class="line">                adjust_heap(nums, pos, endpos)</span><br><span class="line"></span><br><span class="line">    n = len(nums)</span><br><span class="line">    <span class="comment"># 建堆</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(n // <span class="number">2</span>)):</span><br><span class="line">        adjust_heap(nums, i, n)</span><br><span class="line">    <span class="comment"># 调整堆</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        nums[<span class="number">0</span>], nums[i] = nums[i], nums[<span class="number">0</span>]</span><br><span class="line">        adjust_heap(nums, <span class="number">0</span>, i)</span><br><span class="line">    <span class="keyword">return</span> nums</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Leetcode/" rel="tag"># Leetcode</a>
              <a href="/tags/%E5%89%91%E6%8C%87offer/" rel="tag"># 剑指offer</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/08/21/liu-da-ji-ben-pai-xu/" rel="prev" title="六大基本排序">
                  <i class="fa fa-chevron-left"></i> 六大基本排序
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/" rel="next" title="旅游网景点详细页面">
                  旅游网景点详细页面 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
