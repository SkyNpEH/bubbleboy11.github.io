<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"bubbleboy11.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="旅游网景点详细页面Vue.js 面向组件方式编程 单页面应用  如何在Vue项目中实现“多页面”VueRouter用来在单页面应用中实现“多页面”通过url的规则进行匹配，满足url规则1，展示组件1的内容满足url规则2，展示组件2的内容满足url规则3，展示组件3的内容 Vue中的路由管理 Vue Router是Vue.js官方的路由管理器  新建项目   &#96;bash   cd C:&#x2F;Vuen">
<meta property="og:type" content="article">
<meta property="og:title" content="旅游网景点详细页面">
<meta property="og:url" content="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/index.html">
<meta property="og:site_name" content="外心人D的博客">
<meta property="og:description" content="旅游网景点详细页面Vue.js 面向组件方式编程 单页面应用  如何在Vue项目中实现“多页面”VueRouter用来在单页面应用中实现“多页面”通过url的规则进行匹配，满足url规则1，展示组件1的内容满足url规则2，展示组件2的内容满足url规则3，展示组件3的内容 Vue中的路由管理 Vue Router是Vue.js官方的路由管理器  新建项目   &#96;bash   cd C:&#x2F;Vuen">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-08-20T16:21:41.000Z">
<meta property="article:modified_time" content="2021-06-17T02:45:17.436Z">
<meta property="article:author" content="外心人D">
<meta property="article:tag" content="剑指offer">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://bubbleboy11.github.io/2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/","path":"2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/","title":"旅游网景点详细页面"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>旅游网景点详细页面 | 外心人D的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="外心人D的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外心人D的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%85%E6%B8%B8%E7%BD%91%E6%99%AF%E7%82%B9%E8%AF%A6%E7%BB%86%E9%A1%B5%E9%9D%A2"><span class="nav-text">旅游网景点详细页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue-js"><span class="nav-text">Vue.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue%E4%B8%AD%E7%9A%84%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86"><span class="nav-text">Vue中的路由管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">路由的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue-js%E4%B8%AD%E7%9A%84%E8%B7%AF%E7%94%B1%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="nav-text">Vue.js中的路由中的参数传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D"><span class="nav-text">动态路由匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E8%B7%B3%E8%BD%AC"><span class="nav-text">路由的跳转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E8%B7%B3%E8%BD%AC%E6%96%B9%E5%BC%8F"><span class="nav-text">路由的跳转方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E6%90%9C%E7%B4%A2%E9%A1%B5%E9%9D%A2"><span class="nav-text">景点搜索页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E5%A4%A7%E5%9B%BE%E9%83%A8%E5%88%86"><span class="nav-text">景点大图部分</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%84%E5%88%86%E3%80%81%E6%99%AF%E7%82%B9%E4%BB%8B%E7%BB%8D"><span class="nav-text">评分、景点介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-1"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E5%9D%80%E4%BF%A1%E6%81%AF"><span class="nav-text">地址信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-2"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%A8%E7%A5%A8%E5%88%97%E8%A1%A8"><span class="nav-text">门票列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-3"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E8%AF%84%E4%BB%B7%E5%88%97%E8%A1%A8"><span class="nav-text">用户评价列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-4"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ORM%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="nav-text">ORM模型设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E8%AF%A6%E6%83%85%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="nav-text">景点详情接口开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4"><span class="nav-text">开发步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="nav-text">景点评论列表接口开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4-1"><span class="nav-text">开发步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%A8%E7%A5%A8%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="nav-text">门票列表接口开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4-2"><span class="nav-text">开发步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E4%BB%8B%E7%BB%8D%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="nav-text">景点介绍接口开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4-3"><span class="nav-text">开发步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E6%90%9C%E7%B4%A2%E6%8E%A5%E5%8F%A3%E8%81%94%E8%B0%83"><span class="nav-text">景点搜索接口联调</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-5"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E8%AF%A6%E6%83%85%E5%92%8C%E8%AF%84%E8%AE%BA%E6%8E%A5%E5%8F%A3%E8%81%94%E8%B0%83"><span class="nav-text">景点详情和评论接口联调</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-6"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AF%E7%82%B9%E8%AF%84%E8%AE%BA%E6%8E%A5%E5%8F%A3%E8%81%94%E8%B0%83"><span class="nav-text">景点评论接口联调</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-7"><span class="nav-text">实现步骤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="nav-text">前端代码优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3"><span class="nav-text">实现图片列表接口</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">外心人D</p>
  <div class="site-description" itemprop="description">本博客大多内容为慕课和网上博客，并非原创</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">341</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bubbleboy11.github.io/2020/08/21/lu-you-wang-jing-dian-xiang-xi-ye-mian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="外心人D">
      <meta itemprop="description" content="本博客大多内容为慕课和网上博客，并非原创">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外心人D的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          旅游网景点详细页面
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:21:41" itemprop="dateCreated datePublished" datetime="2020-08-20T16:21:41Z">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-17 02:45:17" itemprop="dateModified" datetime="2021-06-17T02:45:17Z">2021-06-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%97%85%E6%B8%B8%E7%BD%91%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">旅游网项目</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="旅游网景点详细页面"><a href="#旅游网景点详细页面" class="headerlink" title="旅游网景点详细页面"></a>旅游网景点详细页面</h1><h3 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h3><ul>
<li>面向组件方式编程</li>
<li>单页面应用</li>
</ul>
<p>如何在Vue项目中实现“多页面”<br>VueRouter用来在单页面应用中实现“多页面”<br>通过url的规则进行匹配，<br>满足url规则1，展示组件1的内容<br>满足url规则2，展示组件2的内容<br>满足url规则3，展示组件3的内容</p>
<h3 id="Vue中的路由管理"><a href="#Vue中的路由管理" class="headerlink" title="Vue中的路由管理"></a>Vue中的路由管理</h3><ul>
<li><p>Vue Router是Vue.js官方的路由管理器</p>
</li>
<li><p>新建项目</p>
</li>
</ul>
<p>`bash</p>
<blockquote>
<blockquote>
<p>cd C:/Vue<br>npm create test<br>`</p>
</blockquote>
</blockquote>
<ul>
<li>安装<br>`bash<blockquote>
<blockquote>
<p>cnpm install vue-router -S<br>`</p>
</blockquote>
</blockquote>
</li>
</ul>
<h3 id="路由的使用"><a href="#路由的使用" class="headerlink" title="路由的使用"></a>路由的使用</h3><ul>
<li>新建<code>/src/router.js</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="comment">// VueRouter是Vue.js的一个插件</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line">Vue.use(VueRouter)  <span class="comment">// 使用这个插件</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>设置路由规则<br><code>/src/router.js</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 页面1 匹配指定规则，匹配/home在对应的组件中显示首页的内容</span></span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/home'</span>, <span class="attr">component</span>: HomePage, <span class="attr">name</span>: <span class="string">'home'</span>},</span><br><span class="line">  <span class="comment">// 页面2</span></span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/about'</span>, <span class="attr">component</span>: AboutPage}</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>配置路由规则<br><code>/src/router.js</code><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter({</span><br><span class="line">  routes <span class="comment">// (缩写) 相当于 routes: routes</span></span><br><span class="line">})</span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  router</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p><code>/src/router.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> route</span><br></pre></td></tr></tbody></table></figure>

<p><code>/src/main.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  <span class="comment">// router: router,</span></span><br><span class="line">  router,</span><br><span class="line">}).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>设置路由切换后页面的显示位置<br>在模板中指定路由切换后组件的渲染位置<br><code>&lt;router-view&gt;&lt;/router-view&gt;</code><br><code>/src/App.vue&gt;</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;!-- 路由变化之后，在这里显示组件的内容 --&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>在模板中实现路由跳转 转换成html的a标签<br><code>&lt;router-link to="/about"&gt;&lt;/router-link&gt;</code><br><code>to</code>的跳转地址就是<code>router.js</code>中的<code>path</code>值<br><code>/src/App.vue&gt;</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;router-link to="/home"&gt;首页&lt;/router-link&gt; | </span><br><span class="line">    &lt;router-link to="/about"&gt;关于&lt;/router-link&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="Vue-js中的路由中的参数传递"><a href="#Vue-js中的路由中的参数传递" class="headerlink" title="Vue.js中的路由中的参数传递"></a>Vue.js中的路由中的参数传递</h3><p>景点详情的路由如何设计？</p>
<ul>
<li><p>get参数通过问号<br><code>/detail?id=1</code><br><code>/detail?id=2</code><br><code>/detail?id=3</code></p>
</li>
<li><p>django里的url设计原则<br><code>/detail/1</code><br><code>/detail/2</code><br><code>/detail/3</code></p>
</li>
</ul>
<h3 id="动态路由匹配"><a href="#动态路由匹配" class="headerlink" title="动态路由匹配"></a>动态路由匹配</h3><ul>
<li>设置动态匹配规则<ul>
<li>动态路由参数<br><code>/src/router.js</code></li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DetailPage <span class="keyword">from</span> <span class="string">'./views/Detail.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter({</span><br><span class="line">  routes: [</span><br><span class="line">    <span class="comment">// http://localhost:8080/#/detail/1234/type1?name=ashe&amp;sort=asc</span></span><br><span class="line">    {<span class="attr">path</span>: <span class="string">'/d/:id/:types'</span>, <span class="attr">component</span>: DetailPage}</span><br><span class="line">    ]</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>等同于</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://localhost:8080/#/detail/1234/type1?name=ashe&amp;sort=asc</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/d/:id/:types'</span>, <span class="attr">component</span>: DetailPage}</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> route = <span class="keyword">new</span> VueRouter({</span><br><span class="line">  <span class="comment">// routes: routes</span></span><br><span class="line">  routes <span class="comment">// (缩写) 相当于 routes: routes</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p><code>App.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: '',</span><br><span class="line">      name: '',</span><br><span class="line">      type: ''</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;    </span><br></pre></td></tr></tbody></table></figure>

<p>新建<code>/test/src/views/Detail.vue</code></p>
<ul>
<li><p>在组件中获取匹配参数和查询</p>
<ul>
<li><p>在JS中获取参数<br><code>$route </code> 获取当前路由<br><code>Detial.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  created () {</span><br><span class="line">    let id = this.$route.params.id</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>响应参数的变化<br><code>Detial.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  watch: {</span><br><span class="line">    $route(to, from) {</span><br><span class="line">      // 对路由变化作出响应...</span><br><span class="line">      console.log('to:', to)</span><br><span class="line">      console.log('from:', from)</span><br><span class="line">      this.id = this.$route.params.id</span><br><span class="line">    },</span><br><span class="line">    id (to, from) {</span><br><span class="line">      console.log('to-id:', to)</span><br><span class="line">      console.log('from-id:', from)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
<li><p>URL中的查询参数<br><code>/sight/list?name=ashe</code></p>
</li>
<li><p>获取方式<br><code>Detail.vue</code></p>
</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;详情页：{{ id }} : {{ name }} : {{ type }}&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  created () {</span><br><span class="line">    let name = this.$route.query.name</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="路由的跳转"><a href="#路由的跳转" class="headerlink" title="路由的跳转"></a>路由的跳转</h3><ul>
<li><p>在模板中标签跳转 router-link<br><code>App.vue</code><br>`vue</p>
<template>
<div id="app">
  <router-link to="/d/123/type1">详情1</router-link>|
  <!-- <HelloWorld msg="Welcome to Your Vue.js App"/> -->
  <!-- 路由变化之后，在这里显示组件的内容 -->
  <router-view></router-view>
</div>
</template>
`
在浏览器点击点我回到详情1跳转
`http://localhost:8080/#/d/123/type1`
</li>
<li><p>路由命名 方便URL修改<br><code>rounter.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DetailPage <span class="keyword">from</span> <span class="string">'./views/Detail.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义路由规则</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/home'</span>, <span class="attr">component</span>: HomePage, <span class="attr">name</span>: <span class="string">'home'</span>},</span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/about'</span>, <span class="attr">component</span>: AboutPage},</span><br><span class="line">  <span class="comment">// http://localhost:8080/#/detail/1234/type1?name=ashe&amp;sort=asc</span></span><br><span class="line">  {<span class="attr">path</span>: <span class="string">'/d/:id/:types'</span>, <span class="attr">component</span>: DetailPage, <span class="attr">name</span>: <span class="string">'detail-page'</span>}</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>按照名称跳转<br>`vue</p>
<template>
<div id="app">
  <router-link :to="&quot;/d/&quot; + id + &quot;/&quot; + types">详情2</router-link>|
  <router-link :to="{path: &quot;/d/&quot; + id + &quot;/&quot; + types, query: {name: &quot;abc&quot;, sort: &quot;desc&quot;}}">详情3</router-link>|
  <router-link :to="{name: &quot;detail-page&quot;, params: {id: &quot;abc123&quot;, types: &quot;type3&quot;}, query: {name: &quot;abc&quot;, sort: &quot;desc&quot;}}">详情4</router-link>|
  <router-view></router-view>
</div>
</template>

</li>
</ul>
<script>
// import HelloWorld from './components/HelloWorld.vue'

export default {
  name: 'App',
  data () {
    return {
      id: 456,
      types: 'type2'
    }
  }
}
</script>
<figure class="highlight autohotkey"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">在浏览器点击点我回到详情<span class="number">2</span>跳转</span><br><span class="line">`http://localhost:<span class="number">8080</span>/#/d/<span class="number">456</span>/type2`</span><br><span class="line">在浏览器点击点我回到详情<span class="number">3</span>跳转</span><br><span class="line">`http://localhost:<span class="number">8080</span>/#/d/<span class="number">456</span>/type2?name=abc&amp;sort=desc`</span><br><span class="line">在浏览器点击点我回到详情<span class="number">4</span>跳转</span><br><span class="line">`http://localhost:<span class="number">8080</span>/#/d/abc123/type3?name=abc&amp;sort=desc`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 在JS中事件跳转</span><br><span class="line">`this`vue的实例，在`main.js`通过`new vue`得到的实例</span><br><span class="line">&gt;传参是 `router`，接收参数是 `route`</span><br><span class="line">`$router`表示vue实例上所挂载的在`main.js`的`new vue`中的`router`这个对象，</span><br><span class="line">跳转到不同的url，但这个方法会向history栈添加一个记录，点击后退会返回到上一个页面。</span><br><span class="line"></span><br><span class="line">`App.vue`</span><br><span class="line">```vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &lt;-- 字符串 --&gt;</span><br><span class="line">    this.$router.push('/home')  </span><br><span class="line">    &lt;-- 对象 --&gt;</span><br><span class="line"><span class="title">    this.$router.push({path:</span>'/home'})</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>③ query 传参，相当于get请求，页面跳转时参数会在地址栏中显示，通过this.$route.query.id获取</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变成 /user?id=2</span></span><br><span class="line"><span class="built_in">this</span>.$router.push({ </span><br><span class="line">    path:<span class="string">'/user'</span>,</span><br><span class="line">    query:{</span><br><span class="line">        id:<span class="built_in">this</span>.id</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>④ params 传参，相当于post请求，页面跳转时参数不会在地址栏中显示,通过this.$route.params.id获取</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$router.push({ </span><br><span class="line">    path:<span class="string">'/user'</span>,</span><br><span class="line">    params:{</span><br><span class="line">        id:<span class="built_in">this</span>.id</span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id="app"&gt;</span><br><span class="line">    &lt;a href="javascript:;" @click="goHome"&gt;点我跳转&lt;/a&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  name: 'App',</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: 456,</span><br><span class="line">      types: 'type2'</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goHome () {</span><br><span class="line">      this.$router.push('/home')</span><br><span class="line">      // this.$router.push({name: 'home'})</span><br><span class="line">      // this.$router.push({name: "detail-page", params: {id: "abc123", types: "type3"}, query: {name: "abc", sort: "desc"}})</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在浏览器点击点我回到首页跳转<br><code>http://localhost:8080/#/home</code></p>
<h3 id="路由的跳转方式"><a href="#路由的跳转方式" class="headerlink" title="路由的跳转方式"></a>路由的跳转方式</h3><ul>
<li>页面跳转</li>
</ul>
<p><code>this.$router.push(location, onComplete?, onAbort?)</code></p>
<ul>
<li>页面前进或后退<br><code>this.$router.go(n)</code><br>n可为正数可为负数。正数返回上一个页面。<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在浏览器记录中前进1步，相当于history.forward()</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后退一步记录，等同于history.back()</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前进三步记录</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果history记录不够用，就会失败</span></span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">this</span>.$router.go(<span class="number">-100</span>)</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>`vue<br><template><br>  <div id="app"><br>    &lt;a href=”javascript:;” @click=”goBack”&gt;点我跳转<br>  </div><br></template></p>
<script>
export default {
  name: 'App',
  data () {
    return {
      id: 456,
      types: 'type2'
    }
  },
  methods: {
    goBack () {
      this.$router.go(-1)
    }
  }
}
</script>
<figure class="highlight xquery"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 替换浏览历史记录</span><br><span class="line">同样是跳转到指定的url，但是这个方法不会向history里面添加新的记录，点击返回，会跳转到上上一个页面。上一个记录是不存在的。</span><br><span class="line">场景是用户登录了后退，支付成功后退，不能回到原来的页面</span><br><span class="line"></span><br><span class="line">`this.<span class="variable">$router</span><span class="built_in">.replace</span>(location, onComplete?, onAbort?)`</span><br><span class="line">```vue</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">export default </span><span class="xquery">{</span></span><br><span class="line"><span class="xquery"> <span class="built_in"> name</span>: <span class="string">'App'</span>,</span></span><br><span class="line"><span class="xquery">  data () {</span></span><br><span class="line"><span class="xquery">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="xquery">     <span class="built_in"> id</span>: <span class="number">456</span>,</span></span><br><span class="line"><span class="xquery">      types: <span class="string">'type2'</span></span></span><br><span class="line"><span class="xquery">    }</span></span><br><span class="line"><span class="xml">  },</span></span><br><span class="line"><span class="xml">  methods: </span><span class="xquery">{</span></span><br><span class="line"><span class="xquery">    goHome () {</span></span><br><span class="line"><span class="xquery">      this.<span class="variable">$router</span><span class="built_in">.replace</span>(<span class="built_in">{name</span>: <span class="string">'home'</span>}</span><span class="xml">)</span></span><br><span class="line"><span class="xml">    }</span></span><br><span class="line"><span class="xml">  }</span></span><br><span class="line"><span class="xml">}</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="景点搜索页面"><a href="#景点搜索页面" class="headerlink" title="景点搜索页面"></a>景点搜索页面</h3><p>实现步骤</p>
<ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分</li>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<p>使用Vant中可用的组件<br>复用景点列表组件<br>结合VueRouter实现页面跳转</p>
<p>新建<code>/src/views/Search.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 搜索页面 --&gt;</span><br><span class="line">  &lt;div class="page-search"&gt;</span><br><span class="line">    &lt;!-- 标题 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="搜索景点"</span><br><span class="line">      left-text="返回"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"</span><br><span class="line">      v-if="isHome"/&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;van-search</span><br><span class="line">      v-model="sightName"</span><br><span class="line">      show-action</span><br><span class="line">      label="景点"</span><br><span class="line">      placeholder="请输入搜索关键词"</span><br><span class="line">      @search="onSearch"</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;div @click="onSearch"&gt;搜索&lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line">    &lt;!-- 景点列表 --&gt;</span><br><span class="line">    &lt;div class="sight-list"&gt;</span><br><span class="line">      &lt;sight-item v-for="item in dataList"</span><br><span class="line">        :key="item.id"</span><br><span class="line">        :item="item"/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 分页 --&gt;</span><br><span class="line">    &lt;van-pagination v-model="currentPage"</span><br><span class="line">    :total-items="totalItems"</span><br><span class="line">    :items-per-page="perPage" /&gt;</span><br><span class="line">    &lt;!-- 底部导航 --&gt;</span><br><span class="line">    &lt;TripFooter/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 景点列表的每一项</span><br><span class="line">import SightItem from '@/components/common/ListSight'</span><br><span class="line">// 底部导航</span><br><span class="line">import TripFooter from '@/components/common/Footer'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 景点名称</span><br><span class="line">      sightName: '',</span><br><span class="line">      // 景点列表的数据</span><br><span class="line">      dataList: [],</span><br><span class="line">      // 总记录数</span><br><span class="line">      totalItems: 0,</span><br><span class="line">      // 当前的页码</span><br><span class="line">      currentPage: 1,</span><br><span class="line">      // 每页数据的大小</span><br><span class="line">      perPage: 5</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    SightItem,</span><br><span class="line">    TripFooter</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    onSearch () {</span><br><span class="line">      console.log('onSearch ')</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>/src/router/index.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">'../views/Search.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/search'</span>,</span><br><span class="line">    name: <span class="string">'Search'</span>,</span><br><span class="line">    component: Search</span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>点击底部导航跳转到搜索<br><code>/src/components/common/Footer.vue</code><br>`vue<br><template><br>  <!-- 底部导航（公共组件） --><br>  <div><br>    <!-- 开启路由模式，默认为false --><br>    <van-tabbar v-model="active" route><br>      <van-tabbar-item name="home" icon="wap-home-o" :to="{name: 'Home'}">首页</van-tabbar-item><br>      <van-tabbar-item name="search" icon="search" :to="{name: 'Search'}">搜索</van-tabbar-item><br>  </van-tabbar></div><br></template></p>
<figure class="highlight clean"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 搭建前端详情页</span><br><span class="line">#### 实现步骤</span><br><span class="line">- 设计URL路由规则</span><br><span class="line">`/src/router/index.js`</span><br><span class="line">```js</span><br><span class="line"><span class="keyword">import</span> SightList <span class="keyword">from</span> <span class="string">'../views/sight/SightList.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightDetail <span class="keyword">from</span> <span class="string">'../views/sight/SightDetail.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightInfo <span class="keyword">from</span> <span class="string">'../views/sight/SightInfo.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightComment <span class="keyword">from</span> <span class="string">'../views/sight/SightComment.vue'</span></span><br><span class="line"><span class="keyword">import</span> SightImage <span class="keyword">from</span> <span class="string">'../views/sight/SightImage.vue'</span></span><br><span class="line"></span><br><span class="line">const routes = [</span><br><span class="line">  <span class="comment">// 景点列表</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/list'</span>,</span><br><span class="line">    name: <span class="string">'SightList'</span>,</span><br><span class="line">    component: SightList</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 景点详情</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/detail/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightDetail'</span>,</span><br><span class="line">    component: SightDetail</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 景点介绍</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/info/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightInfo'</span>,</span><br><span class="line">    component: SightInfo</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 评论列表</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/comment/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightComment'</span>,</span><br><span class="line">    component: SightComment</span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// 景点下的图片</span></span><br><span class="line">  {</span><br><span class="line">    path: <span class="string">'/sight/image/:id'</span>,</span><br><span class="line">    name: <span class="string">'SightImage'</span>,</span><br><span class="line">    component: SightImage</span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>新建详情页页面</p>
<ul>
<li><p>新建目录<code>/src/views/sight</code></p>
</li>
<li><p>新建<code>/src/views/sight/SightList.vue</code><br>``vue</p>
<template>
<!-- 景点列表 -->
<div class="page-sight-list"></div>
</template>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 新建`/src/views/sight/SightDetail.vue`</span><br><span class="line">```vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>新建<code>/src/views/sight/SightInfo.vue</code><br>`vue</p>
<template>
<!-- 景点介绍 -->
<div class="page-sight-info"></div>
</template>
`
</li>
<li><p>新建<code>/src/views/sight/SightComment.vue</code><br>`vue</p>
<template>
<!-- 景点评论 -->
<div class="page-sight-comment"></div>
</template>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  - 新建`/src/views/sight/SightImage.vue`</span><br><span class="line">```vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点图片 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-image"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
<li><p>修改景点列表组件，支持路由跳转<br>从景点列表跳到景点详情<br><code>/src/components/common/ListSight.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;router-link class="sight-item"</span><br><span class="line">    :to="{name: 'SightDetail', params: {id: item.id}}"&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/router-link&gt;</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<p>从标题热门景点和更多跳到景点列表<br>从热门景点的地点跳到对应景点详情<br><code>/src/components/home/Hot.vue</code><br>`vue<br><template><br>  <!-- 热门景点 --><br>  <div class="home-hot-box"><br>    <!-- 顶上导航 --><br>    <van-cell :to="{name: 'SightList', query: {name: '热门推荐'}}"><br>    <!-- // 顶上导航 --><br>    <!-- 景点列表 --><br>    <div class="box-main"><br>      <router-link class="hot-item" :to="{name: 'SightDetail', params: {id: item.id}}"><br>        <div class="img"><br>      <br>    </div><br>    <!-- //景点列表 --><br>  </router-link></div><br></van-cell></div></template></p>
<figure class="highlight xquery"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">从标题精选景点和更多跳到景点列表</span><br><span class="line">从精选景点的地点跳到对应景点列表</span><br><span class="line">`/src/components/home/Fine.vue`</span><br><span class="line">```vue</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!-- 精选景点 --&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home-fine-box"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 顶上导航 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">van-cell</span></span></span></span><br><span class="line"><span class="xml">      title="精选景点"</span></span><br><span class="line"><span class="xml">      :to="</span><span class="xquery"><span class="built_in">{name</span>: <span class="string">'SightList'</span>, query: <span class="built_in">{name</span>: <span class="string">'精选景点'</span>}</span><span class="xml">}"/&gt;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- // 顶上导航 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 景点的列表 --&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-main"</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">sight-item</span> <span class="attr">v-for</span>=<span class="string">"item in dataList"</span></span></span></span><br><span class="line"><span class="xml">        :key="item.id"</span></span><br><span class="line"><span class="xml">        :item="item"/&gt;</span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 不需要:to --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- //景点的列表 --&gt;</span>    </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">`</span></span><br><span class="line"></span><br><span class="line"><span class="xml">- 拆分详情页组件</span></span><br><span class="line"><span class="xml">`/src/views/sight/SightDetail.vue`</span></span><br><span class="line"><span class="xml">```vue</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 页面头部 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span></span><br><span class="line"><span class="xml">    left-text="返回"</span></span><br><span class="line"><span class="xml">    left-arrow</span></span><br><span class="line"><span class="xml">    fixed</span></span><br><span class="line"><span class="xml">    @click-left="goBack"</span></span><br><span class="line"><span class="xml">  /&gt;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 大图 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- //大图 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 评分、景点介绍 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- //评分、景点介绍 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 地址信息 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- //地址信息 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 门票列表 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- //门票列表 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 用户评价 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- //用户评价 --&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">export default </span><span class="xquery">{</span></span><br><span class="line"><span class="xquery">  methods: {</span></span><br><span class="line"><span class="xquery">    goBack () {</span></span><br><span class="line"><span class="xquery">      this.<span class="variable">$router</span>.go(-<span class="number">1</span>)</span></span><br><span class="line"><span class="xquery">    }</span></span><br><span class="line"><span class="xml">  }</span></span><br><span class="line"><span class="xml">}</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span></span></span><br><span class="line"><span class="xml">.page-sight-detail </span><span class="xquery">{</span></span><br><span class="line"><span class="xquery">  // 导航栏  </span></span><br><span class="line"><span class="xquery">  .van-nav-bar {</span></span><br><span class="line"><span class="xquery">    background-color: transparent;</span></span><br><span class="line"><span class="xquery">  }</span></span><br><span class="line"><span class="xml">}</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="景点大图部分"><a href="#景点大图部分" class="headerlink" title="景点大图部分"></a>景点大图部分</h3><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 大图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sight-banner"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-image</span> <span class="attr">src</span>=<span class="string">"/static/home/hot/h1_max.jpg"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">height</span>=<span class="string">"100%"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tips"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">class</span>=<span class="string">"pic-sts"</span> <span class="attr">:to</span>=<span class="string">"{name: 'SightImage', params: {id: 123}}"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"video-o"</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>10 图片<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>景点标题<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- //大图 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang="less"&gt;</span><br><span class="line">.page-sight-detail {</span><br><span class="line">  // 景点大图</span><br><span class="line">  .sight-banner{</span><br><span class="line">    position: relative;</span><br><span class="line">    .tips {</span><br><span class="line">      position: absolute;</span><br><span class="line">      left: 10px;</span><br><span class="line">      bottom: 10px;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      color: #fff;</span><br><span class="line"></span><br><span class="line">      .pic-sts {</span><br><span class="line">        color: #fff;</span><br><span class="line">        border-radius: 30px;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">        background-color: rgba(0,0,0,0.4);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="评分、景点介绍"><a href="#评分、景点介绍" class="headerlink" title="评分、景点介绍"></a>评分、景点介绍</h3><h4 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评分、景点介绍 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sight-info"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-title"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">strong</span>&gt;</span>5分<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">small</span>&gt;</span>很棒<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-tips"</span>&gt;</span>50 评论<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"arrow"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-title"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>景点介绍<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-tips"</span>&gt;</span>开放时间、贴士<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"arrow"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- //评分、景点介绍 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang="less"&gt;</span><br><span class="line">.page-sight-detail {</span><br><span class="line">  // 评分、景点介绍</span><br><span class="line">  .sight-info {</span><br><span class="line">    display: flex;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">    border-bottom: 1px solid #f6f6f6;</span><br><span class="line"></span><br><span class="line">    &amp; &gt; div {</span><br><span class="line">      flex: 1;</span><br><span class="line">      position: relative;</span><br><span class="line">    }</span><br><span class="line">    .right {</span><br><span class="line">      border-left: 1px solid #f6f6f6;</span><br><span class="line">    }</span><br><span class="line">    .info-title {</span><br><span class="line">      text-align: left;</span><br><span class="line">      padding: 5px 10px;</span><br><span class="line">      strong {</span><br><span class="line">        color: #ff8300;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    .info-tips {</span><br><span class="line">      color: #999;</span><br><span class="line">      font-size: 12px;</span><br><span class="line">      text-align: left;</span><br><span class="line">      padding: 5px 10px;</span><br><span class="line">    }</span><br><span class="line">    .van-icon {</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 5px;</span><br><span class="line">      top: 5px</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="地址信息"><a href="#地址信息" class="headerlink" title="地址信息"></a>地址信息</h3><h4 id="实现步骤-2"><a href="#实现步骤-2" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点详情 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-detail"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 地址信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">"广东省广州市番禺区番禺大道"</span> <span class="attr">icon</span>=<span class="string">"location-o"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">is-link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:title-style</span>=<span class="string">"{'text-align': 'left'}"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">right-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">"arrow"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- //地址信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h3 id="门票列表"><a href="#门票列表" class="headerlink" title="门票列表"></a>门票列表</h3><h4 id="实现步骤-3"><a href="#实现步骤-3" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分<br>`html<template>
<!-- 景点详情 -->
<div class="page-sight-detail">
  <!-- 门票列表 -->
  <div class="sight-ticket">
    <van-cell title="门票" icon="bookmark-o" title-style="text-align:left">
    <div class="ticket-item" v-for="i in 5" :key="i">
      <div class="left">
        <div class="title">成人票</div>
        <div class="tips">
          <van-icon name="clock-o">
          <span>7点之前可以预定</span>
        </van-icon></div>
        <div class="tags">
          <van-tag mark type="primary">标签1</van-tag>
        </div>
      </div>
      <div class="right">
        <div class="price">
          <span>￥</span>
          <strong>65</strong>
        </div>
        <router-link to="#">
          <van-button type="warning" size="small">预定</van-button>
        </router-link>
      </div>
    </div>
  </van-cell></div>
  <!-- //门票列表 -->
</div>
</template>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```vue</span><br><span class="line">&lt;style lang=<span class="string">"less"</span>&gt;</span><br><span class="line"><span class="selector-class">.page-sight-detail</span> {</span><br><span class="line">  <span class="comment">// 门票列表</span></span><br><span class="line">  <span class="selector-class">.sight-ticket</span> {</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.ticket-item</span> {</span><br><span class="line">      <span class="attribute">display</span>: flex;</span><br><span class="line">      <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#f6f6f6</span>;</span><br><span class="line">      <span class="attribute">padding-bottom</span>: <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.left</span> {</span><br><span class="line">        <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="attribute">text-align</span>: left;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.title</span> {</span><br><span class="line">          <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="selector-class">.tips</span> {</span><br><span class="line">          <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="selector-class">.right</span> {</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="selector-class">.price</span> {</span><br><span class="line">          <span class="attribute">color</span>: <span class="number">#ff9800</span>;</span><br><span class="line">          <span class="selector-tag">strong</span> {</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure></li>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="用户评价列表"><a href="#用户评价列表" class="headerlink" title="用户评价列表"></a>用户评价列表</h3><h4 id="实现步骤-4"><a href="#实现步骤-4" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>查找Vant中可以使用的组件</li>
<li>实现组件模板部分</li>
</ul>
<p>当<code>key=value</code>，<code>key:value</code>等同于<code>key</code><br><code>params: {id: id}</code>等同于<code>params: {id}</code><br><code>/src/views/sight/SightDetail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 用户评价 --&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;van-cell title="热门评论" icon="comment-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;comment-item/&gt;</span><br><span class="line">      &lt;router-link class="link-more" :to="{name: 'SightComment', params: {id}}"&gt;查看更多&lt;/router-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //用户评价 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>点击查看更多跳到景点评价</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: ''</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">  }</span><br><span class="line">  // 查看更多</span><br><span class="line">  .link-more {</span><br><span class="line">    display: block;</span><br><span class="line">    color: #666;</span><br><span class="line">    padding: 10px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;    </span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">```vue</span><br><span class="line">&lt;style lang="less"&gt;</span><br><span class="line">.page-sight-detail {</span><br><span class="line">  // 评论列表</span><br><span class="line">  .sight-comment {</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>评价列表只在景点模块的详情页和查看更多复用<br>新建目录<code>/src/components/sight</code><br>新建<code>/src/components/sight/CommentItem.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 评论列表的每一项 --&gt;</span><br><span class="line">  &lt;div class="comment-item-box"&gt;</span><br><span class="line">    &lt;div class="cmt-header"&gt;</span><br><span class="line">      &lt;div class="rate"&gt;</span><br><span class="line">        &lt;van-rate v-model="value"</span><br><span class="line">        allow-half</span><br><span class="line">        readonly</span><br><span class="line">        void-icon="star"</span><br><span class="line">        void-color="#eee" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="user"&gt;张三*** 2021-3-19&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="cmt-content"&gt;</span><br><span class="line">      &lt;p&gt;评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容评论内容&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 图片列表 --&gt;</span><br><span class="line">    &lt;div class="cmt-imgs" @click="show=true"&gt;</span><br><span class="line">      &lt;van-image width="100" height="100" src="https://img.yzcdn.cn/vant/cat.jpeg" /&gt;</span><br><span class="line">      &lt;van-image width="100" height="100" src="https://img.yzcdn.cn/vant/cat.jpeg" /&gt;</span><br><span class="line">      &lt;van-image width="100" height="100" src="https://img.yzcdn.cn/vant/cat.jpeg" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;van-image-preview v-model="show" :images="images" @change="onChange"&gt;</span><br><span class="line">      &lt;template v-slot:index&gt;第{{ index + 1 }}页&lt;/template&gt;</span><br><span class="line">    &lt;/van-image-preview&gt;</span><br><span class="line">    &lt;!-- //图片列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      show: false,</span><br><span class="line">      index: 0,</span><br><span class="line">      images: [</span><br><span class="line">        'https://img.yzcdn.cn/vant/apple-1.jpg',</span><br><span class="line">        'https://img.yzcdn.cn/vant/apple-2.jpg'</span><br><span class="line">      ],</span><br><span class="line">      value: 4.5</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    onChange (index) {</span><br><span class="line">      this.index = index</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>详情<code>/src/views/sight/SightDetail.vue</code>引入评价模块<br><code>&lt;comment-item/&gt;</code>等同于<code>&lt;CommentItem/&gt;</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 用户评价 --&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;comment-item/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //用户评价 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>模型层准备数据</li>
<li>模拟数据，实现效果</li>
</ul>
<h3 id="ORM模型设计"><a href="#ORM模型设计" class="headerlink" title="ORM模型设计"></a>ORM模型设计</h3><p>开发步骤</p>
<ul>
<li>分析并设计模型<br>pdman工具</li>
<li>完成ORM模型编码<br>新建一个package<code>utils</code><br><code>utils\models.py</code><br>`python<br>from django.db import models</li>
</ul>
<p>class CommonModel(models.Model):<br>    “”” 模型公共类 “””<br>    is_valid = models.BooleanField(‘是否有效’, default=True)<br>    created_at = models.DateTimeField(‘创建时间’, auto_now_add=True)<br>    updated_at = models.DateTimeField(‘修改时间’, auto_now=True)</p>
<pre><code>class Meta:
    abstract = True
</code></pre>
<figure class="highlight autohotkey"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="title">C:</span>\django\trip&gt;python manage.py startapp accounts</span><br></pre></td></tr></tbody></table></figure>

<p><code>trip\setting.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># 用户账户</span></span><br><span class="line">    <span class="string">'accounts.apps.AccountsConfig'</span></span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>accounts/models.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils.models <span class="keyword">import</span> CommonModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 用户模型 """</span></span><br><span class="line">    <span class="comment"># 用户用手机注册新建User的实例，只填手机号码和密码，所以姓名，手机号码、地址、邮箱可以为空</span></span><br><span class="line">    username = models.CharField(<span class="string">'用户名'</span>, max_length=<span class="number">32</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    password = models.CharField(<span class="string">'密码'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    avatar = models.ImageField(<span class="string">'用户头像'</span>, upload_to=<span class="string">'avatar/%Y%m'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    nickname = models.CharField(<span class="string">'昵称'</span>, max_length=<span class="number">32</span>, unique=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'account_user'</span></span><br></pre></td></tr></tbody></table></figure>


<p><code>system/models.py</code>和<code>sight/models.py</code><br>删掉</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">is_valid = models.BooleanField(<span class="string">'是否有效'</span>, default=<span class="literal">True</span>)</span><br><span class="line">created_at = models.DateTimeField(<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">updated_at = models.DateTimeField(<span class="string">'修改时间'</span>, auto_now=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>system/models.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageRelated</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 图片关联 """</span></span><br><span class="line">    img = models.ImageField(<span class="string">'图片'</span>, upload_to=<span class="string">'%Y%m/file/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    summary = models.CharField(<span class="string">'图片说明'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    user = models.ForeignKey(User,</span><br><span class="line">                             on_delete=models.SET(<span class="literal">None</span>),</span><br><span class="line">                             related_name=<span class="string">'upload_images'</span>,</span><br><span class="line">                             verbose_name=<span class="string">'上传的用户'</span>,</span><br><span class="line">                             null=<span class="literal">True</span>)</span><br><span class="line">    content_type = models.ForeignKey(ContentType, on_delete=models.CASCADE)</span><br><span class="line">    object_id = models.IntegerField(<span class="string">'关联的模型'</span>)</span><br><span class="line">    <span class="comment"># 查到某一个图片要得到关联的某一个模型的对象</span></span><br><span class="line">    content_object = GenericForeignKey(<span class="string">'content_type'</span>, <span class="string">'object_id'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'system_image_related'</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/models.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.contenttypes.fields <span class="keyword">import</span> GenericRelation</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> system.models <span class="keyword">import</span> ImageRelated</span><br><span class="line"><span class="keyword">from</span> utils.models <span class="keyword">import</span> CommonModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sight</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 景点基础信息 """</span></span><br><span class="line"></span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    main_img = models.ImageField(<span class="string">'主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    banner_img = models.ImageField(<span class="string">'详情主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    content = models.TextField(<span class="string">'详细'</span>)</span><br><span class="line">    score = models.FloatField(<span class="string">'评分'</span>, default=<span class="number">5</span>)</span><br><span class="line">    min_price = models.FloatField(<span class="string">'最低价格'</span>, default=<span class="number">0</span>)</span><br><span class="line">    province = models.CharField(<span class="string">'省份'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    city = models.CharField(<span class="string">'市区'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    area = models.CharField(<span class="string">'区/县'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line">    town = models.CharField(<span class="string">'乡镇'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    is_top = models.BooleanField(<span class="string">'是否为精选景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    is_hot = models.BooleanField(<span class="string">'是否为热门景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向关联，景点和系统的图片关联上</span></span><br><span class="line">    images = GenericRelation(ImageRelated,</span><br><span class="line">                             verbose_name=<span class="string">'关联的图片'</span>,</span><br><span class="line">                             <span class="comment"># 通过一个景点的模型对象，找到对应id的记录，转换为sight的对象，</span></span><br><span class="line">                             <span class="comment"># 通过其属性找到它的图片</span></span><br><span class="line">                             related_query_name=<span class="string">'rel_sight_iamges'</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight'</span></span><br><span class="line">        ordering = [<span class="string">'-updated_at'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>新建<code>sight/choices.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span>  models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketTypes</span>(<span class="params">models.IntegerChoices</span>):</span></span><br><span class="line">    ADULT = <span class="number">11</span>, <span class="string">'成人票'</span></span><br><span class="line">    CHILD = <span class="number">12</span>, <span class="string">'儿童票'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketStatus</span>(<span class="params">models.IntegerChoices</span>):</span></span><br><span class="line">    <span class="string">""" 门票的状态 """</span></span><br><span class="line">    OPEN = <span class="number">1</span>, <span class="string">'开放购买'</span></span><br><span class="line">    CLOSED = <span class="number">0</span>, <span class="string">'暂未开放'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EntryWay</span>(<span class="params">models.IntegerChoices</span>):</span></span><br><span class="line">    <span class="string">""" 入园方式 """</span></span><br><span class="line">    BY_TICKET = <span class="number">0</span>, <span class="string">'短信换票入园'</span></span><br><span class="line">    BY_CODE = <span class="number">1</span>, <span class="string">'凭借验证码入园'</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>检测ORM模型</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py check</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第四步，模型同步<br>`bash<br>python manage.py makemigrations<br>python manage.py migrate</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### 重构响应对象</span></span><br><span class="line"><span class="comment">#### 开发步骤</span></span><br><span class="line">- 设计响应单个对象的基类  接口返回统一的封装</span><br><span class="line">对象转为字典，再转为json对象</span><br><span class="line">新建`utils/serializers.py`定义两种接口所响应的数据类型， 一个是详情，直接返回响应对象 ，一个是列表，有`meta`和`object`的结构</span><br><span class="line">```python</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseSerializer</span>(<span class="params">object</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        self.obj = obj</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetaSerializer</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">""" 分页元数据 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, page, page_count, total_count, **kwargs</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param page: 当前页</span></span><br><span class="line"><span class="string">        :param page_count: 总页数</span></span><br><span class="line"><span class="string">        :param total_count: 总记录数</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.page = page</span><br><span class="line">        self.page_count = page_count</span><br><span class="line">        self.total_count = total_count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'total_count'</span>: self.total_count,</span><br><span class="line">            <span class="string">'page_count'</span>: self.page_count,</span><br><span class="line">            <span class="string">'current_page'</span>: self.page</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseListPageSerializer</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">""" 分页类封装 """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, page_obj, paginator=None, object_list=[]</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param page_obj: 当前页的对象</span></span><br><span class="line"><span class="string">        :param paginator: 分页器的对象</span></span><br><span class="line"><span class="string">        :param object_list: 当前页的数据列表</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.page_obj = page_obj</span><br><span class="line">        self.paginator = paginator <span class="keyword">if</span> paginator <span class="keyword">else</span> page_obj.paginator</span><br><span class="line">        self.object_list = object_list <span class="keyword">if</span> object_list <span class="keyword">else</span> page_obj.object_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="string">""" 对象的内容，子类重写 """</span></span><br><span class="line">        <span class="keyword">return</span> {}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        page = self.page_obj.number  <span class="comment"># 当前页</span></span><br><span class="line">        page_count = self.paginator.num_pages  <span class="comment"># 总页数</span></span><br><span class="line">        total_count = self.paginator.count  <span class="comment"># 总记录数</span></span><br><span class="line">        meta = MetaSerializer(page=page, page_count=page_count, total_count=total_count).to_dict()</span><br><span class="line"></span><br><span class="line">        objects = []</span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> self.object_list:</span><br><span class="line">            objects.append(self.get_object(obj))</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'meta'</span>: meta,</span><br><span class="line">            <span class="string">'objects'</span>: objects</span><br><span class="line">        }</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">`sight/serializers.py`</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'main_img'</span>: obj.main_img.url,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="comment"># TODO 评论数量暂时无法获取</span></span><br><span class="line">            <span class="string">'comment_count'</span>: <span class="number">0</span></span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>设计响应列表对象的基类</p>
</li>
<li><p>设计错误基础类<br><code>utils/response.py</code></p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotFoundJsonResponse</span>(<span class="params">JsonResponse</span>):</span></span><br><span class="line">    <span class="string">""" 400 对应JSON响应 """</span></span><br><span class="line">    status_code = <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line"></span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">"error_code"</span>: <span class="string">"404000"</span>,</span><br><span class="line">            <span class="string">"error_msg"</span>: <span class="string">"您访问的内容不存在或已被删除。"</span></span><br><span class="line">        }</span><br><span class="line">        super().__init__(data, *args, **kwargs)</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Sight</span><br><span class="line"><span class="keyword">from</span> utils.response <span class="keyword">import</span> NotFoundJsonResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line">    <span class="comment"># 每页放5条数据</span></span><br><span class="line">    paginate_by = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 重写查询方法 """</span></span><br><span class="line">        query = Q(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 1. 热门景点</span></span><br><span class="line">        is_hot = self.request.GET.get(<span class="string">'is_hot'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> is_hot:</span><br><span class="line">            query = query &amp; Q(is_hot=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 2. 精选景点</span></span><br><span class="line">        is_top = self.request.GET.get(<span class="string">'is_top'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> is_top:</span><br><span class="line">            query = query &amp; Q(is_top=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># TODO 3. 景点名称搜索</span></span><br><span class="line">        queryset = Sight.objects.filter(query)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]  <span class="comment"># 当前页的对象</span></span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            data = serializers.SightListSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="景点详情接口开发"><a href="#景点详情接口开发" class="headerlink" title="景点详情接口开发"></a>景点详情接口开发</h3><h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li><p>设计接口返回内容及字段</p>
</li>
<li><p>编写接口代码<br><code>sight/urls.py</code></p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.2 景点详细信息</span></span><br><span class="line">    path(<span class="string">'sight/detail/&lt;int:pk&gt;/'</span>, views.SightDetailView.as_view(), name=<span class="string">"sight_detail"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightDetailSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点详情 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        obj = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'img'</span>: obj.banner_img.url,</span><br><span class="line">            <span class="string">'content'</span>: obj.content,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="string">'area'</span>: obj.area,</span><br><span class="line">            <span class="string">'town'</span>: obj.town,</span><br><span class="line">            <span class="comment"># TODO 评论数量暂时无法获取</span></span><br><span class="line">            <span class="string">'comment_count'</span>: <span class="number">0</span></span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> DetailView</span><br><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Sight</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightDetailView</span>(<span class="params">DetailView</span>):</span></span><br><span class="line">    <span class="string">""" 2.2 景点详细信息 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># return Sight.objects.filter(is_valid=True)</span></span><br><span class="line">        <span class="keyword">return</span> Sight.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        page_obj = context[<span class="string">'object'</span>]</span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> page_obj.is_valid:</span><br><span class="line">                <span class="keyword">return</span> NotFoundJsonResponse()</span><br><span class="line">            data = serializers.SightDetailSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="景点评论列表接口开发"><a href="#景点评论列表接口开发" class="headerlink" title="景点评论列表接口开发"></a>景点评论列表接口开发</h3><h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>设计接口返回内容及字段</li>
</ul>
<p><code>sight/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.3 景点下的评论列表</span></span><br><span class="line">    path(<span class="string">'comment/list/&lt;int:pk&gt;/'</span>, views.SightCommentListView.as_view(), name=<span class="string">"sight_comment_list"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>新建<code>system/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseImageSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 序列化基础图片：其它列表需要引用到时使用 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        image = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'img'</span>: image.img.url,</span><br><span class="line">            <span class="string">'summary'</span>: image.summary</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> system.serializers <span class="keyword">import</span> BaseImageSerializer</span><br><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 评论列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        user = obj.user</span><br><span class="line">        images = []</span><br><span class="line">        <span class="keyword">for</span> image <span class="keyword">in</span> obj.images.filter(is_valid=<span class="literal">True</span>):</span><br><span class="line">            images.append(BaseImageSerializer(image).to_dict())</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'user'</span>: {</span><br><span class="line">                <span class="string">'pk'</span>: user.pk,</span><br><span class="line">                <span class="string">'nickname'</span>: user.nickname</span><br><span class="line">            },</span><br><span class="line">            <span class="string">'pk'</span>: obj.pk,</span><br><span class="line">            <span class="string">'content'</span>: obj.content,</span><br><span class="line">            <span class="string">'is_top'</span>: obj.is_top,</span><br><span class="line">            <span class="string">'love_count'</span>: obj.love_count,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'is_public'</span>: obj.is_public,</span><br><span class="line">            <span class="string">'images'</span>: images,</span><br><span class="line">            <span class="string">'created_at'</span>: obj.created_at.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>编写接口代码<br><code>sight/views.py</code></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Comment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightCommentListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 2.3 景点下的评论列表 """</span></span><br><span class="line">    paginate_by = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 根据景点ID查询景点</span></span><br><span class="line">        sight_id = self.kwargs.get(<span class="string">'pk'</span>, <span class="literal">None</span>)</span><br><span class="line">        sight = Sight.objects.filter(pk=sight_id, is_valid=<span class="literal">True</span>).first()</span><br><span class="line">        <span class="keyword">if</span> sight:</span><br><span class="line">            <span class="comment"># return Comment.objects.filter(is_valid=True, sight=sight)</span></span><br><span class="line">            <span class="keyword">return</span> sight.comments.filter(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Comment.objects.none()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        <span class="string">""" 重写响应的返回 """</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]  <span class="comment"># 分页的某一页对象</span></span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            data = serializers.CommentListSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="门票列表接口开发"><a href="#门票列表接口开发" class="headerlink" title="门票列表接口开发"></a>门票列表接口开发</h3><h4 id="开发步骤-2"><a href="#开发步骤-2" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li><p>设计接口返回内容及字段</p>
<p><code>sight/urls.py</code></p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.4 景点下的门票列表</span></span><br><span class="line">    path(<span class="string">'ticket/list/&lt;int:pk&gt;/'</span>, views.SightTicketListView.as_view(), name=<span class="string">"sight_ticket_list"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 门票列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'pk'</span>: obj.pk,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'types'</span>: obj.types,</span><br><span class="line">            <span class="string">'price'</span>: obj.price,</span><br><span class="line">            <span class="string">'discount'</span>: obj.discount,</span><br><span class="line">            <span class="string">'total_stock'</span>: obj.total_stock,</span><br><span class="line">            <span class="string">'remain_stock'</span>: obj.remain_stock</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>编写接口代码<br><code>sight/views.py</code></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Ticket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightTicketListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 2.4 景点下的门票列表 """</span></span><br><span class="line"></span><br><span class="line">    paginate_by = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 根据景点ID查询景点</span></span><br><span class="line">        sight_id = self.kwargs.get(<span class="string">'pk'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> Ticket.objects.filter(is_valid=<span class="literal">True</span>, sight__id=sight_id)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        <span class="string">""" 重写响应的返回 """</span></span><br><span class="line">        page_obj = context[<span class="string">'page_obj'</span>]</span><br><span class="line">        <span class="keyword">if</span> page_obj <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            data = serializers.TicketListSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>模拟HTTP请求，测试验证接口</li>
</ul>
<h3 id="景点介绍接口开发"><a href="#景点介绍接口开发" class="headerlink" title="景点介绍接口开发"></a>景点介绍接口开发</h3><h4 id="开发步骤-3"><a href="#开发步骤-3" class="headerlink" title="开发步骤"></a>开发步骤</h4><ul>
<li>设计接口返回内容及字段</li>
</ul>
<p><code>sight/urls.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sight <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 2.5 景点介绍</span></span><br><span class="line">    path(<span class="string">'sight/info/&lt;int:pk&gt;/'</span>, views.SightInfoDetailView.as_view(), name=<span class="string">"sight_info"</span>),</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.serializers <span class="keyword">import</span> BaseListPageSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightInfoSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点介绍 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        obj = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'pk'</span>: obj.sight.pk,  <span class="comment"># 景点ID</span></span><br><span class="line">            <span class="string">'entry_explain'</span>: obj.entry_explain,</span><br><span class="line">            <span class="string">'play_way'</span>: obj.play_way,</span><br><span class="line">            <span class="string">'tips'</span>: obj.tips,</span><br><span class="line">            <span class="string">'traffic'</span>: obj.traffic,</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>编写接口代码<br><code>sight/views.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sight.models <span class="keyword">import</span> Info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightInfoDetailView</span>(<span class="params">DetailView</span>):</span></span><br><span class="line">    <span class="string">""" 2.5 景点介绍 """</span></span><br><span class="line">    slug_field = <span class="string">'sight__pk'</span>  <span class="comment"># url传递过来的这个变化的参数指代的是哪个字段</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Info.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render_to_response</span>(<span class="params">self, context, **response_kwargs</span>):</span></span><br><span class="line">        page_obj = context[<span class="string">'object'</span>]</span><br><span class="line">        <span class="keyword">if</span> page_obj:</span><br><span class="line">            data = serializers.SightInfoSerializer(page_obj).to_dict()</span><br><span class="line">            <span class="keyword">return</span> http.JsonResponse(data)</span><br><span class="line">        <span class="keyword">return</span> NotFoundJsonResponse()</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>模拟HTTP请求，测试验证接口</p>
</li>
</ul>
<h3 id="景点搜索接口联调"><a href="#景点搜索接口联调" class="headerlink" title="景点搜索接口联调"></a>景点搜索接口联调</h3><h4 id="实现步骤-5"><a href="#实现步骤-5" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li><p>修改景点列表接口，支持搜索</p>
<p><code>sight/views.py</code></p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line">    <span class="comment"># 每页放5条数据</span></span><br><span class="line">    paginate_by = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 重写查询方法 """</span></span><br><span class="line">        query = Q(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 3. 景点名称搜索</span></span><br><span class="line">        name = self.request.GET.get(<span class="string">'name'</span>, <span class="literal">None</span>)  <span class="comment"># 从前端获取搜索字段</span></span><br><span class="line">        <span class="keyword">if</span> name:</span><br><span class="line">            query = query &amp; Q(name__icontains=name)  <span class="comment"># 景点名称是否包含搜索字段</span></span><br><span class="line">        queryset = Sight.objects.filter(query)</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_paginate_by</span>(<span class="params">self, queryset</span>):</span></span><br><span class="line">        <span class="string">""" 从前端控制每一页的分页大小 """</span></span><br><span class="line">        page_size = self.request.GET.get(<span class="string">'limit'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> page_size <span class="keyword">or</span> self.paginate_by</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>配置接口地址<br>从首页底部点击搜索，保留底部组件，查询所有<br>从首页点击热门推荐和精选节点更多，去掉底部组件，增加左上角返回按钮，只查询热门推荐和精选景点</li>
</ul>
<p><code>src\components\home\Hot.vue</code><br>`vue<br><template><br>  <!-- 热门景点 --><br>  <div class="home-hot-box"><br>    <!-- 顶上导航 --><br>    <van-cell title="热门推荐" icon="/static/home/hot/fire.png" is-link title-style="text-align:left" value="全部榜单" :to="{name: 'Search', query: {isHot: 1}}"><br>    <!-- // 顶上导航 --><br>  </van-cell></div><br></template></p>
<figure class="highlight xquery"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`src\components\home\Fine.vue`</span><br><span class="line">```vue</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="comment">&lt;!-- 精选景点 --&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home-fine-box"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 顶上导航 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">van-cell</span></span></span></span><br><span class="line"><span class="xml">      title="精选景点"</span></span><br><span class="line"><span class="xml">      icon="location-o"</span></span><br><span class="line"><span class="xml">      is-link</span></span><br><span class="line"><span class="xml">      title-style="text-align:left"</span></span><br><span class="line"><span class="xml">      value="更多"</span></span><br><span class="line"><span class="xml">      :to="</span><span class="xquery"><span class="built_in">{name</span>: <span class="string">'Search'</span>, query: {isTop: <span class="number">1</span>}</span><span class="xml">}"/&gt;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- // 顶上导航 --&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<p><code>src\views\Search.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 搜索页面 --&gt;</span><br><span class="line">  &lt;div class="page-search"&gt;</span><br><span class="line">    &lt;!-- 标题 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="搜索景点"</span><br><span class="line">      left-text="返回"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"</span><br><span class="line">      v-if="isHome"/&gt;</span><br><span class="line">    &lt;van-nav-bar title="搜索景点" v-else/&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;van-search</span><br><span class="line">      v-model="sightName"</span><br><span class="line">      show-action</span><br><span class="line">      label="景点"</span><br><span class="line">      placeholder="请输入搜索关键词"</span><br><span class="line">      @search="onSearch"</span><br><span class="line">      @clear="clear"</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;div @click="onSearch"&gt;搜索&lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2 v-if="isHot"&gt;热门推荐&lt;/h2&gt;</span><br><span class="line">    &lt;h2 v-if="isTop"&gt;精选景点&lt;/h2&gt;</span><br><span class="line">    &lt;!-- 景点列表 --&gt;</span><br><span class="line">    &lt;div class="sight-list"&gt;</span><br><span class="line">      &lt;sight-item v-for="item in dataList"</span><br><span class="line">        :key="item.id"</span><br><span class="line">        :item="item"/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 分页 --&gt;</span><br><span class="line">    &lt;van-pagination</span><br><span class="line">    v-model="currentPage"</span><br><span class="line">    :total-items="totalItems"</span><br><span class="line">    :items-per-page="perPage"</span><br><span class="line">    @change="pageChange" /&gt;</span><br><span class="line">    &lt;!-- 底部导航 --&gt;</span><br><span class="line">    &lt;TripFooter v-if="!isHome"/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 景点列表的每一项</span><br><span class="line">import SightItem from '@/components/common/ListSight'</span><br><span class="line">// 底部导航</span><br><span class="line">import TripFooter from '@/components/common/Footer'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 景点名称</span><br><span class="line">      sightName: '',</span><br><span class="line">      // 景点列表的数据</span><br><span class="line">      dataList: [],</span><br><span class="line">      // 总记录数</span><br><span class="line">      totalItems: 0,</span><br><span class="line">      // 当前的页码</span><br><span class="line">      currentPage: 1,</span><br><span class="line">      // 每页数据的大小</span><br><span class="line">      perPage: 4,</span><br><span class="line">      // 热门景点和精选景点</span><br><span class="line">      isHot: '',</span><br><span class="line">      isTop: ''</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    SightItem,</span><br><span class="line">    TripFooter</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 是否从首页过来</span><br><span class="line">     */</span><br><span class="line">    isHome () {</span><br><span class="line">      return this.isHot || this.isTop</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 景点列表接口</span><br><span class="line">     */</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          page: this.currentPage,</span><br><span class="line">          name: this.sightName,</span><br><span class="line">          limit: this.perPage,</span><br><span class="line">          is_top: this.isTop,</span><br><span class="line">          is_hot: this.isHot</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data: { meta, objects } }) =&gt; {</span><br><span class="line">        this.dataList = objects</span><br><span class="line">        // 总记录数</span><br><span class="line">        this.totalItems = meta.total_count</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    clear () {</span><br><span class="line">      this.dataList = []</span><br><span class="line">      this.currentPage = 1</span><br><span class="line">      this.getDataList()</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 页码发生变化后调用</span><br><span class="line">     */</span><br><span class="line">    pageChange () {</span><br><span class="line">      this.getDataList()</span><br><span class="line">    },</span><br><span class="line">    onSearch () {</span><br><span class="line">      console.log('onSearch ')</span><br><span class="line">      // 判断搜索内容是否为空</span><br><span class="line">      if (!this.sightName) {</span><br><span class="line">        this.$toast('请输入搜索词') // 弹框提示</span><br><span class="line">        return</span><br><span class="line">      }</span><br><span class="line">      // 重置数据</span><br><span class="line">      this.dataList = []</span><br><span class="line">      this.currentPage = 1</span><br><span class="line">      // 执行查询</span><br><span class="line">      this.getDataList()</span><br><span class="line">    }</span><br><span class="line">  },  </span><br><span class="line">  mounted () {</span><br><span class="line">    // 热门景点和精选景点</span><br><span class="line">    this.isHot = this.$route.query.isHot</span><br><span class="line">    this.isTop = this.$route.query.isTop</span><br><span class="line">    this.getDataList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>使用axios获取数据</li>
<li>将数据设置到模型层</li>
</ul>
<h3 id="景点详情和评论接口联调"><a href="#景点详情和评论接口联调" class="headerlink" title="景点详情和评论接口联调"></a>景点详情和评论接口联调</h3><h4 id="实现步骤-6"><a href="#实现步骤-6" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>阅读接口文档</li>
<li>配置接口地址<br><code>src\utils\apis.js</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 景点模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> SightApis = {</span><br><span class="line">  <span class="comment">// 景点列表</span></span><br><span class="line">  sightListUrl: apiHost + <span class="string">'/sight/sight/list/'</span>,</span><br><span class="line">  <span class="comment">// 景点详情</span></span><br><span class="line">  sightDetailUrl: apiHost + <span class="string">'/sight/sight/detail/#{id}/'</span>,</span><br><span class="line">  <span class="comment">// 门票列表</span></span><br><span class="line">  sightTicketUrl: apiHost + <span class="string">'/sight/ticket/list/#{id}/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\views\sight\SightDetail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 大图 --&gt;</span><br><span class="line">    &lt;div class="sight-banner"&gt;</span><br><span class="line">      &lt;van-image :src="sightDetail.img" width="100%" height="100%"/&gt;</span><br><span class="line">      &lt;div class="tips"&gt;</span><br><span class="line">        &lt;router-link class="pic-sts" :to="{name: 'SightImage', params: {id}}"&gt;</span><br><span class="line">          &lt;van-icon name="video-o" /&gt;</span><br><span class="line">          &lt;span&gt;{{ sightDetail.image_count }} 图片&lt;/span&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">        &lt;div class="title"&gt;{{ sightDetail.name }}&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //大图 --&gt;</span><br><span class="line">    &lt;!-- 评分、景点介绍 --&gt;</span><br><span class="line">    &lt;div class="sight-info"&gt;</span><br><span class="line">      &lt;div class="left"&gt;</span><br><span class="line">        &lt;div class="info-title"&gt;</span><br><span class="line">          &lt;strong&gt;{{ sightDetail.score }}分&lt;/strong&gt;</span><br><span class="line">          &lt;small&gt;很棒&lt;/small&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info-tips"&gt;{{ sightDetail.comment_count }} 评论&lt;/div&gt;</span><br><span class="line">        &lt;van-icon name="arrow" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class="right"&gt;</span><br><span class="line">        &lt;div class="info-title"&gt;</span><br><span class="line">          &lt;span&gt;景点介绍&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="info-tips"&gt;开放时间、贴士&lt;/div&gt;</span><br><span class="line">        &lt;van-icon name="arrow" /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //评分、景点介绍 --&gt;</span><br><span class="line">    &lt;!-- 门票列表 --&gt;</span><br><span class="line">    &lt;div class="sight-ticket"&gt;</span><br><span class="line">      &lt;van-cell title="门票" icon="bookmark-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;div class="ticket-item" v-for="item in ticketList" :key="item.pk"&gt;</span><br><span class="line">        &lt;div class="left"&gt;</span><br><span class="line">          &lt;div class="title"&gt;{{ item.name }}&lt;/div&gt;</span><br><span class="line">          &lt;div class="tips"&gt;</span><br><span class="line">            &lt;van-icon name="clock-o" /&gt;</span><br><span class="line">            &lt;span&gt;{{ item.desc }}&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="tags"&gt;</span><br><span class="line">            &lt;van-tag mark type="primary"&gt;标签1&lt;/van-tag&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="right"&gt;</span><br><span class="line">          &lt;div class="price"&gt;</span><br><span class="line">            &lt;span&gt;￥&lt;/span&gt;</span><br><span class="line">            &lt;strong&gt;{{ item.sell_price }}&lt;/strong&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;router-link to="#"&gt;</span><br><span class="line">            &lt;van-button type="warning" size="small"&gt;预定&lt;/van-button&gt;</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //门票列表 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: '',</span><br><span class="line">      // 景点详细信息</span><br><span class="line">      sightDetail: {},</span><br><span class="line">      // 门票列表</span><br><span class="line">      ticketList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 地址的全部信息</span><br><span class="line">     */</span><br><span class="line">    fullArea () {</span><br><span class="line">      let area = this.sightDetail.province + this.sightDetail.city</span><br><span class="line">      if (this.sightDetail.area) {</span><br><span class="line">        area += this.sightDetail.area</span><br><span class="line">      }</span><br><span class="line">      if (this.sightDetail.town) {</span><br><span class="line">        area += this.sightDetail.town</span><br><span class="line">      }</span><br><span class="line">      return area</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 获取景点详细信息</span><br><span class="line">     */</span><br><span class="line">    getSightDetail () {</span><br><span class="line">      const url = SightApis.sightDetailUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data }) =&gt; {</span><br><span class="line">        this.sightDetail = data</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">      * 门票列表</span><br><span class="line">      */</span><br><span class="line">    getTicketList () {</span><br><span class="line">      const url = SightApis.sightTicketUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.ticketList = objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">    // 获取景点详细信息</span><br><span class="line">    this.getSightDetail()</span><br><span class="line">    // 获取门票列表</span><br><span class="line">    this.getTicketList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>详情页的图片数量和评论数量<br><code>sight/models.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.contenttypes.fields <span class="keyword">import</span> GenericRelation</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> accounts.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> system.models <span class="keyword">import</span> ImageRelated</span><br><span class="line"><span class="keyword">from</span> sight.choices <span class="keyword">import</span> TicketTypes, EntryWay, TicketStatus</span><br><span class="line"><span class="keyword">from</span> utils.models <span class="keyword">import</span> CommonModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sight</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 景点基础信息 """</span></span><br><span class="line"></span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    main_img = models.ImageField(<span class="string">'主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    banner_img = models.ImageField(<span class="string">'详情主图'</span>, upload_to=<span class="string">'%Y%m/sight/'</span>, max_length=<span class="number">256</span>)</span><br><span class="line">    content = models.TextField(<span class="string">'详细'</span>)</span><br><span class="line">    score = models.FloatField(<span class="string">'评分'</span>, default=<span class="number">5</span>)</span><br><span class="line">    min_price = models.FloatField(<span class="string">'最低价格'</span>, default=<span class="number">0</span>)</span><br><span class="line">    province = models.CharField(<span class="string">'省份'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    city = models.CharField(<span class="string">'市区'</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    area = models.CharField(<span class="string">'区/县'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line">    town = models.CharField(<span class="string">'乡镇'</span>, max_length=<span class="number">32</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    is_top = models.BooleanField(<span class="string">'是否为精选景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    is_hot = models.BooleanField(<span class="string">'是否为热门景点'</span>, default=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向关联，景点和系统的图片关联上</span></span><br><span class="line">    images = GenericRelation(ImageRelated,</span><br><span class="line">                             verbose_name=<span class="string">'关联的图片'</span>,</span><br><span class="line">                             <span class="comment"># 通过一个景点的模型对象，找到对应id的记录，转换为sight的对象，</span></span><br><span class="line">                             <span class="comment"># 通过其属性找到它的图片</span></span><br><span class="line">                             related_query_name=<span class="string">'rel_sight_iamges'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight'</span></span><br><span class="line">        ordering = [<span class="string">'-updated_at'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">comment_count</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 评论总数 """</span></span><br><span class="line">        <span class="keyword">return</span> self.comments.filter(is_valid=<span class="literal">True</span>).count()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">image_count</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 景点图片的数量 """</span></span><br><span class="line">        <span class="keyword">return</span> self.images.filter(is_valid=<span class="literal">True</span>).count()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">""" 景点详情 """</span></span><br><span class="line">    sight = models.OneToOneField(Sight, on_delete=models.CASCADE)</span><br><span class="line">    entry_explain = models.CharField(<span class="string">'入园参考'</span>, max_length=<span class="number">1024</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    play_way = models.TextField(<span class="string">'特色玩法'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    tips = models.TextField(<span class="string">'温馨提示'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    traffic = models.TextField(<span class="string">'交通到达'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight_info'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 门票 """</span></span><br><span class="line">    sight = models.ForeignKey(Sight, related_name=<span class="string">'tickets'</span>, verbose_name=<span class="string">'景点门票'</span>,</span><br><span class="line">                              on_delete=models.PROTECT)</span><br><span class="line">    name = models.CharField(<span class="string">'名称'</span>, max_length=<span class="number">128</span>)</span><br><span class="line">    desc = models.CharField(<span class="string">'描述'</span>, max_length=<span class="number">64</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    types = models.SmallIntegerField(<span class="string">'类型'</span>,</span><br><span class="line">                                     choices=TicketTypes.choices,</span><br><span class="line">                                     default=TicketTypes.ADULT,</span><br><span class="line">                                     help_text=<span class="string">'默认为成人票'</span>)</span><br><span class="line">    price = models.FloatField(<span class="string">'价格（原价）'</span>)</span><br><span class="line">    discount = models.FloatField(<span class="string">'折扣'</span>, default=<span class="number">10</span>)</span><br><span class="line">    total_stock = models.PositiveIntegerField(<span class="string">'总库存'</span>, default=<span class="number">0</span>)</span><br><span class="line">    remain_stock = models.PositiveIntegerField(<span class="string">'剩余库存'</span>, default=<span class="number">0</span>)</span><br><span class="line">    expire_date = models.IntegerField(<span class="string">'有效期'</span>, default=<span class="number">1</span>)</span><br><span class="line">    return_policy = models.CharField(<span class="string">'退改政策'</span>, max_length=<span class="number">64</span>, default=<span class="string">'条件退'</span>)</span><br><span class="line">    has_invoice = models.BooleanField(<span class="string">'是否提供发票'</span>, default=<span class="literal">True</span>)</span><br><span class="line">    entry_way = models.SmallIntegerField(<span class="string">'入园方式'</span>,</span><br><span class="line">                                         choices=EntryWay.choices,</span><br><span class="line">                                         default=EntryWay.BY_TICKET)</span><br><span class="line">    tips = models.TextField(<span class="string">'预定须知'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    remark = models.TextField(<span class="string">'其他说明'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    status = models.SmallIntegerField(<span class="string">'状态'</span>,</span><br><span class="line">                                      choices=TicketStatus.choices,</span><br><span class="line">                                      default=TicketStatus.OPEN)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight_ticket'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sell_price</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">""" 销售价 = 原价 x 折扣 """</span></span><br><span class="line">        <span class="keyword">return</span> self.price * self.discount / <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span>(<span class="params">CommonModel</span>):</span></span><br><span class="line">    <span class="string">""" 评论及回复 """</span></span><br><span class="line">    <span class="comment"># 评论关联到用户</span></span><br><span class="line">    user = models.ForeignKey(User, verbose_name=<span class="string">'评论人'</span>,</span><br><span class="line">                             related_name=<span class="string">'comments'</span>,</span><br><span class="line">                             on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># 评论关联到景点</span></span><br><span class="line">    sight = models.ForeignKey(Sight, verbose_name=<span class="string">'景点'</span>,</span><br><span class="line">                              related_name=<span class="string">'comments'</span>,</span><br><span class="line">                              on_delete=models.CASCADE)</span><br><span class="line">    content = models.TextField(<span class="string">'评论内容'</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>)</span><br><span class="line">    is_top = models.BooleanField(<span class="string">'是否置顶'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    love_count = models.IntegerField(<span class="string">'点赞次数'</span>, default=<span class="number">0</span>)</span><br><span class="line">    score = models.FloatField(<span class="string">'评分'</span>, default=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    ip_address = models.CharField(<span class="string">'IP地址'</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    is_public = models.SmallIntegerField(<span class="string">'是否公开'</span>, default=<span class="number">1</span>)</span><br><span class="line">    reply = models.ForeignKey(</span><br><span class="line">        <span class="string">'self'</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>,</span><br><span class="line">        related_name=<span class="string">'reply_comment'</span>,</span><br><span class="line">        verbose_name=<span class="string">'回复'</span>,</span><br><span class="line">        on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># 反向关联，评论和系统的图片关联上</span></span><br><span class="line">    images = GenericRelation(ImageRelated,</span><br><span class="line">                             verbose_name=<span class="string">'关联的图片'</span>,</span><br><span class="line">                             related_query_name=<span class="string">"rel_comment_images"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'sight_comment'</span></span><br><span class="line">        ordering = [<span class="string">'-love_count'</span>, <span class="string">'-created_at'</span>]</span><br></pre></td></tr></tbody></table></figure>

<p><code>sight/serializers.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'main_img'</span>: obj.main_img.url,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="string">'comment_count'</span>: obj.comment_count</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SightDetailSerializer</span>(<span class="params">BaseSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 景点详情 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_dict</span>(<span class="params">self</span>):</span></span><br><span class="line">        obj = self.obj</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'id'</span>: obj.id,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'img'</span>: obj.banner_img.url,</span><br><span class="line">            <span class="string">'content'</span>: obj.content,</span><br><span class="line">            <span class="string">'score'</span>: obj.score,</span><br><span class="line">            <span class="string">'min_price'</span>: obj.min_price,</span><br><span class="line">            <span class="string">'province'</span>: obj.province,</span><br><span class="line">            <span class="string">'city'</span>: obj.city,</span><br><span class="line">            <span class="string">'area'</span>: obj.area,</span><br><span class="line">            <span class="string">'town'</span>: obj.town,</span><br><span class="line">            <span class="string">'comment_count'</span>: obj.comment_count,</span><br><span class="line">            <span class="string">'image_count'</span>: obj.image_count,</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketListSerializer</span>(<span class="params">BaseListPageSerializer</span>):</span></span><br><span class="line">    <span class="string">""" 门票列表 """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">'pk'</span>: obj.pk,</span><br><span class="line">            <span class="string">'name'</span>: obj.name,</span><br><span class="line">            <span class="string">'desc'</span>: obj.desc,</span><br><span class="line">            <span class="string">'types'</span>: obj.types,</span><br><span class="line">            <span class="string">'price'</span>: obj.price,</span><br><span class="line">            <span class="string">'sell_price'</span>: obj.sell_price,</span><br><span class="line">            <span class="string">'discount'</span>: obj.discount,</span><br><span class="line">            <span class="string">'total_stock'</span>: obj.total_stock,</span><br><span class="line">            <span class="string">'remain_stock'</span>: obj.remain_stock</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>使用axios获取数据</li>
<li>将数据设置到模型层</li>
</ul>
<h3 id="景点评论接口联调"><a href="#景点评论接口联调" class="headerlink" title="景点评论接口联调"></a>景点评论接口联调</h3><h4 id="实现步骤-7"><a href="#实现步骤-7" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul>
<li>阅读接口文档</li>
<li>配置接口地址<br>评论的每一项在景点详情、单独的评论列表，封装成公共组件，<br>获取里面内容在详情页url发生变化的时候，watch监听路由变化，重新获取数据</li>
</ul>
<p><code>src\utils\filters.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户名称脱敏处理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">{*}</span> </span>name 用户名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unameFormat</span> (<span class="params">name</span>) </span>{</span><br><span class="line">  <span class="keyword">if</span> (!name) {</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> name.substr(<span class="number">0</span>, <span class="number">2</span>) + <span class="string">'***'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> {</span><br><span class="line">  unameFormat</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\utils\apis.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SightApis = {</span><br><span class="line">  <span class="comment">// 评论列表</span></span><br><span class="line">  sightCommentUrl: apiHost + <span class="string">'/sight/comment/list/#{id}/'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\views\sight\SightComment.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点评论 --&gt;</span><br><span class="line">  &lt;div class="page-sight-comment"&gt;</span><br><span class="line">    &lt;!-- 页面头部 --&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      left-text="返回"</span><br><span class="line">      title="景点评论"</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left="goBack"</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;comment-item v-for="item in commentList" :key="item.pk" :item="item" /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 评论列表</span><br><span class="line">      commentList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 评论列表</span><br><span class="line">     */</span><br><span class="line">    getCommentList () {</span><br><span class="line">      const url = SightApis.sightCommentUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.commentList = objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">    this.getCommentList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\views\sight\SightDetail.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点详情 --&gt;</span><br><span class="line">  &lt;div class="page-sight-detail"&gt;</span><br><span class="line">    &lt;!-- 门票列表 --&gt;</span><br><span class="line">    &lt;div class="sight-ticket"&gt;</span><br><span class="line">      &lt;van-cell title="门票" icon="bookmark-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;div class="ticket-item" v-for="item in ticketList" :key="item.pk"&gt;</span><br><span class="line">        &lt;div class="left"&gt;</span><br><span class="line">          &lt;div class="title"&gt;{{ item.name }}&lt;/div&gt;</span><br><span class="line">          &lt;div class="tips"&gt;</span><br><span class="line">            &lt;van-icon name="clock-o" /&gt;</span><br><span class="line">            &lt;span&gt;{{ item.desc }}&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class="tags"&gt;</span><br><span class="line">            &lt;van-tag mark type="primary"&gt;标签1&lt;/van-tag&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="right"&gt;</span><br><span class="line">          &lt;div class="price"&gt;</span><br><span class="line">            &lt;span&gt;￥&lt;/span&gt;</span><br><span class="line">            &lt;strong&gt;{{ item.sell_price }}&lt;/strong&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;router-link to="#"&gt;</span><br><span class="line">            &lt;van-button type="warning" size="small"&gt;预定&lt;/van-button&gt;</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //门票列表 --&gt;</span><br><span class="line">    &lt;!-- 用户评价 --&gt;</span><br><span class="line">    &lt;div class="sight-comment"&gt;</span><br><span class="line">      &lt;van-cell title="热门评论" icon="comment-o" title-style="text-align:left"/&gt;</span><br><span class="line">      &lt;comment-item v-for="item in commentList" :key="item.pk" :item="item" /&gt;</span><br><span class="line">      &lt;router-link class="link-more" :to="{name: 'SightComment', params: {id}}"&gt;查看更多&lt;/router-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- //用户评价 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">// 评论项组件</span><br><span class="line">import CommentItem from '@/components/sight/CommentItem'</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      id: '',</span><br><span class="line">      // 景点详细信息</span><br><span class="line">      sightDetail: {},</span><br><span class="line">      // 门票列表</span><br><span class="line">      ticketList: [],</span><br><span class="line">      // 评论列表</span><br><span class="line">      commentList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 地址的全部信息</span><br><span class="line">     */</span><br><span class="line">    fullArea () {</span><br><span class="line">      let area = this.sightDetail.province + this.sightDetail.city</span><br><span class="line">      if (this.sightDetail.area) {</span><br><span class="line">        area += this.sightDetail.area</span><br><span class="line">      }</span><br><span class="line">      if (this.sightDetail.town) {</span><br><span class="line">        area += this.sightDetail.town</span><br><span class="line">      }</span><br><span class="line">      return area</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  watch: {</span><br><span class="line">    $route () {</span><br><span class="line">      this.loadData()</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 跳转到评论列表</span><br><span class="line">     */</span><br><span class="line">    goPage () {</span><br><span class="line">      this.$router.push({name: 'SightComment', params: {id: this.id}})</span><br><span class="line">    },</span><br><span class="line">    loadData () {</span><br><span class="line">      this.id = this.$route.params.id</span><br><span class="line">      // 获取景点详细信息</span><br><span class="line">      this.getSightDetail()</span><br><span class="line">      // 门票列表</span><br><span class="line">      this.getTicketList()</span><br><span class="line">      // 评论列表</span><br><span class="line">      this.getCommentList()</span><br><span class="line">    },</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 获取景点详细信息</span><br><span class="line">     */</span><br><span class="line">    getSightDetail () {</span><br><span class="line">      const url = SightApis.sightDetailUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data }) =&gt; {</span><br><span class="line">        this.sightDetail = data</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 门票列表</span><br><span class="line">     */</span><br><span class="line">    getTicketList () {</span><br><span class="line">      const url = SightApis.sightTicketUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.ticketList = objects</span><br><span class="line">      })</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 评论列表</span><br><span class="line">     */</span><br><span class="line">    getCommentList () {</span><br><span class="line">      const url = SightApis.sightCommentUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url).then(({ data: { objects } }) =&gt; {</span><br><span class="line">        this.commentList = objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.loadData()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>使用axios获取数据</li>
<li>将数据设置到模型层</li>
</ul>
<h3 id="前端代码优化"><a href="#前端代码优化" class="headerlink" title="前端代码优化"></a>前端代码优化</h3><ul>
<li>添加loading动画和添加请求拦截</li>
</ul>
<p><code>src\main.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.app = <span class="keyword">new</span> Vue({</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">}).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>src\utils\ajax.js</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line">ajax.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>{</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'请求拦截到了'</span>)</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.loading({</span><br><span class="line">    message: <span class="string">'加载中...'</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span>,</span><br><span class="line">    loadingType: <span class="string">'spinner'</span></span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">ajax.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>{</span><br><span class="line">  <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'响应拦截到了'</span>)</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> response</span><br><span class="line">}, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>{</span><br><span class="line">  <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">  <span class="keyword">if</span> (error.response) {</span><br><span class="line">    <span class="keyword">if</span> (error.response.status === <span class="number">401</span>) {</span><br><span class="line">      <span class="built_in">window</span>.alert(<span class="string">'未登录，即将跳转到登录页面'</span>)</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (error.response.status === <span class="number">500</span>) {</span><br><span class="line">      <span class="built_in">window</span>.app.$notify({</span><br><span class="line">        message: <span class="string">'服务器正忙，请稍后重试'</span>,</span><br><span class="line">        type: <span class="string">'danger'</span></span><br><span class="line">      })</span><br><span class="line">      <span class="comment">// window.alert('服务器正忙，请稍后重试')</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">window</span>.app.$toast.clear()</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>修改页面标题<br><code>public\index.html</code></li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"&lt;%= BASE_URL %&gt;favicon.ico"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>旅游网<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">`</span><br><span class="line"></span><br><span class="line">- 添加滚动加载，请求失败，点击重新加载和下拉刷新，</span><br><span class="line">在评论列表的场景添加</span><br><span class="line">`src\views\sight\SightComment.vue`</span><br><span class="line"></span><br><span class="line">```vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 景点评论 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-sight-comment"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-pull-refresh</span> <span class="attr">v-model</span>=<span class="string">"refreshing"</span> @<span class="attr">refresh</span>=<span class="string">"onRefresh"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"sight-comment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:finished</span>=<span class="string">"finished"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">finished-text</span>=<span class="string">"没有更多了"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:error.sync</span>=<span class="string">"error"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">error-text</span>=<span class="string">"请求失败，点击重新加载"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">load</span>=<span class="string">"getCommentList"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">comment-item</span> <span class="attr">v-for</span>=<span class="string">"item in commentList"</span> <span class="attr">:key</span>=<span class="string">"item.pk"</span> <span class="attr">:item</span>=<span class="string">"item"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-pull-refresh</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> { ajax } <span class="keyword">from</span> <span class="string">'@/utils/ajax'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> { SightApis } <span class="keyword">from</span> <span class="string">'@/utils/apis'</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 评论项组件</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> CommentItem <span class="keyword">from</span> <span class="string">'@/components/sight/CommentItem'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line">  components: {</span><br><span class="line">    CommentItem</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 评论列表</span></span></span><br><span class="line">      commentList: [],</span><br><span class="line"><span class="javascript">      <span class="comment">// 当前的页码</span></span></span><br><span class="line">      currentPage: 1,</span><br><span class="line"><span class="javascript">      <span class="comment">// 正在加载中</span></span></span><br><span class="line"><span class="javascript">      loading: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 所有的内容加载完</span></span></span><br><span class="line"><span class="javascript">      finished: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 请求失败</span></span></span><br><span class="line"><span class="javascript">      error: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 是否正在下拉刷新中</span></span></span><br><span class="line"><span class="javascript">      refreshing: <span class="literal">false</span></span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    goBack () {</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.go(<span class="number">-1</span>)</span></span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 下拉刷新执行</span><br><span class="line">     */</span><br><span class="line">    onRefresh () {</span><br><span class="line"><span class="javascript">      <span class="comment">// 清空数据</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.commentList = []</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.currentPage = <span class="number">1</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.finished = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.error = <span class="literal">false</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 重新加载数据</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.getCommentList()</span></span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 评论列表</span><br><span class="line">     */</span><br><span class="line">    getCommentList () {</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> url = SightApis.sightCommentUrl.replace(<span class="string">'#{id}'</span>, <span class="built_in">this</span>.id)</span></span><br><span class="line">      ajax.get(url, {</span><br><span class="line">        params: {</span><br><span class="line"><span class="javascript">          page: <span class="built_in">this</span>.currentPage</span></span><br><span class="line">        }</span><br><span class="line"><span class="javascript">      }).then(<span class="function">(<span class="params">{ data: { meta, objects } }</span>) =&gt;</span> {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.commentList = <span class="built_in">this</span>.commentList.concat(objects)</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 加载状态结束</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 设置下一页的页码</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.currentPage = meta.current_page + <span class="number">1</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 数据全部加载完成： 当前页面 == 总页数</span></span></span><br><span class="line">        if (meta.current_page === meta.page_count) {</span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line">        }</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.refreshing = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">      }).catch(<span class="function">() =&gt;</span> {</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.error = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.refreshing = <span class="literal">false</span></span></span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted () {</span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.id = <span class="built_in">this</span>.$route.params.id</span></span><br><span class="line"><span class="javascript">    <span class="comment">// this.getCommentList()</span></span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="实现图片列表接口"><a href="#实现图片列表接口" class="headerlink" title="实现图片列表接口"></a>实现图片列表接口</h3><p><code>src\views\sight\SightImage.vue</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 景点图片 --&gt;</span><br><span class="line">  &lt;div class="page-sight-image"&gt;</span><br><span class="line">    &lt;!-- 顶部导航 --&gt;</span><br><span class="line">    &lt;van-nav-bar title="景点图片" left-text="返回" left-arrow @click-left="goBack" /&gt;</span><br><span class="line">    &lt;!-- 图片列表 --&gt;</span><br><span class="line">    &lt;van-pull-refresh v-model="refreshing" @refresh="onRefresh"&gt;</span><br><span class="line">      &lt;van-list</span><br><span class="line">        class="sight-image"</span><br><span class="line">        v-model="loading"</span><br><span class="line">        :finished="finished"</span><br><span class="line">        finished-text="没有更多了"</span><br><span class="line">        :error.sync="error"</span><br><span class="line">        error-text="请求失败，点击重新加载"</span><br><span class="line">        @load="getImageList"</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;van-row&gt;</span><br><span class="line">          &lt;van-col span="12" v-for="(item, index) in imageList" :key="index"&gt;</span><br><span class="line">            &lt;van-image width="100%" height="100%" :src="item.img" @click="showPreview=true"/&gt;</span><br><span class="line">          &lt;/van-col&gt;</span><br><span class="line">        &lt;/van-row&gt;</span><br><span class="line">      &lt;/van-list&gt;</span><br><span class="line">    &lt;/van-pull-refresh&gt;</span><br><span class="line">    &lt;!-- //图片列表 --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 图片预览 --&gt;</span><br><span class="line">    &lt;van-image-preview v-model="showPreview" :images="imgUrlList" @change="onChange"&gt;</span><br><span class="line">      &lt;template v-slot:index&gt;第{{ index + 1 }}页 / 共{{ imageList.length }}张&lt;/template&gt;</span><br><span class="line">    &lt;/van-image-preview&gt;</span><br><span class="line">    &lt;!-- // 图片预览 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from '@/utils/ajax'</span><br><span class="line">import { SightApis } from '@/utils/apis'</span><br><span class="line">export default {</span><br><span class="line">  components: {},</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      // 图片列表</span><br><span class="line">      imageList: [],</span><br><span class="line">      // 图片预览</span><br><span class="line">      index: 0,</span><br><span class="line">      showPreview: false,</span><br><span class="line">      // 当前的页码</span><br><span class="line">      currentPage: 1,</span><br><span class="line">      // 正在加载中</span><br><span class="line">      loading: false,</span><br><span class="line">      // 所有的内容加载完</span><br><span class="line">      finished: false,</span><br><span class="line">      // 请求失败</span><br><span class="line">      error: false,</span><br><span class="line">      // 是否正在下拉刷新中</span><br><span class="line">      refreshing: false</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * 预览切换图片</span><br><span class="line">     */</span><br><span class="line">    onChange (index) {</span><br><span class="line">      this.index = index</span><br><span class="line">    },</span><br><span class="line">    goBack () {</span><br><span class="line">      this.$router.go(-1)</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 下拉刷新执行</span><br><span class="line">     */</span><br><span class="line">    onRefresh () {</span><br><span class="line">      // 清空数据</span><br><span class="line">      this.imageList = []</span><br><span class="line">      this.currentPage = 1</span><br><span class="line"></span><br><span class="line">      this.finished = false</span><br><span class="line">      this.error = false</span><br><span class="line">    },</span><br><span class="line">    /**</span><br><span class="line">     * 图片列表</span><br><span class="line">     */</span><br><span class="line">    getImageList () {</span><br><span class="line">      const url = SightApis.sightImageUrl.replace('#{id}', this.id)</span><br><span class="line">      ajax.get(url, {</span><br><span class="line">        params: {</span><br><span class="line">          page: this.currentPage</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data: { meta, objects } }) =&gt; {</span><br><span class="line">        this.imageList = this.imageList.concat(objects)</span><br><span class="line">        // 加载状态结束</span><br><span class="line">        this.loading = false</span><br><span class="line">        // 设置下一页的页码</span><br><span class="line">        this.currentPage = meta.current_page + 1</span><br><span class="line">        // 数据全部加载完成： 当前页面 == 总页数</span><br><span class="line">        if (meta.current_page === meta.page_count) {</span><br><span class="line">          this.finished = true</span><br><span class="line">        }</span><br><span class="line">        this.refreshing = false</span><br><span class="line">      }).catch(() =&gt; {</span><br><span class="line">        this.loading = false</span><br><span class="line">        this.error = true</span><br><span class="line">        this.refreshing = false</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  computed: {</span><br><span class="line">    /**</span><br><span class="line">     * 图片地址</span><br><span class="line">     */</span><br><span class="line">    imgUrlList () {</span><br><span class="line">      return this.imageList.map(item =&gt; item.img)</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  mounted () {</span><br><span class="line">    this.id = this.$route.params.id</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%89%91%E6%8C%87offer/" rel="tag"># 剑指offer</a>
              <a href="/tags/Vue/" rel="tag"># Vue</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/08/21/jian-zhi-offer30-40-ti/" rel="prev" title="剑指offer30~40题">
                  <i class="fa fa-chevron-left"></i> 剑指offer30~40题
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/08/21/jian-zhi-offer-shi-ti/" rel="next" title="剑指offer试题">
                  剑指offer试题 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">外心人D</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
